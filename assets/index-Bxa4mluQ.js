var j7=Object.defineProperty;var F7=(n,e,t)=>e in n?j7(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ti=(n,e,t)=>F7(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();function Za(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function B7(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var LE={exports:{}},Wh={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yD;function q7(){if(yD)return Wh;yD=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(r,i,a){var s=null;if(a!==void 0&&(s=""+a),i.key!==void 0&&(s=""+i.key),"key"in i){a={};for(var o in i)o!=="key"&&(a[o]=i[o])}else a=i;return i=a.ref,{$$typeof:n,type:r,key:s,ref:i!==void 0?i:null,props:a}}return Wh.Fragment=e,Wh.jsx=t,Wh.jsxs=t,Wh}var vD;function V7(){return vD||(vD=1,LE.exports=q7()),LE.exports}var Ae=V7(),UE={exports:{}};function z7(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var L3={exports:{}},nr=L3.exports={},Vs,zs;function VC(){throw new Error("setTimeout has not been defined")}function zC(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Vs=setTimeout:Vs=VC}catch{Vs=VC}try{typeof clearTimeout=="function"?zs=clearTimeout:zs=zC}catch{zs=zC}})();function U3(n){if(Vs===setTimeout)return setTimeout(n,0);if((Vs===VC||!Vs)&&setTimeout)return Vs=setTimeout,setTimeout(n,0);try{return Vs(n,0)}catch{try{return Vs.call(null,n,0)}catch{return Vs.call(this,n,0)}}}function H7(n){if(zs===clearTimeout)return clearTimeout(n);if((zs===zC||!zs)&&clearTimeout)return zs=clearTimeout,clearTimeout(n);try{return zs(n)}catch{try{return zs.call(null,n)}catch{return zs.call(this,n)}}}var qo=[],ad=!1,Bu,Pv=-1;function G7(){!ad||!Bu||(ad=!1,Bu.length?qo=Bu.concat(qo):Pv=-1,qo.length&&j3())}function j3(){if(!ad){var n=U3(G7);ad=!0;for(var e=qo.length;e;){for(Bu=qo,qo=[];++Pv<e;)Bu&&Bu[Pv].run();Pv=-1,e=qo.length}Bu=null,ad=!1,H7(n)}}nr.nextTick=function(n){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];qo.push(new F3(n,e)),qo.length===1&&!ad&&U3(j3)};function F3(n,e){this.fun=n,this.array=e}F3.prototype.run=function(){this.fun.apply(null,this.array)};nr.title="browser";nr.browser=!0;nr.env={};nr.argv=[];nr.version="";nr.versions={};function rl(){}nr.on=rl;nr.addListener=rl;nr.once=rl;nr.off=rl;nr.removeListener=rl;nr.removeAllListeners=rl;nr.emit=rl;nr.prependListener=rl;nr.prependOnceListener=rl;nr.listeners=function(n){return[]};nr.binding=function(n){throw new Error("process.binding is not supported")};nr.cwd=function(){return"/"};nr.chdir=function(n){throw new Error("process.chdir is not supported")};nr.umask=function(){return 0};var W7=L3.exports;const ot=z7(W7);var Lt={},_D;function K7(){if(_D)return Lt;_D=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),s=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),h=Symbol.iterator;function m($){return $===null||typeof $!="object"?null:($=h&&$[h]||$["@@iterator"],typeof $=="function"?$:null)}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_=Object.assign,w={};function S($,ve,Te){this.props=$,this.context=ve,this.refs=w,this.updater=Te||g}S.prototype.isReactComponent={},S.prototype.setState=function($,ve){if(typeof $!="object"&&typeof $!="function"&&$!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,$,ve,"setState")},S.prototype.forceUpdate=function($){this.updater.enqueueForceUpdate(this,$,"forceUpdate")};function E(){}E.prototype=S.prototype;function C($,ve,Te){this.props=$,this.context=ve,this.refs=w,this.updater=Te||g}var A=C.prototype=new E;A.constructor=C,_(A,S.prototype),A.isPureReactComponent=!0;var R=Array.isArray,P={H:null,A:null,T:null,S:null,V:null},N=Object.prototype.hasOwnProperty;function U($,ve,Te,F,ae,fe){return Te=fe.ref,{$$typeof:n,type:$,key:ve,ref:Te!==void 0?Te:null,props:fe}}function k($,ve){return U($.type,ve,void 0,void 0,void 0,$.props)}function B($){return typeof $=="object"&&$!==null&&$.$$typeof===n}function H($){var ve={"=":"=0",":":"=2"};return"$"+$.replace(/[=:]/g,function(Te){return ve[Te]})}var G=/\/+/g;function z($,ve){return typeof $=="object"&&$!==null&&$.key!=null?H(""+$.key):ve.toString(36)}function oe(){}function te($){switch($.status){case"fulfilled":return $.value;case"rejected":throw $.reason;default:switch(typeof $.status=="string"?$.then(oe,oe):($.status="pending",$.then(function(ve){$.status==="pending"&&($.status="fulfilled",$.value=ve)},function(ve){$.status==="pending"&&($.status="rejected",$.reason=ve)})),$.status){case"fulfilled":return $.value;case"rejected":throw $.reason}}throw $}function se($,ve,Te,F,ae){var fe=typeof $;(fe==="undefined"||fe==="boolean")&&($=null);var I=!1;if($===null)I=!0;else switch(fe){case"bigint":case"string":case"number":I=!0;break;case"object":switch($.$$typeof){case n:case e:I=!0;break;case d:return I=$._init,se(I($._payload),ve,Te,F,ae)}}if(I)return ae=ae($),I=F===""?"."+z($,0):F,R(ae)?(Te="",I!=null&&(Te=I.replace(G,"$&/")+"/"),se(ae,ve,Te,"",function(X){return X})):ae!=null&&(B(ae)&&(ae=k(ae,Te+(ae.key==null||$&&$.key===ae.key?"":(""+ae.key).replace(G,"$&/")+"/")+I)),ve.push(ae)),1;I=0;var O=F===""?".":F+":";if(R($))for(var J=0;J<$.length;J++)F=$[J],fe=O+z(F,J),I+=se(F,ve,Te,fe,ae);else if(J=m($),typeof J=="function")for($=J.call($),J=0;!(F=$.next()).done;)F=F.value,fe=O+z(F,J++),I+=se(F,ve,Te,fe,ae);else if(fe==="object"){if(typeof $.then=="function")return se(te($),ve,Te,F,ae);throw ve=String($),Error("Objects are not valid as a React child (found: "+(ve==="[object Object]"?"object with keys {"+Object.keys($).join(", ")+"}":ve)+"). If you meant to render a collection of children, use an array instead.")}return I}function ee($,ve,Te){if($==null)return $;var F=[],ae=0;return se($,F,"","",function(fe){return ve.call(Te,fe,ae++)}),F}function le($){if($._status===-1){var ve=$._result;ve=ve(),ve.then(function(Te){($._status===0||$._status===-1)&&($._status=1,$._result=Te)},function(Te){($._status===0||$._status===-1)&&($._status=2,$._result=Te)}),$._status===-1&&($._status=0,$._result=ve)}if($._status===1)return $._result.default;throw $._result}var pe=typeof reportError=="function"?reportError:function($){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ve=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof $=="object"&&$!==null&&typeof $.message=="string"?String($.message):String($),error:$});if(!window.dispatchEvent(ve))return}else if(typeof ot=="object"&&typeof ot.emit=="function"){ot.emit("uncaughtException",$);return}console.error($)};function we(){}return Lt.Children={map:ee,forEach:function($,ve,Te){ee($,function(){ve.apply(this,arguments)},Te)},count:function($){var ve=0;return ee($,function(){ve++}),ve},toArray:function($){return ee($,function(ve){return ve})||[]},only:function($){if(!B($))throw Error("React.Children.only expected to receive a single React element child.");return $}},Lt.Component=S,Lt.Fragment=t,Lt.Profiler=i,Lt.PureComponent=C,Lt.StrictMode=r,Lt.Suspense=u,Lt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=P,Lt.__COMPILER_RUNTIME={__proto__:null,c:function($){return P.H.useMemoCache($)}},Lt.cache=function($){return function(){return $.apply(null,arguments)}},Lt.cloneElement=function($,ve,Te){if($==null)throw Error("The argument must be a React element, but you passed "+$+".");var F=_({},$.props),ae=$.key,fe=void 0;if(ve!=null)for(I in ve.ref!==void 0&&(fe=void 0),ve.key!==void 0&&(ae=""+ve.key),ve)!N.call(ve,I)||I==="key"||I==="__self"||I==="__source"||I==="ref"&&ve.ref===void 0||(F[I]=ve[I]);var I=arguments.length-2;if(I===1)F.children=Te;else if(1<I){for(var O=Array(I),J=0;J<I;J++)O[J]=arguments[J+2];F.children=O}return U($.type,ae,void 0,void 0,fe,F)},Lt.createContext=function($){return $={$$typeof:s,_currentValue:$,_currentValue2:$,_threadCount:0,Provider:null,Consumer:null},$.Provider=$,$.Consumer={$$typeof:a,_context:$},$},Lt.createElement=function($,ve,Te){var F,ae={},fe=null;if(ve!=null)for(F in ve.key!==void 0&&(fe=""+ve.key),ve)N.call(ve,F)&&F!=="key"&&F!=="__self"&&F!=="__source"&&(ae[F]=ve[F]);var I=arguments.length-2;if(I===1)ae.children=Te;else if(1<I){for(var O=Array(I),J=0;J<I;J++)O[J]=arguments[J+2];ae.children=O}if($&&$.defaultProps)for(F in I=$.defaultProps,I)ae[F]===void 0&&(ae[F]=I[F]);return U($,fe,void 0,void 0,null,ae)},Lt.createRef=function(){return{current:null}},Lt.forwardRef=function($){return{$$typeof:o,render:$}},Lt.isValidElement=B,Lt.lazy=function($){return{$$typeof:d,_payload:{_status:-1,_result:$},_init:le}},Lt.memo=function($,ve){return{$$typeof:c,type:$,compare:ve===void 0?null:ve}},Lt.startTransition=function($){var ve=P.T,Te={};P.T=Te;try{var F=$(),ae=P.S;ae!==null&&ae(Te,F),typeof F=="object"&&F!==null&&typeof F.then=="function"&&F.then(we,pe)}catch(fe){pe(fe)}finally{P.T=ve}},Lt.unstable_useCacheRefresh=function(){return P.H.useCacheRefresh()},Lt.use=function($){return P.H.use($)},Lt.useActionState=function($,ve,Te){return P.H.useActionState($,ve,Te)},Lt.useCallback=function($,ve){return P.H.useCallback($,ve)},Lt.useContext=function($){return P.H.useContext($)},Lt.useDebugValue=function(){},Lt.useDeferredValue=function($,ve){return P.H.useDeferredValue($,ve)},Lt.useEffect=function($,ve,Te){var F=P.H;if(typeof Te=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return F.useEffect($,ve)},Lt.useId=function(){return P.H.useId()},Lt.useImperativeHandle=function($,ve,Te){return P.H.useImperativeHandle($,ve,Te)},Lt.useInsertionEffect=function($,ve){return P.H.useInsertionEffect($,ve)},Lt.useLayoutEffect=function($,ve){return P.H.useLayoutEffect($,ve)},Lt.useMemo=function($,ve){return P.H.useMemo($,ve)},Lt.useOptimistic=function($,ve){return P.H.useOptimistic($,ve)},Lt.useReducer=function($,ve,Te){return P.H.useReducer($,ve,Te)},Lt.useRef=function($){return P.H.useRef($)},Lt.useState=function($){return P.H.useState($)},Lt.useSyncExternalStore=function($,ve,Te){return P.H.useSyncExternalStore($,ve,Te)},Lt.useTransition=function(){return P.H.useTransition()},Lt.version="19.1.0",Lt}var bD;function JR(){return bD||(bD=1,UE.exports=K7()),UE.exports}var wt=JR();const J7=Za(wt);var jE={exports:{}},Kh={},FE={exports:{}},BE={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wD;function Y7(){return wD||(wD=1,function(n){function e(ee,le){var pe=ee.length;ee.push(le);e:for(;0<pe;){var we=pe-1>>>1,$=ee[we];if(0<i($,le))ee[we]=le,ee[pe]=$,pe=we;else break e}}function t(ee){return ee.length===0?null:ee[0]}function r(ee){if(ee.length===0)return null;var le=ee[0],pe=ee.pop();if(pe!==le){ee[0]=pe;e:for(var we=0,$=ee.length,ve=$>>>1;we<ve;){var Te=2*(we+1)-1,F=ee[Te],ae=Te+1,fe=ee[ae];if(0>i(F,pe))ae<$&&0>i(fe,F)?(ee[we]=fe,ee[ae]=pe,we=ae):(ee[we]=F,ee[Te]=pe,we=Te);else if(ae<$&&0>i(fe,pe))ee[we]=fe,ee[ae]=pe,we=ae;else break e}}return le}function i(ee,le){var pe=ee.sortIndex-le.sortIndex;return pe!==0?pe:ee.id-le.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;n.unstable_now=function(){return a.now()}}else{var s=Date,o=s.now();n.unstable_now=function(){return s.now()-o}}var u=[],c=[],d=1,h=null,m=3,g=!1,_=!1,w=!1,S=!1,E=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;function R(ee){for(var le=t(c);le!==null;){if(le.callback===null)r(c);else if(le.startTime<=ee)r(c),le.sortIndex=le.expirationTime,e(u,le);else break;le=t(c)}}function P(ee){if(w=!1,R(ee),!_)if(t(u)!==null)_=!0,N||(N=!0,z());else{var le=t(c);le!==null&&se(P,le.startTime-ee)}}var N=!1,U=-1,k=5,B=-1;function H(){return S?!0:!(n.unstable_now()-B<k)}function G(){if(S=!1,N){var ee=n.unstable_now();B=ee;var le=!0;try{e:{_=!1,w&&(w=!1,C(U),U=-1),g=!0;var pe=m;try{t:{for(R(ee),h=t(u);h!==null&&!(h.expirationTime>ee&&H());){var we=h.callback;if(typeof we=="function"){h.callback=null,m=h.priorityLevel;var $=we(h.expirationTime<=ee);if(ee=n.unstable_now(),typeof $=="function"){h.callback=$,R(ee),le=!0;break t}h===t(u)&&r(u),R(ee)}else r(u);h=t(u)}if(h!==null)le=!0;else{var ve=t(c);ve!==null&&se(P,ve.startTime-ee),le=!1}}break e}finally{h=null,m=pe,g=!1}le=void 0}}finally{le?z():N=!1}}}var z;if(typeof A=="function")z=function(){A(G)};else if(typeof MessageChannel<"u"){var oe=new MessageChannel,te=oe.port2;oe.port1.onmessage=G,z=function(){te.postMessage(null)}}else z=function(){E(G,0)};function se(ee,le){U=E(function(){ee(n.unstable_now())},le)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(ee){ee.callback=null},n.unstable_forceFrameRate=function(ee){0>ee||125<ee?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<ee?Math.floor(1e3/ee):5},n.unstable_getCurrentPriorityLevel=function(){return m},n.unstable_next=function(ee){switch(m){case 1:case 2:case 3:var le=3;break;default:le=m}var pe=m;m=le;try{return ee()}finally{m=pe}},n.unstable_requestPaint=function(){S=!0},n.unstable_runWithPriority=function(ee,le){switch(ee){case 1:case 2:case 3:case 4:case 5:break;default:ee=3}var pe=m;m=ee;try{return le()}finally{m=pe}},n.unstable_scheduleCallback=function(ee,le,pe){var we=n.unstable_now();switch(typeof pe=="object"&&pe!==null?(pe=pe.delay,pe=typeof pe=="number"&&0<pe?we+pe:we):pe=we,ee){case 1:var $=-1;break;case 2:$=250;break;case 5:$=1073741823;break;case 4:$=1e4;break;default:$=5e3}return $=pe+$,ee={id:d++,callback:le,priorityLevel:ee,startTime:pe,expirationTime:$,sortIndex:-1},pe>we?(ee.sortIndex=pe,e(c,ee),t(u)===null&&ee===t(c)&&(w?(C(U),U=-1):w=!0,se(P,pe-we))):(ee.sortIndex=$,e(u,ee),_||g||(_=!0,N||(N=!0,z()))),ee},n.unstable_shouldYield=H,n.unstable_wrapCallback=function(ee){var le=m;return function(){var pe=m;m=le;try{return ee.apply(this,arguments)}finally{m=pe}}}}(BE)),BE}var ED;function Z7(){return ED||(ED=1,FE.exports=Y7()),FE.exports}var qE={exports:{}},ni={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var SD;function X7(){if(SD)return ni;SD=1;var n=JR();function e(u){var c="https://react.dev/errors/"+u;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)c+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+u+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var r={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function a(u,c,d){var h=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:h==null?null:""+h,children:u,containerInfo:c,implementation:d}}var s=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function o(u,c){if(u==="font")return"";if(typeof c=="string")return c==="use-credentials"?c:""}return ni.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,ni.createPortal=function(u,c){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)throw Error(e(299));return a(u,c,null,d)},ni.flushSync=function(u){var c=s.T,d=r.p;try{if(s.T=null,r.p=2,u)return u()}finally{s.T=c,r.p=d,r.d.f()}},ni.preconnect=function(u,c){typeof u=="string"&&(c?(c=c.crossOrigin,c=typeof c=="string"?c==="use-credentials"?c:"":void 0):c=null,r.d.C(u,c))},ni.prefetchDNS=function(u){typeof u=="string"&&r.d.D(u)},ni.preinit=function(u,c){if(typeof u=="string"&&c&&typeof c.as=="string"){var d=c.as,h=o(d,c.crossOrigin),m=typeof c.integrity=="string"?c.integrity:void 0,g=typeof c.fetchPriority=="string"?c.fetchPriority:void 0;d==="style"?r.d.S(u,typeof c.precedence=="string"?c.precedence:void 0,{crossOrigin:h,integrity:m,fetchPriority:g}):d==="script"&&r.d.X(u,{crossOrigin:h,integrity:m,fetchPriority:g,nonce:typeof c.nonce=="string"?c.nonce:void 0})}},ni.preinitModule=function(u,c){if(typeof u=="string")if(typeof c=="object"&&c!==null){if(c.as==null||c.as==="script"){var d=o(c.as,c.crossOrigin);r.d.M(u,{crossOrigin:d,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0})}}else c==null&&r.d.M(u)},ni.preload=function(u,c){if(typeof u=="string"&&typeof c=="object"&&c!==null&&typeof c.as=="string"){var d=c.as,h=o(d,c.crossOrigin);r.d.L(u,d,{crossOrigin:h,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0,type:typeof c.type=="string"?c.type:void 0,fetchPriority:typeof c.fetchPriority=="string"?c.fetchPriority:void 0,referrerPolicy:typeof c.referrerPolicy=="string"?c.referrerPolicy:void 0,imageSrcSet:typeof c.imageSrcSet=="string"?c.imageSrcSet:void 0,imageSizes:typeof c.imageSizes=="string"?c.imageSizes:void 0,media:typeof c.media=="string"?c.media:void 0})}},ni.preloadModule=function(u,c){if(typeof u=="string")if(c){var d=o(c.as,c.crossOrigin);r.d.m(u,{as:typeof c.as=="string"&&c.as!=="script"?c.as:void 0,crossOrigin:d,integrity:typeof c.integrity=="string"?c.integrity:void 0})}else r.d.m(u)},ni.requestFormReset=function(u){r.d.r(u)},ni.unstable_batchedUpdates=function(u,c){return u(c)},ni.useFormState=function(u,c,d){return s.H.useFormState(u,c,d)},ni.useFormStatus=function(){return s.H.useHostTransitionStatus()},ni.version="19.1.0",ni}var TD;function Q7(){if(TD)return qE.exports;TD=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),qE.exports=X7(),qE.exports}var AD;function eW(){if(AD)return Kh;AD=1;/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n=Z7(),e=JR(),t=Q7();function r(l){var f="https://react.dev/errors/"+l;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)f+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+l+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}function a(l){var f=l,p=l;if(l.alternate)for(;f.return;)f=f.return;else{l=f;do f=l,(f.flags&4098)!==0&&(p=f.return),l=f.return;while(l)}return f.tag===3?p:null}function s(l){if(l.tag===13){var f=l.memoizedState;if(f===null&&(l=l.alternate,l!==null&&(f=l.memoizedState)),f!==null)return f.dehydrated}return null}function o(l){if(a(l)!==l)throw Error(r(188))}function u(l){var f=l.alternate;if(!f){if(f=a(l),f===null)throw Error(r(188));return f!==l?null:l}for(var p=l,y=f;;){var T=p.return;if(T===null)break;var x=T.alternate;if(x===null){if(y=T.return,y!==null){p=y;continue}break}if(T.child===x.child){for(x=T.child;x;){if(x===p)return o(T),l;if(x===y)return o(T),f;x=x.sibling}throw Error(r(188))}if(p.return!==y.return)p=T,y=x;else{for(var q=!1,Z=T.child;Z;){if(Z===p){q=!0,p=T,y=x;break}if(Z===y){q=!0,y=T,p=x;break}Z=Z.sibling}if(!q){for(Z=x.child;Z;){if(Z===p){q=!0,p=x,y=T;break}if(Z===y){q=!0,y=x,p=T;break}Z=Z.sibling}if(!q)throw Error(r(189))}}if(p.alternate!==y)throw Error(r(190))}if(p.tag!==3)throw Error(r(188));return p.stateNode.current===p?l:f}function c(l){var f=l.tag;if(f===5||f===26||f===27||f===6)return l;for(l=l.child;l!==null;){if(f=c(l),f!==null)return f;l=l.sibling}return null}var d=Object.assign,h=Symbol.for("react.element"),m=Symbol.for("react.transitional.element"),g=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),C=Symbol.for("react.consumer"),A=Symbol.for("react.context"),R=Symbol.for("react.forward_ref"),P=Symbol.for("react.suspense"),N=Symbol.for("react.suspense_list"),U=Symbol.for("react.memo"),k=Symbol.for("react.lazy"),B=Symbol.for("react.activity"),H=Symbol.for("react.memo_cache_sentinel"),G=Symbol.iterator;function z(l){return l===null||typeof l!="object"?null:(l=G&&l[G]||l["@@iterator"],typeof l=="function"?l:null)}var oe=Symbol.for("react.client.reference");function te(l){if(l==null)return null;if(typeof l=="function")return l.$$typeof===oe?null:l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case _:return"Fragment";case S:return"Profiler";case w:return"StrictMode";case P:return"Suspense";case N:return"SuspenseList";case B:return"Activity"}if(typeof l=="object")switch(l.$$typeof){case g:return"Portal";case A:return(l.displayName||"Context")+".Provider";case C:return(l._context.displayName||"Context")+".Consumer";case R:var f=l.render;return l=l.displayName,l||(l=f.displayName||f.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case U:return f=l.displayName||null,f!==null?f:te(l.type)||"Memo";case k:f=l._payload,l=l._init;try{return te(l(f))}catch{}}return null}var se=Array.isArray,ee=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,le=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,pe={pending:!1,data:null,method:null,action:null},we=[],$=-1;function ve(l){return{current:l}}function Te(l){0>$||(l.current=we[$],we[$]=null,$--)}function F(l,f){$++,we[$]=l.current,l.current=f}var ae=ve(null),fe=ve(null),I=ve(null),O=ve(null);function J(l,f){switch(F(I,f),F(fe,l),F(ae,null),f.nodeType){case 9:case 11:l=(l=f.documentElement)&&(l=l.namespaceURI)?HM(l):0;break;default:if(l=f.tagName,f=f.namespaceURI)f=HM(f),l=GM(f,l);else switch(l){case"svg":l=1;break;case"math":l=2;break;default:l=0}}Te(ae),F(ae,l)}function X(){Te(ae),Te(fe),Te(I)}function ue(l){l.memoizedState!==null&&F(O,l);var f=ae.current,p=GM(f,l.type);f!==p&&(F(fe,l),F(ae,p))}function V(l){fe.current===l&&(Te(ae),Te(fe)),O.current===l&&(Te(O),qh._currentValue=pe)}var K=Object.prototype.hasOwnProperty,_e=n.unstable_scheduleCallback,Me=n.unstable_cancelCallback,tt=n.unstable_shouldYield,je=n.unstable_requestPaint,We=n.unstable_now,Ot=n.unstable_getCurrentPriorityLevel,Pe=n.unstable_ImmediatePriority,He=n.unstable_UserBlockingPriority,At=n.unstable_NormalPriority,Ge=n.unstable_LowPriority,ze=n.unstable_IdlePriority,it=n.log,Ze=n.unstable_setDisableYieldValue,he=null,Ie=null;function Be(l){if(typeof it=="function"&&Ze(l),Ie&&typeof Ie.setStrictMode=="function")try{Ie.setStrictMode(he,l)}catch{}}var nt=Math.clz32?Math.clz32:L,W=Math.log,M=Math.LN2;function L(l){return l>>>=0,l===0?32:31-(W(l)/M|0)|0}var re=256,me=4194304;function Ce(l){var f=l&42;if(f!==0)return f;switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return l&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return l}}function Le(l,f,p){var y=l.pendingLanes;if(y===0)return 0;var T=0,x=l.suspendedLanes,q=l.pingedLanes;l=l.warmLanes;var Z=y&134217727;return Z!==0?(y=Z&~x,y!==0?T=Ce(y):(q&=Z,q!==0?T=Ce(q):p||(p=Z&~l,p!==0&&(T=Ce(p))))):(Z=y&~x,Z!==0?T=Ce(Z):q!==0?T=Ce(q):p||(p=y&~l,p!==0&&(T=Ce(p)))),T===0?0:f!==0&&f!==T&&(f&x)===0&&(x=T&-T,p=f&-f,x>=p||x===32&&(p&4194048)!==0)?f:T}function ft(l,f){return(l.pendingLanes&~(l.suspendedLanes&~l.pingedLanes)&f)===0}function Bt(l,f){switch(l){case 1:case 2:case 4:case 8:case 64:return f+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function sn(){var l=re;return re<<=1,(re&4194048)===0&&(re=256),l}function hn(){var l=me;return me<<=1,(me&62914560)===0&&(me=4194304),l}function Xt(l){for(var f=[],p=0;31>p;p++)f.push(l);return f}function Aa(l,f){l.pendingLanes|=f,f!==268435456&&(l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0)}function Ai(l,f,p,y,T,x){var q=l.pendingLanes;l.pendingLanes=p,l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0,l.expiredLanes&=p,l.entangledLanes&=p,l.errorRecoveryDisabledLanes&=p,l.shellSuspendCounter=0;var Z=l.entanglements,ce=l.expirationTimes,Re=l.hiddenUpdates;for(p=q&~p;0<p;){var Fe=31-nt(p),Ve=1<<Fe;Z[Fe]=0,ce[Fe]=-1;var ke=Re[Fe];if(ke!==null)for(Re[Fe]=null,Fe=0;Fe<ke.length;Fe++){var De=ke[Fe];De!==null&&(De.lane&=-536870913)}p&=~Ve}y!==0&&Qi(l,y,0),x!==0&&T===0&&l.tag!==0&&(l.suspendedLanes|=x&~(q&~f))}function Qi(l,f,p){l.pendingLanes|=f,l.suspendedLanes&=~f;var y=31-nt(f);l.entangledLanes|=f,l.entanglements[y]=l.entanglements[y]|1073741824|p&4194090}function Lc(l,f){var p=l.entangledLanes|=f;for(l=l.entanglements;p;){var y=31-nt(p),T=1<<y;T&f|l[y]&f&&(l[y]|=f),p&=~T}}function fi(l){switch(l){case 2:l=1;break;case 8:l=4;break;case 32:l=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:l=128;break;case 268435456:l=134217728;break;default:l=0}return l}function du(l){return l&=-l,2<l?8<l?(l&134217727)!==0?32:268435456:8:2}function Y(){var l=le.p;return l!==0?l:(l=window.event,l===void 0?32:fD(l.type))}function D(l,f){var p=le.p;try{return le.p=l,f()}finally{le.p=p}}var j=Math.random().toString(36).slice(2),ie="__reactFiber$"+j,ge="__reactProps$"+j,Oe="__reactContainer$"+j,Q="__reactEvents$"+j,ne="__reactListeners$"+j,de="__reactHandles$"+j,Se="__reactResources$"+j,Ee="__reactMarker$"+j;function et(l){delete l[ie],delete l[ge],delete l[Q],delete l[ne],delete l[de]}function dt(l){var f=l[ie];if(f)return f;for(var p=l.parentNode;p;){if(f=p[Oe]||p[ie]){if(p=f.alternate,f.child!==null||p!==null&&p.child!==null)for(l=YM(l);l!==null;){if(p=l[ie])return p;l=YM(l)}return f}l=p,p=l.parentNode}return null}function $t(l){if(l=l[ie]||l[Oe]){var f=l.tag;if(f===5||f===6||f===13||f===26||f===27||f===3)return l}return null}function on(l){var f=l.tag;if(f===5||f===26||f===27||f===6)return l.stateNode;throw Error(r(33))}function _n(l){var f=l[Se];return f||(f=l[Se]={hoistableStyles:new Map,hoistableScripts:new Map}),f}function gt(l){l[Ee]=!0}var pn=new Set,Dn={};function vt(l,f){ln(l,f),ln(l+"Capture",f)}function ln(l,f){for(Dn[l]=f,l=0;l<f.length;l++)pn.add(f[l])}var Gn=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),An={},ns={};function Ca(l){return K.call(ns,l)?!0:K.call(An,l)?!1:Gn.test(l)?ns[l]=!0:(An[l]=!0,!1)}function di(l,f,p){if(Ca(f))if(p===null)l.removeAttribute(f);else{switch(typeof p){case"undefined":case"function":case"symbol":l.removeAttribute(f);return;case"boolean":var y=f.toLowerCase().slice(0,5);if(y!=="data-"&&y!=="aria-"){l.removeAttribute(f);return}}l.setAttribute(f,""+p)}}function rs(l,f,p){if(p===null)l.removeAttribute(f);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(f);return}l.setAttribute(f,""+p)}}function Lr(l,f,p,y){if(y===null)l.removeAttribute(p);else{switch(typeof y){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(p);return}l.setAttributeNS(f,p,""+y)}}var Qr,ea;function Ci(l){if(Qr===void 0)try{throw Error()}catch(p){var f=p.stack.trim().match(/\n( *(at )?)/);Qr=f&&f[1]||"",ea=-1<p.stack.indexOf(`
    at`)?" (<anonymous>)":-1<p.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Qr+l+ea}var ta=!1;function go(l,f){if(!l||ta)return"";ta=!0;var p=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var y={DetermineComponentFrameRoot:function(){try{if(f){var Ve=function(){throw Error()};if(Object.defineProperty(Ve.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Ve,[])}catch(De){var ke=De}Reflect.construct(l,[],Ve)}else{try{Ve.call()}catch(De){ke=De}l.call(Ve.prototype)}}else{try{throw Error()}catch(De){ke=De}(Ve=l())&&typeof Ve.catch=="function"&&Ve.catch(function(){})}}catch(De){if(De&&ke&&typeof De.stack=="string")return[De.stack,ke.stack]}return[null,null]}};y.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var T=Object.getOwnPropertyDescriptor(y.DetermineComponentFrameRoot,"name");T&&T.configurable&&Object.defineProperty(y.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var x=y.DetermineComponentFrameRoot(),q=x[0],Z=x[1];if(q&&Z){var ce=q.split(`
`),Re=Z.split(`
`);for(T=y=0;y<ce.length&&!ce[y].includes("DetermineComponentFrameRoot");)y++;for(;T<Re.length&&!Re[T].includes("DetermineComponentFrameRoot");)T++;if(y===ce.length||T===Re.length)for(y=ce.length-1,T=Re.length-1;1<=y&&0<=T&&ce[y]!==Re[T];)T--;for(;1<=y&&0<=T;y--,T--)if(ce[y]!==Re[T]){if(y!==1||T!==1)do if(y--,T--,0>T||ce[y]!==Re[T]){var Fe=`
`+ce[y].replace(" at new "," at ");return l.displayName&&Fe.includes("<anonymous>")&&(Fe=Fe.replace("<anonymous>",l.displayName)),Fe}while(1<=y&&0<=T);break}}}finally{ta=!1,Error.prepareStackTrace=p}return(p=l?l.displayName||l.name:"")?Ci(p):""}function Eg(l){switch(l.tag){case 26:case 27:case 5:return Ci(l.type);case 16:return Ci("Lazy");case 13:return Ci("Suspense");case 19:return Ci("SuspenseList");case 0:case 15:return go(l.type,!1);case 11:return go(l.type.render,!1);case 1:return go(l.type,!0);case 31:return Ci("Activity");default:return""}}function Qd(l){try{var f="";do f+=Eg(l),l=l.return;while(l);return f}catch(p){return`
Error generating stack: `+p.message+`
`+p.stack}}function Ur(l){switch(typeof l){case"bigint":case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function hu(l){var f=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(f==="checkbox"||f==="radio")}function Uc(l){var f=hu(l)?"checked":"value",p=Object.getOwnPropertyDescriptor(l.constructor.prototype,f),y=""+l[f];if(!l.hasOwnProperty(f)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var T=p.get,x=p.set;return Object.defineProperty(l,f,{configurable:!0,get:function(){return T.call(this)},set:function(q){y=""+q,x.call(this,q)}}),Object.defineProperty(l,f,{enumerable:p.enumerable}),{getValue:function(){return y},setValue:function(q){y=""+q},stopTracking:function(){l._valueTracker=null,delete l[f]}}}}function pu(l){l._valueTracker||(l._valueTracker=Uc(l))}function eh(l){if(!l)return!1;var f=l._valueTracker;if(!f)return!0;var p=f.getValue(),y="";return l&&(y=hu(l)?l.checked?"true":"false":l.value),l=y,l!==p?(f.setValue(l),!0):!1}function Ms(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}var DH=/[\n"\\]/g;function xa(l){return l.replace(DH,function(f){return"\\"+f.charCodeAt(0).toString(16)+" "})}function Mw(l,f,p,y,T,x,q,Z){l.name="",q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"?l.type=q:l.removeAttribute("type"),f!=null?q==="number"?(f===0&&l.value===""||l.value!=f)&&(l.value=""+Ur(f)):l.value!==""+Ur(f)&&(l.value=""+Ur(f)):q!=="submit"&&q!=="reset"||l.removeAttribute("value"),f!=null?Dw(l,q,Ur(f)):p!=null?Dw(l,q,Ur(p)):y!=null&&l.removeAttribute("value"),T==null&&x!=null&&(l.defaultChecked=!!x),T!=null&&(l.checked=T&&typeof T!="function"&&typeof T!="symbol"),Z!=null&&typeof Z!="function"&&typeof Z!="symbol"&&typeof Z!="boolean"?l.name=""+Ur(Z):l.removeAttribute("name")}function qO(l,f,p,y,T,x,q,Z){if(x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(l.type=x),f!=null||p!=null){if(!(x!=="submit"&&x!=="reset"||f!=null))return;p=p!=null?""+Ur(p):"",f=f!=null?""+Ur(f):p,Z||f===l.value||(l.value=f),l.defaultValue=f}y=y??T,y=typeof y!="function"&&typeof y!="symbol"&&!!y,l.checked=Z?l.checked:!!y,l.defaultChecked=!!y,q!=null&&typeof q!="function"&&typeof q!="symbol"&&typeof q!="boolean"&&(l.name=q)}function Dw(l,f,p){f==="number"&&Ms(l.ownerDocument)===l||l.defaultValue===""+p||(l.defaultValue=""+p)}function jc(l,f,p,y){if(l=l.options,f){f={};for(var T=0;T<p.length;T++)f["$"+p[T]]=!0;for(p=0;p<l.length;p++)T=f.hasOwnProperty("$"+l[p].value),l[p].selected!==T&&(l[p].selected=T),T&&y&&(l[p].defaultSelected=!0)}else{for(p=""+Ur(p),f=null,T=0;T<l.length;T++){if(l[T].value===p){l[T].selected=!0,y&&(l[T].defaultSelected=!0);return}f!==null||l[T].disabled||(f=l[T])}f!==null&&(f.selected=!0)}}function VO(l,f,p){if(f!=null&&(f=""+Ur(f),f!==l.value&&(l.value=f),p==null)){l.defaultValue!==f&&(l.defaultValue=f);return}l.defaultValue=p!=null?""+Ur(p):""}function zO(l,f,p,y){if(f==null){if(y!=null){if(p!=null)throw Error(r(92));if(se(y)){if(1<y.length)throw Error(r(93));y=y[0]}p=y}p==null&&(p=""),f=p}p=Ur(f),l.defaultValue=p,y=l.textContent,y===p&&y!==""&&y!==null&&(l.value=y)}function Fc(l,f){if(f){var p=l.firstChild;if(p&&p===l.lastChild&&p.nodeType===3){p.nodeValue=f;return}}l.textContent=f}var $H=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function HO(l,f,p){var y=f.indexOf("--")===0;p==null||typeof p=="boolean"||p===""?y?l.setProperty(f,""):f==="float"?l.cssFloat="":l[f]="":y?l.setProperty(f,p):typeof p!="number"||p===0||$H.has(f)?f==="float"?l.cssFloat=p:l[f]=(""+p).trim():l[f]=p+"px"}function GO(l,f,p){if(f!=null&&typeof f!="object")throw Error(r(62));if(l=l.style,p!=null){for(var y in p)!p.hasOwnProperty(y)||f!=null&&f.hasOwnProperty(y)||(y.indexOf("--")===0?l.setProperty(y,""):y==="float"?l.cssFloat="":l[y]="");for(var T in f)y=f[T],f.hasOwnProperty(T)&&p[T]!==y&&HO(l,T,y)}else for(var x in f)f.hasOwnProperty(x)&&HO(l,x,f[x])}function $w(l){if(l.indexOf("-")===-1)return!1;switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var LH=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),UH=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Sg(l){return UH.test(""+l)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":l}var Lw=null;function Uw(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var Bc=null,qc=null;function WO(l){var f=$t(l);if(f&&(l=f.stateNode)){var p=l[ge]||null;e:switch(l=f.stateNode,f.type){case"input":if(Mw(l,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name),f=p.name,p.type==="radio"&&f!=null){for(p=l;p.parentNode;)p=p.parentNode;for(p=p.querySelectorAll('input[name="'+xa(""+f)+'"][type="radio"]'),f=0;f<p.length;f++){var y=p[f];if(y!==l&&y.form===l.form){var T=y[ge]||null;if(!T)throw Error(r(90));Mw(y,T.value,T.defaultValue,T.defaultValue,T.checked,T.defaultChecked,T.type,T.name)}}for(f=0;f<p.length;f++)y=p[f],y.form===l.form&&eh(y)}break e;case"textarea":VO(l,p.value,p.defaultValue);break e;case"select":f=p.value,f!=null&&jc(l,!!p.multiple,f,!1)}}}var jw=!1;function KO(l,f,p){if(jw)return l(f,p);jw=!0;try{var y=l(f);return y}finally{if(jw=!1,(Bc!==null||qc!==null)&&(ly(),Bc&&(f=Bc,l=qc,qc=Bc=null,WO(f),l)))for(f=0;f<l.length;f++)WO(l[f])}}function th(l,f){var p=l.stateNode;if(p===null)return null;var y=p[ge]||null;if(y===null)return null;p=y[f];e:switch(f){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(y=!y.disabled)||(l=l.type,y=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!y;break e;default:l=!1}if(l)return null;if(p&&typeof p!="function")throw Error(r(231,f,typeof p));return p}var yo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Fw=!1;if(yo)try{var nh={};Object.defineProperty(nh,"passive",{get:function(){Fw=!0}}),window.addEventListener("test",nh,nh),window.removeEventListener("test",nh,nh)}catch{Fw=!1}var ll=null,Bw=null,Tg=null;function JO(){if(Tg)return Tg;var l,f=Bw,p=f.length,y,T="value"in ll?ll.value:ll.textContent,x=T.length;for(l=0;l<p&&f[l]===T[l];l++);var q=p-l;for(y=1;y<=q&&f[p-y]===T[x-y];y++);return Tg=T.slice(l,1<y?1-y:void 0)}function Ag(l){var f=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&f===13&&(l=13)):l=f,l===10&&(l=13),32<=l||l===13?l:0}function Cg(){return!0}function YO(){return!1}function xi(l){function f(p,y,T,x,q){this._reactName=p,this._targetInst=T,this.type=y,this.nativeEvent=x,this.target=q,this.currentTarget=null;for(var Z in l)l.hasOwnProperty(Z)&&(p=l[Z],this[Z]=p?p(x):x[Z]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?Cg:YO,this.isPropagationStopped=YO,this}return d(f.prototype,{preventDefault:function(){this.defaultPrevented=!0;var p=this.nativeEvent;p&&(p.preventDefault?p.preventDefault():typeof p.returnValue!="unknown"&&(p.returnValue=!1),this.isDefaultPrevented=Cg)},stopPropagation:function(){var p=this.nativeEvent;p&&(p.stopPropagation?p.stopPropagation():typeof p.cancelBubble!="unknown"&&(p.cancelBubble=!0),this.isPropagationStopped=Cg)},persist:function(){},isPersistent:Cg}),f}var mu={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},xg=xi(mu),rh=d({},mu,{view:0,detail:0}),jH=xi(rh),qw,Vw,ih,Rg=d({},rh,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Hw,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==ih&&(ih&&l.type==="mousemove"?(qw=l.screenX-ih.screenX,Vw=l.screenY-ih.screenY):Vw=qw=0,ih=l),qw)},movementY:function(l){return"movementY"in l?l.movementY:Vw}}),ZO=xi(Rg),FH=d({},Rg,{dataTransfer:0}),BH=xi(FH),qH=d({},rh,{relatedTarget:0}),zw=xi(qH),VH=d({},mu,{animationName:0,elapsedTime:0,pseudoElement:0}),zH=xi(VH),HH=d({},mu,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),GH=xi(HH),WH=d({},mu,{data:0}),XO=xi(WH),KH={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},JH={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},YH={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ZH(l){var f=this.nativeEvent;return f.getModifierState?f.getModifierState(l):(l=YH[l])?!!f[l]:!1}function Hw(){return ZH}var XH=d({},rh,{key:function(l){if(l.key){var f=KH[l.key]||l.key;if(f!=="Unidentified")return f}return l.type==="keypress"?(l=Ag(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?JH[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Hw,charCode:function(l){return l.type==="keypress"?Ag(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?Ag(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),QH=xi(XH),eG=d({},Rg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),QO=xi(eG),tG=d({},rh,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Hw}),nG=xi(tG),rG=d({},mu,{propertyName:0,elapsedTime:0,pseudoElement:0}),iG=xi(rG),aG=d({},Rg,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),sG=xi(aG),oG=d({},mu,{newState:0,oldState:0}),lG=xi(oG),uG=[9,13,27,32],Gw=yo&&"CompositionEvent"in window,ah=null;yo&&"documentMode"in document&&(ah=document.documentMode);var cG=yo&&"TextEvent"in window&&!ah,ek=yo&&(!Gw||ah&&8<ah&&11>=ah),tk=" ",nk=!1;function rk(l,f){switch(l){case"keyup":return uG.indexOf(f.keyCode)!==-1;case"keydown":return f.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ik(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var Vc=!1;function fG(l,f){switch(l){case"compositionend":return ik(f);case"keypress":return f.which!==32?null:(nk=!0,tk);case"textInput":return l=f.data,l===tk&&nk?null:l;default:return null}}function dG(l,f){if(Vc)return l==="compositionend"||!Gw&&rk(l,f)?(l=JO(),Tg=Bw=ll=null,Vc=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(f.ctrlKey||f.altKey||f.metaKey)||f.ctrlKey&&f.altKey){if(f.char&&1<f.char.length)return f.char;if(f.which)return String.fromCharCode(f.which)}return null;case"compositionend":return ek&&f.locale!=="ko"?null:f.data;default:return null}}var hG={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ak(l){var f=l&&l.nodeName&&l.nodeName.toLowerCase();return f==="input"?!!hG[l.type]:f==="textarea"}function sk(l,f,p,y){Bc?qc?qc.push(y):qc=[y]:Bc=y,f=py(f,"onChange"),0<f.length&&(p=new xg("onChange","change",null,p,y),l.push({event:p,listeners:f}))}var sh=null,oh=null;function pG(l){FM(l,0)}function Ig(l){var f=on(l);if(eh(f))return l}function ok(l,f){if(l==="change")return f}var lk=!1;if(yo){var Ww;if(yo){var Kw="oninput"in document;if(!Kw){var uk=document.createElement("div");uk.setAttribute("oninput","return;"),Kw=typeof uk.oninput=="function"}Ww=Kw}else Ww=!1;lk=Ww&&(!document.documentMode||9<document.documentMode)}function ck(){sh&&(sh.detachEvent("onpropertychange",fk),oh=sh=null)}function fk(l){if(l.propertyName==="value"&&Ig(oh)){var f=[];sk(f,oh,l,Uw(l)),KO(pG,f)}}function mG(l,f,p){l==="focusin"?(ck(),sh=f,oh=p,sh.attachEvent("onpropertychange",fk)):l==="focusout"&&ck()}function gG(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return Ig(oh)}function yG(l,f){if(l==="click")return Ig(f)}function vG(l,f){if(l==="input"||l==="change")return Ig(f)}function _G(l,f){return l===f&&(l!==0||1/l===1/f)||l!==l&&f!==f}var na=typeof Object.is=="function"?Object.is:_G;function lh(l,f){if(na(l,f))return!0;if(typeof l!="object"||l===null||typeof f!="object"||f===null)return!1;var p=Object.keys(l),y=Object.keys(f);if(p.length!==y.length)return!1;for(y=0;y<p.length;y++){var T=p[y];if(!K.call(f,T)||!na(l[T],f[T]))return!1}return!0}function dk(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function hk(l,f){var p=dk(l);l=0;for(var y;p;){if(p.nodeType===3){if(y=l+p.textContent.length,l<=f&&y>=f)return{node:p,offset:f-l};l=y}e:{for(;p;){if(p.nextSibling){p=p.nextSibling;break e}p=p.parentNode}p=void 0}p=dk(p)}}function pk(l,f){return l&&f?l===f?!0:l&&l.nodeType===3?!1:f&&f.nodeType===3?pk(l,f.parentNode):"contains"in l?l.contains(f):l.compareDocumentPosition?!!(l.compareDocumentPosition(f)&16):!1:!1}function mk(l){l=l!=null&&l.ownerDocument!=null&&l.ownerDocument.defaultView!=null?l.ownerDocument.defaultView:window;for(var f=Ms(l.document);f instanceof l.HTMLIFrameElement;){try{var p=typeof f.contentWindow.location.href=="string"}catch{p=!1}if(p)l=f.contentWindow;else break;f=Ms(l.document)}return f}function Jw(l){var f=l&&l.nodeName&&l.nodeName.toLowerCase();return f&&(f==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||f==="textarea"||l.contentEditable==="true")}var bG=yo&&"documentMode"in document&&11>=document.documentMode,zc=null,Yw=null,uh=null,Zw=!1;function gk(l,f,p){var y=p.window===p?p.document:p.nodeType===9?p:p.ownerDocument;Zw||zc==null||zc!==Ms(y)||(y=zc,"selectionStart"in y&&Jw(y)?y={start:y.selectionStart,end:y.selectionEnd}:(y=(y.ownerDocument&&y.ownerDocument.defaultView||window).getSelection(),y={anchorNode:y.anchorNode,anchorOffset:y.anchorOffset,focusNode:y.focusNode,focusOffset:y.focusOffset}),uh&&lh(uh,y)||(uh=y,y=py(Yw,"onSelect"),0<y.length&&(f=new xg("onSelect","select",null,f,p),l.push({event:f,listeners:y}),f.target=zc)))}function gu(l,f){var p={};return p[l.toLowerCase()]=f.toLowerCase(),p["Webkit"+l]="webkit"+f,p["Moz"+l]="moz"+f,p}var Hc={animationend:gu("Animation","AnimationEnd"),animationiteration:gu("Animation","AnimationIteration"),animationstart:gu("Animation","AnimationStart"),transitionrun:gu("Transition","TransitionRun"),transitionstart:gu("Transition","TransitionStart"),transitioncancel:gu("Transition","TransitionCancel"),transitionend:gu("Transition","TransitionEnd")},Xw={},yk={};yo&&(yk=document.createElement("div").style,"AnimationEvent"in window||(delete Hc.animationend.animation,delete Hc.animationiteration.animation,delete Hc.animationstart.animation),"TransitionEvent"in window||delete Hc.transitionend.transition);function yu(l){if(Xw[l])return Xw[l];if(!Hc[l])return l;var f=Hc[l],p;for(p in f)if(f.hasOwnProperty(p)&&p in yk)return Xw[l]=f[p];return l}var vk=yu("animationend"),_k=yu("animationiteration"),bk=yu("animationstart"),wG=yu("transitionrun"),EG=yu("transitionstart"),SG=yu("transitioncancel"),wk=yu("transitionend"),Ek=new Map,Qw="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Qw.push("scrollEnd");function is(l,f){Ek.set(l,f),vt(f,[l])}var Sk=new WeakMap;function Ra(l,f){if(typeof l=="object"&&l!==null){var p=Sk.get(l);return p!==void 0?p:(f={value:l,source:f,stack:Qd(f)},Sk.set(l,f),f)}return{value:l,source:f,stack:Qd(f)}}var Ia=[],Gc=0,e0=0;function Pg(){for(var l=Gc,f=e0=Gc=0;f<l;){var p=Ia[f];Ia[f++]=null;var y=Ia[f];Ia[f++]=null;var T=Ia[f];Ia[f++]=null;var x=Ia[f];if(Ia[f++]=null,y!==null&&T!==null){var q=y.pending;q===null?T.next=T:(T.next=q.next,q.next=T),y.pending=T}x!==0&&Tk(p,T,x)}}function Og(l,f,p,y){Ia[Gc++]=l,Ia[Gc++]=f,Ia[Gc++]=p,Ia[Gc++]=y,e0|=y,l.lanes|=y,l=l.alternate,l!==null&&(l.lanes|=y)}function t0(l,f,p,y){return Og(l,f,p,y),kg(l)}function Wc(l,f){return Og(l,null,null,f),kg(l)}function Tk(l,f,p){l.lanes|=p;var y=l.alternate;y!==null&&(y.lanes|=p);for(var T=!1,x=l.return;x!==null;)x.childLanes|=p,y=x.alternate,y!==null&&(y.childLanes|=p),x.tag===22&&(l=x.stateNode,l===null||l._visibility&1||(T=!0)),l=x,x=x.return;return l.tag===3?(x=l.stateNode,T&&f!==null&&(T=31-nt(p),l=x.hiddenUpdates,y=l[T],y===null?l[T]=[f]:y.push(f),f.lane=p|536870912),x):null}function kg(l){if(50<Mh)throw Mh=0,oE=null,Error(r(185));for(var f=l.return;f!==null;)l=f,f=l.return;return l.tag===3?l.stateNode:null}var Kc={};function TG(l,f,p,y){this.tag=l,this.key=p,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=f,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=y,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ra(l,f,p,y){return new TG(l,f,p,y)}function n0(l){return l=l.prototype,!(!l||!l.isReactComponent)}function vo(l,f){var p=l.alternate;return p===null?(p=ra(l.tag,f,l.key,l.mode),p.elementType=l.elementType,p.type=l.type,p.stateNode=l.stateNode,p.alternate=l,l.alternate=p):(p.pendingProps=f,p.type=l.type,p.flags=0,p.subtreeFlags=0,p.deletions=null),p.flags=l.flags&65011712,p.childLanes=l.childLanes,p.lanes=l.lanes,p.child=l.child,p.memoizedProps=l.memoizedProps,p.memoizedState=l.memoizedState,p.updateQueue=l.updateQueue,f=l.dependencies,p.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext},p.sibling=l.sibling,p.index=l.index,p.ref=l.ref,p.refCleanup=l.refCleanup,p}function Ak(l,f){l.flags&=65011714;var p=l.alternate;return p===null?(l.childLanes=0,l.lanes=f,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=p.childLanes,l.lanes=p.lanes,l.child=p.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=p.memoizedProps,l.memoizedState=p.memoizedState,l.updateQueue=p.updateQueue,l.type=p.type,f=p.dependencies,l.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),l}function Ng(l,f,p,y,T,x){var q=0;if(y=l,typeof l=="function")n0(l)&&(q=1);else if(typeof l=="string")q=C7(l,p,ae.current)?26:l==="html"||l==="head"||l==="body"?27:5;else e:switch(l){case B:return l=ra(31,p,f,T),l.elementType=B,l.lanes=x,l;case _:return vu(p.children,T,x,f);case w:q=8,T|=24;break;case S:return l=ra(12,p,f,T|2),l.elementType=S,l.lanes=x,l;case P:return l=ra(13,p,f,T),l.elementType=P,l.lanes=x,l;case N:return l=ra(19,p,f,T),l.elementType=N,l.lanes=x,l;default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case E:case A:q=10;break e;case C:q=9;break e;case R:q=11;break e;case U:q=14;break e;case k:q=16,y=null;break e}q=29,p=Error(r(130,l===null?"null":typeof l,"")),y=null}return f=ra(q,p,f,T),f.elementType=l,f.type=y,f.lanes=x,f}function vu(l,f,p,y){return l=ra(7,l,y,f),l.lanes=p,l}function r0(l,f,p){return l=ra(6,l,null,f),l.lanes=p,l}function i0(l,f,p){return f=ra(4,l.children!==null?l.children:[],l.key,f),f.lanes=p,f.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},f}var Jc=[],Yc=0,Mg=null,Dg=0,Pa=[],Oa=0,_u=null,_o=1,bo="";function bu(l,f){Jc[Yc++]=Dg,Jc[Yc++]=Mg,Mg=l,Dg=f}function Ck(l,f,p){Pa[Oa++]=_o,Pa[Oa++]=bo,Pa[Oa++]=_u,_u=l;var y=_o;l=bo;var T=32-nt(y)-1;y&=~(1<<T),p+=1;var x=32-nt(f)+T;if(30<x){var q=T-T%5;x=(y&(1<<q)-1).toString(32),y>>=q,T-=q,_o=1<<32-nt(f)+T|p<<T|y,bo=x+l}else _o=1<<x|p<<T|y,bo=l}function a0(l){l.return!==null&&(bu(l,1),Ck(l,1,0))}function s0(l){for(;l===Mg;)Mg=Jc[--Yc],Jc[Yc]=null,Dg=Jc[--Yc],Jc[Yc]=null;for(;l===_u;)_u=Pa[--Oa],Pa[Oa]=null,bo=Pa[--Oa],Pa[Oa]=null,_o=Pa[--Oa],Pa[Oa]=null}var hi=null,Wn=null,un=!1,wu=null,Ds=!1,o0=Error(r(519));function Eu(l){var f=Error(r(418,""));throw dh(Ra(f,l)),o0}function xk(l){var f=l.stateNode,p=l.type,y=l.memoizedProps;switch(f[ie]=l,f[ge]=y,p){case"dialog":Kt("cancel",f),Kt("close",f);break;case"iframe":case"object":case"embed":Kt("load",f);break;case"video":case"audio":for(p=0;p<$h.length;p++)Kt($h[p],f);break;case"source":Kt("error",f);break;case"img":case"image":case"link":Kt("error",f),Kt("load",f);break;case"details":Kt("toggle",f);break;case"input":Kt("invalid",f),qO(f,y.value,y.defaultValue,y.checked,y.defaultChecked,y.type,y.name,!0),pu(f);break;case"select":Kt("invalid",f);break;case"textarea":Kt("invalid",f),zO(f,y.value,y.defaultValue,y.children),pu(f)}p=y.children,typeof p!="string"&&typeof p!="number"&&typeof p!="bigint"||f.textContent===""+p||y.suppressHydrationWarning===!0||zM(f.textContent,p)?(y.popover!=null&&(Kt("beforetoggle",f),Kt("toggle",f)),y.onScroll!=null&&Kt("scroll",f),y.onScrollEnd!=null&&Kt("scrollend",f),y.onClick!=null&&(f.onclick=my),f=!0):f=!1,f||Eu(l)}function Rk(l){for(hi=l.return;hi;)switch(hi.tag){case 5:case 13:Ds=!1;return;case 27:case 3:Ds=!0;return;default:hi=hi.return}}function ch(l){if(l!==hi)return!1;if(!un)return Rk(l),un=!0,!1;var f=l.tag,p;if((p=f!==3&&f!==27)&&((p=f===5)&&(p=l.type,p=!(p!=="form"&&p!=="button")||SE(l.type,l.memoizedProps)),p=!p),p&&Wn&&Eu(l),Rk(l),f===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(r(317));e:{for(l=l.nextSibling,f=0;l;){if(l.nodeType===8)if(p=l.data,p==="/$"){if(f===0){Wn=ss(l.nextSibling);break e}f--}else p!=="$"&&p!=="$!"&&p!=="$?"||f++;l=l.nextSibling}Wn=null}}else f===27?(f=Wn,Tl(l.type)?(l=xE,xE=null,Wn=l):Wn=f):Wn=hi?ss(l.stateNode.nextSibling):null;return!0}function fh(){Wn=hi=null,un=!1}function Ik(){var l=wu;return l!==null&&(Pi===null?Pi=l:Pi.push.apply(Pi,l),wu=null),l}function dh(l){wu===null?wu=[l]:wu.push(l)}var l0=ve(null),Su=null,wo=null;function ul(l,f,p){F(l0,f._currentValue),f._currentValue=p}function Eo(l){l._currentValue=l0.current,Te(l0)}function u0(l,f,p){for(;l!==null;){var y=l.alternate;if((l.childLanes&f)!==f?(l.childLanes|=f,y!==null&&(y.childLanes|=f)):y!==null&&(y.childLanes&f)!==f&&(y.childLanes|=f),l===p)break;l=l.return}}function c0(l,f,p,y){var T=l.child;for(T!==null&&(T.return=l);T!==null;){var x=T.dependencies;if(x!==null){var q=T.child;x=x.firstContext;e:for(;x!==null;){var Z=x;x=T;for(var ce=0;ce<f.length;ce++)if(Z.context===f[ce]){x.lanes|=p,Z=x.alternate,Z!==null&&(Z.lanes|=p),u0(x.return,p,l),y||(q=null);break e}x=Z.next}}else if(T.tag===18){if(q=T.return,q===null)throw Error(r(341));q.lanes|=p,x=q.alternate,x!==null&&(x.lanes|=p),u0(q,p,l),q=null}else q=T.child;if(q!==null)q.return=T;else for(q=T;q!==null;){if(q===l){q=null;break}if(T=q.sibling,T!==null){T.return=q.return,q=T;break}q=q.return}T=q}}function hh(l,f,p,y){l=null;for(var T=f,x=!1;T!==null;){if(!x){if((T.flags&524288)!==0)x=!0;else if((T.flags&262144)!==0)break}if(T.tag===10){var q=T.alternate;if(q===null)throw Error(r(387));if(q=q.memoizedProps,q!==null){var Z=T.type;na(T.pendingProps.value,q.value)||(l!==null?l.push(Z):l=[Z])}}else if(T===O.current){if(q=T.alternate,q===null)throw Error(r(387));q.memoizedState.memoizedState!==T.memoizedState.memoizedState&&(l!==null?l.push(qh):l=[qh])}T=T.return}l!==null&&c0(f,l,p,y),f.flags|=262144}function $g(l){for(l=l.firstContext;l!==null;){if(!na(l.context._currentValue,l.memoizedValue))return!0;l=l.next}return!1}function Tu(l){Su=l,wo=null,l=l.dependencies,l!==null&&(l.firstContext=null)}function ei(l){return Pk(Su,l)}function Lg(l,f){return Su===null&&Tu(l),Pk(l,f)}function Pk(l,f){var p=f._currentValue;if(f={context:f,memoizedValue:p,next:null},wo===null){if(l===null)throw Error(r(308));wo=f,l.dependencies={lanes:0,firstContext:f},l.flags|=524288}else wo=wo.next=f;return p}var AG=typeof AbortController<"u"?AbortController:function(){var l=[],f=this.signal={aborted:!1,addEventListener:function(p,y){l.push(y)}};this.abort=function(){f.aborted=!0,l.forEach(function(p){return p()})}},CG=n.unstable_scheduleCallback,xG=n.unstable_NormalPriority,mr={$$typeof:A,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function f0(){return{controller:new AG,data:new Map,refCount:0}}function ph(l){l.refCount--,l.refCount===0&&CG(xG,function(){l.controller.abort()})}var mh=null,d0=0,Zc=0,Xc=null;function RG(l,f){if(mh===null){var p=mh=[];d0=0,Zc=pE(),Xc={status:"pending",value:void 0,then:function(y){p.push(y)}}}return d0++,f.then(Ok,Ok),f}function Ok(){if(--d0===0&&mh!==null){Xc!==null&&(Xc.status="fulfilled");var l=mh;mh=null,Zc=0,Xc=null;for(var f=0;f<l.length;f++)(0,l[f])()}}function IG(l,f){var p=[],y={status:"pending",value:null,reason:null,then:function(T){p.push(T)}};return l.then(function(){y.status="fulfilled",y.value=f;for(var T=0;T<p.length;T++)(0,p[T])(f)},function(T){for(y.status="rejected",y.reason=T,T=0;T<p.length;T++)(0,p[T])(void 0)}),y}var kk=ee.S;ee.S=function(l,f){typeof f=="object"&&f!==null&&typeof f.then=="function"&&RG(l,f),kk!==null&&kk(l,f)};var Au=ve(null);function h0(){var l=Au.current;return l!==null?l:Pn.pooledCache}function Ug(l,f){f===null?F(Au,Au.current):F(Au,f.pool)}function Nk(){var l=h0();return l===null?null:{parent:mr._currentValue,pool:l}}var gh=Error(r(460)),Mk=Error(r(474)),jg=Error(r(542)),p0={then:function(){}};function Dk(l){return l=l.status,l==="fulfilled"||l==="rejected"}function Fg(){}function $k(l,f,p){switch(p=l[p],p===void 0?l.push(f):p!==f&&(f.then(Fg,Fg),f=p),f.status){case"fulfilled":return f.value;case"rejected":throw l=f.reason,Uk(l),l;default:if(typeof f.status=="string")f.then(Fg,Fg);else{if(l=Pn,l!==null&&100<l.shellSuspendCounter)throw Error(r(482));l=f,l.status="pending",l.then(function(y){if(f.status==="pending"){var T=f;T.status="fulfilled",T.value=y}},function(y){if(f.status==="pending"){var T=f;T.status="rejected",T.reason=y}})}switch(f.status){case"fulfilled":return f.value;case"rejected":throw l=f.reason,Uk(l),l}throw yh=f,gh}}var yh=null;function Lk(){if(yh===null)throw Error(r(459));var l=yh;return yh=null,l}function Uk(l){if(l===gh||l===jg)throw Error(r(483))}var cl=!1;function m0(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function g0(l,f){l=l.updateQueue,f.updateQueue===l&&(f.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,callbacks:null})}function fl(l){return{lane:l,tag:0,payload:null,callback:null,next:null}}function dl(l,f,p){var y=l.updateQueue;if(y===null)return null;if(y=y.shared,(mn&2)!==0){var T=y.pending;return T===null?f.next=f:(f.next=T.next,T.next=f),y.pending=f,f=kg(l),Tk(l,null,p),f}return Og(l,y,f,p),kg(l)}function vh(l,f,p){if(f=f.updateQueue,f!==null&&(f=f.shared,(p&4194048)!==0)){var y=f.lanes;y&=l.pendingLanes,p|=y,f.lanes=p,Lc(l,p)}}function y0(l,f){var p=l.updateQueue,y=l.alternate;if(y!==null&&(y=y.updateQueue,p===y)){var T=null,x=null;if(p=p.firstBaseUpdate,p!==null){do{var q={lane:p.lane,tag:p.tag,payload:p.payload,callback:null,next:null};x===null?T=x=q:x=x.next=q,p=p.next}while(p!==null);x===null?T=x=f:x=x.next=f}else T=x=f;p={baseState:y.baseState,firstBaseUpdate:T,lastBaseUpdate:x,shared:y.shared,callbacks:y.callbacks},l.updateQueue=p;return}l=p.lastBaseUpdate,l===null?p.firstBaseUpdate=f:l.next=f,p.lastBaseUpdate=f}var v0=!1;function _h(){if(v0){var l=Xc;if(l!==null)throw l}}function bh(l,f,p,y){v0=!1;var T=l.updateQueue;cl=!1;var x=T.firstBaseUpdate,q=T.lastBaseUpdate,Z=T.shared.pending;if(Z!==null){T.shared.pending=null;var ce=Z,Re=ce.next;ce.next=null,q===null?x=Re:q.next=Re,q=ce;var Fe=l.alternate;Fe!==null&&(Fe=Fe.updateQueue,Z=Fe.lastBaseUpdate,Z!==q&&(Z===null?Fe.firstBaseUpdate=Re:Z.next=Re,Fe.lastBaseUpdate=ce))}if(x!==null){var Ve=T.baseState;q=0,Fe=Re=ce=null,Z=x;do{var ke=Z.lane&-536870913,De=ke!==Z.lane;if(De?(en&ke)===ke:(y&ke)===ke){ke!==0&&ke===Zc&&(v0=!0),Fe!==null&&(Fe=Fe.next={lane:0,tag:Z.tag,payload:Z.payload,callback:null,next:null});e:{var Et=l,_t=Z;ke=f;var En=p;switch(_t.tag){case 1:if(Et=_t.payload,typeof Et=="function"){Ve=Et.call(En,Ve,ke);break e}Ve=Et;break e;case 3:Et.flags=Et.flags&-65537|128;case 0:if(Et=_t.payload,ke=typeof Et=="function"?Et.call(En,Ve,ke):Et,ke==null)break e;Ve=d({},Ve,ke);break e;case 2:cl=!0}}ke=Z.callback,ke!==null&&(l.flags|=64,De&&(l.flags|=8192),De=T.callbacks,De===null?T.callbacks=[ke]:De.push(ke))}else De={lane:ke,tag:Z.tag,payload:Z.payload,callback:Z.callback,next:null},Fe===null?(Re=Fe=De,ce=Ve):Fe=Fe.next=De,q|=ke;if(Z=Z.next,Z===null){if(Z=T.shared.pending,Z===null)break;De=Z,Z=De.next,De.next=null,T.lastBaseUpdate=De,T.shared.pending=null}}while(!0);Fe===null&&(ce=Ve),T.baseState=ce,T.firstBaseUpdate=Re,T.lastBaseUpdate=Fe,x===null&&(T.shared.lanes=0),bl|=q,l.lanes=q,l.memoizedState=Ve}}function jk(l,f){if(typeof l!="function")throw Error(r(191,l));l.call(f)}function Fk(l,f){var p=l.callbacks;if(p!==null)for(l.callbacks=null,l=0;l<p.length;l++)jk(p[l],f)}var Qc=ve(null),Bg=ve(0);function Bk(l,f){l=Io,F(Bg,l),F(Qc,f),Io=l|f.baseLanes}function _0(){F(Bg,Io),F(Qc,Qc.current)}function b0(){Io=Bg.current,Te(Qc),Te(Bg)}var hl=0,Vt=null,bn=null,rr=null,qg=!1,ef=!1,Cu=!1,Vg=0,wh=0,tf=null,PG=0;function Qn(){throw Error(r(321))}function w0(l,f){if(f===null)return!1;for(var p=0;p<f.length&&p<l.length;p++)if(!na(l[p],f[p]))return!1;return!0}function E0(l,f,p,y,T,x){return hl=x,Vt=f,f.memoizedState=null,f.updateQueue=null,f.lanes=0,ee.H=l===null||l.memoizedState===null?TN:AN,Cu=!1,x=p(y,T),Cu=!1,ef&&(x=Vk(f,p,y,T)),qk(l),x}function qk(l){ee.H=Jg;var f=bn!==null&&bn.next!==null;if(hl=0,rr=bn=Vt=null,qg=!1,wh=0,tf=null,f)throw Error(r(300));l===null||Ir||(l=l.dependencies,l!==null&&$g(l)&&(Ir=!0))}function Vk(l,f,p,y){Vt=l;var T=0;do{if(ef&&(tf=null),wh=0,ef=!1,25<=T)throw Error(r(301));if(T+=1,rr=bn=null,l.updateQueue!=null){var x=l.updateQueue;x.lastEffect=null,x.events=null,x.stores=null,x.memoCache!=null&&(x.memoCache.index=0)}ee.H=LG,x=f(p,y)}while(ef);return x}function OG(){var l=ee.H,f=l.useState()[0];return f=typeof f.then=="function"?Eh(f):f,l=l.useState()[0],(bn!==null?bn.memoizedState:null)!==l&&(Vt.flags|=1024),f}function S0(){var l=Vg!==0;return Vg=0,l}function T0(l,f,p){f.updateQueue=l.updateQueue,f.flags&=-2053,l.lanes&=~p}function A0(l){if(qg){for(l=l.memoizedState;l!==null;){var f=l.queue;f!==null&&(f.pending=null),l=l.next}qg=!1}hl=0,rr=bn=Vt=null,ef=!1,wh=Vg=0,tf=null}function Ri(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return rr===null?Vt.memoizedState=rr=l:rr=rr.next=l,rr}function ir(){if(bn===null){var l=Vt.alternate;l=l!==null?l.memoizedState:null}else l=bn.next;var f=rr===null?Vt.memoizedState:rr.next;if(f!==null)rr=f,bn=l;else{if(l===null)throw Vt.alternate===null?Error(r(467)):Error(r(310));bn=l,l={memoizedState:bn.memoizedState,baseState:bn.baseState,baseQueue:bn.baseQueue,queue:bn.queue,next:null},rr===null?Vt.memoizedState=rr=l:rr=rr.next=l}return rr}function C0(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Eh(l){var f=wh;return wh+=1,tf===null&&(tf=[]),l=$k(tf,l,f),f=Vt,(rr===null?f.memoizedState:rr.next)===null&&(f=f.alternate,ee.H=f===null||f.memoizedState===null?TN:AN),l}function zg(l){if(l!==null&&typeof l=="object"){if(typeof l.then=="function")return Eh(l);if(l.$$typeof===A)return ei(l)}throw Error(r(438,String(l)))}function x0(l){var f=null,p=Vt.updateQueue;if(p!==null&&(f=p.memoCache),f==null){var y=Vt.alternate;y!==null&&(y=y.updateQueue,y!==null&&(y=y.memoCache,y!=null&&(f={data:y.data.map(function(T){return T.slice()}),index:0})))}if(f==null&&(f={data:[],index:0}),p===null&&(p=C0(),Vt.updateQueue=p),p.memoCache=f,p=f.data[f.index],p===void 0)for(p=f.data[f.index]=Array(l),y=0;y<l;y++)p[y]=H;return f.index++,p}function So(l,f){return typeof f=="function"?f(l):f}function Hg(l){var f=ir();return R0(f,bn,l)}function R0(l,f,p){var y=l.queue;if(y===null)throw Error(r(311));y.lastRenderedReducer=p;var T=l.baseQueue,x=y.pending;if(x!==null){if(T!==null){var q=T.next;T.next=x.next,x.next=q}f.baseQueue=T=x,y.pending=null}if(x=l.baseState,T===null)l.memoizedState=x;else{f=T.next;var Z=q=null,ce=null,Re=f,Fe=!1;do{var Ve=Re.lane&-536870913;if(Ve!==Re.lane?(en&Ve)===Ve:(hl&Ve)===Ve){var ke=Re.revertLane;if(ke===0)ce!==null&&(ce=ce.next={lane:0,revertLane:0,action:Re.action,hasEagerState:Re.hasEagerState,eagerState:Re.eagerState,next:null}),Ve===Zc&&(Fe=!0);else if((hl&ke)===ke){Re=Re.next,ke===Zc&&(Fe=!0);continue}else Ve={lane:0,revertLane:Re.revertLane,action:Re.action,hasEagerState:Re.hasEagerState,eagerState:Re.eagerState,next:null},ce===null?(Z=ce=Ve,q=x):ce=ce.next=Ve,Vt.lanes|=ke,bl|=ke;Ve=Re.action,Cu&&p(x,Ve),x=Re.hasEagerState?Re.eagerState:p(x,Ve)}else ke={lane:Ve,revertLane:Re.revertLane,action:Re.action,hasEagerState:Re.hasEagerState,eagerState:Re.eagerState,next:null},ce===null?(Z=ce=ke,q=x):ce=ce.next=ke,Vt.lanes|=Ve,bl|=Ve;Re=Re.next}while(Re!==null&&Re!==f);if(ce===null?q=x:ce.next=Z,!na(x,l.memoizedState)&&(Ir=!0,Fe&&(p=Xc,p!==null)))throw p;l.memoizedState=x,l.baseState=q,l.baseQueue=ce,y.lastRenderedState=x}return T===null&&(y.lanes=0),[l.memoizedState,y.dispatch]}function I0(l){var f=ir(),p=f.queue;if(p===null)throw Error(r(311));p.lastRenderedReducer=l;var y=p.dispatch,T=p.pending,x=f.memoizedState;if(T!==null){p.pending=null;var q=T=T.next;do x=l(x,q.action),q=q.next;while(q!==T);na(x,f.memoizedState)||(Ir=!0),f.memoizedState=x,f.baseQueue===null&&(f.baseState=x),p.lastRenderedState=x}return[x,y]}function zk(l,f,p){var y=Vt,T=ir(),x=un;if(x){if(p===void 0)throw Error(r(407));p=p()}else p=f();var q=!na((bn||T).memoizedState,p);q&&(T.memoizedState=p,Ir=!0),T=T.queue;var Z=Wk.bind(null,y,T,l);if(Sh(2048,8,Z,[l]),T.getSnapshot!==f||q||rr!==null&&rr.memoizedState.tag&1){if(y.flags|=2048,nf(9,Gg(),Gk.bind(null,y,T,p,f),null),Pn===null)throw Error(r(349));x||(hl&124)!==0||Hk(y,f,p)}return p}function Hk(l,f,p){l.flags|=16384,l={getSnapshot:f,value:p},f=Vt.updateQueue,f===null?(f=C0(),Vt.updateQueue=f,f.stores=[l]):(p=f.stores,p===null?f.stores=[l]:p.push(l))}function Gk(l,f,p,y){f.value=p,f.getSnapshot=y,Kk(f)&&Jk(l)}function Wk(l,f,p){return p(function(){Kk(f)&&Jk(l)})}function Kk(l){var f=l.getSnapshot;l=l.value;try{var p=f();return!na(l,p)}catch{return!0}}function Jk(l){var f=Wc(l,2);f!==null&&la(f,l,2)}function P0(l){var f=Ri();if(typeof l=="function"){var p=l;if(l=p(),Cu){Be(!0);try{p()}finally{Be(!1)}}}return f.memoizedState=f.baseState=l,f.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:So,lastRenderedState:l},f}function Yk(l,f,p,y){return l.baseState=p,R0(l,bn,typeof y=="function"?y:So)}function kG(l,f,p,y,T){if(Kg(l))throw Error(r(485));if(l=f.action,l!==null){var x={payload:T,action:l,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(q){x.listeners.push(q)}};ee.T!==null?p(!0):x.isTransition=!1,y(x),p=f.pending,p===null?(x.next=f.pending=x,Zk(f,x)):(x.next=p.next,f.pending=p.next=x)}}function Zk(l,f){var p=f.action,y=f.payload,T=l.state;if(f.isTransition){var x=ee.T,q={};ee.T=q;try{var Z=p(T,y),ce=ee.S;ce!==null&&ce(q,Z),Xk(l,f,Z)}catch(Re){O0(l,f,Re)}finally{ee.T=x}}else try{x=p(T,y),Xk(l,f,x)}catch(Re){O0(l,f,Re)}}function Xk(l,f,p){p!==null&&typeof p=="object"&&typeof p.then=="function"?p.then(function(y){Qk(l,f,y)},function(y){return O0(l,f,y)}):Qk(l,f,p)}function Qk(l,f,p){f.status="fulfilled",f.value=p,eN(f),l.state=p,f=l.pending,f!==null&&(p=f.next,p===f?l.pending=null:(p=p.next,f.next=p,Zk(l,p)))}function O0(l,f,p){var y=l.pending;if(l.pending=null,y!==null){y=y.next;do f.status="rejected",f.reason=p,eN(f),f=f.next;while(f!==y)}l.action=null}function eN(l){l=l.listeners;for(var f=0;f<l.length;f++)(0,l[f])()}function tN(l,f){return f}function nN(l,f){if(un){var p=Pn.formState;if(p!==null){e:{var y=Vt;if(un){if(Wn){t:{for(var T=Wn,x=Ds;T.nodeType!==8;){if(!x){T=null;break t}if(T=ss(T.nextSibling),T===null){T=null;break t}}x=T.data,T=x==="F!"||x==="F"?T:null}if(T){Wn=ss(T.nextSibling),y=T.data==="F!";break e}}Eu(y)}y=!1}y&&(f=p[0])}}return p=Ri(),p.memoizedState=p.baseState=f,y={pending:null,lanes:0,dispatch:null,lastRenderedReducer:tN,lastRenderedState:f},p.queue=y,p=wN.bind(null,Vt,y),y.dispatch=p,y=P0(!1),x=$0.bind(null,Vt,!1,y.queue),y=Ri(),T={state:f,dispatch:null,action:l,pending:null},y.queue=T,p=kG.bind(null,Vt,T,x,p),T.dispatch=p,y.memoizedState=l,[f,p,!1]}function rN(l){var f=ir();return iN(f,bn,l)}function iN(l,f,p){if(f=R0(l,f,tN)[0],l=Hg(So)[0],typeof f=="object"&&f!==null&&typeof f.then=="function")try{var y=Eh(f)}catch(q){throw q===gh?jg:q}else y=f;f=ir();var T=f.queue,x=T.dispatch;return p!==f.memoizedState&&(Vt.flags|=2048,nf(9,Gg(),NG.bind(null,T,p),null)),[y,x,l]}function NG(l,f){l.action=f}function aN(l){var f=ir(),p=bn;if(p!==null)return iN(f,p,l);ir(),f=f.memoizedState,p=ir();var y=p.queue.dispatch;return p.memoizedState=l,[f,y,!1]}function nf(l,f,p,y){return l={tag:l,create:p,deps:y,inst:f,next:null},f=Vt.updateQueue,f===null&&(f=C0(),Vt.updateQueue=f),p=f.lastEffect,p===null?f.lastEffect=l.next=l:(y=p.next,p.next=l,l.next=y,f.lastEffect=l),l}function Gg(){return{destroy:void 0,resource:void 0}}function sN(){return ir().memoizedState}function Wg(l,f,p,y){var T=Ri();y=y===void 0?null:y,Vt.flags|=l,T.memoizedState=nf(1|f,Gg(),p,y)}function Sh(l,f,p,y){var T=ir();y=y===void 0?null:y;var x=T.memoizedState.inst;bn!==null&&y!==null&&w0(y,bn.memoizedState.deps)?T.memoizedState=nf(f,x,p,y):(Vt.flags|=l,T.memoizedState=nf(1|f,x,p,y))}function oN(l,f){Wg(8390656,8,l,f)}function lN(l,f){Sh(2048,8,l,f)}function uN(l,f){return Sh(4,2,l,f)}function cN(l,f){return Sh(4,4,l,f)}function fN(l,f){if(typeof f=="function"){l=l();var p=f(l);return function(){typeof p=="function"?p():f(null)}}if(f!=null)return l=l(),f.current=l,function(){f.current=null}}function dN(l,f,p){p=p!=null?p.concat([l]):null,Sh(4,4,fN.bind(null,f,l),p)}function k0(){}function hN(l,f){var p=ir();f=f===void 0?null:f;var y=p.memoizedState;return f!==null&&w0(f,y[1])?y[0]:(p.memoizedState=[l,f],l)}function pN(l,f){var p=ir();f=f===void 0?null:f;var y=p.memoizedState;if(f!==null&&w0(f,y[1]))return y[0];if(y=l(),Cu){Be(!0);try{l()}finally{Be(!1)}}return p.memoizedState=[y,f],y}function N0(l,f,p){return p===void 0||(hl&1073741824)!==0?l.memoizedState=f:(l.memoizedState=p,l=yM(),Vt.lanes|=l,bl|=l,p)}function mN(l,f,p,y){return na(p,f)?p:Qc.current!==null?(l=N0(l,p,y),na(l,f)||(Ir=!0),l):(hl&42)===0?(Ir=!0,l.memoizedState=p):(l=yM(),Vt.lanes|=l,bl|=l,f)}function gN(l,f,p,y,T){var x=le.p;le.p=x!==0&&8>x?x:8;var q=ee.T,Z={};ee.T=Z,$0(l,!1,f,p);try{var ce=T(),Re=ee.S;if(Re!==null&&Re(Z,ce),ce!==null&&typeof ce=="object"&&typeof ce.then=="function"){var Fe=IG(ce,y);Th(l,f,Fe,oa(l))}else Th(l,f,y,oa(l))}catch(Ve){Th(l,f,{then:function(){},status:"rejected",reason:Ve},oa())}finally{le.p=x,ee.T=q}}function MG(){}function M0(l,f,p,y){if(l.tag!==5)throw Error(r(476));var T=yN(l).queue;gN(l,T,f,pe,p===null?MG:function(){return vN(l),p(y)})}function yN(l){var f=l.memoizedState;if(f!==null)return f;f={memoizedState:pe,baseState:pe,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:So,lastRenderedState:pe},next:null};var p={};return f.next={memoizedState:p,baseState:p,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:So,lastRenderedState:p},next:null},l.memoizedState=f,l=l.alternate,l!==null&&(l.memoizedState=f),f}function vN(l){var f=yN(l).next.queue;Th(l,f,{},oa())}function D0(){return ei(qh)}function _N(){return ir().memoizedState}function bN(){return ir().memoizedState}function DG(l){for(var f=l.return;f!==null;){switch(f.tag){case 24:case 3:var p=oa();l=fl(p);var y=dl(f,l,p);y!==null&&(la(y,f,p),vh(y,f,p)),f={cache:f0()},l.payload=f;return}f=f.return}}function $G(l,f,p){var y=oa();p={lane:y,revertLane:0,action:p,hasEagerState:!1,eagerState:null,next:null},Kg(l)?EN(f,p):(p=t0(l,f,p,y),p!==null&&(la(p,l,y),SN(p,f,y)))}function wN(l,f,p){var y=oa();Th(l,f,p,y)}function Th(l,f,p,y){var T={lane:y,revertLane:0,action:p,hasEagerState:!1,eagerState:null,next:null};if(Kg(l))EN(f,T);else{var x=l.alternate;if(l.lanes===0&&(x===null||x.lanes===0)&&(x=f.lastRenderedReducer,x!==null))try{var q=f.lastRenderedState,Z=x(q,p);if(T.hasEagerState=!0,T.eagerState=Z,na(Z,q))return Og(l,f,T,0),Pn===null&&Pg(),!1}catch{}finally{}if(p=t0(l,f,T,y),p!==null)return la(p,l,y),SN(p,f,y),!0}return!1}function $0(l,f,p,y){if(y={lane:2,revertLane:pE(),action:y,hasEagerState:!1,eagerState:null,next:null},Kg(l)){if(f)throw Error(r(479))}else f=t0(l,p,y,2),f!==null&&la(f,l,2)}function Kg(l){var f=l.alternate;return l===Vt||f!==null&&f===Vt}function EN(l,f){ef=qg=!0;var p=l.pending;p===null?f.next=f:(f.next=p.next,p.next=f),l.pending=f}function SN(l,f,p){if((p&4194048)!==0){var y=f.lanes;y&=l.pendingLanes,p|=y,f.lanes=p,Lc(l,p)}}var Jg={readContext:ei,use:zg,useCallback:Qn,useContext:Qn,useEffect:Qn,useImperativeHandle:Qn,useLayoutEffect:Qn,useInsertionEffect:Qn,useMemo:Qn,useReducer:Qn,useRef:Qn,useState:Qn,useDebugValue:Qn,useDeferredValue:Qn,useTransition:Qn,useSyncExternalStore:Qn,useId:Qn,useHostTransitionStatus:Qn,useFormState:Qn,useActionState:Qn,useOptimistic:Qn,useMemoCache:Qn,useCacheRefresh:Qn},TN={readContext:ei,use:zg,useCallback:function(l,f){return Ri().memoizedState=[l,f===void 0?null:f],l},useContext:ei,useEffect:oN,useImperativeHandle:function(l,f,p){p=p!=null?p.concat([l]):null,Wg(4194308,4,fN.bind(null,f,l),p)},useLayoutEffect:function(l,f){return Wg(4194308,4,l,f)},useInsertionEffect:function(l,f){Wg(4,2,l,f)},useMemo:function(l,f){var p=Ri();f=f===void 0?null:f;var y=l();if(Cu){Be(!0);try{l()}finally{Be(!1)}}return p.memoizedState=[y,f],y},useReducer:function(l,f,p){var y=Ri();if(p!==void 0){var T=p(f);if(Cu){Be(!0);try{p(f)}finally{Be(!1)}}}else T=f;return y.memoizedState=y.baseState=T,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:T},y.queue=l,l=l.dispatch=$G.bind(null,Vt,l),[y.memoizedState,l]},useRef:function(l){var f=Ri();return l={current:l},f.memoizedState=l},useState:function(l){l=P0(l);var f=l.queue,p=wN.bind(null,Vt,f);return f.dispatch=p,[l.memoizedState,p]},useDebugValue:k0,useDeferredValue:function(l,f){var p=Ri();return N0(p,l,f)},useTransition:function(){var l=P0(!1);return l=gN.bind(null,Vt,l.queue,!0,!1),Ri().memoizedState=l,[!1,l]},useSyncExternalStore:function(l,f,p){var y=Vt,T=Ri();if(un){if(p===void 0)throw Error(r(407));p=p()}else{if(p=f(),Pn===null)throw Error(r(349));(en&124)!==0||Hk(y,f,p)}T.memoizedState=p;var x={value:p,getSnapshot:f};return T.queue=x,oN(Wk.bind(null,y,x,l),[l]),y.flags|=2048,nf(9,Gg(),Gk.bind(null,y,x,p,f),null),p},useId:function(){var l=Ri(),f=Pn.identifierPrefix;if(un){var p=bo,y=_o;p=(y&~(1<<32-nt(y)-1)).toString(32)+p,f="«"+f+"R"+p,p=Vg++,0<p&&(f+="H"+p.toString(32)),f+="»"}else p=PG++,f="«"+f+"r"+p.toString(32)+"»";return l.memoizedState=f},useHostTransitionStatus:D0,useFormState:nN,useActionState:nN,useOptimistic:function(l){var f=Ri();f.memoizedState=f.baseState=l;var p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return f.queue=p,f=$0.bind(null,Vt,!0,p),p.dispatch=f,[l,f]},useMemoCache:x0,useCacheRefresh:function(){return Ri().memoizedState=DG.bind(null,Vt)}},AN={readContext:ei,use:zg,useCallback:hN,useContext:ei,useEffect:lN,useImperativeHandle:dN,useInsertionEffect:uN,useLayoutEffect:cN,useMemo:pN,useReducer:Hg,useRef:sN,useState:function(){return Hg(So)},useDebugValue:k0,useDeferredValue:function(l,f){var p=ir();return mN(p,bn.memoizedState,l,f)},useTransition:function(){var l=Hg(So)[0],f=ir().memoizedState;return[typeof l=="boolean"?l:Eh(l),f]},useSyncExternalStore:zk,useId:_N,useHostTransitionStatus:D0,useFormState:rN,useActionState:rN,useOptimistic:function(l,f){var p=ir();return Yk(p,bn,l,f)},useMemoCache:x0,useCacheRefresh:bN},LG={readContext:ei,use:zg,useCallback:hN,useContext:ei,useEffect:lN,useImperativeHandle:dN,useInsertionEffect:uN,useLayoutEffect:cN,useMemo:pN,useReducer:I0,useRef:sN,useState:function(){return I0(So)},useDebugValue:k0,useDeferredValue:function(l,f){var p=ir();return bn===null?N0(p,l,f):mN(p,bn.memoizedState,l,f)},useTransition:function(){var l=I0(So)[0],f=ir().memoizedState;return[typeof l=="boolean"?l:Eh(l),f]},useSyncExternalStore:zk,useId:_N,useHostTransitionStatus:D0,useFormState:aN,useActionState:aN,useOptimistic:function(l,f){var p=ir();return bn!==null?Yk(p,bn,l,f):(p.baseState=l,[l,p.queue.dispatch])},useMemoCache:x0,useCacheRefresh:bN},rf=null,Ah=0;function Yg(l){var f=Ah;return Ah+=1,rf===null&&(rf=[]),$k(rf,l,f)}function Ch(l,f){f=f.props.ref,l.ref=f!==void 0?f:null}function Zg(l,f){throw f.$$typeof===h?Error(r(525)):(l=Object.prototype.toString.call(f),Error(r(31,l==="[object Object]"?"object with keys {"+Object.keys(f).join(", ")+"}":l)))}function CN(l){var f=l._init;return f(l._payload)}function xN(l){function f(be,ye){if(l){var xe=be.deletions;xe===null?(be.deletions=[ye],be.flags|=16):xe.push(ye)}}function p(be,ye){if(!l)return null;for(;ye!==null;)f(be,ye),ye=ye.sibling;return null}function y(be){for(var ye=new Map;be!==null;)be.key!==null?ye.set(be.key,be):ye.set(be.index,be),be=be.sibling;return ye}function T(be,ye){return be=vo(be,ye),be.index=0,be.sibling=null,be}function x(be,ye,xe){return be.index=xe,l?(xe=be.alternate,xe!==null?(xe=xe.index,xe<ye?(be.flags|=67108866,ye):xe):(be.flags|=67108866,ye)):(be.flags|=1048576,ye)}function q(be){return l&&be.alternate===null&&(be.flags|=67108866),be}function Z(be,ye,xe,qe){return ye===null||ye.tag!==6?(ye=r0(xe,be.mode,qe),ye.return=be,ye):(ye=T(ye,xe),ye.return=be,ye)}function ce(be,ye,xe,qe){var ut=xe.type;return ut===_?Fe(be,ye,xe.props.children,qe,xe.key):ye!==null&&(ye.elementType===ut||typeof ut=="object"&&ut!==null&&ut.$$typeof===k&&CN(ut)===ye.type)?(ye=T(ye,xe.props),Ch(ye,xe),ye.return=be,ye):(ye=Ng(xe.type,xe.key,xe.props,null,be.mode,qe),Ch(ye,xe),ye.return=be,ye)}function Re(be,ye,xe,qe){return ye===null||ye.tag!==4||ye.stateNode.containerInfo!==xe.containerInfo||ye.stateNode.implementation!==xe.implementation?(ye=i0(xe,be.mode,qe),ye.return=be,ye):(ye=T(ye,xe.children||[]),ye.return=be,ye)}function Fe(be,ye,xe,qe,ut){return ye===null||ye.tag!==7?(ye=vu(xe,be.mode,qe,ut),ye.return=be,ye):(ye=T(ye,xe),ye.return=be,ye)}function Ve(be,ye,xe){if(typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint")return ye=r0(""+ye,be.mode,xe),ye.return=be,ye;if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case m:return xe=Ng(ye.type,ye.key,ye.props,null,be.mode,xe),Ch(xe,ye),xe.return=be,xe;case g:return ye=i0(ye,be.mode,xe),ye.return=be,ye;case k:var qe=ye._init;return ye=qe(ye._payload),Ve(be,ye,xe)}if(se(ye)||z(ye))return ye=vu(ye,be.mode,xe,null),ye.return=be,ye;if(typeof ye.then=="function")return Ve(be,Yg(ye),xe);if(ye.$$typeof===A)return Ve(be,Lg(be,ye),xe);Zg(be,ye)}return null}function ke(be,ye,xe,qe){var ut=ye!==null?ye.key:null;if(typeof xe=="string"&&xe!==""||typeof xe=="number"||typeof xe=="bigint")return ut!==null?null:Z(be,ye,""+xe,qe);if(typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case m:return xe.key===ut?ce(be,ye,xe,qe):null;case g:return xe.key===ut?Re(be,ye,xe,qe):null;case k:return ut=xe._init,xe=ut(xe._payload),ke(be,ye,xe,qe)}if(se(xe)||z(xe))return ut!==null?null:Fe(be,ye,xe,qe,null);if(typeof xe.then=="function")return ke(be,ye,Yg(xe),qe);if(xe.$$typeof===A)return ke(be,ye,Lg(be,xe),qe);Zg(be,xe)}return null}function De(be,ye,xe,qe,ut){if(typeof qe=="string"&&qe!==""||typeof qe=="number"||typeof qe=="bigint")return be=be.get(xe)||null,Z(ye,be,""+qe,ut);if(typeof qe=="object"&&qe!==null){switch(qe.$$typeof){case m:return be=be.get(qe.key===null?xe:qe.key)||null,ce(ye,be,qe,ut);case g:return be=be.get(qe.key===null?xe:qe.key)||null,Re(ye,be,qe,ut);case k:var zt=qe._init;return qe=zt(qe._payload),De(be,ye,xe,qe,ut)}if(se(qe)||z(qe))return be=be.get(xe)||null,Fe(ye,be,qe,ut,null);if(typeof qe.then=="function")return De(be,ye,xe,Yg(qe),ut);if(qe.$$typeof===A)return De(be,ye,xe,Lg(ye,qe),ut);Zg(ye,qe)}return null}function Et(be,ye,xe,qe){for(var ut=null,zt=null,pt=ye,bt=ye=0,Or=null;pt!==null&&bt<xe.length;bt++){pt.index>bt?(Or=pt,pt=null):Or=pt.sibling;var nn=ke(be,pt,xe[bt],qe);if(nn===null){pt===null&&(pt=Or);break}l&&pt&&nn.alternate===null&&f(be,pt),ye=x(nn,ye,bt),zt===null?ut=nn:zt.sibling=nn,zt=nn,pt=Or}if(bt===xe.length)return p(be,pt),un&&bu(be,bt),ut;if(pt===null){for(;bt<xe.length;bt++)pt=Ve(be,xe[bt],qe),pt!==null&&(ye=x(pt,ye,bt),zt===null?ut=pt:zt.sibling=pt,zt=pt);return un&&bu(be,bt),ut}for(pt=y(pt);bt<xe.length;bt++)Or=De(pt,be,bt,xe[bt],qe),Or!==null&&(l&&Or.alternate!==null&&pt.delete(Or.key===null?bt:Or.key),ye=x(Or,ye,bt),zt===null?ut=Or:zt.sibling=Or,zt=Or);return l&&pt.forEach(function(Il){return f(be,Il)}),un&&bu(be,bt),ut}function _t(be,ye,xe,qe){if(xe==null)throw Error(r(151));for(var ut=null,zt=null,pt=ye,bt=ye=0,Or=null,nn=xe.next();pt!==null&&!nn.done;bt++,nn=xe.next()){pt.index>bt?(Or=pt,pt=null):Or=pt.sibling;var Il=ke(be,pt,nn.value,qe);if(Il===null){pt===null&&(pt=Or);break}l&&pt&&Il.alternate===null&&f(be,pt),ye=x(Il,ye,bt),zt===null?ut=Il:zt.sibling=Il,zt=Il,pt=Or}if(nn.done)return p(be,pt),un&&bu(be,bt),ut;if(pt===null){for(;!nn.done;bt++,nn=xe.next())nn=Ve(be,nn.value,qe),nn!==null&&(ye=x(nn,ye,bt),zt===null?ut=nn:zt.sibling=nn,zt=nn);return un&&bu(be,bt),ut}for(pt=y(pt);!nn.done;bt++,nn=xe.next())nn=De(pt,be,bt,nn.value,qe),nn!==null&&(l&&nn.alternate!==null&&pt.delete(nn.key===null?bt:nn.key),ye=x(nn,ye,bt),zt===null?ut=nn:zt.sibling=nn,zt=nn);return l&&pt.forEach(function(U7){return f(be,U7)}),un&&bu(be,bt),ut}function En(be,ye,xe,qe){if(typeof xe=="object"&&xe!==null&&xe.type===_&&xe.key===null&&(xe=xe.props.children),typeof xe=="object"&&xe!==null){switch(xe.$$typeof){case m:e:{for(var ut=xe.key;ye!==null;){if(ye.key===ut){if(ut=xe.type,ut===_){if(ye.tag===7){p(be,ye.sibling),qe=T(ye,xe.props.children),qe.return=be,be=qe;break e}}else if(ye.elementType===ut||typeof ut=="object"&&ut!==null&&ut.$$typeof===k&&CN(ut)===ye.type){p(be,ye.sibling),qe=T(ye,xe.props),Ch(qe,xe),qe.return=be,be=qe;break e}p(be,ye);break}else f(be,ye);ye=ye.sibling}xe.type===_?(qe=vu(xe.props.children,be.mode,qe,xe.key),qe.return=be,be=qe):(qe=Ng(xe.type,xe.key,xe.props,null,be.mode,qe),Ch(qe,xe),qe.return=be,be=qe)}return q(be);case g:e:{for(ut=xe.key;ye!==null;){if(ye.key===ut)if(ye.tag===4&&ye.stateNode.containerInfo===xe.containerInfo&&ye.stateNode.implementation===xe.implementation){p(be,ye.sibling),qe=T(ye,xe.children||[]),qe.return=be,be=qe;break e}else{p(be,ye);break}else f(be,ye);ye=ye.sibling}qe=i0(xe,be.mode,qe),qe.return=be,be=qe}return q(be);case k:return ut=xe._init,xe=ut(xe._payload),En(be,ye,xe,qe)}if(se(xe))return Et(be,ye,xe,qe);if(z(xe)){if(ut=z(xe),typeof ut!="function")throw Error(r(150));return xe=ut.call(xe),_t(be,ye,xe,qe)}if(typeof xe.then=="function")return En(be,ye,Yg(xe),qe);if(xe.$$typeof===A)return En(be,ye,Lg(be,xe),qe);Zg(be,xe)}return typeof xe=="string"&&xe!==""||typeof xe=="number"||typeof xe=="bigint"?(xe=""+xe,ye!==null&&ye.tag===6?(p(be,ye.sibling),qe=T(ye,xe),qe.return=be,be=qe):(p(be,ye),qe=r0(xe,be.mode,qe),qe.return=be,be=qe),q(be)):p(be,ye)}return function(be,ye,xe,qe){try{Ah=0;var ut=En(be,ye,xe,qe);return rf=null,ut}catch(pt){if(pt===gh||pt===jg)throw pt;var zt=ra(29,pt,null,be.mode);return zt.lanes=qe,zt.return=be,zt}finally{}}}var af=xN(!0),RN=xN(!1),ka=ve(null),$s=null;function pl(l){var f=l.alternate;F(gr,gr.current&1),F(ka,l),$s===null&&(f===null||Qc.current!==null||f.memoizedState!==null)&&($s=l)}function IN(l){if(l.tag===22){if(F(gr,gr.current),F(ka,l),$s===null){var f=l.alternate;f!==null&&f.memoizedState!==null&&($s=l)}}else ml()}function ml(){F(gr,gr.current),F(ka,ka.current)}function To(l){Te(ka),$s===l&&($s=null),Te(gr)}var gr=ve(0);function Xg(l){for(var f=l;f!==null;){if(f.tag===13){var p=f.memoizedState;if(p!==null&&(p=p.dehydrated,p===null||p.data==="$?"||CE(p)))return f}else if(f.tag===19&&f.memoizedProps.revealOrder!==void 0){if((f.flags&128)!==0)return f}else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===l)break;for(;f.sibling===null;){if(f.return===null||f.return===l)return null;f=f.return}f.sibling.return=f.return,f=f.sibling}return null}function L0(l,f,p,y){f=l.memoizedState,p=p(y,f),p=p==null?f:d({},f,p),l.memoizedState=p,l.lanes===0&&(l.updateQueue.baseState=p)}var U0={enqueueSetState:function(l,f,p){l=l._reactInternals;var y=oa(),T=fl(y);T.payload=f,p!=null&&(T.callback=p),f=dl(l,T,y),f!==null&&(la(f,l,y),vh(f,l,y))},enqueueReplaceState:function(l,f,p){l=l._reactInternals;var y=oa(),T=fl(y);T.tag=1,T.payload=f,p!=null&&(T.callback=p),f=dl(l,T,y),f!==null&&(la(f,l,y),vh(f,l,y))},enqueueForceUpdate:function(l,f){l=l._reactInternals;var p=oa(),y=fl(p);y.tag=2,f!=null&&(y.callback=f),f=dl(l,y,p),f!==null&&(la(f,l,p),vh(f,l,p))}};function PN(l,f,p,y,T,x,q){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(y,x,q):f.prototype&&f.prototype.isPureReactComponent?!lh(p,y)||!lh(T,x):!0}function ON(l,f,p,y){l=f.state,typeof f.componentWillReceiveProps=="function"&&f.componentWillReceiveProps(p,y),typeof f.UNSAFE_componentWillReceiveProps=="function"&&f.UNSAFE_componentWillReceiveProps(p,y),f.state!==l&&U0.enqueueReplaceState(f,f.state,null)}function xu(l,f){var p=f;if("ref"in f){p={};for(var y in f)y!=="ref"&&(p[y]=f[y])}if(l=l.defaultProps){p===f&&(p=d({},p));for(var T in l)p[T]===void 0&&(p[T]=l[T])}return p}var Qg=typeof reportError=="function"?reportError:function(l){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var f=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof l=="object"&&l!==null&&typeof l.message=="string"?String(l.message):String(l),error:l});if(!window.dispatchEvent(f))return}else if(typeof ot=="object"&&typeof ot.emit=="function"){ot.emit("uncaughtException",l);return}console.error(l)};function kN(l){Qg(l)}function NN(l){console.error(l)}function MN(l){Qg(l)}function ey(l,f){try{var p=l.onUncaughtError;p(f.value,{componentStack:f.stack})}catch(y){setTimeout(function(){throw y})}}function DN(l,f,p){try{var y=l.onCaughtError;y(p.value,{componentStack:p.stack,errorBoundary:f.tag===1?f.stateNode:null})}catch(T){setTimeout(function(){throw T})}}function j0(l,f,p){return p=fl(p),p.tag=3,p.payload={element:null},p.callback=function(){ey(l,f)},p}function $N(l){return l=fl(l),l.tag=3,l}function LN(l,f,p,y){var T=p.type.getDerivedStateFromError;if(typeof T=="function"){var x=y.value;l.payload=function(){return T(x)},l.callback=function(){DN(f,p,y)}}var q=p.stateNode;q!==null&&typeof q.componentDidCatch=="function"&&(l.callback=function(){DN(f,p,y),typeof T!="function"&&(wl===null?wl=new Set([this]):wl.add(this));var Z=y.stack;this.componentDidCatch(y.value,{componentStack:Z!==null?Z:""})})}function UG(l,f,p,y,T){if(p.flags|=32768,y!==null&&typeof y=="object"&&typeof y.then=="function"){if(f=p.alternate,f!==null&&hh(f,p,T,!0),p=ka.current,p!==null){switch(p.tag){case 13:return $s===null?uE():p.alternate===null&&Kn===0&&(Kn=3),p.flags&=-257,p.flags|=65536,p.lanes=T,y===p0?p.flags|=16384:(f=p.updateQueue,f===null?p.updateQueue=new Set([y]):f.add(y),fE(l,y,T)),!1;case 22:return p.flags|=65536,y===p0?p.flags|=16384:(f=p.updateQueue,f===null?(f={transitions:null,markerInstances:null,retryQueue:new Set([y])},p.updateQueue=f):(p=f.retryQueue,p===null?f.retryQueue=new Set([y]):p.add(y)),fE(l,y,T)),!1}throw Error(r(435,p.tag))}return fE(l,y,T),uE(),!1}if(un)return f=ka.current,f!==null?((f.flags&65536)===0&&(f.flags|=256),f.flags|=65536,f.lanes=T,y!==o0&&(l=Error(r(422),{cause:y}),dh(Ra(l,p)))):(y!==o0&&(f=Error(r(423),{cause:y}),dh(Ra(f,p))),l=l.current.alternate,l.flags|=65536,T&=-T,l.lanes|=T,y=Ra(y,p),T=j0(l.stateNode,y,T),y0(l,T),Kn!==4&&(Kn=2)),!1;var x=Error(r(520),{cause:y});if(x=Ra(x,p),Nh===null?Nh=[x]:Nh.push(x),Kn!==4&&(Kn=2),f===null)return!0;y=Ra(y,p),p=f;do{switch(p.tag){case 3:return p.flags|=65536,l=T&-T,p.lanes|=l,l=j0(p.stateNode,y,l),y0(p,l),!1;case 1:if(f=p.type,x=p.stateNode,(p.flags&128)===0&&(typeof f.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(wl===null||!wl.has(x))))return p.flags|=65536,T&=-T,p.lanes|=T,T=$N(T),LN(T,l,p,y),y0(p,T),!1}p=p.return}while(p!==null);return!1}var UN=Error(r(461)),Ir=!1;function jr(l,f,p,y){f.child=l===null?RN(f,null,p,y):af(f,l.child,p,y)}function jN(l,f,p,y,T){p=p.render;var x=f.ref;if("ref"in y){var q={};for(var Z in y)Z!=="ref"&&(q[Z]=y[Z])}else q=y;return Tu(f),y=E0(l,f,p,q,x,T),Z=S0(),l!==null&&!Ir?(T0(l,f,T),Ao(l,f,T)):(un&&Z&&a0(f),f.flags|=1,jr(l,f,y,T),f.child)}function FN(l,f,p,y,T){if(l===null){var x=p.type;return typeof x=="function"&&!n0(x)&&x.defaultProps===void 0&&p.compare===null?(f.tag=15,f.type=x,BN(l,f,x,y,T)):(l=Ng(p.type,null,y,f,f.mode,T),l.ref=f.ref,l.return=f,f.child=l)}if(x=l.child,!W0(l,T)){var q=x.memoizedProps;if(p=p.compare,p=p!==null?p:lh,p(q,y)&&l.ref===f.ref)return Ao(l,f,T)}return f.flags|=1,l=vo(x,y),l.ref=f.ref,l.return=f,f.child=l}function BN(l,f,p,y,T){if(l!==null){var x=l.memoizedProps;if(lh(x,y)&&l.ref===f.ref)if(Ir=!1,f.pendingProps=y=x,W0(l,T))(l.flags&131072)!==0&&(Ir=!0);else return f.lanes=l.lanes,Ao(l,f,T)}return F0(l,f,p,y,T)}function qN(l,f,p){var y=f.pendingProps,T=y.children,x=l!==null?l.memoizedState:null;if(y.mode==="hidden"){if((f.flags&128)!==0){if(y=x!==null?x.baseLanes|p:p,l!==null){for(T=f.child=l.child,x=0;T!==null;)x=x|T.lanes|T.childLanes,T=T.sibling;f.childLanes=x&~y}else f.childLanes=0,f.child=null;return VN(l,f,y,p)}if((p&536870912)!==0)f.memoizedState={baseLanes:0,cachePool:null},l!==null&&Ug(f,x!==null?x.cachePool:null),x!==null?Bk(f,x):_0(),IN(f);else return f.lanes=f.childLanes=536870912,VN(l,f,x!==null?x.baseLanes|p:p,p)}else x!==null?(Ug(f,x.cachePool),Bk(f,x),ml(),f.memoizedState=null):(l!==null&&Ug(f,null),_0(),ml());return jr(l,f,T,p),f.child}function VN(l,f,p,y){var T=h0();return T=T===null?null:{parent:mr._currentValue,pool:T},f.memoizedState={baseLanes:p,cachePool:T},l!==null&&Ug(f,null),_0(),IN(f),l!==null&&hh(l,f,y,!0),null}function ty(l,f){var p=f.ref;if(p===null)l!==null&&l.ref!==null&&(f.flags|=4194816);else{if(typeof p!="function"&&typeof p!="object")throw Error(r(284));(l===null||l.ref!==p)&&(f.flags|=4194816)}}function F0(l,f,p,y,T){return Tu(f),p=E0(l,f,p,y,void 0,T),y=S0(),l!==null&&!Ir?(T0(l,f,T),Ao(l,f,T)):(un&&y&&a0(f),f.flags|=1,jr(l,f,p,T),f.child)}function zN(l,f,p,y,T,x){return Tu(f),f.updateQueue=null,p=Vk(f,y,p,T),qk(l),y=S0(),l!==null&&!Ir?(T0(l,f,x),Ao(l,f,x)):(un&&y&&a0(f),f.flags|=1,jr(l,f,p,x),f.child)}function HN(l,f,p,y,T){if(Tu(f),f.stateNode===null){var x=Kc,q=p.contextType;typeof q=="object"&&q!==null&&(x=ei(q)),x=new p(y,x),f.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=U0,f.stateNode=x,x._reactInternals=f,x=f.stateNode,x.props=y,x.state=f.memoizedState,x.refs={},m0(f),q=p.contextType,x.context=typeof q=="object"&&q!==null?ei(q):Kc,x.state=f.memoizedState,q=p.getDerivedStateFromProps,typeof q=="function"&&(L0(f,p,q,y),x.state=f.memoizedState),typeof p.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(q=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),q!==x.state&&U0.enqueueReplaceState(x,x.state,null),bh(f,y,x,T),_h(),x.state=f.memoizedState),typeof x.componentDidMount=="function"&&(f.flags|=4194308),y=!0}else if(l===null){x=f.stateNode;var Z=f.memoizedProps,ce=xu(p,Z);x.props=ce;var Re=x.context,Fe=p.contextType;q=Kc,typeof Fe=="object"&&Fe!==null&&(q=ei(Fe));var Ve=p.getDerivedStateFromProps;Fe=typeof Ve=="function"||typeof x.getSnapshotBeforeUpdate=="function",Z=f.pendingProps!==Z,Fe||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(Z||Re!==q)&&ON(f,x,y,q),cl=!1;var ke=f.memoizedState;x.state=ke,bh(f,y,x,T),_h(),Re=f.memoizedState,Z||ke!==Re||cl?(typeof Ve=="function"&&(L0(f,p,Ve,y),Re=f.memoizedState),(ce=cl||PN(f,p,ce,y,ke,Re,q))?(Fe||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(f.flags|=4194308)):(typeof x.componentDidMount=="function"&&(f.flags|=4194308),f.memoizedProps=y,f.memoizedState=Re),x.props=y,x.state=Re,x.context=q,y=ce):(typeof x.componentDidMount=="function"&&(f.flags|=4194308),y=!1)}else{x=f.stateNode,g0(l,f),q=f.memoizedProps,Fe=xu(p,q),x.props=Fe,Ve=f.pendingProps,ke=x.context,Re=p.contextType,ce=Kc,typeof Re=="object"&&Re!==null&&(ce=ei(Re)),Z=p.getDerivedStateFromProps,(Re=typeof Z=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(q!==Ve||ke!==ce)&&ON(f,x,y,ce),cl=!1,ke=f.memoizedState,x.state=ke,bh(f,y,x,T),_h();var De=f.memoizedState;q!==Ve||ke!==De||cl||l!==null&&l.dependencies!==null&&$g(l.dependencies)?(typeof Z=="function"&&(L0(f,p,Z,y),De=f.memoizedState),(Fe=cl||PN(f,p,Fe,y,ke,De,ce)||l!==null&&l.dependencies!==null&&$g(l.dependencies))?(Re||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(y,De,ce),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(y,De,ce)),typeof x.componentDidUpdate=="function"&&(f.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(f.flags|=1024)):(typeof x.componentDidUpdate!="function"||q===l.memoizedProps&&ke===l.memoizedState||(f.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||q===l.memoizedProps&&ke===l.memoizedState||(f.flags|=1024),f.memoizedProps=y,f.memoizedState=De),x.props=y,x.state=De,x.context=ce,y=Fe):(typeof x.componentDidUpdate!="function"||q===l.memoizedProps&&ke===l.memoizedState||(f.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||q===l.memoizedProps&&ke===l.memoizedState||(f.flags|=1024),y=!1)}return x=y,ty(l,f),y=(f.flags&128)!==0,x||y?(x=f.stateNode,p=y&&typeof p.getDerivedStateFromError!="function"?null:x.render(),f.flags|=1,l!==null&&y?(f.child=af(f,l.child,null,T),f.child=af(f,null,p,T)):jr(l,f,p,T),f.memoizedState=x.state,l=f.child):l=Ao(l,f,T),l}function GN(l,f,p,y){return fh(),f.flags|=256,jr(l,f,p,y),f.child}var B0={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function q0(l){return{baseLanes:l,cachePool:Nk()}}function V0(l,f,p){return l=l!==null?l.childLanes&~p:0,f&&(l|=Na),l}function WN(l,f,p){var y=f.pendingProps,T=!1,x=(f.flags&128)!==0,q;if((q=x)||(q=l!==null&&l.memoizedState===null?!1:(gr.current&2)!==0),q&&(T=!0,f.flags&=-129),q=(f.flags&32)!==0,f.flags&=-33,l===null){if(un){if(T?pl(f):ml(),un){var Z=Wn,ce;if(ce=Z){e:{for(ce=Z,Z=Ds;ce.nodeType!==8;){if(!Z){Z=null;break e}if(ce=ss(ce.nextSibling),ce===null){Z=null;break e}}Z=ce}Z!==null?(f.memoizedState={dehydrated:Z,treeContext:_u!==null?{id:_o,overflow:bo}:null,retryLane:536870912,hydrationErrors:null},ce=ra(18,null,null,0),ce.stateNode=Z,ce.return=f,f.child=ce,hi=f,Wn=null,ce=!0):ce=!1}ce||Eu(f)}if(Z=f.memoizedState,Z!==null&&(Z=Z.dehydrated,Z!==null))return CE(Z)?f.lanes=32:f.lanes=536870912,null;To(f)}return Z=y.children,y=y.fallback,T?(ml(),T=f.mode,Z=ny({mode:"hidden",children:Z},T),y=vu(y,T,p,null),Z.return=f,y.return=f,Z.sibling=y,f.child=Z,T=f.child,T.memoizedState=q0(p),T.childLanes=V0(l,q,p),f.memoizedState=B0,y):(pl(f),z0(f,Z))}if(ce=l.memoizedState,ce!==null&&(Z=ce.dehydrated,Z!==null)){if(x)f.flags&256?(pl(f),f.flags&=-257,f=H0(l,f,p)):f.memoizedState!==null?(ml(),f.child=l.child,f.flags|=128,f=null):(ml(),T=y.fallback,Z=f.mode,y=ny({mode:"visible",children:y.children},Z),T=vu(T,Z,p,null),T.flags|=2,y.return=f,T.return=f,y.sibling=T,f.child=y,af(f,l.child,null,p),y=f.child,y.memoizedState=q0(p),y.childLanes=V0(l,q,p),f.memoizedState=B0,f=T);else if(pl(f),CE(Z)){if(q=Z.nextSibling&&Z.nextSibling.dataset,q)var Re=q.dgst;q=Re,y=Error(r(419)),y.stack="",y.digest=q,dh({value:y,source:null,stack:null}),f=H0(l,f,p)}else if(Ir||hh(l,f,p,!1),q=(p&l.childLanes)!==0,Ir||q){if(q=Pn,q!==null&&(y=p&-p,y=(y&42)!==0?1:fi(y),y=(y&(q.suspendedLanes|p))!==0?0:y,y!==0&&y!==ce.retryLane))throw ce.retryLane=y,Wc(l,y),la(q,l,y),UN;Z.data==="$?"||uE(),f=H0(l,f,p)}else Z.data==="$?"?(f.flags|=192,f.child=l.child,f=null):(l=ce.treeContext,Wn=ss(Z.nextSibling),hi=f,un=!0,wu=null,Ds=!1,l!==null&&(Pa[Oa++]=_o,Pa[Oa++]=bo,Pa[Oa++]=_u,_o=l.id,bo=l.overflow,_u=f),f=z0(f,y.children),f.flags|=4096);return f}return T?(ml(),T=y.fallback,Z=f.mode,ce=l.child,Re=ce.sibling,y=vo(ce,{mode:"hidden",children:y.children}),y.subtreeFlags=ce.subtreeFlags&65011712,Re!==null?T=vo(Re,T):(T=vu(T,Z,p,null),T.flags|=2),T.return=f,y.return=f,y.sibling=T,f.child=y,y=T,T=f.child,Z=l.child.memoizedState,Z===null?Z=q0(p):(ce=Z.cachePool,ce!==null?(Re=mr._currentValue,ce=ce.parent!==Re?{parent:Re,pool:Re}:ce):ce=Nk(),Z={baseLanes:Z.baseLanes|p,cachePool:ce}),T.memoizedState=Z,T.childLanes=V0(l,q,p),f.memoizedState=B0,y):(pl(f),p=l.child,l=p.sibling,p=vo(p,{mode:"visible",children:y.children}),p.return=f,p.sibling=null,l!==null&&(q=f.deletions,q===null?(f.deletions=[l],f.flags|=16):q.push(l)),f.child=p,f.memoizedState=null,p)}function z0(l,f){return f=ny({mode:"visible",children:f},l.mode),f.return=l,l.child=f}function ny(l,f){return l=ra(22,l,null,f),l.lanes=0,l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},l}function H0(l,f,p){return af(f,l.child,null,p),l=z0(f,f.pendingProps.children),l.flags|=2,f.memoizedState=null,l}function KN(l,f,p){l.lanes|=f;var y=l.alternate;y!==null&&(y.lanes|=f),u0(l.return,f,p)}function G0(l,f,p,y,T){var x=l.memoizedState;x===null?l.memoizedState={isBackwards:f,rendering:null,renderingStartTime:0,last:y,tail:p,tailMode:T}:(x.isBackwards=f,x.rendering=null,x.renderingStartTime=0,x.last=y,x.tail=p,x.tailMode=T)}function JN(l,f,p){var y=f.pendingProps,T=y.revealOrder,x=y.tail;if(jr(l,f,y.children,p),y=gr.current,(y&2)!==0)y=y&1|2,f.flags|=128;else{if(l!==null&&(l.flags&128)!==0)e:for(l=f.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&KN(l,p,f);else if(l.tag===19)KN(l,p,f);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===f)break e;for(;l.sibling===null;){if(l.return===null||l.return===f)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}y&=1}switch(F(gr,y),T){case"forwards":for(p=f.child,T=null;p!==null;)l=p.alternate,l!==null&&Xg(l)===null&&(T=p),p=p.sibling;p=T,p===null?(T=f.child,f.child=null):(T=p.sibling,p.sibling=null),G0(f,!1,T,p,x);break;case"backwards":for(p=null,T=f.child,f.child=null;T!==null;){if(l=T.alternate,l!==null&&Xg(l)===null){f.child=T;break}l=T.sibling,T.sibling=p,p=T,T=l}G0(f,!0,p,null,x);break;case"together":G0(f,!1,null,null,void 0);break;default:f.memoizedState=null}return f.child}function Ao(l,f,p){if(l!==null&&(f.dependencies=l.dependencies),bl|=f.lanes,(p&f.childLanes)===0)if(l!==null){if(hh(l,f,p,!1),(p&f.childLanes)===0)return null}else return null;if(l!==null&&f.child!==l.child)throw Error(r(153));if(f.child!==null){for(l=f.child,p=vo(l,l.pendingProps),f.child=p,p.return=f;l.sibling!==null;)l=l.sibling,p=p.sibling=vo(l,l.pendingProps),p.return=f;p.sibling=null}return f.child}function W0(l,f){return(l.lanes&f)!==0?!0:(l=l.dependencies,!!(l!==null&&$g(l)))}function jG(l,f,p){switch(f.tag){case 3:J(f,f.stateNode.containerInfo),ul(f,mr,l.memoizedState.cache),fh();break;case 27:case 5:ue(f);break;case 4:J(f,f.stateNode.containerInfo);break;case 10:ul(f,f.type,f.memoizedProps.value);break;case 13:var y=f.memoizedState;if(y!==null)return y.dehydrated!==null?(pl(f),f.flags|=128,null):(p&f.child.childLanes)!==0?WN(l,f,p):(pl(f),l=Ao(l,f,p),l!==null?l.sibling:null);pl(f);break;case 19:var T=(l.flags&128)!==0;if(y=(p&f.childLanes)!==0,y||(hh(l,f,p,!1),y=(p&f.childLanes)!==0),T){if(y)return JN(l,f,p);f.flags|=128}if(T=f.memoizedState,T!==null&&(T.rendering=null,T.tail=null,T.lastEffect=null),F(gr,gr.current),y)break;return null;case 22:case 23:return f.lanes=0,qN(l,f,p);case 24:ul(f,mr,l.memoizedState.cache)}return Ao(l,f,p)}function YN(l,f,p){if(l!==null)if(l.memoizedProps!==f.pendingProps)Ir=!0;else{if(!W0(l,p)&&(f.flags&128)===0)return Ir=!1,jG(l,f,p);Ir=(l.flags&131072)!==0}else Ir=!1,un&&(f.flags&1048576)!==0&&Ck(f,Dg,f.index);switch(f.lanes=0,f.tag){case 16:e:{l=f.pendingProps;var y=f.elementType,T=y._init;if(y=T(y._payload),f.type=y,typeof y=="function")n0(y)?(l=xu(y,l),f.tag=1,f=HN(null,f,y,l,p)):(f.tag=0,f=F0(null,f,y,l,p));else{if(y!=null){if(T=y.$$typeof,T===R){f.tag=11,f=jN(null,f,y,l,p);break e}else if(T===U){f.tag=14,f=FN(null,f,y,l,p);break e}}throw f=te(y)||y,Error(r(306,f,""))}}return f;case 0:return F0(l,f,f.type,f.pendingProps,p);case 1:return y=f.type,T=xu(y,f.pendingProps),HN(l,f,y,T,p);case 3:e:{if(J(f,f.stateNode.containerInfo),l===null)throw Error(r(387));y=f.pendingProps;var x=f.memoizedState;T=x.element,g0(l,f),bh(f,y,null,p);var q=f.memoizedState;if(y=q.cache,ul(f,mr,y),y!==x.cache&&c0(f,[mr],p,!0),_h(),y=q.element,x.isDehydrated)if(x={element:y,isDehydrated:!1,cache:q.cache},f.updateQueue.baseState=x,f.memoizedState=x,f.flags&256){f=GN(l,f,y,p);break e}else if(y!==T){T=Ra(Error(r(424)),f),dh(T),f=GN(l,f,y,p);break e}else{switch(l=f.stateNode.containerInfo,l.nodeType){case 9:l=l.body;break;default:l=l.nodeName==="HTML"?l.ownerDocument.body:l}for(Wn=ss(l.firstChild),hi=f,un=!0,wu=null,Ds=!0,p=RN(f,null,y,p),f.child=p;p;)p.flags=p.flags&-3|4096,p=p.sibling}else{if(fh(),y===T){f=Ao(l,f,p);break e}jr(l,f,y,p)}f=f.child}return f;case 26:return ty(l,f),l===null?(p=eD(f.type,null,f.pendingProps,null))?f.memoizedState=p:un||(p=f.type,l=f.pendingProps,y=gy(I.current).createElement(p),y[ie]=f,y[ge]=l,Br(y,p,l),gt(y),f.stateNode=y):f.memoizedState=eD(f.type,l.memoizedProps,f.pendingProps,l.memoizedState),null;case 27:return ue(f),l===null&&un&&(y=f.stateNode=ZM(f.type,f.pendingProps,I.current),hi=f,Ds=!0,T=Wn,Tl(f.type)?(xE=T,Wn=ss(y.firstChild)):Wn=T),jr(l,f,f.pendingProps.children,p),ty(l,f),l===null&&(f.flags|=4194304),f.child;case 5:return l===null&&un&&((T=y=Wn)&&(y=h7(y,f.type,f.pendingProps,Ds),y!==null?(f.stateNode=y,hi=f,Wn=ss(y.firstChild),Ds=!1,T=!0):T=!1),T||Eu(f)),ue(f),T=f.type,x=f.pendingProps,q=l!==null?l.memoizedProps:null,y=x.children,SE(T,x)?y=null:q!==null&&SE(T,q)&&(f.flags|=32),f.memoizedState!==null&&(T=E0(l,f,OG,null,null,p),qh._currentValue=T),ty(l,f),jr(l,f,y,p),f.child;case 6:return l===null&&un&&((l=p=Wn)&&(p=p7(p,f.pendingProps,Ds),p!==null?(f.stateNode=p,hi=f,Wn=null,l=!0):l=!1),l||Eu(f)),null;case 13:return WN(l,f,p);case 4:return J(f,f.stateNode.containerInfo),y=f.pendingProps,l===null?f.child=af(f,null,y,p):jr(l,f,y,p),f.child;case 11:return jN(l,f,f.type,f.pendingProps,p);case 7:return jr(l,f,f.pendingProps,p),f.child;case 8:return jr(l,f,f.pendingProps.children,p),f.child;case 12:return jr(l,f,f.pendingProps.children,p),f.child;case 10:return y=f.pendingProps,ul(f,f.type,y.value),jr(l,f,y.children,p),f.child;case 9:return T=f.type._context,y=f.pendingProps.children,Tu(f),T=ei(T),y=y(T),f.flags|=1,jr(l,f,y,p),f.child;case 14:return FN(l,f,f.type,f.pendingProps,p);case 15:return BN(l,f,f.type,f.pendingProps,p);case 19:return JN(l,f,p);case 31:return y=f.pendingProps,p=f.mode,y={mode:y.mode,children:y.children},l===null?(p=ny(y,p),p.ref=f.ref,f.child=p,p.return=f,f=p):(p=vo(l.child,y),p.ref=f.ref,f.child=p,p.return=f,f=p),f;case 22:return qN(l,f,p);case 24:return Tu(f),y=ei(mr),l===null?(T=h0(),T===null&&(T=Pn,x=f0(),T.pooledCache=x,x.refCount++,x!==null&&(T.pooledCacheLanes|=p),T=x),f.memoizedState={parent:y,cache:T},m0(f),ul(f,mr,T)):((l.lanes&p)!==0&&(g0(l,f),bh(f,null,null,p),_h()),T=l.memoizedState,x=f.memoizedState,T.parent!==y?(T={parent:y,cache:y},f.memoizedState=T,f.lanes===0&&(f.memoizedState=f.updateQueue.baseState=T),ul(f,mr,y)):(y=x.cache,ul(f,mr,y),y!==T.cache&&c0(f,[mr],p,!0))),jr(l,f,f.pendingProps.children,p),f.child;case 29:throw f.pendingProps}throw Error(r(156,f.tag))}function Co(l){l.flags|=4}function ZN(l,f){if(f.type!=="stylesheet"||(f.state.loading&4)!==0)l.flags&=-16777217;else if(l.flags|=16777216,!aD(f)){if(f=ka.current,f!==null&&((en&4194048)===en?$s!==null:(en&62914560)!==en&&(en&536870912)===0||f!==$s))throw yh=p0,Mk;l.flags|=8192}}function ry(l,f){f!==null&&(l.flags|=4),l.flags&16384&&(f=l.tag!==22?hn():536870912,l.lanes|=f,uf|=f)}function xh(l,f){if(!un)switch(l.tailMode){case"hidden":f=l.tail;for(var p=null;f!==null;)f.alternate!==null&&(p=f),f=f.sibling;p===null?l.tail=null:p.sibling=null;break;case"collapsed":p=l.tail;for(var y=null;p!==null;)p.alternate!==null&&(y=p),p=p.sibling;y===null?f||l.tail===null?l.tail=null:l.tail.sibling=null:y.sibling=null}}function Bn(l){var f=l.alternate!==null&&l.alternate.child===l.child,p=0,y=0;if(f)for(var T=l.child;T!==null;)p|=T.lanes|T.childLanes,y|=T.subtreeFlags&65011712,y|=T.flags&65011712,T.return=l,T=T.sibling;else for(T=l.child;T!==null;)p|=T.lanes|T.childLanes,y|=T.subtreeFlags,y|=T.flags,T.return=l,T=T.sibling;return l.subtreeFlags|=y,l.childLanes=p,f}function FG(l,f,p){var y=f.pendingProps;switch(s0(f),f.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Bn(f),null;case 1:return Bn(f),null;case 3:return p=f.stateNode,y=null,l!==null&&(y=l.memoizedState.cache),f.memoizedState.cache!==y&&(f.flags|=2048),Eo(mr),X(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(l===null||l.child===null)&&(ch(f)?Co(f):l===null||l.memoizedState.isDehydrated&&(f.flags&256)===0||(f.flags|=1024,Ik())),Bn(f),null;case 26:return p=f.memoizedState,l===null?(Co(f),p!==null?(Bn(f),ZN(f,p)):(Bn(f),f.flags&=-16777217)):p?p!==l.memoizedState?(Co(f),Bn(f),ZN(f,p)):(Bn(f),f.flags&=-16777217):(l.memoizedProps!==y&&Co(f),Bn(f),f.flags&=-16777217),null;case 27:V(f),p=I.current;var T=f.type;if(l!==null&&f.stateNode!=null)l.memoizedProps!==y&&Co(f);else{if(!y){if(f.stateNode===null)throw Error(r(166));return Bn(f),null}l=ae.current,ch(f)?xk(f):(l=ZM(T,y,p),f.stateNode=l,Co(f))}return Bn(f),null;case 5:if(V(f),p=f.type,l!==null&&f.stateNode!=null)l.memoizedProps!==y&&Co(f);else{if(!y){if(f.stateNode===null)throw Error(r(166));return Bn(f),null}if(l=ae.current,ch(f))xk(f);else{switch(T=gy(I.current),l){case 1:l=T.createElementNS("http://www.w3.org/2000/svg",p);break;case 2:l=T.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;default:switch(p){case"svg":l=T.createElementNS("http://www.w3.org/2000/svg",p);break;case"math":l=T.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;case"script":l=T.createElement("div"),l.innerHTML="<script><\/script>",l=l.removeChild(l.firstChild);break;case"select":l=typeof y.is=="string"?T.createElement("select",{is:y.is}):T.createElement("select"),y.multiple?l.multiple=!0:y.size&&(l.size=y.size);break;default:l=typeof y.is=="string"?T.createElement(p,{is:y.is}):T.createElement(p)}}l[ie]=f,l[ge]=y;e:for(T=f.child;T!==null;){if(T.tag===5||T.tag===6)l.appendChild(T.stateNode);else if(T.tag!==4&&T.tag!==27&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===f)break e;for(;T.sibling===null;){if(T.return===null||T.return===f)break e;T=T.return}T.sibling.return=T.return,T=T.sibling}f.stateNode=l;e:switch(Br(l,p,y),p){case"button":case"input":case"select":case"textarea":l=!!y.autoFocus;break e;case"img":l=!0;break e;default:l=!1}l&&Co(f)}}return Bn(f),f.flags&=-16777217,null;case 6:if(l&&f.stateNode!=null)l.memoizedProps!==y&&Co(f);else{if(typeof y!="string"&&f.stateNode===null)throw Error(r(166));if(l=I.current,ch(f)){if(l=f.stateNode,p=f.memoizedProps,y=null,T=hi,T!==null)switch(T.tag){case 27:case 5:y=T.memoizedProps}l[ie]=f,l=!!(l.nodeValue===p||y!==null&&y.suppressHydrationWarning===!0||zM(l.nodeValue,p)),l||Eu(f)}else l=gy(l).createTextNode(y),l[ie]=f,f.stateNode=l}return Bn(f),null;case 13:if(y=f.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(T=ch(f),y!==null&&y.dehydrated!==null){if(l===null){if(!T)throw Error(r(318));if(T=f.memoizedState,T=T!==null?T.dehydrated:null,!T)throw Error(r(317));T[ie]=f}else fh(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;Bn(f),T=!1}else T=Ik(),l!==null&&l.memoizedState!==null&&(l.memoizedState.hydrationErrors=T),T=!0;if(!T)return f.flags&256?(To(f),f):(To(f),null)}if(To(f),(f.flags&128)!==0)return f.lanes=p,f;if(p=y!==null,l=l!==null&&l.memoizedState!==null,p){y=f.child,T=null,y.alternate!==null&&y.alternate.memoizedState!==null&&y.alternate.memoizedState.cachePool!==null&&(T=y.alternate.memoizedState.cachePool.pool);var x=null;y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(x=y.memoizedState.cachePool.pool),x!==T&&(y.flags|=2048)}return p!==l&&p&&(f.child.flags|=8192),ry(f,f.updateQueue),Bn(f),null;case 4:return X(),l===null&&vE(f.stateNode.containerInfo),Bn(f),null;case 10:return Eo(f.type),Bn(f),null;case 19:if(Te(gr),T=f.memoizedState,T===null)return Bn(f),null;if(y=(f.flags&128)!==0,x=T.rendering,x===null)if(y)xh(T,!1);else{if(Kn!==0||l!==null&&(l.flags&128)!==0)for(l=f.child;l!==null;){if(x=Xg(l),x!==null){for(f.flags|=128,xh(T,!1),l=x.updateQueue,f.updateQueue=l,ry(f,l),f.subtreeFlags=0,l=p,p=f.child;p!==null;)Ak(p,l),p=p.sibling;return F(gr,gr.current&1|2),f.child}l=l.sibling}T.tail!==null&&We()>sy&&(f.flags|=128,y=!0,xh(T,!1),f.lanes=4194304)}else{if(!y)if(l=Xg(x),l!==null){if(f.flags|=128,y=!0,l=l.updateQueue,f.updateQueue=l,ry(f,l),xh(T,!0),T.tail===null&&T.tailMode==="hidden"&&!x.alternate&&!un)return Bn(f),null}else 2*We()-T.renderingStartTime>sy&&p!==536870912&&(f.flags|=128,y=!0,xh(T,!1),f.lanes=4194304);T.isBackwards?(x.sibling=f.child,f.child=x):(l=T.last,l!==null?l.sibling=x:f.child=x,T.last=x)}return T.tail!==null?(f=T.tail,T.rendering=f,T.tail=f.sibling,T.renderingStartTime=We(),f.sibling=null,l=gr.current,F(gr,y?l&1|2:l&1),f):(Bn(f),null);case 22:case 23:return To(f),b0(),y=f.memoizedState!==null,l!==null?l.memoizedState!==null!==y&&(f.flags|=8192):y&&(f.flags|=8192),y?(p&536870912)!==0&&(f.flags&128)===0&&(Bn(f),f.subtreeFlags&6&&(f.flags|=8192)):Bn(f),p=f.updateQueue,p!==null&&ry(f,p.retryQueue),p=null,l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(p=l.memoizedState.cachePool.pool),y=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(y=f.memoizedState.cachePool.pool),y!==p&&(f.flags|=2048),l!==null&&Te(Au),null;case 24:return p=null,l!==null&&(p=l.memoizedState.cache),f.memoizedState.cache!==p&&(f.flags|=2048),Eo(mr),Bn(f),null;case 25:return null;case 30:return null}throw Error(r(156,f.tag))}function BG(l,f){switch(s0(f),f.tag){case 1:return l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 3:return Eo(mr),X(),l=f.flags,(l&65536)!==0&&(l&128)===0?(f.flags=l&-65537|128,f):null;case 26:case 27:case 5:return V(f),null;case 13:if(To(f),l=f.memoizedState,l!==null&&l.dehydrated!==null){if(f.alternate===null)throw Error(r(340));fh()}return l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 19:return Te(gr),null;case 4:return X(),null;case 10:return Eo(f.type),null;case 22:case 23:return To(f),b0(),l!==null&&Te(Au),l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 24:return Eo(mr),null;case 25:return null;default:return null}}function XN(l,f){switch(s0(f),f.tag){case 3:Eo(mr),X();break;case 26:case 27:case 5:V(f);break;case 4:X();break;case 13:To(f);break;case 19:Te(gr);break;case 10:Eo(f.type);break;case 22:case 23:To(f),b0(),l!==null&&Te(Au);break;case 24:Eo(mr)}}function Rh(l,f){try{var p=f.updateQueue,y=p!==null?p.lastEffect:null;if(y!==null){var T=y.next;p=T;do{if((p.tag&l)===l){y=void 0;var x=p.create,q=p.inst;y=x(),q.destroy=y}p=p.next}while(p!==T)}}catch(Z){Cn(f,f.return,Z)}}function gl(l,f,p){try{var y=f.updateQueue,T=y!==null?y.lastEffect:null;if(T!==null){var x=T.next;y=x;do{if((y.tag&l)===l){var q=y.inst,Z=q.destroy;if(Z!==void 0){q.destroy=void 0,T=f;var ce=p,Re=Z;try{Re()}catch(Fe){Cn(T,ce,Fe)}}}y=y.next}while(y!==x)}}catch(Fe){Cn(f,f.return,Fe)}}function QN(l){var f=l.updateQueue;if(f!==null){var p=l.stateNode;try{Fk(f,p)}catch(y){Cn(l,l.return,y)}}}function eM(l,f,p){p.props=xu(l.type,l.memoizedProps),p.state=l.memoizedState;try{p.componentWillUnmount()}catch(y){Cn(l,f,y)}}function Ih(l,f){try{var p=l.ref;if(p!==null){switch(l.tag){case 26:case 27:case 5:var y=l.stateNode;break;case 30:y=l.stateNode;break;default:y=l.stateNode}typeof p=="function"?l.refCleanup=p(y):p.current=y}}catch(T){Cn(l,f,T)}}function Ls(l,f){var p=l.ref,y=l.refCleanup;if(p!==null)if(typeof y=="function")try{y()}catch(T){Cn(l,f,T)}finally{l.refCleanup=null,l=l.alternate,l!=null&&(l.refCleanup=null)}else if(typeof p=="function")try{p(null)}catch(T){Cn(l,f,T)}else p.current=null}function tM(l){var f=l.type,p=l.memoizedProps,y=l.stateNode;try{e:switch(f){case"button":case"input":case"select":case"textarea":p.autoFocus&&y.focus();break e;case"img":p.src?y.src=p.src:p.srcSet&&(y.srcset=p.srcSet)}}catch(T){Cn(l,l.return,T)}}function K0(l,f,p){try{var y=l.stateNode;l7(y,l.type,p,f),y[ge]=f}catch(T){Cn(l,l.return,T)}}function nM(l){return l.tag===5||l.tag===3||l.tag===26||l.tag===27&&Tl(l.type)||l.tag===4}function J0(l){e:for(;;){for(;l.sibling===null;){if(l.return===null||nM(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==18;){if(l.tag===27&&Tl(l.type)||l.flags&2||l.child===null||l.tag===4)continue e;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function Y0(l,f,p){var y=l.tag;if(y===5||y===6)l=l.stateNode,f?(p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p).insertBefore(l,f):(f=p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p,f.appendChild(l),p=p._reactRootContainer,p!=null||f.onclick!==null||(f.onclick=my));else if(y!==4&&(y===27&&Tl(l.type)&&(p=l.stateNode,f=null),l=l.child,l!==null))for(Y0(l,f,p),l=l.sibling;l!==null;)Y0(l,f,p),l=l.sibling}function iy(l,f,p){var y=l.tag;if(y===5||y===6)l=l.stateNode,f?p.insertBefore(l,f):p.appendChild(l);else if(y!==4&&(y===27&&Tl(l.type)&&(p=l.stateNode),l=l.child,l!==null))for(iy(l,f,p),l=l.sibling;l!==null;)iy(l,f,p),l=l.sibling}function rM(l){var f=l.stateNode,p=l.memoizedProps;try{for(var y=l.type,T=f.attributes;T.length;)f.removeAttributeNode(T[0]);Br(f,y,p),f[ie]=l,f[ge]=p}catch(x){Cn(l,l.return,x)}}var xo=!1,er=!1,Z0=!1,iM=typeof WeakSet=="function"?WeakSet:Set,Pr=null;function qG(l,f){if(l=l.containerInfo,wE=Ey,l=mk(l),Jw(l)){if("selectionStart"in l)var p={start:l.selectionStart,end:l.selectionEnd};else e:{p=(p=l.ownerDocument)&&p.defaultView||window;var y=p.getSelection&&p.getSelection();if(y&&y.rangeCount!==0){p=y.anchorNode;var T=y.anchorOffset,x=y.focusNode;y=y.focusOffset;try{p.nodeType,x.nodeType}catch{p=null;break e}var q=0,Z=-1,ce=-1,Re=0,Fe=0,Ve=l,ke=null;t:for(;;){for(var De;Ve!==p||T!==0&&Ve.nodeType!==3||(Z=q+T),Ve!==x||y!==0&&Ve.nodeType!==3||(ce=q+y),Ve.nodeType===3&&(q+=Ve.nodeValue.length),(De=Ve.firstChild)!==null;)ke=Ve,Ve=De;for(;;){if(Ve===l)break t;if(ke===p&&++Re===T&&(Z=q),ke===x&&++Fe===y&&(ce=q),(De=Ve.nextSibling)!==null)break;Ve=ke,ke=Ve.parentNode}Ve=De}p=Z===-1||ce===-1?null:{start:Z,end:ce}}else p=null}p=p||{start:0,end:0}}else p=null;for(EE={focusedElem:l,selectionRange:p},Ey=!1,Pr=f;Pr!==null;)if(f=Pr,l=f.child,(f.subtreeFlags&1024)!==0&&l!==null)l.return=f,Pr=l;else for(;Pr!==null;){switch(f=Pr,x=f.alternate,l=f.flags,f.tag){case 0:break;case 11:case 15:break;case 1:if((l&1024)!==0&&x!==null){l=void 0,p=f,T=x.memoizedProps,x=x.memoizedState,y=p.stateNode;try{var Et=xu(p.type,T,p.elementType===p.type);l=y.getSnapshotBeforeUpdate(Et,x),y.__reactInternalSnapshotBeforeUpdate=l}catch(_t){Cn(p,p.return,_t)}}break;case 3:if((l&1024)!==0){if(l=f.stateNode.containerInfo,p=l.nodeType,p===9)AE(l);else if(p===1)switch(l.nodeName){case"HEAD":case"HTML":case"BODY":AE(l);break;default:l.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((l&1024)!==0)throw Error(r(163))}if(l=f.sibling,l!==null){l.return=f.return,Pr=l;break}Pr=f.return}}function aM(l,f,p){var y=p.flags;switch(p.tag){case 0:case 11:case 15:yl(l,p),y&4&&Rh(5,p);break;case 1:if(yl(l,p),y&4)if(l=p.stateNode,f===null)try{l.componentDidMount()}catch(q){Cn(p,p.return,q)}else{var T=xu(p.type,f.memoizedProps);f=f.memoizedState;try{l.componentDidUpdate(T,f,l.__reactInternalSnapshotBeforeUpdate)}catch(q){Cn(p,p.return,q)}}y&64&&QN(p),y&512&&Ih(p,p.return);break;case 3:if(yl(l,p),y&64&&(l=p.updateQueue,l!==null)){if(f=null,p.child!==null)switch(p.child.tag){case 27:case 5:f=p.child.stateNode;break;case 1:f=p.child.stateNode}try{Fk(l,f)}catch(q){Cn(p,p.return,q)}}break;case 27:f===null&&y&4&&rM(p);case 26:case 5:yl(l,p),f===null&&y&4&&tM(p),y&512&&Ih(p,p.return);break;case 12:yl(l,p);break;case 13:yl(l,p),y&4&&lM(l,p),y&64&&(l=p.memoizedState,l!==null&&(l=l.dehydrated,l!==null&&(p=ZG.bind(null,p),m7(l,p))));break;case 22:if(y=p.memoizedState!==null||xo,!y){f=f!==null&&f.memoizedState!==null||er,T=xo;var x=er;xo=y,(er=f)&&!x?vl(l,p,(p.subtreeFlags&8772)!==0):yl(l,p),xo=T,er=x}break;case 30:break;default:yl(l,p)}}function sM(l){var f=l.alternate;f!==null&&(l.alternate=null,sM(f)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(f=l.stateNode,f!==null&&et(f)),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}var $n=null,Ii=!1;function Ro(l,f,p){for(p=p.child;p!==null;)oM(l,f,p),p=p.sibling}function oM(l,f,p){if(Ie&&typeof Ie.onCommitFiberUnmount=="function")try{Ie.onCommitFiberUnmount(he,p)}catch{}switch(p.tag){case 26:er||Ls(p,f),Ro(l,f,p),p.memoizedState?p.memoizedState.count--:p.stateNode&&(p=p.stateNode,p.parentNode.removeChild(p));break;case 27:er||Ls(p,f);var y=$n,T=Ii;Tl(p.type)&&($n=p.stateNode,Ii=!1),Ro(l,f,p),Uh(p.stateNode),$n=y,Ii=T;break;case 5:er||Ls(p,f);case 6:if(y=$n,T=Ii,$n=null,Ro(l,f,p),$n=y,Ii=T,$n!==null)if(Ii)try{($n.nodeType===9?$n.body:$n.nodeName==="HTML"?$n.ownerDocument.body:$n).removeChild(p.stateNode)}catch(x){Cn(p,f,x)}else try{$n.removeChild(p.stateNode)}catch(x){Cn(p,f,x)}break;case 18:$n!==null&&(Ii?(l=$n,JM(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,p.stateNode),Gh(l)):JM($n,p.stateNode));break;case 4:y=$n,T=Ii,$n=p.stateNode.containerInfo,Ii=!0,Ro(l,f,p),$n=y,Ii=T;break;case 0:case 11:case 14:case 15:er||gl(2,p,f),er||gl(4,p,f),Ro(l,f,p);break;case 1:er||(Ls(p,f),y=p.stateNode,typeof y.componentWillUnmount=="function"&&eM(p,f,y)),Ro(l,f,p);break;case 21:Ro(l,f,p);break;case 22:er=(y=er)||p.memoizedState!==null,Ro(l,f,p),er=y;break;default:Ro(l,f,p)}}function lM(l,f){if(f.memoizedState===null&&(l=f.alternate,l!==null&&(l=l.memoizedState,l!==null&&(l=l.dehydrated,l!==null))))try{Gh(l)}catch(p){Cn(f,f.return,p)}}function VG(l){switch(l.tag){case 13:case 19:var f=l.stateNode;return f===null&&(f=l.stateNode=new iM),f;case 22:return l=l.stateNode,f=l._retryCache,f===null&&(f=l._retryCache=new iM),f;default:throw Error(r(435,l.tag))}}function X0(l,f){var p=VG(l);f.forEach(function(y){var T=XG.bind(null,l,y);p.has(y)||(p.add(y),y.then(T,T))})}function ia(l,f){var p=f.deletions;if(p!==null)for(var y=0;y<p.length;y++){var T=p[y],x=l,q=f,Z=q;e:for(;Z!==null;){switch(Z.tag){case 27:if(Tl(Z.type)){$n=Z.stateNode,Ii=!1;break e}break;case 5:$n=Z.stateNode,Ii=!1;break e;case 3:case 4:$n=Z.stateNode.containerInfo,Ii=!0;break e}Z=Z.return}if($n===null)throw Error(r(160));oM(x,q,T),$n=null,Ii=!1,x=T.alternate,x!==null&&(x.return=null),T.return=null}if(f.subtreeFlags&13878)for(f=f.child;f!==null;)uM(f,l),f=f.sibling}var as=null;function uM(l,f){var p=l.alternate,y=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:ia(f,l),aa(l),y&4&&(gl(3,l,l.return),Rh(3,l),gl(5,l,l.return));break;case 1:ia(f,l),aa(l),y&512&&(er||p===null||Ls(p,p.return)),y&64&&xo&&(l=l.updateQueue,l!==null&&(y=l.callbacks,y!==null&&(p=l.shared.hiddenCallbacks,l.shared.hiddenCallbacks=p===null?y:p.concat(y))));break;case 26:var T=as;if(ia(f,l),aa(l),y&512&&(er||p===null||Ls(p,p.return)),y&4){var x=p!==null?p.memoizedState:null;if(y=l.memoizedState,p===null)if(y===null)if(l.stateNode===null){e:{y=l.type,p=l.memoizedProps,T=T.ownerDocument||T;t:switch(y){case"title":x=T.getElementsByTagName("title")[0],(!x||x[Ee]||x[ie]||x.namespaceURI==="http://www.w3.org/2000/svg"||x.hasAttribute("itemprop"))&&(x=T.createElement(y),T.head.insertBefore(x,T.querySelector("head > title"))),Br(x,y,p),x[ie]=l,gt(x),y=x;break e;case"link":var q=rD("link","href",T).get(y+(p.href||""));if(q){for(var Z=0;Z<q.length;Z++)if(x=q[Z],x.getAttribute("href")===(p.href==null||p.href===""?null:p.href)&&x.getAttribute("rel")===(p.rel==null?null:p.rel)&&x.getAttribute("title")===(p.title==null?null:p.title)&&x.getAttribute("crossorigin")===(p.crossOrigin==null?null:p.crossOrigin)){q.splice(Z,1);break t}}x=T.createElement(y),Br(x,y,p),T.head.appendChild(x);break;case"meta":if(q=rD("meta","content",T).get(y+(p.content||""))){for(Z=0;Z<q.length;Z++)if(x=q[Z],x.getAttribute("content")===(p.content==null?null:""+p.content)&&x.getAttribute("name")===(p.name==null?null:p.name)&&x.getAttribute("property")===(p.property==null?null:p.property)&&x.getAttribute("http-equiv")===(p.httpEquiv==null?null:p.httpEquiv)&&x.getAttribute("charset")===(p.charSet==null?null:p.charSet)){q.splice(Z,1);break t}}x=T.createElement(y),Br(x,y,p),T.head.appendChild(x);break;default:throw Error(r(468,y))}x[ie]=l,gt(x),y=x}l.stateNode=y}else iD(T,l.type,l.stateNode);else l.stateNode=nD(T,y,l.memoizedProps);else x!==y?(x===null?p.stateNode!==null&&(p=p.stateNode,p.parentNode.removeChild(p)):x.count--,y===null?iD(T,l.type,l.stateNode):nD(T,y,l.memoizedProps)):y===null&&l.stateNode!==null&&K0(l,l.memoizedProps,p.memoizedProps)}break;case 27:ia(f,l),aa(l),y&512&&(er||p===null||Ls(p,p.return)),p!==null&&y&4&&K0(l,l.memoizedProps,p.memoizedProps);break;case 5:if(ia(f,l),aa(l),y&512&&(er||p===null||Ls(p,p.return)),l.flags&32){T=l.stateNode;try{Fc(T,"")}catch(De){Cn(l,l.return,De)}}y&4&&l.stateNode!=null&&(T=l.memoizedProps,K0(l,T,p!==null?p.memoizedProps:T)),y&1024&&(Z0=!0);break;case 6:if(ia(f,l),aa(l),y&4){if(l.stateNode===null)throw Error(r(162));y=l.memoizedProps,p=l.stateNode;try{p.nodeValue=y}catch(De){Cn(l,l.return,De)}}break;case 3:if(_y=null,T=as,as=yy(f.containerInfo),ia(f,l),as=T,aa(l),y&4&&p!==null&&p.memoizedState.isDehydrated)try{Gh(f.containerInfo)}catch(De){Cn(l,l.return,De)}Z0&&(Z0=!1,cM(l));break;case 4:y=as,as=yy(l.stateNode.containerInfo),ia(f,l),aa(l),as=y;break;case 12:ia(f,l),aa(l);break;case 13:ia(f,l),aa(l),l.child.flags&8192&&l.memoizedState!==null!=(p!==null&&p.memoizedState!==null)&&(iE=We()),y&4&&(y=l.updateQueue,y!==null&&(l.updateQueue=null,X0(l,y)));break;case 22:T=l.memoizedState!==null;var ce=p!==null&&p.memoizedState!==null,Re=xo,Fe=er;if(xo=Re||T,er=Fe||ce,ia(f,l),er=Fe,xo=Re,aa(l),y&8192)e:for(f=l.stateNode,f._visibility=T?f._visibility&-2:f._visibility|1,T&&(p===null||ce||xo||er||Ru(l)),p=null,f=l;;){if(f.tag===5||f.tag===26){if(p===null){ce=p=f;try{if(x=ce.stateNode,T)q=x.style,typeof q.setProperty=="function"?q.setProperty("display","none","important"):q.display="none";else{Z=ce.stateNode;var Ve=ce.memoizedProps.style,ke=Ve!=null&&Ve.hasOwnProperty("display")?Ve.display:null;Z.style.display=ke==null||typeof ke=="boolean"?"":(""+ke).trim()}}catch(De){Cn(ce,ce.return,De)}}}else if(f.tag===6){if(p===null){ce=f;try{ce.stateNode.nodeValue=T?"":ce.memoizedProps}catch(De){Cn(ce,ce.return,De)}}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===l)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===l)break e;for(;f.sibling===null;){if(f.return===null||f.return===l)break e;p===f&&(p=null),f=f.return}p===f&&(p=null),f.sibling.return=f.return,f=f.sibling}y&4&&(y=l.updateQueue,y!==null&&(p=y.retryQueue,p!==null&&(y.retryQueue=null,X0(l,p))));break;case 19:ia(f,l),aa(l),y&4&&(y=l.updateQueue,y!==null&&(l.updateQueue=null,X0(l,y)));break;case 30:break;case 21:break;default:ia(f,l),aa(l)}}function aa(l){var f=l.flags;if(f&2){try{for(var p,y=l.return;y!==null;){if(nM(y)){p=y;break}y=y.return}if(p==null)throw Error(r(160));switch(p.tag){case 27:var T=p.stateNode,x=J0(l);iy(l,x,T);break;case 5:var q=p.stateNode;p.flags&32&&(Fc(q,""),p.flags&=-33);var Z=J0(l);iy(l,Z,q);break;case 3:case 4:var ce=p.stateNode.containerInfo,Re=J0(l);Y0(l,Re,ce);break;default:throw Error(r(161))}}catch(Fe){Cn(l,l.return,Fe)}l.flags&=-3}f&4096&&(l.flags&=-4097)}function cM(l){if(l.subtreeFlags&1024)for(l=l.child;l!==null;){var f=l;cM(f),f.tag===5&&f.flags&1024&&f.stateNode.reset(),l=l.sibling}}function yl(l,f){if(f.subtreeFlags&8772)for(f=f.child;f!==null;)aM(l,f.alternate,f),f=f.sibling}function Ru(l){for(l=l.child;l!==null;){var f=l;switch(f.tag){case 0:case 11:case 14:case 15:gl(4,f,f.return),Ru(f);break;case 1:Ls(f,f.return);var p=f.stateNode;typeof p.componentWillUnmount=="function"&&eM(f,f.return,p),Ru(f);break;case 27:Uh(f.stateNode);case 26:case 5:Ls(f,f.return),Ru(f);break;case 22:f.memoizedState===null&&Ru(f);break;case 30:Ru(f);break;default:Ru(f)}l=l.sibling}}function vl(l,f,p){for(p=p&&(f.subtreeFlags&8772)!==0,f=f.child;f!==null;){var y=f.alternate,T=l,x=f,q=x.flags;switch(x.tag){case 0:case 11:case 15:vl(T,x,p),Rh(4,x);break;case 1:if(vl(T,x,p),y=x,T=y.stateNode,typeof T.componentDidMount=="function")try{T.componentDidMount()}catch(Re){Cn(y,y.return,Re)}if(y=x,T=y.updateQueue,T!==null){var Z=y.stateNode;try{var ce=T.shared.hiddenCallbacks;if(ce!==null)for(T.shared.hiddenCallbacks=null,T=0;T<ce.length;T++)jk(ce[T],Z)}catch(Re){Cn(y,y.return,Re)}}p&&q&64&&QN(x),Ih(x,x.return);break;case 27:rM(x);case 26:case 5:vl(T,x,p),p&&y===null&&q&4&&tM(x),Ih(x,x.return);break;case 12:vl(T,x,p);break;case 13:vl(T,x,p),p&&q&4&&lM(T,x);break;case 22:x.memoizedState===null&&vl(T,x,p),Ih(x,x.return);break;case 30:break;default:vl(T,x,p)}f=f.sibling}}function Q0(l,f){var p=null;l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(p=l.memoizedState.cachePool.pool),l=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(l=f.memoizedState.cachePool.pool),l!==p&&(l!=null&&l.refCount++,p!=null&&ph(p))}function eE(l,f){l=null,f.alternate!==null&&(l=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==l&&(f.refCount++,l!=null&&ph(l))}function Us(l,f,p,y){if(f.subtreeFlags&10256)for(f=f.child;f!==null;)fM(l,f,p,y),f=f.sibling}function fM(l,f,p,y){var T=f.flags;switch(f.tag){case 0:case 11:case 15:Us(l,f,p,y),T&2048&&Rh(9,f);break;case 1:Us(l,f,p,y);break;case 3:Us(l,f,p,y),T&2048&&(l=null,f.alternate!==null&&(l=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==l&&(f.refCount++,l!=null&&ph(l)));break;case 12:if(T&2048){Us(l,f,p,y),l=f.stateNode;try{var x=f.memoizedProps,q=x.id,Z=x.onPostCommit;typeof Z=="function"&&Z(q,f.alternate===null?"mount":"update",l.passiveEffectDuration,-0)}catch(ce){Cn(f,f.return,ce)}}else Us(l,f,p,y);break;case 13:Us(l,f,p,y);break;case 23:break;case 22:x=f.stateNode,q=f.alternate,f.memoizedState!==null?x._visibility&2?Us(l,f,p,y):Ph(l,f):x._visibility&2?Us(l,f,p,y):(x._visibility|=2,sf(l,f,p,y,(f.subtreeFlags&10256)!==0)),T&2048&&Q0(q,f);break;case 24:Us(l,f,p,y),T&2048&&eE(f.alternate,f);break;default:Us(l,f,p,y)}}function sf(l,f,p,y,T){for(T=T&&(f.subtreeFlags&10256)!==0,f=f.child;f!==null;){var x=l,q=f,Z=p,ce=y,Re=q.flags;switch(q.tag){case 0:case 11:case 15:sf(x,q,Z,ce,T),Rh(8,q);break;case 23:break;case 22:var Fe=q.stateNode;q.memoizedState!==null?Fe._visibility&2?sf(x,q,Z,ce,T):Ph(x,q):(Fe._visibility|=2,sf(x,q,Z,ce,T)),T&&Re&2048&&Q0(q.alternate,q);break;case 24:sf(x,q,Z,ce,T),T&&Re&2048&&eE(q.alternate,q);break;default:sf(x,q,Z,ce,T)}f=f.sibling}}function Ph(l,f){if(f.subtreeFlags&10256)for(f=f.child;f!==null;){var p=l,y=f,T=y.flags;switch(y.tag){case 22:Ph(p,y),T&2048&&Q0(y.alternate,y);break;case 24:Ph(p,y),T&2048&&eE(y.alternate,y);break;default:Ph(p,y)}f=f.sibling}}var Oh=8192;function of(l){if(l.subtreeFlags&Oh)for(l=l.child;l!==null;)dM(l),l=l.sibling}function dM(l){switch(l.tag){case 26:of(l),l.flags&Oh&&l.memoizedState!==null&&R7(as,l.memoizedState,l.memoizedProps);break;case 5:of(l);break;case 3:case 4:var f=as;as=yy(l.stateNode.containerInfo),of(l),as=f;break;case 22:l.memoizedState===null&&(f=l.alternate,f!==null&&f.memoizedState!==null?(f=Oh,Oh=16777216,of(l),Oh=f):of(l));break;default:of(l)}}function hM(l){var f=l.alternate;if(f!==null&&(l=f.child,l!==null)){f.child=null;do f=l.sibling,l.sibling=null,l=f;while(l!==null)}}function kh(l){var f=l.deletions;if((l.flags&16)!==0){if(f!==null)for(var p=0;p<f.length;p++){var y=f[p];Pr=y,mM(y,l)}hM(l)}if(l.subtreeFlags&10256)for(l=l.child;l!==null;)pM(l),l=l.sibling}function pM(l){switch(l.tag){case 0:case 11:case 15:kh(l),l.flags&2048&&gl(9,l,l.return);break;case 3:kh(l);break;case 12:kh(l);break;case 22:var f=l.stateNode;l.memoizedState!==null&&f._visibility&2&&(l.return===null||l.return.tag!==13)?(f._visibility&=-3,ay(l)):kh(l);break;default:kh(l)}}function ay(l){var f=l.deletions;if((l.flags&16)!==0){if(f!==null)for(var p=0;p<f.length;p++){var y=f[p];Pr=y,mM(y,l)}hM(l)}for(l=l.child;l!==null;){switch(f=l,f.tag){case 0:case 11:case 15:gl(8,f,f.return),ay(f);break;case 22:p=f.stateNode,p._visibility&2&&(p._visibility&=-3,ay(f));break;default:ay(f)}l=l.sibling}}function mM(l,f){for(;Pr!==null;){var p=Pr;switch(p.tag){case 0:case 11:case 15:gl(8,p,f);break;case 23:case 22:if(p.memoizedState!==null&&p.memoizedState.cachePool!==null){var y=p.memoizedState.cachePool.pool;y!=null&&y.refCount++}break;case 24:ph(p.memoizedState.cache)}if(y=p.child,y!==null)y.return=p,Pr=y;else e:for(p=l;Pr!==null;){y=Pr;var T=y.sibling,x=y.return;if(sM(y),y===p){Pr=null;break e}if(T!==null){T.return=x,Pr=T;break e}Pr=x}}}var zG={getCacheForType:function(l){var f=ei(mr),p=f.data.get(l);return p===void 0&&(p=l(),f.data.set(l,p)),p}},HG=typeof WeakMap=="function"?WeakMap:Map,mn=0,Pn=null,Wt=null,en=0,gn=0,sa=null,_l=!1,lf=!1,tE=!1,Io=0,Kn=0,bl=0,Iu=0,nE=0,Na=0,uf=0,Nh=null,Pi=null,rE=!1,iE=0,sy=1/0,oy=null,wl=null,Fr=0,El=null,cf=null,ff=0,aE=0,sE=null,gM=null,Mh=0,oE=null;function oa(){if((mn&2)!==0&&en!==0)return en&-en;if(ee.T!==null){var l=Zc;return l!==0?l:pE()}return Y()}function yM(){Na===0&&(Na=(en&536870912)===0||un?sn():536870912);var l=ka.current;return l!==null&&(l.flags|=32),Na}function la(l,f,p){(l===Pn&&(gn===2||gn===9)||l.cancelPendingCommit!==null)&&(df(l,0),Sl(l,en,Na,!1)),Aa(l,p),((mn&2)===0||l!==Pn)&&(l===Pn&&((mn&2)===0&&(Iu|=p),Kn===4&&Sl(l,en,Na,!1)),js(l))}function vM(l,f,p){if((mn&6)!==0)throw Error(r(327));var y=!p&&(f&124)===0&&(f&l.expiredLanes)===0||ft(l,f),T=y?KG(l,f):cE(l,f,!0),x=y;do{if(T===0){lf&&!y&&Sl(l,f,0,!1);break}else{if(p=l.current.alternate,x&&!GG(p)){T=cE(l,f,!1),x=!1;continue}if(T===2){if(x=f,l.errorRecoveryDisabledLanes&x)var q=0;else q=l.pendingLanes&-536870913,q=q!==0?q:q&536870912?536870912:0;if(q!==0){f=q;e:{var Z=l;T=Nh;var ce=Z.current.memoizedState.isDehydrated;if(ce&&(df(Z,q).flags|=256),q=cE(Z,q,!1),q!==2){if(tE&&!ce){Z.errorRecoveryDisabledLanes|=x,Iu|=x,T=4;break e}x=Pi,Pi=T,x!==null&&(Pi===null?Pi=x:Pi.push.apply(Pi,x))}T=q}if(x=!1,T!==2)continue}}if(T===1){df(l,0),Sl(l,f,0,!0);break}e:{switch(y=l,x=T,x){case 0:case 1:throw Error(r(345));case 4:if((f&4194048)!==f)break;case 6:Sl(y,f,Na,!_l);break e;case 2:Pi=null;break;case 3:case 5:break;default:throw Error(r(329))}if((f&62914560)===f&&(T=iE+300-We(),10<T)){if(Sl(y,f,Na,!_l),Le(y,0,!0)!==0)break e;y.timeoutHandle=WM(_M.bind(null,y,p,Pi,oy,rE,f,Na,Iu,uf,_l,x,2,-0,0),T);break e}_M(y,p,Pi,oy,rE,f,Na,Iu,uf,_l,x,0,-0,0)}}break}while(!0);js(l)}function _M(l,f,p,y,T,x,q,Z,ce,Re,Fe,Ve,ke,De){if(l.timeoutHandle=-1,Ve=f.subtreeFlags,(Ve&8192||(Ve&16785408)===16785408)&&(Bh={stylesheets:null,count:0,unsuspend:x7},dM(f),Ve=I7(),Ve!==null)){l.cancelPendingCommit=Ve(CM.bind(null,l,f,x,p,y,T,q,Z,ce,Fe,1,ke,De)),Sl(l,x,q,!Re);return}CM(l,f,x,p,y,T,q,Z,ce)}function GG(l){for(var f=l;;){var p=f.tag;if((p===0||p===11||p===15)&&f.flags&16384&&(p=f.updateQueue,p!==null&&(p=p.stores,p!==null)))for(var y=0;y<p.length;y++){var T=p[y],x=T.getSnapshot;T=T.value;try{if(!na(x(),T))return!1}catch{return!1}}if(p=f.child,f.subtreeFlags&16384&&p!==null)p.return=f,f=p;else{if(f===l)break;for(;f.sibling===null;){if(f.return===null||f.return===l)return!0;f=f.return}f.sibling.return=f.return,f=f.sibling}}return!0}function Sl(l,f,p,y){f&=~nE,f&=~Iu,l.suspendedLanes|=f,l.pingedLanes&=~f,y&&(l.warmLanes|=f),y=l.expirationTimes;for(var T=f;0<T;){var x=31-nt(T),q=1<<x;y[x]=-1,T&=~q}p!==0&&Qi(l,p,f)}function ly(){return(mn&6)===0?(Dh(0),!1):!0}function lE(){if(Wt!==null){if(gn===0)var l=Wt.return;else l=Wt,wo=Su=null,A0(l),rf=null,Ah=0,l=Wt;for(;l!==null;)XN(l.alternate,l),l=l.return;Wt=null}}function df(l,f){var p=l.timeoutHandle;p!==-1&&(l.timeoutHandle=-1,c7(p)),p=l.cancelPendingCommit,p!==null&&(l.cancelPendingCommit=null,p()),lE(),Pn=l,Wt=p=vo(l.current,null),en=f,gn=0,sa=null,_l=!1,lf=ft(l,f),tE=!1,uf=Na=nE=Iu=bl=Kn=0,Pi=Nh=null,rE=!1,(f&8)!==0&&(f|=f&32);var y=l.entangledLanes;if(y!==0)for(l=l.entanglements,y&=f;0<y;){var T=31-nt(y),x=1<<T;f|=l[T],y&=~x}return Io=f,Pg(),p}function bM(l,f){Vt=null,ee.H=Jg,f===gh||f===jg?(f=Lk(),gn=3):f===Mk?(f=Lk(),gn=4):gn=f===UN?8:f!==null&&typeof f=="object"&&typeof f.then=="function"?6:1,sa=f,Wt===null&&(Kn=1,ey(l,Ra(f,l.current)))}function wM(){var l=ee.H;return ee.H=Jg,l===null?Jg:l}function EM(){var l=ee.A;return ee.A=zG,l}function uE(){Kn=4,_l||(en&4194048)!==en&&ka.current!==null||(lf=!0),(bl&134217727)===0&&(Iu&134217727)===0||Pn===null||Sl(Pn,en,Na,!1)}function cE(l,f,p){var y=mn;mn|=2;var T=wM(),x=EM();(Pn!==l||en!==f)&&(oy=null,df(l,f)),f=!1;var q=Kn;e:do try{if(gn!==0&&Wt!==null){var Z=Wt,ce=sa;switch(gn){case 8:lE(),q=6;break e;case 3:case 2:case 9:case 6:ka.current===null&&(f=!0);var Re=gn;if(gn=0,sa=null,hf(l,Z,ce,Re),p&&lf){q=0;break e}break;default:Re=gn,gn=0,sa=null,hf(l,Z,ce,Re)}}WG(),q=Kn;break}catch(Fe){bM(l,Fe)}while(!0);return f&&l.shellSuspendCounter++,wo=Su=null,mn=y,ee.H=T,ee.A=x,Wt===null&&(Pn=null,en=0,Pg()),q}function WG(){for(;Wt!==null;)SM(Wt)}function KG(l,f){var p=mn;mn|=2;var y=wM(),T=EM();Pn!==l||en!==f?(oy=null,sy=We()+500,df(l,f)):lf=ft(l,f);e:do try{if(gn!==0&&Wt!==null){f=Wt;var x=sa;t:switch(gn){case 1:gn=0,sa=null,hf(l,f,x,1);break;case 2:case 9:if(Dk(x)){gn=0,sa=null,TM(f);break}f=function(){gn!==2&&gn!==9||Pn!==l||(gn=7),js(l)},x.then(f,f);break e;case 3:gn=7;break e;case 4:gn=5;break e;case 7:Dk(x)?(gn=0,sa=null,TM(f)):(gn=0,sa=null,hf(l,f,x,7));break;case 5:var q=null;switch(Wt.tag){case 26:q=Wt.memoizedState;case 5:case 27:var Z=Wt;if(!q||aD(q)){gn=0,sa=null;var ce=Z.sibling;if(ce!==null)Wt=ce;else{var Re=Z.return;Re!==null?(Wt=Re,uy(Re)):Wt=null}break t}}gn=0,sa=null,hf(l,f,x,5);break;case 6:gn=0,sa=null,hf(l,f,x,6);break;case 8:lE(),Kn=6;break e;default:throw Error(r(462))}}JG();break}catch(Fe){bM(l,Fe)}while(!0);return wo=Su=null,ee.H=y,ee.A=T,mn=p,Wt!==null?0:(Pn=null,en=0,Pg(),Kn)}function JG(){for(;Wt!==null&&!tt();)SM(Wt)}function SM(l){var f=YN(l.alternate,l,Io);l.memoizedProps=l.pendingProps,f===null?uy(l):Wt=f}function TM(l){var f=l,p=f.alternate;switch(f.tag){case 15:case 0:f=zN(p,f,f.pendingProps,f.type,void 0,en);break;case 11:f=zN(p,f,f.pendingProps,f.type.render,f.ref,en);break;case 5:A0(f);default:XN(p,f),f=Wt=Ak(f,Io),f=YN(p,f,Io)}l.memoizedProps=l.pendingProps,f===null?uy(l):Wt=f}function hf(l,f,p,y){wo=Su=null,A0(f),rf=null,Ah=0;var T=f.return;try{if(UG(l,T,f,p,en)){Kn=1,ey(l,Ra(p,l.current)),Wt=null;return}}catch(x){if(T!==null)throw Wt=T,x;Kn=1,ey(l,Ra(p,l.current)),Wt=null;return}f.flags&32768?(un||y===1?l=!0:lf||(en&536870912)!==0?l=!1:(_l=l=!0,(y===2||y===9||y===3||y===6)&&(y=ka.current,y!==null&&y.tag===13&&(y.flags|=16384))),AM(f,l)):uy(f)}function uy(l){var f=l;do{if((f.flags&32768)!==0){AM(f,_l);return}l=f.return;var p=FG(f.alternate,f,Io);if(p!==null){Wt=p;return}if(f=f.sibling,f!==null){Wt=f;return}Wt=f=l}while(f!==null);Kn===0&&(Kn=5)}function AM(l,f){do{var p=BG(l.alternate,l);if(p!==null){p.flags&=32767,Wt=p;return}if(p=l.return,p!==null&&(p.flags|=32768,p.subtreeFlags=0,p.deletions=null),!f&&(l=l.sibling,l!==null)){Wt=l;return}Wt=l=p}while(l!==null);Kn=6,Wt=null}function CM(l,f,p,y,T,x,q,Z,ce){l.cancelPendingCommit=null;do cy();while(Fr!==0);if((mn&6)!==0)throw Error(r(327));if(f!==null){if(f===l.current)throw Error(r(177));if(x=f.lanes|f.childLanes,x|=e0,Ai(l,p,x,q,Z,ce),l===Pn&&(Wt=Pn=null,en=0),cf=f,El=l,ff=p,aE=x,sE=T,gM=y,(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?(l.callbackNode=null,l.callbackPriority=0,QG(At,function(){return OM(),null})):(l.callbackNode=null,l.callbackPriority=0),y=(f.flags&13878)!==0,(f.subtreeFlags&13878)!==0||y){y=ee.T,ee.T=null,T=le.p,le.p=2,q=mn,mn|=4;try{qG(l,f,p)}finally{mn=q,le.p=T,ee.T=y}}Fr=1,xM(),RM(),IM()}}function xM(){if(Fr===1){Fr=0;var l=El,f=cf,p=(f.flags&13878)!==0;if((f.subtreeFlags&13878)!==0||p){p=ee.T,ee.T=null;var y=le.p;le.p=2;var T=mn;mn|=4;try{uM(f,l);var x=EE,q=mk(l.containerInfo),Z=x.focusedElem,ce=x.selectionRange;if(q!==Z&&Z&&Z.ownerDocument&&pk(Z.ownerDocument.documentElement,Z)){if(ce!==null&&Jw(Z)){var Re=ce.start,Fe=ce.end;if(Fe===void 0&&(Fe=Re),"selectionStart"in Z)Z.selectionStart=Re,Z.selectionEnd=Math.min(Fe,Z.value.length);else{var Ve=Z.ownerDocument||document,ke=Ve&&Ve.defaultView||window;if(ke.getSelection){var De=ke.getSelection(),Et=Z.textContent.length,_t=Math.min(ce.start,Et),En=ce.end===void 0?_t:Math.min(ce.end,Et);!De.extend&&_t>En&&(q=En,En=_t,_t=q);var be=hk(Z,_t),ye=hk(Z,En);if(be&&ye&&(De.rangeCount!==1||De.anchorNode!==be.node||De.anchorOffset!==be.offset||De.focusNode!==ye.node||De.focusOffset!==ye.offset)){var xe=Ve.createRange();xe.setStart(be.node,be.offset),De.removeAllRanges(),_t>En?(De.addRange(xe),De.extend(ye.node,ye.offset)):(xe.setEnd(ye.node,ye.offset),De.addRange(xe))}}}}for(Ve=[],De=Z;De=De.parentNode;)De.nodeType===1&&Ve.push({element:De,left:De.scrollLeft,top:De.scrollTop});for(typeof Z.focus=="function"&&Z.focus(),Z=0;Z<Ve.length;Z++){var qe=Ve[Z];qe.element.scrollLeft=qe.left,qe.element.scrollTop=qe.top}}Ey=!!wE,EE=wE=null}finally{mn=T,le.p=y,ee.T=p}}l.current=f,Fr=2}}function RM(){if(Fr===2){Fr=0;var l=El,f=cf,p=(f.flags&8772)!==0;if((f.subtreeFlags&8772)!==0||p){p=ee.T,ee.T=null;var y=le.p;le.p=2;var T=mn;mn|=4;try{aM(l,f.alternate,f)}finally{mn=T,le.p=y,ee.T=p}}Fr=3}}function IM(){if(Fr===4||Fr===3){Fr=0,je();var l=El,f=cf,p=ff,y=gM;(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?Fr=5:(Fr=0,cf=El=null,PM(l,l.pendingLanes));var T=l.pendingLanes;if(T===0&&(wl=null),du(p),f=f.stateNode,Ie&&typeof Ie.onCommitFiberRoot=="function")try{Ie.onCommitFiberRoot(he,f,void 0,(f.current.flags&128)===128)}catch{}if(y!==null){f=ee.T,T=le.p,le.p=2,ee.T=null;try{for(var x=l.onRecoverableError,q=0;q<y.length;q++){var Z=y[q];x(Z.value,{componentStack:Z.stack})}}finally{ee.T=f,le.p=T}}(ff&3)!==0&&cy(),js(l),T=l.pendingLanes,(p&4194090)!==0&&(T&42)!==0?l===oE?Mh++:(Mh=0,oE=l):Mh=0,Dh(0)}}function PM(l,f){(l.pooledCacheLanes&=f)===0&&(f=l.pooledCache,f!=null&&(l.pooledCache=null,ph(f)))}function cy(l){return xM(),RM(),IM(),OM()}function OM(){if(Fr!==5)return!1;var l=El,f=aE;aE=0;var p=du(ff),y=ee.T,T=le.p;try{le.p=32>p?32:p,ee.T=null,p=sE,sE=null;var x=El,q=ff;if(Fr=0,cf=El=null,ff=0,(mn&6)!==0)throw Error(r(331));var Z=mn;if(mn|=4,pM(x.current),fM(x,x.current,q,p),mn=Z,Dh(0,!1),Ie&&typeof Ie.onPostCommitFiberRoot=="function")try{Ie.onPostCommitFiberRoot(he,x)}catch{}return!0}finally{le.p=T,ee.T=y,PM(l,f)}}function kM(l,f,p){f=Ra(p,f),f=j0(l.stateNode,f,2),l=dl(l,f,2),l!==null&&(Aa(l,2),js(l))}function Cn(l,f,p){if(l.tag===3)kM(l,l,p);else for(;f!==null;){if(f.tag===3){kM(f,l,p);break}else if(f.tag===1){var y=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof y.componentDidCatch=="function"&&(wl===null||!wl.has(y))){l=Ra(p,l),p=$N(2),y=dl(f,p,2),y!==null&&(LN(p,y,f,l),Aa(y,2),js(y));break}}f=f.return}}function fE(l,f,p){var y=l.pingCache;if(y===null){y=l.pingCache=new HG;var T=new Set;y.set(f,T)}else T=y.get(f),T===void 0&&(T=new Set,y.set(f,T));T.has(p)||(tE=!0,T.add(p),l=YG.bind(null,l,f,p),f.then(l,l))}function YG(l,f,p){var y=l.pingCache;y!==null&&y.delete(f),l.pingedLanes|=l.suspendedLanes&p,l.warmLanes&=~p,Pn===l&&(en&p)===p&&(Kn===4||Kn===3&&(en&62914560)===en&&300>We()-iE?(mn&2)===0&&df(l,0):nE|=p,uf===en&&(uf=0)),js(l)}function NM(l,f){f===0&&(f=hn()),l=Wc(l,f),l!==null&&(Aa(l,f),js(l))}function ZG(l){var f=l.memoizedState,p=0;f!==null&&(p=f.retryLane),NM(l,p)}function XG(l,f){var p=0;switch(l.tag){case 13:var y=l.stateNode,T=l.memoizedState;T!==null&&(p=T.retryLane);break;case 19:y=l.stateNode;break;case 22:y=l.stateNode._retryCache;break;default:throw Error(r(314))}y!==null&&y.delete(f),NM(l,p)}function QG(l,f){return _e(l,f)}var fy=null,pf=null,dE=!1,dy=!1,hE=!1,Pu=0;function js(l){l!==pf&&l.next===null&&(pf===null?fy=pf=l:pf=pf.next=l),dy=!0,dE||(dE=!0,t7())}function Dh(l,f){if(!hE&&dy){hE=!0;do for(var p=!1,y=fy;y!==null;){if(l!==0){var T=y.pendingLanes;if(T===0)var x=0;else{var q=y.suspendedLanes,Z=y.pingedLanes;x=(1<<31-nt(42|l)+1)-1,x&=T&~(q&~Z),x=x&201326741?x&201326741|1:x?x|2:0}x!==0&&(p=!0,LM(y,x))}else x=en,x=Le(y,y===Pn?x:0,y.cancelPendingCommit!==null||y.timeoutHandle!==-1),(x&3)===0||ft(y,x)||(p=!0,LM(y,x));y=y.next}while(p);hE=!1}}function e7(){MM()}function MM(){dy=dE=!1;var l=0;Pu!==0&&(u7()&&(l=Pu),Pu=0);for(var f=We(),p=null,y=fy;y!==null;){var T=y.next,x=DM(y,f);x===0?(y.next=null,p===null?fy=T:p.next=T,T===null&&(pf=p)):(p=y,(l!==0||(x&3)!==0)&&(dy=!0)),y=T}Dh(l)}function DM(l,f){for(var p=l.suspendedLanes,y=l.pingedLanes,T=l.expirationTimes,x=l.pendingLanes&-62914561;0<x;){var q=31-nt(x),Z=1<<q,ce=T[q];ce===-1?((Z&p)===0||(Z&y)!==0)&&(T[q]=Bt(Z,f)):ce<=f&&(l.expiredLanes|=Z),x&=~Z}if(f=Pn,p=en,p=Le(l,l===f?p:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),y=l.callbackNode,p===0||l===f&&(gn===2||gn===9)||l.cancelPendingCommit!==null)return y!==null&&y!==null&&Me(y),l.callbackNode=null,l.callbackPriority=0;if((p&3)===0||ft(l,p)){if(f=p&-p,f===l.callbackPriority)return f;switch(y!==null&&Me(y),du(p)){case 2:case 8:p=He;break;case 32:p=At;break;case 268435456:p=ze;break;default:p=At}return y=$M.bind(null,l),p=_e(p,y),l.callbackPriority=f,l.callbackNode=p,f}return y!==null&&y!==null&&Me(y),l.callbackPriority=2,l.callbackNode=null,2}function $M(l,f){if(Fr!==0&&Fr!==5)return l.callbackNode=null,l.callbackPriority=0,null;var p=l.callbackNode;if(cy()&&l.callbackNode!==p)return null;var y=en;return y=Le(l,l===Pn?y:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),y===0?null:(vM(l,y,f),DM(l,We()),l.callbackNode!=null&&l.callbackNode===p?$M.bind(null,l):null)}function LM(l,f){if(cy())return null;vM(l,f,!0)}function t7(){f7(function(){(mn&6)!==0?_e(Pe,e7):MM()})}function pE(){return Pu===0&&(Pu=sn()),Pu}function UM(l){return l==null||typeof l=="symbol"||typeof l=="boolean"?null:typeof l=="function"?l:Sg(""+l)}function jM(l,f){var p=f.ownerDocument.createElement("input");return p.name=f.name,p.value=f.value,l.id&&p.setAttribute("form",l.id),f.parentNode.insertBefore(p,f),l=new FormData(l),p.parentNode.removeChild(p),l}function n7(l,f,p,y,T){if(f==="submit"&&p&&p.stateNode===T){var x=UM((T[ge]||null).action),q=y.submitter;q&&(f=(f=q[ge]||null)?UM(f.formAction):q.getAttribute("formAction"),f!==null&&(x=f,q=null));var Z=new xg("action","action",null,y,T);l.push({event:Z,listeners:[{instance:null,listener:function(){if(y.defaultPrevented){if(Pu!==0){var ce=q?jM(T,q):new FormData(T);M0(p,{pending:!0,data:ce,method:T.method,action:x},null,ce)}}else typeof x=="function"&&(Z.preventDefault(),ce=q?jM(T,q):new FormData(T),M0(p,{pending:!0,data:ce,method:T.method,action:x},x,ce))},currentTarget:T}]})}}for(var mE=0;mE<Qw.length;mE++){var gE=Qw[mE],r7=gE.toLowerCase(),i7=gE[0].toUpperCase()+gE.slice(1);is(r7,"on"+i7)}is(vk,"onAnimationEnd"),is(_k,"onAnimationIteration"),is(bk,"onAnimationStart"),is("dblclick","onDoubleClick"),is("focusin","onFocus"),is("focusout","onBlur"),is(wG,"onTransitionRun"),is(EG,"onTransitionStart"),is(SG,"onTransitionCancel"),is(wk,"onTransitionEnd"),ln("onMouseEnter",["mouseout","mouseover"]),ln("onMouseLeave",["mouseout","mouseover"]),ln("onPointerEnter",["pointerout","pointerover"]),ln("onPointerLeave",["pointerout","pointerover"]),vt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),vt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),vt("onBeforeInput",["compositionend","keypress","textInput","paste"]),vt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),vt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),vt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var $h="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),a7=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat($h));function FM(l,f){f=(f&4)!==0;for(var p=0;p<l.length;p++){var y=l[p],T=y.event;y=y.listeners;e:{var x=void 0;if(f)for(var q=y.length-1;0<=q;q--){var Z=y[q],ce=Z.instance,Re=Z.currentTarget;if(Z=Z.listener,ce!==x&&T.isPropagationStopped())break e;x=Z,T.currentTarget=Re;try{x(T)}catch(Fe){Qg(Fe)}T.currentTarget=null,x=ce}else for(q=0;q<y.length;q++){if(Z=y[q],ce=Z.instance,Re=Z.currentTarget,Z=Z.listener,ce!==x&&T.isPropagationStopped())break e;x=Z,T.currentTarget=Re;try{x(T)}catch(Fe){Qg(Fe)}T.currentTarget=null,x=ce}}}}function Kt(l,f){var p=f[Q];p===void 0&&(p=f[Q]=new Set);var y=l+"__bubble";p.has(y)||(BM(f,l,2,!1),p.add(y))}function yE(l,f,p){var y=0;f&&(y|=4),BM(p,l,y,f)}var hy="_reactListening"+Math.random().toString(36).slice(2);function vE(l){if(!l[hy]){l[hy]=!0,pn.forEach(function(p){p!=="selectionchange"&&(a7.has(p)||yE(p,!1,l),yE(p,!0,l))});var f=l.nodeType===9?l:l.ownerDocument;f===null||f[hy]||(f[hy]=!0,yE("selectionchange",!1,f))}}function BM(l,f,p,y){switch(fD(f)){case 2:var T=k7;break;case 8:T=N7;break;default:T=kE}p=T.bind(null,f,p,l),T=void 0,!Fw||f!=="touchstart"&&f!=="touchmove"&&f!=="wheel"||(T=!0),y?T!==void 0?l.addEventListener(f,p,{capture:!0,passive:T}):l.addEventListener(f,p,!0):T!==void 0?l.addEventListener(f,p,{passive:T}):l.addEventListener(f,p,!1)}function _E(l,f,p,y,T){var x=y;if((f&1)===0&&(f&2)===0&&y!==null)e:for(;;){if(y===null)return;var q=y.tag;if(q===3||q===4){var Z=y.stateNode.containerInfo;if(Z===T)break;if(q===4)for(q=y.return;q!==null;){var ce=q.tag;if((ce===3||ce===4)&&q.stateNode.containerInfo===T)return;q=q.return}for(;Z!==null;){if(q=dt(Z),q===null)return;if(ce=q.tag,ce===5||ce===6||ce===26||ce===27){y=x=q;continue e}Z=Z.parentNode}}y=y.return}KO(function(){var Re=x,Fe=Uw(p),Ve=[];e:{var ke=Ek.get(l);if(ke!==void 0){var De=xg,Et=l;switch(l){case"keypress":if(Ag(p)===0)break e;case"keydown":case"keyup":De=QH;break;case"focusin":Et="focus",De=zw;break;case"focusout":Et="blur",De=zw;break;case"beforeblur":case"afterblur":De=zw;break;case"click":if(p.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":De=ZO;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":De=BH;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":De=nG;break;case vk:case _k:case bk:De=zH;break;case wk:De=iG;break;case"scroll":case"scrollend":De=jH;break;case"wheel":De=sG;break;case"copy":case"cut":case"paste":De=GH;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":De=QO;break;case"toggle":case"beforetoggle":De=lG}var _t=(f&4)!==0,En=!_t&&(l==="scroll"||l==="scrollend"),be=_t?ke!==null?ke+"Capture":null:ke;_t=[];for(var ye=Re,xe;ye!==null;){var qe=ye;if(xe=qe.stateNode,qe=qe.tag,qe!==5&&qe!==26&&qe!==27||xe===null||be===null||(qe=th(ye,be),qe!=null&&_t.push(Lh(ye,qe,xe))),En)break;ye=ye.return}0<_t.length&&(ke=new De(ke,Et,null,p,Fe),Ve.push({event:ke,listeners:_t}))}}if((f&7)===0){e:{if(ke=l==="mouseover"||l==="pointerover",De=l==="mouseout"||l==="pointerout",ke&&p!==Lw&&(Et=p.relatedTarget||p.fromElement)&&(dt(Et)||Et[Oe]))break e;if((De||ke)&&(ke=Fe.window===Fe?Fe:(ke=Fe.ownerDocument)?ke.defaultView||ke.parentWindow:window,De?(Et=p.relatedTarget||p.toElement,De=Re,Et=Et?dt(Et):null,Et!==null&&(En=a(Et),_t=Et.tag,Et!==En||_t!==5&&_t!==27&&_t!==6)&&(Et=null)):(De=null,Et=Re),De!==Et)){if(_t=ZO,qe="onMouseLeave",be="onMouseEnter",ye="mouse",(l==="pointerout"||l==="pointerover")&&(_t=QO,qe="onPointerLeave",be="onPointerEnter",ye="pointer"),En=De==null?ke:on(De),xe=Et==null?ke:on(Et),ke=new _t(qe,ye+"leave",De,p,Fe),ke.target=En,ke.relatedTarget=xe,qe=null,dt(Fe)===Re&&(_t=new _t(be,ye+"enter",Et,p,Fe),_t.target=xe,_t.relatedTarget=En,qe=_t),En=qe,De&&Et)t:{for(_t=De,be=Et,ye=0,xe=_t;xe;xe=mf(xe))ye++;for(xe=0,qe=be;qe;qe=mf(qe))xe++;for(;0<ye-xe;)_t=mf(_t),ye--;for(;0<xe-ye;)be=mf(be),xe--;for(;ye--;){if(_t===be||be!==null&&_t===be.alternate)break t;_t=mf(_t),be=mf(be)}_t=null}else _t=null;De!==null&&qM(Ve,ke,De,_t,!1),Et!==null&&En!==null&&qM(Ve,En,Et,_t,!0)}}e:{if(ke=Re?on(Re):window,De=ke.nodeName&&ke.nodeName.toLowerCase(),De==="select"||De==="input"&&ke.type==="file")var ut=ok;else if(ak(ke))if(lk)ut=vG;else{ut=gG;var zt=mG}else De=ke.nodeName,!De||De.toLowerCase()!=="input"||ke.type!=="checkbox"&&ke.type!=="radio"?Re&&$w(Re.elementType)&&(ut=ok):ut=yG;if(ut&&(ut=ut(l,Re))){sk(Ve,ut,p,Fe);break e}zt&&zt(l,ke,Re),l==="focusout"&&Re&&ke.type==="number"&&Re.memoizedProps.value!=null&&Dw(ke,"number",ke.value)}switch(zt=Re?on(Re):window,l){case"focusin":(ak(zt)||zt.contentEditable==="true")&&(zc=zt,Yw=Re,uh=null);break;case"focusout":uh=Yw=zc=null;break;case"mousedown":Zw=!0;break;case"contextmenu":case"mouseup":case"dragend":Zw=!1,gk(Ve,p,Fe);break;case"selectionchange":if(bG)break;case"keydown":case"keyup":gk(Ve,p,Fe)}var pt;if(Gw)e:{switch(l){case"compositionstart":var bt="onCompositionStart";break e;case"compositionend":bt="onCompositionEnd";break e;case"compositionupdate":bt="onCompositionUpdate";break e}bt=void 0}else Vc?rk(l,p)&&(bt="onCompositionEnd"):l==="keydown"&&p.keyCode===229&&(bt="onCompositionStart");bt&&(ek&&p.locale!=="ko"&&(Vc||bt!=="onCompositionStart"?bt==="onCompositionEnd"&&Vc&&(pt=JO()):(ll=Fe,Bw="value"in ll?ll.value:ll.textContent,Vc=!0)),zt=py(Re,bt),0<zt.length&&(bt=new XO(bt,l,null,p,Fe),Ve.push({event:bt,listeners:zt}),pt?bt.data=pt:(pt=ik(p),pt!==null&&(bt.data=pt)))),(pt=cG?fG(l,p):dG(l,p))&&(bt=py(Re,"onBeforeInput"),0<bt.length&&(zt=new XO("onBeforeInput","beforeinput",null,p,Fe),Ve.push({event:zt,listeners:bt}),zt.data=pt)),n7(Ve,l,Re,p,Fe)}FM(Ve,f)})}function Lh(l,f,p){return{instance:l,listener:f,currentTarget:p}}function py(l,f){for(var p=f+"Capture",y=[];l!==null;){var T=l,x=T.stateNode;if(T=T.tag,T!==5&&T!==26&&T!==27||x===null||(T=th(l,p),T!=null&&y.unshift(Lh(l,T,x)),T=th(l,f),T!=null&&y.push(Lh(l,T,x))),l.tag===3)return y;l=l.return}return[]}function mf(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5&&l.tag!==27);return l||null}function qM(l,f,p,y,T){for(var x=f._reactName,q=[];p!==null&&p!==y;){var Z=p,ce=Z.alternate,Re=Z.stateNode;if(Z=Z.tag,ce!==null&&ce===y)break;Z!==5&&Z!==26&&Z!==27||Re===null||(ce=Re,T?(Re=th(p,x),Re!=null&&q.unshift(Lh(p,Re,ce))):T||(Re=th(p,x),Re!=null&&q.push(Lh(p,Re,ce)))),p=p.return}q.length!==0&&l.push({event:f,listeners:q})}var s7=/\r\n?/g,o7=/\u0000|\uFFFD/g;function VM(l){return(typeof l=="string"?l:""+l).replace(s7,`
`).replace(o7,"")}function zM(l,f){return f=VM(f),VM(l)===f}function my(){}function wn(l,f,p,y,T,x){switch(p){case"children":typeof y=="string"?f==="body"||f==="textarea"&&y===""||Fc(l,y):(typeof y=="number"||typeof y=="bigint")&&f!=="body"&&Fc(l,""+y);break;case"className":rs(l,"class",y);break;case"tabIndex":rs(l,"tabindex",y);break;case"dir":case"role":case"viewBox":case"width":case"height":rs(l,p,y);break;case"style":GO(l,y,x);break;case"data":if(f!=="object"){rs(l,"data",y);break}case"src":case"href":if(y===""&&(f!=="a"||p!=="href")){l.removeAttribute(p);break}if(y==null||typeof y=="function"||typeof y=="symbol"||typeof y=="boolean"){l.removeAttribute(p);break}y=Sg(""+y),l.setAttribute(p,y);break;case"action":case"formAction":if(typeof y=="function"){l.setAttribute(p,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof x=="function"&&(p==="formAction"?(f!=="input"&&wn(l,f,"name",T.name,T,null),wn(l,f,"formEncType",T.formEncType,T,null),wn(l,f,"formMethod",T.formMethod,T,null),wn(l,f,"formTarget",T.formTarget,T,null)):(wn(l,f,"encType",T.encType,T,null),wn(l,f,"method",T.method,T,null),wn(l,f,"target",T.target,T,null)));if(y==null||typeof y=="symbol"||typeof y=="boolean"){l.removeAttribute(p);break}y=Sg(""+y),l.setAttribute(p,y);break;case"onClick":y!=null&&(l.onclick=my);break;case"onScroll":y!=null&&Kt("scroll",l);break;case"onScrollEnd":y!=null&&Kt("scrollend",l);break;case"dangerouslySetInnerHTML":if(y!=null){if(typeof y!="object"||!("__html"in y))throw Error(r(61));if(p=y.__html,p!=null){if(T.children!=null)throw Error(r(60));l.innerHTML=p}}break;case"multiple":l.multiple=y&&typeof y!="function"&&typeof y!="symbol";break;case"muted":l.muted=y&&typeof y!="function"&&typeof y!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(y==null||typeof y=="function"||typeof y=="boolean"||typeof y=="symbol"){l.removeAttribute("xlink:href");break}p=Sg(""+y),l.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",p);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":y!=null&&typeof y!="function"&&typeof y!="symbol"?l.setAttribute(p,""+y):l.removeAttribute(p);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":y&&typeof y!="function"&&typeof y!="symbol"?l.setAttribute(p,""):l.removeAttribute(p);break;case"capture":case"download":y===!0?l.setAttribute(p,""):y!==!1&&y!=null&&typeof y!="function"&&typeof y!="symbol"?l.setAttribute(p,y):l.removeAttribute(p);break;case"cols":case"rows":case"size":case"span":y!=null&&typeof y!="function"&&typeof y!="symbol"&&!isNaN(y)&&1<=y?l.setAttribute(p,y):l.removeAttribute(p);break;case"rowSpan":case"start":y==null||typeof y=="function"||typeof y=="symbol"||isNaN(y)?l.removeAttribute(p):l.setAttribute(p,y);break;case"popover":Kt("beforetoggle",l),Kt("toggle",l),di(l,"popover",y);break;case"xlinkActuate":Lr(l,"http://www.w3.org/1999/xlink","xlink:actuate",y);break;case"xlinkArcrole":Lr(l,"http://www.w3.org/1999/xlink","xlink:arcrole",y);break;case"xlinkRole":Lr(l,"http://www.w3.org/1999/xlink","xlink:role",y);break;case"xlinkShow":Lr(l,"http://www.w3.org/1999/xlink","xlink:show",y);break;case"xlinkTitle":Lr(l,"http://www.w3.org/1999/xlink","xlink:title",y);break;case"xlinkType":Lr(l,"http://www.w3.org/1999/xlink","xlink:type",y);break;case"xmlBase":Lr(l,"http://www.w3.org/XML/1998/namespace","xml:base",y);break;case"xmlLang":Lr(l,"http://www.w3.org/XML/1998/namespace","xml:lang",y);break;case"xmlSpace":Lr(l,"http://www.w3.org/XML/1998/namespace","xml:space",y);break;case"is":di(l,"is",y);break;case"innerText":case"textContent":break;default:(!(2<p.length)||p[0]!=="o"&&p[0]!=="O"||p[1]!=="n"&&p[1]!=="N")&&(p=LH.get(p)||p,di(l,p,y))}}function bE(l,f,p,y,T,x){switch(p){case"style":GO(l,y,x);break;case"dangerouslySetInnerHTML":if(y!=null){if(typeof y!="object"||!("__html"in y))throw Error(r(61));if(p=y.__html,p!=null){if(T.children!=null)throw Error(r(60));l.innerHTML=p}}break;case"children":typeof y=="string"?Fc(l,y):(typeof y=="number"||typeof y=="bigint")&&Fc(l,""+y);break;case"onScroll":y!=null&&Kt("scroll",l);break;case"onScrollEnd":y!=null&&Kt("scrollend",l);break;case"onClick":y!=null&&(l.onclick=my);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Dn.hasOwnProperty(p))e:{if(p[0]==="o"&&p[1]==="n"&&(T=p.endsWith("Capture"),f=p.slice(2,T?p.length-7:void 0),x=l[ge]||null,x=x!=null?x[p]:null,typeof x=="function"&&l.removeEventListener(f,x,T),typeof y=="function")){typeof x!="function"&&x!==null&&(p in l?l[p]=null:l.hasAttribute(p)&&l.removeAttribute(p)),l.addEventListener(f,y,T);break e}p in l?l[p]=y:y===!0?l.setAttribute(p,""):di(l,p,y)}}}function Br(l,f,p){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Kt("error",l),Kt("load",l);var y=!1,T=!1,x;for(x in p)if(p.hasOwnProperty(x)){var q=p[x];if(q!=null)switch(x){case"src":y=!0;break;case"srcSet":T=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,f));default:wn(l,f,x,q,p,null)}}T&&wn(l,f,"srcSet",p.srcSet,p,null),y&&wn(l,f,"src",p.src,p,null);return;case"input":Kt("invalid",l);var Z=x=q=T=null,ce=null,Re=null;for(y in p)if(p.hasOwnProperty(y)){var Fe=p[y];if(Fe!=null)switch(y){case"name":T=Fe;break;case"type":q=Fe;break;case"checked":ce=Fe;break;case"defaultChecked":Re=Fe;break;case"value":x=Fe;break;case"defaultValue":Z=Fe;break;case"children":case"dangerouslySetInnerHTML":if(Fe!=null)throw Error(r(137,f));break;default:wn(l,f,y,Fe,p,null)}}qO(l,x,Z,ce,Re,q,T,!1),pu(l);return;case"select":Kt("invalid",l),y=q=x=null;for(T in p)if(p.hasOwnProperty(T)&&(Z=p[T],Z!=null))switch(T){case"value":x=Z;break;case"defaultValue":q=Z;break;case"multiple":y=Z;default:wn(l,f,T,Z,p,null)}f=x,p=q,l.multiple=!!y,f!=null?jc(l,!!y,f,!1):p!=null&&jc(l,!!y,p,!0);return;case"textarea":Kt("invalid",l),x=T=y=null;for(q in p)if(p.hasOwnProperty(q)&&(Z=p[q],Z!=null))switch(q){case"value":y=Z;break;case"defaultValue":T=Z;break;case"children":x=Z;break;case"dangerouslySetInnerHTML":if(Z!=null)throw Error(r(91));break;default:wn(l,f,q,Z,p,null)}zO(l,y,T,x),pu(l);return;case"option":for(ce in p)if(p.hasOwnProperty(ce)&&(y=p[ce],y!=null))switch(ce){case"selected":l.selected=y&&typeof y!="function"&&typeof y!="symbol";break;default:wn(l,f,ce,y,p,null)}return;case"dialog":Kt("beforetoggle",l),Kt("toggle",l),Kt("cancel",l),Kt("close",l);break;case"iframe":case"object":Kt("load",l);break;case"video":case"audio":for(y=0;y<$h.length;y++)Kt($h[y],l);break;case"image":Kt("error",l),Kt("load",l);break;case"details":Kt("toggle",l);break;case"embed":case"source":case"link":Kt("error",l),Kt("load",l);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Re in p)if(p.hasOwnProperty(Re)&&(y=p[Re],y!=null))switch(Re){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,f));default:wn(l,f,Re,y,p,null)}return;default:if($w(f)){for(Fe in p)p.hasOwnProperty(Fe)&&(y=p[Fe],y!==void 0&&bE(l,f,Fe,y,p,void 0));return}}for(Z in p)p.hasOwnProperty(Z)&&(y=p[Z],y!=null&&wn(l,f,Z,y,p,null))}function l7(l,f,p,y){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var T=null,x=null,q=null,Z=null,ce=null,Re=null,Fe=null;for(De in p){var Ve=p[De];if(p.hasOwnProperty(De)&&Ve!=null)switch(De){case"checked":break;case"value":break;case"defaultValue":ce=Ve;default:y.hasOwnProperty(De)||wn(l,f,De,null,y,Ve)}}for(var ke in y){var De=y[ke];if(Ve=p[ke],y.hasOwnProperty(ke)&&(De!=null||Ve!=null))switch(ke){case"type":x=De;break;case"name":T=De;break;case"checked":Re=De;break;case"defaultChecked":Fe=De;break;case"value":q=De;break;case"defaultValue":Z=De;break;case"children":case"dangerouslySetInnerHTML":if(De!=null)throw Error(r(137,f));break;default:De!==Ve&&wn(l,f,ke,De,y,Ve)}}Mw(l,q,Z,ce,Re,Fe,x,T);return;case"select":De=q=Z=ke=null;for(x in p)if(ce=p[x],p.hasOwnProperty(x)&&ce!=null)switch(x){case"value":break;case"multiple":De=ce;default:y.hasOwnProperty(x)||wn(l,f,x,null,y,ce)}for(T in y)if(x=y[T],ce=p[T],y.hasOwnProperty(T)&&(x!=null||ce!=null))switch(T){case"value":ke=x;break;case"defaultValue":Z=x;break;case"multiple":q=x;default:x!==ce&&wn(l,f,T,x,y,ce)}f=Z,p=q,y=De,ke!=null?jc(l,!!p,ke,!1):!!y!=!!p&&(f!=null?jc(l,!!p,f,!0):jc(l,!!p,p?[]:"",!1));return;case"textarea":De=ke=null;for(Z in p)if(T=p[Z],p.hasOwnProperty(Z)&&T!=null&&!y.hasOwnProperty(Z))switch(Z){case"value":break;case"children":break;default:wn(l,f,Z,null,y,T)}for(q in y)if(T=y[q],x=p[q],y.hasOwnProperty(q)&&(T!=null||x!=null))switch(q){case"value":ke=T;break;case"defaultValue":De=T;break;case"children":break;case"dangerouslySetInnerHTML":if(T!=null)throw Error(r(91));break;default:T!==x&&wn(l,f,q,T,y,x)}VO(l,ke,De);return;case"option":for(var Et in p)if(ke=p[Et],p.hasOwnProperty(Et)&&ke!=null&&!y.hasOwnProperty(Et))switch(Et){case"selected":l.selected=!1;break;default:wn(l,f,Et,null,y,ke)}for(ce in y)if(ke=y[ce],De=p[ce],y.hasOwnProperty(ce)&&ke!==De&&(ke!=null||De!=null))switch(ce){case"selected":l.selected=ke&&typeof ke!="function"&&typeof ke!="symbol";break;default:wn(l,f,ce,ke,y,De)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var _t in p)ke=p[_t],p.hasOwnProperty(_t)&&ke!=null&&!y.hasOwnProperty(_t)&&wn(l,f,_t,null,y,ke);for(Re in y)if(ke=y[Re],De=p[Re],y.hasOwnProperty(Re)&&ke!==De&&(ke!=null||De!=null))switch(Re){case"children":case"dangerouslySetInnerHTML":if(ke!=null)throw Error(r(137,f));break;default:wn(l,f,Re,ke,y,De)}return;default:if($w(f)){for(var En in p)ke=p[En],p.hasOwnProperty(En)&&ke!==void 0&&!y.hasOwnProperty(En)&&bE(l,f,En,void 0,y,ke);for(Fe in y)ke=y[Fe],De=p[Fe],!y.hasOwnProperty(Fe)||ke===De||ke===void 0&&De===void 0||bE(l,f,Fe,ke,y,De);return}}for(var be in p)ke=p[be],p.hasOwnProperty(be)&&ke!=null&&!y.hasOwnProperty(be)&&wn(l,f,be,null,y,ke);for(Ve in y)ke=y[Ve],De=p[Ve],!y.hasOwnProperty(Ve)||ke===De||ke==null&&De==null||wn(l,f,Ve,ke,y,De)}var wE=null,EE=null;function gy(l){return l.nodeType===9?l:l.ownerDocument}function HM(l){switch(l){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function GM(l,f){if(l===0)switch(f){case"svg":return 1;case"math":return 2;default:return 0}return l===1&&f==="foreignObject"?0:l}function SE(l,f){return l==="textarea"||l==="noscript"||typeof f.children=="string"||typeof f.children=="number"||typeof f.children=="bigint"||typeof f.dangerouslySetInnerHTML=="object"&&f.dangerouslySetInnerHTML!==null&&f.dangerouslySetInnerHTML.__html!=null}var TE=null;function u7(){var l=window.event;return l&&l.type==="popstate"?l===TE?!1:(TE=l,!0):(TE=null,!1)}var WM=typeof setTimeout=="function"?setTimeout:void 0,c7=typeof clearTimeout=="function"?clearTimeout:void 0,KM=typeof Promise=="function"?Promise:void 0,f7=typeof queueMicrotask=="function"?queueMicrotask:typeof KM<"u"?function(l){return KM.resolve(null).then(l).catch(d7)}:WM;function d7(l){setTimeout(function(){throw l})}function Tl(l){return l==="head"}function JM(l,f){var p=f,y=0,T=0;do{var x=p.nextSibling;if(l.removeChild(p),x&&x.nodeType===8)if(p=x.data,p==="/$"){if(0<y&&8>y){p=y;var q=l.ownerDocument;if(p&1&&Uh(q.documentElement),p&2&&Uh(q.body),p&4)for(p=q.head,Uh(p),q=p.firstChild;q;){var Z=q.nextSibling,ce=q.nodeName;q[Ee]||ce==="SCRIPT"||ce==="STYLE"||ce==="LINK"&&q.rel.toLowerCase()==="stylesheet"||p.removeChild(q),q=Z}}if(T===0){l.removeChild(x),Gh(f);return}T--}else p==="$"||p==="$?"||p==="$!"?T++:y=p.charCodeAt(0)-48;else y=0;p=x}while(p);Gh(f)}function AE(l){var f=l.firstChild;for(f&&f.nodeType===10&&(f=f.nextSibling);f;){var p=f;switch(f=f.nextSibling,p.nodeName){case"HTML":case"HEAD":case"BODY":AE(p),et(p);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(p.rel.toLowerCase()==="stylesheet")continue}l.removeChild(p)}}function h7(l,f,p,y){for(;l.nodeType===1;){var T=p;if(l.nodeName.toLowerCase()!==f.toLowerCase()){if(!y&&(l.nodeName!=="INPUT"||l.type!=="hidden"))break}else if(y){if(!l[Ee])switch(f){case"meta":if(!l.hasAttribute("itemprop"))break;return l;case"link":if(x=l.getAttribute("rel"),x==="stylesheet"&&l.hasAttribute("data-precedence"))break;if(x!==T.rel||l.getAttribute("href")!==(T.href==null||T.href===""?null:T.href)||l.getAttribute("crossorigin")!==(T.crossOrigin==null?null:T.crossOrigin)||l.getAttribute("title")!==(T.title==null?null:T.title))break;return l;case"style":if(l.hasAttribute("data-precedence"))break;return l;case"script":if(x=l.getAttribute("src"),(x!==(T.src==null?null:T.src)||l.getAttribute("type")!==(T.type==null?null:T.type)||l.getAttribute("crossorigin")!==(T.crossOrigin==null?null:T.crossOrigin))&&x&&l.hasAttribute("async")&&!l.hasAttribute("itemprop"))break;return l;default:return l}}else if(f==="input"&&l.type==="hidden"){var x=T.name==null?null:""+T.name;if(T.type==="hidden"&&l.getAttribute("name")===x)return l}else return l;if(l=ss(l.nextSibling),l===null)break}return null}function p7(l,f,p){if(f==="")return null;for(;l.nodeType!==3;)if((l.nodeType!==1||l.nodeName!=="INPUT"||l.type!=="hidden")&&!p||(l=ss(l.nextSibling),l===null))return null;return l}function CE(l){return l.data==="$!"||l.data==="$?"&&l.ownerDocument.readyState==="complete"}function m7(l,f){var p=l.ownerDocument;if(l.data!=="$?"||p.readyState==="complete")f();else{var y=function(){f(),p.removeEventListener("DOMContentLoaded",y)};p.addEventListener("DOMContentLoaded",y),l._reactRetry=y}}function ss(l){for(;l!=null;l=l.nextSibling){var f=l.nodeType;if(f===1||f===3)break;if(f===8){if(f=l.data,f==="$"||f==="$!"||f==="$?"||f==="F!"||f==="F")break;if(f==="/$")return null}}return l}var xE=null;function YM(l){l=l.previousSibling;for(var f=0;l;){if(l.nodeType===8){var p=l.data;if(p==="$"||p==="$!"||p==="$?"){if(f===0)return l;f--}else p==="/$"&&f++}l=l.previousSibling}return null}function ZM(l,f,p){switch(f=gy(p),l){case"html":if(l=f.documentElement,!l)throw Error(r(452));return l;case"head":if(l=f.head,!l)throw Error(r(453));return l;case"body":if(l=f.body,!l)throw Error(r(454));return l;default:throw Error(r(451))}}function Uh(l){for(var f=l.attributes;f.length;)l.removeAttributeNode(f[0]);et(l)}var Ma=new Map,XM=new Set;function yy(l){return typeof l.getRootNode=="function"?l.getRootNode():l.nodeType===9?l:l.ownerDocument}var Po=le.d;le.d={f:g7,r:y7,D:v7,C:_7,L:b7,m:w7,X:S7,S:E7,M:T7};function g7(){var l=Po.f(),f=ly();return l||f}function y7(l){var f=$t(l);f!==null&&f.tag===5&&f.type==="form"?vN(f):Po.r(l)}var gf=typeof document>"u"?null:document;function QM(l,f,p){var y=gf;if(y&&typeof f=="string"&&f){var T=xa(f);T='link[rel="'+l+'"][href="'+T+'"]',typeof p=="string"&&(T+='[crossorigin="'+p+'"]'),XM.has(T)||(XM.add(T),l={rel:l,crossOrigin:p,href:f},y.querySelector(T)===null&&(f=y.createElement("link"),Br(f,"link",l),gt(f),y.head.appendChild(f)))}}function v7(l){Po.D(l),QM("dns-prefetch",l,null)}function _7(l,f){Po.C(l,f),QM("preconnect",l,f)}function b7(l,f,p){Po.L(l,f,p);var y=gf;if(y&&l&&f){var T='link[rel="preload"][as="'+xa(f)+'"]';f==="image"&&p&&p.imageSrcSet?(T+='[imagesrcset="'+xa(p.imageSrcSet)+'"]',typeof p.imageSizes=="string"&&(T+='[imagesizes="'+xa(p.imageSizes)+'"]')):T+='[href="'+xa(l)+'"]';var x=T;switch(f){case"style":x=yf(l);break;case"script":x=vf(l)}Ma.has(x)||(l=d({rel:"preload",href:f==="image"&&p&&p.imageSrcSet?void 0:l,as:f},p),Ma.set(x,l),y.querySelector(T)!==null||f==="style"&&y.querySelector(jh(x))||f==="script"&&y.querySelector(Fh(x))||(f=y.createElement("link"),Br(f,"link",l),gt(f),y.head.appendChild(f)))}}function w7(l,f){Po.m(l,f);var p=gf;if(p&&l){var y=f&&typeof f.as=="string"?f.as:"script",T='link[rel="modulepreload"][as="'+xa(y)+'"][href="'+xa(l)+'"]',x=T;switch(y){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":x=vf(l)}if(!Ma.has(x)&&(l=d({rel:"modulepreload",href:l},f),Ma.set(x,l),p.querySelector(T)===null)){switch(y){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(p.querySelector(Fh(x)))return}y=p.createElement("link"),Br(y,"link",l),gt(y),p.head.appendChild(y)}}}function E7(l,f,p){Po.S(l,f,p);var y=gf;if(y&&l){var T=_n(y).hoistableStyles,x=yf(l);f=f||"default";var q=T.get(x);if(!q){var Z={loading:0,preload:null};if(q=y.querySelector(jh(x)))Z.loading=5;else{l=d({rel:"stylesheet",href:l,"data-precedence":f},p),(p=Ma.get(x))&&RE(l,p);var ce=q=y.createElement("link");gt(ce),Br(ce,"link",l),ce._p=new Promise(function(Re,Fe){ce.onload=Re,ce.onerror=Fe}),ce.addEventListener("load",function(){Z.loading|=1}),ce.addEventListener("error",function(){Z.loading|=2}),Z.loading|=4,vy(q,f,y)}q={type:"stylesheet",instance:q,count:1,state:Z},T.set(x,q)}}}function S7(l,f){Po.X(l,f);var p=gf;if(p&&l){var y=_n(p).hoistableScripts,T=vf(l),x=y.get(T);x||(x=p.querySelector(Fh(T)),x||(l=d({src:l,async:!0},f),(f=Ma.get(T))&&IE(l,f),x=p.createElement("script"),gt(x),Br(x,"link",l),p.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},y.set(T,x))}}function T7(l,f){Po.M(l,f);var p=gf;if(p&&l){var y=_n(p).hoistableScripts,T=vf(l),x=y.get(T);x||(x=p.querySelector(Fh(T)),x||(l=d({src:l,async:!0,type:"module"},f),(f=Ma.get(T))&&IE(l,f),x=p.createElement("script"),gt(x),Br(x,"link",l),p.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},y.set(T,x))}}function eD(l,f,p,y){var T=(T=I.current)?yy(T):null;if(!T)throw Error(r(446));switch(l){case"meta":case"title":return null;case"style":return typeof p.precedence=="string"&&typeof p.href=="string"?(f=yf(p.href),p=_n(T).hoistableStyles,y=p.get(f),y||(y={type:"style",instance:null,count:0,state:null},p.set(f,y)),y):{type:"void",instance:null,count:0,state:null};case"link":if(p.rel==="stylesheet"&&typeof p.href=="string"&&typeof p.precedence=="string"){l=yf(p.href);var x=_n(T).hoistableStyles,q=x.get(l);if(q||(T=T.ownerDocument||T,q={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},x.set(l,q),(x=T.querySelector(jh(l)))&&!x._p&&(q.instance=x,q.state.loading=5),Ma.has(l)||(p={rel:"preload",as:"style",href:p.href,crossOrigin:p.crossOrigin,integrity:p.integrity,media:p.media,hrefLang:p.hrefLang,referrerPolicy:p.referrerPolicy},Ma.set(l,p),x||A7(T,l,p,q.state))),f&&y===null)throw Error(r(528,""));return q}if(f&&y!==null)throw Error(r(529,""));return null;case"script":return f=p.async,p=p.src,typeof p=="string"&&f&&typeof f!="function"&&typeof f!="symbol"?(f=vf(p),p=_n(T).hoistableScripts,y=p.get(f),y||(y={type:"script",instance:null,count:0,state:null},p.set(f,y)),y):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,l))}}function yf(l){return'href="'+xa(l)+'"'}function jh(l){return'link[rel="stylesheet"]['+l+"]"}function tD(l){return d({},l,{"data-precedence":l.precedence,precedence:null})}function A7(l,f,p,y){l.querySelector('link[rel="preload"][as="style"]['+f+"]")?y.loading=1:(f=l.createElement("link"),y.preload=f,f.addEventListener("load",function(){return y.loading|=1}),f.addEventListener("error",function(){return y.loading|=2}),Br(f,"link",p),gt(f),l.head.appendChild(f))}function vf(l){return'[src="'+xa(l)+'"]'}function Fh(l){return"script[async]"+l}function nD(l,f,p){if(f.count++,f.instance===null)switch(f.type){case"style":var y=l.querySelector('style[data-href~="'+xa(p.href)+'"]');if(y)return f.instance=y,gt(y),y;var T=d({},p,{"data-href":p.href,"data-precedence":p.precedence,href:null,precedence:null});return y=(l.ownerDocument||l).createElement("style"),gt(y),Br(y,"style",T),vy(y,p.precedence,l),f.instance=y;case"stylesheet":T=yf(p.href);var x=l.querySelector(jh(T));if(x)return f.state.loading|=4,f.instance=x,gt(x),x;y=tD(p),(T=Ma.get(T))&&RE(y,T),x=(l.ownerDocument||l).createElement("link"),gt(x);var q=x;return q._p=new Promise(function(Z,ce){q.onload=Z,q.onerror=ce}),Br(x,"link",y),f.state.loading|=4,vy(x,p.precedence,l),f.instance=x;case"script":return x=vf(p.src),(T=l.querySelector(Fh(x)))?(f.instance=T,gt(T),T):(y=p,(T=Ma.get(x))&&(y=d({},p),IE(y,T)),l=l.ownerDocument||l,T=l.createElement("script"),gt(T),Br(T,"link",y),l.head.appendChild(T),f.instance=T);case"void":return null;default:throw Error(r(443,f.type))}else f.type==="stylesheet"&&(f.state.loading&4)===0&&(y=f.instance,f.state.loading|=4,vy(y,p.precedence,l));return f.instance}function vy(l,f,p){for(var y=p.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),T=y.length?y[y.length-1]:null,x=T,q=0;q<y.length;q++){var Z=y[q];if(Z.dataset.precedence===f)x=Z;else if(x!==T)break}x?x.parentNode.insertBefore(l,x.nextSibling):(f=p.nodeType===9?p.head:p,f.insertBefore(l,f.firstChild))}function RE(l,f){l.crossOrigin==null&&(l.crossOrigin=f.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=f.referrerPolicy),l.title==null&&(l.title=f.title)}function IE(l,f){l.crossOrigin==null&&(l.crossOrigin=f.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=f.referrerPolicy),l.integrity==null&&(l.integrity=f.integrity)}var _y=null;function rD(l,f,p){if(_y===null){var y=new Map,T=_y=new Map;T.set(p,y)}else T=_y,y=T.get(p),y||(y=new Map,T.set(p,y));if(y.has(l))return y;for(y.set(l,null),p=p.getElementsByTagName(l),T=0;T<p.length;T++){var x=p[T];if(!(x[Ee]||x[ie]||l==="link"&&x.getAttribute("rel")==="stylesheet")&&x.namespaceURI!=="http://www.w3.org/2000/svg"){var q=x.getAttribute(f)||"";q=l+q;var Z=y.get(q);Z?Z.push(x):y.set(q,[x])}}return y}function iD(l,f,p){l=l.ownerDocument||l,l.head.insertBefore(p,f==="title"?l.querySelector("head > title"):null)}function C7(l,f,p){if(p===1||f.itemProp!=null)return!1;switch(l){case"meta":case"title":return!0;case"style":if(typeof f.precedence!="string"||typeof f.href!="string"||f.href==="")break;return!0;case"link":if(typeof f.rel!="string"||typeof f.href!="string"||f.href===""||f.onLoad||f.onError)break;switch(f.rel){case"stylesheet":return l=f.disabled,typeof f.precedence=="string"&&l==null;default:return!0}case"script":if(f.async&&typeof f.async!="function"&&typeof f.async!="symbol"&&!f.onLoad&&!f.onError&&f.src&&typeof f.src=="string")return!0}return!1}function aD(l){return!(l.type==="stylesheet"&&(l.state.loading&3)===0)}var Bh=null;function x7(){}function R7(l,f,p){if(Bh===null)throw Error(r(475));var y=Bh;if(f.type==="stylesheet"&&(typeof p.media!="string"||matchMedia(p.media).matches!==!1)&&(f.state.loading&4)===0){if(f.instance===null){var T=yf(p.href),x=l.querySelector(jh(T));if(x){l=x._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(y.count++,y=by.bind(y),l.then(y,y)),f.state.loading|=4,f.instance=x,gt(x);return}x=l.ownerDocument||l,p=tD(p),(T=Ma.get(T))&&RE(p,T),x=x.createElement("link"),gt(x);var q=x;q._p=new Promise(function(Z,ce){q.onload=Z,q.onerror=ce}),Br(x,"link",p),f.instance=x}y.stylesheets===null&&(y.stylesheets=new Map),y.stylesheets.set(f,l),(l=f.state.preload)&&(f.state.loading&3)===0&&(y.count++,f=by.bind(y),l.addEventListener("load",f),l.addEventListener("error",f))}}function I7(){if(Bh===null)throw Error(r(475));var l=Bh;return l.stylesheets&&l.count===0&&PE(l,l.stylesheets),0<l.count?function(f){var p=setTimeout(function(){if(l.stylesheets&&PE(l,l.stylesheets),l.unsuspend){var y=l.unsuspend;l.unsuspend=null,y()}},6e4);return l.unsuspend=f,function(){l.unsuspend=null,clearTimeout(p)}}:null}function by(){if(this.count--,this.count===0){if(this.stylesheets)PE(this,this.stylesheets);else if(this.unsuspend){var l=this.unsuspend;this.unsuspend=null,l()}}}var wy=null;function PE(l,f){l.stylesheets=null,l.unsuspend!==null&&(l.count++,wy=new Map,f.forEach(P7,l),wy=null,by.call(l))}function P7(l,f){if(!(f.state.loading&4)){var p=wy.get(l);if(p)var y=p.get(null);else{p=new Map,wy.set(l,p);for(var T=l.querySelectorAll("link[data-precedence],style[data-precedence]"),x=0;x<T.length;x++){var q=T[x];(q.nodeName==="LINK"||q.getAttribute("media")!=="not all")&&(p.set(q.dataset.precedence,q),y=q)}y&&p.set(null,y)}T=f.instance,q=T.getAttribute("data-precedence"),x=p.get(q)||y,x===y&&p.set(null,T),p.set(q,T),this.count++,y=by.bind(this),T.addEventListener("load",y),T.addEventListener("error",y),x?x.parentNode.insertBefore(T,x.nextSibling):(l=l.nodeType===9?l.head:l,l.insertBefore(T,l.firstChild)),f.state.loading|=4}}var qh={$$typeof:A,Provider:null,Consumer:null,_currentValue:pe,_currentValue2:pe,_threadCount:0};function O7(l,f,p,y,T,x,q,Z){this.tag=1,this.containerInfo=l,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Xt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Xt(0),this.hiddenUpdates=Xt(null),this.identifierPrefix=y,this.onUncaughtError=T,this.onCaughtError=x,this.onRecoverableError=q,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Z,this.incompleteTransitions=new Map}function sD(l,f,p,y,T,x,q,Z,ce,Re,Fe,Ve){return l=new O7(l,f,p,q,Z,ce,Re,Ve),f=1,x===!0&&(f|=24),x=ra(3,null,null,f),l.current=x,x.stateNode=l,f=f0(),f.refCount++,l.pooledCache=f,f.refCount++,x.memoizedState={element:y,isDehydrated:p,cache:f},m0(x),l}function oD(l){return l?(l=Kc,l):Kc}function lD(l,f,p,y,T,x){T=oD(T),y.context===null?y.context=T:y.pendingContext=T,y=fl(f),y.payload={element:p},x=x===void 0?null:x,x!==null&&(y.callback=x),p=dl(l,y,f),p!==null&&(la(p,l,f),vh(p,l,f))}function uD(l,f){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var p=l.retryLane;l.retryLane=p!==0&&p<f?p:f}}function OE(l,f){uD(l,f),(l=l.alternate)&&uD(l,f)}function cD(l){if(l.tag===13){var f=Wc(l,67108864);f!==null&&la(f,l,67108864),OE(l,67108864)}}var Ey=!0;function k7(l,f,p,y){var T=ee.T;ee.T=null;var x=le.p;try{le.p=2,kE(l,f,p,y)}finally{le.p=x,ee.T=T}}function N7(l,f,p,y){var T=ee.T;ee.T=null;var x=le.p;try{le.p=8,kE(l,f,p,y)}finally{le.p=x,ee.T=T}}function kE(l,f,p,y){if(Ey){var T=NE(y);if(T===null)_E(l,f,y,Sy,p),dD(l,y);else if(D7(T,l,f,p,y))y.stopPropagation();else if(dD(l,y),f&4&&-1<M7.indexOf(l)){for(;T!==null;){var x=$t(T);if(x!==null)switch(x.tag){case 3:if(x=x.stateNode,x.current.memoizedState.isDehydrated){var q=Ce(x.pendingLanes);if(q!==0){var Z=x;for(Z.pendingLanes|=2,Z.entangledLanes|=2;q;){var ce=1<<31-nt(q);Z.entanglements[1]|=ce,q&=~ce}js(x),(mn&6)===0&&(sy=We()+500,Dh(0))}}break;case 13:Z=Wc(x,2),Z!==null&&la(Z,x,2),ly(),OE(x,2)}if(x=NE(y),x===null&&_E(l,f,y,Sy,p),x===T)break;T=x}T!==null&&y.stopPropagation()}else _E(l,f,y,null,p)}}function NE(l){return l=Uw(l),ME(l)}var Sy=null;function ME(l){if(Sy=null,l=dt(l),l!==null){var f=a(l);if(f===null)l=null;else{var p=f.tag;if(p===13){if(l=s(f),l!==null)return l;l=null}else if(p===3){if(f.stateNode.current.memoizedState.isDehydrated)return f.tag===3?f.stateNode.containerInfo:null;l=null}else f!==l&&(l=null)}}return Sy=l,null}function fD(l){switch(l){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ot()){case Pe:return 2;case He:return 8;case At:case Ge:return 32;case ze:return 268435456;default:return 32}default:return 32}}var DE=!1,Al=null,Cl=null,xl=null,Vh=new Map,zh=new Map,Rl=[],M7="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function dD(l,f){switch(l){case"focusin":case"focusout":Al=null;break;case"dragenter":case"dragleave":Cl=null;break;case"mouseover":case"mouseout":xl=null;break;case"pointerover":case"pointerout":Vh.delete(f.pointerId);break;case"gotpointercapture":case"lostpointercapture":zh.delete(f.pointerId)}}function Hh(l,f,p,y,T,x){return l===null||l.nativeEvent!==x?(l={blockedOn:f,domEventName:p,eventSystemFlags:y,nativeEvent:x,targetContainers:[T]},f!==null&&(f=$t(f),f!==null&&cD(f)),l):(l.eventSystemFlags|=y,f=l.targetContainers,T!==null&&f.indexOf(T)===-1&&f.push(T),l)}function D7(l,f,p,y,T){switch(f){case"focusin":return Al=Hh(Al,l,f,p,y,T),!0;case"dragenter":return Cl=Hh(Cl,l,f,p,y,T),!0;case"mouseover":return xl=Hh(xl,l,f,p,y,T),!0;case"pointerover":var x=T.pointerId;return Vh.set(x,Hh(Vh.get(x)||null,l,f,p,y,T)),!0;case"gotpointercapture":return x=T.pointerId,zh.set(x,Hh(zh.get(x)||null,l,f,p,y,T)),!0}return!1}function hD(l){var f=dt(l.target);if(f!==null){var p=a(f);if(p!==null){if(f=p.tag,f===13){if(f=s(p),f!==null){l.blockedOn=f,D(l.priority,function(){if(p.tag===13){var y=oa();y=fi(y);var T=Wc(p,y);T!==null&&la(T,p,y),OE(p,y)}});return}}else if(f===3&&p.stateNode.current.memoizedState.isDehydrated){l.blockedOn=p.tag===3?p.stateNode.containerInfo:null;return}}}l.blockedOn=null}function Ty(l){if(l.blockedOn!==null)return!1;for(var f=l.targetContainers;0<f.length;){var p=NE(l.nativeEvent);if(p===null){p=l.nativeEvent;var y=new p.constructor(p.type,p);Lw=y,p.target.dispatchEvent(y),Lw=null}else return f=$t(p),f!==null&&cD(f),l.blockedOn=p,!1;f.shift()}return!0}function pD(l,f,p){Ty(l)&&p.delete(f)}function $7(){DE=!1,Al!==null&&Ty(Al)&&(Al=null),Cl!==null&&Ty(Cl)&&(Cl=null),xl!==null&&Ty(xl)&&(xl=null),Vh.forEach(pD),zh.forEach(pD)}function Ay(l,f){l.blockedOn===f&&(l.blockedOn=null,DE||(DE=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,$7)))}var Cy=null;function mD(l){Cy!==l&&(Cy=l,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Cy===l&&(Cy=null);for(var f=0;f<l.length;f+=3){var p=l[f],y=l[f+1],T=l[f+2];if(typeof y!="function"){if(ME(y||p)===null)continue;break}var x=$t(p);x!==null&&(l.splice(f,3),f-=3,M0(x,{pending:!0,data:T,method:p.method,action:y},y,T))}}))}function Gh(l){function f(ce){return Ay(ce,l)}Al!==null&&Ay(Al,l),Cl!==null&&Ay(Cl,l),xl!==null&&Ay(xl,l),Vh.forEach(f),zh.forEach(f);for(var p=0;p<Rl.length;p++){var y=Rl[p];y.blockedOn===l&&(y.blockedOn=null)}for(;0<Rl.length&&(p=Rl[0],p.blockedOn===null);)hD(p),p.blockedOn===null&&Rl.shift();if(p=(l.ownerDocument||l).$$reactFormReplay,p!=null)for(y=0;y<p.length;y+=3){var T=p[y],x=p[y+1],q=T[ge]||null;if(typeof x=="function")q||mD(p);else if(q){var Z=null;if(x&&x.hasAttribute("formAction")){if(T=x,q=x[ge]||null)Z=q.formAction;else if(ME(T)!==null)continue}else Z=q.action;typeof Z=="function"?p[y+1]=Z:(p.splice(y,3),y-=3),mD(p)}}}function $E(l){this._internalRoot=l}xy.prototype.render=$E.prototype.render=function(l){var f=this._internalRoot;if(f===null)throw Error(r(409));var p=f.current,y=oa();lD(p,y,l,f,null,null)},xy.prototype.unmount=$E.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var f=l.containerInfo;lD(l.current,2,null,l,null,null),ly(),f[Oe]=null}};function xy(l){this._internalRoot=l}xy.prototype.unstable_scheduleHydration=function(l){if(l){var f=Y();l={blockedOn:null,target:l,priority:f};for(var p=0;p<Rl.length&&f!==0&&f<Rl[p].priority;p++);Rl.splice(p,0,l),p===0&&hD(l)}};var gD=e.version;if(gD!=="19.1.0")throw Error(r(527,gD,"19.1.0"));le.findDOMNode=function(l){var f=l._reactInternals;if(f===void 0)throw typeof l.render=="function"?Error(r(188)):(l=Object.keys(l).join(","),Error(r(268,l)));return l=u(f),l=l!==null?c(l):null,l=l===null?null:l.stateNode,l};var L7={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:ee,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ry=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ry.isDisabled&&Ry.supportsFiber)try{he=Ry.inject(L7),Ie=Ry}catch{}}return Kh.createRoot=function(l,f){if(!i(l))throw Error(r(299));var p=!1,y="",T=kN,x=NN,q=MN,Z=null;return f!=null&&(f.unstable_strictMode===!0&&(p=!0),f.identifierPrefix!==void 0&&(y=f.identifierPrefix),f.onUncaughtError!==void 0&&(T=f.onUncaughtError),f.onCaughtError!==void 0&&(x=f.onCaughtError),f.onRecoverableError!==void 0&&(q=f.onRecoverableError),f.unstable_transitionCallbacks!==void 0&&(Z=f.unstable_transitionCallbacks)),f=sD(l,1,!1,null,null,p,y,T,x,q,Z,null),l[Oe]=f.current,vE(l),new $E(f)},Kh.hydrateRoot=function(l,f,p){if(!i(l))throw Error(r(299));var y=!1,T="",x=kN,q=NN,Z=MN,ce=null,Re=null;return p!=null&&(p.unstable_strictMode===!0&&(y=!0),p.identifierPrefix!==void 0&&(T=p.identifierPrefix),p.onUncaughtError!==void 0&&(x=p.onUncaughtError),p.onCaughtError!==void 0&&(q=p.onCaughtError),p.onRecoverableError!==void 0&&(Z=p.onRecoverableError),p.unstable_transitionCallbacks!==void 0&&(ce=p.unstable_transitionCallbacks),p.formState!==void 0&&(Re=p.formState)),f=sD(l,1,!0,f,p??null,y,T,x,q,Z,ce,Re),f.context=oD(null),p=f.current,y=oa(),y=fi(y),T=fl(y),T.callback=null,dl(p,T,y),p=y,f.current.lanes=p,Aa(f,p),js(f),l[Oe]=f.current,vE(l),new xy(f)},Kh.version="19.1.0",Kh}var CD;function tW(){if(CD)return jE.exports;CD=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),jE.exports=eW(),jE.exports}var nW=tW();const rW=Za(nW),iW={apiKey:"YOUR_FIREBASE_API_KEY",authDomain:"YOUR_FIREBASE_AUTH_DOMAIN",projectId:"YOUR_FIREBASE_PROJECT_ID",storageBucket:"YOUR_FIREBASE_STORAGE_BUCKET",messagingSenderId:"YOUR_FIREBASE_MESSAGING_SENDER_ID",appId:"YOUR_FIREBASE_APP_ID"},B3="gemini-2.5-flash-preview-04-17",sd=({className:n})=>Ae.jsxs("svg",{className:`animate-spin -ml-1 mr-3 h-5 w-5 ${n||"text-white"}`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[Ae.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),Ae.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),q3=({className:n})=>Ae.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-6 h-6 ${n}`,children:Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1121.75 8.25z"})}),xD=({className:n})=>Ae.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-6 h-6 ${n}`,children:Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 17.25v-.228a4.5 4.5 0 00-.12-1.03l-2.268-9.64a3.375 3.375 0 00-3.285-2.602H7.923a3.375 3.375 0 00-3.285 2.602l-2.268 9.64a4.5 4.5 0 00-.12 1.03v.228m19.5 0a3 3 0 01-3 3H5.25a3 3 0 01-3-3m19.5 0a3 3 0 00-3-3H5.25a3 3 0 00-3 3m16.5 0h.008v.008h-.008v-.008zm-3 0h.008v.008h-.008v-.008zm-3 0h.008v.008h-.008v-.008zm-3 0h.008v.008h-.008v-.008z"})}),aW=({className:n})=>Ae.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-6 h-6 ${n}`,children:Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9"})}),V3=({className:n})=>Ae.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-5 h-5 ${n}`,children:Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),sW=({className:n})=>Ae.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-5 h-5 ${n}`,children:Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),oW=({className:n})=>Ae.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-5 h-5 ${n}`,children:Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12.56 0c1.153 0 2.24.032 3.22.094M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),lW=({className:n})=>Ae.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-6 h-6 ${n}`,children:Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})}),z3=({className:n})=>Ae.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-5 h-5 ${n}`,children:[Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 21v-1.5M12 3v1.5m0 15v1.5m3.75-18v1.5M19.5 8.25h-1.5m-2.25 3.75h-1.5m-3.75 0h-1.5m1.5-3.75H12m2.25 0h1.5M12 12v1.5m0 3.75v1.5M15.75 3v1.5m0 15v1.5"}),Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.75A5.25 5.25 0 006.75 12a5.25 5.25 0 005.25 5.25a5.25 5.25 0 005.25-5.25A5.25 5.25 0 0012 6.75z"})]}),H3=({className:n})=>Ae.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-5 h-5 ${n}`,children:Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})}),G3=({className:n})=>Ae.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-5 h-5 ${n}`,children:Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L1.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.25 12L17 14.188l-1.25-2.188a2.25 2.25 0 00-1.546-1.546L12 9.25l2.188-1.25a2.25 2.25 0 001.546-1.546L17 4.25l1.25 2.188a2.25 2.25 0 001.546 1.546L21.75 9.25l-2.188 1.25a2.25 2.25 0 00-1.546 1.546z"})}),HC=({className:n})=>Ae.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-5 h-5 ${n}`,children:[Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 21v-1.5M12 3v1.5m0 15v1.5m3.75-18v1.5M19.5 8.25h-1.5m-2.25 3.75h-1.5m-3.75 0h-1.5m1.5-3.75H12m2.25 0h1.5M12 12v1.5m0 3.75v1.5M15.75 3v1.5m0 15v1.5"}),Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.75A5.25 5.25 0 006.75 12a5.25 5.25 0 005.25 5.25a5.25 5.25 0 005.25-5.25A5.25 5.25 0 0012 6.75z"})]}),uW=({user:n,signOut:e})=>Ae.jsx("header",{className:"bg-gray-800 shadow-lg p-4 sticky top-0 z-50",children:Ae.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[Ae.jsx("h1",{className:"text-2xl font-bold text-sky-400",children:"MCP LLM Client"}),n&&Ae.jsxs("div",{className:"flex items-center space-x-4",children:[Ae.jsx("span",{className:"text-gray-300 text-sm hidden sm:block",children:n.email||n.displayName||"Authenticated User"}),Ae.jsxs("button",{onClick:e,className:"flex items-center bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-150 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-75","aria-label":"Logout",children:[Ae.jsx(aW,{className:"mr-2"}),"Logout"]})]})]})}),cW=()=>{const n=new Date().getFullYear();return Ae.jsxs("footer",{className:"bg-gray-800 text-gray-400 text-center p-6 mt-auto shadow-inner",children:[Ae.jsxs("p",{children:["© ",n," MCP LLM Client. All rights reserved."]}),Ae.jsx("p",{className:"text-xs mt-1",children:"This is a demonstration application. Handle API keys with care."})]})},fW=({apiKeys:n,onApiKeysChange:e,activeLLMProvider:t,onLLMProviderChange:r,keysLoadedFromStorage:i})=>{var S;const[a,s]=wt.useState(!1),[o,u]=wt.useState(!1),[c,d]=wt.useState(!1),[h,m]=wt.useState(i);wt.useEffect(()=>{m(i)},[i]);const g=E=>{const{name:C,value:A}=E.target;e({...n,[C]:A})},_=({id:E,label:C,show:A,setShow:R})=>Ae.jsxs("div",{className:"mb-6",children:[Ae.jsx("label",{htmlFor:E,className:"block text-sm font-medium text-gray-300 mb-1",children:C}),Ae.jsxs("div",{className:"relative",children:[Ae.jsx("input",{type:A?"text":"password",id:E,name:E,value:n[E]||"",onChange:g,className:"w-full px-4 py-2.5 bg-gray-700 border border-gray-600 rounded-lg text-gray-200 focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition-colors",placeholder:`Enter your ${C}`,autoComplete:A?"off":"current-password"}),Ae.jsx("button",{type:"button",onClick:()=>R(!A),className:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-sky-400","aria-label":A?"Hide key":"Show key",children:A?Ae.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88"})}):Ae.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:[Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})]}),w=[{id:"gemini",label:"Gemini",Icon:G3},{id:"openai",label:"OpenAI",Icon:z3},{id:"claude",label:"Claude",Icon:H3}];return Ae.jsxs("div",{className:"p-6 bg-gray-800 rounded-xl shadow-xl",children:[Ae.jsxs("h2",{className:"text-2xl font-semibold text-sky-400 mb-6 flex items-center",children:[Ae.jsx(q3,{className:"mr-3 text-sky-400"})," API Key Management"]}),h&&Ae.jsxs("div",{className:"mb-4 p-3 bg-green-800/50 border border-green-700 rounded-lg text-green-300 text-sm flex justify-between items-center",role:"alert",children:[Ae.jsxs("div",{className:"flex items-center",children:[Ae.jsx(V3,{className:"w-5 h-5 mr-2 text-green-400"}),"Previously saved API keys have been loaded from your browser."]}),Ae.jsx("button",{onClick:()=>m(!1),className:"text-green-300 hover:text-green-100","aria-label":"Dismiss message",children:Ae.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),Ae.jsxs("div",{className:"space-y-4 mb-8",children:[Ae.jsx(_,{id:"openai",label:"OpenAI API Key",show:a,setShow:s}),Ae.jsx(_,{id:"claude",label:"Claude API Key",show:o,setShow:u}),Ae.jsx(_,{id:"gemini",label:"Gemini API Key (User-provided)",show:c,setShow:d})]}),Ae.jsxs("div",{className:"mb-6",children:[Ae.jsxs("h3",{className:"text-xl font-semibold text-gray-200 mb-3 flex items-center",children:[Ae.jsx(HC,{className:"mr-2 text-sky-400"})," Select Chat Provider"]}),Ae.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:w.map(E=>{var R;const C=!!((R=n[E.id])!=null&&R.trim()),A=t===E.id;return Ae.jsxs("button",{onClick:()=>r(E.id),disabled:!C,className:`flex items-center justify-center p-3 rounded-lg border-2 transition-all duration-150 ease-in-out
                            ${A?"bg-sky-500 border-sky-400 text-white shadow-lg scale-105":C?"bg-gray-700 border-gray-600 hover:bg-gray-600 hover:border-sky-500 text-gray-200":"bg-gray-700/50 border-gray-600 text-gray-500 cursor-not-allowed"}`,"aria-pressed":A,"aria-label":`Select ${E.label} as chat provider ${C?"":"(API key not set)"}`,children:[Ae.jsx(E.Icon,{className:`mr-2 h-5 w-5 ${A?"":C?"text-sky-300":"text-gray-500"}`}),Ae.jsx("span",{className:"font-medium text-sm",children:E.label})]},E.id)})}),!((S=n[t])!=null&&S.trim())&&Ae.jsxs("p",{className:"text-xs text-yellow-400 mt-2 text-center",children:["The selected provider (",t,") has no API key. Chat will be disabled."]})]}),Ae.jsxs("p",{className:"text-xs text-gray-500 mt-4 text-center",children:[Ae.jsx("span",{className:"font-semibold",children:"Security Note:"})," API keys are stored in your browser's local storage. Avoid using shared or public computers."]}),Ae.jsx("p",{className:"text-xs text-gray-500 mt-1 text-center",children:'The "Gemini API Key" field is for a user-provided key. If you have `process.env.API_KEY` configured for Gemini, it may be used by the SDK directly if this field is empty, depending on service logic.'})]})},dW=({servers:n,onAddServer:e,onRemoveServer:t,onConnectToServer:r,serversLoadedFromStorage:i})=>{const[a,s]=wt.useState(""),[o,u]=wt.useState(""),[c,d]=wt.useState(""),[h,m]=wt.useState(""),g=E=>{if(E.preventDefault(),!a.trim()||!o.trim()){m("Server name and URL cannot be empty.");return}try{new URL(o)}catch{m("Invalid server URL format. Please include /mcp");return}m(""),e(a,o,c),s(""),u(""),d("")},_=E=>{switch(E){case"connected":return"text-green-300 bg-green-800/60 border-green-700";case"connecting":return"text-yellow-300 bg-yellow-800/60 border-yellow-700";case"error":return"text-red-300 bg-red-800/60 border-red-700";default:return"text-gray-300 bg-gray-700/70 border-gray-600"}},w=E=>{switch(E){case"connected":return Ae.jsx(V3,{className:"text-green-400"});case"connecting":return Ae.jsx(sd,{className:"text-yellow-400 !w-4 !h-4 !mr-0"});case"error":return Ae.jsx(sW,{className:"text-red-400"});default:return Ae.jsx(xD,{className:"text-gray-400 !w-4 !h-4"})}},S=E=>{switch(E){case"connected":return"Reconnect";case"connecting":return"Connecting...";case"error":return"Retry Connect";default:return"Connect"}};return i?Ae.jsxs("div",{className:"p-6 bg-gray-800 rounded-xl shadow-xl",children:[Ae.jsxs("h2",{className:"text-2xl font-semibold text-sky-400 mb-6 flex items-center",children:[Ae.jsx(xD,{className:"mr-3 text-sky-400"})," MCP Server Management"]}),Ae.jsxs("form",{onSubmit:g,className:"mb-8 p-4 border border-gray-700 rounded-lg bg-gray-700/30",children:[Ae.jsx("h3",{className:"text-lg font-medium text-gray-200 mb-3",children:"Add New MCP Server"}),Ae.jsxs("div",{className:"mb-4",children:[Ae.jsx("label",{htmlFor:"newServerName",className:"block text-sm font-medium text-gray-300 mb-1",children:"Server Name/Alias"}),Ae.jsx("input",{type:"text",id:"newServerName",value:a,onChange:E=>s(E.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-200 focus:ring-1 focus:ring-sky-500 focus:border-sky-500",placeholder:"e.g., Primary MCP"})]}),Ae.jsxs("div",{className:"mb-4",children:[Ae.jsx("label",{htmlFor:"newServerUrl",className:"block text-sm font-medium text-gray-300 mb-1",children:"Server URL"}),Ae.jsx("input",{type:"url",id:"newServerUrl",value:o,onChange:E=>u(E.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-200 focus:ring-1 focus:ring-sky-500 focus:border-sky-500",placeholder:"https://mcp.example.com"})]}),Ae.jsxs("div",{className:"mb-4",children:[Ae.jsx("label",{htmlFor:"newServerBearerToken",className:"block text-sm font-medium text-gray-300 mb-1",children:"Bearer Token (Optional)"}),Ae.jsx("input",{type:"password",id:"newServerBearerToken",value:c,onChange:E=>d(E.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-200 focus:ring-1 focus:ring-sky-500 focus:border-sky-500",placeholder:"Enter optional bearer token",autoComplete:"off"})]}),h&&Ae.jsx("p",{className:"text-red-400 text-xs mb-3",children:h}),Ae.jsxs("button",{type:"submit",className:"w-full bg-sky-600 hover:bg-sky-700 text-white font-semibold py-2.5 px-4 rounded-lg transition duration-150 ease-in-out transform hover:scale-102 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-opacity-75 flex items-center justify-center",children:[Ae.jsx(lW,{className:"mr-2"})," Add Server"]})]}),Ae.jsxs("div",{children:[Ae.jsx("h3",{className:"text-xl font-semibold text-gray-200 mb-4",children:"Configured Servers"}),n.length===0?Ae.jsx("p",{className:"text-gray-400 text-center py-4",children:"No MCP servers configured yet. Add one above."}):Ae.jsx("div",{className:"space-y-4",children:n.map(E=>Ae.jsxs("div",{className:"p-4 bg-gray-700/50 rounded-lg border border-gray-600 shadow-md",children:[Ae.jsxs("div",{className:"flex justify-between items-start mb-2",children:[Ae.jsxs("div",{children:[Ae.jsx("h4",{className:"text-lg font-semibold text-sky-300",children:E.name}),Ae.jsx("p",{className:"text-xs text-gray-400 break-all",children:E.url}),E.bearerToken&&Ae.jsxs("p",{className:"text-xs text-gray-500 mt-1 flex items-center",children:[Ae.jsx(q3,{className:"w-3 h-3 mr-1 text-yellow-400"})," Bearer Token: Present"]})]}),Ae.jsx("button",{onClick:()=>t(E.id),className:"text-gray-400 hover:text-red-400 p-1 rounded-md transition-colors","aria-label":`Remove ${E.name}`,children:Ae.jsx(oW,{className:"w-5 h-5"})})]}),Ae.jsxs("div",{className:`text-xs p-2 rounded-md border flex items-center gap-2 mb-3 ${_(E.status)}`,children:[w(E.status)," ",Ae.jsxs("strong",{children:[E.status.charAt(0).toUpperCase()+E.status.slice(1),":"]})," ",E.statusMessage]}),Ae.jsxs("button",{onClick:()=>r(E.id),disabled:E.status==="connecting",className:"w-full bg-teal-600 hover:bg-teal-700 text-white font-semibold py-2 px-3 rounded-md transition duration-150 ease-in-out transform hover:scale-102 focus:outline-none focus:ring-1 focus:ring-teal-400 disabled:opacity-60 disabled:cursor-not-allowed flex items-center justify-center text-sm",children:[E.status==="connecting"&&Ae.jsx(sd,{className:"mr-2 text-white !w-4 !h-4"}),S(E.status)]})]},E.id))})]}),Ae.jsxs("div",{className:"text-sm text-yellow-200 bg-yellow-800/40 p-3 rounded-md mt-6 text-center border border-yellow-700/50 shadow",children:[Ae.jsx("p",{className:"font-semibold",children:"Important Note:"}),Ae.jsxs("p",{className:"text-xs ",children:["MCP server connections now attempt ",Ae.jsx("strong",{className:"font-medium",children:"real network requests"})," to the URLs provided. Ensure URLs are correct (including http/https) and accessible. If a server is on a different domain, it must be configured for CORS to allow requests from this application. Failures might be due to network issues, incorrect URLs, server errors, or CORS misconfiguration. Check the browser's console for more details on network errors."]})]})]}):Ae.jsxs("div",{className:"bg-gray-800 p-6 rounded-xl shadow-xl flex items-center justify-center h-40",children:[Ae.jsx(sd,{className:"w-6 h-6 text-sky-400 mr-2"}),Ae.jsx("span",{className:"text-gray-300",children:"Cargando servidores guardados..."})]})};function hW(n,e){const t={};return(n[n.length-1]===""?[...n,""]:n).join((t.padRight?" ":"")+","+(t.padLeft===!1?"":" ")).trim()}const pW=/^[$_\p{ID_Start}][$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,mW=/^[$_\p{ID_Start}][-$_\u{200C}\u{200D}\p{ID_Continue}]*$/u,gW={};function RD(n,e){return(gW.jsx?mW:pW).test(n)}const yW=/[ \t\n\f\r]/g;function vW(n){return typeof n=="object"?n.type==="text"?ID(n.value):!1:ID(n)}function ID(n){return n.replace(yW,"")===""}class Lm{constructor(e,t,r){this.normal=t,this.property=e,r&&(this.space=r)}}Lm.prototype.normal={};Lm.prototype.property={};Lm.prototype.space=void 0;function W3(n,e){const t={},r={};for(const i of n)Object.assign(t,i.property),Object.assign(r,i.normal);return new Lm(t,r,e)}function GC(n){return n.toLowerCase()}class Zi{constructor(e,t){this.attribute=t,this.property=e}}Zi.prototype.attribute="";Zi.prototype.booleanish=!1;Zi.prototype.boolean=!1;Zi.prototype.commaOrSpaceSeparated=!1;Zi.prototype.commaSeparated=!1;Zi.prototype.defined=!1;Zi.prototype.mustUseProperty=!1;Zi.prototype.number=!1;Zi.prototype.overloadedBoolean=!1;Zi.prototype.property="";Zi.prototype.spaceSeparated=!1;Zi.prototype.space=void 0;let _W=0;const jt=Ec(),ar=Ec(),WC=Ec(),Xe=Ec(),On=Ec(),od=Ec(),ua=Ec();function Ec(){return 2**++_W}const KC=Object.freeze(Object.defineProperty({__proto__:null,boolean:jt,booleanish:ar,commaOrSpaceSeparated:ua,commaSeparated:od,number:Xe,overloadedBoolean:WC,spaceSeparated:On},Symbol.toStringTag,{value:"Module"})),VE=Object.keys(KC);class YR extends Zi{constructor(e,t,r,i){let a=-1;if(super(e,t),PD(this,"space",i),typeof r=="number")for(;++a<VE.length;){const s=VE[a];PD(this,VE[a],(r&KC[s])===KC[s])}}}YR.prototype.defined=!0;function PD(n,e,t){t&&(n[e]=t)}function Dd(n){const e={},t={};for(const[r,i]of Object.entries(n.properties)){const a=new YR(r,n.transform(n.attributes||{},r),i,n.space);n.mustUseProperty&&n.mustUseProperty.includes(r)&&(a.mustUseProperty=!0),e[r]=a,t[GC(r)]=r,t[GC(a.attribute)]=r}return new Lm(e,t,n.space)}const K3=Dd({properties:{ariaActiveDescendant:null,ariaAtomic:ar,ariaAutoComplete:null,ariaBusy:ar,ariaChecked:ar,ariaColCount:Xe,ariaColIndex:Xe,ariaColSpan:Xe,ariaControls:On,ariaCurrent:null,ariaDescribedBy:On,ariaDetails:null,ariaDisabled:ar,ariaDropEffect:On,ariaErrorMessage:null,ariaExpanded:ar,ariaFlowTo:On,ariaGrabbed:ar,ariaHasPopup:null,ariaHidden:ar,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:On,ariaLevel:Xe,ariaLive:null,ariaModal:ar,ariaMultiLine:ar,ariaMultiSelectable:ar,ariaOrientation:null,ariaOwns:On,ariaPlaceholder:null,ariaPosInSet:Xe,ariaPressed:ar,ariaReadOnly:ar,ariaRelevant:null,ariaRequired:ar,ariaRoleDescription:On,ariaRowCount:Xe,ariaRowIndex:Xe,ariaRowSpan:Xe,ariaSelected:ar,ariaSetSize:Xe,ariaSort:null,ariaValueMax:Xe,ariaValueMin:Xe,ariaValueNow:Xe,ariaValueText:null,role:null},transform(n,e){return e==="role"?e:"aria-"+e.slice(4).toLowerCase()}});function J3(n,e){return e in n?n[e]:e}function Y3(n,e){return J3(n,e.toLowerCase())}const bW=Dd({attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:od,acceptCharset:On,accessKey:On,action:null,allow:null,allowFullScreen:jt,allowPaymentRequest:jt,allowUserMedia:jt,alt:null,as:null,async:jt,autoCapitalize:null,autoComplete:On,autoFocus:jt,autoPlay:jt,blocking:On,capture:null,charSet:null,checked:jt,cite:null,className:On,cols:Xe,colSpan:null,content:null,contentEditable:ar,controls:jt,controlsList:On,coords:Xe|od,crossOrigin:null,data:null,dateTime:null,decoding:null,default:jt,defer:jt,dir:null,dirName:null,disabled:jt,download:WC,draggable:ar,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:jt,formTarget:null,headers:On,height:Xe,hidden:WC,high:Xe,href:null,hrefLang:null,htmlFor:On,httpEquiv:On,id:null,imageSizes:null,imageSrcSet:null,inert:jt,inputMode:null,integrity:null,is:null,isMap:jt,itemId:null,itemProp:On,itemRef:On,itemScope:jt,itemType:On,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:jt,low:Xe,manifest:null,max:null,maxLength:Xe,media:null,method:null,min:null,minLength:Xe,multiple:jt,muted:jt,name:null,nonce:null,noModule:jt,noValidate:jt,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeToggle:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:jt,optimum:Xe,pattern:null,ping:On,placeholder:null,playsInline:jt,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:jt,referrerPolicy:null,rel:On,required:jt,reversed:jt,rows:Xe,rowSpan:Xe,sandbox:On,scope:null,scoped:jt,seamless:jt,selected:jt,shadowRootClonable:jt,shadowRootDelegatesFocus:jt,shadowRootMode:null,shape:null,size:Xe,sizes:null,slot:null,span:Xe,spellCheck:ar,src:null,srcDoc:null,srcLang:null,srcSet:null,start:Xe,step:null,style:null,tabIndex:Xe,target:null,title:null,translate:null,type:null,typeMustMatch:jt,useMap:null,value:ar,width:Xe,wrap:null,writingSuggestions:null,align:null,aLink:null,archive:On,axis:null,background:null,bgColor:null,border:Xe,borderColor:null,bottomMargin:Xe,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:jt,declare:jt,event:null,face:null,frame:null,frameBorder:null,hSpace:Xe,leftMargin:Xe,link:null,longDesc:null,lowSrc:null,marginHeight:Xe,marginWidth:Xe,noResize:jt,noHref:jt,noShade:jt,noWrap:jt,object:null,profile:null,prompt:null,rev:null,rightMargin:Xe,rules:null,scheme:null,scrolling:ar,standby:null,summary:null,text:null,topMargin:Xe,valueType:null,version:null,vAlign:null,vLink:null,vSpace:Xe,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:jt,disableRemotePlayback:jt,prefix:null,property:null,results:Xe,security:null,unselectable:null},space:"html",transform:Y3}),wW=Dd({attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},properties:{about:ua,accentHeight:Xe,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:Xe,amplitude:Xe,arabicForm:null,ascent:Xe,attributeName:null,attributeType:null,azimuth:Xe,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:Xe,by:null,calcMode:null,capHeight:Xe,className:On,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:Xe,diffuseConstant:Xe,direction:null,display:null,dur:null,divisor:Xe,dominantBaseline:null,download:jt,dx:null,dy:null,edgeMode:null,editable:null,elevation:Xe,enableBackground:null,end:null,event:null,exponent:Xe,externalResourcesRequired:null,fill:null,fillOpacity:Xe,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:od,g2:od,glyphName:od,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:Xe,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:Xe,horizOriginX:Xe,horizOriginY:Xe,id:null,ideographic:Xe,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:Xe,k:Xe,k1:Xe,k2:Xe,k3:Xe,k4:Xe,kernelMatrix:ua,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:Xe,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:Xe,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:Xe,overlineThickness:Xe,paintOrder:null,panose1:null,path:null,pathLength:Xe,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:On,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:Xe,pointsAtY:Xe,pointsAtZ:Xe,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:ua,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:ua,rev:ua,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:ua,requiredFeatures:ua,requiredFonts:ua,requiredFormats:ua,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:Xe,specularExponent:Xe,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:Xe,strikethroughThickness:Xe,string:null,stroke:null,strokeDashArray:ua,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:Xe,strokeOpacity:Xe,strokeWidth:null,style:null,surfaceScale:Xe,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:ua,tabIndex:Xe,tableValues:null,target:null,targetX:Xe,targetY:Xe,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:ua,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:Xe,underlineThickness:Xe,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:Xe,values:null,vAlphabetic:Xe,vMathematical:Xe,vectorEffect:null,vHanging:Xe,vIdeographic:Xe,version:null,vertAdvY:Xe,vertOriginX:Xe,vertOriginY:Xe,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:Xe,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null},space:"svg",transform:J3}),Z3=Dd({properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null},space:"xlink",transform(n,e){return"xlink:"+e.slice(5).toLowerCase()}}),X3=Dd({attributes:{xmlnsxlink:"xmlns:xlink"},properties:{xmlnsXLink:null,xmlns:null},space:"xmlns",transform:Y3}),Q3=Dd({properties:{xmlBase:null,xmlLang:null,xmlSpace:null},space:"xml",transform(n,e){return"xml:"+e.slice(3).toLowerCase()}}),EW={classId:"classID",dataType:"datatype",itemId:"itemID",strokeDashArray:"strokeDasharray",strokeDashOffset:"strokeDashoffset",strokeLineCap:"strokeLinecap",strokeLineJoin:"strokeLinejoin",strokeMiterLimit:"strokeMiterlimit",typeOf:"typeof",xLinkActuate:"xlinkActuate",xLinkArcRole:"xlinkArcrole",xLinkHref:"xlinkHref",xLinkRole:"xlinkRole",xLinkShow:"xlinkShow",xLinkTitle:"xlinkTitle",xLinkType:"xlinkType",xmlnsXLink:"xmlnsXlink"},SW=/[A-Z]/g,OD=/-[a-z]/g,TW=/^data[-\w.:]+$/i;function AW(n,e){const t=GC(e);let r=e,i=Zi;if(t in n.normal)return n.property[n.normal[t]];if(t.length>4&&t.slice(0,4)==="data"&&TW.test(e)){if(e.charAt(4)==="-"){const a=e.slice(5).replace(OD,xW);r="data"+a.charAt(0).toUpperCase()+a.slice(1)}else{const a=e.slice(4);if(!OD.test(a)){let s=a.replace(SW,CW);s.charAt(0)!=="-"&&(s="-"+s),e="data"+s}}i=YR}return new i(r,e)}function CW(n){return"-"+n.toLowerCase()}function xW(n){return n.charAt(1).toUpperCase()}const RW=W3([K3,bW,Z3,X3,Q3],"html"),ZR=W3([K3,wW,Z3,X3,Q3],"svg");function IW(n){return n.join(" ").trim()}var _f={},zE,kD;function PW(){if(kD)return zE;kD=1;var n=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g,e=/\n/g,t=/^\s*/,r=/^(\*?[-#/*\\\w]+(\[[0-9a-z_-]+\])?)\s*/,i=/^:\s*/,a=/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^)]*?\)|[^};])+)/,s=/^[;\s]*/,o=/^\s+|\s+$/g,u=`
`,c="/",d="*",h="",m="comment",g="declaration";zE=function(w,S){if(typeof w!="string")throw new TypeError("First argument must be a string");if(!w)return[];S=S||{};var E=1,C=1;function A(oe){var te=oe.match(e);te&&(E+=te.length);var se=oe.lastIndexOf(u);C=~se?oe.length-se:C+oe.length}function R(){var oe={line:E,column:C};return function(te){return te.position=new P(oe),k(),te}}function P(oe){this.start=oe,this.end={line:E,column:C},this.source=S.source}P.prototype.content=w;function N(oe){var te=new Error(S.source+":"+E+":"+C+": "+oe);if(te.reason=oe,te.filename=S.source,te.line=E,te.column=C,te.source=w,!S.silent)throw te}function U(oe){var te=oe.exec(w);if(te){var se=te[0];return A(se),w=w.slice(se.length),te}}function k(){U(t)}function B(oe){var te;for(oe=oe||[];te=H();)te!==!1&&oe.push(te);return oe}function H(){var oe=R();if(!(c!=w.charAt(0)||d!=w.charAt(1))){for(var te=2;h!=w.charAt(te)&&(d!=w.charAt(te)||c!=w.charAt(te+1));)++te;if(te+=2,h===w.charAt(te-1))return N("End of comment missing");var se=w.slice(2,te-2);return C+=2,A(se),w=w.slice(te),C+=2,oe({type:m,comment:se})}}function G(){var oe=R(),te=U(r);if(te){if(H(),!U(i))return N("property missing ':'");var se=U(a),ee=oe({type:g,property:_(te[0].replace(n,h)),value:se?_(se[0].replace(n,h)):h});return U(s),ee}}function z(){var oe=[];B(oe);for(var te;te=G();)te!==!1&&(oe.push(te),B(oe));return oe}return k(),z()};function _(w){return w?w.replace(o,h):h}return zE}var ND;function OW(){if(ND)return _f;ND=1;var n=_f&&_f.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(_f,"__esModule",{value:!0}),_f.default=t;var e=n(PW());function t(r,i){var a=null;if(!r||typeof r!="string")return a;var s=(0,e.default)(r),o=typeof i=="function";return s.forEach(function(u){if(u.type==="declaration"){var c=u.property,d=u.value;o?i(c,d,u):d&&(a=a||{},a[c]=d)}}),a}return _f}var Jh={},MD;function kW(){if(MD)return Jh;MD=1,Object.defineProperty(Jh,"__esModule",{value:!0}),Jh.camelCase=void 0;var n=/^--[a-zA-Z0-9_-]+$/,e=/-([a-z])/g,t=/^[^-]+$/,r=/^-(webkit|moz|ms|o|khtml)-/,i=/^-(ms)-/,a=function(c){return!c||t.test(c)||n.test(c)},s=function(c,d){return d.toUpperCase()},o=function(c,d){return"".concat(d,"-")},u=function(c,d){return d===void 0&&(d={}),a(c)?c:(c=c.toLowerCase(),d.reactCompat?c=c.replace(i,o):c=c.replace(r,o),c.replace(e,s))};return Jh.camelCase=u,Jh}var Yh,DD;function NW(){if(DD)return Yh;DD=1;var n=Yh&&Yh.__importDefault||function(i){return i&&i.__esModule?i:{default:i}},e=n(OW()),t=kW();function r(i,a){var s={};return!i||typeof i!="string"||(0,e.default)(i,function(o,u){o&&u&&(s[(0,t.camelCase)(o,a)]=u)}),s}return r.default=r,Yh=r,Yh}var MW=NW();const DW=Za(MW),e6=t6("end"),XR=t6("start");function t6(n){return e;function e(t){const r=t&&t.position&&t.position[n]||{};if(typeof r.line=="number"&&r.line>0&&typeof r.column=="number"&&r.column>0)return{line:r.line,column:r.column,offset:typeof r.offset=="number"&&r.offset>-1?r.offset:void 0}}}function $W(n){const e=XR(n),t=e6(n);if(e&&t)return{start:e,end:t}}function Up(n){return!n||typeof n!="object"?"":"position"in n||"type"in n?$D(n.position):"start"in n||"end"in n?$D(n):"line"in n||"column"in n?JC(n):""}function JC(n){return LD(n&&n.line)+":"+LD(n&&n.column)}function $D(n){return JC(n&&n.start)+"-"+JC(n&&n.end)}function LD(n){return n&&typeof n=="number"?n:1}class ci extends Error{constructor(e,t,r){super(),typeof t=="string"&&(r=t,t=void 0);let i="",a={},s=!1;if(t&&("line"in t&&"column"in t?a={place:t}:"start"in t&&"end"in t?a={place:t}:"type"in t?a={ancestors:[t],place:t.position}:a={...t}),typeof e=="string"?i=e:!a.cause&&e&&(s=!0,i=e.message,a.cause=e),!a.ruleId&&!a.source&&typeof r=="string"){const u=r.indexOf(":");u===-1?a.ruleId=r:(a.source=r.slice(0,u),a.ruleId=r.slice(u+1))}if(!a.place&&a.ancestors&&a.ancestors){const u=a.ancestors[a.ancestors.length-1];u&&(a.place=u.position)}const o=a.place&&"start"in a.place?a.place.start:a.place;this.ancestors=a.ancestors||void 0,this.cause=a.cause||void 0,this.column=o?o.column:void 0,this.fatal=void 0,this.file,this.message=i,this.line=o?o.line:void 0,this.name=Up(a.place)||"1:1",this.place=a.place||void 0,this.reason=this.message,this.ruleId=a.ruleId||void 0,this.source=a.source||void 0,this.stack=s&&a.cause&&typeof a.cause.stack=="string"?a.cause.stack:"",this.actual,this.expected,this.note,this.url}}ci.prototype.file="";ci.prototype.name="";ci.prototype.reason="";ci.prototype.message="";ci.prototype.stack="";ci.prototype.column=void 0;ci.prototype.line=void 0;ci.prototype.ancestors=void 0;ci.prototype.cause=void 0;ci.prototype.fatal=void 0;ci.prototype.place=void 0;ci.prototype.ruleId=void 0;ci.prototype.source=void 0;const QR={}.hasOwnProperty,LW=new Map,UW=/[A-Z]/g,jW=new Set(["table","tbody","thead","tfoot","tr"]),FW=new Set(["td","th"]),n6="https://github.com/syntax-tree/hast-util-to-jsx-runtime";function BW(n,e){if(!e||e.Fragment===void 0)throw new TypeError("Expected `Fragment` in options");const t=e.filePath||void 0;let r;if(e.development){if(typeof e.jsxDEV!="function")throw new TypeError("Expected `jsxDEV` in options when `development: true`");r=JW(t,e.jsxDEV)}else{if(typeof e.jsx!="function")throw new TypeError("Expected `jsx` in production options");if(typeof e.jsxs!="function")throw new TypeError("Expected `jsxs` in production options");r=KW(t,e.jsx,e.jsxs)}const i={Fragment:e.Fragment,ancestors:[],components:e.components||{},create:r,elementAttributeNameCase:e.elementAttributeNameCase||"react",evaluater:e.createEvaluater?e.createEvaluater():void 0,filePath:t,ignoreInvalidStyle:e.ignoreInvalidStyle||!1,passKeys:e.passKeys!==!1,passNode:e.passNode||!1,schema:e.space==="svg"?ZR:RW,stylePropertyNameCase:e.stylePropertyNameCase||"dom",tableCellAlignToStyle:e.tableCellAlignToStyle!==!1},a=r6(i,n,void 0);return a&&typeof a!="string"?a:i.create(n,i.Fragment,{children:a||void 0},void 0)}function r6(n,e,t){if(e.type==="element")return qW(n,e,t);if(e.type==="mdxFlowExpression"||e.type==="mdxTextExpression")return VW(n,e);if(e.type==="mdxJsxFlowElement"||e.type==="mdxJsxTextElement")return HW(n,e,t);if(e.type==="mdxjsEsm")return zW(n,e);if(e.type==="root")return GW(n,e,t);if(e.type==="text")return WW(n,e)}function qW(n,e,t){const r=n.schema;let i=r;e.tagName.toLowerCase()==="svg"&&r.space==="html"&&(i=ZR,n.schema=i),n.ancestors.push(e);const a=a6(n,e.tagName,!1),s=YW(n,e);let o=tI(n,e);return jW.has(e.tagName)&&(o=o.filter(function(u){return typeof u=="string"?!vW(u):!0})),i6(n,s,a,e),eI(s,o),n.ancestors.pop(),n.schema=r,n.create(e,a,s,t)}function VW(n,e){if(e.data&&e.data.estree&&n.evaluater){const r=e.data.estree.body[0];return r.type,n.evaluater.evaluateExpression(r.expression)}lm(n,e.position)}function zW(n,e){if(e.data&&e.data.estree&&n.evaluater)return n.evaluater.evaluateProgram(e.data.estree);lm(n,e.position)}function HW(n,e,t){const r=n.schema;let i=r;e.name==="svg"&&r.space==="html"&&(i=ZR,n.schema=i),n.ancestors.push(e);const a=e.name===null?n.Fragment:a6(n,e.name,!0),s=ZW(n,e),o=tI(n,e);return i6(n,s,a,e),eI(s,o),n.ancestors.pop(),n.schema=r,n.create(e,a,s,t)}function GW(n,e,t){const r={};return eI(r,tI(n,e)),n.create(e,n.Fragment,r,t)}function WW(n,e){return e.value}function i6(n,e,t,r){typeof t!="string"&&t!==n.Fragment&&n.passNode&&(e.node=r)}function eI(n,e){if(e.length>0){const t=e.length>1?e:e[0];t&&(n.children=t)}}function KW(n,e,t){return r;function r(i,a,s,o){const c=Array.isArray(s.children)?t:e;return o?c(a,s,o):c(a,s)}}function JW(n,e){return t;function t(r,i,a,s){const o=Array.isArray(a.children),u=XR(r);return e(i,a,s,o,{columnNumber:u?u.column-1:void 0,fileName:n,lineNumber:u?u.line:void 0},void 0)}}function YW(n,e){const t={};let r,i;for(i in e.properties)if(i!=="children"&&QR.call(e.properties,i)){const a=XW(n,i,e.properties[i]);if(a){const[s,o]=a;n.tableCellAlignToStyle&&s==="align"&&typeof o=="string"&&FW.has(e.tagName)?r=o:t[s]=o}}if(r){const a=t.style||(t.style={});a[n.stylePropertyNameCase==="css"?"text-align":"textAlign"]=r}return t}function ZW(n,e){const t={};for(const r of e.attributes)if(r.type==="mdxJsxExpressionAttribute")if(r.data&&r.data.estree&&n.evaluater){const a=r.data.estree.body[0];a.type;const s=a.expression;s.type;const o=s.properties[0];o.type,Object.assign(t,n.evaluater.evaluateExpression(o.argument))}else lm(n,e.position);else{const i=r.name;let a;if(r.value&&typeof r.value=="object")if(r.value.data&&r.value.data.estree&&n.evaluater){const o=r.value.data.estree.body[0];o.type,a=n.evaluater.evaluateExpression(o.expression)}else lm(n,e.position);else a=r.value===null?!0:r.value;t[i]=a}return t}function tI(n,e){const t=[];let r=-1;const i=n.passKeys?new Map:LW;for(;++r<e.children.length;){const a=e.children[r];let s;if(n.passKeys){const u=a.type==="element"?a.tagName:a.type==="mdxJsxFlowElement"||a.type==="mdxJsxTextElement"?a.name:void 0;if(u){const c=i.get(u)||0;s=u+"-"+c,i.set(u,c+1)}}const o=r6(n,a,s);o!==void 0&&t.push(o)}return t}function XW(n,e,t){const r=AW(n.schema,e);if(!(t==null||typeof t=="number"&&Number.isNaN(t))){if(Array.isArray(t)&&(t=r.commaSeparated?hW(t):IW(t)),r.property==="style"){let i=typeof t=="object"?t:QW(n,String(t));return n.stylePropertyNameCase==="css"&&(i=eK(i)),["style",i]}return[n.elementAttributeNameCase==="react"&&r.space?EW[r.property]||r.property:r.attribute,t]}}function QW(n,e){try{return DW(e,{reactCompat:!0})}catch(t){if(n.ignoreInvalidStyle)return{};const r=t,i=new ci("Cannot parse `style` attribute",{ancestors:n.ancestors,cause:r,ruleId:"style",source:"hast-util-to-jsx-runtime"});throw i.file=n.filePath||void 0,i.url=n6+"#cannot-parse-style-attribute",i}}function a6(n,e,t){let r;if(!t)r={type:"Literal",value:e};else if(e.includes(".")){const i=e.split(".");let a=-1,s;for(;++a<i.length;){const o=RD(i[a])?{type:"Identifier",name:i[a]}:{type:"Literal",value:i[a]};s=s?{type:"MemberExpression",object:s,property:o,computed:!!(a&&o.type==="Literal"),optional:!1}:o}r=s}else r=RD(e)&&!/^[a-z]/.test(e)?{type:"Identifier",name:e}:{type:"Literal",value:e};if(r.type==="Literal"){const i=r.value;return QR.call(n.components,i)?n.components[i]:i}if(n.evaluater)return n.evaluater.evaluateExpression(r);lm(n)}function lm(n,e){const t=new ci("Cannot handle MDX estrees without `createEvaluater`",{ancestors:n.ancestors,place:e,ruleId:"mdx-estree",source:"hast-util-to-jsx-runtime"});throw t.file=n.filePath||void 0,t.url=n6+"#cannot-handle-mdx-estrees-without-createevaluater",t}function eK(n){const e={};let t;for(t in n)QR.call(n,t)&&(e[tK(t)]=n[t]);return e}function tK(n){let e=n.replace(UW,nK);return e.slice(0,3)==="ms-"&&(e="-"+e),e}function nK(n){return"-"+n.toLowerCase()}const HE={action:["form"],cite:["blockquote","del","ins","q"],data:["object"],formAction:["button","input"],href:["a","area","base","link"],icon:["menuitem"],itemId:null,manifest:["html"],ping:["a","area"],poster:["video"],src:["audio","embed","iframe","img","input","script","source","track","video"]},rK={};function iK(n,e){const t=rK,r=typeof t.includeImageAlt=="boolean"?t.includeImageAlt:!0,i=typeof t.includeHtml=="boolean"?t.includeHtml:!0;return s6(n,r,i)}function s6(n,e,t){if(aK(n)){if("value"in n)return n.type==="html"&&!t?"":n.value;if(e&&"alt"in n&&n.alt)return n.alt;if("children"in n)return UD(n.children,e,t)}return Array.isArray(n)?UD(n,e,t):""}function UD(n,e,t){const r=[];let i=-1;for(;++i<n.length;)r[i]=s6(n[i],e,t);return r.join("")}function aK(n){return!!(n&&typeof n=="object")}const jD=document.createElement("i");function nI(n){const e="&"+n+";";jD.innerHTML=e;const t=jD.textContent;return t.charCodeAt(t.length-1)===59&&n!=="semi"||t===e?!1:t}function uo(n,e,t,r){const i=n.length;let a=0,s;if(e<0?e=-e>i?0:i+e:e=e>i?i:e,t=t>0?t:0,r.length<1e4)s=Array.from(r),s.unshift(e,t),n.splice(...s);else for(t&&n.splice(e,t);a<r.length;)s=r.slice(a,a+1e4),s.unshift(e,0),n.splice(...s),a+=1e4,e+=1e4}function ja(n,e){return n.length>0?(uo(n,n.length,0,e),n):e}const FD={}.hasOwnProperty;function sK(n){const e={};let t=-1;for(;++t<n.length;)oK(e,n[t]);return e}function oK(n,e){let t;for(t in e){const i=(FD.call(n,t)?n[t]:void 0)||(n[t]={}),a=e[t];let s;if(a)for(s in a){FD.call(i,s)||(i[s]=[]);const o=a[s];lK(i[s],Array.isArray(o)?o:o?[o]:[])}}}function lK(n,e){let t=-1;const r=[];for(;++t<e.length;)(e[t].add==="after"?n:r).push(e[t]);uo(n,0,0,r)}function o6(n,e){const t=Number.parseInt(n,e);return t<9||t===11||t>13&&t<32||t>126&&t<160||t>55295&&t<57344||t>64975&&t<65008||(t&65535)===65535||(t&65535)===65534||t>1114111?"�":String.fromCodePoint(t)}function ld(n){return n.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const Gs=ou(/[A-Za-z]/),va=ou(/[\dA-Za-z]/),uK=ou(/[#-'*+\--9=?A-Z^-~]/);function YC(n){return n!==null&&(n<32||n===127)}const ZC=ou(/\d/),cK=ou(/[\dA-Fa-f]/),fK=ou(/[!-/:-@[-`{-~]/);function xt(n){return n!==null&&n<-2}function Vi(n){return n!==null&&(n<0||n===32)}function cn(n){return n===-2||n===-1||n===32}const dK=ou(new RegExp("\\p{P}|\\p{S}","u")),hK=ou(/\s/);function ou(n){return e;function e(t){return t!==null&&t>-1&&n.test(String.fromCharCode(t))}}function $d(n){const e=[];let t=-1,r=0,i=0;for(;++t<n.length;){const a=n.charCodeAt(t);let s="";if(a===37&&va(n.charCodeAt(t+1))&&va(n.charCodeAt(t+2)))i=2;else if(a<128)/[!#$&-;=?-Z_a-z~]/.test(String.fromCharCode(a))||(s=String.fromCharCode(a));else if(a>55295&&a<57344){const o=n.charCodeAt(t+1);a<56320&&o>56319&&o<57344?(s=String.fromCharCode(a,o),i=1):s="�"}else s=String.fromCharCode(a);s&&(e.push(n.slice(r,t),encodeURIComponent(s)),r=t+i+1,s=""),i&&(t+=i,i=0)}return e.join("")+n.slice(r)}function kn(n,e,t,r){const i=r?r-1:Number.POSITIVE_INFINITY;let a=0;return s;function s(u){return cn(u)?(n.enter(t),o(u)):e(u)}function o(u){return cn(u)&&a++<i?(n.consume(u),o):(n.exit(t),e(u))}}const pK={tokenize:mK};function mK(n){const e=n.attempt(this.parser.constructs.contentInitial,r,i);let t;return e;function r(o){if(o===null){n.consume(o);return}return n.enter("lineEnding"),n.consume(o),n.exit("lineEnding"),kn(n,e,"linePrefix")}function i(o){return n.enter("paragraph"),a(o)}function a(o){const u=n.enter("chunkText",{contentType:"text",previous:t});return t&&(t.next=u),t=u,s(o)}function s(o){if(o===null){n.exit("chunkText"),n.exit("paragraph"),n.consume(o);return}return xt(o)?(n.consume(o),n.exit("chunkText"),a):(n.consume(o),s)}}const gK={tokenize:yK},BD={tokenize:vK};function yK(n){const e=this,t=[];let r=0,i,a,s;return o;function o(A){if(r<t.length){const R=t[r];return e.containerState=R[1],n.attempt(R[0].continuation,u,c)(A)}return c(A)}function u(A){if(r++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,i&&C();const R=e.events.length;let P=R,N;for(;P--;)if(e.events[P][0]==="exit"&&e.events[P][1].type==="chunkFlow"){N=e.events[P][1].end;break}E(r);let U=R;for(;U<e.events.length;)e.events[U][1].end={...N},U++;return uo(e.events,P+1,0,e.events.slice(R)),e.events.length=U,c(A)}return o(A)}function c(A){if(r===t.length){if(!i)return m(A);if(i.currentConstruct&&i.currentConstruct.concrete)return _(A);e.interrupt=!!(i.currentConstruct&&!i._gfmTableDynamicInterruptHack)}return e.containerState={},n.check(BD,d,h)(A)}function d(A){return i&&C(),E(r),m(A)}function h(A){return e.parser.lazy[e.now().line]=r!==t.length,s=e.now().offset,_(A)}function m(A){return e.containerState={},n.attempt(BD,g,_)(A)}function g(A){return r++,t.push([e.currentConstruct,e.containerState]),m(A)}function _(A){if(A===null){i&&C(),E(0),n.consume(A);return}return i=i||e.parser.flow(e.now()),n.enter("chunkFlow",{_tokenizer:i,contentType:"flow",previous:a}),w(A)}function w(A){if(A===null){S(n.exit("chunkFlow"),!0),E(0),n.consume(A);return}return xt(A)?(n.consume(A),S(n.exit("chunkFlow")),r=0,e.interrupt=void 0,o):(n.consume(A),w)}function S(A,R){const P=e.sliceStream(A);if(R&&P.push(null),A.previous=a,a&&(a.next=A),a=A,i.defineSkip(A.start),i.write(P),e.parser.lazy[A.start.line]){let N=i.events.length;for(;N--;)if(i.events[N][1].start.offset<s&&(!i.events[N][1].end||i.events[N][1].end.offset>s))return;const U=e.events.length;let k=U,B,H;for(;k--;)if(e.events[k][0]==="exit"&&e.events[k][1].type==="chunkFlow"){if(B){H=e.events[k][1].end;break}B=!0}for(E(r),N=U;N<e.events.length;)e.events[N][1].end={...H},N++;uo(e.events,k+1,0,e.events.slice(U)),e.events.length=N}}function E(A){let R=t.length;for(;R-- >A;){const P=t[R];e.containerState=P[1],P[0].exit.call(e,n)}t.length=A}function C(){i.write([null]),a=void 0,i=void 0,e.containerState._closeFlow=void 0}}function vK(n,e,t){return kn(n,n.attempt(this.parser.constructs.document,e,t),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}function qD(n){if(n===null||Vi(n)||hK(n))return 1;if(dK(n))return 2}function rI(n,e,t){const r=[];let i=-1;for(;++i<n.length;){const a=n[i].resolveAll;a&&!r.includes(a)&&(e=a(e,t),r.push(a))}return e}const XC={name:"attention",resolveAll:_K,tokenize:bK};function _K(n,e){let t=-1,r,i,a,s,o,u,c,d;for(;++t<n.length;)if(n[t][0]==="enter"&&n[t][1].type==="attentionSequence"&&n[t][1]._close){for(r=t;r--;)if(n[r][0]==="exit"&&n[r][1].type==="attentionSequence"&&n[r][1]._open&&e.sliceSerialize(n[r][1]).charCodeAt(0)===e.sliceSerialize(n[t][1]).charCodeAt(0)){if((n[r][1]._close||n[t][1]._open)&&(n[t][1].end.offset-n[t][1].start.offset)%3&&!((n[r][1].end.offset-n[r][1].start.offset+n[t][1].end.offset-n[t][1].start.offset)%3))continue;u=n[r][1].end.offset-n[r][1].start.offset>1&&n[t][1].end.offset-n[t][1].start.offset>1?2:1;const h={...n[r][1].end},m={...n[t][1].start};VD(h,-u),VD(m,u),s={type:u>1?"strongSequence":"emphasisSequence",start:h,end:{...n[r][1].end}},o={type:u>1?"strongSequence":"emphasisSequence",start:{...n[t][1].start},end:m},a={type:u>1?"strongText":"emphasisText",start:{...n[r][1].end},end:{...n[t][1].start}},i={type:u>1?"strong":"emphasis",start:{...s.start},end:{...o.end}},n[r][1].end={...s.start},n[t][1].start={...o.end},c=[],n[r][1].end.offset-n[r][1].start.offset&&(c=ja(c,[["enter",n[r][1],e],["exit",n[r][1],e]])),c=ja(c,[["enter",i,e],["enter",s,e],["exit",s,e],["enter",a,e]]),c=ja(c,rI(e.parser.constructs.insideSpan.null,n.slice(r+1,t),e)),c=ja(c,[["exit",a,e],["enter",o,e],["exit",o,e],["exit",i,e]]),n[t][1].end.offset-n[t][1].start.offset?(d=2,c=ja(c,[["enter",n[t][1],e],["exit",n[t][1],e]])):d=0,uo(n,r-1,t-r+3,c),t=r+c.length-d-2;break}}for(t=-1;++t<n.length;)n[t][1].type==="attentionSequence"&&(n[t][1].type="data");return n}function bK(n,e){const t=this.parser.constructs.attentionMarkers.null,r=this.previous,i=qD(r);let a;return s;function s(u){return a=u,n.enter("attentionSequence"),o(u)}function o(u){if(u===a)return n.consume(u),o;const c=n.exit("attentionSequence"),d=qD(u),h=!d||d===2&&i||t.includes(u),m=!i||i===2&&d||t.includes(r);return c._open=!!(a===42?h:h&&(i||!m)),c._close=!!(a===42?m:m&&(d||!h)),e(u)}}function VD(n,e){n.column+=e,n.offset+=e,n._bufferIndex+=e}const wK={name:"autolink",tokenize:EK};function EK(n,e,t){let r=0;return i;function i(g){return n.enter("autolink"),n.enter("autolinkMarker"),n.consume(g),n.exit("autolinkMarker"),n.enter("autolinkProtocol"),a}function a(g){return Gs(g)?(n.consume(g),s):g===64?t(g):c(g)}function s(g){return g===43||g===45||g===46||va(g)?(r=1,o(g)):c(g)}function o(g){return g===58?(n.consume(g),r=0,u):(g===43||g===45||g===46||va(g))&&r++<32?(n.consume(g),o):(r=0,c(g))}function u(g){return g===62?(n.exit("autolinkProtocol"),n.enter("autolinkMarker"),n.consume(g),n.exit("autolinkMarker"),n.exit("autolink"),e):g===null||g===32||g===60||YC(g)?t(g):(n.consume(g),u)}function c(g){return g===64?(n.consume(g),d):uK(g)?(n.consume(g),c):t(g)}function d(g){return va(g)?h(g):t(g)}function h(g){return g===46?(n.consume(g),r=0,d):g===62?(n.exit("autolinkProtocol").type="autolinkEmail",n.enter("autolinkMarker"),n.consume(g),n.exit("autolinkMarker"),n.exit("autolink"),e):m(g)}function m(g){if((g===45||va(g))&&r++<63){const _=g===45?m:h;return n.consume(g),_}return t(g)}}const bb={partial:!0,tokenize:SK};function SK(n,e,t){return r;function r(a){return cn(a)?kn(n,i,"linePrefix")(a):i(a)}function i(a){return a===null||xt(a)?e(a):t(a)}}const l6={continuation:{tokenize:AK},exit:CK,name:"blockQuote",tokenize:TK};function TK(n,e,t){const r=this;return i;function i(s){if(s===62){const o=r.containerState;return o.open||(n.enter("blockQuote",{_container:!0}),o.open=!0),n.enter("blockQuotePrefix"),n.enter("blockQuoteMarker"),n.consume(s),n.exit("blockQuoteMarker"),a}return t(s)}function a(s){return cn(s)?(n.enter("blockQuotePrefixWhitespace"),n.consume(s),n.exit("blockQuotePrefixWhitespace"),n.exit("blockQuotePrefix"),e):(n.exit("blockQuotePrefix"),e(s))}}function AK(n,e,t){const r=this;return i;function i(s){return cn(s)?kn(n,a,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(s):a(s)}function a(s){return n.attempt(l6,e,t)(s)}}function CK(n){n.exit("blockQuote")}const u6={name:"characterEscape",tokenize:xK};function xK(n,e,t){return r;function r(a){return n.enter("characterEscape"),n.enter("escapeMarker"),n.consume(a),n.exit("escapeMarker"),i}function i(a){return fK(a)?(n.enter("characterEscapeValue"),n.consume(a),n.exit("characterEscapeValue"),n.exit("characterEscape"),e):t(a)}}const c6={name:"characterReference",tokenize:RK};function RK(n,e,t){const r=this;let i=0,a,s;return o;function o(h){return n.enter("characterReference"),n.enter("characterReferenceMarker"),n.consume(h),n.exit("characterReferenceMarker"),u}function u(h){return h===35?(n.enter("characterReferenceMarkerNumeric"),n.consume(h),n.exit("characterReferenceMarkerNumeric"),c):(n.enter("characterReferenceValue"),a=31,s=va,d(h))}function c(h){return h===88||h===120?(n.enter("characterReferenceMarkerHexadecimal"),n.consume(h),n.exit("characterReferenceMarkerHexadecimal"),n.enter("characterReferenceValue"),a=6,s=cK,d):(n.enter("characterReferenceValue"),a=7,s=ZC,d(h))}function d(h){if(h===59&&i){const m=n.exit("characterReferenceValue");return s===va&&!nI(r.sliceSerialize(m))?t(h):(n.enter("characterReferenceMarker"),n.consume(h),n.exit("characterReferenceMarker"),n.exit("characterReference"),e)}return s(h)&&i++<a?(n.consume(h),d):t(h)}}const zD={partial:!0,tokenize:PK},HD={concrete:!0,name:"codeFenced",tokenize:IK};function IK(n,e,t){const r=this,i={partial:!0,tokenize:P};let a=0,s=0,o;return u;function u(N){return c(N)}function c(N){const U=r.events[r.events.length-1];return a=U&&U[1].type==="linePrefix"?U[2].sliceSerialize(U[1],!0).length:0,o=N,n.enter("codeFenced"),n.enter("codeFencedFence"),n.enter("codeFencedFenceSequence"),d(N)}function d(N){return N===o?(s++,n.consume(N),d):s<3?t(N):(n.exit("codeFencedFenceSequence"),cn(N)?kn(n,h,"whitespace")(N):h(N))}function h(N){return N===null||xt(N)?(n.exit("codeFencedFence"),r.interrupt?e(N):n.check(zD,w,R)(N)):(n.enter("codeFencedFenceInfo"),n.enter("chunkString",{contentType:"string"}),m(N))}function m(N){return N===null||xt(N)?(n.exit("chunkString"),n.exit("codeFencedFenceInfo"),h(N)):cn(N)?(n.exit("chunkString"),n.exit("codeFencedFenceInfo"),kn(n,g,"whitespace")(N)):N===96&&N===o?t(N):(n.consume(N),m)}function g(N){return N===null||xt(N)?h(N):(n.enter("codeFencedFenceMeta"),n.enter("chunkString",{contentType:"string"}),_(N))}function _(N){return N===null||xt(N)?(n.exit("chunkString"),n.exit("codeFencedFenceMeta"),h(N)):N===96&&N===o?t(N):(n.consume(N),_)}function w(N){return n.attempt(i,R,S)(N)}function S(N){return n.enter("lineEnding"),n.consume(N),n.exit("lineEnding"),E}function E(N){return a>0&&cn(N)?kn(n,C,"linePrefix",a+1)(N):C(N)}function C(N){return N===null||xt(N)?n.check(zD,w,R)(N):(n.enter("codeFlowValue"),A(N))}function A(N){return N===null||xt(N)?(n.exit("codeFlowValue"),C(N)):(n.consume(N),A)}function R(N){return n.exit("codeFenced"),e(N)}function P(N,U,k){let B=0;return H;function H(se){return N.enter("lineEnding"),N.consume(se),N.exit("lineEnding"),G}function G(se){return N.enter("codeFencedFence"),cn(se)?kn(N,z,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(se):z(se)}function z(se){return se===o?(N.enter("codeFencedFenceSequence"),oe(se)):k(se)}function oe(se){return se===o?(B++,N.consume(se),oe):B>=s?(N.exit("codeFencedFenceSequence"),cn(se)?kn(N,te,"whitespace")(se):te(se)):k(se)}function te(se){return se===null||xt(se)?(N.exit("codeFencedFence"),U(se)):k(se)}}}function PK(n,e,t){const r=this;return i;function i(s){return s===null?t(s):(n.enter("lineEnding"),n.consume(s),n.exit("lineEnding"),a)}function a(s){return r.parser.lazy[r.now().line]?t(s):e(s)}}const GE={name:"codeIndented",tokenize:kK},OK={partial:!0,tokenize:NK};function kK(n,e,t){const r=this;return i;function i(c){return n.enter("codeIndented"),kn(n,a,"linePrefix",5)(c)}function a(c){const d=r.events[r.events.length-1];return d&&d[1].type==="linePrefix"&&d[2].sliceSerialize(d[1],!0).length>=4?s(c):t(c)}function s(c){return c===null?u(c):xt(c)?n.attempt(OK,s,u)(c):(n.enter("codeFlowValue"),o(c))}function o(c){return c===null||xt(c)?(n.exit("codeFlowValue"),s(c)):(n.consume(c),o)}function u(c){return n.exit("codeIndented"),e(c)}}function NK(n,e,t){const r=this;return i;function i(s){return r.parser.lazy[r.now().line]?t(s):xt(s)?(n.enter("lineEnding"),n.consume(s),n.exit("lineEnding"),i):kn(n,a,"linePrefix",5)(s)}function a(s){const o=r.events[r.events.length-1];return o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?e(s):xt(s)?i(s):t(s)}}const MK={name:"codeText",previous:$K,resolve:DK,tokenize:LK};function DK(n){let e=n.length-4,t=3,r,i;if((n[t][1].type==="lineEnding"||n[t][1].type==="space")&&(n[e][1].type==="lineEnding"||n[e][1].type==="space")){for(r=t;++r<e;)if(n[r][1].type==="codeTextData"){n[t][1].type="codeTextPadding",n[e][1].type="codeTextPadding",t+=2,e-=2;break}}for(r=t-1,e++;++r<=e;)i===void 0?r!==e&&n[r][1].type!=="lineEnding"&&(i=r):(r===e||n[r][1].type==="lineEnding")&&(n[i][1].type="codeTextData",r!==i+2&&(n[i][1].end=n[r-1][1].end,n.splice(i+2,r-i-2),e-=r-i-2,r=i+2),i=void 0);return n}function $K(n){return n!==96||this.events[this.events.length-1][1].type==="characterEscape"}function LK(n,e,t){let r=0,i,a;return s;function s(h){return n.enter("codeText"),n.enter("codeTextSequence"),o(h)}function o(h){return h===96?(n.consume(h),r++,o):(n.exit("codeTextSequence"),u(h))}function u(h){return h===null?t(h):h===32?(n.enter("space"),n.consume(h),n.exit("space"),u):h===96?(a=n.enter("codeTextSequence"),i=0,d(h)):xt(h)?(n.enter("lineEnding"),n.consume(h),n.exit("lineEnding"),u):(n.enter("codeTextData"),c(h))}function c(h){return h===null||h===32||h===96||xt(h)?(n.exit("codeTextData"),u(h)):(n.consume(h),c)}function d(h){return h===96?(n.consume(h),i++,d):i===r?(n.exit("codeTextSequence"),n.exit("codeText"),e(h)):(a.type="codeTextData",c(h))}}class UK{constructor(e){this.left=e?[...e]:[],this.right=[]}get(e){if(e<0||e>=this.left.length+this.right.length)throw new RangeError("Cannot access index `"+e+"` in a splice buffer of size `"+(this.left.length+this.right.length)+"`");return e<this.left.length?this.left[e]:this.right[this.right.length-e+this.left.length-1]}get length(){return this.left.length+this.right.length}shift(){return this.setCursor(0),this.right.pop()}slice(e,t){const r=t??Number.POSITIVE_INFINITY;return r<this.left.length?this.left.slice(e,r):e>this.left.length?this.right.slice(this.right.length-r+this.left.length,this.right.length-e+this.left.length).reverse():this.left.slice(e).concat(this.right.slice(this.right.length-r+this.left.length).reverse())}splice(e,t,r){const i=t||0;this.setCursor(Math.trunc(e));const a=this.right.splice(this.right.length-i,Number.POSITIVE_INFINITY);return r&&Zh(this.left,r),a.reverse()}pop(){return this.setCursor(Number.POSITIVE_INFINITY),this.left.pop()}push(e){this.setCursor(Number.POSITIVE_INFINITY),this.left.push(e)}pushMany(e){this.setCursor(Number.POSITIVE_INFINITY),Zh(this.left,e)}unshift(e){this.setCursor(0),this.right.push(e)}unshiftMany(e){this.setCursor(0),Zh(this.right,e.reverse())}setCursor(e){if(!(e===this.left.length||e>this.left.length&&this.right.length===0||e<0&&this.left.length===0))if(e<this.left.length){const t=this.left.splice(e,Number.POSITIVE_INFINITY);Zh(this.right,t.reverse())}else{const t=this.right.splice(this.left.length+this.right.length-e,Number.POSITIVE_INFINITY);Zh(this.left,t.reverse())}}}function Zh(n,e){let t=0;if(e.length<1e4)n.push(...e);else for(;t<e.length;)n.push(...e.slice(t,t+1e4)),t+=1e4}function f6(n){const e={};let t=-1,r,i,a,s,o,u,c;const d=new UK(n);for(;++t<d.length;){for(;t in e;)t=e[t];if(r=d.get(t),t&&r[1].type==="chunkFlow"&&d.get(t-1)[1].type==="listItemPrefix"&&(u=r[1]._tokenizer.events,a=0,a<u.length&&u[a][1].type==="lineEndingBlank"&&(a+=2),a<u.length&&u[a][1].type==="content"))for(;++a<u.length&&u[a][1].type!=="content";)u[a][1].type==="chunkText"&&(u[a][1]._isInFirstContentOfListItem=!0,a++);if(r[0]==="enter")r[1].contentType&&(Object.assign(e,jK(d,t)),t=e[t],c=!0);else if(r[1]._container){for(a=t,i=void 0;a--;)if(s=d.get(a),s[1].type==="lineEnding"||s[1].type==="lineEndingBlank")s[0]==="enter"&&(i&&(d.get(i)[1].type="lineEndingBlank"),s[1].type="lineEnding",i=a);else if(!(s[1].type==="linePrefix"||s[1].type==="listItemIndent"))break;i&&(r[1].end={...d.get(i)[1].start},o=d.slice(i,t),o.unshift(r),d.splice(i,t-i+1,o))}}return uo(n,0,Number.POSITIVE_INFINITY,d.slice(0)),!c}function jK(n,e){const t=n.get(e)[1],r=n.get(e)[2];let i=e-1;const a=[];let s=t._tokenizer;s||(s=r.parser[t.contentType](t.start),t._contentTypeTextTrailing&&(s._contentTypeTextTrailing=!0));const o=s.events,u=[],c={};let d,h,m=-1,g=t,_=0,w=0;const S=[w];for(;g;){for(;n.get(++i)[1]!==g;);a.push(i),g._tokenizer||(d=r.sliceStream(g),g.next||d.push(null),h&&s.defineSkip(g.start),g._isInFirstContentOfListItem&&(s._gfmTasklistFirstContentOfListItem=!0),s.write(d),g._isInFirstContentOfListItem&&(s._gfmTasklistFirstContentOfListItem=void 0)),h=g,g=g.next}for(g=t;++m<o.length;)o[m][0]==="exit"&&o[m-1][0]==="enter"&&o[m][1].type===o[m-1][1].type&&o[m][1].start.line!==o[m][1].end.line&&(w=m+1,S.push(w),g._tokenizer=void 0,g.previous=void 0,g=g.next);for(s.events=[],g?(g._tokenizer=void 0,g.previous=void 0):S.pop(),m=S.length;m--;){const E=o.slice(S[m],S[m+1]),C=a.pop();u.push([C,C+E.length-1]),n.splice(C,2,E)}for(u.reverse(),m=-1;++m<u.length;)c[_+u[m][0]]=_+u[m][1],_+=u[m][1]-u[m][0]-1;return c}const FK={resolve:qK,tokenize:VK},BK={partial:!0,tokenize:zK};function qK(n){return f6(n),n}function VK(n,e){let t;return r;function r(o){return n.enter("content"),t=n.enter("chunkContent",{contentType:"content"}),i(o)}function i(o){return o===null?a(o):xt(o)?n.check(BK,s,a)(o):(n.consume(o),i)}function a(o){return n.exit("chunkContent"),n.exit("content"),e(o)}function s(o){return n.consume(o),n.exit("chunkContent"),t.next=n.enter("chunkContent",{contentType:"content",previous:t}),t=t.next,i}}function zK(n,e,t){const r=this;return i;function i(s){return n.exit("chunkContent"),n.enter("lineEnding"),n.consume(s),n.exit("lineEnding"),kn(n,a,"linePrefix")}function a(s){if(s===null||xt(s))return t(s);const o=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&o&&o[1].type==="linePrefix"&&o[2].sliceSerialize(o[1],!0).length>=4?e(s):n.interrupt(r.parser.constructs.flow,t,e)(s)}}function d6(n,e,t,r,i,a,s,o,u){const c=u||Number.POSITIVE_INFINITY;let d=0;return h;function h(E){return E===60?(n.enter(r),n.enter(i),n.enter(a),n.consume(E),n.exit(a),m):E===null||E===32||E===41||YC(E)?t(E):(n.enter(r),n.enter(s),n.enter(o),n.enter("chunkString",{contentType:"string"}),w(E))}function m(E){return E===62?(n.enter(a),n.consume(E),n.exit(a),n.exit(i),n.exit(r),e):(n.enter(o),n.enter("chunkString",{contentType:"string"}),g(E))}function g(E){return E===62?(n.exit("chunkString"),n.exit(o),m(E)):E===null||E===60||xt(E)?t(E):(n.consume(E),E===92?_:g)}function _(E){return E===60||E===62||E===92?(n.consume(E),g):g(E)}function w(E){return!d&&(E===null||E===41||Vi(E))?(n.exit("chunkString"),n.exit(o),n.exit(s),n.exit(r),e(E)):d<c&&E===40?(n.consume(E),d++,w):E===41?(n.consume(E),d--,w):E===null||E===32||E===40||YC(E)?t(E):(n.consume(E),E===92?S:w)}function S(E){return E===40||E===41||E===92?(n.consume(E),w):w(E)}}function h6(n,e,t,r,i,a){const s=this;let o=0,u;return c;function c(g){return n.enter(r),n.enter(i),n.consume(g),n.exit(i),n.enter(a),d}function d(g){return o>999||g===null||g===91||g===93&&!u||g===94&&!o&&"_hiddenFootnoteSupport"in s.parser.constructs?t(g):g===93?(n.exit(a),n.enter(i),n.consume(g),n.exit(i),n.exit(r),e):xt(g)?(n.enter("lineEnding"),n.consume(g),n.exit("lineEnding"),d):(n.enter("chunkString",{contentType:"string"}),h(g))}function h(g){return g===null||g===91||g===93||xt(g)||o++>999?(n.exit("chunkString"),d(g)):(n.consume(g),u||(u=!cn(g)),g===92?m:h)}function m(g){return g===91||g===92||g===93?(n.consume(g),o++,h):h(g)}}function p6(n,e,t,r,i,a){let s;return o;function o(m){return m===34||m===39||m===40?(n.enter(r),n.enter(i),n.consume(m),n.exit(i),s=m===40?41:m,u):t(m)}function u(m){return m===s?(n.enter(i),n.consume(m),n.exit(i),n.exit(r),e):(n.enter(a),c(m))}function c(m){return m===s?(n.exit(a),u(s)):m===null?t(m):xt(m)?(n.enter("lineEnding"),n.consume(m),n.exit("lineEnding"),kn(n,c,"linePrefix")):(n.enter("chunkString",{contentType:"string"}),d(m))}function d(m){return m===s||m===null||xt(m)?(n.exit("chunkString"),c(m)):(n.consume(m),m===92?h:d)}function h(m){return m===s||m===92?(n.consume(m),d):d(m)}}function jp(n,e){let t;return r;function r(i){return xt(i)?(n.enter("lineEnding"),n.consume(i),n.exit("lineEnding"),t=!0,r):cn(i)?kn(n,r,t?"linePrefix":"lineSuffix")(i):e(i)}}const HK={name:"definition",tokenize:WK},GK={partial:!0,tokenize:KK};function WK(n,e,t){const r=this;let i;return a;function a(g){return n.enter("definition"),s(g)}function s(g){return h6.call(r,n,o,t,"definitionLabel","definitionLabelMarker","definitionLabelString")(g)}function o(g){return i=ld(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),g===58?(n.enter("definitionMarker"),n.consume(g),n.exit("definitionMarker"),u):t(g)}function u(g){return Vi(g)?jp(n,c)(g):c(g)}function c(g){return d6(n,d,t,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(g)}function d(g){return n.attempt(GK,h,h)(g)}function h(g){return cn(g)?kn(n,m,"whitespace")(g):m(g)}function m(g){return g===null||xt(g)?(n.exit("definition"),r.parser.defined.push(i),e(g)):t(g)}}function KK(n,e,t){return r;function r(o){return Vi(o)?jp(n,i)(o):t(o)}function i(o){return p6(n,a,t,"definitionTitle","definitionTitleMarker","definitionTitleString")(o)}function a(o){return cn(o)?kn(n,s,"whitespace")(o):s(o)}function s(o){return o===null||xt(o)?e(o):t(o)}}const JK={name:"hardBreakEscape",tokenize:YK};function YK(n,e,t){return r;function r(a){return n.enter("hardBreakEscape"),n.consume(a),i}function i(a){return xt(a)?(n.exit("hardBreakEscape"),e(a)):t(a)}}const ZK={name:"headingAtx",resolve:XK,tokenize:QK};function XK(n,e){let t=n.length-2,r=3,i,a;return n[r][1].type==="whitespace"&&(r+=2),t-2>r&&n[t][1].type==="whitespace"&&(t-=2),n[t][1].type==="atxHeadingSequence"&&(r===t-1||t-4>r&&n[t-2][1].type==="whitespace")&&(t-=r+1===t?2:4),t>r&&(i={type:"atxHeadingText",start:n[r][1].start,end:n[t][1].end},a={type:"chunkText",start:n[r][1].start,end:n[t][1].end,contentType:"text"},uo(n,r,t-r+1,[["enter",i,e],["enter",a,e],["exit",a,e],["exit",i,e]])),n}function QK(n,e,t){let r=0;return i;function i(d){return n.enter("atxHeading"),a(d)}function a(d){return n.enter("atxHeadingSequence"),s(d)}function s(d){return d===35&&r++<6?(n.consume(d),s):d===null||Vi(d)?(n.exit("atxHeadingSequence"),o(d)):t(d)}function o(d){return d===35?(n.enter("atxHeadingSequence"),u(d)):d===null||xt(d)?(n.exit("atxHeading"),e(d)):cn(d)?kn(n,o,"whitespace")(d):(n.enter("atxHeadingText"),c(d))}function u(d){return d===35?(n.consume(d),u):(n.exit("atxHeadingSequence"),o(d))}function c(d){return d===null||d===35||Vi(d)?(n.exit("atxHeadingText"),o(d)):(n.consume(d),c)}}const eJ=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],GD=["pre","script","style","textarea"],tJ={concrete:!0,name:"htmlFlow",resolveTo:iJ,tokenize:aJ},nJ={partial:!0,tokenize:oJ},rJ={partial:!0,tokenize:sJ};function iJ(n){let e=n.length;for(;e--&&!(n[e][0]==="enter"&&n[e][1].type==="htmlFlow"););return e>1&&n[e-2][1].type==="linePrefix"&&(n[e][1].start=n[e-2][1].start,n[e+1][1].start=n[e-2][1].start,n.splice(e-2,2)),n}function aJ(n,e,t){const r=this;let i,a,s,o,u;return c;function c(F){return d(F)}function d(F){return n.enter("htmlFlow"),n.enter("htmlFlowData"),n.consume(F),h}function h(F){return F===33?(n.consume(F),m):F===47?(n.consume(F),a=!0,w):F===63?(n.consume(F),i=3,r.interrupt?e:$):Gs(F)?(n.consume(F),s=String.fromCharCode(F),S):t(F)}function m(F){return F===45?(n.consume(F),i=2,g):F===91?(n.consume(F),i=5,o=0,_):Gs(F)?(n.consume(F),i=4,r.interrupt?e:$):t(F)}function g(F){return F===45?(n.consume(F),r.interrupt?e:$):t(F)}function _(F){const ae="CDATA[";return F===ae.charCodeAt(o++)?(n.consume(F),o===ae.length?r.interrupt?e:z:_):t(F)}function w(F){return Gs(F)?(n.consume(F),s=String.fromCharCode(F),S):t(F)}function S(F){if(F===null||F===47||F===62||Vi(F)){const ae=F===47,fe=s.toLowerCase();return!ae&&!a&&GD.includes(fe)?(i=1,r.interrupt?e(F):z(F)):eJ.includes(s.toLowerCase())?(i=6,ae?(n.consume(F),E):r.interrupt?e(F):z(F)):(i=7,r.interrupt&&!r.parser.lazy[r.now().line]?t(F):a?C(F):A(F))}return F===45||va(F)?(n.consume(F),s+=String.fromCharCode(F),S):t(F)}function E(F){return F===62?(n.consume(F),r.interrupt?e:z):t(F)}function C(F){return cn(F)?(n.consume(F),C):H(F)}function A(F){return F===47?(n.consume(F),H):F===58||F===95||Gs(F)?(n.consume(F),R):cn(F)?(n.consume(F),A):H(F)}function R(F){return F===45||F===46||F===58||F===95||va(F)?(n.consume(F),R):P(F)}function P(F){return F===61?(n.consume(F),N):cn(F)?(n.consume(F),P):A(F)}function N(F){return F===null||F===60||F===61||F===62||F===96?t(F):F===34||F===39?(n.consume(F),u=F,U):cn(F)?(n.consume(F),N):k(F)}function U(F){return F===u?(n.consume(F),u=null,B):F===null||xt(F)?t(F):(n.consume(F),U)}function k(F){return F===null||F===34||F===39||F===47||F===60||F===61||F===62||F===96||Vi(F)?P(F):(n.consume(F),k)}function B(F){return F===47||F===62||cn(F)?A(F):t(F)}function H(F){return F===62?(n.consume(F),G):t(F)}function G(F){return F===null||xt(F)?z(F):cn(F)?(n.consume(F),G):t(F)}function z(F){return F===45&&i===2?(n.consume(F),ee):F===60&&i===1?(n.consume(F),le):F===62&&i===4?(n.consume(F),ve):F===63&&i===3?(n.consume(F),$):F===93&&i===5?(n.consume(F),we):xt(F)&&(i===6||i===7)?(n.exit("htmlFlowData"),n.check(nJ,Te,oe)(F)):F===null||xt(F)?(n.exit("htmlFlowData"),oe(F)):(n.consume(F),z)}function oe(F){return n.check(rJ,te,Te)(F)}function te(F){return n.enter("lineEnding"),n.consume(F),n.exit("lineEnding"),se}function se(F){return F===null||xt(F)?oe(F):(n.enter("htmlFlowData"),z(F))}function ee(F){return F===45?(n.consume(F),$):z(F)}function le(F){return F===47?(n.consume(F),s="",pe):z(F)}function pe(F){if(F===62){const ae=s.toLowerCase();return GD.includes(ae)?(n.consume(F),ve):z(F)}return Gs(F)&&s.length<8?(n.consume(F),s+=String.fromCharCode(F),pe):z(F)}function we(F){return F===93?(n.consume(F),$):z(F)}function $(F){return F===62?(n.consume(F),ve):F===45&&i===2?(n.consume(F),$):z(F)}function ve(F){return F===null||xt(F)?(n.exit("htmlFlowData"),Te(F)):(n.consume(F),ve)}function Te(F){return n.exit("htmlFlow"),e(F)}}function sJ(n,e,t){const r=this;return i;function i(s){return xt(s)?(n.enter("lineEnding"),n.consume(s),n.exit("lineEnding"),a):t(s)}function a(s){return r.parser.lazy[r.now().line]?t(s):e(s)}}function oJ(n,e,t){return r;function r(i){return n.enter("lineEnding"),n.consume(i),n.exit("lineEnding"),n.attempt(bb,e,t)}}const lJ={name:"htmlText",tokenize:uJ};function uJ(n,e,t){const r=this;let i,a,s;return o;function o($){return n.enter("htmlText"),n.enter("htmlTextData"),n.consume($),u}function u($){return $===33?(n.consume($),c):$===47?(n.consume($),P):$===63?(n.consume($),A):Gs($)?(n.consume($),k):t($)}function c($){return $===45?(n.consume($),d):$===91?(n.consume($),a=0,_):Gs($)?(n.consume($),C):t($)}function d($){return $===45?(n.consume($),g):t($)}function h($){return $===null?t($):$===45?(n.consume($),m):xt($)?(s=h,le($)):(n.consume($),h)}function m($){return $===45?(n.consume($),g):h($)}function g($){return $===62?ee($):$===45?m($):h($)}function _($){const ve="CDATA[";return $===ve.charCodeAt(a++)?(n.consume($),a===ve.length?w:_):t($)}function w($){return $===null?t($):$===93?(n.consume($),S):xt($)?(s=w,le($)):(n.consume($),w)}function S($){return $===93?(n.consume($),E):w($)}function E($){return $===62?ee($):$===93?(n.consume($),E):w($)}function C($){return $===null||$===62?ee($):xt($)?(s=C,le($)):(n.consume($),C)}function A($){return $===null?t($):$===63?(n.consume($),R):xt($)?(s=A,le($)):(n.consume($),A)}function R($){return $===62?ee($):A($)}function P($){return Gs($)?(n.consume($),N):t($)}function N($){return $===45||va($)?(n.consume($),N):U($)}function U($){return xt($)?(s=U,le($)):cn($)?(n.consume($),U):ee($)}function k($){return $===45||va($)?(n.consume($),k):$===47||$===62||Vi($)?B($):t($)}function B($){return $===47?(n.consume($),ee):$===58||$===95||Gs($)?(n.consume($),H):xt($)?(s=B,le($)):cn($)?(n.consume($),B):ee($)}function H($){return $===45||$===46||$===58||$===95||va($)?(n.consume($),H):G($)}function G($){return $===61?(n.consume($),z):xt($)?(s=G,le($)):cn($)?(n.consume($),G):B($)}function z($){return $===null||$===60||$===61||$===62||$===96?t($):$===34||$===39?(n.consume($),i=$,oe):xt($)?(s=z,le($)):cn($)?(n.consume($),z):(n.consume($),te)}function oe($){return $===i?(n.consume($),i=void 0,se):$===null?t($):xt($)?(s=oe,le($)):(n.consume($),oe)}function te($){return $===null||$===34||$===39||$===60||$===61||$===96?t($):$===47||$===62||Vi($)?B($):(n.consume($),te)}function se($){return $===47||$===62||Vi($)?B($):t($)}function ee($){return $===62?(n.consume($),n.exit("htmlTextData"),n.exit("htmlText"),e):t($)}function le($){return n.exit("htmlTextData"),n.enter("lineEnding"),n.consume($),n.exit("lineEnding"),pe}function pe($){return cn($)?kn(n,we,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)($):we($)}function we($){return n.enter("htmlTextData"),s($)}}const iI={name:"labelEnd",resolveAll:hJ,resolveTo:pJ,tokenize:mJ},cJ={tokenize:gJ},fJ={tokenize:yJ},dJ={tokenize:vJ};function hJ(n){let e=-1;const t=[];for(;++e<n.length;){const r=n[e][1];if(t.push(n[e]),r.type==="labelImage"||r.type==="labelLink"||r.type==="labelEnd"){const i=r.type==="labelImage"?4:2;r.type="data",e+=i}}return n.length!==t.length&&uo(n,0,n.length,t),n}function pJ(n,e){let t=n.length,r=0,i,a,s,o;for(;t--;)if(i=n[t][1],a){if(i.type==="link"||i.type==="labelLink"&&i._inactive)break;n[t][0]==="enter"&&i.type==="labelLink"&&(i._inactive=!0)}else if(s){if(n[t][0]==="enter"&&(i.type==="labelImage"||i.type==="labelLink")&&!i._balanced&&(a=t,i.type!=="labelLink")){r=2;break}}else i.type==="labelEnd"&&(s=t);const u={type:n[a][1].type==="labelLink"?"link":"image",start:{...n[a][1].start},end:{...n[n.length-1][1].end}},c={type:"label",start:{...n[a][1].start},end:{...n[s][1].end}},d={type:"labelText",start:{...n[a+r+2][1].end},end:{...n[s-2][1].start}};return o=[["enter",u,e],["enter",c,e]],o=ja(o,n.slice(a+1,a+r+3)),o=ja(o,[["enter",d,e]]),o=ja(o,rI(e.parser.constructs.insideSpan.null,n.slice(a+r+4,s-3),e)),o=ja(o,[["exit",d,e],n[s-2],n[s-1],["exit",c,e]]),o=ja(o,n.slice(s+1)),o=ja(o,[["exit",u,e]]),uo(n,a,n.length,o),n}function mJ(n,e,t){const r=this;let i=r.events.length,a,s;for(;i--;)if((r.events[i][1].type==="labelImage"||r.events[i][1].type==="labelLink")&&!r.events[i][1]._balanced){a=r.events[i][1];break}return o;function o(m){return a?a._inactive?h(m):(s=r.parser.defined.includes(ld(r.sliceSerialize({start:a.end,end:r.now()}))),n.enter("labelEnd"),n.enter("labelMarker"),n.consume(m),n.exit("labelMarker"),n.exit("labelEnd"),u):t(m)}function u(m){return m===40?n.attempt(cJ,d,s?d:h)(m):m===91?n.attempt(fJ,d,s?c:h)(m):s?d(m):h(m)}function c(m){return n.attempt(dJ,d,h)(m)}function d(m){return e(m)}function h(m){return a._balanced=!0,t(m)}}function gJ(n,e,t){return r;function r(h){return n.enter("resource"),n.enter("resourceMarker"),n.consume(h),n.exit("resourceMarker"),i}function i(h){return Vi(h)?jp(n,a)(h):a(h)}function a(h){return h===41?d(h):d6(n,s,o,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(h)}function s(h){return Vi(h)?jp(n,u)(h):d(h)}function o(h){return t(h)}function u(h){return h===34||h===39||h===40?p6(n,c,t,"resourceTitle","resourceTitleMarker","resourceTitleString")(h):d(h)}function c(h){return Vi(h)?jp(n,d)(h):d(h)}function d(h){return h===41?(n.enter("resourceMarker"),n.consume(h),n.exit("resourceMarker"),n.exit("resource"),e):t(h)}}function yJ(n,e,t){const r=this;return i;function i(o){return h6.call(r,n,a,s,"reference","referenceMarker","referenceString")(o)}function a(o){return r.parser.defined.includes(ld(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?e(o):t(o)}function s(o){return t(o)}}function vJ(n,e,t){return r;function r(a){return n.enter("reference"),n.enter("referenceMarker"),n.consume(a),n.exit("referenceMarker"),i}function i(a){return a===93?(n.enter("referenceMarker"),n.consume(a),n.exit("referenceMarker"),n.exit("reference"),e):t(a)}}const _J={name:"labelStartImage",resolveAll:iI.resolveAll,tokenize:bJ};function bJ(n,e,t){const r=this;return i;function i(o){return n.enter("labelImage"),n.enter("labelImageMarker"),n.consume(o),n.exit("labelImageMarker"),a}function a(o){return o===91?(n.enter("labelMarker"),n.consume(o),n.exit("labelMarker"),n.exit("labelImage"),s):t(o)}function s(o){return o===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(o):e(o)}}const wJ={name:"labelStartLink",resolveAll:iI.resolveAll,tokenize:EJ};function EJ(n,e,t){const r=this;return i;function i(s){return n.enter("labelLink"),n.enter("labelMarker"),n.consume(s),n.exit("labelMarker"),n.exit("labelLink"),a}function a(s){return s===94&&"_hiddenFootnoteSupport"in r.parser.constructs?t(s):e(s)}}const WE={name:"lineEnding",tokenize:SJ};function SJ(n,e){return t;function t(r){return n.enter("lineEnding"),n.consume(r),n.exit("lineEnding"),kn(n,e,"linePrefix")}}const Ov={name:"thematicBreak",tokenize:TJ};function TJ(n,e,t){let r=0,i;return a;function a(c){return n.enter("thematicBreak"),s(c)}function s(c){return i=c,o(c)}function o(c){return c===i?(n.enter("thematicBreakSequence"),u(c)):r>=3&&(c===null||xt(c))?(n.exit("thematicBreak"),e(c)):t(c)}function u(c){return c===i?(n.consume(c),r++,u):(n.exit("thematicBreakSequence"),cn(c)?kn(n,o,"whitespace")(c):o(c))}}const ki={continuation:{tokenize:RJ},exit:PJ,name:"list",tokenize:xJ},AJ={partial:!0,tokenize:OJ},CJ={partial:!0,tokenize:IJ};function xJ(n,e,t){const r=this,i=r.events[r.events.length-1];let a=i&&i[1].type==="linePrefix"?i[2].sliceSerialize(i[1],!0).length:0,s=0;return o;function o(g){const _=r.containerState.type||(g===42||g===43||g===45?"listUnordered":"listOrdered");if(_==="listUnordered"?!r.containerState.marker||g===r.containerState.marker:ZC(g)){if(r.containerState.type||(r.containerState.type=_,n.enter(_,{_container:!0})),_==="listUnordered")return n.enter("listItemPrefix"),g===42||g===45?n.check(Ov,t,c)(g):c(g);if(!r.interrupt||g===49)return n.enter("listItemPrefix"),n.enter("listItemValue"),u(g)}return t(g)}function u(g){return ZC(g)&&++s<10?(n.consume(g),u):(!r.interrupt||s<2)&&(r.containerState.marker?g===r.containerState.marker:g===41||g===46)?(n.exit("listItemValue"),c(g)):t(g)}function c(g){return n.enter("listItemMarker"),n.consume(g),n.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||g,n.check(bb,r.interrupt?t:d,n.attempt(AJ,m,h))}function d(g){return r.containerState.initialBlankLine=!0,a++,m(g)}function h(g){return cn(g)?(n.enter("listItemPrefixWhitespace"),n.consume(g),n.exit("listItemPrefixWhitespace"),m):t(g)}function m(g){return r.containerState.size=a+r.sliceSerialize(n.exit("listItemPrefix"),!0).length,e(g)}}function RJ(n,e,t){const r=this;return r.containerState._closeFlow=void 0,n.check(bb,i,a);function i(o){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,kn(n,e,"listItemIndent",r.containerState.size+1)(o)}function a(o){return r.containerState.furtherBlankLines||!cn(o)?(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,s(o)):(r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,n.attempt(CJ,e,s)(o))}function s(o){return r.containerState._closeFlow=!0,r.interrupt=void 0,kn(n,n.attempt(ki,e,t),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(o)}}function IJ(n,e,t){const r=this;return kn(n,i,"listItemIndent",r.containerState.size+1);function i(a){const s=r.events[r.events.length-1];return s&&s[1].type==="listItemIndent"&&s[2].sliceSerialize(s[1],!0).length===r.containerState.size?e(a):t(a)}}function PJ(n){n.exit(this.containerState.type)}function OJ(n,e,t){const r=this;return kn(n,i,"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5);function i(a){const s=r.events[r.events.length-1];return!cn(a)&&s&&s[1].type==="listItemPrefixWhitespace"?e(a):t(a)}}const WD={name:"setextUnderline",resolveTo:kJ,tokenize:NJ};function kJ(n,e){let t=n.length,r,i,a;for(;t--;)if(n[t][0]==="enter"){if(n[t][1].type==="content"){r=t;break}n[t][1].type==="paragraph"&&(i=t)}else n[t][1].type==="content"&&n.splice(t,1),!a&&n[t][1].type==="definition"&&(a=t);const s={type:"setextHeading",start:{...n[r][1].start},end:{...n[n.length-1][1].end}};return n[i][1].type="setextHeadingText",a?(n.splice(i,0,["enter",s,e]),n.splice(a+1,0,["exit",n[r][1],e]),n[r][1].end={...n[a][1].end}):n[r][1]=s,n.push(["exit",s,e]),n}function NJ(n,e,t){const r=this;let i;return a;function a(c){let d=r.events.length,h;for(;d--;)if(r.events[d][1].type!=="lineEnding"&&r.events[d][1].type!=="linePrefix"&&r.events[d][1].type!=="content"){h=r.events[d][1].type==="paragraph";break}return!r.parser.lazy[r.now().line]&&(r.interrupt||h)?(n.enter("setextHeadingLine"),i=c,s(c)):t(c)}function s(c){return n.enter("setextHeadingLineSequence"),o(c)}function o(c){return c===i?(n.consume(c),o):(n.exit("setextHeadingLineSequence"),cn(c)?kn(n,u,"lineSuffix")(c):u(c))}function u(c){return c===null||xt(c)?(n.exit("setextHeadingLine"),e(c)):t(c)}}const MJ={tokenize:DJ};function DJ(n){const e=this,t=n.attempt(bb,r,n.attempt(this.parser.constructs.flowInitial,i,kn(n,n.attempt(this.parser.constructs.flow,i,n.attempt(FK,i)),"linePrefix")));return t;function r(a){if(a===null){n.consume(a);return}return n.enter("lineEndingBlank"),n.consume(a),n.exit("lineEndingBlank"),e.currentConstruct=void 0,t}function i(a){if(a===null){n.consume(a);return}return n.enter("lineEnding"),n.consume(a),n.exit("lineEnding"),e.currentConstruct=void 0,t}}const $J={resolveAll:g6()},LJ=m6("string"),UJ=m6("text");function m6(n){return{resolveAll:g6(n==="text"?jJ:void 0),tokenize:e};function e(t){const r=this,i=this.parser.constructs[n],a=t.attempt(i,s,o);return s;function s(d){return c(d)?a(d):o(d)}function o(d){if(d===null){t.consume(d);return}return t.enter("data"),t.consume(d),u}function u(d){return c(d)?(t.exit("data"),a(d)):(t.consume(d),u)}function c(d){if(d===null)return!0;const h=i[d];let m=-1;if(h)for(;++m<h.length;){const g=h[m];if(!g.previous||g.previous.call(r,r.previous))return!0}return!1}}}function g6(n){return e;function e(t,r){let i=-1,a;for(;++i<=t.length;)a===void 0?t[i]&&t[i][1].type==="data"&&(a=i,i++):(!t[i]||t[i][1].type!=="data")&&(i!==a+2&&(t[a][1].end=t[i-1][1].end,t.splice(a+2,i-a-2),i=a+2),a=void 0);return n?n(t,r):t}}function jJ(n,e){let t=0;for(;++t<=n.length;)if((t===n.length||n[t][1].type==="lineEnding")&&n[t-1][1].type==="data"){const r=n[t-1][1],i=e.sliceStream(r);let a=i.length,s=-1,o=0,u;for(;a--;){const c=i[a];if(typeof c=="string"){for(s=c.length;c.charCodeAt(s-1)===32;)o++,s--;if(s)break;s=-1}else if(c===-2)u=!0,o++;else if(c!==-1){a++;break}}if(e._contentTypeTextTrailing&&t===n.length&&(o=0),o){const c={type:t===n.length||u||o<2?"lineSuffix":"hardBreakTrailing",start:{_bufferIndex:a?s:r.start._bufferIndex+s,_index:r.start._index+a,line:r.end.line,column:r.end.column-o,offset:r.end.offset-o},end:{...r.end}};r.end={...c.start},r.start.offset===r.end.offset?Object.assign(r,c):(n.splice(t,0,["enter",c,e],["exit",c,e]),t+=2)}t++}return n}const FJ={42:ki,43:ki,45:ki,48:ki,49:ki,50:ki,51:ki,52:ki,53:ki,54:ki,55:ki,56:ki,57:ki,62:l6},BJ={91:HK},qJ={[-2]:GE,[-1]:GE,32:GE},VJ={35:ZK,42:Ov,45:[WD,Ov],60:tJ,61:WD,95:Ov,96:HD,126:HD},zJ={38:c6,92:u6},HJ={[-5]:WE,[-4]:WE,[-3]:WE,33:_J,38:c6,42:XC,60:[wK,lJ],91:wJ,92:[JK,u6],93:iI,95:XC,96:MK},GJ={null:[XC,$J]},WJ={null:[42,95]},KJ={null:[]},JJ=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:WJ,contentInitial:BJ,disable:KJ,document:FJ,flow:VJ,flowInitial:qJ,insideSpan:GJ,string:zJ,text:HJ},Symbol.toStringTag,{value:"Module"}));function YJ(n,e,t){let r={_bufferIndex:-1,_index:0,line:t&&t.line||1,column:t&&t.column||1,offset:t&&t.offset||0};const i={},a=[];let s=[],o=[];const u={attempt:U(P),check:U(N),consume:C,enter:A,exit:R,interrupt:U(N,{interrupt:!0})},c={code:null,containerState:{},defineSkip:w,events:[],now:_,parser:n,previous:null,sliceSerialize:m,sliceStream:g,write:h};let d=e.tokenize.call(c,u);return e.resolveAll&&a.push(e),c;function h(G){return s=ja(s,G),S(),s[s.length-1]!==null?[]:(k(e,0),c.events=rI(a,c.events,c),c.events)}function m(G,z){return XJ(g(G),z)}function g(G){return ZJ(s,G)}function _(){const{_bufferIndex:G,_index:z,line:oe,column:te,offset:se}=r;return{_bufferIndex:G,_index:z,line:oe,column:te,offset:se}}function w(G){i[G.line]=G.column,H()}function S(){let G;for(;r._index<s.length;){const z=s[r._index];if(typeof z=="string")for(G=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===G&&r._bufferIndex<z.length;)E(z.charCodeAt(r._bufferIndex));else E(z)}}function E(G){d=d(G)}function C(G){xt(G)?(r.line++,r.column=1,r.offset+=G===-3?2:1,H()):G!==-1&&(r.column++,r.offset++),r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===s[r._index].length&&(r._bufferIndex=-1,r._index++)),c.previous=G}function A(G,z){const oe=z||{};return oe.type=G,oe.start=_(),c.events.push(["enter",oe,c]),o.push(oe),oe}function R(G){const z=o.pop();return z.end=_(),c.events.push(["exit",z,c]),z}function P(G,z){k(G,z.from)}function N(G,z){z.restore()}function U(G,z){return oe;function oe(te,se,ee){let le,pe,we,$;return Array.isArray(te)?Te(te):"tokenize"in te?Te([te]):ve(te);function ve(I){return O;function O(J){const X=J!==null&&I[J],ue=J!==null&&I.null,V=[...Array.isArray(X)?X:X?[X]:[],...Array.isArray(ue)?ue:ue?[ue]:[]];return Te(V)(J)}}function Te(I){return le=I,pe=0,I.length===0?ee:F(I[pe])}function F(I){return O;function O(J){return $=B(),we=I,I.partial||(c.currentConstruct=I),I.name&&c.parser.constructs.disable.null.includes(I.name)?fe():I.tokenize.call(z?Object.assign(Object.create(c),z):c,u,ae,fe)(J)}}function ae(I){return G(we,$),se}function fe(I){return $.restore(),++pe<le.length?F(le[pe]):ee}}}function k(G,z){G.resolveAll&&!a.includes(G)&&a.push(G),G.resolve&&uo(c.events,z,c.events.length-z,G.resolve(c.events.slice(z),c)),G.resolveTo&&(c.events=G.resolveTo(c.events,c))}function B(){const G=_(),z=c.previous,oe=c.currentConstruct,te=c.events.length,se=Array.from(o);return{from:te,restore:ee};function ee(){r=G,c.previous=z,c.currentConstruct=oe,c.events.length=te,o=se,H()}}function H(){r.line in i&&r.column<2&&(r.column=i[r.line],r.offset+=i[r.line]-1)}}function ZJ(n,e){const t=e.start._index,r=e.start._bufferIndex,i=e.end._index,a=e.end._bufferIndex;let s;if(t===i)s=[n[t].slice(r,a)];else{if(s=n.slice(t,i),r>-1){const o=s[0];typeof o=="string"?s[0]=o.slice(r):s.shift()}a>0&&s.push(n[i].slice(0,a))}return s}function XJ(n,e){let t=-1;const r=[];let i;for(;++t<n.length;){const a=n[t];let s;if(typeof a=="string")s=a;else switch(a){case-5:{s="\r";break}case-4:{s=`
`;break}case-3:{s=`\r
`;break}case-2:{s=e?" ":"	";break}case-1:{if(!e&&i)continue;s=" ";break}default:s=String.fromCharCode(a)}i=a===-2,r.push(s)}return r.join("")}function QJ(n){const r={constructs:sK([JJ,...(n||{}).extensions||[]]),content:i(pK),defined:[],document:i(gK),flow:i(MJ),lazy:{},string:i(LJ),text:i(UJ)};return r;function i(a){return s;function s(o){return YJ(r,a,o)}}}function eY(n){for(;!f6(n););return n}const KD=/[\0\t\n\r]/g;function tY(){let n=1,e="",t=!0,r;return i;function i(a,s,o){const u=[];let c,d,h,m,g;for(a=e+(typeof a=="string"?a.toString():new TextDecoder(s||void 0).decode(a)),h=0,e="",t&&(a.charCodeAt(0)===65279&&h++,t=void 0);h<a.length;){if(KD.lastIndex=h,c=KD.exec(a),m=c&&c.index!==void 0?c.index:a.length,g=a.charCodeAt(m),!c){e=a.slice(h);break}if(g===10&&h===m&&r)u.push(-3),r=void 0;else switch(r&&(u.push(-5),r=void 0),h<m&&(u.push(a.slice(h,m)),n+=m-h),g){case 0:{u.push(65533),n++;break}case 9:{for(d=Math.ceil(n/4)*4,u.push(-2);n++<d;)u.push(-1);break}case 10:{u.push(-4),n=1;break}default:r=!0,n=1}h=m+1}return o&&(r&&u.push(-5),e&&u.push(e),u.push(null)),u}}const nY=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function rY(n){return n.replace(nY,iY)}function iY(n,e,t){if(e)return e;if(t.charCodeAt(0)===35){const i=t.charCodeAt(1),a=i===120||i===88;return o6(t.slice(a?2:1),a?16:10)}return nI(t)||n}const y6={}.hasOwnProperty;function aY(n,e,t){return typeof e!="string"&&(t=e,e=void 0),sY(t)(eY(QJ(t).document().write(tY()(n,e,!0))))}function sY(n){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:a(Pe),autolinkProtocol:B,autolinkEmail:B,atxHeading:a(tt),blockQuote:a(ue),characterEscape:B,characterReference:B,codeFenced:a(V),codeFencedFenceInfo:s,codeFencedFenceMeta:s,codeIndented:a(V,s),codeText:a(K,s),codeTextData:B,data:B,codeFlowValue:B,definition:a(_e),definitionDestinationString:s,definitionLabelString:s,definitionTitleString:s,emphasis:a(Me),hardBreakEscape:a(je),hardBreakTrailing:a(je),htmlFlow:a(We,s),htmlFlowData:B,htmlText:a(We,s),htmlTextData:B,image:a(Ot),label:s,link:a(Pe),listItem:a(At),listItemValue:m,listOrdered:a(He,h),listUnordered:a(He),paragraph:a(Ge),reference:F,referenceString:s,resourceDestinationString:s,resourceTitleString:s,setextHeading:a(tt),strong:a(ze),thematicBreak:a(Ze)},exit:{atxHeading:u(),atxHeadingSequence:P,autolink:u(),autolinkEmail:X,autolinkProtocol:J,blockQuote:u(),characterEscapeValue:H,characterReferenceMarkerHexadecimal:fe,characterReferenceMarkerNumeric:fe,characterReferenceValue:I,characterReference:O,codeFenced:u(S),codeFencedFence:w,codeFencedFenceInfo:g,codeFencedFenceMeta:_,codeFlowValue:H,codeIndented:u(E),codeText:u(se),codeTextData:H,data:H,definition:u(),definitionDestinationString:R,definitionLabelString:C,definitionTitleString:A,emphasis:u(),hardBreakEscape:u(z),hardBreakTrailing:u(z),htmlFlow:u(oe),htmlFlowData:H,htmlText:u(te),htmlTextData:H,image:u(le),label:we,labelText:pe,lineEnding:G,link:u(ee),listItem:u(),listOrdered:u(),listUnordered:u(),paragraph:u(),referenceString:ae,resourceDestinationString:$,resourceTitleString:ve,resource:Te,setextHeading:u(k),setextHeadingLineSequence:U,setextHeadingText:N,strong:u(),thematicBreak:u()}};v6(e,(n||{}).mdastExtensions||[]);const t={};return r;function r(he){let Ie={type:"root",children:[]};const Be={stack:[Ie],tokenStack:[],config:e,enter:o,exit:c,buffer:s,resume:d,data:t},nt=[];let W=-1;for(;++W<he.length;)if(he[W][1].type==="listOrdered"||he[W][1].type==="listUnordered")if(he[W][0]==="enter")nt.push(W);else{const M=nt.pop();W=i(he,M,W)}for(W=-1;++W<he.length;){const M=e[he[W][0]];y6.call(M,he[W][1].type)&&M[he[W][1].type].call(Object.assign({sliceSerialize:he[W][2].sliceSerialize},Be),he[W][1])}if(Be.tokenStack.length>0){const M=Be.tokenStack[Be.tokenStack.length-1];(M[1]||JD).call(Be,void 0,M[0])}for(Ie.position={start:Pl(he.length>0?he[0][1].start:{line:1,column:1,offset:0}),end:Pl(he.length>0?he[he.length-2][1].end:{line:1,column:1,offset:0})},W=-1;++W<e.transforms.length;)Ie=e.transforms[W](Ie)||Ie;return Ie}function i(he,Ie,Be){let nt=Ie-1,W=-1,M=!1,L,re,me,Ce;for(;++nt<=Be;){const Le=he[nt];switch(Le[1].type){case"listUnordered":case"listOrdered":case"blockQuote":{Le[0]==="enter"?W++:W--,Ce=void 0;break}case"lineEndingBlank":{Le[0]==="enter"&&(L&&!Ce&&!W&&!me&&(me=nt),Ce=void 0);break}case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:Ce=void 0}if(!W&&Le[0]==="enter"&&Le[1].type==="listItemPrefix"||W===-1&&Le[0]==="exit"&&(Le[1].type==="listUnordered"||Le[1].type==="listOrdered")){if(L){let ft=nt;for(re=void 0;ft--;){const Bt=he[ft];if(Bt[1].type==="lineEnding"||Bt[1].type==="lineEndingBlank"){if(Bt[0]==="exit")continue;re&&(he[re][1].type="lineEndingBlank",M=!0),Bt[1].type="lineEnding",re=ft}else if(!(Bt[1].type==="linePrefix"||Bt[1].type==="blockQuotePrefix"||Bt[1].type==="blockQuotePrefixWhitespace"||Bt[1].type==="blockQuoteMarker"||Bt[1].type==="listItemIndent"))break}me&&(!re||me<re)&&(L._spread=!0),L.end=Object.assign({},re?he[re][1].start:Le[1].end),he.splice(re||nt,0,["exit",L,Le[2]]),nt++,Be++}if(Le[1].type==="listItemPrefix"){const ft={type:"listItem",_spread:!1,start:Object.assign({},Le[1].start),end:void 0};L=ft,he.splice(nt,0,["enter",ft,Le[2]]),nt++,Be++,me=void 0,Ce=!0}}}return he[Ie][1]._spread=M,Be}function a(he,Ie){return Be;function Be(nt){o.call(this,he(nt),nt),Ie&&Ie.call(this,nt)}}function s(){this.stack.push({type:"fragment",children:[]})}function o(he,Ie,Be){this.stack[this.stack.length-1].children.push(he),this.stack.push(he),this.tokenStack.push([Ie,Be||void 0]),he.position={start:Pl(Ie.start),end:void 0}}function u(he){return Ie;function Ie(Be){he&&he.call(this,Be),c.call(this,Be)}}function c(he,Ie){const Be=this.stack.pop(),nt=this.tokenStack.pop();if(nt)nt[0].type!==he.type&&(Ie?Ie.call(this,he,nt[0]):(nt[1]||JD).call(this,he,nt[0]));else throw new Error("Cannot close `"+he.type+"` ("+Up({start:he.start,end:he.end})+"): it’s not open");Be.position.end=Pl(he.end)}function d(){return iK(this.stack.pop())}function h(){this.data.expectingFirstListItemValue=!0}function m(he){if(this.data.expectingFirstListItemValue){const Ie=this.stack[this.stack.length-2];Ie.start=Number.parseInt(this.sliceSerialize(he),10),this.data.expectingFirstListItemValue=void 0}}function g(){const he=this.resume(),Ie=this.stack[this.stack.length-1];Ie.lang=he}function _(){const he=this.resume(),Ie=this.stack[this.stack.length-1];Ie.meta=he}function w(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function S(){const he=this.resume(),Ie=this.stack[this.stack.length-1];Ie.value=he.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function E(){const he=this.resume(),Ie=this.stack[this.stack.length-1];Ie.value=he.replace(/(\r?\n|\r)$/g,"")}function C(he){const Ie=this.resume(),Be=this.stack[this.stack.length-1];Be.label=Ie,Be.identifier=ld(this.sliceSerialize(he)).toLowerCase()}function A(){const he=this.resume(),Ie=this.stack[this.stack.length-1];Ie.title=he}function R(){const he=this.resume(),Ie=this.stack[this.stack.length-1];Ie.url=he}function P(he){const Ie=this.stack[this.stack.length-1];if(!Ie.depth){const Be=this.sliceSerialize(he).length;Ie.depth=Be}}function N(){this.data.setextHeadingSlurpLineEnding=!0}function U(he){const Ie=this.stack[this.stack.length-1];Ie.depth=this.sliceSerialize(he).codePointAt(0)===61?1:2}function k(){this.data.setextHeadingSlurpLineEnding=void 0}function B(he){const Be=this.stack[this.stack.length-1].children;let nt=Be[Be.length-1];(!nt||nt.type!=="text")&&(nt=it(),nt.position={start:Pl(he.start),end:void 0},Be.push(nt)),this.stack.push(nt)}function H(he){const Ie=this.stack.pop();Ie.value+=this.sliceSerialize(he),Ie.position.end=Pl(he.end)}function G(he){const Ie=this.stack[this.stack.length-1];if(this.data.atHardBreak){const Be=Ie.children[Ie.children.length-1];Be.position.end=Pl(he.end),this.data.atHardBreak=void 0;return}!this.data.setextHeadingSlurpLineEnding&&e.canContainEols.includes(Ie.type)&&(B.call(this,he),H.call(this,he))}function z(){this.data.atHardBreak=!0}function oe(){const he=this.resume(),Ie=this.stack[this.stack.length-1];Ie.value=he}function te(){const he=this.resume(),Ie=this.stack[this.stack.length-1];Ie.value=he}function se(){const he=this.resume(),Ie=this.stack[this.stack.length-1];Ie.value=he}function ee(){const he=this.stack[this.stack.length-1];if(this.data.inReference){const Ie=this.data.referenceType||"shortcut";he.type+="Reference",he.referenceType=Ie,delete he.url,delete he.title}else delete he.identifier,delete he.label;this.data.referenceType=void 0}function le(){const he=this.stack[this.stack.length-1];if(this.data.inReference){const Ie=this.data.referenceType||"shortcut";he.type+="Reference",he.referenceType=Ie,delete he.url,delete he.title}else delete he.identifier,delete he.label;this.data.referenceType=void 0}function pe(he){const Ie=this.sliceSerialize(he),Be=this.stack[this.stack.length-2];Be.label=rY(Ie),Be.identifier=ld(Ie).toLowerCase()}function we(){const he=this.stack[this.stack.length-1],Ie=this.resume(),Be=this.stack[this.stack.length-1];if(this.data.inReference=!0,Be.type==="link"){const nt=he.children;Be.children=nt}else Be.alt=Ie}function $(){const he=this.resume(),Ie=this.stack[this.stack.length-1];Ie.url=he}function ve(){const he=this.resume(),Ie=this.stack[this.stack.length-1];Ie.title=he}function Te(){this.data.inReference=void 0}function F(){this.data.referenceType="collapsed"}function ae(he){const Ie=this.resume(),Be=this.stack[this.stack.length-1];Be.label=Ie,Be.identifier=ld(this.sliceSerialize(he)).toLowerCase(),this.data.referenceType="full"}function fe(he){this.data.characterReferenceType=he.type}function I(he){const Ie=this.sliceSerialize(he),Be=this.data.characterReferenceType;let nt;Be?(nt=o6(Ie,Be==="characterReferenceMarkerNumeric"?10:16),this.data.characterReferenceType=void 0):nt=nI(Ie);const W=this.stack[this.stack.length-1];W.value+=nt}function O(he){const Ie=this.stack.pop();Ie.position.end=Pl(he.end)}function J(he){H.call(this,he);const Ie=this.stack[this.stack.length-1];Ie.url=this.sliceSerialize(he)}function X(he){H.call(this,he);const Ie=this.stack[this.stack.length-1];Ie.url="mailto:"+this.sliceSerialize(he)}function ue(){return{type:"blockquote",children:[]}}function V(){return{type:"code",lang:null,meta:null,value:""}}function K(){return{type:"inlineCode",value:""}}function _e(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Me(){return{type:"emphasis",children:[]}}function tt(){return{type:"heading",depth:0,children:[]}}function je(){return{type:"break"}}function We(){return{type:"html",value:""}}function Ot(){return{type:"image",title:null,url:"",alt:null}}function Pe(){return{type:"link",title:null,url:"",children:[]}}function He(he){return{type:"list",ordered:he.type==="listOrdered",start:null,spread:he._spread,children:[]}}function At(he){return{type:"listItem",spread:he._spread,checked:null,children:[]}}function Ge(){return{type:"paragraph",children:[]}}function ze(){return{type:"strong",children:[]}}function it(){return{type:"text",value:""}}function Ze(){return{type:"thematicBreak"}}}function Pl(n){return{line:n.line,column:n.column,offset:n.offset}}function v6(n,e){let t=-1;for(;++t<e.length;){const r=e[t];Array.isArray(r)?v6(n,r):oY(n,r)}}function oY(n,e){let t;for(t in e)if(y6.call(e,t))switch(t){case"canContainEols":{const r=e[t];r&&n[t].push(...r);break}case"transforms":{const r=e[t];r&&n[t].push(...r);break}case"enter":case"exit":{const r=e[t];r&&Object.assign(n[t],r);break}}}function JD(n,e){throw n?new Error("Cannot close `"+n.type+"` ("+Up({start:n.start,end:n.end})+"): a different token (`"+e.type+"`, "+Up({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+Up({start:e.start,end:e.end})+") is still open")}function lY(n){const e=this;e.parser=t;function t(r){return aY(r,{...e.data("settings"),...n,extensions:e.data("micromarkExtensions")||[],mdastExtensions:e.data("fromMarkdownExtensions")||[]})}}function uY(n,e){const t={type:"element",tagName:"blockquote",properties:{},children:n.wrap(n.all(e),!0)};return n.patch(e,t),n.applyData(e,t)}function cY(n,e){const t={type:"element",tagName:"br",properties:{},children:[]};return n.patch(e,t),[n.applyData(e,t),{type:"text",value:`
`}]}function fY(n,e){const t=e.value?e.value+`
`:"",r={};e.lang&&(r.className=["language-"+e.lang]);let i={type:"element",tagName:"code",properties:r,children:[{type:"text",value:t}]};return e.meta&&(i.data={meta:e.meta}),n.patch(e,i),i=n.applyData(e,i),i={type:"element",tagName:"pre",properties:{},children:[i]},n.patch(e,i),i}function dY(n,e){const t={type:"element",tagName:"del",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function hY(n,e){const t={type:"element",tagName:"em",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function pY(n,e){const t=typeof n.options.clobberPrefix=="string"?n.options.clobberPrefix:"user-content-",r=String(e.identifier).toUpperCase(),i=$d(r.toLowerCase()),a=n.footnoteOrder.indexOf(r);let s,o=n.footnoteCounts.get(r);o===void 0?(o=0,n.footnoteOrder.push(r),s=n.footnoteOrder.length):s=a+1,o+=1,n.footnoteCounts.set(r,o);const u={type:"element",tagName:"a",properties:{href:"#"+t+"fn-"+i,id:t+"fnref-"+i+(o>1?"-"+o:""),dataFootnoteRef:!0,ariaDescribedBy:["footnote-label"]},children:[{type:"text",value:String(s)}]};n.patch(e,u);const c={type:"element",tagName:"sup",properties:{},children:[u]};return n.patch(e,c),n.applyData(e,c)}function mY(n,e){const t={type:"element",tagName:"h"+e.depth,properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function gY(n,e){if(n.options.allowDangerousHtml){const t={type:"raw",value:e.value};return n.patch(e,t),n.applyData(e,t)}}function _6(n,e){const t=e.referenceType;let r="]";if(t==="collapsed"?r+="[]":t==="full"&&(r+="["+(e.label||e.identifier)+"]"),e.type==="imageReference")return[{type:"text",value:"!["+e.alt+r}];const i=n.all(e),a=i[0];a&&a.type==="text"?a.value="["+a.value:i.unshift({type:"text",value:"["});const s=i[i.length-1];return s&&s.type==="text"?s.value+=r:i.push({type:"text",value:r}),i}function yY(n,e){const t=String(e.identifier).toUpperCase(),r=n.definitionById.get(t);if(!r)return _6(n,e);const i={src:$d(r.url||""),alt:e.alt};r.title!==null&&r.title!==void 0&&(i.title=r.title);const a={type:"element",tagName:"img",properties:i,children:[]};return n.patch(e,a),n.applyData(e,a)}function vY(n,e){const t={src:$d(e.url)};e.alt!==null&&e.alt!==void 0&&(t.alt=e.alt),e.title!==null&&e.title!==void 0&&(t.title=e.title);const r={type:"element",tagName:"img",properties:t,children:[]};return n.patch(e,r),n.applyData(e,r)}function _Y(n,e){const t={type:"text",value:e.value.replace(/\r?\n|\r/g," ")};n.patch(e,t);const r={type:"element",tagName:"code",properties:{},children:[t]};return n.patch(e,r),n.applyData(e,r)}function bY(n,e){const t=String(e.identifier).toUpperCase(),r=n.definitionById.get(t);if(!r)return _6(n,e);const i={href:$d(r.url||"")};r.title!==null&&r.title!==void 0&&(i.title=r.title);const a={type:"element",tagName:"a",properties:i,children:n.all(e)};return n.patch(e,a),n.applyData(e,a)}function wY(n,e){const t={href:$d(e.url)};e.title!==null&&e.title!==void 0&&(t.title=e.title);const r={type:"element",tagName:"a",properties:t,children:n.all(e)};return n.patch(e,r),n.applyData(e,r)}function EY(n,e,t){const r=n.all(e),i=t?SY(t):b6(e),a={},s=[];if(typeof e.checked=="boolean"){const d=r[0];let h;d&&d.type==="element"&&d.tagName==="p"?h=d:(h={type:"element",tagName:"p",properties:{},children:[]},r.unshift(h)),h.children.length>0&&h.children.unshift({type:"text",value:" "}),h.children.unshift({type:"element",tagName:"input",properties:{type:"checkbox",checked:e.checked,disabled:!0},children:[]}),a.className=["task-list-item"]}let o=-1;for(;++o<r.length;){const d=r[o];(i||o!==0||d.type!=="element"||d.tagName!=="p")&&s.push({type:"text",value:`
`}),d.type==="element"&&d.tagName==="p"&&!i?s.push(...d.children):s.push(d)}const u=r[r.length-1];u&&(i||u.type!=="element"||u.tagName!=="p")&&s.push({type:"text",value:`
`});const c={type:"element",tagName:"li",properties:a,children:s};return n.patch(e,c),n.applyData(e,c)}function SY(n){let e=!1;if(n.type==="list"){e=n.spread||!1;const t=n.children;let r=-1;for(;!e&&++r<t.length;)e=b6(t[r])}return e}function b6(n){const e=n.spread;return e??n.children.length>1}function TY(n,e){const t={},r=n.all(e);let i=-1;for(typeof e.start=="number"&&e.start!==1&&(t.start=e.start);++i<r.length;){const s=r[i];if(s.type==="element"&&s.tagName==="li"&&s.properties&&Array.isArray(s.properties.className)&&s.properties.className.includes("task-list-item")){t.className=["contains-task-list"];break}}const a={type:"element",tagName:e.ordered?"ol":"ul",properties:t,children:n.wrap(r,!0)};return n.patch(e,a),n.applyData(e,a)}function AY(n,e){const t={type:"element",tagName:"p",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function CY(n,e){const t={type:"root",children:n.wrap(n.all(e))};return n.patch(e,t),n.applyData(e,t)}function xY(n,e){const t={type:"element",tagName:"strong",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}function RY(n,e){const t=n.all(e),r=t.shift(),i=[];if(r){const s={type:"element",tagName:"thead",properties:{},children:n.wrap([r],!0)};n.patch(e.children[0],s),i.push(s)}if(t.length>0){const s={type:"element",tagName:"tbody",properties:{},children:n.wrap(t,!0)},o=XR(e.children[1]),u=e6(e.children[e.children.length-1]);o&&u&&(s.position={start:o,end:u}),i.push(s)}const a={type:"element",tagName:"table",properties:{},children:n.wrap(i,!0)};return n.patch(e,a),n.applyData(e,a)}function IY(n,e,t){const r=t?t.children:void 0,a=(r?r.indexOf(e):1)===0?"th":"td",s=t&&t.type==="table"?t.align:void 0,o=s?s.length:e.children.length;let u=-1;const c=[];for(;++u<o;){const h=e.children[u],m={},g=s?s[u]:void 0;g&&(m.align=g);let _={type:"element",tagName:a,properties:m,children:[]};h&&(_.children=n.all(h),n.patch(h,_),_=n.applyData(h,_)),c.push(_)}const d={type:"element",tagName:"tr",properties:{},children:n.wrap(c,!0)};return n.patch(e,d),n.applyData(e,d)}function PY(n,e){const t={type:"element",tagName:"td",properties:{},children:n.all(e)};return n.patch(e,t),n.applyData(e,t)}const YD=9,ZD=32;function OY(n){const e=String(n),t=/\r?\n|\r/g;let r=t.exec(e),i=0;const a=[];for(;r;)a.push(XD(e.slice(i,r.index),i>0,!0),r[0]),i=r.index+r[0].length,r=t.exec(e);return a.push(XD(e.slice(i),i>0,!1)),a.join("")}function XD(n,e,t){let r=0,i=n.length;if(e){let a=n.codePointAt(r);for(;a===YD||a===ZD;)r++,a=n.codePointAt(r)}if(t){let a=n.codePointAt(i-1);for(;a===YD||a===ZD;)i--,a=n.codePointAt(i-1)}return i>r?n.slice(r,i):""}function kY(n,e){const t={type:"text",value:OY(String(e.value))};return n.patch(e,t),n.applyData(e,t)}function NY(n,e){const t={type:"element",tagName:"hr",properties:{},children:[]};return n.patch(e,t),n.applyData(e,t)}const MY={blockquote:uY,break:cY,code:fY,delete:dY,emphasis:hY,footnoteReference:pY,heading:mY,html:gY,imageReference:yY,image:vY,inlineCode:_Y,linkReference:bY,link:wY,listItem:EY,list:TY,paragraph:AY,root:CY,strong:xY,table:RY,tableCell:PY,tableRow:IY,text:kY,thematicBreak:NY,toml:Iy,yaml:Iy,definition:Iy,footnoteDefinition:Iy};function Iy(){}const w6=-1,wb=0,Fp=1,d_=2,aI=3,sI=4,oI=5,lI=6,E6=7,S6=8,QD=typeof self=="object"?self:globalThis,DY=(n,e)=>{const t=(i,a)=>(n.set(a,i),i),r=i=>{if(n.has(i))return n.get(i);const[a,s]=e[i];switch(a){case wb:case w6:return t(s,i);case Fp:{const o=t([],i);for(const u of s)o.push(r(u));return o}case d_:{const o=t({},i);for(const[u,c]of s)o[r(u)]=r(c);return o}case aI:return t(new Date(s),i);case sI:{const{source:o,flags:u}=s;return t(new RegExp(o,u),i)}case oI:{const o=t(new Map,i);for(const[u,c]of s)o.set(r(u),r(c));return o}case lI:{const o=t(new Set,i);for(const u of s)o.add(r(u));return o}case E6:{const{name:o,message:u}=s;return t(new QD[o](u),i)}case S6:return t(BigInt(s),i);case"BigInt":return t(Object(BigInt(s)),i);case"ArrayBuffer":return t(new Uint8Array(s).buffer,s);case"DataView":{const{buffer:o}=new Uint8Array(s);return t(new DataView(o),s)}}return t(new QD[a](s),i)};return r},e$=n=>DY(new Map,n)(0),bf="",{toString:$Y}={},{keys:LY}=Object,Xh=n=>{const e=typeof n;if(e!=="object"||!n)return[wb,e];const t=$Y.call(n).slice(8,-1);switch(t){case"Array":return[Fp,bf];case"Object":return[d_,bf];case"Date":return[aI,bf];case"RegExp":return[sI,bf];case"Map":return[oI,bf];case"Set":return[lI,bf];case"DataView":return[Fp,t]}return t.includes("Array")?[Fp,t]:t.includes("Error")?[E6,t]:[d_,t]},Py=([n,e])=>n===wb&&(e==="function"||e==="symbol"),UY=(n,e,t,r)=>{const i=(s,o)=>{const u=r.push(s)-1;return t.set(o,u),u},a=s=>{if(t.has(s))return t.get(s);let[o,u]=Xh(s);switch(o){case wb:{let d=s;switch(u){case"bigint":o=S6,d=s.toString();break;case"function":case"symbol":if(n)throw new TypeError("unable to serialize "+u);d=null;break;case"undefined":return i([w6],s)}return i([o,d],s)}case Fp:{if(u){let m=s;return u==="DataView"?m=new Uint8Array(s.buffer):u==="ArrayBuffer"&&(m=new Uint8Array(s)),i([u,[...m]],s)}const d=[],h=i([o,d],s);for(const m of s)d.push(a(m));return h}case d_:{if(u)switch(u){case"BigInt":return i([u,s.toString()],s);case"Boolean":case"Number":case"String":return i([u,s.valueOf()],s)}if(e&&"toJSON"in s)return a(s.toJSON());const d=[],h=i([o,d],s);for(const m of LY(s))(n||!Py(Xh(s[m])))&&d.push([a(m),a(s[m])]);return h}case aI:return i([o,s.toISOString()],s);case sI:{const{source:d,flags:h}=s;return i([o,{source:d,flags:h}],s)}case oI:{const d=[],h=i([o,d],s);for(const[m,g]of s)(n||!(Py(Xh(m))||Py(Xh(g))))&&d.push([a(m),a(g)]);return h}case lI:{const d=[],h=i([o,d],s);for(const m of s)(n||!Py(Xh(m)))&&d.push(a(m));return h}}const{message:c}=s;return i([o,{name:u,message:c}],s)};return a},t$=(n,{json:e,lossy:t}={})=>{const r=[];return UY(!(e||t),!!e,new Map,r)(n),r},h_=typeof structuredClone=="function"?(n,e)=>e&&("json"in e||"lossy"in e)?e$(t$(n,e)):structuredClone(n):(n,e)=>e$(t$(n,e));function jY(n,e){const t=[{type:"text",value:"↩"}];return e>1&&t.push({type:"element",tagName:"sup",properties:{},children:[{type:"text",value:String(e)}]}),t}function FY(n,e){return"Back to reference "+(n+1)+(e>1?"-"+e:"")}function BY(n){const e=typeof n.options.clobberPrefix=="string"?n.options.clobberPrefix:"user-content-",t=n.options.footnoteBackContent||jY,r=n.options.footnoteBackLabel||FY,i=n.options.footnoteLabel||"Footnotes",a=n.options.footnoteLabelTagName||"h2",s=n.options.footnoteLabelProperties||{className:["sr-only"]},o=[];let u=-1;for(;++u<n.footnoteOrder.length;){const c=n.footnoteById.get(n.footnoteOrder[u]);if(!c)continue;const d=n.all(c),h=String(c.identifier).toUpperCase(),m=$d(h.toLowerCase());let g=0;const _=[],w=n.footnoteCounts.get(h);for(;w!==void 0&&++g<=w;){_.length>0&&_.push({type:"text",value:" "});let C=typeof t=="string"?t:t(u,g);typeof C=="string"&&(C={type:"text",value:C}),_.push({type:"element",tagName:"a",properties:{href:"#"+e+"fnref-"+m+(g>1?"-"+g:""),dataFootnoteBackref:"",ariaLabel:typeof r=="string"?r:r(u,g),className:["data-footnote-backref"]},children:Array.isArray(C)?C:[C]})}const S=d[d.length-1];if(S&&S.type==="element"&&S.tagName==="p"){const C=S.children[S.children.length-1];C&&C.type==="text"?C.value+=" ":S.children.push({type:"text",value:" "}),S.children.push(..._)}else d.push(..._);const E={type:"element",tagName:"li",properties:{id:e+"fn-"+m},children:n.wrap(d,!0)};n.patch(c,E),o.push(E)}if(o.length!==0)return{type:"element",tagName:"section",properties:{dataFootnotes:!0,className:["footnotes"]},children:[{type:"element",tagName:a,properties:{...h_(s),id:"footnote-label"},children:[{type:"text",value:i}]},{type:"text",value:`
`},{type:"element",tagName:"ol",properties:{},children:n.wrap(o,!0)},{type:"text",value:`
`}]}}const T6=function(n){if(n==null)return HY;if(typeof n=="function")return Eb(n);if(typeof n=="object")return Array.isArray(n)?qY(n):VY(n);if(typeof n=="string")return zY(n);throw new Error("Expected function, string, or object as test")};function qY(n){const e=[];let t=-1;for(;++t<n.length;)e[t]=T6(n[t]);return Eb(r);function r(...i){let a=-1;for(;++a<e.length;)if(e[a].apply(this,i))return!0;return!1}}function VY(n){const e=n;return Eb(t);function t(r){const i=r;let a;for(a in n)if(i[a]!==e[a])return!1;return!0}}function zY(n){return Eb(e);function e(t){return t&&t.type===n}}function Eb(n){return e;function e(t,r,i){return!!(GY(t)&&n.call(this,t,typeof r=="number"?r:void 0,i||void 0))}}function HY(){return!0}function GY(n){return n!==null&&typeof n=="object"&&"type"in n}const A6=[],WY=!0,n$=!1,KY="skip";function JY(n,e,t,r){let i;typeof e=="function"&&typeof t!="function"?(r=t,t=e):i=e;const a=T6(i),s=r?-1:1;o(n,void 0,[])();function o(u,c,d){const h=u&&typeof u=="object"?u:{};if(typeof h.type=="string"){const g=typeof h.tagName=="string"?h.tagName:typeof h.name=="string"?h.name:void 0;Object.defineProperty(m,"name",{value:"node ("+(u.type+(g?"<"+g+">":""))+")"})}return m;function m(){let g=A6,_,w,S;if((!e||a(u,c,d[d.length-1]||void 0))&&(g=YY(t(u,d)),g[0]===n$))return g;if("children"in u&&u.children){const E=u;if(E.children&&g[0]!==KY)for(w=(r?E.children.length:-1)+s,S=d.concat(E);w>-1&&w<E.children.length;){const C=E.children[w];if(_=o(C,w,S)(),_[0]===n$)return _;w=typeof _[1]=="number"?_[1]:w+s}}return g}}}function YY(n){return Array.isArray(n)?n:typeof n=="number"?[WY,n]:n==null?A6:[n]}function C6(n,e,t,r){let i,a,s;typeof e=="function"&&typeof t!="function"?(a=void 0,s=e,i=t):(a=e,s=t,i=r),JY(n,a,o,i);function o(u,c){const d=c[c.length-1],h=d?d.children.indexOf(u):void 0;return s(u,h,d)}}const QC={}.hasOwnProperty,ZY={};function XY(n,e){const t=e||ZY,r=new Map,i=new Map,a=new Map,s={...MY,...t.handlers},o={all:c,applyData:eZ,definitionById:r,footnoteById:i,footnoteCounts:a,footnoteOrder:[],handlers:s,one:u,options:t,patch:QY,wrap:nZ};return C6(n,function(d){if(d.type==="definition"||d.type==="footnoteDefinition"){const h=d.type==="definition"?r:i,m=String(d.identifier).toUpperCase();h.has(m)||h.set(m,d)}}),o;function u(d,h){const m=d.type,g=o.handlers[m];if(QC.call(o.handlers,m)&&g)return g(o,d,h);if(o.options.passThrough&&o.options.passThrough.includes(m)){if("children"in d){const{children:w,...S}=d,E=h_(S);return E.children=o.all(d),E}return h_(d)}return(o.options.unknownHandler||tZ)(o,d,h)}function c(d){const h=[];if("children"in d){const m=d.children;let g=-1;for(;++g<m.length;){const _=o.one(m[g],d);if(_){if(g&&m[g-1].type==="break"&&(!Array.isArray(_)&&_.type==="text"&&(_.value=r$(_.value)),!Array.isArray(_)&&_.type==="element")){const w=_.children[0];w&&w.type==="text"&&(w.value=r$(w.value))}Array.isArray(_)?h.push(..._):h.push(_)}}}return h}}function QY(n,e){n.position&&(e.position=$W(n))}function eZ(n,e){let t=e;if(n&&n.data){const r=n.data.hName,i=n.data.hChildren,a=n.data.hProperties;if(typeof r=="string")if(t.type==="element")t.tagName=r;else{const s="children"in t?t.children:[t];t={type:"element",tagName:r,properties:{},children:s}}t.type==="element"&&a&&Object.assign(t.properties,h_(a)),"children"in t&&t.children&&i!==null&&i!==void 0&&(t.children=i)}return t}function tZ(n,e){const t=e.data||{},r="value"in e&&!(QC.call(t,"hProperties")||QC.call(t,"hChildren"))?{type:"text",value:e.value}:{type:"element",tagName:"div",properties:{},children:n.all(e)};return n.patch(e,r),n.applyData(e,r)}function nZ(n,e){const t=[];let r=-1;for(e&&t.push({type:"text",value:`
`});++r<n.length;)r&&t.push({type:"text",value:`
`}),t.push(n[r]);return e&&n.length>0&&t.push({type:"text",value:`
`}),t}function r$(n){let e=0,t=n.charCodeAt(e);for(;t===9||t===32;)e++,t=n.charCodeAt(e);return n.slice(e)}function i$(n,e){const t=XY(n,e),r=t.one(n,void 0),i=BY(t),a=Array.isArray(r)?{type:"root",children:r}:r||{type:"root",children:[]};return i&&a.children.push({type:"text",value:`
`},i),a}function rZ(n,e){return n&&"run"in n?async function(t,r){const i=i$(t,{file:r,...e});await n.run(i,r)}:function(t,r){return i$(t,{file:r,...n||e})}}function a$(n){if(n)throw n}var KE,s$;function iZ(){if(s$)return KE;s$=1;var n=Object.prototype.hasOwnProperty,e=Object.prototype.toString,t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,i=function(c){return typeof Array.isArray=="function"?Array.isArray(c):e.call(c)==="[object Array]"},a=function(c){if(!c||e.call(c)!=="[object Object]")return!1;var d=n.call(c,"constructor"),h=c.constructor&&c.constructor.prototype&&n.call(c.constructor.prototype,"isPrototypeOf");if(c.constructor&&!d&&!h)return!1;var m;for(m in c);return typeof m>"u"||n.call(c,m)},s=function(c,d){t&&d.name==="__proto__"?t(c,d.name,{enumerable:!0,configurable:!0,value:d.newValue,writable:!0}):c[d.name]=d.newValue},o=function(c,d){if(d==="__proto__")if(n.call(c,d)){if(r)return r(c,d).value}else return;return c[d]};return KE=function u(){var c,d,h,m,g,_,w=arguments[0],S=1,E=arguments.length,C=!1;for(typeof w=="boolean"&&(C=w,w=arguments[1]||{},S=2),(w==null||typeof w!="object"&&typeof w!="function")&&(w={});S<E;++S)if(c=arguments[S],c!=null)for(d in c)h=o(w,d),m=o(c,d),w!==m&&(C&&m&&(a(m)||(g=i(m)))?(g?(g=!1,_=h&&i(h)?h:[]):_=h&&a(h)?h:{},s(w,{name:d,newValue:u(C,_,m)})):typeof m<"u"&&s(w,{name:d,newValue:m}));return w},KE}var aZ=iZ();const JE=Za(aZ);function ex(n){if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)}function sZ(){const n=[],e={run:t,use:r};return e;function t(...i){let a=-1;const s=i.pop();if(typeof s!="function")throw new TypeError("Expected function as last argument, not "+s);o(null,...i);function o(u,...c){const d=n[++a];let h=-1;if(u){s(u);return}for(;++h<i.length;)(c[h]===null||c[h]===void 0)&&(c[h]=i[h]);i=c,d?oZ(d,o)(...c):s(null,...c)}}function r(i){if(typeof i!="function")throw new TypeError("Expected `middelware` to be a function, not "+i);return n.push(i),e}}function oZ(n,e){let t;return r;function r(...s){const o=n.length>s.length;let u;o&&s.push(i);try{u=n.apply(this,s)}catch(c){const d=c;if(o&&t)throw d;return i(d)}o||(u&&u.then&&typeof u.then=="function"?u.then(a,i):u instanceof Error?i(u):a(u))}function i(s,...o){t||(t=!0,e(s,...o))}function a(s){i(null,s)}}const qs={basename:lZ,dirname:uZ,extname:cZ,join:fZ,sep:"/"};function lZ(n,e){if(e!==void 0&&typeof e!="string")throw new TypeError('"ext" argument must be a string');Um(n);let t=0,r=-1,i=n.length,a;if(e===void 0||e.length===0||e.length>n.length){for(;i--;)if(n.codePointAt(i)===47){if(a){t=i+1;break}}else r<0&&(a=!0,r=i+1);return r<0?"":n.slice(t,r)}if(e===n)return"";let s=-1,o=e.length-1;for(;i--;)if(n.codePointAt(i)===47){if(a){t=i+1;break}}else s<0&&(a=!0,s=i+1),o>-1&&(n.codePointAt(i)===e.codePointAt(o--)?o<0&&(r=i):(o=-1,r=s));return t===r?r=s:r<0&&(r=n.length),n.slice(t,r)}function uZ(n){if(Um(n),n.length===0)return".";let e=-1,t=n.length,r;for(;--t;)if(n.codePointAt(t)===47){if(r){e=t;break}}else r||(r=!0);return e<0?n.codePointAt(0)===47?"/":".":e===1&&n.codePointAt(0)===47?"//":n.slice(0,e)}function cZ(n){Um(n);let e=n.length,t=-1,r=0,i=-1,a=0,s;for(;e--;){const o=n.codePointAt(e);if(o===47){if(s){r=e+1;break}continue}t<0&&(s=!0,t=e+1),o===46?i<0?i=e:a!==1&&(a=1):i>-1&&(a=-1)}return i<0||t<0||a===0||a===1&&i===t-1&&i===r+1?"":n.slice(i,t)}function fZ(...n){let e=-1,t;for(;++e<n.length;)Um(n[e]),n[e]&&(t=t===void 0?n[e]:t+"/"+n[e]);return t===void 0?".":dZ(t)}function dZ(n){Um(n);const e=n.codePointAt(0)===47;let t=hZ(n,!e);return t.length===0&&!e&&(t="."),t.length>0&&n.codePointAt(n.length-1)===47&&(t+="/"),e?"/"+t:t}function hZ(n,e){let t="",r=0,i=-1,a=0,s=-1,o,u;for(;++s<=n.length;){if(s<n.length)o=n.codePointAt(s);else{if(o===47)break;o=47}if(o===47){if(!(i===s-1||a===1))if(i!==s-1&&a===2){if(t.length<2||r!==2||t.codePointAt(t.length-1)!==46||t.codePointAt(t.length-2)!==46){if(t.length>2){if(u=t.lastIndexOf("/"),u!==t.length-1){u<0?(t="",r=0):(t=t.slice(0,u),r=t.length-1-t.lastIndexOf("/")),i=s,a=0;continue}}else if(t.length>0){t="",r=0,i=s,a=0;continue}}e&&(t=t.length>0?t+"/..":"..",r=2)}else t.length>0?t+="/"+n.slice(i+1,s):t=n.slice(i+1,s),r=s-i-1;i=s,a=0}else o===46&&a>-1?a++:a=-1}return t}function Um(n){if(typeof n!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(n))}const pZ={cwd:mZ};function mZ(){return"/"}function tx(n){return!!(n!==null&&typeof n=="object"&&"href"in n&&n.href&&"protocol"in n&&n.protocol&&n.auth===void 0)}function gZ(n){if(typeof n=="string")n=new URL(n);else if(!tx(n)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+n+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if(n.protocol!=="file:"){const e=new TypeError("The URL must be of scheme file");throw e.code="ERR_INVALID_URL_SCHEME",e}return yZ(n)}function yZ(n){if(n.hostname!==""){const r=new TypeError('File URL host must be "localhost" or empty on darwin');throw r.code="ERR_INVALID_FILE_URL_HOST",r}const e=n.pathname;let t=-1;for(;++t<e.length;)if(e.codePointAt(t)===37&&e.codePointAt(t+1)===50){const r=e.codePointAt(t+2);if(r===70||r===102){const i=new TypeError("File URL path must not include encoded / characters");throw i.code="ERR_INVALID_FILE_URL_PATH",i}}return decodeURIComponent(e)}const YE=["history","path","basename","stem","extname","dirname"];class x6{constructor(e){let t;e?tx(e)?t={path:e}:typeof e=="string"||vZ(e)?t={value:e}:t=e:t={},this.cwd="cwd"in t?"":pZ.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let r=-1;for(;++r<YE.length;){const a=YE[r];a in t&&t[a]!==void 0&&t[a]!==null&&(this[a]=a==="history"?[...t[a]]:t[a])}let i;for(i in t)YE.includes(i)||(this[i]=t[i])}get basename(){return typeof this.path=="string"?qs.basename(this.path):void 0}set basename(e){XE(e,"basename"),ZE(e,"basename"),this.path=qs.join(this.dirname||"",e)}get dirname(){return typeof this.path=="string"?qs.dirname(this.path):void 0}set dirname(e){o$(this.basename,"dirname"),this.path=qs.join(e||"",this.basename)}get extname(){return typeof this.path=="string"?qs.extname(this.path):void 0}set extname(e){if(ZE(e,"extname"),o$(this.dirname,"extname"),e){if(e.codePointAt(0)!==46)throw new Error("`extname` must start with `.`");if(e.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=qs.join(this.dirname,this.stem+(e||""))}get path(){return this.history[this.history.length-1]}set path(e){tx(e)&&(e=gZ(e)),XE(e,"path"),this.path!==e&&this.history.push(e)}get stem(){return typeof this.path=="string"?qs.basename(this.path,this.extname):void 0}set stem(e){XE(e,"stem"),ZE(e,"stem"),this.path=qs.join(this.dirname||"",e+(this.extname||""))}fail(e,t,r){const i=this.message(e,t,r);throw i.fatal=!0,i}info(e,t,r){const i=this.message(e,t,r);return i.fatal=void 0,i}message(e,t,r){const i=new ci(e,t,r);return this.path&&(i.name=this.path+":"+i.name,i.file=this.path),i.fatal=!1,this.messages.push(i),i}toString(e){return this.value===void 0?"":typeof this.value=="string"?this.value:new TextDecoder(e||void 0).decode(this.value)}}function ZE(n,e){if(n&&n.includes(qs.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+qs.sep+"`")}function XE(n,e){if(!n)throw new Error("`"+e+"` cannot be empty")}function o$(n,e){if(!n)throw new Error("Setting `"+e+"` requires `path` to be set too")}function vZ(n){return!!(n&&typeof n=="object"&&"byteLength"in n&&"byteOffset"in n)}const _Z=function(n){const r=this.constructor.prototype,i=r[n],a=function(){return i.apply(a,arguments)};return Object.setPrototypeOf(a,r),a},bZ={}.hasOwnProperty;class uI extends _Z{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=sZ()}copy(){const e=new uI;let t=-1;for(;++t<this.attachers.length;){const r=this.attachers[t];e.use(...r)}return e.data(JE(!0,{},this.namespace)),e}data(e,t){return typeof e=="string"?arguments.length===2?(tS("data",this.frozen),this.namespace[e]=t,this):bZ.call(this.namespace,e)&&this.namespace[e]||void 0:e?(tS("data",this.frozen),this.namespace=e,this):this.namespace}freeze(){if(this.frozen)return this;const e=this;for(;++this.freezeIndex<this.attachers.length;){const[t,...r]=this.attachers[this.freezeIndex];if(r[0]===!1)continue;r[0]===!0&&(r[0]=void 0);const i=t.call(e,...r);typeof i=="function"&&this.transformers.use(i)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(e){this.freeze();const t=Oy(e),r=this.parser||this.Parser;return QE("parse",r),r(String(t),t)}process(e,t){const r=this;return this.freeze(),QE("process",this.parser||this.Parser),eS("process",this.compiler||this.Compiler),t?i(void 0,t):new Promise(i);function i(a,s){const o=Oy(e),u=r.parse(o);r.run(u,o,function(d,h,m){if(d||!h||!m)return c(d);const g=h,_=r.stringify(g,m);SZ(_)?m.value=_:m.result=_,c(d,m)});function c(d,h){d||!h?s(d):a?a(h):t(void 0,h)}}}processSync(e){let t=!1,r;return this.freeze(),QE("processSync",this.parser||this.Parser),eS("processSync",this.compiler||this.Compiler),this.process(e,i),u$("processSync","process",t),r;function i(a,s){t=!0,a$(a),r=s}}run(e,t,r){l$(e),this.freeze();const i=this.transformers;return!r&&typeof t=="function"&&(r=t,t=void 0),r?a(void 0,r):new Promise(a);function a(s,o){const u=Oy(t);i.run(e,u,c);function c(d,h,m){const g=h||e;d?o(d):s?s(g):r(void 0,g,m)}}}runSync(e,t){let r=!1,i;return this.run(e,t,a),u$("runSync","run",r),i;function a(s,o){a$(s),i=o,r=!0}}stringify(e,t){this.freeze();const r=Oy(t),i=this.compiler||this.Compiler;return eS("stringify",i),l$(e),i(e,r)}use(e,...t){const r=this.attachers,i=this.namespace;if(tS("use",this.frozen),e!=null)if(typeof e=="function")u(e,t);else if(typeof e=="object")Array.isArray(e)?o(e):s(e);else throw new TypeError("Expected usable value, not `"+e+"`");return this;function a(c){if(typeof c=="function")u(c,[]);else if(typeof c=="object")if(Array.isArray(c)){const[d,...h]=c;u(d,h)}else s(c);else throw new TypeError("Expected usable value, not `"+c+"`")}function s(c){if(!("plugins"in c)&&!("settings"in c))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");o(c.plugins),c.settings&&(i.settings=JE(!0,i.settings,c.settings))}function o(c){let d=-1;if(c!=null)if(Array.isArray(c))for(;++d<c.length;){const h=c[d];a(h)}else throw new TypeError("Expected a list of plugins, not `"+c+"`")}function u(c,d){let h=-1,m=-1;for(;++h<r.length;)if(r[h][0]===c){m=h;break}if(m===-1)r.push([c,...d]);else if(d.length>0){let[g,..._]=d;const w=r[m][1];ex(w)&&ex(g)&&(g=JE(!0,w,g)),r[m]=[c,g,..._]}}}}const wZ=new uI().freeze();function QE(n,e){if(typeof e!="function")throw new TypeError("Cannot `"+n+"` without `parser`")}function eS(n,e){if(typeof e!="function")throw new TypeError("Cannot `"+n+"` without `compiler`")}function tS(n,e){if(e)throw new Error("Cannot call `"+n+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function l$(n){if(!ex(n)||typeof n.type!="string")throw new TypeError("Expected node, got `"+n+"`")}function u$(n,e,t){if(!t)throw new Error("`"+n+"` finished async. Use `"+e+"` instead")}function Oy(n){return EZ(n)?n:new x6(n)}function EZ(n){return!!(n&&typeof n=="object"&&"message"in n&&"messages"in n)}function SZ(n){return typeof n=="string"||TZ(n)}function TZ(n){return!!(n&&typeof n=="object"&&"byteLength"in n&&"byteOffset"in n)}const AZ="https://github.com/remarkjs/react-markdown/blob/main/changelog.md",c$=[],f$={allowDangerousHtml:!0},CZ=/^(https?|ircs?|mailto|xmpp)$/i,xZ=[{from:"astPlugins",id:"remove-buggy-html-in-markdown-parser"},{from:"allowDangerousHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"allowNode",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowElement"},{from:"allowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"allowedElements"},{from:"className",id:"remove-classname"},{from:"disallowedTypes",id:"replace-allownode-allowedtypes-and-disallowedtypes",to:"disallowedElements"},{from:"escapeHtml",id:"remove-buggy-html-in-markdown-parser"},{from:"includeElementIndex",id:"#remove-includeelementindex"},{from:"includeNodeIndex",id:"change-includenodeindex-to-includeelementindex"},{from:"linkTarget",id:"remove-linktarget"},{from:"plugins",id:"change-plugins-to-remarkplugins",to:"remarkPlugins"},{from:"rawSourcePos",id:"#remove-rawsourcepos"},{from:"renderers",id:"change-renderers-to-components",to:"components"},{from:"source",id:"change-source-to-children",to:"children"},{from:"sourcePos",id:"#remove-sourcepos"},{from:"transformImageUri",id:"#add-urltransform",to:"urlTransform"},{from:"transformLinkUri",id:"#add-urltransform",to:"urlTransform"}];function RZ(n){const e=IZ(n),t=PZ(n);return OZ(e.runSync(e.parse(t),t),n)}function IZ(n){const e=n.rehypePlugins||c$,t=n.remarkPlugins||c$,r=n.remarkRehypeOptions?{...n.remarkRehypeOptions,...f$}:f$;return wZ().use(lY).use(t).use(rZ,r).use(e)}function PZ(n){const e=n.children||"",t=new x6;return typeof e=="string"&&(t.value=e),t}function OZ(n,e){const t=e.allowedElements,r=e.allowElement,i=e.components,a=e.disallowedElements,s=e.skipHtml,o=e.unwrapDisallowed,u=e.urlTransform||kZ;for(const d of xZ)Object.hasOwn(e,d.from)&&(""+d.from+(d.to?"use `"+d.to+"` instead":"remove it")+AZ+d.id,void 0);return C6(n,c),BW(n,{Fragment:Ae.Fragment,components:i,ignoreInvalidStyle:!0,jsx:Ae.jsx,jsxs:Ae.jsxs,passKeys:!0,passNode:!0});function c(d,h,m){if(d.type==="raw"&&m&&typeof h=="number")return s?m.children.splice(h,1):m.children[h]={type:"text",value:d.value},h;if(d.type==="element"){let g;for(g in HE)if(Object.hasOwn(HE,g)&&Object.hasOwn(d.properties,g)){const _=d.properties[g],w=HE[g];(w===null||w.includes(d.tagName))&&(d.properties[g]=u(String(_||""),g,d))}}if(d.type==="element"){let g=t?!t.includes(d.tagName):a?a.includes(d.tagName):!1;if(!g&&r&&typeof h=="number"&&(g=!r(d,h,m)),g&&m&&typeof h=="number")return o&&d.children?m.children.splice(h,1,...d.children):m.children.splice(h,1),h}}}function kZ(n){const e=n.indexOf(":"),t=n.indexOf("?"),r=n.indexOf("#"),i=n.indexOf("/");return e===-1||i!==-1&&e>i||t!==-1&&e>t||r!==-1&&e>r||CZ.test(n.slice(0,e))?n:""}function nx(n,e=Sb){n=n.trim();const t=n.indexOf("```");if(t===-1)return e(n);let r=n.substring(t+3);r.startsWith(`json
`)?r=r.substring(5):r.startsWith("json")?r=r.substring(4):r.startsWith(`
`)&&(r=r.substring(1));const i=r.indexOf("```");let a=r;return i!==-1&&(a=r.substring(0,i)),e(a.trim())}function Sb(n){if(typeof n>"u")return null;try{return JSON.parse(n)}catch{}let e="";const t=[];let r=!1,i=!1;for(let a of n){if(r)a==='"'&&!i?r=!1:a===`
`&&!i?a="\\n":a==="\\"?i=!i:i=!1;else if(a==='"')r=!0,i=!1;else if(a==="{")t.push("}");else if(a==="[")t.push("]");else if(a==="}"||a==="]")if(t&&t[t.length-1]===a)t.pop();else return null;e+=a}r&&(e+='"');for(let a=t.length-1;a>=0;a-=1)e+=t[a];try{return JSON.parse(e)}catch{return null}}var nS,d$;function NZ(){return d$||(d$=1,nS=function(n,e){if(typeof n!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,n.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}),nS}var MZ=NZ();const DZ=Za(MZ);var ky={exports:{}},h$;function $Z(){if(h$)return ky.exports;h$=1;const n=/[\p{Lu}]/u,e=/[\p{Ll}]/u,t=/^[\p{Lu}](?![\p{Lu}])/gu,r=/([\p{Alpha}\p{N}_]|$)/u,i=/[_.\- ]+/,a=new RegExp("^"+i.source),s=new RegExp(i.source+r.source,"gu"),o=new RegExp("\\d+"+r.source,"gu"),u=(m,g,_)=>{let w=!1,S=!1,E=!1;for(let C=0;C<m.length;C++){const A=m[C];w&&n.test(A)?(m=m.slice(0,C)+"-"+m.slice(C),w=!1,E=S,S=!0,C++):S&&E&&e.test(A)?(m=m.slice(0,C-1)+"-"+m.slice(C-1),E=S,S=!1,w=!0):(w=g(A)===A&&_(A)!==A,E=S,S=_(A)===A&&g(A)!==A)}return m},c=(m,g)=>(t.lastIndex=0,m.replace(t,_=>g(_))),d=(m,g)=>(s.lastIndex=0,o.lastIndex=0,m.replace(s,(_,w)=>g(w)).replace(o,_=>g(_))),h=(m,g)=>{if(!(typeof m=="string"||Array.isArray(m)))throw new TypeError("Expected the input to be `string | string[]`");if(g={pascalCase:!1,preserveConsecutiveUppercase:!1,...g},Array.isArray(m)?m=m.map(E=>E.trim()).filter(E=>E.length).join("-"):m=m.trim(),m.length===0)return"";const _=g.locale===!1?E=>E.toLowerCase():E=>E.toLocaleLowerCase(g.locale),w=g.locale===!1?E=>E.toUpperCase():E=>E.toLocaleUpperCase(g.locale);return m.length===1?g.pascalCase?w(m):_(m):(m!==_(m)&&(m=u(m,_,w)),m=m.replace(a,""),g.preserveConsecutiveUppercase?m=c(m,_):m=_(m),g.pascalCase&&(m=w(m.charAt(0))+m.slice(1)),d(m,w))};return ky.exports=h,ky.exports.default=h,ky.exports}var LZ=$Z();const UZ=Za(LZ);function jZ(n,e){return(e==null?void 0:e[n])||DZ(n)}function FZ(n,e){return(e==null?void 0:e[n])||UZ(n)}function R6(n,e,t){const r={};for(const i in n)Object.hasOwn(n,i)&&(r[e(i,t)]=n[i]);return r}function p$(n){return Array.isArray(n)?[...n]:{...n}}function BZ(n,e){const t=p$(n);for(const[r,i]of Object.entries(e)){const[a,...s]=r.split(".").reverse();let o=t;for(const u of s.reverse()){if(o[u]===void 0)break;o[u]=p$(o[u]),o=o[u]}o[a]!==void 0&&(o[a]={lc:1,type:"secret",id:[i]})}return t}function Tb(n){const e=Object.getPrototypeOf(n);return typeof n.lc_name=="function"&&(typeof e.lc_name!="function"||n.lc_name()!==e.lc_name())?n.lc_name():n.name}class wa{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Tb(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([r])=>{var i;return(i=this.lc_serializable_keys)==null?void 0:i.includes(r)})):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof wa||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce((i,a)=>(i[a]=a in this?this[a]:this.lc_kwargs[a],i),{});for(let i=Object.getPrototypeOf(this);i;i=Object.getPrototypeOf(i))Object.assign(e,Reflect.get(i,"lc_aliases",this)),Object.assign(t,Reflect.get(i,"lc_secrets",this)),Object.assign(r,Reflect.get(i,"lc_attributes",this));return Object.keys(t).forEach(i=>{let a=this,s=r;const[o,...u]=i.split(".").reverse();for(const c of u.reverse()){if(!(c in a)||a[c]===void 0)return;(!(c in s)||s[c]===void 0)&&(typeof a[c]=="object"&&a[c]!=null?s[c]={}:Array.isArray(a[c])&&(s[c]=[])),a=a[c],s=s[c]}o in a&&a[o]!==void 0&&(s[o]=s[o]||a[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:R6(Object.keys(t).length?BZ(r,t):r,jZ,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}const qZ=Object.freeze(Object.defineProperty({__proto__:null,Serializable:wa,get_lc_unique_name:Tb},Symbol.toStringTag,{value:"Module"}));function Ja(n){return typeof n=="object"&&n!==null&&"type"in n&&typeof n.type=="string"&&"source_type"in n&&(n.source_type==="url"||n.source_type==="base64"||n.source_type==="text"||n.source_type==="id")}function I6(n){return Ja(n)&&n.source_type==="url"&&"url"in n&&typeof n.url=="string"}function P6(n){return Ja(n)&&n.source_type==="base64"&&"data"in n&&typeof n.data=="string"}function VZ(n){return Ja(n)&&n.source_type==="text"&&"text"in n&&typeof n.text=="string"}function zZ(n){return Ja(n)&&n.source_type==="id"&&"id"in n&&typeof n.id=="string"}function O6(n){if(Ja(n)){if(n.source_type==="url")return{type:"image_url",image_url:{url:n.url}};if(n.source_type==="base64"){if(!n.mime_type)throw new Error("mime_type key is required for base64 data.");return{type:"image_url",image_url:{url:`data:${n.mime_type};base64,${n.data}`}}}}throw new Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function rx(n){const e=n.split(";")[0].split("/");if(e.length!==2)throw new Error(`Invalid mime type: "${n}" - does not match type/subtype format.`);const t=e[0].trim(),r=e[1].trim();if(t===""||r==="")throw new Error(`Invalid mime type: "${n}" - type or subtype is empty.`);const i={};for(const a of n.split(";").slice(1)){const s=a.split("=");if(s.length!==2)throw new Error(`Invalid parameter syntax in mime type: "${n}".`);const o=s[0].trim(),u=s[1].trim();if(o==="")throw new Error(`Invalid parameter syntax in mime type: "${n}".`);i[o]=u}return{type:t,subtype:r,parameters:i}}function Kl({dataUrl:n,asTypedArray:e=!1}){const t=n.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/);let r;if(t){r=t[1].toLowerCase();const i=e?Uint8Array.from(atob(t[2]),a=>a.charCodeAt(0)):t[2];return{mime_type:r,data:i}}}function jm(n,e){if(n.type==="text"){if(!e.fromStandardTextBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardTextBlock\` method.`);return e.fromStandardTextBlock(n)}if(n.type==="image"){if(!e.fromStandardImageBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardImageBlock\` method.`);return e.fromStandardImageBlock(n)}if(n.type==="audio"){if(!e.fromStandardAudioBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardAudioBlock\` method.`);return e.fromStandardAudioBlock(n)}if(n.type==="file"){if(!e.fromStandardFileBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardFileBlock\` method.`);return e.fromStandardFileBlock(n)}throw new Error(`Unable to convert content block type '${n.type}' to provider-specific format: not recognized.`)}function Sc(n,e){return typeof n=="string"?n===""?e:typeof e=="string"?n+e:Array.isArray(e)&&e.some(t=>Ja(t))?[{type:"text",source_type:"text",text:n},...e]:[{type:"text",text:n},...e]:Array.isArray(e)?Fm(n,e)??[...n,...e]:e===""?n:Array.isArray(n)&&n.some(t=>Ja(t))?[...n,{type:"file",source_type:"text",text:e}]:[...n,{type:"text",text:e}]}function k6(n,e){return n==="error"||e==="error"?"error":"success"}function HZ(n,e){function t(r,i){if(typeof r!="object"||r===null||r===void 0)return r;if(i>=e)return Array.isArray(r)?"[Array]":"[Object]";if(Array.isArray(r))return r.map(s=>t(s,i+1));const a={};for(const s of Object.keys(r))a[s]=t(r[s],i+1);return a}return JSON.stringify(t(n,0),null,2)}class Ha extends wa{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const t=HZ(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}}function GZ(n){return Array.isArray(n)&&n.every(e=>typeof e.index=="number")}function si(n,e){const t={...n};for(const[r,i]of Object.entries(e))if(t[r]==null)t[r]=i;else{if(i==null)continue;if(typeof t[r]!=typeof i||Array.isArray(t[r])!==Array.isArray(i))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof t[r]=="string"){if(r==="type")continue;t[r]+=i}else if(typeof t[r]=="object"&&!Array.isArray(t[r]))t[r]=si(t[r],i);else if(Array.isArray(t[r]))t[r]=Fm(t[r],i);else{if(t[r]===i)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return t}function Fm(n,e){if(!(n===void 0&&e===void 0)){if(n===void 0||e===void 0)return n||e;{const t=[...n];for(const r of e)if(typeof r=="object"&&"index"in r&&typeof r.index=="number"){const i=t.findIndex(a=>a.index===r.index);i!==-1?t[i]=si(t[i],r):t.push(r)}else{if(typeof r=="object"&&"text"in r&&r.text==="")continue;t.push(r)}return t}}}function N6(n,e){if(!n&&!e)throw new Error("Cannot merge two undefined objects.");if(!n||!e)return n||e;if(typeof n!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof n}
Right ${typeof e}`);if(typeof n=="string"&&typeof e=="string")return n+e;if(Array.isArray(n)&&Array.isArray(e))return Fm(n,e);if(typeof n=="object"&&typeof e=="object")return si(n,e);if(n===e)return n;throw new Error(`Can not merge objects of different types.
Left ${n}
Right ${e}`)}class Tc extends Ha{}function M6(n){return typeof n.role=="string"}function Vn(n){return typeof(n==null?void 0:n._getType)=="function"}function wd(n){return Vn(n)&&typeof n.concat=="function"}function WZ(n){return n!=null&&typeof n=="object"&&"lc_direct_tool_output"in n&&n.lc_direct_tool_output===!0}class Yo extends Ha{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,r){typeof e=="string"&&(e={content:e,name:r,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class Ld extends Tc{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new Ld({content:Sc(this.content,e.content),additional_kwargs:si(this.additional_kwargs,e.additional_kwargs),response_metadata:si(this.response_metadata,e.response_metadata),artifact:N6(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:k6(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function KZ(n){const e=[],t=[];for(const r of n)if(r.function){const i=r.function.name;try{const a=JSON.parse(r.function.arguments),s={name:i||"",args:a||{},id:r.id};e.push(s)}catch{t.push({name:i,args:r.function.arguments,id:r.id,error:"Malformed args."})}}else continue;return[e,t]}function um(n){return n._getType()==="tool"}function JZ(n){return n._getType()==="tool"}class Tn extends Ha{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){var i;let r;if(typeof e=="string")r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{r=e;const a=(i=r.additional_kwargs)==null?void 0:i.tool_calls,s=r.tool_calls;a!=null&&a.length>0&&(s===void 0||s.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(a!=null&&s===void 0){const[o,u]=KZ(a);r.tool_calls=o??[],r.invalid_tool_calls=u??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function Ea(n){return n._getType()==="ai"}function p_(n){return n._getType()==="ai"}class xn extends Tc{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{const r=[],i=[];for(const a of e.tool_call_chunks){let s={};try{if(s=Sb(a.args||"{}"),s===null||typeof s!="object"||Array.isArray(s))throw new Error("Malformed tool call chunk args.");r.push({name:a.name??"",args:s,id:a.id,type:"tool_call"})}catch{i.push({name:a.name,args:a.args,id:a.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:r,invalid_tool_calls:i,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){var r,i,a,s,o,u,c,d,h,m,g,_,w,S,E,C,A,R,P,N,U,k,B,H,G,z,oe,te,se,ee,le,pe,we,$,ve,Te,F,ae,fe,I;const t={content:Sc(this.content,e.content),additional_kwargs:si(this.additional_kwargs,e.additional_kwargs),response_metadata:si(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const O=Fm(this.tool_call_chunks,e.tool_call_chunks);O!==void 0&&O.length>0&&(t.tool_call_chunks=O)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){const O={...(((i=(r=this.usage_metadata)==null?void 0:r.input_token_details)==null?void 0:i.audio)!==void 0||((s=(a=e.usage_metadata)==null?void 0:a.input_token_details)==null?void 0:s.audio)!==void 0)&&{audio:(((u=(o=this.usage_metadata)==null?void 0:o.input_token_details)==null?void 0:u.audio)??0)+(((d=(c=e.usage_metadata)==null?void 0:c.input_token_details)==null?void 0:d.audio)??0)},...(((m=(h=this.usage_metadata)==null?void 0:h.input_token_details)==null?void 0:m.cache_read)!==void 0||((_=(g=e.usage_metadata)==null?void 0:g.input_token_details)==null?void 0:_.cache_read)!==void 0)&&{cache_read:(((S=(w=this.usage_metadata)==null?void 0:w.input_token_details)==null?void 0:S.cache_read)??0)+(((C=(E=e.usage_metadata)==null?void 0:E.input_token_details)==null?void 0:C.cache_read)??0)},...(((R=(A=this.usage_metadata)==null?void 0:A.input_token_details)==null?void 0:R.cache_creation)!==void 0||((N=(P=e.usage_metadata)==null?void 0:P.input_token_details)==null?void 0:N.cache_creation)!==void 0)&&{cache_creation:(((k=(U=this.usage_metadata)==null?void 0:U.input_token_details)==null?void 0:k.cache_creation)??0)+(((H=(B=e.usage_metadata)==null?void 0:B.input_token_details)==null?void 0:H.cache_creation)??0)}},J={...(((z=(G=this.usage_metadata)==null?void 0:G.output_token_details)==null?void 0:z.audio)!==void 0||((te=(oe=e.usage_metadata)==null?void 0:oe.output_token_details)==null?void 0:te.audio)!==void 0)&&{audio:(((ee=(se=this.usage_metadata)==null?void 0:se.output_token_details)==null?void 0:ee.audio)??0)+(((pe=(le=e.usage_metadata)==null?void 0:le.output_token_details)==null?void 0:pe.audio)??0)},...((($=(we=this.usage_metadata)==null?void 0:we.output_token_details)==null?void 0:$.reasoning)!==void 0||((Te=(ve=e.usage_metadata)==null?void 0:ve.output_token_details)==null?void 0:Te.reasoning)!==void 0)&&{reasoning:(((ae=(F=this.usage_metadata)==null?void 0:F.output_token_details)==null?void 0:ae.reasoning)??0)+(((I=(fe=e.usage_metadata)==null?void 0:fe.output_token_details)==null?void 0:I.reasoning)??0)}},X=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},ue=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},V={input_tokens:X.input_tokens+ue.input_tokens,output_tokens:X.output_tokens+ue.output_tokens,total_tokens:X.total_tokens+ue.total_tokens,...Object.keys(O).length>0&&{input_token_details:O},...Object.keys(J).length>0&&{output_token_details:J}};t.usage_metadata=V}return new xn(t)}}class Xa extends Ha{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return Xa}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}}class Ac extends Tc{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new Ac({content:Sc(this.content,e.content),additional_kwargs:si(this.additional_kwargs,e.additional_kwargs),response_metadata:si(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}function YZ(n){return n._getType()==="generic"}function ZZ(n){return n._getType()==="generic"}class Ab extends Ha{static lc_name(){return"FunctionMessage"}constructor(e,t){typeof e=="string"&&(e={content:e,name:t}),super(e)}_getType(){return"function"}}class Cc extends Tc{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new Cc({content:Sc(this.content,e.content),additional_kwargs:si(this.additional_kwargs,e.additional_kwargs),response_metadata:si(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}function XZ(n){return n._getType()==="function"}function QZ(n){return n._getType()==="function"}class oi extends Ha{static lc_name(){return"HumanMessage"}_getType(){return"human"}constructor(e,t){super(e,t)}}class xc extends Tc{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}constructor(e,t){super(e,t)}concat(e){return new xc({content:Sc(this.content,e.content),additional_kwargs:si(this.additional_kwargs,e.additional_kwargs),response_metadata:si(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function eX(n){return n.getType()==="human"}function tX(n){return n.getType()==="human"}class Cs extends Ha{static lc_name(){return"SystemMessage"}_getType(){return"system"}constructor(e,t){super(e,t)}}class co extends Tc{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}constructor(e,t){super(e,t)}concat(e){return new co({content:Sc(this.content,e.content),additional_kwargs:si(this.additional_kwargs,e.additional_kwargs),response_metadata:si(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function nX(n){return n._getType()==="system"}function rX(n){return n._getType()==="system"}function Cb(n,e){return n.lc_error_code=e,n.message=`${n.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,n}function Bp(n){return!!(n&&typeof n=="object"&&"type"in n&&n.type==="tool_call")}function iX(n){return!!(n&&typeof n=="object"&&"toolCall"in n&&n.toolCall!=null&&typeof n.toolCall=="object"&&"id"in n.toolCall&&typeof n.toolCall.id=="string")}class m_ extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}function aX(n){return Bp(n)?n:typeof n.id=="string"&&n.type==="function"&&typeof n.function=="object"&&n.function!==null&&"arguments"in n.function&&typeof n.function.arguments=="string"&&"name"in n.function&&typeof n.function.name=="string"?{id:n.id,args:JSON.parse(n.function.arguments),name:n.function.name,type:"tool_call"}:n}function sX(n){return typeof n=="object"&&n!=null&&n.lc===1&&Array.isArray(n.id)&&n.kwargs!=null&&typeof n.kwargs=="object"}function rS(n){let e,t;if(sX(n)){const r=n.id.at(-1);r==="HumanMessage"||r==="HumanMessageChunk"?e="user":r==="AIMessage"||r==="AIMessageChunk"?e="assistant":r==="SystemMessage"||r==="SystemMessageChunk"?e="system":r==="FunctionMessage"||r==="FunctionMessageChunk"?e="function":r==="ToolMessage"||r==="ToolMessageChunk"?e="tool":e="unknown",t=n.kwargs}else{const{type:r,...i}=n;e=r,t=i}if(e==="human"||e==="user")return new oi(t);if(e==="ai"||e==="assistant"){const{tool_calls:r,...i}=t;if(!Array.isArray(r))return new Tn(t);const a=r.map(aX);return new Tn({...i,tool_calls:a})}else{if(e==="system")return new Cs(t);if(e==="developer")return new Cs({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in t)return new Yo({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});throw Cb(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(n,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function _s(n){if(typeof n=="string")return new oi(n);if(Vn(n))return n;if(Array.isArray(n)){const[e,t]=n;return rS({type:e,content:t})}else if(M6(n)){const{role:e,...t}=n;return rS({...t,type:e})}else return rS(n)}function Bm(n,e="Human",t="AI"){const r=[];for(const i of n){let a;if(i._getType()==="human")a=e;else if(i._getType()==="ai")a=t;else if(i._getType()==="system")a="System";else if(i._getType()==="function")a="Function";else if(i._getType()==="tool")a="Tool";else if(i._getType()==="generic")a=i.role;else throw new Error(`Got unsupported message type: ${i._getType()}`);const s=i.name?`${i.name}, `:"",o=typeof i.content=="string"?i.content:JSON.stringify(i.content,null,2);r.push(`${a}: ${s}${o}`)}return r.join(`
`)}function oX(n){if(n.data!==void 0)return n;{const e=n;return{type:e.type,data:{content:e.text,role:e.role,name:void 0,tool_call_id:void 0}}}}function cI(n){const e=oX(n);switch(e.type){case"human":return new oi(e.data);case"ai":return new Tn(e.data);case"system":return new Cs(e.data);case"function":if(e.data.name===void 0)throw new Error("Name must be defined for function messages");return new Ab(e.data);case"tool":if(e.data.tool_call_id===void 0)throw new Error("Tool call ID must be defined for tool messages");return new Yo(e.data);case"generic":{if(e.data.role===void 0)throw new Error("Role must be defined for chat messages");return new Xa(e.data)}default:throw new Error(`Got unexpected type: ${e.type}`)}}function lX(n){return n.map(cI)}function uX(n){return n.map(e=>e.toDict())}function g_(n){var t;const e=n._getType();if(e==="human")return new xc({...n});if(e==="ai"){let r={...n};return"tool_calls"in r&&(r={...r,tool_call_chunks:(t=r.tool_calls)==null?void 0:t.map(i=>({...i,type:"tool_call_chunk",index:void 0,args:JSON.stringify(i.args)}))}),new xn({...r})}else{if(e==="system")return new co({...n});if(e==="function")return new Cc({...n});if(Xa.isInstance(n))return new Ac({...n});throw new Error("Unknown message type.")}}var tn;(function(n){n.assertEqual=i=>{};function e(i){}n.assertIs=e;function t(i){throw new Error}n.assertNever=t,n.arrayToEnum=i=>{const a={};for(const s of i)a[s]=s;return a},n.getValidEnumValues=i=>{const a=n.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),s={};for(const o of a)s[o]=i[o];return n.objectValues(s)},n.objectValues=i=>n.objectKeys(i).map(function(a){return i[a]}),n.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const a=[];for(const s in i)Object.prototype.hasOwnProperty.call(i,s)&&a.push(s);return a},n.find=(i,a)=>{for(const s of i)if(a(s))return s},n.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&Number.isFinite(i)&&Math.floor(i)===i;function r(i,a=" | "){return i.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}n.joinValues=r,n.jsonStringifyReplacer=(i,a)=>typeof a=="bigint"?a.toString():a})(tn||(tn={}));var m$;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(m$||(m$={}));const lt=tn.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),jl=n=>{switch(typeof n){case"undefined":return lt.undefined;case"string":return lt.string;case"number":return Number.isNaN(n)?lt.nan:lt.number;case"boolean":return lt.boolean;case"function":return lt.function;case"bigint":return lt.bigint;case"symbol":return lt.symbol;case"object":return Array.isArray(n)?lt.array:n===null?lt.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?lt.promise:typeof Map<"u"&&n instanceof Map?lt.map:typeof Set<"u"&&n instanceof Set?lt.set:typeof Date<"u"&&n instanceof Date?lt.date:lt.object;default:return lt.unknown}},Qe=tn.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Zo extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(a){return a.message},r={_errors:[]},i=a=>{for(const s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(i);else if(s.code==="invalid_return_type")i(s.returnTypeError);else if(s.code==="invalid_arguments")i(s.argumentsError);else if(s.path.length===0)r._errors.push(t(s));else{let o=r,u=0;for(;u<s.path.length;){const c=s.path[u];u===s.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(s))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return i(this),r}static assert(e){if(!(e instanceof Zo))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,tn.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const i of this.issues)i.path.length>0?(t[i.path[0]]=t[i.path[0]]||[],t[i.path[0]].push(e(i))):r.push(e(i));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}Zo.create=n=>new Zo(n);const ix=(n,e)=>{let t;switch(n.code){case Qe.invalid_type:n.received===lt.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case Qe.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,tn.jsonStringifyReplacer)}`;break;case Qe.unrecognized_keys:t=`Unrecognized key(s) in object: ${tn.joinValues(n.keys,", ")}`;break;case Qe.invalid_union:t="Invalid input";break;case Qe.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${tn.joinValues(n.options)}`;break;case Qe.invalid_enum_value:t=`Invalid enum value. Expected ${tn.joinValues(n.options)}, received '${n.received}'`;break;case Qe.invalid_arguments:t="Invalid function arguments";break;case Qe.invalid_return_type:t="Invalid function return type";break;case Qe.invalid_date:t="Invalid date";break;case Qe.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:tn.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case Qe.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case Qe.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case Qe.custom:t="Invalid input";break;case Qe.invalid_intersection_types:t="Intersection results could not be merged";break;case Qe.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case Qe.not_finite:t="Number must be finite";break;default:t=e.defaultError,tn.assertNever(n)}return{message:t}};let cX=ix;function fX(){return cX}const dX=n=>{const{data:e,path:t,errorMaps:r,issueData:i}=n,a=[...t,...i.path||[]],s={...i,path:a};if(i.message!==void 0)return{...i,path:a,message:i.message};let o="";const u=r.filter(c=>!!c).slice().reverse();for(const c of u)o=c(s,{data:e,defaultError:o}).message;return{...i,path:a,message:o}};function st(n,e){const t=fX(),r=dX({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===ix?void 0:ix].filter(i=>!!i)});n.common.issues.push(r)}class Ei{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const i of t){if(i.status==="aborted")return Rt;i.status==="dirty"&&e.dirty(),r.push(i.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const i of t){const a=await i.key,s=await i.value;r.push({key:a,value:s})}return Ei.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const i of t){const{key:a,value:s}=i;if(a.status==="aborted"||s.status==="aborted")return Rt;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||i.alwaysSet)&&(r[a.value]=s.value)}return{status:e.value,value:r}}}const Rt=Object.freeze({status:"aborted"}),_p=n=>({status:"dirty",value:n}),Qa=n=>({status:"valid",value:n}),g$=n=>n.status==="aborted",y$=n=>n.status==="dirty",Ed=n=>n.status==="valid",y_=n=>typeof Promise<"u"&&n instanceof Promise;var ht;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(ht||(ht={}));class fo{constructor(e,t,r,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const v$=(n,e)=>{if(Ed(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Zo(n.common.issues);return this._error=t,this._error}}};function Ft(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:i}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(s,o)=>{const{message:u}=n;return s.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:u??r??o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:u??t??o.defaultError}},description:i}}class Yt{get description(){return this._def.description}_getType(e){return jl(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:jl(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new Ei,ctx:{common:e.parent.common,data:e.data,parsedType:jl(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(y_(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){const r={common:{issues:[],async:(t==null?void 0:t.async)??!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:jl(e)},i=this._parseSync({data:e,path:r.path,parent:r});return v$(r,i)}"~validate"(e){var r,i;const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:jl(e)};if(!this["~standard"].async)try{const a=this._parseSync({data:e,path:[],parent:t});return Ed(a)?{value:a.value}:{issues:t.common.issues}}catch(a){(i=(r=a==null?void 0:a.message)==null?void 0:r.toLowerCase())!=null&&i.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(a=>Ed(a)?{value:a.value}:{issues:t.common.issues})}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:jl(e)},i=this._parse({data:e,path:r.path,parent:r}),a=await(y_(i)?i:Promise.resolve(i));return v$(r,a)}refine(e,t){const r=i=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(i):t;return this._refinement((i,a)=>{const s=e(i),o=()=>a.addIssue({code:Qe.custom,...r(i)});return typeof Promise<"u"&&s instanceof Promise?s.then(u=>u?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,i)=>e(r)?!0:(i.addIssue(typeof t=="function"?t(r,i):t),!1))}_refinement(e){return new fc({schema:this,typeName:Ue.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return oo.create(this,this._def)}nullable(){return Qo.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return so.create(this)}promise(){return A_.create(this,this._def)}or(e){return b_.create([this,e],this._def)}and(e){return w_.create(this,e,this._def)}transform(e){return new fc({...Ft(this._def),schema:this,typeName:Ue.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new fm({...Ft(this._def),innerType:this,defaultValue:t,typeName:Ue.ZodDefault})}brand(){return new U6({typeName:Ue.ZodBranded,type:this,...Ft(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new C_({...Ft(this._def),innerType:this,catchValue:t,typeName:Ue.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return dI.create(this,e)}readonly(){return x_.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const hX=/^c[^\s-]{8,}$/i,pX=/^[0-9a-z]+$/,mX=/^[0-9A-HJKMNP-TV-Z]{26}$/i,gX=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,yX=/^[a-z0-9_-]{21}$/i,vX=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,_X=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,bX=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,wX="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let iS;const EX=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,SX=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,TX=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,AX=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,CX=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,xX=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,D6="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",RX=new RegExp(`^${D6}$`);function $6(n){let e="[0-5]\\d";n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`);const t=n.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function IX(n){return new RegExp(`^${$6(n)}$`)}function PX(n){let e=`${D6}T${$6(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function OX(n,e){return!!((e==="v4"||!e)&&EX.test(n)||(e==="v6"||!e)&&TX.test(n))}function kX(n,e){if(!vX.test(n))return!1;try{const[t]=n.split("."),r=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),i=JSON.parse(atob(r));return!(typeof i!="object"||i===null||"typ"in i&&(i==null?void 0:i.typ)!=="JWT"||!i.alg||e&&i.alg!==e)}catch{return!1}}function NX(n,e){return!!((e==="v4"||!e)&&SX.test(n)||(e==="v6"||!e)&&AX.test(n))}class eo extends Yt{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==lt.string){const a=this._getOrReturnCtx(e);return st(a,{code:Qe.invalid_type,expected:lt.string,received:a.parsedType}),Rt}const r=new Ei;let i;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(i=this._getOrReturnCtx(e,i),st(i,{code:Qe.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(i=this._getOrReturnCtx(e,i),st(i,{code:Qe.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){const s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(i=this._getOrReturnCtx(e,i),s?st(i,{code:Qe.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&st(i,{code:Qe.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")bX.test(e.data)||(i=this._getOrReturnCtx(e,i),st(i,{validation:"email",code:Qe.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")iS||(iS=new RegExp(wX,"u")),iS.test(e.data)||(i=this._getOrReturnCtx(e,i),st(i,{validation:"emoji",code:Qe.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")gX.test(e.data)||(i=this._getOrReturnCtx(e,i),st(i,{validation:"uuid",code:Qe.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")yX.test(e.data)||(i=this._getOrReturnCtx(e,i),st(i,{validation:"nanoid",code:Qe.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")hX.test(e.data)||(i=this._getOrReturnCtx(e,i),st(i,{validation:"cuid",code:Qe.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")pX.test(e.data)||(i=this._getOrReturnCtx(e,i),st(i,{validation:"cuid2",code:Qe.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")mX.test(e.data)||(i=this._getOrReturnCtx(e,i),st(i,{validation:"ulid",code:Qe.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),st(i,{validation:"url",code:Qe.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),st(i,{validation:"regex",code:Qe.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(i=this._getOrReturnCtx(e,i),st(i,{code:Qe.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(i=this._getOrReturnCtx(e,i),st(i,{code:Qe.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(i=this._getOrReturnCtx(e,i),st(i,{code:Qe.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?PX(a).test(e.data)||(i=this._getOrReturnCtx(e,i),st(i,{code:Qe.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?RX.test(e.data)||(i=this._getOrReturnCtx(e,i),st(i,{code:Qe.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?IX(a).test(e.data)||(i=this._getOrReturnCtx(e,i),st(i,{code:Qe.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?_X.test(e.data)||(i=this._getOrReturnCtx(e,i),st(i,{validation:"duration",code:Qe.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?OX(e.data,a.version)||(i=this._getOrReturnCtx(e,i),st(i,{validation:"ip",code:Qe.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?kX(e.data,a.alg)||(i=this._getOrReturnCtx(e,i),st(i,{validation:"jwt",code:Qe.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?NX(e.data,a.version)||(i=this._getOrReturnCtx(e,i),st(i,{validation:"cidr",code:Qe.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?CX.test(e.data)||(i=this._getOrReturnCtx(e,i),st(i,{validation:"base64",code:Qe.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?xX.test(e.data)||(i=this._getOrReturnCtx(e,i),st(i,{validation:"base64url",code:Qe.invalid_string,message:a.message}),r.dirty()):tn.assertNever(a);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(i=>e.test(i),{validation:t,code:Qe.invalid_string,...ht.errToObj(r)})}_addCheck(e){return new eo({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...ht.errToObj(e)})}url(e){return this._addCheck({kind:"url",...ht.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...ht.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...ht.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...ht.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...ht.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...ht.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...ht.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...ht.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...ht.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...ht.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...ht.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...ht.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...ht.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...ht.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...ht.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...ht.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...ht.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...ht.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...ht.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...ht.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...ht.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...ht.errToObj(t)})}nonempty(e){return this.min(1,ht.errToObj(e))}trim(){return new eo({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new eo({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new eo({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}eo.create=n=>new eo({checks:[],typeName:Ue.ZodString,coerce:(n==null?void 0:n.coerce)??!1,...Ft(n)});function MX(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,i=t>r?t:r,a=Number.parseInt(n.toFixed(i).replace(".","")),s=Number.parseInt(e.toFixed(i).replace(".",""));return a%s/10**i}class oc extends Yt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==lt.number){const a=this._getOrReturnCtx(e);return st(a,{code:Qe.invalid_type,expected:lt.number,received:a.parsedType}),Rt}let r;const i=new Ei;for(const a of this._def.checks)a.kind==="int"?tn.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),st(r,{code:Qe.invalid_type,expected:"integer",received:"float",message:a.message}),i.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),st(r,{code:Qe.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),st(r,{code:Qe.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="multipleOf"?MX(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),st(r,{code:Qe.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),st(r,{code:Qe.not_finite,message:a.message}),i.dirty()):tn.assertNever(a);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,ht.toString(t))}gt(e,t){return this.setLimit("min",e,!1,ht.toString(t))}lte(e,t){return this.setLimit("max",e,!0,ht.toString(t))}lt(e,t){return this.setLimit("max",e,!1,ht.toString(t))}setLimit(e,t,r,i){return new oc({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:ht.toString(i)}]})}_addCheck(e){return new oc({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:ht.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ht.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ht.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ht.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ht.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:ht.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:ht.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ht.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ht.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&tn.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}oc.create=n=>new oc({checks:[],typeName:Ue.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...Ft(n)});class lc extends Yt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==lt.bigint)return this._getInvalidInput(e);let r;const i=new Ei;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),st(r,{code:Qe.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),st(r,{code:Qe.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),st(r,{code:Qe.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):tn.assertNever(a);return{status:i.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return st(t,{code:Qe.invalid_type,expected:lt.bigint,received:t.parsedType}),Rt}gte(e,t){return this.setLimit("min",e,!0,ht.toString(t))}gt(e,t){return this.setLimit("min",e,!1,ht.toString(t))}lte(e,t){return this.setLimit("max",e,!0,ht.toString(t))}lt(e,t){return this.setLimit("max",e,!1,ht.toString(t))}setLimit(e,t,r,i){return new lc({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:ht.toString(i)}]})}_addCheck(e){return new lc({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ht.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:ht.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:ht.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:ht.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:ht.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}lc.create=n=>new lc({checks:[],typeName:Ue.ZodBigInt,coerce:(n==null?void 0:n.coerce)??!1,...Ft(n)});class v_ extends Yt{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==lt.boolean){const r=this._getOrReturnCtx(e);return st(r,{code:Qe.invalid_type,expected:lt.boolean,received:r.parsedType}),Rt}return Qa(e.data)}}v_.create=n=>new v_({typeName:Ue.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...Ft(n)});class Sd extends Yt{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==lt.date){const a=this._getOrReturnCtx(e);return st(a,{code:Qe.invalid_type,expected:lt.date,received:a.parsedType}),Rt}if(Number.isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return st(a,{code:Qe.invalid_date}),Rt}const r=new Ei;let i;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(i=this._getOrReturnCtx(e,i),st(i,{code:Qe.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(i=this._getOrReturnCtx(e,i),st(i,{code:Qe.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):tn.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Sd({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:ht.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:ht.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Sd.create=n=>new Sd({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:Ue.ZodDate,...Ft(n)});class _$ extends Yt{_parse(e){if(this._getType(e)!==lt.symbol){const r=this._getOrReturnCtx(e);return st(r,{code:Qe.invalid_type,expected:lt.symbol,received:r.parsedType}),Rt}return Qa(e.data)}}_$.create=n=>new _$({typeName:Ue.ZodSymbol,...Ft(n)});class ax extends Yt{_parse(e){if(this._getType(e)!==lt.undefined){const r=this._getOrReturnCtx(e);return st(r,{code:Qe.invalid_type,expected:lt.undefined,received:r.parsedType}),Rt}return Qa(e.data)}}ax.create=n=>new ax({typeName:Ue.ZodUndefined,...Ft(n)});class __ extends Yt{_parse(e){if(this._getType(e)!==lt.null){const r=this._getOrReturnCtx(e);return st(r,{code:Qe.invalid_type,expected:lt.null,received:r.parsedType}),Rt}return Qa(e.data)}}__.create=n=>new __({typeName:Ue.ZodNull,...Ft(n)});class sx extends Yt{constructor(){super(...arguments),this._any=!0}_parse(e){return Qa(e.data)}}sx.create=n=>new sx({typeName:Ue.ZodAny,...Ft(n)});class ox extends Yt{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Qa(e.data)}}ox.create=n=>new ox({typeName:Ue.ZodUnknown,...Ft(n)});class Xo extends Yt{_parse(e){const t=this._getOrReturnCtx(e);return st(t,{code:Qe.invalid_type,expected:lt.never,received:t.parsedType}),Rt}}Xo.create=n=>new Xo({typeName:Ue.ZodNever,...Ft(n)});class b$ extends Yt{_parse(e){if(this._getType(e)!==lt.undefined){const r=this._getOrReturnCtx(e);return st(r,{code:Qe.invalid_type,expected:lt.void,received:r.parsedType}),Rt}return Qa(e.data)}}b$.create=n=>new b$({typeName:Ue.ZodVoid,...Ft(n)});class so extends Yt{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),i=this._def;if(t.parsedType!==lt.array)return st(t,{code:Qe.invalid_type,expected:lt.array,received:t.parsedType}),Rt;if(i.exactLength!==null){const s=t.data.length>i.exactLength.value,o=t.data.length<i.exactLength.value;(s||o)&&(st(t,{code:s?Qe.too_big:Qe.too_small,minimum:o?i.exactLength.value:void 0,maximum:s?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),r.dirty())}if(i.minLength!==null&&t.data.length<i.minLength.value&&(st(t,{code:Qe.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),r.dirty()),i.maxLength!==null&&t.data.length>i.maxLength.value&&(st(t,{code:Qe.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((s,o)=>i.type._parseAsync(new fo(t,s,t.path,o)))).then(s=>Ei.mergeArray(r,s));const a=[...t.data].map((s,o)=>i.type._parseSync(new fo(t,s,t.path,o)));return Ei.mergeArray(r,a)}get element(){return this._def.type}min(e,t){return new so({...this._def,minLength:{value:e,message:ht.toString(t)}})}max(e,t){return new so({...this._def,maxLength:{value:e,message:ht.toString(t)}})}length(e,t){return new so({...this._def,exactLength:{value:e,message:ht.toString(t)}})}nonempty(e){return this.min(1,e)}}so.create=(n,e)=>new so({type:n,minLength:null,maxLength:null,exactLength:null,typeName:Ue.ZodArray,...Ft(e)});function Mf(n){if(n instanceof sr){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=oo.create(Mf(r))}return new sr({...n._def,shape:()=>e})}else return n instanceof so?new so({...n._def,type:Mf(n.element)}):n instanceof oo?oo.create(Mf(n.unwrap())):n instanceof Qo?Qo.create(Mf(n.unwrap())):n instanceof uc?uc.create(n.items.map(e=>Mf(e))):n}class sr extends Yt{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=tn.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==lt.object){const c=this._getOrReturnCtx(e);return st(c,{code:Qe.invalid_type,expected:lt.object,received:c.parsedType}),Rt}const{status:r,ctx:i}=this._processInputParams(e),{shape:a,keys:s}=this._getCached(),o=[];if(!(this._def.catchall instanceof Xo&&this._def.unknownKeys==="strip"))for(const c in i.data)s.includes(c)||o.push(c);const u=[];for(const c of s){const d=a[c],h=i.data[c];u.push({key:{status:"valid",value:c},value:d._parse(new fo(i,h,i.path,c)),alwaysSet:c in i.data})}if(this._def.catchall instanceof Xo){const c=this._def.unknownKeys;if(c==="passthrough")for(const d of o)u.push({key:{status:"valid",value:d},value:{status:"valid",value:i.data[d]}});else if(c==="strict")o.length>0&&(st(i,{code:Qe.unrecognized_keys,keys:o}),r.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const d of o){const h=i.data[d];u.push({key:{status:"valid",value:d},value:c._parse(new fo(i,h,i.path,d)),alwaysSet:d in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const c=[];for(const d of u){const h=await d.key,m=await d.value;c.push({key:h,value:m,alwaysSet:d.alwaysSet})}return c}).then(c=>Ei.mergeObjectSync(r,c)):Ei.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(e){return ht.errToObj,new sr({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var a,s;const i=((s=(a=this._def).errorMap)==null?void 0:s.call(a,t,r).message)??r.defaultError;return t.code==="unrecognized_keys"?{message:ht.errToObj(e).message??i}:{message:i}}}:{}})}strip(){return new sr({...this._def,unknownKeys:"strip"})}passthrough(){return new sr({...this._def,unknownKeys:"passthrough"})}extend(e){return new sr({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new sr({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Ue.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new sr({...this._def,catchall:e})}pick(e){const t={};for(const r of tn.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new sr({...this._def,shape:()=>t})}omit(e){const t={};for(const r of tn.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new sr({...this._def,shape:()=>t})}deepPartial(){return Mf(this)}partial(e){const t={};for(const r of tn.objectKeys(this.shape)){const i=this.shape[r];e&&!e[r]?t[r]=i:t[r]=i.optional()}return new sr({...this._def,shape:()=>t})}required(e){const t={};for(const r of tn.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let a=this.shape[r];for(;a instanceof oo;)a=a._def.innerType;t[r]=a}return new sr({...this._def,shape:()=>t})}keyof(){return L6(tn.objectKeys(this.shape))}}sr.create=(n,e)=>new sr({shape:()=>n,unknownKeys:"strip",catchall:Xo.create(),typeName:Ue.ZodObject,...Ft(e)});sr.strictCreate=(n,e)=>new sr({shape:()=>n,unknownKeys:"strict",catchall:Xo.create(),typeName:Ue.ZodObject,...Ft(e)});sr.lazycreate=(n,e)=>new sr({shape:n,unknownKeys:"strip",catchall:Xo.create(),typeName:Ue.ZodObject,...Ft(e)});class b_ extends Yt{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function i(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const s=a.map(o=>new Zo(o.ctx.common.issues));return st(t,{code:Qe.invalid_union,unionErrors:s}),Rt}if(t.common.async)return Promise.all(r.map(async a=>{const s={...t,common:{...t.common,issues:[]},parent:null};return{result:await a._parseAsync({data:t.data,path:t.path,parent:s}),ctx:s}})).then(i);{let a;const s=[];for(const u of r){const c={...t,common:{...t.common,issues:[]},parent:null},d=u._parseSync({data:t.data,path:t.path,parent:c});if(d.status==="valid")return d;d.status==="dirty"&&!a&&(a={result:d,ctx:c}),c.common.issues.length&&s.push(c.common.issues)}if(a)return t.common.issues.push(...a.ctx.common.issues),a.result;const o=s.map(u=>new Zo(u));return st(t,{code:Qe.invalid_union,unionErrors:o}),Rt}}get options(){return this._def.options}}b_.create=(n,e)=>new b_({options:n,typeName:Ue.ZodUnion,...Ft(e)});const $o=n=>n instanceof S_?$o(n.schema):n instanceof fc?$o(n.innerType()):n instanceof T_?[n.value]:n instanceof cc?n.options:n instanceof ux?tn.objectValues(n.enum):n instanceof fm?$o(n._def.innerType):n instanceof ax?[void 0]:n instanceof __?[null]:n instanceof oo?[void 0,...$o(n.unwrap())]:n instanceof Qo?[null,...$o(n.unwrap())]:n instanceof U6||n instanceof x_?$o(n.unwrap()):n instanceof C_?$o(n._def.innerType):[];class fI extends Yt{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==lt.object)return st(t,{code:Qe.invalid_type,expected:lt.object,received:t.parsedType}),Rt;const r=this.discriminator,i=t.data[r],a=this.optionsMap.get(i);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):(st(t,{code:Qe.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),Rt)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const i=new Map;for(const a of t){const s=$o(a.shape[e]);if(!s.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of s){if(i.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);i.set(o,a)}}return new fI({typeName:Ue.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i,...Ft(r)})}}function lx(n,e){const t=jl(n),r=jl(e);if(n===e)return{valid:!0,data:n};if(t===lt.object&&r===lt.object){const i=tn.objectKeys(e),a=tn.objectKeys(n).filter(o=>i.indexOf(o)!==-1),s={...n,...e};for(const o of a){const u=lx(n[o],e[o]);if(!u.valid)return{valid:!1};s[o]=u.data}return{valid:!0,data:s}}else if(t===lt.array&&r===lt.array){if(n.length!==e.length)return{valid:!1};const i=[];for(let a=0;a<n.length;a++){const s=n[a],o=e[a],u=lx(s,o);if(!u.valid)return{valid:!1};i.push(u.data)}return{valid:!0,data:i}}else return t===lt.date&&r===lt.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class w_ extends Yt{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),i=(a,s)=>{if(g$(a)||g$(s))return Rt;const o=lx(a.value,s.value);return o.valid?((y$(a)||y$(s))&&t.dirty(),{status:t.value,value:o.data}):(st(r,{code:Qe.invalid_intersection_types}),Rt)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([a,s])=>i(a,s)):i(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}w_.create=(n,e,t)=>new w_({left:n,right:e,typeName:Ue.ZodIntersection,...Ft(t)});class uc extends Yt{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==lt.array)return st(r,{code:Qe.invalid_type,expected:lt.array,received:r.parsedType}),Rt;if(r.data.length<this._def.items.length)return st(r,{code:Qe.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),Rt;!this._def.rest&&r.data.length>this._def.items.length&&(st(r,{code:Qe.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...r.data].map((s,o)=>{const u=this._def.items[o]||this._def.rest;return u?u._parse(new fo(r,s,r.path,o)):null}).filter(s=>!!s);return r.common.async?Promise.all(a).then(s=>Ei.mergeArray(t,s)):Ei.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new uc({...this._def,rest:e})}}uc.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new uc({items:n,typeName:Ue.ZodTuple,rest:null,...Ft(e)})};class E_ extends Yt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==lt.object)return st(r,{code:Qe.invalid_type,expected:lt.object,received:r.parsedType}),Rt;const i=[],a=this._def.keyType,s=this._def.valueType;for(const o in r.data)i.push({key:a._parse(new fo(r,o,r.path,o)),value:s._parse(new fo(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?Ei.mergeObjectAsync(t,i):Ei.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof Yt?new E_({keyType:e,valueType:t,typeName:Ue.ZodRecord,...Ft(r)}):new E_({keyType:eo.create(),valueType:e,typeName:Ue.ZodRecord,...Ft(t)})}}class w$ extends Yt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==lt.map)return st(r,{code:Qe.invalid_type,expected:lt.map,received:r.parsedType}),Rt;const i=this._def.keyType,a=this._def.valueType,s=[...r.data.entries()].map(([o,u],c)=>({key:i._parse(new fo(r,o,r.path,[c,"key"])),value:a._parse(new fo(r,u,r.path,[c,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const u of s){const c=await u.key,d=await u.value;if(c.status==="aborted"||d.status==="aborted")return Rt;(c.status==="dirty"||d.status==="dirty")&&t.dirty(),o.set(c.value,d.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const u of s){const c=u.key,d=u.value;if(c.status==="aborted"||d.status==="aborted")return Rt;(c.status==="dirty"||d.status==="dirty")&&t.dirty(),o.set(c.value,d.value)}return{status:t.value,value:o}}}}w$.create=(n,e,t)=>new w$({valueType:e,keyType:n,typeName:Ue.ZodMap,...Ft(t)});class cm extends Yt{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==lt.set)return st(r,{code:Qe.invalid_type,expected:lt.set,received:r.parsedType}),Rt;const i=this._def;i.minSize!==null&&r.data.size<i.minSize.value&&(st(r,{code:Qe.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),t.dirty()),i.maxSize!==null&&r.data.size>i.maxSize.value&&(st(r,{code:Qe.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),t.dirty());const a=this._def.valueType;function s(u){const c=new Set;for(const d of u){if(d.status==="aborted")return Rt;d.status==="dirty"&&t.dirty(),c.add(d.value)}return{status:t.value,value:c}}const o=[...r.data.values()].map((u,c)=>a._parse(new fo(r,u,r.path,c)));return r.common.async?Promise.all(o).then(u=>s(u)):s(o)}min(e,t){return new cm({...this._def,minSize:{value:e,message:ht.toString(t)}})}max(e,t){return new cm({...this._def,maxSize:{value:e,message:ht.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}cm.create=(n,e)=>new cm({valueType:n,minSize:null,maxSize:null,typeName:Ue.ZodSet,...Ft(e)});class S_ extends Yt{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}S_.create=(n,e)=>new S_({getter:n,typeName:Ue.ZodLazy,...Ft(e)});class T_ extends Yt{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return st(t,{received:t.data,code:Qe.invalid_literal,expected:this._def.value}),Rt}return{status:"valid",value:e.data}}get value(){return this._def.value}}T_.create=(n,e)=>new T_({value:n,typeName:Ue.ZodLiteral,...Ft(e)});function L6(n,e){return new cc({values:n,typeName:Ue.ZodEnum,...Ft(e)})}class cc extends Yt{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return st(t,{expected:tn.joinValues(r),received:t.parsedType,code:Qe.invalid_type}),Rt}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return st(t,{received:t.data,code:Qe.invalid_enum_value,options:r}),Rt}return Qa(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return cc.create(e,{...this._def,...t})}exclude(e,t=this._def){return cc.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}}cc.create=L6;class ux extends Yt{_parse(e){const t=tn.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==lt.string&&r.parsedType!==lt.number){const i=tn.objectValues(t);return st(r,{expected:tn.joinValues(i),received:r.parsedType,code:Qe.invalid_type}),Rt}if(this._cache||(this._cache=new Set(tn.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const i=tn.objectValues(t);return st(r,{received:r.data,code:Qe.invalid_enum_value,options:i}),Rt}return Qa(e.data)}get enum(){return this._def.values}}ux.create=(n,e)=>new ux({values:n,typeName:Ue.ZodNativeEnum,...Ft(e)});class A_ extends Yt{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==lt.promise&&t.common.async===!1)return st(t,{code:Qe.invalid_type,expected:lt.promise,received:t.parsedType}),Rt;const r=t.parsedType===lt.promise?t.data:Promise.resolve(t.data);return Qa(r.then(i=>this._def.type.parseAsync(i,{path:t.path,errorMap:t.common.contextualErrorMap})))}}A_.create=(n,e)=>new A_({type:n,typeName:Ue.ZodPromise,...Ft(e)});class fc extends Yt{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Ue.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),i=this._def.effect||null,a={addIssue:s=>{st(r,s),s.fatal?t.abort():t.dirty()},get path(){return r.path}};if(a.addIssue=a.addIssue.bind(a),i.type==="preprocess"){const s=i.transform(r.data,a);if(r.common.async)return Promise.resolve(s).then(async o=>{if(t.value==="aborted")return Rt;const u=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return u.status==="aborted"?Rt:u.status==="dirty"||t.value==="dirty"?_p(u.value):u});{if(t.value==="aborted")return Rt;const o=this._def.schema._parseSync({data:s,path:r.path,parent:r});return o.status==="aborted"?Rt:o.status==="dirty"||t.value==="dirty"?_p(o.value):o}}if(i.type==="refinement"){const s=o=>{const u=i.refinement(o,a);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?Rt:(o.status==="dirty"&&t.dirty(),s(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?Rt:(o.status==="dirty"&&t.dirty(),s(o.value).then(()=>({status:t.value,value:o.value}))))}if(i.type==="transform")if(r.common.async===!1){const s=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Ed(s))return Rt;const o=i.transform(s.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(s=>Ed(s)?Promise.resolve(i.transform(s.value,a)).then(o=>({status:t.value,value:o})):Rt);tn.assertNever(i)}}fc.create=(n,e,t)=>new fc({schema:n,typeName:Ue.ZodEffects,effect:e,...Ft(t)});fc.createWithPreprocess=(n,e,t)=>new fc({schema:e,effect:{type:"preprocess",transform:n},typeName:Ue.ZodEffects,...Ft(t)});class oo extends Yt{_parse(e){return this._getType(e)===lt.undefined?Qa(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}oo.create=(n,e)=>new oo({innerType:n,typeName:Ue.ZodOptional,...Ft(e)});class Qo extends Yt{_parse(e){return this._getType(e)===lt.null?Qa(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}Qo.create=(n,e)=>new Qo({innerType:n,typeName:Ue.ZodNullable,...Ft(e)});class fm extends Yt{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===lt.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}fm.create=(n,e)=>new fm({innerType:n,typeName:Ue.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Ft(e)});class C_ extends Yt{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},i=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return y_(i)?i.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Zo(r.common.issues)},input:r.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Zo(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}C_.create=(n,e)=>new C_({innerType:n,typeName:Ue.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Ft(e)});class E$ extends Yt{_parse(e){if(this._getType(e)!==lt.nan){const r=this._getOrReturnCtx(e);return st(r,{code:Qe.invalid_type,expected:lt.nan,received:r.parsedType}),Rt}return{status:"valid",value:e.data}}}E$.create=n=>new E$({typeName:Ue.ZodNaN,...Ft(n)});class U6 extends Yt{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class dI extends Yt{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?Rt:a.status==="dirty"?(t.dirty(),_p(a.value)):this._def.out._parseAsync({data:a.value,path:r.path,parent:r})})();{const i=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?Rt:i.status==="dirty"?(t.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:r.path,parent:r})}}static create(e,t){return new dI({in:e,out:t,typeName:Ue.ZodPipeline})}}class x_ extends Yt{_parse(e){const t=this._def.innerType._parse(e),r=i=>(Ed(i)&&(i.value=Object.freeze(i.value)),i);return y_(t)?t.then(i=>r(i)):r(t)}unwrap(){return this._def.innerType}}x_.create=(n,e)=>new x_({innerType:n,typeName:Ue.ZodReadonly,...Ft(e)});var Ue;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(Ue||(Ue={}));const $e=eo.create,Yn=oc.create;lc.create;const Jr=v_.create;Sd.create;const j6=__.create,Va=sx.create,dc=ox.create,F6=Xo.create,kt=so.create,rt=sr.create,In=b_.create,DX=fI.create;w_.create;const $X=uc.create,gs=E_.create,LX=S_.create,Pt=T_.create,xs=cc.create;A_.create;const Ke=oo.create;Qo.create;const wf={string:n=>eo.create({...n,coerce:!0}),number:n=>oc.create({...n,coerce:!0}),boolean:n=>v_.create({...n,coerce:!0}),bigint:n=>lc.create({...n,coerce:!0}),date:n=>Sd.create({...n,coerce:!0})};var Qh={exports:{}},aS={},sS,S$;function UX(){if(S$)return sS;S$=1;function n(e,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return sS=n,n.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},n.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},n.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(r===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);else return!1;var i=this;return this._timer=setTimeout(function(){i._attempts++,i._operationTimeoutCb&&(i._timeout=setTimeout(function(){i._operationTimeoutCb(i._attempts)},i._operationTimeout),i._options.unref&&i._timeout.unref()),i._fn(i._attempts)},r),this._options.unref&&this._timer.unref(),!0},n.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},n.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},n.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},n.prototype.start=n.prototype.try,n.prototype.errors=function(){return this._errors},n.prototype.attempts=function(){return this._attempts},n.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},t=null,r=0,i=0;i<this._errors.length;i++){var a=this._errors[i],s=a.message,o=(e[s]||0)+1;e[s]=o,o>=r&&(t=a,r=o)}return t},sS}var T$;function jX(){return T$||(T$=1,function(n){var e=UX();n.operation=function(t){var r=n.timeouts(t);return new e(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},n.timeouts=function(t){if(t instanceof Array)return[].concat(t);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in t)r[i]=t[i];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var a=[],s=0;s<r.retries;s++)a.push(this.createTimeout(s,r));return t&&t.forever&&!a.length&&a.push(this.createTimeout(s,r)),a.sort(function(o,u){return o-u}),a},n.createTimeout=function(t,r){var i=r.randomize?Math.random()+1:1,a=Math.round(i*Math.max(r.minTimeout,1)*Math.pow(r.factor,t));return a=Math.min(a,r.maxTimeout),a},n.wrap=function(t,r,i){if(r instanceof Array&&(i=r,r=null),!i){i=[];for(var a in t)typeof t[a]=="function"&&i.push(a)}for(var s=0;s<i.length;s++){var o=i[s],u=t[o];t[o]=(function(d){var h=n.operation(r),m=Array.prototype.slice.call(arguments,1),g=m.pop();m.push(function(_){h.retry(_)||(_&&(arguments[0]=h.mainError()),g.apply(this,arguments))}),h.attempt(function(){d.apply(t,m)})}).bind(t,u),t[o].options=r}}}(aS)),aS}var oS,A$;function FX(){return A$||(A$=1,oS=jX()),oS}var C$;function BX(){if(C$)return Qh.exports;C$=1;const n=FX(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class t extends Error{constructor(o){super(),o instanceof Error?(this.originalError=o,{message:o}=o):(this.originalError=new Error(o),this.originalError.stack=this.stack),this.name="AbortError",this.message=o}}const r=(s,o,u)=>{const c=u.retries-(o-1);return s.attemptNumber=o,s.retriesLeft=c,s},i=s=>e.includes(s),a=(s,o)=>new Promise((u,c)=>{o={onFailedAttempt:()=>{},retries:10,...o};const d=n.operation(o);d.attempt(async h=>{try{u(await s(h))}catch(m){if(!(m instanceof Error)){c(new TypeError(`Non-error was thrown: "${m}". You should only throw errors.`));return}if(m instanceof t)d.stop(),c(m.originalError);else if(m instanceof TypeError&&!i(m.message))d.stop(),c(m);else{r(m,h,o);try{await o.onFailedAttempt(m)}catch(g){c(g);return}d.retry(m)||c(d.mainError())}}})});return Qh.exports=a,Qh.exports.default=a,Qh.exports.AbortError=t,Qh.exports}var qX=BX();const R_=Za(qX),VX=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function kv(n){return typeof n=="string"&&VX.test(n)}var qr=[];for(var lS=0;lS<256;++lS)qr.push((lS+256).toString(16).slice(1));function zX(n,e=0){return(qr[n[e+0]]+qr[n[e+1]]+qr[n[e+2]]+qr[n[e+3]]+"-"+qr[n[e+4]]+qr[n[e+5]]+"-"+qr[n[e+6]]+qr[n[e+7]]+"-"+qr[n[e+8]]+qr[n[e+9]]+"-"+qr[n[e+10]]+qr[n[e+11]]+qr[n[e+12]]+qr[n[e+13]]+qr[n[e+14]]+qr[n[e+15]]).toLowerCase()}var Ny,HX=new Uint8Array(16);function GX(){if(!Ny&&(Ny=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Ny))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Ny(HX)}var WX=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const x$={randomUUID:WX};function jo(n,e,t){if(x$.randomUUID&&!n)return x$.randomUUID();n=n||{};var r=n.random||(n.rng||GX)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,zX(r)}const KX=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function B6(n){return typeof n=="string"&&KX.test(n)}function JX(n){if(!B6(n))throw TypeError("Invalid UUID");var e,t=new Uint8Array(16);return t[0]=(e=parseInt(n.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(n.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(n.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(n.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var Vr=[];for(var uS=0;uS<256;++uS)Vr.push((uS+256).toString(16).slice(1));function q6(n,e=0){return(Vr[n[e+0]]+Vr[n[e+1]]+Vr[n[e+2]]+Vr[n[e+3]]+"-"+Vr[n[e+4]]+Vr[n[e+5]]+"-"+Vr[n[e+6]]+Vr[n[e+7]]+"-"+Vr[n[e+8]]+Vr[n[e+9]]+"-"+Vr[n[e+10]]+Vr[n[e+11]]+Vr[n[e+12]]+Vr[n[e+13]]+Vr[n[e+14]]+Vr[n[e+15]]).toLowerCase()}var My,YX=new Uint8Array(16);function ZX(){if(!My&&(My=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!My))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return My(YX)}function XX(n){n=unescape(encodeURIComponent(n));for(var e=[],t=0;t<n.length;++t)e.push(n.charCodeAt(t));return e}var QX="6ba7b810-9dad-11d1-80b4-00c04fd430c8",eQ="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function tQ(n,e,t){function r(i,a,s,o){var u;if(typeof i=="string"&&(i=XX(i)),typeof a=="string"&&(a=JX(a)),((u=a)===null||u===void 0?void 0:u.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var c=new Uint8Array(16+i.length);if(c.set(a),c.set(i,a.length),c=t(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,s){o=o||0;for(var d=0;d<16;++d)s[o+d]=c[d];return s}return q6(c)}try{r.name=n}catch{}return r.DNS=QX,r.URL=eQ,r}var nQ=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const R$={randomUUID:nQ};function Df(n,e,t){if(R$.randomUUID&&!n)return R$.randomUUID();n=n||{};var r=n.random||(n.rng||ZX)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,q6(r)}function rQ(n,e,t,r){switch(n){case 0:return e&t^~e&r;case 1:return e^t^r;case 2:return e&t^e&r^t&r;case 3:return e^t^r}}function cS(n,e){return n<<e|n>>>32-e}function iQ(n){var e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){var r=unescape(encodeURIComponent(n));n=[];for(var i=0;i<r.length;++i)n.push(r.charCodeAt(i))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);for(var a=n.length/4+2,s=Math.ceil(a/16),o=new Array(s),u=0;u<s;++u){for(var c=new Uint32Array(16),d=0;d<16;++d)c[d]=n[u*64+d*4]<<24|n[u*64+d*4+1]<<16|n[u*64+d*4+2]<<8|n[u*64+d*4+3];o[u]=c}o[s-1][14]=(n.length-1)*8/Math.pow(2,32),o[s-1][14]=Math.floor(o[s-1][14]),o[s-1][15]=(n.length-1)*8&4294967295;for(var h=0;h<s;++h){for(var m=new Uint32Array(80),g=0;g<16;++g)m[g]=o[h][g];for(var _=16;_<80;++_)m[_]=cS(m[_-3]^m[_-8]^m[_-14]^m[_-16],1);for(var w=t[0],S=t[1],E=t[2],C=t[3],A=t[4],R=0;R<80;++R){var P=Math.floor(R/20),N=cS(w,5)+rQ(P,S,E,C)+A+e[P]+m[R]>>>0;A=C,C=E,E=cS(S,30)>>>0,S=w,w=N}t[0]=t[0]+w>>>0,t[1]=t[1]+S>>>0,t[2]=t[2]+E>>>0,t[3]=t[3]+C>>>0,t[4]=t[4]+A>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var I$=tQ("v5",80,iQ),Dy={},fS={exports:{}},P$;function aQ(){return P$||(P$=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(u,c,d){this.fn=u,this.context=c,this.once=d||!1}function a(u,c,d,h,m){if(typeof d!="function")throw new TypeError("The listener must be a function");var g=new i(d,h||u,m),_=t?t+c:c;return u._events[_]?u._events[_].fn?u._events[_]=[u._events[_],g]:u._events[_].push(g):(u._events[_]=g,u._eventsCount++),u}function s(u,c){--u._eventsCount===0?u._events=new r:delete u._events[c]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],d,h;if(this._eventsCount===0)return c;for(h in d=this._events)e.call(d,h)&&c.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(d)):c},o.prototype.listeners=function(c){var d=t?t+c:c,h=this._events[d];if(!h)return[];if(h.fn)return[h.fn];for(var m=0,g=h.length,_=new Array(g);m<g;m++)_[m]=h[m].fn;return _},o.prototype.listenerCount=function(c){var d=t?t+c:c,h=this._events[d];return h?h.fn?1:h.length:0},o.prototype.emit=function(c,d,h,m,g,_){var w=t?t+c:c;if(!this._events[w])return!1;var S=this._events[w],E=arguments.length,C,A;if(S.fn){switch(S.once&&this.removeListener(c,S.fn,void 0,!0),E){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,d),!0;case 3:return S.fn.call(S.context,d,h),!0;case 4:return S.fn.call(S.context,d,h,m),!0;case 5:return S.fn.call(S.context,d,h,m,g),!0;case 6:return S.fn.call(S.context,d,h,m,g,_),!0}for(A=1,C=new Array(E-1);A<E;A++)C[A-1]=arguments[A];S.fn.apply(S.context,C)}else{var R=S.length,P;for(A=0;A<R;A++)switch(S[A].once&&this.removeListener(c,S[A].fn,void 0,!0),E){case 1:S[A].fn.call(S[A].context);break;case 2:S[A].fn.call(S[A].context,d);break;case 3:S[A].fn.call(S[A].context,d,h);break;case 4:S[A].fn.call(S[A].context,d,h,m);break;default:if(!C)for(P=1,C=new Array(E-1);P<E;P++)C[P-1]=arguments[P];S[A].fn.apply(S[A].context,C)}}return!0},o.prototype.on=function(c,d,h){return a(this,c,d,h,!1)},o.prototype.once=function(c,d,h){return a(this,c,d,h,!0)},o.prototype.removeListener=function(c,d,h,m){var g=t?t+c:c;if(!this._events[g])return this;if(!d)return s(this,g),this;var _=this._events[g];if(_.fn)_.fn===d&&(!m||_.once)&&(!h||_.context===h)&&s(this,g);else{for(var w=0,S=[],E=_.length;w<E;w++)(_[w].fn!==d||m&&!_[w].once||h&&_[w].context!==h)&&S.push(_[w]);S.length?this._events[g]=S.length===1?S[0]:S:s(this,g)}return this},o.prototype.removeAllListeners=function(c){var d;return c?(d=t?t+c:c,this._events[d]&&s(this,d)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o}(fS)),fS.exports}var ep={exports:{}},dS,O$;function sQ(){return O$||(O$=1,dS=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})))),dS}var k$;function oQ(){if(k$)return ep.exports;k$=1;const n=sQ();class e extends Error{constructor(i){super(i),this.name="TimeoutError"}}const t=(r,i,a)=>new Promise((s,o)=>{if(typeof i!="number"||i<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(i===1/0){s(r);return}const u=setTimeout(()=>{if(typeof a=="function"){try{s(a())}catch(h){o(h)}return}const c=typeof a=="string"?a:`Promise timed out after ${i} milliseconds`,d=a instanceof Error?a:new e(c);typeof r.cancel=="function"&&r.cancel(),o(d)},i);n(r.then(s,o),()=>{clearTimeout(u)})});return ep.exports=t,ep.exports.default=t,ep.exports.TimeoutError=e,ep.exports}var $y={},Ly={},N$;function lQ(){if(N$)return Ly;N$=1,Object.defineProperty(Ly,"__esModule",{value:!0});function n(e,t,r){let i=0,a=e.length;for(;a>0;){const s=a/2|0;let o=i+s;r(e[o],t)<=0?(i=++o,a-=s+1):a=s}return i}return Ly.default=n,Ly}var M$;function uQ(){if(M$)return $y;M$=1,Object.defineProperty($y,"__esModule",{value:!0});const n=lQ();class e{constructor(){this._queue=[]}enqueue(r,i){i=Object.assign({priority:0},i);const a={priority:i.priority,run:r};if(this.size&&this._queue[this.size-1].priority>=i.priority){this._queue.push(a);return}const s=n.default(this._queue,a,(o,u)=>u.priority-o.priority);this._queue.splice(s,0,a)}dequeue(){const r=this._queue.shift();return r==null?void 0:r.run}filter(r){return this._queue.filter(i=>i.priority===r.priority).map(i=>i.run)}get size(){return this._queue.length}}return $y.default=e,$y}var D$;function cQ(){if(D$)return Dy;D$=1,Object.defineProperty(Dy,"__esModule",{value:!0});const n=aQ(),e=oQ(),t=uQ(),r=()=>{},i=new e.TimeoutError;class a extends n{constructor(o){var u,c,d,h;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=r,this._resolveIdle=r,o=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:t.default},o),!(typeof o.intervalCap=="number"&&o.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(c=(u=o.intervalCap)===null||u===void 0?void 0:u.toString())!==null&&c!==void 0?c:""}\` (${typeof o.intervalCap})`);if(o.interval===void 0||!(Number.isFinite(o.interval)&&o.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(h=(d=o.interval)===null||d===void 0?void 0:d.toString())!==null&&h!==void 0?h:""}\` (${typeof o.interval})`);this._carryoverConcurrencyCount=o.carryoverConcurrencyCount,this._isIntervalIgnored=o.intervalCap===1/0||o.interval===0,this._intervalCap=o.intervalCap,this._interval=o.interval,this._queue=new o.queueClass,this._queueClass=o.queueClass,this.concurrency=o.concurrency,this._timeout=o.timeout,this._throwOnTimeout=o.throwOnTimeout===!0,this._isPaused=o.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=r,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=r,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const o=Date.now();if(this._intervalId===void 0){const u=this._intervalEnd-o;if(u<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},u)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const o=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const u=this._queue.dequeue();return u?(this.emit("active"),u(),o&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(o){if(!(typeof o=="number"&&o>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${o}\` (${typeof o})`);this._concurrency=o,this._processQueue()}async add(o,u={}){return new Promise((c,d)=>{const h=async()=>{this._pendingCount++,this._intervalCount++;try{const m=this._timeout===void 0&&u.timeout===void 0?o():e.default(Promise.resolve(o()),u.timeout===void 0?this._timeout:u.timeout,()=>{(u.throwOnTimeout===void 0?this._throwOnTimeout:u.throwOnTimeout)&&d(i)});c(await m)}catch(m){d(m)}this._next()};this._queue.enqueue(h,u),this._tryToStartAnother(),this.emit("add")})}async addAll(o,u){return Promise.all(o.map(async c=>this.add(c,u)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(o=>{const u=this._resolveEmpty;this._resolveEmpty=()=>{u(),o()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(o=>{const u=this._resolveIdle;this._resolveIdle=()=>{u(),o()}})}get size(){return this._queue.size}sizeBy(o){return this._queue.filter(o).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(o){this._timeout=o}}return Dy.default=a,Dy}var fQ=cQ();const Go=Za(fQ),V6=()=>ys("PROJECT")??Ql("LANGCHAIN_SESSION")??"default",z6="0.3.34";var qp={};let Oo;const dQ=()=>typeof window<"u"&&typeof window.document<"u",hQ=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",pQ=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),H6=()=>typeof Deno<"u",mQ=()=>typeof ot<"u"&&typeof ot.versions<"u"&&typeof ot.versions.node<"u"&&!H6(),gQ=()=>Oo||(dQ()?Oo="browser":mQ()?Oo="node":hQ()?Oo="webworker":pQ()?Oo="jsdom":H6()?Oo="deno":Oo="other",Oo);let hS;function G6(){if(hS===void 0){const n=gQ(),e=_Q();hS={library:"langsmith",runtime:n,sdk:"langsmith-js",sdk_version:z6,...e}}return hS}function yQ(){const n=vQ()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[r,i]of Object.entries(n))(r.startsWith("LANGCHAIN_")||r.startsWith("LANGSMITH_"))&&typeof i=="string"&&!t.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=i:e[r]=i);return e}function vQ(){try{return typeof ot<"u"&&qp?Object.entries(qp).reduce((n,[e,t])=>(n[e]=String(t),n),{}):void 0}catch{return}}function Ql(n){try{return typeof ot<"u"?qp==null?void 0:qp[n]:void 0}catch{return}}function ys(n){return Ql(`LANGSMITH_${n}`)||Ql(`LANGCHAIN_${n}`)}let pS;function _Q(){if(pS!==void 0)return pS;const n=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of n){const r=Ql(t);r!==void 0&&(e[t]=r)}return pS=e,e}const bQ=(...n)=>fetch(...n),W6=Symbol.for("ls:fetch_implementation"),wQ=()=>{const n=globalThis[W6];return n?typeof n=="function"&&"Headers"in n&&"Request"in n&&"Response"in n:!1},mt=n=>async(...e)=>{if(n||ys("DEBUG")==="true"){const[r,i]=e;console.log(`→ ${(i==null?void 0:i.method)||"GET"} ${r}`)}const t=await(globalThis[W6]??bQ)(...e);return(n||ys("DEBUG")==="true")&&console.log(`← ${t.status} ${t.statusText} ${t.url}`),t},EQ=[400,401,403,404,405,406,407,408],SQ=[409];let $$=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.debug=e.debug,"default"in Go?this.queue=new Go.default({concurrency:this.maxConcurrency}):this.queue=new Go({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){const r=this.onFailedResponseHook;return this.queue.add(()=>R_(()=>e(...t).catch(i=>{throw i instanceof Error?i:new Error(i)}),{async onFailedAttempt(i){if(i.message.startsWith("Cancel")||i.message.startsWith("TimeoutError")||i.message.startsWith("AbortError")||(i==null?void 0:i.code)==="ECONNABORTED")throw i;const a=i==null?void 0:i.response,s=a==null?void 0:a.status;if(s){if(EQ.includes(+s))throw i;if(SQ.includes(+s))return;r&&await r(a)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((i,a)=>{var s;(s=e.signal)==null||s.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>mt(this.debug)(...e).then(t=>t.ok?t:Promise.reject(t)))}};function L$(n){return typeof(n==null?void 0:n._getType)=="function"}function U$(n){const e={type:n._getType(),data:{content:n.content}};return n!=null&&n.additional_kwargs&&Object.keys(n.additional_kwargs).length>0&&(e.data.additional_kwargs={...n.additional_kwargs}),e}function Mt(n,e){if(!B6(n)){const t=e!==void 0?`Invalid UUID for ${e}: ${n}`:`Invalid UUID: ${n}`;throw new Error(t)}return n}const j$={};function K6(n){j$[n]||(console.warn(n),j$[n]=!0)}var Uy={exports:{}},mS,F$;function xb(){if(F$)return mS;F$=1;const n="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,r=16,i=e-6;return mS={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:i,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:n,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},mS}var gS,B$;function Rb(){if(B$)return gS;B$=1;var n={};return gS=typeof ot=="object"&&n&&n.NODE_DEBUG&&/\bsemver\b/i.test(n.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{},gS}var q$;function qm(){return q$||(q$=1,function(n,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:i}=xb(),a=Rb();e=n.exports={};const s=e.re=[],o=e.safeRe=[],u=e.src=[],c=e.safeSrc=[],d=e.t={};let h=0;const m="[a-zA-Z0-9-]",g=[["\\s",1],["\\d",i],[m,r]],_=S=>{for(const[E,C]of g)S=S.split(`${E}*`).join(`${E}{0,${C}}`).split(`${E}+`).join(`${E}{1,${C}}`);return S},w=(S,E,C)=>{const A=_(E),R=h++;a(S,R,E),d[S]=R,u[R]=E,c[R]=A,s[R]=new RegExp(E,C?"g":void 0),o[R]=new RegExp(A,C?"g":void 0)};w("NUMERICIDENTIFIER","0|[1-9]\\d*"),w("NUMERICIDENTIFIERLOOSE","\\d+"),w("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${m}*`),w("MAINVERSION",`(${u[d.NUMERICIDENTIFIER]})\\.(${u[d.NUMERICIDENTIFIER]})\\.(${u[d.NUMERICIDENTIFIER]})`),w("MAINVERSIONLOOSE",`(${u[d.NUMERICIDENTIFIERLOOSE]})\\.(${u[d.NUMERICIDENTIFIERLOOSE]})\\.(${u[d.NUMERICIDENTIFIERLOOSE]})`),w("PRERELEASEIDENTIFIER",`(?:${u[d.NONNUMERICIDENTIFIER]}|${u[d.NUMERICIDENTIFIER]})`),w("PRERELEASEIDENTIFIERLOOSE",`(?:${u[d.NONNUMERICIDENTIFIER]}|${u[d.NUMERICIDENTIFIERLOOSE]})`),w("PRERELEASE",`(?:-(${u[d.PRERELEASEIDENTIFIER]}(?:\\.${u[d.PRERELEASEIDENTIFIER]})*))`),w("PRERELEASELOOSE",`(?:-?(${u[d.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[d.PRERELEASEIDENTIFIERLOOSE]})*))`),w("BUILDIDENTIFIER",`${m}+`),w("BUILD",`(?:\\+(${u[d.BUILDIDENTIFIER]}(?:\\.${u[d.BUILDIDENTIFIER]})*))`),w("FULLPLAIN",`v?${u[d.MAINVERSION]}${u[d.PRERELEASE]}?${u[d.BUILD]}?`),w("FULL",`^${u[d.FULLPLAIN]}$`),w("LOOSEPLAIN",`[v=\\s]*${u[d.MAINVERSIONLOOSE]}${u[d.PRERELEASELOOSE]}?${u[d.BUILD]}?`),w("LOOSE",`^${u[d.LOOSEPLAIN]}$`),w("GTLT","((?:<|>)?=?)"),w("XRANGEIDENTIFIERLOOSE",`${u[d.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),w("XRANGEIDENTIFIER",`${u[d.NUMERICIDENTIFIER]}|x|X|\\*`),w("XRANGEPLAIN",`[v=\\s]*(${u[d.XRANGEIDENTIFIER]})(?:\\.(${u[d.XRANGEIDENTIFIER]})(?:\\.(${u[d.XRANGEIDENTIFIER]})(?:${u[d.PRERELEASE]})?${u[d.BUILD]}?)?)?`),w("XRANGEPLAINLOOSE",`[v=\\s]*(${u[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[d.XRANGEIDENTIFIERLOOSE]})(?:${u[d.PRERELEASELOOSE]})?${u[d.BUILD]}?)?)?`),w("XRANGE",`^${u[d.GTLT]}\\s*${u[d.XRANGEPLAIN]}$`),w("XRANGELOOSE",`^${u[d.GTLT]}\\s*${u[d.XRANGEPLAINLOOSE]}$`),w("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),w("COERCE",`${u[d.COERCEPLAIN]}(?:$|[^\\d])`),w("COERCEFULL",u[d.COERCEPLAIN]+`(?:${u[d.PRERELEASE]})?(?:${u[d.BUILD]})?(?:$|[^\\d])`),w("COERCERTL",u[d.COERCE],!0),w("COERCERTLFULL",u[d.COERCEFULL],!0),w("LONETILDE","(?:~>?)"),w("TILDETRIM",`(\\s*)${u[d.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",w("TILDE",`^${u[d.LONETILDE]}${u[d.XRANGEPLAIN]}$`),w("TILDELOOSE",`^${u[d.LONETILDE]}${u[d.XRANGEPLAINLOOSE]}$`),w("LONECARET","(?:\\^)"),w("CARETTRIM",`(\\s*)${u[d.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",w("CARET",`^${u[d.LONECARET]}${u[d.XRANGEPLAIN]}$`),w("CARETLOOSE",`^${u[d.LONECARET]}${u[d.XRANGEPLAINLOOSE]}$`),w("COMPARATORLOOSE",`^${u[d.GTLT]}\\s*(${u[d.LOOSEPLAIN]})$|^$`),w("COMPARATOR",`^${u[d.GTLT]}\\s*(${u[d.FULLPLAIN]})$|^$`),w("COMPARATORTRIM",`(\\s*)${u[d.GTLT]}\\s*(${u[d.LOOSEPLAIN]}|${u[d.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",w("HYPHENRANGE",`^\\s*(${u[d.XRANGEPLAIN]})\\s+-\\s+(${u[d.XRANGEPLAIN]})\\s*$`),w("HYPHENRANGELOOSE",`^\\s*(${u[d.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[d.XRANGEPLAINLOOSE]})\\s*$`),w("STAR","(<|>)?=?\\s*\\*"),w("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),w("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(Uy,Uy.exports)),Uy.exports}var yS,V$;function hI(){if(V$)return yS;V$=1;const n=Object.freeze({loose:!0}),e=Object.freeze({});return yS=r=>r?typeof r!="object"?n:r:e,yS}var vS,z$;function J6(){if(z$)return vS;z$=1;const n=/^[0-9]+$/,e=(r,i)=>{const a=n.test(r),s=n.test(i);return a&&s&&(r=+r,i=+i),r===i?0:a&&!s?-1:s&&!a?1:r<i?-1:1};return vS={compareIdentifiers:e,rcompareIdentifiers:(r,i)=>e(i,r)},vS}var _S,H$;function Si(){if(H$)return _S;H$=1;const n=Rb(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=xb(),{safeRe:r,t:i}=qm(),a=hI(),{compareIdentifiers:s}=J6();class o{constructor(c,d){if(d=a(d),c instanceof o){if(c.loose===!!d.loose&&c.includePrerelease===!!d.includePrerelease)return c;c=c.version}else if(typeof c!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof c}".`);if(c.length>e)throw new TypeError(`version is longer than ${e} characters`);n("SemVer",c,d),this.options=d,this.loose=!!d.loose,this.includePrerelease=!!d.includePrerelease;const h=c.trim().match(d.loose?r[i.LOOSE]:r[i.FULL]);if(!h)throw new TypeError(`Invalid Version: ${c}`);if(this.raw=c,this.major=+h[1],this.minor=+h[2],this.patch=+h[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");h[4]?this.prerelease=h[4].split(".").map(m=>{if(/^[0-9]+$/.test(m)){const g=+m;if(g>=0&&g<t)return g}return m}):this.prerelease=[],this.build=h[5]?h[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(c){if(n("SemVer.compare",this.version,this.options,c),!(c instanceof o)){if(typeof c=="string"&&c===this.version)return 0;c=new o(c,this.options)}return c.version===this.version?0:this.compareMain(c)||this.comparePre(c)}compareMain(c){return c instanceof o||(c=new o(c,this.options)),s(this.major,c.major)||s(this.minor,c.minor)||s(this.patch,c.patch)}comparePre(c){if(c instanceof o||(c=new o(c,this.options)),this.prerelease.length&&!c.prerelease.length)return-1;if(!this.prerelease.length&&c.prerelease.length)return 1;if(!this.prerelease.length&&!c.prerelease.length)return 0;let d=0;do{const h=this.prerelease[d],m=c.prerelease[d];if(n("prerelease compare",d,h,m),h===void 0&&m===void 0)return 0;if(m===void 0)return 1;if(h===void 0)return-1;if(h===m)continue;return s(h,m)}while(++d)}compareBuild(c){c instanceof o||(c=new o(c,this.options));let d=0;do{const h=this.build[d],m=c.build[d];if(n("build compare",d,h,m),h===void 0&&m===void 0)return 0;if(m===void 0)return 1;if(h===void 0)return-1;if(h===m)continue;return s(h,m)}while(++d)}inc(c,d,h){if(c.startsWith("pre")){if(!d&&h===!1)throw new Error("invalid increment argument: identifier is empty");if(d){const m=`-${d}`.match(this.options.loose?r[i.PRERELEASELOOSE]:r[i.PRERELEASE]);if(!m||m[1]!==d)throw new Error(`invalid identifier: ${d}`)}}switch(c){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",d,h);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",d,h);break;case"prepatch":this.prerelease.length=0,this.inc("patch",d,h),this.inc("pre",d,h);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",d,h),this.inc("pre",d,h);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const m=Number(h)?1:0;if(this.prerelease.length===0)this.prerelease=[m];else{let g=this.prerelease.length;for(;--g>=0;)typeof this.prerelease[g]=="number"&&(this.prerelease[g]++,g=-2);if(g===-1){if(d===this.prerelease.join(".")&&h===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(m)}}if(d){let g=[d,m];h===!1&&(g=[d]),s(this.prerelease[0],d)===0?isNaN(this.prerelease[1])&&(this.prerelease=g):this.prerelease=g}break}default:throw new Error(`invalid increment argument: ${c}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return _S=o,_S}var bS,G$;function Ud(){if(G$)return bS;G$=1;const n=Si();return bS=(t,r,i=!1)=>{if(t instanceof n)return t;try{return new n(t,r)}catch(a){if(!i)return null;throw a}},bS}var wS,W$;function TQ(){if(W$)return wS;W$=1;const n=Ud();return wS=(t,r)=>{const i=n(t,r);return i?i.version:null},wS}var ES,K$;function AQ(){if(K$)return ES;K$=1;const n=Ud();return ES=(t,r)=>{const i=n(t.trim().replace(/^[=v]+/,""),r);return i?i.version:null},ES}var SS,J$;function CQ(){if(J$)return SS;J$=1;const n=Si();return SS=(t,r,i,a,s)=>{typeof i=="string"&&(s=a,a=i,i=void 0);try{return new n(t instanceof n?t.version:t,i).inc(r,a,s).version}catch{return null}},SS}var TS,Y$;function xQ(){if(Y$)return TS;Y$=1;const n=Ud();return TS=(t,r)=>{const i=n(t,null,!0),a=n(r,null,!0),s=i.compare(a);if(s===0)return null;const o=s>0,u=o?i:a,c=o?a:i,d=!!u.prerelease.length;if(!!c.prerelease.length&&!d){if(!c.patch&&!c.minor)return"major";if(c.compareMain(u)===0)return c.minor&&!c.patch?"minor":"patch"}const m=d?"pre":"";return i.major!==a.major?m+"major":i.minor!==a.minor?m+"minor":i.patch!==a.patch?m+"patch":"prerelease"},TS}var AS,Z$;function RQ(){if(Z$)return AS;Z$=1;const n=Si();return AS=(t,r)=>new n(t,r).major,AS}var CS,X$;function IQ(){if(X$)return CS;X$=1;const n=Si();return CS=(t,r)=>new n(t,r).minor,CS}var xS,Q$;function PQ(){if(Q$)return xS;Q$=1;const n=Si();return xS=(t,r)=>new n(t,r).patch,xS}var RS,eL;function OQ(){if(eL)return RS;eL=1;const n=Ud();return RS=(t,r)=>{const i=n(t,r);return i&&i.prerelease.length?i.prerelease:null},RS}var IS,tL;function ks(){if(tL)return IS;tL=1;const n=Si();return IS=(t,r,i)=>new n(t,i).compare(new n(r,i)),IS}var PS,nL;function kQ(){if(nL)return PS;nL=1;const n=ks();return PS=(t,r,i)=>n(r,t,i),PS}var OS,rL;function NQ(){if(rL)return OS;rL=1;const n=ks();return OS=(t,r)=>n(t,r,!0),OS}var kS,iL;function pI(){if(iL)return kS;iL=1;const n=Si();return kS=(t,r,i)=>{const a=new n(t,i),s=new n(r,i);return a.compare(s)||a.compareBuild(s)},kS}var NS,aL;function MQ(){if(aL)return NS;aL=1;const n=pI();return NS=(t,r)=>t.sort((i,a)=>n(i,a,r)),NS}var MS,sL;function DQ(){if(sL)return MS;sL=1;const n=pI();return MS=(t,r)=>t.sort((i,a)=>n(a,i,r)),MS}var DS,oL;function Ib(){if(oL)return DS;oL=1;const n=ks();return DS=(t,r,i)=>n(t,r,i)>0,DS}var $S,lL;function mI(){if(lL)return $S;lL=1;const n=ks();return $S=(t,r,i)=>n(t,r,i)<0,$S}var LS,uL;function Y6(){if(uL)return LS;uL=1;const n=ks();return LS=(t,r,i)=>n(t,r,i)===0,LS}var US,cL;function Z6(){if(cL)return US;cL=1;const n=ks();return US=(t,r,i)=>n(t,r,i)!==0,US}var jS,fL;function gI(){if(fL)return jS;fL=1;const n=ks();return jS=(t,r,i)=>n(t,r,i)>=0,jS}var FS,dL;function yI(){if(dL)return FS;dL=1;const n=ks();return FS=(t,r,i)=>n(t,r,i)<=0,FS}var BS,hL;function X6(){if(hL)return BS;hL=1;const n=Y6(),e=Z6(),t=Ib(),r=gI(),i=mI(),a=yI();return BS=(o,u,c,d)=>{switch(u){case"===":return typeof o=="object"&&(o=o.version),typeof c=="object"&&(c=c.version),o===c;case"!==":return typeof o=="object"&&(o=o.version),typeof c=="object"&&(c=c.version),o!==c;case"":case"=":case"==":return n(o,c,d);case"!=":return e(o,c,d);case">":return t(o,c,d);case">=":return r(o,c,d);case"<":return i(o,c,d);case"<=":return a(o,c,d);default:throw new TypeError(`Invalid operator: ${u}`)}},BS}var qS,pL;function $Q(){if(pL)return qS;pL=1;const n=Si(),e=Ud(),{safeRe:t,t:r}=qm();return qS=(a,s)=>{if(a instanceof n)return a;if(typeof a=="number"&&(a=String(a)),typeof a!="string")return null;s=s||{};let o=null;if(!s.rtl)o=a.match(s.includePrerelease?t[r.COERCEFULL]:t[r.COERCE]);else{const g=s.includePrerelease?t[r.COERCERTLFULL]:t[r.COERCERTL];let _;for(;(_=g.exec(a))&&(!o||o.index+o[0].length!==a.length);)(!o||_.index+_[0].length!==o.index+o[0].length)&&(o=_),g.lastIndex=_.index+_[1].length+_[2].length;g.lastIndex=-1}if(o===null)return null;const u=o[2],c=o[3]||"0",d=o[4]||"0",h=s.includePrerelease&&o[5]?`-${o[5]}`:"",m=s.includePrerelease&&o[6]?`+${o[6]}`:"";return e(`${u}.${c}.${d}${h}${m}`,s)},qS}var VS,mL;function LQ(){if(mL)return VS;mL=1;class n{constructor(){this.max=1e3,this.map=new Map}get(t){const r=this.map.get(t);if(r!==void 0)return this.map.delete(t),this.map.set(t,r),r}delete(t){return this.map.delete(t)}set(t,r){if(!this.delete(t)&&r!==void 0){if(this.map.size>=this.max){const a=this.map.keys().next().value;this.delete(a)}this.map.set(t,r)}return this}}return VS=n,VS}var zS,gL;function Ns(){if(gL)return zS;gL=1;const n=/\s+/g;class e{constructor(se,ee){if(ee=i(ee),se instanceof e)return se.loose===!!ee.loose&&se.includePrerelease===!!ee.includePrerelease?se:new e(se.raw,ee);if(se instanceof a)return this.raw=se.value,this.set=[[se]],this.formatted=void 0,this;if(this.options=ee,this.loose=!!ee.loose,this.includePrerelease=!!ee.includePrerelease,this.raw=se.trim().replace(n," "),this.set=this.raw.split("||").map(le=>this.parseRange(le.trim())).filter(le=>le.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const le=this.set[0];if(this.set=this.set.filter(pe=>!w(pe[0])),this.set.length===0)this.set=[le];else if(this.set.length>1){for(const pe of this.set)if(pe.length===1&&S(pe[0])){this.set=[pe];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let se=0;se<this.set.length;se++){se>0&&(this.formatted+="||");const ee=this.set[se];for(let le=0;le<ee.length;le++)le>0&&(this.formatted+=" "),this.formatted+=ee[le].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(se){const le=((this.options.includePrerelease&&g)|(this.options.loose&&_))+":"+se,pe=r.get(le);if(pe)return pe;const we=this.options.loose,$=we?u[c.HYPHENRANGELOOSE]:u[c.HYPHENRANGE];se=se.replace($,z(this.options.includePrerelease)),s("hyphen replace",se),se=se.replace(u[c.COMPARATORTRIM],d),s("comparator trim",se),se=se.replace(u[c.TILDETRIM],h),s("tilde trim",se),se=se.replace(u[c.CARETTRIM],m),s("caret trim",se);let ve=se.split(" ").map(fe=>C(fe,this.options)).join(" ").split(/\s+/).map(fe=>G(fe,this.options));we&&(ve=ve.filter(fe=>(s("loose invalid filter",fe,this.options),!!fe.match(u[c.COMPARATORLOOSE])))),s("range list",ve);const Te=new Map,F=ve.map(fe=>new a(fe,this.options));for(const fe of F){if(w(fe))return[fe];Te.set(fe.value,fe)}Te.size>1&&Te.has("")&&Te.delete("");const ae=[...Te.values()];return r.set(le,ae),ae}intersects(se,ee){if(!(se instanceof e))throw new TypeError("a Range is required");return this.set.some(le=>E(le,ee)&&se.set.some(pe=>E(pe,ee)&&le.every(we=>pe.every($=>we.intersects($,ee)))))}test(se){if(!se)return!1;if(typeof se=="string")try{se=new o(se,this.options)}catch{return!1}for(let ee=0;ee<this.set.length;ee++)if(oe(this.set[ee],se,this.options))return!0;return!1}}zS=e;const t=LQ(),r=new t,i=hI(),a=Pb(),s=Rb(),o=Si(),{safeRe:u,t:c,comparatorTrimReplace:d,tildeTrimReplace:h,caretTrimReplace:m}=qm(),{FLAG_INCLUDE_PRERELEASE:g,FLAG_LOOSE:_}=xb(),w=te=>te.value==="<0.0.0-0",S=te=>te.value==="",E=(te,se)=>{let ee=!0;const le=te.slice();let pe=le.pop();for(;ee&&le.length;)ee=le.every(we=>pe.intersects(we,se)),pe=le.pop();return ee},C=(te,se)=>(s("comp",te,se),te=N(te,se),s("caret",te),te=R(te,se),s("tildes",te),te=k(te,se),s("xrange",te),te=H(te,se),s("stars",te),te),A=te=>!te||te.toLowerCase()==="x"||te==="*",R=(te,se)=>te.trim().split(/\s+/).map(ee=>P(ee,se)).join(" "),P=(te,se)=>{const ee=se.loose?u[c.TILDELOOSE]:u[c.TILDE];return te.replace(ee,(le,pe,we,$,ve)=>{s("tilde",te,le,pe,we,$,ve);let Te;return A(pe)?Te="":A(we)?Te=`>=${pe}.0.0 <${+pe+1}.0.0-0`:A($)?Te=`>=${pe}.${we}.0 <${pe}.${+we+1}.0-0`:ve?(s("replaceTilde pr",ve),Te=`>=${pe}.${we}.${$}-${ve} <${pe}.${+we+1}.0-0`):Te=`>=${pe}.${we}.${$} <${pe}.${+we+1}.0-0`,s("tilde return",Te),Te})},N=(te,se)=>te.trim().split(/\s+/).map(ee=>U(ee,se)).join(" "),U=(te,se)=>{s("caret",te,se);const ee=se.loose?u[c.CARETLOOSE]:u[c.CARET],le=se.includePrerelease?"-0":"";return te.replace(ee,(pe,we,$,ve,Te)=>{s("caret",te,pe,we,$,ve,Te);let F;return A(we)?F="":A($)?F=`>=${we}.0.0${le} <${+we+1}.0.0-0`:A(ve)?we==="0"?F=`>=${we}.${$}.0${le} <${we}.${+$+1}.0-0`:F=`>=${we}.${$}.0${le} <${+we+1}.0.0-0`:Te?(s("replaceCaret pr",Te),we==="0"?$==="0"?F=`>=${we}.${$}.${ve}-${Te} <${we}.${$}.${+ve+1}-0`:F=`>=${we}.${$}.${ve}-${Te} <${we}.${+$+1}.0-0`:F=`>=${we}.${$}.${ve}-${Te} <${+we+1}.0.0-0`):(s("no pr"),we==="0"?$==="0"?F=`>=${we}.${$}.${ve}${le} <${we}.${$}.${+ve+1}-0`:F=`>=${we}.${$}.${ve}${le} <${we}.${+$+1}.0-0`:F=`>=${we}.${$}.${ve} <${+we+1}.0.0-0`),s("caret return",F),F})},k=(te,se)=>(s("replaceXRanges",te,se),te.split(/\s+/).map(ee=>B(ee,se)).join(" ")),B=(te,se)=>{te=te.trim();const ee=se.loose?u[c.XRANGELOOSE]:u[c.XRANGE];return te.replace(ee,(le,pe,we,$,ve,Te)=>{s("xRange",te,le,pe,we,$,ve,Te);const F=A(we),ae=F||A($),fe=ae||A(ve),I=fe;return pe==="="&&I&&(pe=""),Te=se.includePrerelease?"-0":"",F?pe===">"||pe==="<"?le="<0.0.0-0":le="*":pe&&I?(ae&&($=0),ve=0,pe===">"?(pe=">=",ae?(we=+we+1,$=0,ve=0):($=+$+1,ve=0)):pe==="<="&&(pe="<",ae?we=+we+1:$=+$+1),pe==="<"&&(Te="-0"),le=`${pe+we}.${$}.${ve}${Te}`):ae?le=`>=${we}.0.0${Te} <${+we+1}.0.0-0`:fe&&(le=`>=${we}.${$}.0${Te} <${we}.${+$+1}.0-0`),s("xRange return",le),le})},H=(te,se)=>(s("replaceStars",te,se),te.trim().replace(u[c.STAR],"")),G=(te,se)=>(s("replaceGTE0",te,se),te.trim().replace(u[se.includePrerelease?c.GTE0PRE:c.GTE0],"")),z=te=>(se,ee,le,pe,we,$,ve,Te,F,ae,fe,I)=>(A(le)?ee="":A(pe)?ee=`>=${le}.0.0${te?"-0":""}`:A(we)?ee=`>=${le}.${pe}.0${te?"-0":""}`:$?ee=`>=${ee}`:ee=`>=${ee}${te?"-0":""}`,A(F)?Te="":A(ae)?Te=`<${+F+1}.0.0-0`:A(fe)?Te=`<${F}.${+ae+1}.0-0`:I?Te=`<=${F}.${ae}.${fe}-${I}`:te?Te=`<${F}.${ae}.${+fe+1}-0`:Te=`<=${Te}`,`${ee} ${Te}`.trim()),oe=(te,se,ee)=>{for(let le=0;le<te.length;le++)if(!te[le].test(se))return!1;if(se.prerelease.length&&!ee.includePrerelease){for(let le=0;le<te.length;le++)if(s(te[le].semver),te[le].semver!==a.ANY&&te[le].semver.prerelease.length>0){const pe=te[le].semver;if(pe.major===se.major&&pe.minor===se.minor&&pe.patch===se.patch)return!0}return!1}return!0};return zS}var HS,yL;function Pb(){if(yL)return HS;yL=1;const n=Symbol("SemVer ANY");class e{static get ANY(){return n}constructor(d,h){if(h=t(h),d instanceof e){if(d.loose===!!h.loose)return d;d=d.value}d=d.trim().split(/\s+/).join(" "),s("comparator",d,h),this.options=h,this.loose=!!h.loose,this.parse(d),this.semver===n?this.value="":this.value=this.operator+this.semver.version,s("comp",this)}parse(d){const h=this.options.loose?r[i.COMPARATORLOOSE]:r[i.COMPARATOR],m=d.match(h);if(!m)throw new TypeError(`Invalid comparator: ${d}`);this.operator=m[1]!==void 0?m[1]:"",this.operator==="="&&(this.operator=""),m[2]?this.semver=new o(m[2],this.options.loose):this.semver=n}toString(){return this.value}test(d){if(s("Comparator.test",d,this.options.loose),this.semver===n||d===n)return!0;if(typeof d=="string")try{d=new o(d,this.options)}catch{return!1}return a(d,this.operator,this.semver,this.options)}intersects(d,h){if(!(d instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new u(d.value,h).test(this.value):d.operator===""?d.value===""?!0:new u(this.value,h).test(d.semver):(h=t(h),h.includePrerelease&&(this.value==="<0.0.0-0"||d.value==="<0.0.0-0")||!h.includePrerelease&&(this.value.startsWith("<0.0.0")||d.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&d.operator.startsWith(">")||this.operator.startsWith("<")&&d.operator.startsWith("<")||this.semver.version===d.semver.version&&this.operator.includes("=")&&d.operator.includes("=")||a(this.semver,"<",d.semver,h)&&this.operator.startsWith(">")&&d.operator.startsWith("<")||a(this.semver,">",d.semver,h)&&this.operator.startsWith("<")&&d.operator.startsWith(">")))}}HS=e;const t=hI(),{safeRe:r,t:i}=qm(),a=X6(),s=Rb(),o=Si(),u=Ns();return HS}var GS,vL;function Ob(){if(vL)return GS;vL=1;const n=Ns();return GS=(t,r,i)=>{try{r=new n(r,i)}catch{return!1}return r.test(t)},GS}var WS,_L;function UQ(){if(_L)return WS;_L=1;const n=Ns();return WS=(t,r)=>new n(t,r).set.map(i=>i.map(a=>a.value).join(" ").trim().split(" ")),WS}var KS,bL;function jQ(){if(bL)return KS;bL=1;const n=Si(),e=Ns();return KS=(r,i,a)=>{let s=null,o=null,u=null;try{u=new e(i,a)}catch{return null}return r.forEach(c=>{u.test(c)&&(!s||o.compare(c)===-1)&&(s=c,o=new n(s,a))}),s},KS}var JS,wL;function FQ(){if(wL)return JS;wL=1;const n=Si(),e=Ns();return JS=(r,i,a)=>{let s=null,o=null,u=null;try{u=new e(i,a)}catch{return null}return r.forEach(c=>{u.test(c)&&(!s||o.compare(c)===1)&&(s=c,o=new n(s,a))}),s},JS}var YS,EL;function BQ(){if(EL)return YS;EL=1;const n=Si(),e=Ns(),t=Ib();return YS=(i,a)=>{i=new e(i,a);let s=new n("0.0.0");if(i.test(s)||(s=new n("0.0.0-0"),i.test(s)))return s;s=null;for(let o=0;o<i.set.length;++o){const u=i.set[o];let c=null;u.forEach(d=>{const h=new n(d.semver.version);switch(d.operator){case">":h.prerelease.length===0?h.patch++:h.prerelease.push(0),h.raw=h.format();case"":case">=":(!c||t(h,c))&&(c=h);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${d.operator}`)}}),c&&(!s||t(s,c))&&(s=c)}return s&&i.test(s)?s:null},YS}var ZS,SL;function qQ(){if(SL)return ZS;SL=1;const n=Ns();return ZS=(t,r)=>{try{return new n(t,r).range||"*"}catch{return null}},ZS}var XS,TL;function vI(){if(TL)return XS;TL=1;const n=Si(),e=Pb(),{ANY:t}=e,r=Ns(),i=Ob(),a=Ib(),s=mI(),o=yI(),u=gI();return XS=(d,h,m,g)=>{d=new n(d,g),h=new r(h,g);let _,w,S,E,C;switch(m){case">":_=a,w=o,S=s,E=">",C=">=";break;case"<":_=s,w=u,S=a,E="<",C="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(i(d,h,g))return!1;for(let A=0;A<h.set.length;++A){const R=h.set[A];let P=null,N=null;if(R.forEach(U=>{U.semver===t&&(U=new e(">=0.0.0")),P=P||U,N=N||U,_(U.semver,P.semver,g)?P=U:S(U.semver,N.semver,g)&&(N=U)}),P.operator===E||P.operator===C||(!N.operator||N.operator===E)&&w(d,N.semver))return!1;if(N.operator===C&&S(d,N.semver))return!1}return!0},XS}var QS,AL;function VQ(){if(AL)return QS;AL=1;const n=vI();return QS=(t,r,i)=>n(t,r,">",i),QS}var eT,CL;function zQ(){if(CL)return eT;CL=1;const n=vI();return eT=(t,r,i)=>n(t,r,"<",i),eT}var tT,xL;function HQ(){if(xL)return tT;xL=1;const n=Ns();return tT=(t,r,i)=>(t=new n(t,i),r=new n(r,i),t.intersects(r,i)),tT}var nT,RL;function GQ(){if(RL)return nT;RL=1;const n=Ob(),e=ks();return nT=(t,r,i)=>{const a=[];let s=null,o=null;const u=t.sort((m,g)=>e(m,g,i));for(const m of u)n(m,r,i)?(o=m,s||(s=m)):(o&&a.push([s,o]),o=null,s=null);s&&a.push([s,null]);const c=[];for(const[m,g]of a)m===g?c.push(m):!g&&m===u[0]?c.push("*"):g?m===u[0]?c.push(`<=${g}`):c.push(`${m} - ${g}`):c.push(`>=${m}`);const d=c.join(" || "),h=typeof r.raw=="string"?r.raw:String(r);return d.length<h.length?d:r},nT}var rT,IL;function WQ(){if(IL)return rT;IL=1;const n=Ns(),e=Pb(),{ANY:t}=e,r=Ob(),i=ks(),a=(h,m,g={})=>{if(h===m)return!0;h=new n(h,g),m=new n(m,g);let _=!1;e:for(const w of h.set){for(const S of m.set){const E=u(w,S,g);if(_=_||E!==null,E)continue e}if(_)return!1}return!0},s=[new e(">=0.0.0-0")],o=[new e(">=0.0.0")],u=(h,m,g)=>{if(h===m)return!0;if(h.length===1&&h[0].semver===t){if(m.length===1&&m[0].semver===t)return!0;g.includePrerelease?h=s:h=o}if(m.length===1&&m[0].semver===t){if(g.includePrerelease)return!0;m=o}const _=new Set;let w,S;for(const k of h)k.operator===">"||k.operator===">="?w=c(w,k,g):k.operator==="<"||k.operator==="<="?S=d(S,k,g):_.add(k.semver);if(_.size>1)return null;let E;if(w&&S){if(E=i(w.semver,S.semver,g),E>0)return null;if(E===0&&(w.operator!==">="||S.operator!=="<="))return null}for(const k of _){if(w&&!r(k,String(w),g)||S&&!r(k,String(S),g))return null;for(const B of m)if(!r(k,String(B),g))return!1;return!0}let C,A,R,P,N=S&&!g.includePrerelease&&S.semver.prerelease.length?S.semver:!1,U=w&&!g.includePrerelease&&w.semver.prerelease.length?w.semver:!1;N&&N.prerelease.length===1&&S.operator==="<"&&N.prerelease[0]===0&&(N=!1);for(const k of m){if(P=P||k.operator===">"||k.operator===">=",R=R||k.operator==="<"||k.operator==="<=",w){if(U&&k.semver.prerelease&&k.semver.prerelease.length&&k.semver.major===U.major&&k.semver.minor===U.minor&&k.semver.patch===U.patch&&(U=!1),k.operator===">"||k.operator===">="){if(C=c(w,k,g),C===k&&C!==w)return!1}else if(w.operator===">="&&!r(w.semver,String(k),g))return!1}if(S){if(N&&k.semver.prerelease&&k.semver.prerelease.length&&k.semver.major===N.major&&k.semver.minor===N.minor&&k.semver.patch===N.patch&&(N=!1),k.operator==="<"||k.operator==="<="){if(A=d(S,k,g),A===k&&A!==S)return!1}else if(S.operator==="<="&&!r(S.semver,String(k),g))return!1}if(!k.operator&&(S||w)&&E!==0)return!1}return!(w&&R&&!S&&E!==0||S&&P&&!w&&E!==0||U||N)},c=(h,m,g)=>{if(!h)return m;const _=i(h.semver,m.semver,g);return _>0?h:_<0||m.operator===">"&&h.operator===">="?m:h},d=(h,m,g)=>{if(!h)return m;const _=i(h.semver,m.semver,g);return _<0?h:_>0||m.operator==="<"&&h.operator==="<="?m:h};return rT=a,rT}var iT,PL;function KQ(){if(PL)return iT;PL=1;const n=qm(),e=xb(),t=Si(),r=J6(),i=Ud(),a=TQ(),s=AQ(),o=CQ(),u=xQ(),c=RQ(),d=IQ(),h=PQ(),m=OQ(),g=ks(),_=kQ(),w=NQ(),S=pI(),E=MQ(),C=DQ(),A=Ib(),R=mI(),P=Y6(),N=Z6(),U=gI(),k=yI(),B=X6(),H=$Q(),G=Pb(),z=Ns(),oe=Ob(),te=UQ(),se=jQ(),ee=FQ(),le=BQ(),pe=qQ(),we=vI(),$=VQ(),ve=zQ(),Te=HQ(),F=GQ(),ae=WQ();return iT={parse:i,valid:a,clean:s,inc:o,diff:u,major:c,minor:d,patch:h,prerelease:m,compare:g,rcompare:_,compareLoose:w,compareBuild:S,sort:E,rsort:C,gt:A,lt:R,eq:P,neq:N,gte:U,lte:k,cmp:B,coerce:H,Comparator:G,Range:z,satisfies:oe,toComparators:te,maxSatisfying:se,minSatisfying:ee,minVersion:le,validRange:pe,outside:we,gtr:$,ltr:ve,intersects:Te,simplifyRange:F,subset:ae,SemVer:t,re:n.re,src:n.src,tokens:n.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:r.compareIdentifiers,rcompareIdentifiers:r.rcompareIdentifiers},iT}KQ();function Ol(n){if(!n||n.split("/").length>2||n.startsWith("/")||n.endsWith("/")||n.split(":").length>2)throw new Error(`Invalid identifier format: ${n}`);const[e,t]=n.split(":"),r=t||"latest";if(e.includes("/")){const[i,a]=e.split("/",2);if(!i||!a)throw new Error(`Invalid identifier format: ${n}`);return[i,a,r]}else{if(!e)throw new Error(`Invalid identifier format: ${n}`);return["-",e,r]}}class JQ extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}async function Ut(n,e,t){let r;if(n.ok){t&&(r=await n.text());return}r=await n.text();const i=`Failed to ${e}. Received status [${n.status}]: ${n.statusText}. Server response: ${r}`;if(n.status===409)throw new JQ(i);const a=new Error(i);throw a.status=n.status,a}var OL="[...]",YQ={result:"[Circular]"},I_=[],Hf=[];const ZQ=new TextEncoder;function XQ(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function jy(n){return ZQ.encode(n)}function ca(n,e,t,r,i){var a;try{const s=JSON.stringify(n,t,r);return jy(s)}catch(s){if(!((a=s.message)!=null&&a.includes("Converting circular structure to JSON")))return console.warn(`[WARNING]: LangSmith received unserializable value.${e?`
Context: ${e}`:""}`),jy("[Unserializable]");ys("SUPPRESS_CIRCULAR_JSON_WARNINGS")!=="true"&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${e?`
Context: ${e}`:""}`),typeof i>"u"&&(i=XQ()),cx(n,"",0,[],void 0,0,i);let o;try{Hf.length===0?o=JSON.stringify(n,t,r):o=JSON.stringify(n,QQ(t),r)}catch{return jy("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;I_.length!==0;){const u=I_.pop();u.length===4?Object.defineProperty(u[0],u[1],u[3]):u[0][u[1]]=u[2]}}return jy(o)}}function aT(n,e,t,r){var i=Object.getOwnPropertyDescriptor(r,t);i.get!==void 0?i.configurable?(Object.defineProperty(r,t,{value:n}),I_.push([r,t,e,i])):Hf.push([e,t,n]):(r[t]=n,I_.push([r,t,e]))}function cx(n,e,t,r,i,a,s){a+=1;var o;if(typeof n=="object"&&n!==null){for(o=0;o<r.length;o++)if(r[o]===n){aT(YQ,n,e,i);return}if(typeof s.depthLimit<"u"&&a>s.depthLimit){aT(OL,n,e,i);return}if(typeof s.edgesLimit<"u"&&t+1>s.edgesLimit){aT(OL,n,e,i);return}if(r.push(n),Array.isArray(n))for(o=0;o<n.length;o++)cx(n[o],o,o,r,n,a,s);else{var u=Object.keys(n);for(o=0;o<u.length;o++){var c=u[o];cx(n[c],c,o,r,n,a,s)}}r.pop()}}function QQ(n){return n=typeof n<"u"?n:function(e,t){return t},function(e,t){if(Hf.length>0)for(var r=0;r<Hf.length;r++){var i=Hf[r];if(i[1]===e&&i[0]===t){t=i[2],Hf.splice(r,1);break}}return n.call(this,e,t)}}function kL(n){const e=G6(),t=yQ(),r=n.extra??{},i=r.metadata;return n.extra={...r,runtime:{...e,...r==null?void 0:r.runtime},metadata:{...t,...t.revision_id||n.revision_id?{revision_id:n.revision_id??t.revision_id}:{},...i}},n}const eee=n=>{const e=(n==null?void 0:n.toString())??ys("TRACING_SAMPLING_RATE");if(e===void 0)return;const t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},tee=n=>{const t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function nee(n){const e=[];for await(const t of n)e.push(t);return e}function sT(n){if(n!==void 0)return n.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const ree=async n=>{if((n==null?void 0:n.status)===429){const e=parseInt(n.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};function NL(n){return typeof n=="number"?Number(n.toFixed(4)):n}class iee{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;const r=new Promise(a=>{t=a}),i=ca(e.item,`Serializing run with id: ${e.item.id}`).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:r,size:i}),this.sizeBytes+=i,r}pop(e){var i;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const t=[];let r=0;for(;r+(((i=this.peek())==null?void 0:i.size)??0)<e&&this.items.length>0;){const a=this.items.shift();a&&(t.push(a),r+=a.size,this.sizeBytes-=a.size)}if(t.length===0&&this.items.length>0){const a=this.items.shift();t.push(a),r+=a.size,this.sizeBytes-=a.size}return[t.map(a=>({action:a.action,item:a.payload})),()=>t.forEach(a=>a.itemPromiseResolve())]}}const aee=20971520,see=2500;let Q6=class fx{constructor(e={}){var r;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new iee}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:Ql("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:Ql("LANGSMITH_DEBUG")==="true"});const t=fx.getDefaultClientConfig();if(this.tracingSampleRate=eee(e.tracingSamplingRate),this.apiUrl=sT(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=sT(e.apiKey??t.apiKey),this.webUrl=sT(e.webUrl??t.webUrl),(r=this.webUrl)!=null&&r.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new $$({...e.callerOptions??{},debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.batchIngestCaller=new $$({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:ree,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode}static getDefaultClientConfig(){const e=ys("API_KEY"),t=ys("ENDPOINT")??"https://api.smith.langchain.com",r=ys("HIDE_INPUTS")==="true",i=ys("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:i}}getHostUrl(){return this.webUrl?this.webUrl:tee(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${z6}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}async processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}async processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=await this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=await this.processOutputs(t.outputs)),t}async _getResponse(e,t){const r=(t==null?void 0:t.toString())??"",i=`${this.apiUrl}${e}?${r}`,a=await this.caller.call(mt(this.debug),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ut(a,`Failed to fetch ${e}`),a}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,r){let i=Number(t.get("offset"))||0;const a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(i)),t.set("limit",String(a));const s=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(mt(this.debug),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(o,`Failed to fetch ${e}`);const u=r?r(await o.json()):await o.json();if(u.length===0||(yield u,u.length<a))break;i+=u.length}}async*_getCursorPaginatedList(e,t=null,r="POST",i="runs"){const a=t?{...t}:{};for(;;){const o=await(await this.caller.call(mt(this.debug),`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(a)})).json();if(!o||!o[i])break;yield o[i];const u=o.cursors;if(!u||!u.next)break;a.cursor=u.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const r=[];for(const i of e)this.filteredPostUuids.has(i.id)?this.filteredPostUuids.delete(i.id):r.push(i);return r}else{const r=[];for(const i of e){const a=i.trace_id??i.id;this.filteredPostUuids.has(a)||(i.id===a?this._shouldSample()?r.push(i):this.filteredPostUuids.add(a):r.push(i))}return r}}async _getBatchSizeLimitBytes(){var t;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((t=e.batch_ingest_config)==null?void 0:t.size_limit_bytes)??aee}async _getMultiPartSupport(){var t;return((t=(await this._ensureServerInfo()).instance_flags)==null?void 0:t.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue(e){const t=[];for(;this.autoBatchQueue.items.length>0;){const[r,i]=this.autoBatchQueue.pop(e);if(!r.length){i();break}const a=this._processBatch(r,i).catch(console.error);t.push(a)}return Promise.all(t)}async _processBatch(e,t){var r;if(!e.length){t();return}try{const i={runCreates:e.filter(s=>s.action==="create").map(s=>s.item),runUpdates:e.filter(s=>s.action==="update").map(s=>s.item)},a=await this._ensureServerInfo();(r=a==null?void 0:a.batch_ingest_config)!=null&&r.use_multipart_endpoint?await this.multipartIngestRuns(i):await this.batchIngestRuns(i)}finally{t()}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=kL(e.item));const t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;const r=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>r&&this.drainAutoBatchQueue(r),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(r)},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){const e=await this.caller.call(mt(this.debug),`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(see),...this.fetchOptions});await Ut(e,"get server info");const t=await e.json();return this.debug&&console.log(`
=== LangSmith Server Configuration ===
`+JSON.stringify(t,null,2)+`
`),t}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[WARNING]: LangSmith failed to fetch info on supported operations with status code ${e.status}. Falling back to batch operations and default limits.`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;const i=await this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&i.trace_id!==void 0&&i.dotted_order!==void 0){this.processRunOperation({action:"create",item:i}).catch(console.error);return}const a=kL(i),s=await this.caller.call(mt(this.debug),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:ca(a,`Creating run with id: ${a.id}`),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(s,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let r=await Promise.all((e==null?void 0:e.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[]),i=await Promise.all((t==null?void 0:t.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[]);if(r.length>0&&i.length>0){const o=r.reduce((c,d)=>(d.id&&(c[d.id]=d),c),{}),u=[];for(const c of i)c.id!==void 0&&o[c.id]?o[c.id]={...o[c.id],...c}:u.push(c);r=Object.values(o),i=u}const a={post:r,patch:i};if(!a.post.length&&!a.patch.length)return;const s={post:[],patch:[]};for(const o of["post","patch"]){const u=o,c=a[u].reverse();let d=c.pop();for(;d!==void 0;)s[u].push(d),d=c.pop()}if(s.post.length>0||s.patch.length>0){const o=s.post.map(u=>u.id).concat(s.patch.map(u=>u.id)).join(",");await this._postBatchIngestRuns(ca(s,`Ingesting runs with ids: ${o}`))}}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call(mt(this.debug),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(r,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;const r={};let i=[];for(const d of e??[]){const h=await this.prepareRunCreateOrUpdateInputs(d);h.id!==void 0&&h.attachments!==void 0&&(r[h.id]=h.attachments),delete h.attachments,i.push(h)}let a=[];for(const d of t??[])a.push(await this.prepareRunCreateOrUpdateInputs(d));if(i.find(d=>d.trace_id===void 0||d.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(a.find(d=>d.trace_id===void 0||d.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(i.length>0&&a.length>0){const d=i.reduce((m,g)=>(g.id&&(m[g.id]=g),m),{}),h=[];for(const m of a)m.id!==void 0&&d[m.id]?d[m.id]={...d[m.id],...m}:h.push(m);i=Object.values(d),a=h}if(i.length===0&&a.length===0)return;const u=[],c=[];for(const[d,h]of[["post",i],["patch",a]])for(const m of h){const{inputs:g,outputs:_,events:w,attachments:S,...E}=m,C={inputs:g,outputs:_,events:w},A=ca(E,`Serializing for multipart ingestion of run with id: ${E.id}`);c.push({name:`${d}.${E.id}`,payload:new Blob([A],{type:`application/json; length=${A.length}`})});for(const[R,P]of Object.entries(C)){if(P===void 0)continue;const N=ca(P,`Serializing ${R} for multipart ingestion of run with id: ${E.id}`);c.push({name:`${d}.${E.id}.${R}`,payload:new Blob([N],{type:`application/json; length=${N.length}`})})}if(E.id!==void 0){const R=r[E.id];if(R){delete r[E.id];for(const[P,N]of Object.entries(R)){let U,k;if(Array.isArray(N)?[U,k]=N:(U=N.mimeType,k=N.data),P.includes(".")){console.warn(`Skipping attachment '${P}' for run ${E.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}c.push({name:`attachment.${E.id}.${P}`,payload:new Blob([k],{type:`${U}; length=${k.byteLength}`})})}}}u.push(`trace=${E.trace_id},id=${E.id}`)}await this._sendMultipartRequest(c,u.join("; "))}async _createNodeFetchBody(e,t){const r=[];for(const s of e)r.push(new Blob([`--${t}\r
`])),r.push(new Blob([`Content-Disposition: form-data; name="${s.name}"\r
`,`Content-Type: ${s.payload.type}\r
\r
`])),r.push(s.payload),r.push(new Blob([`\r
`]));return r.push(new Blob([`--${t}--\r
`])),await new Blob(r).arrayBuffer()}async _createMultipartStream(e,t){const r=new TextEncoder;return new ReadableStream({async start(a){const s=async o=>{typeof o=="string"?a.enqueue(r.encode(o)):a.enqueue(o)};for(const o of e){await s(`--${t}\r
`),await s(`Content-Disposition: form-data; name="${o.name}"\r
`),await s(`Content-Type: ${o.payload.type}\r
\r
`);const c=o.payload.stream().getReader();try{let d;for(;!(d=await c.read()).done;)a.enqueue(d.value)}finally{c.releaseLock()}await s(`\r
`)}await s(`--${t}--\r
`),a.close()}})}async _sendMultipartRequest(e,t){try{const r="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),i=await(wQ()?this._createNodeFetchBody(e,r):this._createMultipartStream(e,r)),a=await this.batchIngestCaller.call(mt(this.debug),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${r}`},body:i,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(a,"ingest multipart runs",!0)}catch(r){console.warn(`${r.message.trim()}

Context: ${t}`)}}async updateRun(e,t){Mt(e),t.inputs&&(t.inputs=await this.processInputs(t.inputs)),t.outputs&&(t.outputs=await this.processOutputs(t.outputs));const r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){if(t.end_time!==void 0&&r.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:r}).catch(console.error);return}else this.processRunOperation({action:"update",item:r}).catch(console.error);return}const i={...this.headers,"Content-Type":"application/json"},a=await this.caller.call(mt(this.debug),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:i,body:ca(t,`Serializing payload to update run with id: ${e}`),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(a,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){Mt(e);let r=await this._get(`/runs/${e}`);return t&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(t!==void 0){let i;t.session_id?i=t.session_id:r!=null&&r.projectName?i=(await this.readProject({projectName:r==null?void 0:r.projectName})).id:r!=null&&r.projectId?i=r==null?void 0:r.projectId:i=(await this.readProject({projectName:ys("PROJECT")||"default"})).id;const a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${i}/r/${t.id}?poll=true`}else if(e!==void 0){const i=await this.readRun(e);if(!i.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${i.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){var a;const t=await nee(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),r={},i={};t.sort((s,o)=>((s==null?void 0:s.dotted_order)??"").localeCompare((o==null?void 0:o.dotted_order)??""));for(const s of t){if(s.parent_run_id===null||s.parent_run_id===void 0)throw new Error(`Child run ${s.id} has no parent`);(a=s.dotted_order)!=null&&a.startsWith(e.dotted_order??"")&&s.id!==e.id&&(s.parent_run_id in r||(r[s.parent_run_id]=[]),r[s.parent_run_id].push(s),i[s.id]=s)}e.child_runs=r[e.id]||[];for(const s in r)s!==e.id&&(i[s].child_runs=r[s]);return e}async*listRuns(e){const{projectId:t,projectName:r,parentRunId:i,traceId:a,referenceExampleId:s,startTime:o,executionOrder:u,isRoot:c,runType:d,error:h,id:m,query:g,filter:_,traceFilter:w,treeFilter:S,limit:E,select:C,order:A}=e;let R=[];if(t&&(R=Array.isArray(t)?t:[t]),r){const k=Array.isArray(r)?r:[r],B=await Promise.all(k.map(H=>this.readProject({projectName:H}).then(G=>G.id)));R.push(...B)}const P=["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],N={session:R.length?R:null,run_type:d,reference_example:s,query:g,filter:_,trace_filter:w,tree_filter:S,execution_order:u,parent_run:i,start_time:o?o.toISOString():null,error:h,id:m,limit:E,trace:a,select:C||P,is_root:c,order:A};let U=0;for await(const k of this._getCursorPaginatedList("/runs/query",N))if(E){if(U>=E)break;if(k.length+U>E){yield*k.slice(0,E-U);break}U+=k.length,yield*k}else yield*k}async*listGroupRuns(e){const{projectId:t,projectName:r,groupBy:i,filter:a,startTime:s,endTime:o,limit:u,offset:c}=e,h={session_id:t||(await this.readProject({projectName:r})).id,group_by:i,filter:a,start_time:s?s.toISOString():null,end_time:o?o.toISOString():null,limit:Number(u)||100};let m=Number(c)||0;const g="/runs/group",_=`${this.apiUrl}${g}`;for(;;){const w={...h,offset:m},S=Object.fromEntries(Object.entries(w).filter(([P,N])=>N!==void 0)),E=await this.caller.call(mt(),_,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(S),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(E,`Failed to fetch ${g}`);const C=await E.json(),{groups:A,total:R}=C;if(A.length===0)break;for(const P of A)yield P;if(m+=A.length,m>=R)break}}async getRunStats({id:e,trace:t,parentRun:r,runType:i,projectNames:a,projectIds:s,referenceExampleIds:o,startTime:u,endTime:c,error:d,query:h,filter:m,traceFilter:g,treeFilter:_,isRoot:w,dataSourceType:S}){let E=s||[];a&&(E=[...s||[],...await Promise.all(a.map(N=>this.readProject({projectName:N}).then(U=>U.id)))]);const A=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:i,session:E,reference_example:o,start_time:u,end_time:c,error:d,query:h,filter:m,trace_filter:g,tree_filter:_,is_root:w,data_source_type:S}).filter(([N,U])=>U!==void 0));return await(await this.caller.call(mt(this.debug),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(A),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||Df()};Mt(e);const a=await(await this.caller.call(mt(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){Mt(e);const t=await this.caller.call(mt(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(t,"unshare run",!0)}async readRunSharedLink(e){Mt(e);const r=await(await this.caller.call(mt(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const r=new URLSearchParams({share_token:e});if(t!==void 0)for(const s of t)r.append("id",s);return Mt(e),await(await this.caller.call(mt(this.debug),`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),Mt(e);const i=await(await this.caller.call(mt(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const r={dataset_id:e};Mt(e);const a=await(await this.caller.call(mt(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){Mt(e);const t=await this.caller.call(mt(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(t,"unshare dataset",!0)}async readSharedDataset(e){return Mt(e),await(await this.caller.call(mt(this.debug),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,t){const r={};t!=null&&t.exampleIds&&(r.id=t.exampleIds);const i=new URLSearchParams;Object.entries(r).forEach(([o,u])=>{Array.isArray(u)?u.forEach(c=>i.append(o,c)):i.append(o,u)});const a=await this.caller.call(mt(this.debug),`${this.apiUrl}/public/${e}/examples?${i.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),s=await a.json();if(!a.ok)throw"detail"in s?new Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${Array.isArray(s.detail)?s.detail.join(`
`):"Unspecified error"}`):new Error(`Failed to list shared examples: ${a.status} ${a.statusText}`);return s.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:i=!1,projectExtra:a=null,referenceDatasetId:s=null}){const o=i?"?upsert=true":"",u=`${this.apiUrl}/sessions${o}`,c=a||{};r&&(c.metadata=r);const d={name:e,extra:c,description:t};s!==null&&(d.reference_dataset_id=s);const h=await this.caller.call(mt(this.debug),u,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(d),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ut(h,"create project"),await h.json()}async updateProject(e,{name:t=null,description:r=null,metadata:i=null,projectExtra:a=null,endTime:s=null}){const o=`${this.apiUrl}/sessions/${e}`;let u=a;i&&(u={...u||{},metadata:i});const c={name:t,extra:u,description:r,end_time:s?new Date(s).toISOString():null},d=await this.caller.call(mt(this.debug),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ut(d,"update project"),await d.json()}async hasProject({projectId:e,projectName:t}){let r="/sessions";const i=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Mt(e),r+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide projectName or projectId");const a=await this.caller.call(mt(this.debug),`${this.apiUrl}${r}?${i}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const s=await a.json();return a.ok?Array.isArray(s)?s.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let i="/sessions";const a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Mt(e),i+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");r!==void 0&&a.append("include_stats",r.toString());const s=await this._get(i,a);let o;if(Array.isArray(s)){if(s.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=s[0]}else o=s;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");const r=await this.readProject({projectId:e,projectName:t}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");const r=await this.readDataset({datasetId:e,datasetName:t}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:i,referenceDatasetName:a,referenceFree:s,metadata:o}={}){const u=new URLSearchParams;if(e!==void 0)for(const c of e)u.append("id",c);if(t!==void 0&&u.append("name",t),r!==void 0&&u.append("name_contains",r),i!==void 0)u.append("reference_dataset",i);else if(a!==void 0){const c=await this.readDataset({datasetName:a});u.append("reference_dataset",c.id)}s!==void 0&&u.append("reference_free",s.toString()),o!==void 0&&u.append("metadata",JSON.stringify(o));for await(const c of this._getPaginated("/sessions",u))yield*c}async deleteProject({projectId:e,projectName:t}){let r;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:t})).id:r=e,Mt(r);const i=await this.caller.call(mt(this.debug),`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(i,`delete session ${r} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:i,description:a,dataType:s,name:o}){const u=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",e,t),r.forEach(m=>{c.append("input_keys",m)}),i.forEach(m=>{c.append("output_keys",m)}),a&&c.append("description",a),s&&c.append("data_type",s),o&&c.append("name",o);const d=await this.caller.call(mt(this.debug),u,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ut(d,"upload CSV"),await d.json()}async createDataset(e,{description:t,dataType:r,inputsSchema:i,outputsSchema:a,metadata:s}={}){const o={name:e,description:t,extra:s?{metadata:s}:void 0};r&&(o.data_type=r),i&&(o.inputs_schema_definition=i),a&&(o.outputs_schema_definition=a);const u=await this.caller.call(mt(this.debug),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ut(u,"create dataset"),await u.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const i=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)Mt(e),r+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide datasetName or datasetId");const a=await this._get(r,i);let s;if(Array.isArray(a)){if(a.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);s=a[0]}else s=a;return s}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:i}){let a=e;if(a===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:t})).id);const s=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof i=="string"?i:i.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,s)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const r="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:i,datasetNameContains:a,metadata:s}={}){const o="/datasets",u=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(r!==void 0)for(const c of r)u.append("id",c);i!==void 0&&u.append("name",i),a!==void 0&&u.append("name_contains",a),s!==void 0&&u.append("metadata",JSON.stringify(s));for await(const c of this._getPaginated(o,u))yield*c}async updateDataset(e){const{datasetId:t,datasetName:r,...i}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");const a=t??(await this.readDataset({datasetName:r})).id;Mt(a);const s=await this.caller.call(mt(this.debug),`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ut(s,"update dataset"),await s.json()}async updateDatasetTag(e){const{datasetId:t,datasetName:r,asOf:i,tag:a}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");const s=t??(await this.readDataset({datasetName:r})).id;Mt(s);const o=await this.caller.call(mt(this.debug),`${this.apiUrl}/datasets/${s}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:typeof i=="string"?i:i.toISOString(),tag:a}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(o,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",i=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(i=(await this.readDataset({datasetName:t})).id),i!==void 0)Mt(i),r+=`/${i}`;else throw new Error("Must provide datasetName or datasetId");const a=await this.caller.call(mt(this.debug),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(a,`delete ${r}`),await a.json()}async indexDataset({datasetId:e,datasetName:t,tag:r}){let i=e;if(!i&&!t)throw new Error("Must provide either datasetName or datasetId");if(i&&t)throw new Error("Must provide either datasetName or datasetId, not both");i||(i=(await this.readDataset({datasetName:t})).id),Mt(i);const a={tag:r},s=await this.caller.call(mt(this.debug),`${this.apiUrl}/datasets/${i}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(s,"index dataset"),await s.json()}async similarExamples(e,t,r,{filter:i}={}){const a={limit:r,inputs:e};i!==void 0&&(a.filter=i),Mt(t);const s=await this.caller.call(mt(this.debug),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ut(s,"fetch similar examples"),(await s.json()).examples}async createExample(e,t,r){var d;if(ML(e)&&(t!==void 0||r!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let i=t?r==null?void 0:r.datasetId:e.dataset_id;const a=t?r==null?void 0:r.datasetName:e.dataset_name;if(i===void 0&&a===void 0)throw new Error("Must provide either datasetName or datasetId");if(i!==void 0&&a!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");i===void 0&&(i=(await this.readDataset({datasetName:a})).id);const s=(t?r==null?void 0:r.createdAt:e.created_at)||new Date;let o;ML(e)?o=e:o={inputs:e,outputs:t,created_at:s==null?void 0:s.toISOString(),id:r==null?void 0:r.exampleId,metadata:r==null?void 0:r.metadata,split:r==null?void 0:r.split,source_run_id:r==null?void 0:r.sourceRunId,use_source_run_io:r==null?void 0:r.useSourceRunIO,use_source_run_attachments:r==null?void 0:r.useSourceRunAttachments,attachments:r==null?void 0:r.attachments};const u=await this._uploadExamplesMultipart(i,[o]);return await this.readExample(((d=u.example_ids)==null?void 0:d[0])??Df())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];const C=e;let A=C[0].dataset_id;const R=C[0].dataset_name;if(A===void 0&&R===void 0)throw new Error("Must provide either datasetName or datasetId");if(A!==void 0&&R!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");A===void 0&&(A=(await this.readDataset({datasetName:R})).id);const P=await this._uploadExamplesMultipart(A,C);return await Promise.all(P.example_ids.map(U=>this.readExample(U)))}const{inputs:t,outputs:r,metadata:i,splits:a,sourceRunIds:s,useSourceRunIOs:o,useSourceRunAttachments:u,attachments:c,exampleIds:d,datasetId:h,datasetName:m}=e;if(t===void 0)throw new Error("Must provide inputs when using legacy parameters");let g=h;const _=m;if(g===void 0&&_===void 0)throw new Error("Must provide either datasetName or datasetId");if(g!==void 0&&_!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");g===void 0&&(g=(await this.readDataset({datasetName:_})).id);const w=t.map((C,A)=>({dataset_id:g,inputs:C,outputs:r==null?void 0:r[A],metadata:i==null?void 0:i[A],split:a==null?void 0:a[A],id:d==null?void 0:d[A],attachments:c==null?void 0:c[A],source_run_id:s==null?void 0:s[A],use_source_run_io:o==null?void 0:o[A],use_source_run_attachments:u==null?void 0:u[A]})),S=await this._uploadExamplesMultipart(g,w);return await Promise.all(S.example_ids.map(C=>this.readExample(C)))}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){const i=e.map(s=>L$(s)?U$(s):s),a=L$(t)?U$(t):t;return this.createExample({input:i},{output:a},r)}async readExample(e){Mt(e);const t=`/examples/${e}`,r=await this._get(t),{attachment_urls:i,...a}=r,s=a;return i&&(s.attachments=Object.entries(i).reduce((o,[u,c])=>(o[u.slice(11)]={presigned_url:c.presigned_url,mime_type:c.mime_type},o),{})),s}async*listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:i,splits:a,inlineS3Urls:s,metadata:o,limit:u,offset:c,filter:d,includeAttachments:h}={}){let m;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)m=e;else if(t!==void 0)m=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const g=new URLSearchParams({dataset:m}),_=i?typeof i=="string"?i:i==null?void 0:i.toISOString():void 0;_&&g.append("as_of",_);const w=s??!0;if(g.append("inline_s3_urls",w.toString()),r!==void 0)for(const E of r)g.append("id",E);if(a!==void 0)for(const E of a)g.append("splits",E);if(o!==void 0){const E=JSON.stringify(o);g.append("metadata",E)}u!==void 0&&g.append("limit",u.toString()),c!==void 0&&g.append("offset",c.toString()),d!==void 0&&g.append("filter",d),h===!0&&["attachment_urls","outputs","metadata"].forEach(E=>g.append("select",E));let S=0;for await(const E of this._getPaginated("/examples",g)){for(const C of E){const{attachment_urls:A,...R}=C,P=R;A&&(P.attachments=Object.entries(A).reduce((N,[U,k])=>(N[U.slice(11)]={presigned_url:k.presigned_url,mime_type:k.mime_type||void 0},N),{})),yield P,S++}if(u!==void 0&&S>=u)break}}async deleteExample(e){Mt(e);const t=`/examples/${e}`,r=await this.caller.call(mt(this.debug),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(r,`delete ${t}`),await r.json()}async updateExample(e,t){let r;t?r=e:r=e.id,Mt(r);let i;t?i={id:r,...t}:i=e;let a;return i.dataset_id!==void 0?a=i.dataset_id:a=(await this.readExample(r)).dataset_id,this._updateExamplesMultipart(a,[i])}async updateExamples(e){let t;return e[0].dataset_id===void 0?t=(await this.readExample(e[0].id)).dataset_id:t=e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:r,tag:i}){let a;if(e?a=e:a=(await this.readDataset({datasetName:t})).id,Mt(a),r&&i||!r&&!i)throw new Error("Exactly one of asOf and tag must be specified.");const s=new URLSearchParams;r!==void 0&&s.append("as_of",typeof r=="string"?r:r.toISOString()),i!==void 0&&s.append("tag",i);const o=await this.caller.call(mt(this.debug),`${this.apiUrl}/datasets/${a}/version?${s.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ut(o,"read dataset version"),await o.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let i;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:t})).id:i=e,Mt(i);const a=new URLSearchParams,s=r?typeof r=="string"?r:r==null?void 0:r.toISOString():void 0;return s&&a.append("as_of",s),await this._get(`/datasets/${i}/splits`,a)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:i,remove:a=!1}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:t})).id:s=e,Mt(s);const o={split_name:r,examples:i.map(c=>(Mt(c),c)),remove:a},u=await this.caller.call(mt(this.debug),`${this.apiUrl}/datasets/${s}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(u,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:i,referenceExample:a}={loadChildRuns:!1}){K6("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let s;if(typeof e=="string")s=await this.readRun(e,{loadChildRuns:i});else if(typeof e=="object"&&"id"in e)s=e;else throw new Error(`Invalid run type: ${typeof e}`);s.reference_example_id!==null&&s.reference_example_id!==void 0&&(a=await this.readExample(s.reference_example_id));const o=await t.evaluateRun(s,a),[u,c]=await this._logEvaluationFeedback(o,s,r);return c[0]}async createFeedback(e,t,{score:r,value:i,correction:a,comment:s,sourceInfo:o,feedbackSourceType:u="api",sourceRunId:c,feedbackId:d,feedbackConfig:h,projectId:m,comparativeExperimentId:g}){var C;if(!e&&!m)throw new Error("One of runId or projectId must be provided");if(e&&m)throw new Error("Only one of runId or projectId can be provided");const _={type:u??"api",metadata:o??{}};c!==void 0&&(_==null?void 0:_.metadata)!==void 0&&!_.metadata.__run&&(_.metadata.__run={run_id:c}),(_==null?void 0:_.metadata)!==void 0&&((C=_.metadata.__run)==null?void 0:C.run_id)!==void 0&&Mt(_.metadata.__run.run_id);const w={id:d??Df(),run_id:e,key:t,score:NL(r),value:i,correction:a,comment:s,feedback_source:_,comparative_experiment_id:g,feedbackConfig:h,session_id:m},S=`${this.apiUrl}/feedback`,E=await this.caller.call(mt(this.debug),S,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(w),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ut(E,"create feedback",!0),w}async updateFeedback(e,{score:t,value:r,correction:i,comment:a}){const s={};t!=null&&(s.score=NL(t)),r!=null&&(s.value=r),i!=null&&(s.correction=i),a!=null&&(s.comment=a),Mt(e);const o=await this.caller.call(mt(this.debug),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(o,"update feedback",!0)}async readFeedback(e){Mt(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){Mt(e);const t=`/feedback/${e}`,r=await this.caller.call(mt(this.debug),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(r,`delete ${t}`),await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){const i=new URLSearchParams;if(e&&i.append("run",e.join(",")),t)for(const a of t)i.append("key",a);if(r)for(const a of r)i.append("source",a);for await(const a of this._getPaginated("/feedback",i))yield*a}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:i}={}){const a={run_id:e,feedback_key:t,feedback_config:i};return r?typeof r=="string"?a.expires_at=r:(r!=null&&r.hours||r!=null&&r.minutes||r!=null&&r.days)&&(a.expires_in=r):a.expires_in={hours:3},await(await this.caller.call(mt(this.debug),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:i,description:a,metadata:s,id:o}){var d;if(t.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");const u={id:o,name:e,experiment_ids:t,reference_dataset_id:r,description:a,created_at:(d=i??new Date)==null?void 0:d.toISOString(),extra:{}};return s&&(u.extra.metadata=s),await(await this.caller.call(mt(this.debug),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){Mt(e);const t=new URLSearchParams({run_id:e});for await(const r of this._getPaginated("/feedback/tokens",t))yield*r}_selectEvalResults(e){let t;return"results"in e?t=e.results:Array.isArray(e)?t=e:t=[e],t}async _logEvaluationFeedback(e,t,r){const i=this._selectEvalResults(e),a=[];for(const s of i){let o=r||{};s.evaluatorInfo&&(o={...s.evaluatorInfo,...o});let u=null;s.targetRunId?u=s.targetRunId:t&&(u=t.id),a.push(await this.createFeedback(u,s.key,{score:s.score,value:s.value,comment:s.comment,correction:s.correction,sourceInfo:o,sourceRunId:s.sourceRunId,feedbackConfig:s.feedbackConfig,feedbackSourceType:"model"}))}return[i,a]}async logEvaluationFeedback(e,t,r){const[i]=await this._logEvaluationFeedback(e,t,r);return i}async*listAnnotationQueues(e={}){const{queueIds:t,name:r,nameContains:i,limit:a}=e,s=new URLSearchParams;t&&t.forEach((u,c)=>{Mt(u,`queueIds[${c}]`),s.append("ids",u)}),r&&s.append("name",r),i&&s.append("name_contains",i),s.append("limit",(a!==void 0?Math.min(a,100):100).toString());let o=0;for await(const u of this._getPaginated("/annotation-queues",s))if(yield*u,o++,a!==void 0&&o>=a)break}async createAnnotationQueue(e){const{name:t,description:r,queueId:i,rubricInstructions:a}=e,s={name:t,description:r,id:i||Df(),rubric_instructions:a},o=await this.caller.call(mt(this.debug),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(s).filter(([c,d])=>d!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ut(o,"create annotation queue"),await o.json()}async readAnnotationQueue(e){const t=await this.caller.call(mt(this.debug),`${this.apiUrl}/annotation-queues/${Mt(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ut(t,"read annotation queue"),await t.json()}async updateAnnotationQueue(e,t){const{name:r,description:i,rubricInstructions:a}=t,s=await this.caller.call(mt(this.debug),`${this.apiUrl}/annotation-queues/${Mt(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:i,rubric_instructions:a}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(s,"update annotation queue")}async deleteAnnotationQueue(e){const t=await this.caller.call(mt(this.debug),`${this.apiUrl}/annotation-queues/${Mt(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){const r=await this.caller.call(mt(this.debug),`${this.apiUrl}/annotation-queues/${Mt(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((i,a)=>Mt(i,`runIds[${a}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(r,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){const r=`/annotation-queues/${Mt(e,"queueId")}/run`,i=await this.caller.call(mt(this.debug),`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ut(i,"get run from annotation queue"),await i.json()}async deleteRunFromAnnotationQueue(e,t){const r=await this.caller.call(mt(this.debug),`${this.apiUrl}/annotation-queues/${Mt(e,"queueId")}/runs/${Mt(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(r,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){const t=await this.caller.call(mt(this.debug),`${this.apiUrl}/annotation-queues/${Mt(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ut(t,"get size from annotation queue"),await t.json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){const r=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const t=await this.caller.call(mt(this.debug),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();if(!t.ok){const i=typeof r.detail=="string"?r.detail:JSON.stringify(r.detail),a=new Error(`Error ${t.status}: ${t.statusText}
${i}`);throw a.statusCode=t.status,a}if(r.commits.length!==0)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[r,i,a]=Ol(e),s=await this.caller.call(mt(this.debug),`${this.apiUrl}/likes/${r}/${i}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ut(s,`${t?"like":"unlike"} prompt`),await s.json()}async _getPromptUrl(e){const[t,r,i]=Ol(e);if(await this._currentTenantIsOwner(t)){const a=await this._getSettings();return i!=="latest"?`${this.getHostUrl()}/prompts/${r}/${i.substring(0,8)}?organizationId=${a.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${a.id}`}else return i!=="latest"?`${this.getHostUrl()}/hub/${t}/${r}/${i.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,r=>r.commits))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&t.append("is_public",e.isPublic.toString()),e!=null&&e.query&&t.append("query",e.query);for await(const r of this._getPaginated("/repos",t,i=>i.repos))yield*r}async getPrompt(e){const[t,r,i]=Ol(e),a=await this.caller.call(mt(this.debug),`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(a.status===404)return null;await Ut(a,"get prompt");const s=await a.json();return s.repo?s.repo:null}async createPrompt(e,t){const r=await this._getSettings();if(t!=null&&t.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[i,a,s]=Ol(e);if(!await this._currentTenantIsOwner(i))throw await this._ownerConflictError("create a prompt",i);const o={repo_handle:a,...(t==null?void 0:t.description)&&{description:t.description},...(t==null?void 0:t.readme)&&{readme:t.readme},...(t==null?void 0:t.tags)&&{tags:t.tags},is_public:!!(t!=null&&t.isPublic)},u=await this.caller.call(mt(this.debug),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(u,"create prompt");const{repo:c}=await u.json();return c}async createCommit(e,t,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[i,a,s]=Ol(e),o=(r==null?void 0:r.parentCommitHash)==="latest"||!(r!=null&&r.parentCommitHash)?await this._getLatestCommitHash(`${i}/${a}`):r==null?void 0:r.parentCommitHash,u={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},c=await this.caller.call(mt(this.debug),`${this.apiUrl}/commits/${i}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(c,"create commit");const d=await c.json();return this._getPromptUrl(`${i}/${a}${d.commit_hash?`:${d.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){var o;if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const r=new FormData;for(const u of t){const c=u.id,d={...u.metadata&&{metadata:u.metadata},...u.split&&{split:u.split}},h=ca(d,`Serializing body for example with id: ${c}`),m=new Blob([h],{type:"application/json"});if(r.append(c,m),u.inputs){const g=ca(u.inputs,`Serializing inputs for example with id: ${c}`),_=new Blob([g],{type:"application/json"});r.append(`${c}.inputs`,_)}if(u.outputs){const g=ca(u.outputs,`Serializing outputs whle updating example with id: ${c}`),_=new Blob([g],{type:"application/json"});r.append(`${c}.outputs`,_)}if(u.attachments)for(const[g,_]of Object.entries(u.attachments)){let w,S;Array.isArray(_)?[w,S]=_:(w=_.mimeType,S=_.data);const E=new Blob([S],{type:`${w}; length=${S.byteLength}`});r.append(`${c}.attachment.${g}`,E)}if(u.attachments_operations){const g=ca(u.attachments_operations,`Serializing attachments while updating example with id: ${c}`),_=new Blob([g],{type:"application/json"});r.append(`${c}.attachments_operations`,_)}}const i=e??((o=t[0])==null?void 0:o.dataset_id);return await(await this.caller.call(mt(this.debug),`${this.apiUrl}/v1/platform/datasets/${i}/examples`,{method:"PATCH",headers:this.headers,body:r})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const r=new FormData;for(const s of t){const o=(s.id??Df()).toString(),u={created_at:s.created_at,...s.metadata&&{metadata:s.metadata},...s.split&&{split:s.split},...s.source_run_id&&{source_run_id:s.source_run_id},...s.use_source_run_io&&{use_source_run_io:s.use_source_run_io},...s.use_source_run_attachments&&{use_source_run_attachments:s.use_source_run_attachments}},c=ca(u,`Serializing body for uploaded example with id: ${o}`),d=new Blob([c],{type:"application/json"});if(r.append(o,d),s.inputs){const h=ca(s.inputs,`Serializing inputs for uploaded example with id: ${o}`),m=new Blob([h],{type:"application/json"});r.append(`${o}.inputs`,m)}if(s.outputs){const h=ca(s.outputs,`Serializing outputs for uploaded example with id: ${o}`),m=new Blob([h],{type:"application/json"});r.append(`${o}.outputs`,m)}if(s.attachments)for(const[h,m]of Object.entries(s.attachments)){let g,_;Array.isArray(m)?[g,_]=m:(g=m.mimeType,_=m.data);const w=new Blob([_],{type:`${g}; length=${_.byteLength}`});r.append(`${o}.attachment.${h}`,w)}}const i=await this.caller.call(mt(this.debug),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"POST",headers:this.headers,body:r});return await Ut(i,"upload examples"),await i.json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,i]=Ol(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);const a={};if((t==null?void 0:t.description)!==void 0&&(a.description=t.description),(t==null?void 0:t.readme)!==void 0&&(a.readme=t.readme),(t==null?void 0:t.tags)!==void 0&&(a.tags=t.tags),(t==null?void 0:t.isPublic)!==void 0&&(a.is_public=t.isPublic),(t==null?void 0:t.isArchived)!==void 0&&(a.is_archived=t.isArchived),Object.keys(a).length===0)throw new Error("No valid update options provided");const s=await this.caller.call(mt(this.debug),`${this.apiUrl}/repos/${r}/${i}`,{method:"PATCH",body:JSON.stringify(a),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await Ut(s,"update prompt"),s.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,r,i]=Ol(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return await(await this.caller.call(mt(this.debug),`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,t){const[r,i,a]=Ol(e),s=await this.caller.call(mt(this.debug),`${this.apiUrl}/commits/${r}/${i}/${a}${t!=null&&t.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await Ut(s,"pull prompt commit");const o=await s.json();return{owner:r,repo:i,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,t){const r=await this.pullPromptCommit(e,{includeModel:t==null?void 0:t.includeModel});return JSON.stringify(r.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(i=>i!=="object")&&await this.updatePrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}):await this.createPrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}),t!=null&&t.object?await this.createCommit(e,t==null?void 0:t.object,{parentCommitHash:t==null?void 0:t.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){const{sourceApiUrl:r=this.apiUrl,datasetName:i}=t,[a,s]=this.parseTokenOrUrl(e,r),o=new fx({apiUrl:a,apiKey:"placeholder"}),u=await o.readSharedDataset(s),c=i||u.name;try{if(await this.hasDataset({datasetId:c})){console.log(`Dataset ${c} already exists in your tenant. Skipping.`);return}}catch{}const d=await o.listSharedExamples(s),h=await this.createDataset(c,{description:u.description,dataType:u.data_type||"kv",inputsSchema:u.inputs_schema_definition??void 0,outputsSchema:u.outputs_schema_definition??void 0});try{await this.createExamples({inputs:d.map(m=>m.inputs),outputs:d.flatMap(m=>m.outputs?[m.outputs]:[]),datasetId:h.id})}catch(m){throw console.error(`An error occurred while creating dataset ${c}. You should delete it manually.`),m}}parseTokenOrUrl(e,t,r=2,i="dataset"){try{return Mt(e),[t,e]}catch{}try{const s=new URL(e).pathname.split("/").filter(o=>o!=="");if(s.length>=r){const o=s[s.length-r];return[t,o]}else throw new Error(`Invalid public ${i} URL: ${e}`)}catch{throw new Error(`Invalid public ${i} URL or token: ${e}`)}}awaitPendingTraceBatches(){return this.manualFlushMode?(console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve()):Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()])}};function ML(n){return"dataset_id"in n||"dataset_name"in n}const oee=n=>!!["TRACING_V2","TRACING"].find(t=>ys(t)==="true"),oT=Symbol.for("lc:context_variables");function lee(n){return n.replace(/[-:.]/g,"")}function uee(n,e,t=1){const r=t.toFixed(0).slice(0,3).padStart(3,"0");return lee(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}class P_{constructor(e,t,r,i){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=r,this.replicas=i}static fromHeader(e){const t=e.split(",");let r={},i=[],a,s;for(const o of t){const[u,c]=o.split("="),d=decodeURIComponent(c);u==="langsmith-metadata"?r=JSON.parse(d):u==="langsmith-tags"?i=d.split(","):u==="langsmith-project"?a=d:u==="langsmith-replicas"&&(s=JSON.parse(d))}return new P_(r,i,a,s)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class Mi{constructor(e){var o;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e5(e)){Object.assign(this,{...e});return}const t=Mi.getDefaultConfig(),{metadata:r,...i}=e,a=i.client??Mi.getSharedClient(),s={...r,...(o=i==null?void 0:i.extra)==null?void 0:o.metadata};if(i.extra={...i.extra,metadata:s},Object.assign(this,{...t,...i,client:a}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const u=uee(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+u:this.dotted_order=u}}set metadata(e){var t;this.extra={...this.extra,metadata:{...(t=this.extra)==null?void 0:t.metadata,...e}}}get metadata(){var e;return(e=this.extra)==null?void 0:e.metadata}static getDefaultConfig(){return{id:Df(),run_type:"chain",project_name:V6(),child_runs:[],api_url:Ql("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:Ql("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return Mi.sharedClient||(Mi.sharedClient=new Q6),Mi.sharedClient}createChild(e){var u,c,d,h,m,g;const t=this.child_execution_order+1,r=new Mi({...e,parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});oT in this&&(r[oT]=this[oT]);const i=Symbol.for("lc:child_config"),a=((u=e.extra)==null?void 0:u[i])??this.extra[i];if(fee(a)){const _={...a},w=cee(_.callbacks)?(d=(c=_.callbacks).copy)==null?void 0:d.call(c):void 0;w&&(Object.assign(w,{_parentRunId:r.id}),(g=(m=(h=w.handlers)==null?void 0:h.find(t5))==null?void 0:m.updateFromRunTree)==null||g.call(m,r),_.callbacks=w),r.extra[i]=_}const s=new Set;let o=this;for(;o!=null&&!s.has(o.id);)s.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(r),r}async end(e,t,r=Date.now(),i){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r,i&&Object.keys(i).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...i}}:{metadata:i})}_convertToCreate(e,t,r=!0){var o,u;const i=e.extra??{};if(((o=i==null?void 0:i.runtime)==null?void 0:o.library)===void 0&&(i.runtime||(i.runtime={}),t))for(const[c,d]of Object.entries(t))i.runtime[c]||(i.runtime[c]=d);let a,s;return r?(s=(u=e.parent_run)==null?void 0:u.id,a=[]):(a=e.child_runs.map(c=>this._convertToCreate(c,t,r)),s=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:i,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:a,parent_run_id:s,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_remapForProject(e,t,r=!0){const i=this._convertToCreate(this,t,r);if(e===this.project_name)return i;const a=h=>I$(`${h}:${e}`,I$.DNS),s=a(i.id),o=i.trace_id?a(i.trace_id):void 0,u=i.parent_run_id?a(i.parent_run_id):void 0;let c;if(i.dotted_order){const h=dee(i.dotted_order),m=[];for(let _=0;_<h.length-1;_++){const[w,S]=h[_],E=a(S);m.push(w.toISOString().replace(/[-:]/g,"").replace(".","")+E)}const[g]=h[h.length-1];m.push(g.toISOString().replace(/[-:]/g,"").replace(".","")+s),c=m.join(".")}else c=void 0;return{...i,id:s,trace_id:o,parent_run_id:u,dotted_order:c,session_name:e}}async postRun(e=!0){try{const t=G6();if(this.replicas&&this.replicas.length>0)for(const[r]of this.replicas){const i=this._remapForProject(r,t,!0);await this.client.createRun(i)}else{const r=this._convertToCreate(this,t,e);await this.client.createRun(r)}if(!e){K6("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const r of this.child_runs)await r.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(){var e;if(this.replicas&&this.replicas.length>0)for(const[t,r]of this.replicas){const i=this._remapForProject(t);await this.client.updateRun(i.id,{inputs:i.inputs,outputs:i.outputs,error:i.error,parent_run_id:i.parent_run_id,session_name:i.session_name,reference_example_id:i.reference_example_id,end_time:i.end_time,dotted_order:i.dotted_order,trace_id:i.trace_id,events:i.events,tags:i.tags,extra:i.extra,attachments:this.attachments,...r})}else try{const t={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(e=this.parent_run)==null?void 0:e.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};await this.client.updateRun(this.id,t)}catch(t){console.error(`Error in patchRun for run ${this.id}`,t)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){var c,d,h,m;const r=e==null?void 0:e.callbacks;let i,a,s,o=oee();if(r){const g=((c=r==null?void 0:r.getParentRunId)==null?void 0:c.call(r))??"",_=(d=r==null?void 0:r.handlers)==null?void 0:d.find(w=>(w==null?void 0:w.name)=="langchain_tracer");i=(h=_==null?void 0:_.getRun)==null?void 0:h.call(_,g),a=_==null?void 0:_.projectName,s=_==null?void 0:_.client,o=o||!!_}return i?new Mi({name:i.name,id:i.id,trace_id:i.trace_id,dotted_order:i.dotted_order,client:s,tracingEnabled:o,project_name:a,tags:[...new Set(((i==null?void 0:i.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(m=i==null?void 0:i.extra)==null?void 0:m.metadata,...e==null?void 0:e.metadata}}}).createChild(t):new Mi({...t,client:s,tracingEnabled:o,project_name:a})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){var c;const r="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,i=r["langsmith-trace"];if(!i||typeof i!="string")return;const a=i.trim(),s=a.split(".").map(d=>{const[h,m]=d.split("Z");return{strTime:h,time:Date.parse(h+"Z"),uuid:m}}),o=s[0].uuid,u={...t,name:(t==null?void 0:t.name)??"parent",run_type:(t==null?void 0:t.run_type)??"chain",start_time:(t==null?void 0:t.start_time)??Date.now(),id:(c=s.at(-1))==null?void 0:c.uuid,trace_id:o,dotted_order:a};if(r.baggage&&typeof r.baggage=="string"){const d=P_.fromHeader(r.baggage);u.metadata=d.metadata,u.tags=d.tags,u.project_name=d.project_name,u.replicas=d.replicas}return new Mi(u)}toHeaders(e){var r;const t={"langsmith-trace":this.dotted_order,baggage:new P_((r=this.extra)==null?void 0:r.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(const[i,a]of Object.entries(t))e.set(i,a);return t}}Object.defineProperty(Mi,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function e5(n){return n!==void 0&&typeof n.createChild=="function"&&typeof n.postRun=="function"}function t5(n){return typeof n=="object"&&n!=null&&typeof n.name=="string"&&n.name==="langchain_tracer"}function DL(n){return Array.isArray(n)&&n.some(e=>t5(e))}function cee(n){return typeof n=="object"&&n!=null&&Array.isArray(n.handlers)}function fee(n){var e;return n!==void 0&&typeof n.callbacks=="object"&&(DL((e=n.callbacks)==null?void 0:e.handlers)||DL(n.callbacks))}function dee(n){return n.split(".").map(t=>{const r=t.slice(0,-36),i=t.slice(-36),a=parseInt(r.slice(0,4)),s=parseInt(r.slice(4,6))-1,o=parseInt(r.slice(6,8)),u=parseInt(r.slice(9,11)),c=parseInt(r.slice(11,13)),d=parseInt(r.slice(13,15)),h=parseInt(r.slice(15,21));return[new Date(a,s,o,u,c,d,h/1e3),i]})}let hee=class{getStore(){}run(e,t){return t()}};const lT=Symbol.for("ls:tracing_async_local_storage"),pee=new hee;let mee=class{getInstance(){return globalThis[lT]??pee}initializeGlobalInstance(e){globalThis[lT]===void 0&&(globalThis[lT]=e)}};const gee=new mee;function yee(n=!1){const e=gee.getInstance().getStore();if(!n&&!e5(e))throw new Error(`Could not get the current run tree.

Please make sure you are calling this method within a traceable function and that tracing is enabled.`);return e}function _I(n){return typeof n=="function"&&"langsmith:traceable"in n}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const vee=Object.prototype.hasOwnProperty;function dx(n,e){return vee.call(n,e)}function hx(n){if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(n);let e=[];for(let t in n)dx(n,t)&&e.push(t);return e}function to(n){switch(typeof n){case"object":return JSON.parse(JSON.stringify(n));case"undefined":return null;default:return n}}function px(n){let e=0;const t=n.length;let r;for(;e<t;){if(r=n.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function Ef(n){return n.indexOf("/")===-1&&n.indexOf("~")===-1?n:n.replace(/~/g,"~0").replace(/\//g,"~1")}function _ee(n){return n.replace(/~1/g,"/").replace(/~0/g,"~")}function mx(n){if(n===void 0)return!0;if(n){if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(mx(n[t]))return!0}else if(typeof n=="object"){const t=hx(n),r=t.length;for(var e=0;e<r;e++)if(mx(n[t[e]]))return!0}}return!1}function $L(n,e){const t=[n];for(const r in e){const i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&t.push(`${r}: ${i}`)}return t.join(`
`)}class bee extends Error{constructor(e,t,r,i,a){super($L(e,{name:t,index:r,operation:i,tree:a})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.setPrototypeOf(this,new.target.prototype),this.message=$L(e,{name:t,index:r,operation:i,tree:a})}}const or=bee,Gf={add:function(n,e,t){return n[e]=this.value,{newDocument:t}},remove:function(n,e,t){var r=n[e];return delete n[e],{newDocument:t,removed:r}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:function(n,e,t){let r=gx(t,this.path);r&&(r=to(r));const i=Vp(t,{op:"remove",path:this.from}).removed;return Vp(t,{op:"add",path:this.path,value:i}),{newDocument:t,removed:r}},copy:function(n,e,t){const r=gx(t,this.from);return Vp(t,{op:"add",path:this.path,value:to(r)}),{newDocument:t}},test:function(n,e,t){return{newDocument:t,test:O_(n[e],this.value)}},_get:function(n,e,t){return this.value=n[e],{newDocument:t}}};var wee={add:function(n,e,t){return px(e)?n.splice(e,0,this.value):n[e]=this.value,{newDocument:t,index:e}},remove:function(n,e,t){var r=n.splice(e,1);return{newDocument:t,removed:r[0]}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:Gf.move,copy:Gf.copy,test:Gf.test,_get:Gf._get};function gx(n,e){if(e=="")return n;var t={op:"_get",path:e};return Vp(n,t),t.value}function Vp(n,e,t=!1,r=!0,i=!0,a=0){if(t&&(typeof t=="function"?t(e,0,n,e.path):yx(e,0)),e.path===""){let s={newDocument:n};if(e.op==="add")return s.newDocument=e.value,s;if(e.op==="replace")return s.newDocument=e.value,s.removed=n,s;if(e.op==="move"||e.op==="copy")return s.newDocument=gx(n,e.from),e.op==="move"&&(s.removed=n),s;if(e.op==="test"){if(s.test=O_(n,e.value),s.test===!1)throw new or("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return s.newDocument=n,s}else{if(e.op==="remove")return s.removed=n,s.newDocument=null,s;if(e.op==="_get")return e.value=n,s;if(t)throw new or("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,e,n);return s}}else{r||(n=to(n));const o=(e.path||"").split("/");let u=n,c=1,d=o.length,h,m,g;for(typeof t=="function"?g=t:g=yx;;){if(m=o[c],m&&m.indexOf("~")!=-1&&(m=_ee(m)),i&&(m=="__proto__"||m=="prototype"&&c>0&&o[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&h===void 0&&(u[m]===void 0?h=o.slice(0,c).join("/"):c==d-1&&(h=e.path),h!==void 0&&g(e,0,n,h)),c++,Array.isArray(u)){if(m==="-")m=u.length;else{if(t&&!px(m))throw new or("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,e,n);px(m)&&(m=~~m)}if(c>=d){if(t&&e.op==="add"&&m>u.length)throw new or("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,e,n);const _=wee[e.op].call(e,u,m,n);if(_.test===!1)throw new or("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return _}}else if(c>=d){const _=Gf[e.op].call(e,u,m,n);if(_.test===!1)throw new or("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return _}if(u=u[m],t&&c<d&&(!u||typeof u!="object"))throw new or("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,e,n)}}}function dm(n,e,t,r=!0,i=!0){if(t&&!Array.isArray(e))throw new or("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(n=to(n));const a=new Array(e.length);for(let s=0,o=e.length;s<o;s++)a[s]=Vp(n,e[s],t,!0,i,s),n=a[s].newDocument;return a.newDocument=n,a}function yx(n,e,t,r){if(typeof n!="object"||n===null||Array.isArray(n))throw new or("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,n,t);if(Gf[n.op]){if(typeof n.path!="string")throw new or("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,n,t);if(n.path.indexOf("/")!==0&&n.path.length>0)throw new or('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,n,t);if((n.op==="move"||n.op==="copy")&&typeof n.from!="string")throw new or("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&n.value===void 0)throw new or("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&mx(n.value))throw new or("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,n,t);if(t){if(n.op=="add"){var i=n.path.split("/").length,a=r.split("/").length;if(i!==a+1&&i!==a)throw new or("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,n,t)}else if(n.op==="replace"||n.op==="remove"||n.op==="_get"){if(n.path!==r)throw new or("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,n,t)}else if(n.op==="move"||n.op==="copy"){var s={op:"_get",path:n.from,value:void 0},o=Eee([s],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new or("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,n,t)}}}else throw new or("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,n,t)}function Eee(n,e,t){try{if(!Array.isArray(n))throw new or("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)dm(to(e),to(n),t||!0);else{t=t||yx;for(var r=0;r<n.length;r++)t(n[r],r,e,void 0)}}catch(i){if(i instanceof or)return i;throw i}}function O_(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){var t=Array.isArray(n),r=Array.isArray(e),i,a,s;if(t&&r){if(a=n.length,a!=e.length)return!1;for(i=a;i--!==0;)if(!O_(n[i],e[i]))return!1;return!0}if(t!=r)return!1;var o=Object.keys(n);if(a=o.length,a!==Object.keys(e).length)return!1;for(i=a;i--!==0;)if(!e.hasOwnProperty(o[i]))return!1;for(i=a;i--!==0;)if(s=o[i],!O_(n[s],e[s]))return!1;return!0}return n!==n&&e!==e}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */function n5(n,e,t,r,i){if(e!==n){typeof e.toJSON=="function"&&(e=e.toJSON());for(var a=hx(e),s=hx(n),o=!1,u=s.length-1;u>=0;u--){var c=s[u],d=n[c];if(dx(e,c)&&!(e[c]===void 0&&d!==void 0&&Array.isArray(e)===!1)){var h=e[c];typeof d=="object"&&d!=null&&typeof h=="object"&&h!=null&&Array.isArray(d)===Array.isArray(h)?n5(d,h,t,r+"/"+Ef(c),i):d!==h&&(i&&t.push({op:"test",path:r+"/"+Ef(c),value:to(d)}),t.push({op:"replace",path:r+"/"+Ef(c),value:to(h)}))}else Array.isArray(n)===Array.isArray(e)?(i&&t.push({op:"test",path:r+"/"+Ef(c),value:to(d)}),t.push({op:"remove",path:r+"/"+Ef(c)}),o=!0):(i&&t.push({op:"test",path:r,value:n}),t.push({op:"replace",path:r,value:e}))}if(!(!o&&a.length==s.length))for(var u=0;u<a.length;u++){var c=a[u];!dx(n,c)&&e[c]!==void 0&&t.push({op:"add",path:r+"/"+Ef(c),value:to(e[c])})}}}function bI(n,e,t=!1){var r=[];return n5(n,e,r,"",t),r}var uT={};const r5=()=>typeof window<"u"&&typeof window.document<"u",i5=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",a5=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),kb=()=>typeof Deno<"u",s5=()=>typeof ot<"u"&&typeof ot.versions<"u"&&typeof ot.versions.node<"u"&&!kb(),o5=()=>{let n;return r5()?n="browser":s5()?n="node":i5()?n="webworker":a5()?n="jsdom":kb()?n="deno":n="other",n};let cT;async function See(){return wI()}function wI(){return cT===void 0&&(cT={library:"langchain-js",runtime:o5()}),cT}function zi(n){try{return typeof ot<"u"?uT==null?void 0:uT[n]:kb()?Deno==null?void 0:Deno.env.get(n):void 0}catch{return}}const Tee=Object.freeze(Object.defineProperty({__proto__:null,getEnv:o5,getEnvironmentVariable:zi,getRuntimeEnvironment:See,getRuntimeEnvironmentSync:wI,isBrowser:r5,isDeno:kb,isJsDom:a5,isNode:s5,isWebWorker:i5},Symbol.toStringTag,{value:"Module"}));class Aee{}function EI(n){return"lc_prefer_streaming"in n&&n.lc_prefer_streaming}class Rc extends Aee{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,Tb(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:zi("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return wa.prototype.toJSON.call(this)}toJSONNotImplemented(){return wa.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends Rc{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:jo()}),Object.assign(this,e)}}return new t}}const l5=n=>{const e=n;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"},Cee=Object.freeze(Object.defineProperty({__proto__:null,BaseCallbackHandler:Rc,callbackHandlerPrefersStreaming:EI,isBaseCallbackHandler:l5},Symbol.toStringTag,{value:"Module"})),xee=n=>{if(n)return n.events=n.events??[],n.child_runs=n.child_runs??[],n};function vx(n,e){if(n)return new Mi({...n,parent_run:vx(e),child_runs:n.child_runs.map(t=>vx(t)).filter(t=>t!==void 0),extra:{...n.extra,runtime:wI()},tracingEnabled:!1})}function fT(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}function Ree(n){return n.replace(/[-:.]/g,"")}function Iee(n,e,t){const r=t.toFixed(0).slice(0,3).padStart(3,"0");return Ree(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}function $f(n){return typeof n._addRunToRunMap=="function"}class po extends Rc{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"runTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!1})}copy(){return this}getRunById(e){if(e!==void 0)return this.usesRunTreeMap?xee(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const t=Iee(e.start_time,e.id,e.execution_order),r={...e},i=this.getRunById(r.parent_run_id);if(r.parent_run_id!==void 0?i&&(this._addChildRun(i,r),i.child_execution_order=Math.max(i.child_execution_order,r.child_execution_order),r.trace_id=i.trace_id,i.dotted_order!==void 0&&(r.dotted_order=[i.dotted_order,t].join("."))):(r.trace_id=r.id,r.dotted_order=t),this.usesRunTreeMap){const a=vx(r,i);a!==void 0&&this.runTreeMap.set(r.id,a)}else this.runMap.set(r.id,r);return r}async _endTrace(e){var r;const t=e.parent_run_id!==void 0&&this.getRunById(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),await((r=this.onRunUpdate)==null?void 0:r.call(this,e)),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){const t=e!==void 0&&this.getRunById(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,i,a,s,o,u){const c=this._getExecutionOrder(i),d=Date.now(),h=o?{...a,metadata:o}:a,m={id:r,name:u??e.id[e.id.length-1],parent_run_id:i,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:h??{},tags:s||[]};return this._addRunToRunMap(m)}async handleLLMStart(e,t,r,i,a,s,o,u){var d,h;const c=this.getRunById(r)??this._createRunForLLMStart(e,t,r,i,a,s,o,u);return await((d=this.onRunCreate)==null?void 0:d.call(this,c)),await((h=this.onLLMStart)==null?void 0:h.call(this,c)),c}_createRunForChatModelStart(e,t,r,i,a,s,o,u){const c=this._getExecutionOrder(i),d=Date.now(),h=o?{...a,metadata:o}:a,m={id:r,name:u??e.id[e.id.length-1],parent_run_id:i,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:h??{},tags:s||[]};return this._addRunToRunMap(m)}async handleChatModelStart(e,t,r,i,a,s,o,u){var d,h;const c=this.getRunById(r)??this._createRunForChatModelStart(e,t,r,i,a,s,o,u);return await((d=this.onRunCreate)==null?void 0:d.call(this,c)),await((h=this.onLLMStart)==null?void 0:h.call(this,c)),c}async handleLLMEnd(e,t,r,i,a){var o;const s=this.getRunById(t);if(!s||(s==null?void 0:s.run_type)!=="llm")throw new Error("No LLM run to end.");return s.end_time=Date.now(),s.outputs=e,s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),s.extra={...s.extra,...a},await((o=this.onLLMEnd)==null?void 0:o.call(this,s)),await this._endTrace(s),s}async handleLLMError(e,t,r,i,a){var o;const s=this.getRunById(t);if(!s||(s==null?void 0:s.run_type)!=="llm")throw new Error("No LLM run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),s.extra={...s.extra,...a},await((o=this.onLLMError)==null?void 0:o.call(this,s)),await this._endTrace(s),s}_createRunForChainStart(e,t,r,i,a,s,o,u){const c=this._getExecutionOrder(i),d=Date.now(),h={id:r,name:u??e.id[e.id.length-1],parent_run_id:i,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:o??"chain",child_runs:[],extra:s?{metadata:s}:{},tags:a||[]};return this._addRunToRunMap(h)}async handleChainStart(e,t,r,i,a,s,o,u){var d,h;const c=this.getRunById(r)??this._createRunForChainStart(e,t,r,i,a,s,o,u);return await((d=this.onRunCreate)==null?void 0:d.call(this,c)),await((h=this.onChainStart)==null?void 0:h.call(this,c)),c}async handleChainEnd(e,t,r,i,a){var o;const s=this.getRunById(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.outputs=fT(e,"output"),s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(s.inputs=fT(a.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,s)),await this._endTrace(s),s}async handleChainError(e,t,r,i,a){var o;const s=this.getRunById(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(s.inputs=fT(a.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,s)),await this._endTrace(s),s}_createRunForToolStart(e,t,r,i,a,s,o){const u=this._getExecutionOrder(i),c=Date.now(),d={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:u,child_execution_order:u,run_type:"tool",child_runs:[],extra:s?{metadata:s}:{},tags:a||[]};return this._addRunToRunMap(d)}async handleToolStart(e,t,r,i,a,s,o){var c,d;const u=this.getRunById(r)??this._createRunForToolStart(e,t,r,i,a,s,o);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((d=this.onToolStart)==null?void 0:d.call(this,u)),u}async handleToolEnd(e,t){var i;const r=this.getRunById(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((i=this.onToolEnd)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleToolError(e,t){var i;const r=this.getRunById(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((i=this.onToolError)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleAgentAction(e,t){var a;const r=this.getRunById(t);if(!r||(r==null?void 0:r.run_type)!=="chain")return;const i=r;i.actions=i.actions||[],i.actions.push(e),i.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentAction)==null?void 0:a.call(this,r))}async handleAgentEnd(e,t){var i;const r=this.getRunById(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentEnd)==null?void 0:i.call(this,r)))}_createRunForRetrieverStart(e,t,r,i,a,s,o){const u=this._getExecutionOrder(i),c=Date.now(),d={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:u,child_execution_order:u,run_type:"retriever",child_runs:[],extra:s?{metadata:s}:{},tags:a||[]};return this._addRunToRunMap(d)}async handleRetrieverStart(e,t,r,i,a,s,o){var c,d;const u=this.getRunById(r)??this._createRunForRetrieverStart(e,t,r,i,a,s,o);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((d=this.onRetrieverStart)==null?void 0:d.call(this,u)),u}async handleRetrieverEnd(e,t){var i;const r=this.getRunById(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((i=this.onRetrieverEnd)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleRetrieverError(e,t){var i;const r=this.getRunById(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((i=this.onRetrieverError)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleText(e,t){var i;const r=this.getRunById(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((i=this.onText)==null?void 0:i.call(this,r)))}async handleLLMNewToken(e,t,r,i,a,s){var u;const o=this.getRunById(r);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:s==null?void 0:s.chunk}}),await((u=this.onLLMNewToken)==null?void 0:u.call(this,o,e,{chunk:s==null?void 0:s.chunk})),o}}const Pee=Object.freeze(Object.defineProperty({__proto__:null,BaseTracer:po,isBaseTracer:$f},Symbol.toStringTag,{value:"Module"}));var Nv={exports:{}};Nv.exports;var LL;function Oee(){return LL||(LL=1,function(n){const t=(a=0)=>s=>`\x1B[${38+a};5;${s}m`,r=(a=0)=>(s,o,u)=>`\x1B[${38+a};2;${s};${o};${u}m`;function i(){const a=new Map,s={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};s.color.gray=s.color.blackBright,s.bgColor.bgGray=s.bgColor.bgBlackBright,s.color.grey=s.color.blackBright,s.bgColor.bgGrey=s.bgColor.bgBlackBright;for(const[o,u]of Object.entries(s)){for(const[c,d]of Object.entries(u))s[c]={open:`\x1B[${d[0]}m`,close:`\x1B[${d[1]}m`},u[c]=s[c],a.set(d[0],d[1]);Object.defineProperty(s,o,{value:u,enumerable:!1})}return Object.defineProperty(s,"codes",{value:a,enumerable:!1}),s.color.close="\x1B[39m",s.bgColor.close="\x1B[49m",s.color.ansi256=t(),s.color.ansi16m=r(),s.bgColor.ansi256=t(10),s.bgColor.ansi16m=r(10),Object.defineProperties(s,{rgbToAnsi256:{value:(o,u,c)=>o===u&&u===c?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(u/255*5)+Math.round(c/255*5),enumerable:!1},hexToRgb:{value:o=>{const u=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!u)return[0,0,0];let{colorString:c}=u.groups;c.length===3&&(c=c.split("").map(h=>h+h).join(""));const d=Number.parseInt(c,16);return[d>>16&255,d>>8&255,d&255]},enumerable:!1},hexToAnsi256:{value:o=>s.rgbToAnsi256(...s.hexToRgb(o)),enumerable:!1}}),s}Object.defineProperty(n,"exports",{enumerable:!0,get:i})}(Nv)),Nv.exports}var kee=Oee();const u5=Za(kee);function pi(n,e){return`${n.open}${e}${n.close}`}function La(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function UL(n){return typeof n=="string"?n.trim():n==null?n:La(n,n.toString())}function kl(n){if(!n.end_time)return"";const e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:Oi}=u5;class _x extends po{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const i=this.runMap.get(r.parent_run_id);if(i)t.push(i),r=i;else break}return t}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((i,a,s)=>{const o=`${i.execution_order}:${i.run_type}:${i.name}`;return a===s.length-1?pi(u5.bold,o):o}).join(" > ");return pi(Oi.grey,r)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${pi(Oi.green,"[chain/start]")} [${t}] Entering Chain run with input: ${La(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${pi(Oi.cyan,"[chain/end]")} [${t}] [${kl(e)}] Exiting Chain run with output: ${La(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${pi(Oi.red,"[chain/error]")} [${t}] [${kl(e)}] Chain run errored with error: ${La(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(i=>i.trim())}:e.inputs;console.log(`${pi(Oi.green,"[llm/start]")} [${t}] Entering LLM run with input: ${La(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${pi(Oi.cyan,"[llm/end]")} [${t}] [${kl(e)}] Exiting LLM run with output: ${La(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${pi(Oi.red,"[llm/error]")} [${t}] [${kl(e)}] LLM run errored with error: ${La(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${pi(Oi.green,"[tool/start]")} [${t}] Entering Tool run with input: "${UL(e.inputs.input)}"`)}onToolEnd(e){var r;const t=this.getBreadcrumbs(e);console.log(`${pi(Oi.cyan,"[tool/end]")} [${t}] [${kl(e)}] Exiting Tool run with output: "${UL((r=e.outputs)==null?void 0:r.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${pi(Oi.red,"[tool/error]")} [${t}] [${kl(e)}] Tool run errored with error: ${La(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${pi(Oi.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${La(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${pi(Oi.cyan,"[retriever/end]")} [${t}] [${kl(e)}] Exiting Retriever run with output: ${La(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${pi(Oi.red,"[retriever/error]")} [${t}] [${kl(e)}] Retriever run errored with error: ${La(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${pi(Oi.blue,"[agent/action]")} [${r}] Agent selected action: ${La(t.actions[t.actions.length-1],"[action]")}`)}}const Nee=Object.freeze(Object.defineProperty({__proto__:null,ConsoleCallbackHandler:_x},Symbol.toStringTag,{value:"Module"}));let dT;const c5=()=>{if(dT===void 0){const n=zi("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};dT=new Q6(n)}return dT};class Jl extends po{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!0});const{exampleId:t,projectName:r,client:i,replicas:a}=e;this.projectName=r??V6(),this.replicas=a,this.exampleId=t,this.client=i??c5();const s=Jl.getTraceableRunTree();s&&this.updateFromRunTree(s)}async persistRun(e){}async onRunCreate(e){const t=this.getRunTreeWithTracingConfig(e.id);await(t==null?void 0:t.postRun())}async onRunUpdate(e){const t=this.getRunTreeWithTracingConfig(e.id);await(t==null?void 0:t.patchRun())}getRun(e){return this.runTreeMap.get(e)}updateFromRunTree(e){let t=e;const r=new Set;for(;t.parent_run&&!(r.has(t.id)||(r.add(t.id),!t.parent_run));)t=t.parent_run;r.clear();const i=[t];for(;i.length>0;){const a=i.shift();!a||r.has(a.id)||(r.add(a.id),this.runTreeMap.set(a.id,a),a.child_runs&&i.push(...a.child_runs))}this.client=e.client??this.client,this.replicas=e.replicas??this.replicas,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(e){const t=this.runTreeMap.get(e);if(t)return new Mi({...t,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return yee(!0)}catch{return}}}const Mee=Object.freeze(Object.defineProperty({__proto__:null,LangChainTracer:Jl},Symbol.toStringTag,{value:"Module"})),f5=Symbol.for("ls:tracing_async_local_storage"),Mv=Symbol.for("lc:context_variables"),Dee=n=>{globalThis[f5]=n},hm=()=>globalThis[f5];let Ku;function $ee(){const n="default"in Go?Go.default:Go;return new n({autoStart:!0,concurrency:1})}function Lee(){return typeof Ku>"u"&&(Ku=$ee()),Ku}async function ur(n,e){if(e===!0){const t=hm();t!==void 0?await t.run(void 0,async()=>n()):await n()}else Ku=Lee(),Ku.add(async()=>{const t=hm();t!==void 0?await t.run(void 0,async()=>n()):await n()})}async function Uee(){const n=c5();await Promise.allSettled([typeof Ku<"u"?Ku.onIdle():Promise.resolve(),n.awaitPendingTraceBatches()])}const jee=Object.freeze(Object.defineProperty({__proto__:null,awaitAllCallbacks:Uee,consumeCallback:ur},Symbol.toStringTag,{value:"Module"})),Fee=n=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>zi(t)==="true");function d5(n){var r;const e=hm();if(e===void 0)return;const t=e.getStore();return(r=t==null?void 0:t[Mv])==null?void 0:r[n]}const Bee=Symbol("lc:configure_hooks"),qee=()=>d5(Bee)||[];function Vm(n){return n?Array.isArray(n)||"name"in n?{callbacks:n}:n:{}}class h5{setHandler(e){return this.setHandlers([e])}}class zm{constructor(e,t,r,i,a,s,o,u){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:u})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>ur(async()=>{var r;try{await((r=t.handleText)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${i}`),t.raiseError)throw i}},t.awaitHandlers)))}async handleCustomEvent(e,t,r,i,a){await Promise.all(this.handlers.map(s=>ur(async()=>{var o;try{await((o=s.handleCustomEvent)==null?void 0:o.call(s,e,t,this.runId,this.tags,this.metadata))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleCustomEvent: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}}class p5 extends zm{getChild(e){const t=new tr(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>ur(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw i}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>ur(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${i}`),t.raiseError)throw e}},t.awaitHandlers)))}}class bx extends zm{async handleLLMNewToken(e,t,r,i,a,s){await Promise.all(this.handlers.map(o=>ur(async()=>{var u;if(!o.ignoreLLM)try{await((u=o.handleLLMNewToken)==null?void 0:u.call(o,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,s))}catch(c){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${c}`),o.raiseError)throw c}},o.awaitHandlers)))}async handleLLMError(e,t,r,i,a){await Promise.all(this.handlers.map(s=>ur(async()=>{var o;if(!s.ignoreLLM)try{await((o=s.handleLLMError)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,a))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleLLMError: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}async handleLLMEnd(e,t,r,i,a){await Promise.all(this.handlers.map(s=>ur(async()=>{var o;if(!s.ignoreLLM)try{await((o=s.handleLLMEnd)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,a))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleLLMEnd: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}}class m5 extends zm{getChild(e){const t=new tr(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,i,a){await Promise.all(this.handlers.map(s=>ur(async()=>{var o;if(!s.ignoreChain)try{await((o=s.handleChainError)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,a))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleChainError: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}async handleChainEnd(e,t,r,i,a){await Promise.all(this.handlers.map(s=>ur(async()=>{var o;if(!s.ignoreChain)try{await((o=s.handleChainEnd)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,a))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleChainEnd: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>ur(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentAction)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${i}`),t.raiseError)throw i}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>ur(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${i}`),t.raiseError)throw i}},t.awaitHandlers)))}}class g5 extends zm{getChild(e){const t=new tr(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>ur(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${i}`),t.raiseError)throw i}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>ur(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${i}`),t.raiseError)throw i}},t.awaitHandlers)))}}class tr extends h5{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(t==null?void 0:t.handlers)??this.handlers,this.inheritableHandlers=(t==null?void 0:t.inheritableHandlers)??this.inheritableHandlers,this.tags=(t==null?void 0:t.tags)??this.tags,this.inheritableTags=(t==null?void 0:t.inheritableTags)??this.inheritableTags,this.metadata=(t==null?void 0:t.metadata)??this.metadata,this.inheritableMetadata=(t==null?void 0:t.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r=void 0,i=void 0,a=void 0,s=void 0,o=void 0,u=void 0){return Promise.all(t.map(async(c,d)=>{const h=d===0&&r?r:jo();return await Promise.all(this.handlers.map(m=>{if(!m.ignoreLLM)return $f(m)&&m._createRunForLLMStart(e,[c],h,this._parentRunId,a,this.tags,this.metadata,u),ur(async()=>{var g;try{await((g=m.handleLLMStart)==null?void 0:g.call(m,e,[c],h,this._parentRunId,a,this.tags,this.metadata,u))}catch(_){if((m.raiseError?console.error:console.warn)(`Error in handler ${m.constructor.name}, handleLLMStart: ${_}`),m.raiseError)throw _}},m.awaitHandlers)})),new bx(h,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r=void 0,i=void 0,a=void 0,s=void 0,o=void 0,u=void 0){return Promise.all(t.map(async(c,d)=>{const h=d===0&&r?r:jo();return await Promise.all(this.handlers.map(m=>{if(!m.ignoreLLM)return $f(m)&&m._createRunForChatModelStart(e,[c],h,this._parentRunId,a,this.tags,this.metadata,u),ur(async()=>{var g,_;try{if(m.handleChatModelStart)await((g=m.handleChatModelStart)==null?void 0:g.call(m,e,[c],h,this._parentRunId,a,this.tags,this.metadata,u));else if(m.handleLLMStart){const w=Bm(c);await((_=m.handleLLMStart)==null?void 0:_.call(m,e,[w],h,this._parentRunId,a,this.tags,this.metadata,u))}}catch(w){if((m.raiseError?console.error:console.warn)(`Error in handler ${m.constructor.name}, handleLLMStart: ${w}`),m.raiseError)throw w}},m.awaitHandlers)})),new bx(h,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=jo(),i=void 0,a=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreChain)return $f(u)&&u._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,i,o),ur(async()=>{var c;try{await((c=u.handleChainStart)==null?void 0:c.call(u,e,t,r,this._parentRunId,this.tags,this.metadata,i,o))}catch(d){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleChainStart: ${d}`),u.raiseError)throw d}},u.awaitHandlers)})),new m5(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=jo(),i=void 0,a=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreAgent)return $f(u)&&u._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),ur(async()=>{var c;try{await((c=u.handleToolStart)==null?void 0:c.call(u,e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(d){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleToolStart: ${d}`),u.raiseError)throw d}},u.awaitHandlers)})),new g5(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=jo(),i=void 0,a=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreRetriever)return $f(u)&&u._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),ur(async()=>{var c;try{await((c=u.handleRetrieverStart)==null?void 0:c.call(u,e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(d){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleRetrieverStart: ${d}`),u.raiseError)throw d}},u.awaitHandlers)})),new p5(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,r,i,a){await Promise.all(this.handlers.map(s=>ur(async()=>{var o;if(!s.ignoreCustomEvent)try{await((o=s.handleCustomEvent)==null?void 0:o.call(s,e,t,r,this.tags,this.metadata))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleCustomEvent: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new tr(this._parentRunId);for(const i of this.handlers){const a=this.inheritableHandlers.includes(i);r.addHandler(i,a)}for(const i of this.tags){const a=this.inheritableTags.includes(i);r.addTags([i],a)}for(const i of Object.keys(this.metadata)){const a=Object.keys(this.inheritableMetadata).includes(i);r.addMetadata({[i]:this.metadata[i]},a)}for(const i of e)r.handlers.filter(a=>a.name==="console_callback_handler").some(a=>a.name===i.name)||r.addHandler(i,t);return r}static fromHandlers(e){class t extends Rc{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:jo()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new t),r}static configure(e,t,r,i,a,s,o){return this._configureSync(e,t,r,i,a,s,o)}static _configureSync(e,t,r,i,a,s,o){var m,g;let u;(e||t)&&(Array.isArray(e)||!e?(u=new tr,u.setHandlers((e==null?void 0:e.map(pm))??[],!0)):u=e,u=u.copy(Array.isArray(t)?t.map(pm):t==null?void 0:t.handlers,!1));const c=zi("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),d=((m=Jl.getTraceableRunTree())==null?void 0:m.tracingEnabled)||Fee(),h=d||(zi("LANGCHAIN_TRACING")??!1);if(c||h){if(u||(u=new tr),c&&!u.handlers.some(_=>_.name===_x.prototype.name)){const _=new _x;u.addHandler(_,!0)}if(h&&!u.handlers.some(_=>_.name==="langchain_tracer")&&d){const _=new Jl;u.addHandler(_,!0),u._parentRunId=((g=Jl.getTraceableRunTree())==null?void 0:g.id)??u._parentRunId}}for(const{contextVar:_,inheritable:w=!0,handlerClass:S,envVar:E}of qee()){const C=E&&zi(E)==="true"&&S;let A;const R=_!==void 0?d5(_):void 0;R&&l5(R)?A=R:C&&(A=new S({})),A!==void 0&&(u||(u=new tr),u.handlers.some(P=>P.name===A.name)||u.addHandler(A,w))}return(r||i)&&u&&(u.addTags(r??[]),u.addTags(i??[],!1)),(a||s)&&u&&(u.addMetadata(a??{}),u.addMetadata(s??{},!1)),u}}function pm(n){return"name"in n?n:Rc.fromMethods(n)}class y5{constructor(e,t){Object.defineProperty(this,"groupName",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"runManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}async getTraceGroupCallbackManager(e,t,r){const i=new Jl(r),a=await tr.configure([i]),s=await(a==null?void 0:a.handleChainStart({lc:1,type:"not_implemented",id:["langchain","callbacks","groups",e]},t??{}));if(!s)throw new Error("Failed to create run group callback manager.");return s}async start(e){return this.runManager||(this.runManager=await this.getTraceGroupCallbackManager(this.groupName,e,this.options)),this.runManager.getChild()}async error(e){this.runManager&&(await this.runManager.handleChainError(e),this.runManager=void 0)}async end(e){this.runManager&&(await this.runManager.handleChainEnd(e??{}),this.runManager=void 0)}}function Vee(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}async function zee(n,e,...t){const r=new y5(n.name,n),i=await r.start({...t});try{const a=await e(i,...t);return await r.end(Vee(a,"output")),a}catch(a){throw await r.error(a),a}}const Hee=Object.freeze(Object.defineProperty({__proto__:null,BaseCallbackManager:h5,BaseRunManager:zm,CallbackManager:tr,CallbackManagerForChainRun:m5,CallbackManagerForLLMRun:bx,CallbackManagerForRetrieverRun:p5,CallbackManagerForToolRun:g5,TraceGroup:y5,ensureHandler:pm,parseCallbackConfigArg:Vm,traceAsGroup:zee},Symbol.toStringTag,{value:"Module"}));class Gee{getStore(){}run(e,t){return t()}enterWith(e){}}const Wee=new Gee,jL=Symbol.for("lc:child_config");class Kee{getInstance(){return hm()??Wee}getRunnableConfig(){var t,r;return(r=(t=this.getInstance().getStore())==null?void 0:t.extra)==null?void 0:r[jL]}runWithConfig(e,t,r){var d;const i=tr._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),a=this.getInstance(),s=a.getStore(),o=i==null?void 0:i.getParentRunId(),u=(d=i==null?void 0:i.handlers)==null?void 0:d.find(h=>(h==null?void 0:h.name)==="langchain_tracer");let c;return u&&o?c=u.getRunTreeWithTracingConfig(o):r||(c=new Mi({name:"<runnable_lambda>",tracingEnabled:!1})),c&&(c.extra={...c.extra,[jL]:e}),s!==void 0&&s[Mv]!==void 0&&(c===void 0&&(c={}),c[Mv]=s[Mv]),a.run(c,t)}initializeGlobalInstance(e){hm()===void 0&&Dee(e)}}const Hi=new Kee,hT=25;async function Gi(n){return tr._configureSync(n==null?void 0:n.callbacks,void 0,n==null?void 0:n.tags,void 0,n==null?void 0:n.metadata)}function bs(...n){const e={};for(const t of n.filter(r=>!!r))for(const r of Object.keys(t))if(r==="metadata")e[r]={...e[r],...t[r]};else if(r==="tags"){const i=e[r]??[];e[r]=[...new Set(i.concat(t[r]??[]))]}else if(r==="configurable")e[r]={...e[r],...t[r]};else if(r==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(r==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(r==="callbacks"){const i=e.callbacks,a=t.callbacks;if(Array.isArray(a))if(!i)e.callbacks=a;else if(Array.isArray(i))e.callbacks=i.concat(a);else{const s=i.copy();for(const o of a)s.addHandler(pm(o),!0);e.callbacks=s}else if(a)if(!i)e.callbacks=a;else if(Array.isArray(i)){const s=a.copy();for(const o of i)s.addHandler(pm(o),!0);e.callbacks=s}else e.callbacks=new tr(a._parentRunId,{handlers:i.handlers.concat(a.handlers),inheritableHandlers:i.inheritableHandlers.concat(a.inheritableHandlers),tags:Array.from(new Set(i.tags.concat(a.tags))),inheritableTags:Array.from(new Set(i.inheritableTags.concat(a.inheritableTags))),metadata:{...i.metadata,...a.metadata}})}else{const i=r;e[i]=t[i]??e[i]}return e}const Jee=new Set(["string","number","boolean"]);function Qt(n){var r;const e=Hi.getRunnableConfig();let t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:i,runName:a,...s}=e;t=Object.entries(s).reduce((o,[u,c])=>(c!==void 0&&(o[u]=c),o),t)}if(n&&(t=Object.entries(n).reduce((i,[a,s])=>(s!==void 0&&(i[a]=s),i),t)),t!=null&&t.configurable)for(const i of Object.keys(t.configurable))Jee.has(typeof t.configurable[i])&&!((r=t.metadata)!=null&&r[i])&&(t.metadata||(t.metadata={}),t.metadata[i]=t.configurable[i]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");const i=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,i])):t.signal=i,delete t.timeout}return t}function fn(n={},{callbacks:e,maxConcurrency:t,recursionLimit:r,runName:i,configurable:a,runId:s}={}){const o=Qt(n);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),t!==void 0&&(o.maxConcurrency=t),i!==void 0&&(o.runName=i),a!==void 0&&(o.configurable={...o.configurable,...a}),s!==void 0&&delete o.runId,o}function el(n){return n?{configurable:n.configurable,recursionLimit:n.recursionLimit,callbacks:n.callbacks,tags:n.tags,metadata:n.metadata,maxConcurrency:n.maxConcurrency,timeout:n.timeout,signal:n.signal}:void 0}async function eu(n,e){if(e===void 0)return n;let t;return Promise.race([n.catch(r=>{if(!(e!=null&&e.aborted))throw r}),new Promise((r,i)=>{t=()=>{i(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&i(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}class li extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const t=e.getReader();return new li({start(r){return i();function i(){return t.read().then(({done:a,value:s})=>{if(a){r.close();return}return r.enqueue(s),i()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new li({async pull(t){const{value:r,done:i}=await e.next();i&&t.close(),t.enqueue(r)},async cancel(t){await e.return(t)}})}}function SI(n,e=2){const t=Array.from({length:e},()=>[]);return t.map(async function*(i){for(;;)if(i.length===0){const a=await n.next();for(const s of t)s.push(a)}else{if(i[0].done)return;yield i.shift().value}})}function _i(n,e){if(Array.isArray(n)&&Array.isArray(e))return n.concat(e);if(typeof n=="string"&&typeof e=="string")return n+e;if(typeof n=="number"&&typeof e=="number")return n+e;if("concat"in n&&typeof n.concat=="function")return n.concat(e);if(typeof n=="object"&&typeof e=="object"){const t={...n};for(const[r,i]of Object.entries(e))r in t&&!Array.isArray(t[r])?t[r]=_i(t[r],i):t[r]=i;return t}else throw new Error(`Cannot concat ${typeof n} and ${typeof e}`)}class Ic{constructor(e){var t;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??((t=this.config)==null?void 0:t.signal),this.setup=new Promise((r,i)=>{Hi.runWithConfig(el(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(r,i):this.firstResult.then(a=>r(void 0),i)},!0)})}async next(...e){var t;return(t=this.signal)==null||t.throwIfAborted(),this.firstResultUsed?Hi.runWithConfig(el(this.config),this.signal?async()=>eu(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function v5(n,e,t,r,...i){const a=new Ic({generator:e,startSetup:t,signal:r}),s=await a.setup;return{output:n(a,s,...i),setup:s}}const Yee=Object.freeze(Object.defineProperty({__proto__:null,AsyncGeneratorWithSetup:Ic,IterableReadableStream:li,atee:SI,concat:_i,pipeGeneratorWithSetup:v5},Symbol.toStringTag,{value:"Module"}));class Fo{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),r=dm({},t);return new Td({ops:t,state:r[r.length-1].newDocument})}}class Td extends Fo{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),r=dm(this.state,e.ops);return new Td({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){const t=dm({},e.ops);return new Td({ops:e.ops,state:t[t.length-1].newDocument})}}const _5=n=>n.name==="log_stream_tracer";async function FL(n,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:t}=n;if(["retriever","llm","prompt"].includes(n.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function BL(n,e){const{outputs:t}=n;return e==="original"||["retriever","llm","prompt"].includes(n.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function Zee(n){return n!==void 0&&n.message!==void 0}class wx extends po{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=li.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||t.find(i=>{var a;return(a=this.includeTags)==null?void 0:a.includes(i)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&t.every(i=>{var a;return!((a=this.excludeTags)!=null&&a.includes(i))})),r}async*tapOutputIterable(e,t){for await(const r of t){if(e!==this.rootId){const i=this.keyMapByRunId[e];i&&await this.writer.write(new Fo({ops:[{op:"add",path:`/logs/${i}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){var i;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new Fo({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;const r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=await FL(e,this._schemaFormat)),await this.writer.write(new Fo({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(t===void 0)return;const r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await FL(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await BL(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const i=new Fo({ops:r});await this.writer.write(i)}finally{if(e.id===this.rootId){const t=new Fo({ops:[{op:"replace",path:"/final_output",value:await BL(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){const i=this.keyMapByRunId[e.id];if(i===void 0)return;const a=e.inputs.messages!==void 0;let s;a?Zee(r==null?void 0:r.chunk)?s=r==null?void 0:r.chunk:s=new xn({id:`run-${e.id}`,content:t}):s=t;const o=new Fo({ops:[{op:"add",path:`/logs/${i}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${i}/streamed_output/-`,value:s}]});await this.writer.write(o)}}const Xee=Object.freeze(Object.defineProperty({__proto__:null,LogStreamCallbackHandler:wx,RunLog:Td,RunLogPatch:Fo,isLogStreamHandler:_5},Symbol.toStringTag,{value:"Module"})),mm="__run";class tu{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new tu({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class Sa extends tu{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new Sa({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}const Qee=Object.freeze(Object.defineProperty({__proto__:null,ChatGenerationChunk:Sa,GenerationChunk:tu,RUN_KEY:mm},Symbol.toStringTag,{value:"Module"}));function Fy({name:n,serialized:e}){return n!==void 0?n:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const ete=n=>n.name==="event_stream_tracer";class tte extends po{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=li.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(r=r||t.find(i=>{var a;return(a=this.includeTags)==null?void 0:a.includes(i)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(r=r&&t.every(i=>{var a;return!((a=this.excludeTags)!=null&&a.includes(i))})),r}async*tapOutputIterable(e,t){const r=await t.next();if(r.done)return;const i=this.runInfoMap.get(e);if(i===void 0){yield r.value;return}function a(o,u){return o==="llm"&&typeof u=="string"?new tu({text:u}):u}let s=this.tappedPromises.get(e);if(s===void 0){let o;s=new Promise(u=>{o=u}),this.tappedPromises.set(e,s);try{const u={event:`on_${i.runType}_stream`,run_id:e,name:i.name,tags:i.tags,metadata:i.metadata,data:{}};await this.send({...u,data:{chunk:a(i.runType,r.value)}},i),yield r.value;for await(const c of t)i.runType!=="tool"&&i.runType!=="retriever"&&await this.send({...u,data:{chunk:a(i.runType,c)}},i),yield c}finally{o()}}else{yield r.value;for await(const o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const r=this.tappedPromises.get(e.run_id);r!==void 0?r.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){var s,o;const t=Fy(e),r=e.inputs.messages!==void 0?"chat_model":"llm",i={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,i);const a=`on_${r}_start`;await this.send({event:a,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},i)}async onLLMNewToken(e,t,r){const i=this.runInfoMap.get(e.id);let a,s;if(i===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(i.runType==="chat_model")s="on_chat_model_stream",(r==null?void 0:r.chunk)===void 0?a=new xn({content:t,id:`run-${e.id}`}):a=r.chunk.message;else if(i.runType==="llm")s="on_llm_stream",(r==null?void 0:r.chunk)===void 0?a=new tu({text:t}):a=r.chunk;else throw new Error(`Unexpected run type ${i.runType}`);await this.send({event:s,data:{chunk:a},run_id:e.id,name:i.name,tags:i.tags,metadata:i.metadata},i)}}async onLLMEnd(e){var s,o,u;const t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let r;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const i=(s=e.outputs)==null?void 0:s.generations;let a;if(t.runType==="chat_model"){for(const c of i??[]){if(a!==void 0)break;a=(o=c[0])==null?void 0:o.message}r="on_chat_model_end"}else if(t.runType==="llm")a={generations:i==null?void 0:i.map(c=>c.map(d=>({text:d.text,generationInfo:d.generationInfo}))),llmOutput:((u=e.outputs)==null?void 0:u.llmOutput)??{}},r="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:r,data:{output:a,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){var s,o;const t=Fy(e),r=e.run_type??"chain",i={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:t,runType:e.run_type};let a={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(a={},i.inputs={}):e.inputs.input!==void 0?(a.input=e.inputs.input,i.inputs=e.inputs.input):(a.input=e.inputs,i.inputs=e.inputs),this.runInfoMap.set(e.id,i),await this.send({event:`on_${r}_start`,data:a,name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},i)}async onChainEnd(e){var o;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const r=`on_${e.run_type}_end`,i=e.inputs??t.inputs??{},s={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:i};i.input&&Object.keys(i).length===1&&(s.input=i.input,t.inputs=i.input),await this.sendEndEvent({event:r,data:s,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){var i,a;const t=Fy(e),r={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{}},r)}async onToolEnd(e){var i;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const r=((i=e.outputs)==null?void 0:i.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){var a,s;const t=Fy(e),i={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,i),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:((s=e.extra)==null?void 0:s.metadata)??{}},i)}async onRetrieverEnd(e){var r;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((r=e.outputs)==null?void 0:r.documents)??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,r){const i=this.runInfoMap.get(r);if(i===void 0)throw new Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:i.tags,metadata:i.metadata,data:t},i)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const nte=[400,401,402,403,404,405,406,407,409],rte=n=>{var t,r;if(n.message.startsWith("Cancel")||n.message.startsWith("AbortError")||n.name==="AbortError"||(n==null?void 0:n.code)==="ECONNABORTED")throw n;const e=((t=n==null?void 0:n.response)==null?void 0:t.status)??(n==null?void 0:n.status);if(e&&nte.includes(+e))throw n;if(((r=n==null?void 0:n.error)==null?void 0:r.code)==="insufficient_quota"){const i=new Error(n==null?void 0:n.message);throw i.name="InsufficientQuotaError",i}};class Hm{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??rte;const t="default"in Go?Go.default:Go;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>R_(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((i,a)=>{var s;(s=e.signal)==null||s.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}const ite=Object.freeze(Object.defineProperty({__proto__:null,AsyncCaller:Hm},Symbol.toStringTag,{value:"Module"}));class b5 extends po{constructor({config:e,onStart:t,onEnd:r,onError:i}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=i}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function TI(n){return n?n.lc_runnable:!1}class ate{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const i=e.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(t)),this.includeTags!==void 0&&(r=r||i.some(a=>{var s;return(s=this.includeTags)==null?void 0:s.includes(a)})),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(r=r&&i.every(a=>{var s;return!((s=this.excludeTags)!=null&&s.includes(a))})),r}}function pT(n){return n.replace(/[^a-zA-Z-_0-9]/g,"_")}const ste=["*","_","`"];function ote(n){let e="";for(const[t,r]of Object.entries(n))e+=`	classDef ${t} ${r};
`;return e}function lte(n,e,t){const{firstNode:r,lastNode:i,nodeColors:a,withStyles:s=!0,curveStyle:o="linear",wrapLabelNWords:u=9}=t??{};let c=s?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(s){const g="default",_={[g]:"{0}({1})"};r!==void 0&&(_[r]="{0}([{1}]):::first"),i!==void 0&&(_[i]="{0}([{1}]):::last");for(const[w,S]of Object.entries(n)){const E=S.name.split(":").pop()??"";let A=ste.some(P=>E.startsWith(P)&&E.endsWith(P))?`<p>${E}</p>`:E;Object.keys(S.metadata??{}).length&&(A+=`<hr/><small><em>${Object.entries(S.metadata??{}).map(([P,N])=>`${P} = ${N}`).join(`
`)}</em></small>`);const R=(_[w]??_[g]).replace("{0}",pT(w)).replace("{1}",A);c+=`	${R}
`}}const d={};for(const g of e){const _=g.source.split(":"),w=g.target.split(":"),S=_.filter((E,C)=>E===w[C]).join(":");d[S]||(d[S]=[]),d[S].push(g)}const h=new Set;function m(g,_){const w=g.length===1&&g[0].source===g[0].target;if(_&&!w){const S=_.split(":").pop();if(h.has(S))throw new Error(`Found duplicate subgraph '${S}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);h.add(S),c+=`	subgraph ${S}
`}for(const S of g){const{source:E,target:C,data:A,conditional:R}=S;let P="";if(A!==void 0){let N=A;const U=N.split(" ");U.length>u&&(N=Array.from({length:Math.ceil(U.length/u)},(k,B)=>U.slice(B*u,(B+1)*u).join(" ")).join("&nbsp;<br>&nbsp;")),P=R?` -. &nbsp;${N}&nbsp; .-> `:` -- &nbsp;${N}&nbsp; --> `}else P=R?" -.-> ":" --> ";c+=`	${pT(E)}${P}${pT(C)};
`}for(const S in d)S.startsWith(`${_}:`)&&S!==_&&m(d[S],S);_&&!w&&(c+=`	end
`)}m(d[""]??[],"");for(const g in d)!g.includes(":")&&g!==""&&m(d[g],g);return s&&(c+=ote(a??{})),c}async function ute(n,e){let{backgroundColor:t="white"}=e??{};const r=btoa(n);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));const i=`https://mermaid.ink/img/${r}?bgColor=${t}`,a=await fetch(i);if(!a.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${a.status}`,`Status text: ${a.statusText}`].join(`
`));return await a.blob()}function jd(n,e,t){function r(o,u){var c;Object.defineProperty(o,"_zod",{value:o._zod??{},enumerable:!1}),(c=o._zod).traits??(c.traits=new Set),o._zod.traits.add(n),e(o,u);for(const d in s.prototype)d in o||Object.defineProperty(o,d,{value:s.prototype[d].bind(o)});o._zod.constr=s,o._zod.def=u}const i=(t==null?void 0:t.Parent)??Object;class a extends i{}Object.defineProperty(a,"name",{value:n});function s(o){var u;const c=t!=null&&t.Parent?new a:this;r(c,o),(u=c._zod).deferred??(u.deferred=[]);for(const d of c._zod.deferred)d();return c}return Object.defineProperty(s,"init",{value:r}),Object.defineProperty(s,Symbol.hasInstance,{value:o=>{var u,c;return t!=null&&t.Parent&&o instanceof t.Parent?!0:(c=(u=o==null?void 0:o._zod)==null?void 0:u.traits)==null?void 0:c.has(n)}}),Object.defineProperty(s,"name",{value:n}),s}class k_ extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const cte={};function Nb(n){return cte}function fte(n){const e=Object.values(n).filter(r=>typeof r=="number");return Object.entries(n).filter(([r,i])=>e.indexOf(+r)===-1).map(([r,i])=>i)}function dte(n,e){return typeof e=="bigint"?e.toString():e}function hte(n){const e=n.startsWith("^")?1:0,t=n.endsWith("$")?n.length-1:n.length;return n.slice(e,t)}function Ex(n,e,t){Object.defineProperty(n,e,{get(){{const r=t();return n[e]=r,r}},set(r){Object.defineProperty(n,e,{value:r})},configurable:!0})}function pte(n,e,t){Object.defineProperty(n,e,{value:t,writable:!0,enumerable:!0,configurable:!0})}function mte(n=10){const e="abcdefghijklmnopqrstuvwxyz";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}const w5=Error.captureStackTrace?Error.captureStackTrace:(...n)=>{};function nu(n,e,t){const r=new n._zod.constr(e??n._zod.def);return(!e||t!=null&&t.parent)&&(r._zod.parent=n),r}function gte(n){return{}}function yte(n,e){const t={...n._zod.def,get shape(){const r={...n._zod.def.shape,...e};return pte(this,"shape",r),r},checks:[]};return nu(n,t)}function vte(n,e,t){const r=e._zod.def.shape,i={...r};for(const a in r)i[a]=n?new n({type:"optional",innerType:r[a]}):r[a];return nu(e,{...e._zod.def,shape:i,checks:[]})}function mT(n,e=0){for(let t=e;t<n.issues.length;t++)if(n.issues[t].continue!==!0)return!0;return!1}function By(n){return typeof n=="string"?n:n==null?void 0:n.message}function Mb(n,e,t){var i,a,s,o,u,c;const r={...n,path:n.path??[]};if(!n.message){const d=By((s=(a=(i=n.inst)==null?void 0:i._zod.def)==null?void 0:a.error)==null?void 0:s.call(a,n))??By((o=e==null?void 0:e.error)==null?void 0:o.call(e,n))??By((u=t.customError)==null?void 0:u.call(t,n))??By((c=t.localeError)==null?void 0:c.call(t,n))??"Invalid input";r.message=d}return delete r.inst,delete r.continue,e!=null&&e.reportInput||delete r.input,r}const E5=(n,e)=>{n.name="$ZodError",Object.defineProperty(n,"_zod",{value:n._zod,enumerable:!1}),Object.defineProperty(n,"issues",{value:e,enumerable:!1}),Object.defineProperty(n,"message",{get(){return JSON.stringify(e,dte,2)},enumerable:!0})},_te=jd("$ZodError",E5),Db=jd("$ZodError",E5,{Parent:Error}),bte=n=>(e,t,r,i)=>{const a=r?Object.assign(r,{async:!1}):{async:!1},s=e._zod.run({value:t,issues:[]},a);if(s instanceof Promise)throw new k_;if(s.issues.length){const o=new((i==null?void 0:i.Err)??n)(s.issues.map(u=>Mb(u,a,Nb())));throw w5(o,i==null?void 0:i.callee),o}return s.value},Gm=bte(Db),wte=n=>async(e,t,r,i)=>{const a=r?Object.assign(r,{async:!0}):{async:!0};let s=e._zod.run({value:t,issues:[]},a);if(s instanceof Promise&&(s=await s),s.issues.length){const o=new((i==null?void 0:i.Err)??n)(s.issues.map(u=>Mb(u,a,Nb())));throw w5(o,i==null?void 0:i.callee),o}return s.value},Ete=wte(Db),Ste=n=>(e,t,r)=>{const i=r?{...r,async:!1}:{async:!1},a=e._zod.run({value:t,issues:[]},i);if(a instanceof Promise)throw new k_;return a.issues.length?{success:!1,error:new(n??_te)(a.issues.map(s=>Mb(s,i,Nb())))}:{success:!0,data:a.value}},Tte=Ste(Db),Ate=n=>async(e,t,r)=>{const i=r?Object.assign(r,{async:!0}):{async:!0};let a=e._zod.run({value:t,issues:[]},i);return a instanceof Promise&&(a=await a),a.issues.length?{success:!1,error:new n(a.issues.map(s=>Mb(s,i,Nb())))}:{success:!0,data:a.value}},Cte=Ate(Db),xte={major:4,minor:0,patch:0},AI=jd("$ZodType",(n,e)=>{var i;var t;n??(n={}),Ex(n._zod,"id",()=>e.type+"_"+mte(10)),n._zod.def=e,n._zod.bag=n._zod.bag||{},n._zod.version=xte;const r=[...n._zod.def.checks??[]];n._zod.traits.has("$ZodCheck")&&r.unshift(n);for(const a of r)for(const s of a._zod.onattach)s(n);if(r.length===0)(t=n._zod).deferred??(t.deferred=[]),(i=n._zod.deferred)==null||i.push(()=>{n._zod.run=n._zod.parse});else{const a=(s,o,u)=>{let c=mT(s),d;for(const h of o){if(h._zod.when){if(!h._zod.when(s))continue}else if(c)continue;const m=s.issues.length,g=h._zod.check(s);if(g instanceof Promise&&(u==null?void 0:u.async)===!1)throw new k_;if(d||g instanceof Promise)d=(d??Promise.resolve()).then(async()=>{await g,s.issues.length!==m&&(c||(c=mT(s,m)))});else{if(s.issues.length===m)continue;c||(c=mT(s,m))}}return d?d.then(()=>s):s};n._zod.run=(s,o)=>{const u=n._zod.parse(s,o);if(u instanceof Promise){if(o.async===!1)throw new k_;return u.then(c=>a(c,r,o))}return a(u,r,o)}}n["~standard"]={validate:a=>{var s;try{const o=Tte(n,a);return o.success?{value:o.data}:{issues:(s=o.error)==null?void 0:s.issues}}catch{return Cte(n,a).then(u=>{var c;return u.success?{value:u.data}:{issues:(c=u.error)==null?void 0:c.issues}})}},vendor:"zod",version:1}}),Rte=jd("$ZodUnknown",(n,e)=>{AI.init(n,e),n._zod.parse=t=>t}),Ite=jd("$ZodNever",(n,e)=>{AI.init(n,e),n._zod.parse=(t,r)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:n}),t)}),Pte=jd("$ZodOptional",(n,e)=>{AI.init(n,e),n._zod.optin="optional",n._zod.optout="optional",Ex(n._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),Ex(n._zod,"pattern",()=>{const t=e.innerType._zod.pattern;return t?new RegExp(`^(${hte(t.source)})?$`):void 0}),n._zod.parse=(t,r)=>t.value===void 0?t:e.innerType._zod.run(t,r)});class S5{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...t){const r=t[0];if(this._map.set(e,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,e)}return this}remove(e){return this._map.delete(e),this}get(e){const t=e._zod.parent;if(t){const r={...this.get(t)??{}};return delete r.id,{...r,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}}function Ote(){return new S5}const za=Ote();function kte(n){return new n({type:"unknown"})}function Nte(n,e){return new n({type:"never",...gte()})}class qL{constructor(e){this.counter=0,this.metadataRegistry=(e==null?void 0:e.metadata)??za,this.target=(e==null?void 0:e.target)??"draft-2020-12",this.unrepresentable=(e==null?void 0:e.unrepresentable)??"throw",this.override=(e==null?void 0:e.override)??(()=>{}),this.io=(e==null?void 0:e.io)??"output",this.seen=new Map}process(e,t={path:[],schemaPath:[]}){var h,m,g;var r;const i=e._zod.def,a={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},s=this.seen.get(e);if(s)return s.count++,t.schemaPath.includes(e)&&(s.cycle=t.path),s.schema;const o={schema:{},count:1,cycle:void 0};this.seen.set(e,o);const u=(m=(h=e._zod).toJSONSchema)==null?void 0:m.call(h);if(u)o.schema=u;else{const _={...t,schemaPath:[...t.schemaPath,e],path:t.path},w=e._zod.parent;if(w)o.ref=w,this.process(w,_),this.seen.get(w).isParent=!0;else{const S=o.schema;switch(i.type){case"string":{const E=S;E.type="string";const{minimum:C,maximum:A,format:R,patterns:P,contentEncoding:N}=e._zod.bag;if(typeof C=="number"&&(E.minLength=C),typeof A=="number"&&(E.maxLength=A),R&&(E.format=a[R]??R,E.format===""&&delete E.format),N&&(E.contentEncoding=N),P&&P.size>0){const U=[...P];U.length===1?E.pattern=U[0].source:U.length>1&&(o.schema.allOf=[...U.map(k=>({...this.target==="draft-7"?{type:"string"}:{},pattern:k.source}))])}break}case"number":{const E=S,{minimum:C,maximum:A,format:R,multipleOf:P,exclusiveMaximum:N,exclusiveMinimum:U}=e._zod.bag;typeof R=="string"&&R.includes("int")?E.type="integer":E.type="number",typeof U=="number"&&(E.exclusiveMinimum=U),typeof C=="number"&&(E.minimum=C,typeof U=="number"&&(U>=C?delete E.minimum:delete E.exclusiveMinimum)),typeof N=="number"&&(E.exclusiveMaximum=N),typeof A=="number"&&(E.maximum=A,typeof N=="number"&&(N<=A?delete E.maximum:delete E.exclusiveMaximum)),typeof P=="number"&&(E.multipleOf=P);break}case"boolean":{const E=S;E.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"undefined":{const E=S;E.type="null";break}case"null":{S.type="null";break}case"any":break;case"unknown":break;case"never":{S.not={};break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{const E=S,{minimum:C,maximum:A}=e._zod.bag;typeof C=="number"&&(E.minItems=C),typeof A=="number"&&(E.maxItems=A),E.type="array",E.items=this.process(i.element,{..._,path:[..._.path,"items"]});break}case"object":{const E=S;E.type="object",E.properties={};const C=i.shape;for(const P in C)E.properties[P]=this.process(C[P],{..._,path:[..._.path,"properties",P]});const A=new Set(Object.keys(C)),R=new Set([...A].filter(P=>{const N=i.shape[P]._zod;return this.io==="input"?N.optin===void 0:N.optout===void 0}));R.size>0&&(E.required=Array.from(R)),((g=i.catchall)==null?void 0:g._zod.def.type)==="never"?E.additionalProperties=!1:i.catchall?i.catchall&&(E.additionalProperties=this.process(i.catchall,{..._,path:[..._.path,"additionalProperties"]})):this.io==="output"&&(E.additionalProperties=!1);break}case"union":{const E=S;E.anyOf=i.options.map((C,A)=>this.process(C,{..._,path:[..._.path,"anyOf",A]}));break}case"intersection":{const E=S,C=this.process(i.left,{..._,path:[..._.path,"allOf",0]}),A=this.process(i.right,{..._,path:[..._.path,"allOf",1]}),R=N=>"allOf"in N&&Object.keys(N).length===1,P=[...R(C)?C.allOf:[C],...R(A)?A.allOf:[A]];E.allOf=P;break}case"tuple":{const E=S;E.type="array";const C=i.items.map((P,N)=>this.process(P,{..._,path:[..._.path,"prefixItems",N]}));if(this.target==="draft-2020-12"?E.prefixItems=C:E.items=C,i.rest){const P=this.process(i.rest,{..._,path:[..._.path,"items"]});this.target==="draft-2020-12"?E.items=P:E.additionalItems=P}i.rest&&(E.items=this.process(i.rest,{..._,path:[..._.path,"items"]}));const{minimum:A,maximum:R}=e._zod.bag;typeof A=="number"&&(E.minItems=A),typeof R=="number"&&(E.maxItems=R);break}case"record":{const E=S;E.type="object",E.propertyNames=this.process(i.keyType,{..._,path:[..._.path,"propertyNames"]}),E.additionalProperties=this.process(i.valueType,{..._,path:[..._.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{const E=S,C=fte(i.entries);C.every(A=>typeof A=="number")&&(E.type="number"),C.every(A=>typeof A=="string")&&(E.type="string"),E.enum=C;break}case"literal":{const E=S,C=[];for(const A of i.values)if(A===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof A=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");C.push(Number(A))}else C.push(A);if(C.length!==0)if(C.length===1){const A=C[0];E.type=A===null?"null":typeof A,E.const=A}else C.every(A=>typeof A=="number")&&(E.type="number"),C.every(A=>typeof A=="string")&&(E.type="string"),C.every(A=>typeof A=="boolean")&&(E.type="string"),C.every(A=>A===null)&&(E.type="null"),E.enum=C;break}case"file":{const E=S,C={type:"string",format:"binary",contentEncoding:"binary"},{minimum:A,maximum:R,mime:P}=e._zod.bag;A!==void 0&&(C.minLength=A),R!==void 0&&(C.maxLength=R),P?P.length===1?(C.contentMediaType=P[0],Object.assign(E,C)):E.anyOf=P.map(N=>({...C,contentMediaType:N})):Object.assign(E,C);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{const E=this.process(i.innerType,_);S.anyOf=[E,{type:"null"}];break}case"nonoptional":{this.process(i.innerType,_),o.ref=i.innerType;break}case"success":{const E=S;E.type="boolean";break}case"default":{this.process(i.innerType,_),o.ref=i.innerType,S.default=JSON.parse(JSON.stringify(i.defaultValue));break}case"prefault":{this.process(i.innerType,_),o.ref=i.innerType,this.io==="input"&&(S._prefault=JSON.parse(JSON.stringify(i.defaultValue)));break}case"catch":{this.process(i.innerType,_),o.ref=i.innerType;let E;try{E=i.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}S.default=E;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{const E=S,C=e._zod.pattern;if(!C)throw new Error("Pattern not found in template literal");E.type="string",E.pattern=C.source;break}case"pipe":{const E=this.io==="input"?i.in._zod.def.type==="transform"?i.out:i.in:i.out;this.process(E,_),o.ref=E;break}case"readonly":{this.process(i.innerType,_),o.ref=i.innerType,S.readOnly=!0;break}case"promise":{this.process(i.innerType,_),o.ref=i.innerType;break}case"optional":{this.process(i.innerType,_),o.ref=i.innerType;break}case"lazy":{const E=e._zod.innerType;this.process(E,_),o.ref=E;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}}}}const c=this.metadataRegistry.get(e);return c&&Object.assign(o.schema,c),this.io==="input"&&_r(e)&&(delete o.schema.examples,delete o.schema.default),this.io==="input"&&o.schema._prefault&&((r=o.schema).default??(r.default=o.schema._prefault)),delete o.schema._prefault,this.seen.get(e).schema}emit(e,t){var d,h,m,g;const r={cycles:(t==null?void 0:t.cycles)??"ref",reused:(t==null?void 0:t.reused)??"inline",external:(t==null?void 0:t.external)??void 0},i=this.seen.get(e);if(!i)throw new Error("Unprocessed schema. This is a bug in Zod.");const a=_=>{var A;const w=this.target==="draft-2020-12"?"$defs":"definitions";if(r.external){const R=(A=r.external.registry.get(_[0]))==null?void 0:A.id;if(R)return{ref:r.external.uri(R)};const P=_[1].defId??_[1].schema.id??`schema${this.counter++}`;return _[1].defId=P,{defId:P,ref:`${r.external.uri("__shared")}#/${w}/${P}`}}if(_[1]===i)return{ref:"#"};const E=`#/${w}/`,C=_[1].schema.id??`__schema${this.counter++}`;return{defId:C,ref:E+C}},s=_=>{if(_[1].schema.$ref)return;const w=_[1],{ref:S,defId:E}=a(_);w.def={...w.schema},E&&(w.defId=E);const C=w.schema;for(const A in C)delete C[A];C.$ref=S};for(const _ of this.seen.entries()){const w=_[1];if(e===_[0]){s(_);continue}if(r.external){const E=(d=r.external.registry.get(_[0]))==null?void 0:d.id;if(e!==_[0]&&E){s(_);continue}}if((h=this.metadataRegistry.get(_[0]))==null?void 0:h.id){s(_);continue}if(w.cycle){if(r.cycles==="throw")throw new Error(`Cycle detected: #/${(m=w.cycle)==null?void 0:m.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`);r.cycles==="ref"&&s(_);continue}if(w.count>1&&r.reused==="ref"){s(_);continue}}const o=(_,w)=>{const S=this.seen.get(_),E=S.def??S.schema,C={...E};if(S.ref===null)return;const A=S.ref;if(S.ref=null,A){o(A,w);const R=this.seen.get(A).schema;R.$ref&&w.target==="draft-7"?(E.allOf=E.allOf??[],E.allOf.push(R)):(Object.assign(E,R),Object.assign(E,C))}S.isParent||this.override({zodSchema:_,jsonSchema:E})};for(const _ of[...this.seen.entries()].reverse())o(_[0],{target:this.target});const u={};this.target==="draft-2020-12"?u.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?u.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),Object.assign(u,i.def);const c=((g=r.external)==null?void 0:g.defs)??{};for(const _ of this.seen.entries()){const w=_[1];w.def&&w.defId&&(c[w.defId]=w.def)}!r.external&&Object.keys(c).length>0&&(this.target==="draft-2020-12"?u.$defs=c:u.definitions=c);try{return JSON.parse(JSON.stringify(u))}catch{throw new Error("Error converting schema to JSON.")}}}function Sx(n,e){if(n instanceof S5){const r=new qL(e),i={};for(const o of n._idmap.entries()){const[u,c]=o;r.process(c)}const a={},s={registry:n,uri:(e==null?void 0:e.uri)||(o=>o),defs:i};for(const o of n._idmap.entries()){const[u,c]=o;a[u]=r.emit(c,{...e,external:s})}if(Object.keys(i).length>0){const o=r.target==="draft-2020-12"?"$defs":"definitions";a.__shared={[o]:i}}return{schemas:a}}const t=new qL(e);return t.process(n),t.emit(n,e)}function _r(n,e){const t=e??{seen:new Set};if(t.seen.has(n))return!1;t.seen.add(n);const i=n._zod.def;switch(i.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return _r(i.element,t);case"object":{for(const a in i.shape)if(_r(i.shape[a],t))return!0;return!1}case"union":{for(const a of i.options)if(_r(a,t))return!0;return!1}case"intersection":return _r(i.left,t)||_r(i.right,t);case"tuple":{for(const a of i.items)if(_r(a,t))return!0;return!!(i.rest&&_r(i.rest,t))}case"record":return _r(i.keyType,t)||_r(i.valueType,t);case"map":return _r(i.keyType,t)||_r(i.valueType,t);case"set":return _r(i.valueType,t);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return _r(i.innerType,t);case"lazy":return _r(i.getter(),t);case"default":return _r(i.innerType,t);case"prefault":return _r(i.innerType,t);case"custom":return!1;case"transform":return!0;case"pipe":return _r(i.in,t)||_r(i.out,t);case"success":return!1;case"catch":return!1}throw new Error(`Unknown schema type: ${i.type}`)}const Mte=Symbol("Let zodToJsonSchema decide on which parser to use"),Dte={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},$te=n=>({...Dte,...n}),Lte=n=>{const e=$te(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,i])=>[i._def,{def:i._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function T5(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function yn(n,e,t,r,i){n[e]=t,T5(n,e,r,i)}const A5=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")};function Ta(n){if(n.target!=="openAi")return{};const e=[...n.basePath,n.definitionPath,n.openAiAnyTypeName];return n.flags.hasReferencedOpenAiAnyType=!0,{$ref:n.$refStrategy==="relative"?A5(e,n.currentPath):e.join("/")}}function Ute(n,e){var r,i,a;const t={type:"array"};return(r=n.type)!=null&&r._def&&((a=(i=n.type)==null?void 0:i._def)==null?void 0:a.typeName)!==Ue.ZodAny&&(t.items=dn(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&yn(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&yn(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(yn(t,"minItems",n.exactLength.value,n.exactLength.message,e),yn(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function jte(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?yn(t,"minimum",r.value,r.message,e):yn(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),yn(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?yn(t,"maximum",r.value,r.message,e):yn(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),yn(t,"maximum",r.value,r.message,e));break;case"multipleOf":yn(t,"multipleOf",r.value,r.message,e);break}return t}function Fte(){return{type:"boolean"}}function C5(n,e){return dn(n.type._def,e)}const Bte=(n,e)=>dn(n.innerType._def,e);function x5(n,e,t){const r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((i,a)=>x5(n,e,i))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return qte(n,e)}}const qte=(n,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const r of n.checks)switch(r.kind){case"min":yn(t,"minimum",r.value,r.message,e);break;case"max":yn(t,"maximum",r.value,r.message,e);break}return t};function Vte(n,e){return{...dn(n.innerType._def,e),default:n.defaultValue()}}function zte(n,e){return e.effectStrategy==="input"?dn(n.schema._def,e):Ta(e)}function Hte(n){return{type:"string",enum:Array.from(n.values)}}const Gte=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function Wte(n,e){const t=[dn(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),dn(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const i=[];return t.forEach(a=>{if(Gte(a))i.push(...a.allOf),a.unevaluatedProperties===void 0&&(r=void 0);else{let s=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...u}=a;s=u}else r=void 0;i.push(s)}}),i.length?{allOf:i,...r}:void 0}function Kte(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}let gT;const os={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(gT===void 0&&(gT=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),gT),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function R5(n,e){const t={type:"string"};if(n.checks)for(const r of n.checks)switch(r.kind){case"min":yn(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e);break;case"max":yn(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":ls(t,"email",r.message,e);break;case"format:idn-email":ls(t,"idn-email",r.message,e);break;case"pattern:zod":mi(t,os.email,r.message,e);break}break;case"url":ls(t,"uri",r.message,e);break;case"uuid":ls(t,"uuid",r.message,e);break;case"regex":mi(t,r.regex,r.message,e);break;case"cuid":mi(t,os.cuid,r.message,e);break;case"cuid2":mi(t,os.cuid2,r.message,e);break;case"startsWith":mi(t,RegExp(`^${yT(r.value,e)}`),r.message,e);break;case"endsWith":mi(t,RegExp(`${yT(r.value,e)}$`),r.message,e);break;case"datetime":ls(t,"date-time",r.message,e);break;case"date":ls(t,"date",r.message,e);break;case"time":ls(t,"time",r.message,e);break;case"duration":ls(t,"duration",r.message,e);break;case"length":yn(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e),yn(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"includes":{mi(t,RegExp(yT(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&ls(t,"ipv4",r.message,e),r.version!=="v4"&&ls(t,"ipv6",r.message,e);break}case"base64url":mi(t,os.base64url,r.message,e);break;case"jwt":mi(t,os.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&mi(t,os.ipv4Cidr,r.message,e),r.version!=="v4"&&mi(t,os.ipv6Cidr,r.message,e);break}case"emoji":mi(t,os.emoji(),r.message,e);break;case"ulid":{mi(t,os.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{ls(t,"binary",r.message,e);break}case"contentEncoding:base64":{yn(t,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{mi(t,os.base64,r.message,e);break}}break}case"nanoid":mi(t,os.nanoid,r.message,e)}return t}function yT(n,e){return e.patternStrategy==="escape"?Yte(n):n}const Jte=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function Yte(n){let e="";for(let t=0;t<n.length;t++)Jte.has(n[t])||(e+="\\"),e+=n[t];return e}function ls(n,e,t,r){var i;n.format||(i=n.anyOf)!=null&&i.some(a=>a.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):yn(n,"format",e,t,r)}function mi(n,e,t,r){var i;n.pattern||(i=n.allOf)!=null&&i.some(a=>a.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:VL(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):yn(n,"pattern",VL(e,r),t,r)}function VL(n,e){var u;if(!e.applyRegexFlags||!n.flags)return n.source;const t={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},r=t.i?n.source.toLowerCase():n.source;let i="",a=!1,s=!1,o=!1;for(let c=0;c<r.length;c++){if(a){i+=r[c],a=!1;continue}if(t.i){if(s){if(r[c].match(/[a-z]/)){o?(i+=r[c],i+=`${r[c-2]}-${r[c]}`.toUpperCase(),o=!1):r[c+1]==="-"&&((u=r[c+2])!=null&&u.match(/[a-z]/))?(i+=r[c],o=!0):i+=`${r[c]}${r[c].toUpperCase()}`;continue}}else if(r[c].match(/[a-z]/)){i+=`[${r[c]}${r[c].toUpperCase()}]`;continue}}if(t.m){if(r[c]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(r[c]==="$"){i+=`($|(?=[\r
]))`;continue}}if(t.s&&r[c]==="."){i+=s?`${r[c]}\r
`:`[${r[c]}\r
]`;continue}i+=r[c],r[c]==="\\"?a=!0:s&&r[c]==="]"?s=!1:!s&&r[c]==="["&&(s=!0)}try{new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return i}function I5(n,e){var r,i,a,s,o,u;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((r=n.keyType)==null?void 0:r._def.typeName)===Ue.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((c,d)=>({...c,[d]:dn(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",d]})??Ta(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};const t={type:"object",additionalProperties:dn(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(((i=n.keyType)==null?void 0:i._def.typeName)===Ue.ZodString&&((a=n.keyType._def.checks)!=null&&a.length)){const{type:c,...d}=R5(n.keyType._def,e);return{...t,propertyNames:d}}else{if(((s=n.keyType)==null?void 0:s._def.typeName)===Ue.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};if(((o=n.keyType)==null?void 0:o._def.typeName)===Ue.ZodBranded&&n.keyType._def.type._def.typeName===Ue.ZodString&&((u=n.keyType._def.type._def.checks)!=null&&u.length)){const{type:c,...d}=C5(n.keyType._def,e);return{...t,propertyNames:d}}}return t}function Zte(n,e){if(e.mapStrategy==="record")return I5(n,e);const t=dn(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||Ta(e),r=dn(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||Ta(e);return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function Xte(n){const e=n.values,r=Object.keys(n.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),i=Array.from(new Set(r.map(a=>typeof a)));return{type:i.length===1?i[0]==="string"?"string":"number":["string","number"],enum:r}}function Qte(n){return n.target==="openAi"?void 0:{not:Ta({...n,currentPath:[...n.currentPath,"not"]})}}function ene(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const N_={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function tne(n,e){if(e.target==="openApi3")return zL(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in N_&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((i,a)=>{const s=N_[a._def.typeName];return s&&!i.includes(s)?[...i,s]:i},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((i,a)=>{const s=typeof a._def.value;switch(s){case"string":case"number":case"boolean":return[...i,s];case"bigint":return[...i,"integer"];case"object":if(a._def.value===null)return[...i,"null"];case"symbol":case"undefined":case"function":default:return i}},[]);if(r.length===t.length){const i=r.filter((a,s,o)=>o.indexOf(a)===s);return{type:i.length>1?i:i[0],enum:t.reduce((a,s)=>a.includes(s._def.value)?a:[...a,s._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,i)=>[...r,...i._def.values.filter(a=>!r.includes(a))],[])};return zL(n,e)}const zL=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,i)=>dn(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${i}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function nne(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"?{type:N_[n.innerType._def.typeName],nullable:!0}:{type:[N_[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=dn(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const t=dn(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function rne(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",T5(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?yn(t,"minimum",r.value,r.message,e):yn(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),yn(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?yn(t,"maximum",r.value,r.message,e):yn(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),yn(t,"maximum",r.value,r.message,e));break;case"multipleOf":yn(t,"multipleOf",r.value,r.message,e);break}return t}function ine(n,e){const t=e.target==="openAi",r={type:"object",properties:{}},i=[],a=n.shape();for(const o in a){let u=a[o];if(u===void 0||u._def===void 0)continue;let c=sne(u);c&&t&&(u._def.typeName==="ZodOptional"&&(u=u._def.innerType),u.isNullable()||(u=u.nullable()),c=!1);const d=dn(u._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});d!==void 0&&(r.properties[o]=d,c||i.push(o))}i.length&&(r.required=i);const s=ane(n,e);return s!==void 0&&(r.additionalProperties=s),r}function ane(n,e){if(n.catchall._def.typeName!=="ZodNever")return dn(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(n.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function sne(n){try{return n.isOptional()}catch{return!0}}const one=(n,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return dn(n.innerType._def,e);const t=dn(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:Ta(e)},t]}:Ta(e)},lne=(n,e)=>{if(e.pipeStrategy==="input")return dn(n.in._def,e);if(e.pipeStrategy==="output")return dn(n.out._def,e);const t=dn(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=dn(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(i=>i!==void 0)}};function une(n,e){return dn(n.type._def,e)}function cne(n,e){const r={type:"array",uniqueItems:!0,items:dn(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&yn(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&yn(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function fne(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>dn(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:dn(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>dn(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function dne(n){return{not:Ta(n)}}function hne(n){return Ta(n)}const pne=(n,e)=>dn(n.innerType._def,e),mne=(n,e,t)=>{switch(e){case Ue.ZodString:return R5(n,t);case Ue.ZodNumber:return rne(n,t);case Ue.ZodObject:return ine(n,t);case Ue.ZodBigInt:return jte(n,t);case Ue.ZodBoolean:return Fte();case Ue.ZodDate:return x5(n,t);case Ue.ZodUndefined:return dne(t);case Ue.ZodNull:return ene(t);case Ue.ZodArray:return Ute(n,t);case Ue.ZodUnion:case Ue.ZodDiscriminatedUnion:return tne(n,t);case Ue.ZodIntersection:return Wte(n,t);case Ue.ZodTuple:return fne(n,t);case Ue.ZodRecord:return I5(n,t);case Ue.ZodLiteral:return Kte(n,t);case Ue.ZodEnum:return Hte(n);case Ue.ZodNativeEnum:return Xte(n);case Ue.ZodNullable:return nne(n,t);case Ue.ZodOptional:return one(n,t);case Ue.ZodMap:return Zte(n,t);case Ue.ZodSet:return cne(n,t);case Ue.ZodLazy:return()=>n.getter()._def;case Ue.ZodPromise:return une(n,t);case Ue.ZodNaN:case Ue.ZodNever:return Qte(t);case Ue.ZodEffects:return zte(n,t);case Ue.ZodAny:return Ta(t);case Ue.ZodUnknown:return hne(t);case Ue.ZodDefault:return Vte(n,t);case Ue.ZodBranded:return C5(n,t);case Ue.ZodReadonly:return pne(n,t);case Ue.ZodCatch:return Bte(n,t);case Ue.ZodPipeline:return lne(n,t);case Ue.ZodFunction:case Ue.ZodVoid:case Ue.ZodSymbol:return;default:return(r=>{})()}};function dn(n,e,t=!1){var o;const r=e.seen.get(n);if(e.override){const u=(o=e.override)==null?void 0:o.call(e,n,e,r,t);if(u!==Mte)return u}if(r&&!t){const u=gne(r,e);if(u!==void 0)return u}const i={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,i);const a=mne(n,n.typeName,e),s=typeof a=="function"?dn(a(),e):a;if(s&&yne(n,e,s),e.postProcess){const u=e.postProcess(s,n,e);return i.jsonSchema=s,u}return i.jsonSchema=s,s}const gne=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"relative":return{$ref:A5(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),Ta(e)):e.$refStrategy==="seen"?Ta(e):void 0}},yne=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),vne=(n,e)=>{const t=Lte(e);let r;const i=e==null?void 0:e.name,a=dn(n._def,t,!1)??Ta(t);t.flags.hasReferencedOpenAiAnyType&&(r||(r={}),r[t.openAiAnyTypeName]||(r[t.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:t.$refStrategy==="relative"?"1":[...t.basePath,t.definitionPath,t.openAiAnyTypeName].join("/")}}));const s=i===void 0?r?{...a,[t.definitionPath]:r}:a:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,i].join("/"),[t.definitionPath]:{...r,[i]:a}};return t.target==="jsonSchema7"?s.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(s.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in s||"oneOf"in s||"allOf"in s||"type"in s&&Array.isArray(s.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),s};function Ju(n,e){const t=typeof n;if(t!==typeof e)return!1;if(Array.isArray(n)){if(!Array.isArray(e))return!1;const r=n.length;if(r!==e.length)return!1;for(let i=0;i<r;i++)if(!Ju(n[i],e[i]))return!1;return!0}if(t==="object"){if(!n||!e)return n===e;const r=Object.keys(n),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!Ju(n[s],e[s]))return!1;return!0}return n===e}function hs(n){return encodeURI(_ne(n))}function _ne(n){return n.replace(/~/g,"~0").replace(/\//g,"~1")}const bne={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},wne={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},Ene={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};let Sne=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function zl(n,e=Object.create(null),t=Sne,r=""){if(n&&typeof n=="object"&&!Array.isArray(n)){const a=n.$id||n.id;if(a){const s=new URL(a,t.href);s.hash.length>1?e[s.href]=n:(s.hash="",r===""?t=s:zl(n,e,t))}}else if(n!==!0&&n!==!1)return e;const i=t.href+(r?"#"+r:"");if(e[i]!==void 0)throw new Error(`Duplicate schema URI "${i}".`);if(e[i]=n,n===!0||n===!1)return e;if(n.__absolute_uri__===void 0&&Object.defineProperty(n,"__absolute_uri__",{enumerable:!1,value:i}),n.$ref&&n.__absolute_ref__===void 0){const a=new URL(n.$ref,t.href);a.hash=a.hash,Object.defineProperty(n,"__absolute_ref__",{enumerable:!1,value:a.href})}if(n.$recursiveRef&&n.__absolute_recursive_ref__===void 0){const a=new URL(n.$recursiveRef,t.href);a.hash=a.hash,Object.defineProperty(n,"__absolute_recursive_ref__",{enumerable:!1,value:a.href})}if(n.$anchor){const a=new URL("#"+n.$anchor,t.href);e[a.href]=n}for(let a in n){if(Ene[a])continue;const s=`${r}/${hs(a)}`,o=n[a];if(Array.isArray(o)){if(bne[a]){const u=o.length;for(let c=0;c<u;c++)zl(o[c],e,t,`${s}/${c}`)}}else if(wne[a])for(let u in o)zl(o[u],e,t,`${s}/${hs(u)}`);else zl(o,e,t,s)}return e}const Tne=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,Ane=[0,31,28,31,30,31,30,31,31,30,31,30,31],Cne=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,xne=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,Rne=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,Ine=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,Pne=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,One=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,kne=/^(?:\/(?:[^~/]|~0|~1)*)*$/,Nne=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,Mne=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,Dne=n=>{if(n[0]==='"')return!1;const[e,t,...r]=n.split("@");return!e||!t||r.length!==0||e.length>64||t.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(t)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:t.split(".").every(i=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(i))},$ne=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,Lne=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,Une=n=>n.length>1&&n.length<80&&(/^P\d+([.,]\d+)?W$/.test(n)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(n)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(n));function Fs(n){return n.test.bind(n)}const HL={date:P5,time:O5.bind(void 0,!1),"date-time":Bne,duration:Une,uri:zne,"uri-reference":Fs(Rne),"uri-template":Fs(Ine),url:Fs(Pne),email:Dne,hostname:Fs(xne),ipv4:Fs($ne),ipv6:Fs(Lne),regex:Gne,uuid:Fs(One),"json-pointer":Fs(kne),"json-pointer-uri-fragment":Fs(Nne),"relative-json-pointer":Fs(Mne)};function jne(n){return n%4===0&&(n%100!==0||n%400===0)}function P5(n){const e=n.match(Tne);if(!e)return!1;const t=+e[1],r=+e[2],i=+e[3];return r>=1&&r<=12&&i>=1&&i<=(r==2&&jne(t)?29:Ane[r])}function O5(n,e){const t=e.match(Cne);if(!t)return!1;const r=+t[1],i=+t[2],a=+t[3],s=!!t[5];return(r<=23&&i<=59&&a<=59||r==23&&i==59&&a==60)&&(!n||s)}const Fne=/t|\s/i;function Bne(n){const e=n.split(Fne);return e.length==2&&P5(e[0])&&O5(!0,e[1])}const qne=/\/|:/,Vne=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function zne(n){return qne.test(n)&&Vne.test(n)}const Hne=/[^\\]\\Z/;function Gne(n){if(Hne.test(n))return!1;try{return new RegExp(n,"u"),!0}catch{return!1}}function Wne(n){let e=0,t=n.length,r=0,i;for(;r<t;)e++,i=n.charCodeAt(r++),i>=55296&&i<=56319&&r<t&&(i=n.charCodeAt(r),(i&64512)==56320&&r++);return e}function Ln(n,e,t="2019-09",r=zl(e),i=!0,a=null,s="#",o="#",u=Object.create(null)){if(e===!0)return{valid:!0,errors:[]};if(e===!1)return{valid:!1,errors:[{instanceLocation:s,keyword:"false",keywordLocation:s,error:"False boolean schema."}]};const c=typeof n;let d;switch(c){case"boolean":case"number":case"string":d=c;break;case"object":n===null?d="null":Array.isArray(n)?d="array":d="object";break;default:throw new Error(`Instances of "${c}" type are not supported.`)}const{$ref:h,$recursiveRef:m,$recursiveAnchor:g,type:_,const:w,enum:S,required:E,not:C,anyOf:A,allOf:R,oneOf:P,if:N,then:U,else:k,format:B,properties:H,patternProperties:G,additionalProperties:z,unevaluatedProperties:oe,minProperties:te,maxProperties:se,propertyNames:ee,dependentRequired:le,dependentSchemas:pe,dependencies:we,prefixItems:$,items:ve,additionalItems:Te,unevaluatedItems:F,contains:ae,minContains:fe,maxContains:I,minItems:O,maxItems:J,uniqueItems:X,minimum:ue,maximum:V,exclusiveMinimum:K,exclusiveMaximum:_e,multipleOf:Me,minLength:tt,maxLength:je,pattern:We,__absolute_ref__:Ot,__absolute_recursive_ref__:Pe}=e,He=[];if(g===!0&&a===null&&(a=e),m==="#"){const Ge=a===null?r[Pe]:a,ze=`${o}/$recursiveRef`,it=Ln(n,a===null?e:a,t,r,i,Ge,s,ze,u);it.valid||He.push({instanceLocation:s,keyword:"$recursiveRef",keywordLocation:ze,error:"A subschema had errors."},...it.errors)}if(h!==void 0){const ze=r[Ot||h];if(ze===void 0){let he=`Unresolved $ref "${h}".`;throw Ot&&Ot!==h&&(he+=`  Absolute URI "${Ot}".`),he+=`
Known schemas:
- ${Object.keys(r).join(`
- `)}`,new Error(he)}const it=`${o}/$ref`,Ze=Ln(n,ze,t,r,i,a,s,it,u);if(Ze.valid||He.push({instanceLocation:s,keyword:"$ref",keywordLocation:it,error:"A subschema had errors."},...Ze.errors),t==="4"||t==="7")return{valid:He.length===0,errors:He}}if(Array.isArray(_)){let Ge=_.length,ze=!1;for(let it=0;it<Ge;it++)if(d===_[it]||_[it]==="integer"&&d==="number"&&n%1===0&&n===n){ze=!0;break}ze||He.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${d}" is invalid. Expected "${_.join('", "')}".`})}else _==="integer"?(d!=="number"||n%1||n!==n)&&He.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${d}" is invalid. Expected "${_}".`}):_!==void 0&&d!==_&&He.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${d}" is invalid. Expected "${_}".`});if(w!==void 0&&(d==="object"||d==="array"?Ju(n,w)||He.push({instanceLocation:s,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(w)}.`}):n!==w&&He.push({instanceLocation:s,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(w)}.`})),S!==void 0&&(d==="object"||d==="array"?S.some(Ge=>Ju(n,Ge))||He.push({instanceLocation:s,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(S)}.`}):S.some(Ge=>n===Ge)||He.push({instanceLocation:s,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(S)}.`})),C!==void 0){const Ge=`${o}/not`;Ln(n,C,t,r,i,a,s,Ge).valid&&He.push({instanceLocation:s,keyword:"not",keywordLocation:Ge,error:'Instance matched "not" schema.'})}let At=[];if(A!==void 0){const Ge=`${o}/anyOf`,ze=He.length;let it=!1;for(let Ze=0;Ze<A.length;Ze++){const he=A[Ze],Ie=Object.create(u),Be=Ln(n,he,t,r,i,g===!0?a:null,s,`${Ge}/${Ze}`,Ie);He.push(...Be.errors),it=it||Be.valid,Be.valid&&At.push(Ie)}it?He.length=ze:He.splice(ze,0,{instanceLocation:s,keyword:"anyOf",keywordLocation:Ge,error:"Instance does not match any subschemas."})}if(R!==void 0){const Ge=`${o}/allOf`,ze=He.length;let it=!0;for(let Ze=0;Ze<R.length;Ze++){const he=R[Ze],Ie=Object.create(u),Be=Ln(n,he,t,r,i,g===!0?a:null,s,`${Ge}/${Ze}`,Ie);He.push(...Be.errors),it=it&&Be.valid,Be.valid&&At.push(Ie)}it?He.length=ze:He.splice(ze,0,{instanceLocation:s,keyword:"allOf",keywordLocation:Ge,error:"Instance does not match every subschema."})}if(P!==void 0){const Ge=`${o}/oneOf`,ze=He.length,it=P.filter((Ze,he)=>{const Ie=Object.create(u),Be=Ln(n,Ze,t,r,i,g===!0?a:null,s,`${Ge}/${he}`,Ie);return He.push(...Be.errors),Be.valid&&At.push(Ie),Be.valid}).length;it===1?He.length=ze:He.splice(ze,0,{instanceLocation:s,keyword:"oneOf",keywordLocation:Ge,error:`Instance does not match exactly one subschema (${it} matches).`})}if((d==="object"||d==="array")&&Object.assign(u,...At),N!==void 0){const Ge=`${o}/if`;if(Ln(n,N,t,r,i,a,s,Ge,u).valid){if(U!==void 0){const it=Ln(n,U,t,r,i,a,s,`${o}/then`,u);it.valid||He.push({instanceLocation:s,keyword:"if",keywordLocation:Ge,error:'Instance does not match "then" schema.'},...it.errors)}}else if(k!==void 0){const it=Ln(n,k,t,r,i,a,s,`${o}/else`,u);it.valid||He.push({instanceLocation:s,keyword:"if",keywordLocation:Ge,error:'Instance does not match "else" schema.'},...it.errors)}}if(d==="object"){if(E!==void 0)for(const Ze of E)Ze in n||He.push({instanceLocation:s,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${Ze}".`});const Ge=Object.keys(n);if(te!==void 0&&Ge.length<te&&He.push({instanceLocation:s,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${te} properties.`}),se!==void 0&&Ge.length>se&&He.push({instanceLocation:s,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${se} properties.`}),ee!==void 0){const Ze=`${o}/propertyNames`;for(const he in n){const Ie=`${s}/${hs(he)}`,Be=Ln(he,ee,t,r,i,a,Ie,Ze);Be.valid||He.push({instanceLocation:s,keyword:"propertyNames",keywordLocation:Ze,error:`Property name "${he}" does not match schema.`},...Be.errors)}}if(le!==void 0){const Ze=`${o}/dependantRequired`;for(const he in le)if(he in n){const Ie=le[he];for(const Be of Ie)Be in n||He.push({instanceLocation:s,keyword:"dependentRequired",keywordLocation:Ze,error:`Instance has "${he}" but does not have "${Be}".`})}}if(pe!==void 0)for(const Ze in pe){const he=`${o}/dependentSchemas`;if(Ze in n){const Ie=Ln(n,pe[Ze],t,r,i,a,s,`${he}/${hs(Ze)}`,u);Ie.valid||He.push({instanceLocation:s,keyword:"dependentSchemas",keywordLocation:he,error:`Instance has "${Ze}" but does not match dependant schema.`},...Ie.errors)}}if(we!==void 0){const Ze=`${o}/dependencies`;for(const he in we)if(he in n){const Ie=we[he];if(Array.isArray(Ie))for(const Be of Ie)Be in n||He.push({instanceLocation:s,keyword:"dependencies",keywordLocation:Ze,error:`Instance has "${he}" but does not have "${Be}".`});else{const Be=Ln(n,Ie,t,r,i,a,s,`${Ze}/${hs(he)}`);Be.valid||He.push({instanceLocation:s,keyword:"dependencies",keywordLocation:Ze,error:`Instance has "${he}" but does not match dependant schema.`},...Be.errors)}}}const ze=Object.create(null);let it=!1;if(H!==void 0){const Ze=`${o}/properties`;for(const he in H){if(!(he in n))continue;const Ie=`${s}/${hs(he)}`,Be=Ln(n[he],H[he],t,r,i,a,Ie,`${Ze}/${hs(he)}`);if(Be.valid)u[he]=ze[he]=!0;else if(it=i,He.push({instanceLocation:s,keyword:"properties",keywordLocation:Ze,error:`Property "${he}" does not match schema.`},...Be.errors),it)break}}if(!it&&G!==void 0){const Ze=`${o}/patternProperties`;for(const he in G){const Ie=new RegExp(he,"u"),Be=G[he];for(const nt in n){if(!Ie.test(nt))continue;const W=`${s}/${hs(nt)}`,M=Ln(n[nt],Be,t,r,i,a,W,`${Ze}/${hs(he)}`);M.valid?u[nt]=ze[nt]=!0:(it=i,He.push({instanceLocation:s,keyword:"patternProperties",keywordLocation:Ze,error:`Property "${nt}" matches pattern "${he}" but does not match associated schema.`},...M.errors))}}}if(!it&&z!==void 0){const Ze=`${o}/additionalProperties`;for(const he in n){if(ze[he])continue;const Ie=`${s}/${hs(he)}`,Be=Ln(n[he],z,t,r,i,a,Ie,Ze);Be.valid?u[he]=!0:(it=i,He.push({instanceLocation:s,keyword:"additionalProperties",keywordLocation:Ze,error:`Property "${he}" does not match additional properties schema.`},...Be.errors))}}else if(!it&&oe!==void 0){const Ze=`${o}/unevaluatedProperties`;for(const he in n)if(!u[he]){const Ie=`${s}/${hs(he)}`,Be=Ln(n[he],oe,t,r,i,a,Ie,Ze);Be.valid?u[he]=!0:He.push({instanceLocation:s,keyword:"unevaluatedProperties",keywordLocation:Ze,error:`Property "${he}" does not match unevaluated properties schema.`},...Be.errors)}}}else if(d==="array"){J!==void 0&&n.length>J&&He.push({instanceLocation:s,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${n.length} > ${J}).`}),O!==void 0&&n.length<O&&He.push({instanceLocation:s,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${n.length} < ${O}).`});const Ge=n.length;let ze=0,it=!1;if($!==void 0){const Ze=`${o}/prefixItems`,he=Math.min($.length,Ge);for(;ze<he;ze++){const Ie=Ln(n[ze],$[ze],t,r,i,a,`${s}/${ze}`,`${Ze}/${ze}`);if(u[ze]=!0,!Ie.valid&&(it=i,He.push({instanceLocation:s,keyword:"prefixItems",keywordLocation:Ze,error:"Items did not match schema."},...Ie.errors),it))break}}if(ve!==void 0){const Ze=`${o}/items`;if(Array.isArray(ve)){const he=Math.min(ve.length,Ge);for(;ze<he;ze++){const Ie=Ln(n[ze],ve[ze],t,r,i,a,`${s}/${ze}`,`${Ze}/${ze}`);if(u[ze]=!0,!Ie.valid&&(it=i,He.push({instanceLocation:s,keyword:"items",keywordLocation:Ze,error:"Items did not match schema."},...Ie.errors),it))break}}else for(;ze<Ge;ze++){const he=Ln(n[ze],ve,t,r,i,a,`${s}/${ze}`,Ze);if(u[ze]=!0,!he.valid&&(it=i,He.push({instanceLocation:s,keyword:"items",keywordLocation:Ze,error:"Items did not match schema."},...he.errors),it))break}if(!it&&Te!==void 0){const he=`${o}/additionalItems`;for(;ze<Ge;ze++){const Ie=Ln(n[ze],Te,t,r,i,a,`${s}/${ze}`,he);u[ze]=!0,Ie.valid||(it=i,He.push({instanceLocation:s,keyword:"additionalItems",keywordLocation:he,error:"Items did not match additional items schema."},...Ie.errors))}}}if(ae!==void 0)if(Ge===0&&fe===void 0)He.push({instanceLocation:s,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(fe!==void 0&&Ge<fe)He.push({instanceLocation:s,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${Ge}) than minContains (${fe}).`});else{const Ze=`${o}/contains`,he=He.length;let Ie=0;for(let Be=0;Be<Ge;Be++){const nt=Ln(n[Be],ae,t,r,i,a,`${s}/${Be}`,Ze);nt.valid?(u[Be]=!0,Ie++):He.push(...nt.errors)}Ie>=(fe||0)&&(He.length=he),fe===void 0&&I===void 0&&Ie===0?He.splice(he,0,{instanceLocation:s,keyword:"contains",keywordLocation:Ze,error:"Array does not contain item matching schema."}):fe!==void 0&&Ie<fe?He.push({instanceLocation:s,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${fe} items matching schema. Only ${Ie} items were found.`}):I!==void 0&&Ie>I&&He.push({instanceLocation:s,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${I} items matching schema. ${Ie} items were found.`})}if(!it&&F!==void 0){const Ze=`${o}/unevaluatedItems`;for(ze;ze<Ge;ze++){if(u[ze])continue;const he=Ln(n[ze],F,t,r,i,a,`${s}/${ze}`,Ze);u[ze]=!0,he.valid||He.push({instanceLocation:s,keyword:"unevaluatedItems",keywordLocation:Ze,error:"Items did not match unevaluated items schema."},...he.errors)}}if(X)for(let Ze=0;Ze<Ge;Ze++){const he=n[Ze],Ie=typeof he=="object"&&he!==null;for(let Be=0;Be<Ge;Be++){if(Ze===Be)continue;const nt=n[Be];(he===nt||Ie&&(typeof nt=="object"&&nt!==null)&&Ju(he,nt))&&(He.push({instanceLocation:s,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${Ze} and ${Be}.`}),Ze=Number.MAX_SAFE_INTEGER,Be=Number.MAX_SAFE_INTEGER)}}}else if(d==="number"){if(t==="4"?(ue!==void 0&&(K===!0&&n<=ue||n<ue)&&He.push({instanceLocation:s,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${n} is less than ${K?"or equal to ":""} ${ue}.`}),V!==void 0&&(_e===!0&&n>=V||n>V)&&He.push({instanceLocation:s,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${n} is greater than ${_e?"or equal to ":""} ${V}.`})):(ue!==void 0&&n<ue&&He.push({instanceLocation:s,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${n} is less than ${ue}.`}),V!==void 0&&n>V&&He.push({instanceLocation:s,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${n} is greater than ${V}.`}),K!==void 0&&n<=K&&He.push({instanceLocation:s,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${n} is less than ${K}.`}),_e!==void 0&&n>=_e&&He.push({instanceLocation:s,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${n} is greater than or equal to ${_e}.`})),Me!==void 0){const Ge=n%Me;Math.abs(0-Ge)>=11920929e-14&&Math.abs(Me-Ge)>=11920929e-14&&He.push({instanceLocation:s,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${n} is not a multiple of ${Me}.`})}}else if(d==="string"){const Ge=tt===void 0&&je===void 0?0:Wne(n);tt!==void 0&&Ge<tt&&He.push({instanceLocation:s,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${Ge} < ${tt}).`}),je!==void 0&&Ge>je&&He.push({instanceLocation:s,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${Ge} > ${je}).`}),We!==void 0&&!new RegExp(We,"u").test(n)&&He.push({instanceLocation:s,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),B!==void 0&&HL[B]&&!HL[B](n)&&He.push({instanceLocation:s,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${B}".`})}return{valid:He.length===0,errors:He}}class Kne{constructor(e,t="2019-09",r=!0){ti(this,"schema");ti(this,"draft");ti(this,"shortCircuit");ti(this,"lookup");this.schema=e,this.draft=t,this.shortCircuit=r,this.lookup=zl(e)}validate(e){return Ln(e,this.schema,this.draft,this.lookup,this.shortCircuit)}addSchema(e,t){t&&(e={...e,$id:t}),zl(e,this.lookup)}}function dr(n){if(typeof n!="object"||n===null)return!1;const e=n;if(!("_zod"in e))return!1;const t=e._zod;return typeof t=="object"&&t!==null&&"def"in t}function hr(n){if(typeof n!="object"||n===null)return!1;const e=n;if(!("_def"in e)||"_zod"in e)return!1;const t=e._def;return typeof t=="object"&&t!=null&&"typeName"in t}function Jne(n){return dr(n)&&console.warn("[WARNING] Attempting to use Zod 4 schema in a context where Zod 3 schema is expected. This may cause unexpected behavior."),hr(n)}function Ui(n){return!n||typeof n!="object"||Array.isArray(n)?!1:!!(dr(n)||hr(n))}async function $b(n,e){if(dr(n))try{return{success:!0,data:await Ete(n,e)}}catch(t){return{success:!1,error:t}}if(hr(n))return n.safeParse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}async function Lb(n,e){if(dr(n))return Gm(n,e);if(hr(n))return n.parse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function Yne(n,e){if(dr(n))try{return{success:!0,data:Gm(n,e)}}catch(t){return{success:!1,error:t}}if(hr(n))return n.safeParse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function Dv(n,e){if(dr(n))return Gm(n,e);if(hr(n))return n.parse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function Ad(n){var e;if(dr(n))return(e=za.get(n))==null?void 0:e.description;if(hr(n)||"description"in n&&typeof n.description=="string")return n.description}function Zne(n){if(!Ui(n))return!1;if(hr(n)){const e=n._def;if(e.typeName==="ZodObject"){const t=n;return!t.shape||Object.keys(t.shape).length===0}if(e.typeName==="ZodRecord")return!0}if(dr(n)){const e=n._zod.def;if(e.type==="object"){const t=n;return!t.shape||Object.keys(t.shape).length===0}if(e.type==="record")return!0}return typeof n=="object"&&n!==null&&!("shape"in n)}function CI(n){return Ui(n)?hr(n)?n._def.typeName==="ZodString":dr(n)?n._zod.def.type==="string":!1:!1}function xI(n){return typeof n=="object"&&n!==null&&"_def"in n&&typeof n._def=="object"&&n._def!==null&&"typeName"in n._def&&n._def.typeName==="ZodObject"}function lo(n){return dr(n)?typeof n=="object"&&n!==null&&"_zod"in n&&typeof n._zod=="object"&&n._zod!==null&&"def"in n._zod&&typeof n._zod.def=="object"&&n._zod.def!==null&&"type"in n._zod.def&&n._zod.def.type==="object":!1}function Ub(n){return dr(n)?typeof n=="object"&&n!==null&&"_zod"in n&&typeof n._zod=="object"&&n._zod!==null&&"def"in n._zod&&typeof n._zod.def=="object"&&n._zod.def!==null&&"type"in n._zod.def&&n._zod.def.type==="array":!1}function Wo(n){return!!(xI(n)||lo(n))}function Tx(n){if(hr(n))return n.shape;if(dr(n))return n._zod.def.shape;throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function k5(n,e){if(hr(n))return n.extend(e);if(dr(n))return yte(n,e);throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function RI(n){if(hr(n))return n.partial();if(dr(n))return vte(Pte,n);throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function M_(n,e=!1){if(hr(n))return n.strict();if(lo(n)){const t=n._zod.def.shape;if(e)for(const[a,s]of Object.entries(n._zod.def.shape)){if(lo(s)){const u=M_(s,e);t[a]=u}else if(Ub(s)){let u=s._zod.def.element;lo(u)&&(u=M_(u,e)),t[a]=nu(s,{...s._zod.def,element:u})}else t[a]=s;const o=za.get(s);o&&za.add(t[a],o)}const r=nu(n,{...n._zod.def,shape:t,catchall:Nte(Ite)}),i=za.get(n);return i&&za.add(r,i),r}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function Ax(n,e=!1){if(xI(n))return n.passthrough();if(lo(n)){const t=n._zod.def.shape;if(e)for(const[a,s]of Object.entries(n._zod.def.shape)){if(lo(s)){const u=Ax(s,e);t[a]=u}else if(Ub(s)){let u=s._zod.def.element;lo(u)&&(u=Ax(u,e)),t[a]=nu(s,{...s._zod.def,element:u})}else t[a]=s;const o=za.get(s);o&&za.add(t[a],o)}const r=nu(n,{...n._zod.def,shape:t,catchall:kte(Rte)}),i=za.get(n);return i&&za.add(r,i),r}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function Xne(n){if(hr(n))try{const e=n.parse(void 0);return()=>e}catch{return}if(dr(n))try{const e=Gm(n,void 0);return()=>e}catch{return}}function Qne(n){return hr(n)&&"typeName"in n._def&&n._def.typeName==="ZodEffects"}function ere(n){return dr(n)&&n._zod.def.type==="pipe"}function Wf(n,e=!1){if(hr(n))return Qne(n)?Wf(n._def.schema,e):n;if(dr(n)){let t=n;if(ere(n)&&(t=Wf(n._zod.def.in,e)),e){if(lo(t)){const i=t._zod.def.shape;for(const[a,s]of Object.entries(t._zod.def.shape))i[a]=Wf(s,e);t=nu(t,{...t._zod.def,shape:i})}else if(Ub(t)){const i=Wf(t._zod.def.element,e);t=nu(t,{...t._zod.def,element:i})}}const r=za.get(n);return r&&za.add(t,r),t}throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function Tr(n){if(dr(n)){const e=Wf(n,!0);if(lo(e)){const t=M_(e,!0);return Sx(t)}else return Sx(n)}return hr(n)?vne(n):n}function zp(n){if(!n||typeof n!="object"||Object.keys(n).length===0||Array.isArray(n))return!1;if("type"in n)return typeof n.type=="string"?n.type==="string":Array.isArray(n.type)?n.type.every(e=>e==="string"):!1;if("enum"in n)return Array.isArray(n.enum)&&n.enum.length>0&&n.enum.every(e=>typeof e=="string");if("const"in n)return typeof n.const=="string";if("allOf"in n&&Array.isArray(n.allOf))return n.allOf.some(e=>zp(e));if("anyOf"in n&&Array.isArray(n.anyOf)||"oneOf"in n&&Array.isArray(n.oneOf)){const e="anyOf"in n?n.anyOf:n.oneOf;return e.length>0&&e.every(t=>zp(t))}if("not"in n)return!1;if("$ref"in n&&typeof n.$ref=="string"){const e=n.$ref,t=zl(n);return t[e]?zp(t[e]):!1}return!1}const tre=Object.freeze(Object.defineProperty({__proto__:null,Validator:Kne,deepCompareStrict:Ju,toJsonSchema:Tr,validatesOnlyStrings:zp},Symbol.toStringTag,{value:"Module"}));function nre(n,e){if(n!==void 0&&!kv(n))return n;if(TI(e))try{let t=e.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t}catch{return e.getName()}else return e.name??"UnknownSchema"}function rre(n){return TI(n.data)?{type:"runnable",data:{id:n.data.lc_id,name:n.data.getName()}}:{type:"schema",data:{...Tr(n.data.schema),title:n.data.name}}}let D_=class N5{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=kv(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...rre(t)})),edges:this.edges.map(t=>{const r={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(r.data=t.data),typeof t.conditional<"u"&&(r.conditional=t.conditional),r})}}addNode(e,t,r){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);const i=t??jo(),a={id:i,data:e,name:nre(t,e),metadata:r};return this.nodes[i]=a,a}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r,i){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);const a={source:e.id,target:t.id,data:r,conditional:i};return this.edges.push(a),a}firstNode(){return GL(this)}lastNode(){return WL(this)}extend(e,t=""){let r=t;Object.values(e.nodes).map(c=>c.id).every(kv)&&(r="");const a=c=>r?`${r}:${c}`:c;Object.entries(e.nodes).forEach(([c,d])=>{this.nodes[a(c)]={...d,id:a(c)}});const s=e.edges.map(c=>({...c,source:a(c.source),target:a(c.target)}));this.edges=[...this.edges,...s];const o=e.firstNode(),u=e.lastNode();return[o?{id:a(o.id),data:o.data}:void 0,u?{id:a(u.id),data:u.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&GL(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&WL(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(i=>[i.id,i.name])),t=new Map;Object.values(e).forEach(i=>{t.set(i,(t.get(i)||0)+1)});const r=i=>{const a=e[i];return kv(i)&&t.get(a)===1?a:i};return new N5({nodes:Object.fromEntries(Object.entries(this.nodes).map(([i,a])=>[r(i),{...a,id:r(i)}])),edges:this.edges.map(i=>({...i,source:r(i.source),target:r(i.target)}))})}drawMermaid(e){const{withStyles:t,curveStyle:r,nodeColors:i={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:a}=e??{},s=this.reid(),o=s.firstNode(),u=s.lastNode();return lte(s.nodes,s.edges,{firstNode:o==null?void 0:o.id,lastNode:u==null?void 0:u.id,withStyles:t,curveStyle:r,nodeColors:i,wrapLabelNWords:a})}async drawMermaidPng(e){const t=this.drawMermaid(e);return ute(t,{backgroundColor:e==null?void 0:e.backgroundColor})}};function GL(n,e=[]){const t=new Set(n.edges.filter(i=>!e.includes(i.source)).map(i=>i.target)),r=[];for(const i of Object.values(n.nodes))!e.includes(i.id)&&!t.has(i.id)&&r.push(i);return r.length===1?r[0]:void 0}function WL(n,e=[]){const t=new Set(n.edges.filter(i=>!e.includes(i.target)).map(i=>i.source)),r=[];for(const i of Object.values(n.nodes))!e.includes(i.id)&&!t.has(i.id)&&r.push(i);return r.length===1?r[0]:void 0}function ire(n){const e=new TextEncoder,t=new ReadableStream({async start(r){for await(const i of n)r.enqueue(e.encode(`event: data
data: ${JSON.stringify(i)}

`));r.enqueue(e.encode(`event: end

`)),r.close()}});return li.fromReadableStream(t)}function KL(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.iterator]=="function"&&typeof n.next=="function"}const are=n=>n!=null&&typeof n=="object"&&"next"in n&&typeof n.next=="function";function Cx(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.asyncIterator]=="function"}function*JL(n,e){for(;;){const{value:t,done:r}=Hi.runWithConfig(el(n),e.next.bind(e),!0);if(r)break;yield t}}async function*xx(n,e){const t=e[Symbol.asyncIterator]();for(;;){const{value:r,done:i}=await Hi.runWithConfig(el(n),t.next.bind(e),!0);if(i)break;yield r}}function Sr(n,e){return n&&!Array.isArray(n)&&!(n instanceof Date)&&typeof n=="object"?n:{[e]:n}}class Gt extends wa{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new bi({bound:this,kwargs:e,config:{}})}map(){return new gm({bound:this})}withRetry(e){return new II({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new bi({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new M5({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(Qt);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const r=Object.fromEntries(Object.entries(e).filter(([i])=>i!=="runId"));return Array.from({length:t},(i,a)=>Qt(a===0?e:r))}return Array.from({length:t},()=>Qt(e))}async batch(e,t,r){var u;const i=this._getOptionsList(t??{},e.length),a=((u=i[0])==null?void 0:u.maxConcurrency)??(r==null?void 0:r.maxConcurrency),s=new Hm({maxConcurrency:a,onFailedAttempt:c=>{throw c}}),o=e.map((c,d)=>s.call(async()=>{try{return await this.invoke(c,i[d])}catch(h){if(r!=null&&r.returnExceptions)return h;throw h}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const r=Qt(t),i=new Ic({generator:this._streamIterator(e,r),config:r});return await i.setup,li.fromAsyncGenerator(i)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=Qt(e):t=Qt({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}async _callWithConfig(e,t,r){const i=Qt(r),a=await Gi(i),s=await(a==null?void 0:a.handleChainStart(this.toJSON(),Sr(t,"input"),i.runId,i==null?void 0:i.runType,void 0,void 0,(i==null?void 0:i.runName)??this.getName()));delete i.runId;let o;try{const u=e.call(this,t,i,s);o=await eu(u,r==null?void 0:r.signal)}catch(u){throw await(s==null?void 0:s.handleChainError(u)),u}return await(s==null?void 0:s.handleChainEnd(Sr(o,"output"))),o}async _batchWithConfig(e,t,r,i){var c;const a=this._getOptionsList(r??{},t.length),s=await Promise.all(a.map(Gi)),o=await Promise.all(s.map(async(d,h)=>{const m=await(d==null?void 0:d.handleChainStart(this.toJSON(),Sr(t[h],"input"),a[h].runId,a[h].runType,void 0,void 0,a[h].runName??this.getName()));return delete a[h].runId,m}));let u;try{const d=e.call(this,t,a,o,i);u=await eu(d,(c=a==null?void 0:a[0])==null?void 0:c.signal)}catch(d){throw await Promise.all(o.map(h=>h==null?void 0:h.handleChainError(d))),d}return await Promise.all(o.map(d=>d==null?void 0:d.handleChainEnd(Sr(u,"output")))),u}async*_transformStreamWithConfig(e,t,r){let i,a=!0,s,o=!0;const u=Qt(r),c=await Gi(u);async function*d(){for await(const m of e){if(a)if(i===void 0)i=m;else try{i=_i(i,m)}catch{i=void 0,a=!1}yield m}}let h;try{const m=await v5(t.bind(this),d(),async()=>c==null?void 0:c.handleChainStart(this.toJSON(),{input:""},u.runId,u.runType,void 0,void 0,u.runName??this.getName()),r==null?void 0:r.signal,u);delete u.runId,h=m.setup;const g=h==null?void 0:h.handlers.find(ete);let _=m.output;g!==void 0&&h!==void 0&&(_=g.tapOutputIterable(h.runId,_));const w=h==null?void 0:h.handlers.find(_5);w!==void 0&&h!==void 0&&(_=w.tapOutputIterable(h.runId,_));for await(const S of _)if(yield S,o)if(s===void 0)s=S;else try{s=_i(s,S)}catch{s=void 0,o=!1}}catch(m){throw await(h==null?void 0:h.handleChainError(m,void 0,void 0,void 0,{inputs:Sr(i,"input")})),m}await(h==null?void 0:h.handleChainEnd(s??{},void 0,void 0,void 0,{inputs:Sr(i,"input")}))}getGraph(e){const t=new D_,r=t.addNode({name:`${this.getName()}Input`,schema:Va()}),i=t.addNode(this),a=t.addNode({name:`${this.getName()}Output`,schema:Va()});return t.addEdge(r,i),t.addEdge(i,a),t}pipe(e){return new Ar({first:this,last:Yr(e)})}pick(e){return this.pipe(new D5(e))}assign(e){return this.pipe(new OI(new lu({steps:e})))}async*transform(e,t){let r;for await(const i of e)r===void 0?r=i:r=_i(r,i);yield*this._streamIterator(r,Qt(t))}async*streamLog(e,t,r){const i=new wx({...r,autoClose:!1,_schemaFormat:"original"}),a=Qt(t);yield*this._streamLog(e,i,a)}async*_streamLog(e,t,r){const{callbacks:i}=r;if(i===void 0)r.callbacks=[t];else if(Array.isArray(i))r.callbacks=i.concat([t]);else{const u=i.copy();u.addHandler(t,!0),r.callbacks=u}const a=this.stream(e,r);async function s(){try{const u=await a;for await(const c of u){const d=new Fo({ops:[{op:"add",path:"/streamed_output/-",value:c}]});await t.writer.write(d)}}finally{await t.writer.close()}}const o=s();try{for await(const u of t)yield u}finally{await o}}streamEvents(e,t,r){let i;if(t.version==="v1")i=this._streamEventsV1(e,t,r);else if(t.version==="v2")i=this._streamEventsV2(e,t,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?ire(i):li.fromAsyncGenerator(i)}async*_streamEventsV2(e,t,r){var _;const i=new tte({...r,autoClose:!1}),a=Qt(t),s=a.runId??jo();a.runId=s;const o=a.callbacks;if(o===void 0)a.callbacks=[i];else if(Array.isArray(o))a.callbacks=o.concat(i);else{const w=o.copy();w.addHandler(i,!0),a.callbacks=w}const u=new AbortController,c=this;async function d(){try{let w;t!=null&&t.signal?"any"in AbortSignal?w=AbortSignal.any([u.signal,t.signal]):(w=t.signal,t.signal.addEventListener("abort",()=>{u.abort()},{once:!0})):w=u.signal;const S=await c.stream(e,{...a,signal:w}),E=i.tapOutputIterable(s,S);for await(const C of E)if(u.signal.aborted)break}finally{await i.finish()}}const h=d();let m=!1,g;try{for await(const w of i){if(!m){w.data.input=e,m=!0,g=w.run_id,yield w;continue}w.run_id===g&&w.event.endsWith("_end")&&(_=w.data)!=null&&_.input&&delete w.data.input,yield w}}finally{u.abort(),await h}}async*_streamEventsV1(e,t,r){let i,a=!1;const s=Qt(t),o=s.tags??[],u=s.metadata??{},c=s.runName??this.getName(),d=new wx({...r,autoClose:!1,_schemaFormat:"streaming_events"}),h=new ate({...r}),m=this._streamLog(e,d,s);for await(const _ of m){if(i?i=i.concat(_):i=Td.fromRunLogPatch(_),i.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;const C={...i.state},A={run_id:C.id,event:`on_${C.type}_start`,name:c,tags:o,metadata:u,data:{input:e}};h.includeEvent(A,C.type)&&(yield A)}const w=_.ops.filter(C=>C.path.startsWith("/logs/")).map(C=>C.path.split("/")[2]),S=[...new Set(w)];for(const C of S){let A,R={};const P=i.state.logs[C];if(P.end_time===void 0?P.streamed_output.length>0?A="stream":A="start":A="end",A==="start")P.inputs!==void 0&&(R.input=P.inputs);else if(A==="end")P.inputs!==void 0&&(R.input=P.inputs),R.output=P.final_output;else if(A==="stream"){const N=P.streamed_output.length;if(N!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${N} instead. Encountered in: "${P.name}"`);R={chunk:P.streamed_output[0]},P.streamed_output=[]}yield{event:`on_${P.type}_${A}`,name:P.name,run_id:P.id,tags:P.tags,metadata:P.metadata,data:R}}const{state:E}=i;if(E.streamed_output.length>0){const C=E.streamed_output.length;if(C!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${C} instead. Encountered in: "${E.name}"`);const A={chunk:E.streamed_output[0]};E.streamed_output=[];const R={event:`on_${E.type}_stream`,run_id:E.id,tags:o,metadata:u,name:c,data:A};h.includeEvent(R,E.type)&&(yield R)}}const g=i==null?void 0:i.state;if(g!==void 0){const _={event:`on_${g.type}_end`,name:c,run_id:g.id,tags:o,metadata:u,data:{output:g.final_output}};h.includeEvent(_,g.type)&&(yield _)}}static isRunnable(e){return TI(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new bi({bound:this,config:{},configFactories:[i=>({callbacks:[new b5({config:i,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){return lre(this,e)}}class bi extends Gt{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=bs(this.config,...e);return bs(t,...this.configFactories?await Promise.all(this.configFactories.map(async r=>await r(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new II({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(Qt(t),this.kwargs))}async batch(e,t,r){const i=Array.isArray(t)?await Promise.all(t.map(async a=>this._mergeConfig(Qt(a),this.kwargs))):await this._mergeConfig(Qt(t),this.kwargs);return this.bound.batch(e,i,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(Qt(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(Qt(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(Qt(t),this.kwargs))}streamEvents(e,t,r){const i=this,a=async function*(){yield*i.bound.streamEvents(e,{...await i._mergeConfig(Qt(t),i.kwargs),version:t.version},r)};return li.fromAsyncGenerator(a())}static isRunnableBinding(e){return e.bound&&Gt.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new bi({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[i=>({callbacks:[new b5({config:i,onStart:e,onEnd:t,onError:r})]})]})}}class gm extends Gt{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new gm({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,r){return this.bound.batch(e,fn(t,{callbacks:r==null?void 0:r.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new gm({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}}class II extends bi{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){const i=e>1?`retry:attempt:${e}`:void 0;return fn(t,{callbacks:r==null?void 0:r.getChild(i)})}async _invoke(e,t,r){return R_(i=>super.invoke(e,this._patchConfigForRetry(i,t,r)),{onFailedAttempt:i=>this.onFailedAttempt(i,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,r,i){const a={};try{await R_(async s=>{const o=e.map((m,g)=>g).filter(m=>a[m.toString()]===void 0||a[m.toString()]instanceof Error),u=o.map(m=>e[m]),c=o.map(m=>this._patchConfigForRetry(s,t==null?void 0:t[m],r==null?void 0:r[m])),d=await super.batch(u,c,{...i,returnExceptions:!0});let h;for(let m=0;m<d.length;m+=1){const g=d[m],_=o[m];g instanceof Error&&h===void 0&&(h=g,h.input=u[m]),a[_.toString()]=g}if(h)throw h;return d},{onFailedAttempt:s=>this.onFailedAttempt(s,s.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(s){if((i==null?void 0:i.returnExceptions)!==!0)throw s}return Object.keys(a).sort((s,o)=>parseInt(s,10)-parseInt(o,10)).map(s=>a[parseInt(s,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class Ar extends Gt{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){var u;const r=Qt(t),i=await Gi(r),a=await(i==null?void 0:i.handleChainStart(this.toJSON(),Sr(e,"input"),r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;let s=e,o;try{const c=[this.first,...this.middle];for(let d=0;d<c.length;d+=1){const m=c[d].invoke(s,fn(r,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${d+1}`)}));s=await eu(m,t==null?void 0:t.signal)}if((u=t==null?void 0:t.signal)!=null&&u.aborted)throw new Error("Aborted");o=await this.last.invoke(s,fn(r,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(c){throw await(a==null?void 0:a.handleChainError(c)),c}return await(a==null?void 0:a.handleChainEnd(Sr(o,"output"))),o}async batch(e,t,r){var u;const i=this._getOptionsList(t??{},e.length),a=await Promise.all(i.map(Gi)),s=await Promise.all(a.map(async(c,d)=>{const h=await(c==null?void 0:c.handleChainStart(this.toJSON(),Sr(e[d],"input"),i[d].runId,void 0,void 0,void 0,i[d].runName));return delete i[d].runId,h}));let o=e;try{for(let c=0;c<this.steps.length;c+=1){const h=this.steps[c].batch(o,s.map((m,g)=>{const _=m==null?void 0:m.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`);return fn(i[g],{callbacks:_})}),r);o=await eu(h,(u=i[0])==null?void 0:u.signal)}}catch(c){throw await Promise.all(s.map(d=>d==null?void 0:d.handleChainError(c))),c}return await Promise.all(s.map(c=>c==null?void 0:c.handleChainEnd(Sr(o,"output")))),o}async*_streamIterator(e,t){var h;const r=await Gi(t),{runId:i,...a}=t??{},s=await(r==null?void 0:r.handleChainStart(this.toJSON(),Sr(e,"input"),i,void 0,void 0,void 0,a==null?void 0:a.runName)),o=[this.first,...this.middle,this.last];let u=!0,c;async function*d(){yield e}try{let m=o[0].transform(d(),fn(a,{callbacks:s==null?void 0:s.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let g=1;g<o.length;g+=1)m=await o[g].transform(m,fn(a,{callbacks:s==null?void 0:s.getChild(this.omitSequenceTags?void 0:`seq:step:${g+1}`)}));for await(const g of m)if((h=t==null?void 0:t.signal)==null||h.throwIfAborted(),yield g,u)if(c===void 0)c=g;else try{c=_i(c,g)}catch{c=void 0,u=!1}}catch(m){throw await(s==null?void 0:s.handleChainError(m)),m}await(s==null?void 0:s.handleChainEnd(Sr(c,"output")))}getGraph(e){const t=new D_;let r=null;return this.steps.forEach((i,a)=>{const s=i.getGraph(e);a!==0&&s.trimFirstNode(),a!==this.steps.length-1&&s.trimLastNode(),t.extend(s);const o=s.firstNode();if(!o)throw new Error(`Runnable ${i} has no first node`);r&&t.addEdge(r,o),r=s.lastNode()}),t}pipe(e){return Ar.isRunnableSequence(e)?new Ar({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new Ar({first:this.first,middle:[...this.middle,this.last],last:Yr(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&Gt.isRunnable(e)}static from([e,...t],r){let i={};return typeof r=="string"?i.name=r:r!==void 0&&(i=r),new Ar({...i,first:Yr(e),middle:t.slice(0,-1).map(Yr),last:Yr(t[t.length-1])})}}class lu extends Gt{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,r]of Object.entries(e.steps))this.steps[t]=Yr(r)}static from(e){return new lu({steps:e})}async invoke(e,t){const r=Qt(t),i=await Gi(r),a=await(i==null?void 0:i.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;const s={};try{const o=Object.entries(this.steps).map(async([u,c])=>{s[u]=await c.invoke(e,fn(r,{callbacks:a==null?void 0:a.getChild(`map:key:${u}`)}))});await eu(Promise.all(o),t==null?void 0:t.signal)}catch(o){throw await(a==null?void 0:a.handleChainError(o)),o}return await(a==null?void 0:a.handleChainEnd(s)),s}async*_transform(e,t,r){const i={...this.steps},a=SI(e,Object.keys(i).length),s=new Map(Object.entries(i).map(([o,u],c)=>{const d=u.transform(a[c],fn(r,{callbacks:t==null?void 0:t.getChild(`map:key:${o}`)}));return[o,d.next().then(h=>({key:o,gen:d,result:h}))]}));for(;s.size;){const o=Promise.race(s.values()),{key:u,result:c,gen:d}=await eu(o,r==null?void 0:r.signal);s.delete(u),c.done||(yield{[u]:c.value},s.set(u,d.next().then(h=>({key:u,gen:d,result:h}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=Qt(t),a=new Ic({generator:this.transform(r(),i),config:i});return await a.setup,li.fromAsyncGenerator(a)}}class PI extends Gt{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!_I(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){const[r]=this._getOptionsList(t??{},1),i=await Gi(r),a=this.func(fn(r,{callbacks:i}),e);return eu(a,r==null?void 0:r.signal)}async*_streamIterator(e,t){var a,s;const[r]=this._getOptionsList(t??{},1),i=await this.invoke(e,t);if(Cx(i)){for await(const o of i)(a=r==null?void 0:r.signal)==null||a.throwIfAborted(),yield o;return}if(are(i)){for(;;){(s=r==null?void 0:r.signal)==null||s.throwIfAborted();const o=i.next();if(o.done)break;yield o.value}return}yield i}static from(e){return new PI({func:e})}}function sre(n){if(_I(n))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}class Cr extends Gt{static lc_name(){return"RunnableLambda"}constructor(e){if(_I(e.func))return PI.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),sre(e.func),this.func=e.func}static from(e){return new Cr({func:e})}async _invoke(e,t,r){return new Promise((i,a)=>{const s=fn(t,{callbacks:r==null?void 0:r.getChild(),recursionLimit:((t==null?void 0:t.recursionLimit)??hT)-1});Hi.runWithConfig(el(s),async()=>{var o,u;try{let c=await this.func(e,{...s});if(c&&Gt.isRunnable(c)){if((t==null?void 0:t.recursionLimit)===0)throw new Error("Recursion limit reached.");c=await c.invoke(e,{...s,recursionLimit:(s.recursionLimit??hT)-1})}else if(Cx(c)){let d;for await(const h of xx(s,c))if((o=t==null?void 0:t.signal)==null||o.throwIfAborted(),d===void 0)d=h;else try{d=_i(d,h)}catch{d=h}c=d}else if(KL(c)){let d;for(const h of JL(s,c))if((u=t==null?void 0:t.signal)==null||u.throwIfAborted(),d===void 0)d=h;else try{d=_i(d,h)}catch{d=h}c=d}i(c)}catch(c){a(c)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async*_transform(e,t,r){var o,u;let i;for await(const c of e)if(i===void 0)i=c;else try{i=_i(i,c)}catch{i=c}const a=fn(r,{callbacks:t==null?void 0:t.getChild(),recursionLimit:((r==null?void 0:r.recursionLimit)??hT)-1}),s=await new Promise((c,d)=>{Hi.runWithConfig(el(a),async()=>{try{const h=await this.func(i,{...a,config:a});c(h)}catch(h){d(h)}})});if(s&&Gt.isRunnable(s)){if((r==null?void 0:r.recursionLimit)===0)throw new Error("Recursion limit reached.");const c=await s.stream(i,a);for await(const d of c)yield d}else if(Cx(s))for await(const c of xx(a,s))(o=r==null?void 0:r.signal)==null||o.throwIfAborted(),yield c;else if(KL(s))for(const c of JL(a,s))(u=r==null?void 0:r.signal)==null||u.throwIfAborted(),yield c;else yield s}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=Qt(t),a=new Ic({generator:this.transform(r(),i),config:i});return await a.setup,li.fromAsyncGenerator(a)}}class ore extends lu{}class M5 extends Gt{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const r=Qt(t),i=await Gi(r),{runId:a,...s}=r,o=await(i==null?void 0:i.handleChainStart(this.toJSON(),Sr(e,"input"),a,void 0,void 0,void 0,s==null?void 0:s.runName)),u=fn(s,{callbacks:o==null?void 0:o.getChild()});return await Hi.runWithConfig(u,async()=>{var h;let d;for(const m of this.runnables()){(h=r==null?void 0:r.signal)==null||h.throwIfAborted();try{const g=await m.invoke(e,u);return await(o==null?void 0:o.handleChainEnd(Sr(g,"output"))),g}catch(g){d===void 0&&(d=g)}}throw d===void 0?new Error("No error stored at end of fallback."):(await(o==null?void 0:o.handleChainError(d)),d)})}async*_streamIterator(e,t){var h;const r=Qt(t),i=await Gi(r),{runId:a,...s}=r,o=await(i==null?void 0:i.handleChainStart(this.toJSON(),Sr(e,"input"),a,void 0,void 0,void 0,s==null?void 0:s.runName));let u,c;for(const m of this.runnables()){(h=r==null?void 0:r.signal)==null||h.throwIfAborted();const g=fn(s,{callbacks:o==null?void 0:o.getChild()});try{const _=await m.stream(e,g);c=xx(g,_);break}catch(_){u===void 0&&(u=_)}}if(c===void 0){const m=u??new Error("No error stored at end of fallback.");throw await(o==null?void 0:o.handleChainError(m)),m}let d;try{for await(const m of c){yield m;try{d=d===void 0?d:_i(d,m)}catch{d=void 0}}}catch(m){throw await(o==null?void 0:o.handleChainError(m)),m}await(o==null?void 0:o.handleChainEnd(Sr(d,"output")))}async batch(e,t,r){var u;if(r!=null&&r.returnExceptions)throw new Error("Not implemented.");const i=this._getOptionsList(t??{},e.length),a=await Promise.all(i.map(c=>Gi(c))),s=await Promise.all(a.map(async(c,d)=>{const h=await(c==null?void 0:c.handleChainStart(this.toJSON(),Sr(e[d],"input"),i[d].runId,void 0,void 0,void 0,i[d].runName));return delete i[d].runId,h}));let o;for(const c of this.runnables()){(u=i[0].signal)==null||u.throwIfAborted();try{const d=await c.batch(e,s.map((h,m)=>fn(i[m],{callbacks:h==null?void 0:h.getChild()})),r);return await Promise.all(s.map((h,m)=>h==null?void 0:h.handleChainEnd(Sr(d[m],"output")))),d}catch(d){o===void 0&&(o=d)}}throw o?(await Promise.all(s.map(c=>c==null?void 0:c.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function Yr(n){if(typeof n=="function")return new Cr({func:n});if(Gt.isRunnable(n))return n;if(!Array.isArray(n)&&typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=Yr(r);return new lu({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class OI extends Gt{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof lu&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const r=await this.mapper.invoke(e,t);return{...e,...r}}async*_transform(e,t,r){const i=this.mapper.getStepsKeys(),[a,s]=SI(e),o=this.mapper.transform(s,fn(r,{callbacks:t==null?void 0:t.getChild()})),u=o.next();for await(const c of a){if(typeof c!="object"||Array.isArray(c))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof c}`);const d=Object.fromEntries(Object.entries(c).filter(([h])=>!i.includes(h)));Object.keys(d).length>0&&(yield d)}yield(await u).value;for await(const c of o)yield c}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=Qt(t),a=new Ic({generator:this.transform(r(),i),config:i});return await a.setup,li.fromAsyncGenerator(a)}}class D5 extends Gt{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const t=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const r=await this._pick(t);r!==void 0&&(yield r)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=Qt(t),a=new Ic({generator:this.transform(r(),i),config:i});return await a.setup,li.fromAsyncGenerator(a)}}class Rx extends bi{constructor(e){const t=Ar.from([Cr.from(async r=>{let i;if(Bp(r))try{i=await Lb(this.schema,r.args)}catch{throw new m_("Received tool input did not match expected schema",JSON.stringify(r.args))}else i=r;return i}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function lre(n,e){const t=e.name??n.getName(),r=e.description??Ad(e.schema);return CI(e.schema)?new Rx({name:t,description:r,schema:rt({input:$e()}).transform(i=>i.input),bound:n}):new Rx({name:t,description:r,schema:e.schema,bound:n})}class Ix extends Ha{constructor(e){super({...e,content:""}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.id=e.id}_getType(){return"remove"}get _printableFields(){return{...super._printableFields,id:this.id}}}const $_=(n,e)=>{const t=[...new Set(e==null?void 0:e.map(i=>{if(typeof i=="string")return i;const a=new i({});if(!("getType"in a)||typeof a.getType!="function")throw new Error("Invalid type provided.");return a.getType()}))],r=n.getType();return t.some(i=>i===r)};function ure(n,e){return Array.isArray(n)?YL(n,e):Cr.from(t=>YL(t,n))}function YL(n,e={}){const{includeNames:t,excludeNames:r,includeTypes:i,excludeTypes:a,includeIds:s,excludeIds:o}=e,u=[];for(const c of n)if(!(r&&c.name&&r.includes(c.name))){{if(a&&$_(c,a))continue;if(o&&c.id&&o.includes(c.id))continue}i||s||t?(t&&c.name&&t.some(d=>d===c.name)||i&&$_(c,i)||s&&c.id&&s.some(d=>d===c.id))&&u.push(c):u.push(c)}return u}function cre(n){return Array.isArray(n)?ZL(n):Cr.from(ZL)}function ZL(n){if(!n.length)return[];const e=[];for(const t of n){const r=t,i=e.pop();if(!i)e.push(r);else if(r.getType()==="tool"||r.getType()!==i.getType())e.push(i,r);else{const a=g_(i),s=g_(r),o=a.concat(s);typeof a.content=="string"&&typeof s.content=="string"&&(o.content=`${a.content}
${s.content}`),e.push(hre(o))}}return e}function fre(n,e){if(Array.isArray(n)){const t=n;if(!e)throw new Error("Options parameter is required when providing messages.");return XL(t,e)}else{const t=n;return Cr.from(r=>XL(r,t)).withConfig({runName:"trim_messages"})}}async function XL(n,e){const{maxTokens:t,tokenCounter:r,strategy:i="last",allowPartial:a=!1,endOn:s,startOn:o,includeSystem:u=!1,textSplitter:c}=e;if(o&&i==="first")throw new Error("`startOn` should only be specified if `strategy` is 'last'.");if(u&&i==="first")throw new Error("`includeSystem` should only be specified if `strategy` is 'last'.");let d;"getNumTokens"in r?d=async m=>(await Promise.all(m.map(_=>r.getNumTokens(_.content)))).reduce((_,w)=>_+w,0):d=async m=>r(m);let h=L5;if(c&&("splitText"in c?h=c.splitText:h=async m=>c(m)),i==="first")return $5(n,{maxTokens:t,tokenCounter:d,textSplitter:h,partialStrategy:a?"first":void 0,endOn:s});if(i==="last")return dre(n,{maxTokens:t,tokenCounter:d,textSplitter:h,allowPartial:a,includeSystem:u,startOn:o,endOn:s});throw new Error(`Unrecognized strategy: '${i}'. Must be one of 'first' or 'last'.`)}async function $5(n,e){const{maxTokens:t,tokenCounter:r,textSplitter:i,partialStrategy:a,endOn:s}=e;let o=[...n],u=0;for(let c=0;c<o.length;c+=1){const d=c>0?o.slice(0,-c):o;if(await r(d)<=t){u=o.length-c;break}}if(u<o.length-1&&a){let c=!1;if(Array.isArray(o[u].content)){const d=o[u];if(typeof d.content=="string")throw new Error("Expected content to be an array.");const h=d.content.length,m=a==="last"?[...d.content].reverse():d.content;for(let g=1;g<=h;g+=1){const _=a==="first"?m.slice(0,g):m.slice(-g),w=Object.fromEntries(Object.entries(d).filter(([C])=>C!=="type"&&!C.startsWith("lc_"))),S=kI(d.getType(),{...w,content:_}),E=[...o.slice(0,u),S];if(await r(E)<=t)o=E,u+=1,c=!0;else break}c&&a==="last"&&(d.content=[...m].reverse())}if(!c){const d=o[u];let h;if(Array.isArray(d.content)&&d.content.some(m=>typeof m=="string"||m.type==="text")){const m=d.content.find(g=>g.type==="text"&&g.text);h=m==null?void 0:m.text}else typeof d.content=="string"&&(h=d.content);if(h){const m=await i(h),g=m.length;a==="last"&&m.reverse();for(let _=0;_<g-1;_+=1)if(m.pop(),d.content=m.join(""),await r([...o.slice(0,u),d])<=t){a==="last"&&(d.content=[...m].reverse().join("")),o=[...o.slice(0,u),d],u+=1;break}}}}if(s){const c=Array.isArray(s)?s:[s];for(;u>0&&!$_(o[u-1],c);)u-=1}return o.slice(0,u)}async function dre(n,e){var d;const{allowPartial:t=!1,includeSystem:r=!1,endOn:i,startOn:a,...s}=e;let o=n.map(h=>{const m=Object.fromEntries(Object.entries(h).filter(([g])=>g!=="type"&&!g.startsWith("lc_")));return kI(h.getType(),m,wd(h))});if(i){const h=Array.isArray(i)?i:[i];for(;o.length>0&&!$_(o[o.length-1],h);)o=o.slice(0,-1)}const u=r&&((d=o[0])==null?void 0:d.getType())==="system";let c=u?o.slice(0,1).concat(o.slice(1).reverse()):o.reverse();return c=await $5(c,{...s,partialStrategy:t?"last":void 0,endOn:a}),u?[c[0],...c.slice(1).reverse()]:c.reverse()}const QL={human:{message:oi,messageChunk:xc},ai:{message:Tn,messageChunk:xn},system:{message:Cs,messageChunk:co},developer:{message:Cs,messageChunk:co},tool:{message:Yo,messageChunk:Ld},function:{message:Ab,messageChunk:Cc},generic:{message:Xa,messageChunk:Ac},remove:{message:Ix,messageChunk:Ix}};function kI(n,e,t){var a;let r,i;switch(n){case"human":t?r=new xc(e):i=new oi(e);break;case"ai":if(t){let s={...e};"tool_calls"in s&&(s={...s,tool_call_chunks:(a=s.tool_calls)==null?void 0:a.map(o=>({...o,type:"tool_call_chunk",index:void 0,args:JSON.stringify(o.args)}))}),r=new xn(s)}else i=new Tn(e);break;case"system":t?r=new co(e):i=new Cs(e);break;case"developer":t?r=new co({...e,additional_kwargs:{...e.additional_kwargs,__openai_role__:"developer"}}):i=new Cs({...e,additional_kwargs:{...e.additional_kwargs,__openai_role__:"developer"}});break;case"tool":if("tool_call_id"in e)t?r=new Ld(e):i=new Yo(e);else throw new Error("Can not convert ToolMessage to ToolMessageChunk if 'tool_call_id' field is not defined.");break;case"function":if(t)r=new Cc(e);else{if(!e.name)throw new Error("FunctionMessage must have a 'name' field");i=new Ab(e)}break;case"generic":if("role"in e)t?r=new Ac(e):i=new Xa(e);else throw new Error("Can not convert ChatMessage to ChatMessageChunk if 'role' field is not defined.");break;default:throw new Error(`Unrecognized message type ${n}`)}if(t&&r)return r;if(i)return i;throw new Error(`Unrecognized message type ${n}`)}function hre(n){const e=n.getType();let t;const r=Object.fromEntries(Object.entries(n).filter(([i])=>!["type","tool_call_chunks"].includes(i)&&!i.startsWith("lc_")));if(e in QL&&(t=kI(e,r)),!t)throw new Error(`Unrecognized message chunk class ${e}. Supported classes are ${Object.keys(QL)}`);return t}function L5(n){const e=n.split(`
`);return Promise.resolve([...e.slice(0,-1).map(t=>`${t}
`),e[e.length-1]])}const pre=Object.freeze(Object.defineProperty({__proto__:null,AIMessage:Tn,AIMessageChunk:xn,BaseMessage:Ha,BaseMessageChunk:Tc,ChatMessage:Xa,ChatMessageChunk:Ac,FunctionMessage:Ab,FunctionMessageChunk:Cc,HumanMessage:oi,HumanMessageChunk:xc,RemoveMessage:Ix,SystemMessage:Cs,SystemMessageChunk:co,ToolMessage:Yo,ToolMessageChunk:Ld,_isMessageFieldWithRole:M6,_mergeDicts:si,_mergeLists:Fm,_mergeObj:N6,_mergeStatus:k6,coerceMessageLikeToMessage:_s,convertToChunk:g_,convertToOpenAIImageBlock:O6,convertToProviderContentBlock:jm,defaultTextSplitter:L5,filterMessages:ure,getBufferString:Bm,isAIMessage:Ea,isAIMessageChunk:p_,isBase64ContentBlock:P6,isBaseMessage:Vn,isBaseMessageChunk:wd,isChatMessage:YZ,isChatMessageChunk:ZZ,isDataContentBlock:Ja,isFunctionMessage:XZ,isFunctionMessageChunk:QZ,isHumanMessage:eX,isHumanMessageChunk:tX,isIDContentBlock:zZ,isOpenAIToolCallArray:GZ,isPlainTextContentBlock:VZ,isSystemMessage:nX,isSystemMessageChunk:rX,isToolMessage:um,isToolMessageChunk:JZ,isURLContentBlock:I6,mapChatMessagesToStoredMessages:uX,mapStoredMessageToChatMessage:cI,mapStoredMessagesToChatMessages:lX,mergeContent:Sc,mergeMessageRuns:cre,parseBase64DataUrl:Kl,parseMimeType:rx,trimMessages:fre},Symbol.toStringTag,{value:"Module"})),mre=({apiKeys:n,activeProvider:e,mcpServers:t,keysLoadedFromStorage:r,langchainAgent:i,activeLLMService:a})=>{const[s,o]=wt.useState([]),[u,c]=wt.useState(""),[d,h]=wt.useState(!1),m=wt.useRef(null),g=wt.useRef(null),_=wt.useCallback(()=>{g.current&&(g.current.scrollTop=g.current.scrollHeight)},[]);wt.useEffect(_,[s,_]);const w=wt.useRef(null),S=t.filter(C=>C.status==="connected").map(C=>C.id||C.url||JSON.stringify(C)).join(",");return wt.useEffect(()=>{if(!r)return;const C=i?"langchain":e;if(w.current!==C){w.current=C;const A=(a==null?void 0:a.isAvailable(n[e]))||!1,R=e.charAt(0).toUpperCase()+e.slice(1);o(i?[{id:"system-init",text:"Langchain agent with MCP tools ready. Type your message below.",sender:"system",timestamp:new Date,provider:void 0}]:A?[{id:"system-init",text:`${R} chat ready. Type your message below.`,sender:"system",timestamp:new Date,provider:e}]:[{id:"system-unavailable",text:`${R} API Key not provided or invalid. Please set it in API Key Management.`,sender:"system",timestamp:new Date,provider:e}])}},[e,n,a,r,i,S]),{messages:s,input:u,setInput:c,isLoading:d,handleSend:async()=>{const C=(a==null?void 0:a.isAvailable(n[e]))||!1;if(!u.trim()||d||!r||!i&&!C&&t.every(B=>B.status!=="connected"))return;const A={id:`user-${Date.now()}`,text:u,sender:"user",timestamp:new Date,provider:e},R=[...s,A];o(R);const P=u;c(""),h(!0);let N="",U=!1,k=!1;try{if(i){const B=R.slice(-20).map(oe=>oe.sender==="user"&&typeof oe.text=="string"&&oe.text.trim()!==""?new oi(oe.text):oe.sender==="bot"&&typeof oe.text=="string"&&oe.text.trim()!==""?new Tn(oe.text):null).filter(oe=>oe!==null),H=await i.invoke({messages:B},{configurable:{thread_id:"chat-thread"}}),G=H==null?void 0:H.messages,z=Array.isArray(G)&&G.length>0?G[G.length-1]:void 0;z&&typeof z=="object"&&"content"in z&&typeof z.content=="string"?N=z.content:(N="Received an unexpected or empty response from the AI agent.",U=!0)}else if(a&&a.isAvailable(n[e]))if(a.generateTextStream){k=!0,o(B=>[...B,{id:`bot-${Date.now()}`,text:"",sender:"bot",timestamp:new Date,provider:e}]);try{await a.generateTextStream(P,n[e],B=>{o(H=>{const G={...H[H.length-1]};return G.text+=B,[...H.slice(0,-1),G]})},()=>{h(!1)},B=>{o(H=>{const G={...H[H.length-1]};return G.text=`Error: ${B}`,G.sender="error",[...H.slice(0,-1),G]}),h(!1),U=!0})}catch(B){console.error(`Streaming chat error with ${e}:`,B),o(H=>{const G={...H[H.length-1]};return G.text=`Error initiating streaming: ${B.message||"Unknown error"}`,G.sender="error",[...H.slice(0,-1),G]}),h(!1),U=!0}}else try{N=await a.generateText(P,n[e]),(N.startsWith("Error from")||N.includes("API is not available")||N.includes("API client could not be initialized")||N.includes("not configured")||N.includes("not fully implemented")||N.includes("placeholder"))&&(U=!0)}catch(B){console.error(`Non-streaming chat error with ${e}:`,B),N=`An unexpected error occurred with ${e}: ${B.message||"Unknown error"}.`,U=!0}else N="No LLM provider configured and no MCP server connected.",U=!0}catch(B){console.error("Overall chat handling error:",B),N=`An unexpected error occurred: ${B.message||"Unknown error"}.`,U=!0}if(!k||U){const B={id:`bot-${Date.now()}`,text:N,sender:U?"error":"bot",timestamp:new Date,provider:i?void 0:e};o(H=>[...H,B]),h(!1)}},messagesEndRef:m,chatContainerRef:g}},gre=({apiKeys:n,activeProvider:e,mcpServers:t,keysLoadedFromStorage:r,langchainAgent:i,activeLLMService:a})=>{const{messages:s,input:o,setInput:u,isLoading:c,handleSend:d,messagesEndRef:h,chatContainerRef:m}=mre({apiKeys:n,activeProvider:e,mcpServers:t,keysLoadedFromStorage:r,langchainAgent:i,activeLLMService:a}),g=(a==null?void 0:a.isAvailable(n[e]))||!1,_=R=>{switch(R){case"user":return"bg-sky-600 text-white self-end rounded-t-xl rounded-bl-xl";case"bot":return"bg-gray-700 text-gray-200 self-start rounded-t-xl rounded-br-xl";case"system":return"bg-transparent text-gray-400 self-center text-xs italic px-2 py-1 text-center";case"error":return"bg-red-700/60 text-red-200 self-start rounded-lg border border-red-600";default:return"bg-gray-600 text-white self-start rounded-lg"}},w=()=>{if(!r)return"Cargando claves API...";if(i)return"Type your message to the Langchain agent...";const R=e.charAt(0).toUpperCase()+e.slice(1);return g?`Type your message to ${R}...`:`${R} API Key not configured`},S=()=>{if(i)return Ae.jsx(HC,{className:"mr-3 text-sky-400 h-6 w-6"});switch(e){case"gemini":return Ae.jsx(G3,{className:"mr-3 text-sky-400 h-6 w-6"});case"openai":return Ae.jsx(z3,{className:"mr-3 text-sky-400 h-6 w-6"});case"claude":return Ae.jsx(H3,{className:"mr-3 text-sky-400 h-6 w-6"});default:return Ae.jsx(HC,{className:"mr-3 text-sky-400 h-6 w-6"})}},E=i?"Langchain Agent":e.charAt(0).toUpperCase()+e.slice(1),C=c||!r||!i&&!g&&t.every(R=>R.status!=="connected"),A=c||!o.trim()||!r||!i&&!g&&t.every(R=>R.status!=="connected");return Ae.jsxs("div",{className:"p-4 sm:p-6 bg-gray-800 rounded-xl shadow-xl flex flex-col h-[80vh] max-h-[900px] min-h-[400px] overflow-hidden",children:[Ae.jsxs("h2",{className:"text-xl sm:text-2xl font-semibold text-sky-400 mb-4 flex items-center",children:[Ae.jsx(S,{})," Chat with ",E]}),r?Ae.jsxs(Ae.Fragment,{children:[!i&&!g&&s.length<=1&&Ae.jsxs("div",{className:"p-3 mb-4 text-center bg-yellow-800/60 text-yellow-300 rounded-lg border border-yellow-700 text-sm",children:[w(),". Chat features disabled."]}),Ae.jsxs("div",{ref:m,className:"flex-grow overflow-y-auto mb-4 p-3 space-y-4 bg-gray-850 rounded-lg border border-gray-700 custom-scrollbar min-h-0",style:{minHeight:0,maxHeight:"100%"},children:[s.map(R=>Ae.jsx("div",{className:`flex ${R.sender==="user"?"justify-end":R.sender==="system"?"justify-center":"justify-start"}`,children:Ae.jsxs("div",{className:`max-w-xs md:max-w-md lg:max-w-lg px-3.5 py-2.5 shadow ${_(R.sender)}`,style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:[Ae.jsx("div",{className:"text-sm leading-relaxed",children:R.sender==="bot"&&R.text===""?Ae.jsx("span",{className:"inline-block animate-pulse text-sky-300",children:"..."}):R.sender==="bot"?Ae.jsx("div",{className:"prose prose-invert max-w-none",children:Ae.jsx(RZ,{components:{a:P=>Ae.jsx("a",{...P,target:"_blank",rel:"noopener noreferrer",className:"text-sky-400 underline hover:text-sky-300 transition-colors",children:P.children})},children:R.text})}):R.text}),R.sender!=="system"&&Ae.jsx("p",{className:`text-xs mt-1.5 ${R.sender==="user"?"text-sky-200/80":"text-gray-400/80"} text-right`,children:R.timestamp.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})})]})},R.id)),Ae.jsx("div",{ref:h})]}),Ae.jsxs("div",{className:"flex items-center border-t border-gray-700 pt-4",children:[Ae.jsx("input",{type:"text",value:o,onChange:R=>u(R.target.value),onKeyPress:R=>R.key==="Enter"&&!A&&d(),placeholder:w(),className:"flex-grow px-4 py-2.5 bg-gray-700 border border-gray-600 rounded-l-lg text-gray-200 focus:ring-1 focus:ring-sky-500 focus:border-sky-500 transition-colors disabled:opacity-60",disabled:C}),Ae.jsx("button",{onClick:d,disabled:A,className:"bg-sky-600 hover:bg-sky-700 text-white font-semibold py-2.5 px-5 sm:px-6 rounded-r-lg transition duration-150 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-opacity-75 disabled:opacity-60 disabled:cursor-not-allowed flex items-center justify-center min-w-[80px] sm:min-w-[100px]",children:c?Ae.jsx(sd,{className:"w-5 h-5 text-white"}):"Send"})]})]}):Ae.jsxs("div",{className:"flex items-center justify-center h-full",children:[Ae.jsx(sd,{className:"w-6 h-6 text-sky-400 mr-2"}),Ae.jsx("span",{className:"text-gray-300",children:"Cargando claves API..."})]})]})};/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var yre=typeof window=="object"?window:{},qt="0123456789abcdef".split(""),vre=[-2147483648,8388608,32768,128],us=[24,16,8,0],kr=[];function Rs(n){n?(kr[0]=kr[16]=kr[1]=kr[2]=kr[3]=kr[4]=kr[5]=kr[6]=kr[7]=kr[8]=kr[9]=kr[10]=kr[11]=kr[12]=kr[13]=kr[14]=kr[15]=0,this.blocks=kr):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Rs.prototype.update=function(n){if(!this.finalized){var e=typeof n!="string";e&&n.constructor===yre.ArrayBuffer&&(n=new Uint8Array(n));for(var t,r=0,i,a=n.length||0,s=this.blocks;r<a;){if(this.hashed&&(this.hashed=!1,s[0]=this.block,s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),e)for(i=this.start;r<a&&i<64;++r)s[i>>2]|=n[r]<<us[i++&3];else for(i=this.start;r<a&&i<64;++r)t=n.charCodeAt(r),t<128?s[i>>2]|=t<<us[i++&3]:t<2048?(s[i>>2]|=(192|t>>6)<<us[i++&3],s[i>>2]|=(128|t&63)<<us[i++&3]):t<55296||t>=57344?(s[i>>2]|=(224|t>>12)<<us[i++&3],s[i>>2]|=(128|t>>6&63)<<us[i++&3],s[i>>2]|=(128|t&63)<<us[i++&3]):(t=65536+((t&1023)<<10|n.charCodeAt(++r)&1023),s[i>>2]|=(240|t>>18)<<us[i++&3],s[i>>2]|=(128|t>>12&63)<<us[i++&3],s[i>>2]|=(128|t>>6&63)<<us[i++&3],s[i>>2]|=(128|t&63)<<us[i++&3]);this.lastByteIndex=i,this.bytes+=i-this.start,i>=64?(this.block=s[16],this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};Rs.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var n=this.blocks,e=this.lastByteIndex;n[16]=this.block,n[e>>2]|=vre[e&3],this.block=n[16],e>=56&&(this.hashed||this.hash(),n[0]=this.block,n[16]=n[1]=n[2]=n[3]=n[4]=n[5]=n[6]=n[7]=n[8]=n[9]=n[10]=n[11]=n[12]=n[13]=n[14]=n[15]=0),n[14]=this.hBytes<<3|this.bytes>>>29,n[15]=this.bytes<<3,this.hash()}};Rs.prototype.hash=function(){var n=this.h0,e=this.h1,t=this.h2,r=this.h3,i=this.h4,a,s,o,u=this.blocks;for(s=16;s<80;++s)o=u[s-3]^u[s-8]^u[s-14]^u[s-16],u[s]=o<<1|o>>>31;for(s=0;s<20;s+=5)a=e&t|~e&r,o=n<<5|n>>>27,i=o+a+i+1518500249+u[s]<<0,e=e<<30|e>>>2,a=n&e|~n&t,o=i<<5|i>>>27,r=o+a+r+1518500249+u[s+1]<<0,n=n<<30|n>>>2,a=i&n|~i&e,o=r<<5|r>>>27,t=o+a+t+1518500249+u[s+2]<<0,i=i<<30|i>>>2,a=r&i|~r&n,o=t<<5|t>>>27,e=o+a+e+1518500249+u[s+3]<<0,r=r<<30|r>>>2,a=t&r|~t&i,o=e<<5|e>>>27,n=o+a+n+1518500249+u[s+4]<<0,t=t<<30|t>>>2;for(;s<40;s+=5)a=e^t^r,o=n<<5|n>>>27,i=o+a+i+1859775393+u[s]<<0,e=e<<30|e>>>2,a=n^e^t,o=i<<5|i>>>27,r=o+a+r+1859775393+u[s+1]<<0,n=n<<30|n>>>2,a=i^n^e,o=r<<5|r>>>27,t=o+a+t+1859775393+u[s+2]<<0,i=i<<30|i>>>2,a=r^i^n,o=t<<5|t>>>27,e=o+a+e+1859775393+u[s+3]<<0,r=r<<30|r>>>2,a=t^r^i,o=e<<5|e>>>27,n=o+a+n+1859775393+u[s+4]<<0,t=t<<30|t>>>2;for(;s<60;s+=5)a=e&t|e&r|t&r,o=n<<5|n>>>27,i=o+a+i-1894007588+u[s]<<0,e=e<<30|e>>>2,a=n&e|n&t|e&t,o=i<<5|i>>>27,r=o+a+r-1894007588+u[s+1]<<0,n=n<<30|n>>>2,a=i&n|i&e|n&e,o=r<<5|r>>>27,t=o+a+t-1894007588+u[s+2]<<0,i=i<<30|i>>>2,a=r&i|r&n|i&n,o=t<<5|t>>>27,e=o+a+e-1894007588+u[s+3]<<0,r=r<<30|r>>>2,a=t&r|t&i|r&i,o=e<<5|e>>>27,n=o+a+n-1894007588+u[s+4]<<0,t=t<<30|t>>>2;for(;s<80;s+=5)a=e^t^r,o=n<<5|n>>>27,i=o+a+i-899497514+u[s]<<0,e=e<<30|e>>>2,a=n^e^t,o=i<<5|i>>>27,r=o+a+r-899497514+u[s+1]<<0,n=n<<30|n>>>2,a=i^n^e,o=r<<5|r>>>27,t=o+a+t-899497514+u[s+2]<<0,i=i<<30|i>>>2,a=r^i^n,o=t<<5|t>>>27,e=o+a+e-899497514+u[s+3]<<0,r=r<<30|r>>>2,a=t^r^i,o=e<<5|e>>>27,n=o+a+n-899497514+u[s+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+n<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+r<<0,this.h4=this.h4+i<<0};Rs.prototype.hex=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,i=this.h4;return qt[n>>28&15]+qt[n>>24&15]+qt[n>>20&15]+qt[n>>16&15]+qt[n>>12&15]+qt[n>>8&15]+qt[n>>4&15]+qt[n&15]+qt[e>>28&15]+qt[e>>24&15]+qt[e>>20&15]+qt[e>>16&15]+qt[e>>12&15]+qt[e>>8&15]+qt[e>>4&15]+qt[e&15]+qt[t>>28&15]+qt[t>>24&15]+qt[t>>20&15]+qt[t>>16&15]+qt[t>>12&15]+qt[t>>8&15]+qt[t>>4&15]+qt[t&15]+qt[r>>28&15]+qt[r>>24&15]+qt[r>>20&15]+qt[r>>16&15]+qt[r>>12&15]+qt[r>>8&15]+qt[r>>4&15]+qt[r&15]+qt[i>>28&15]+qt[i>>24&15]+qt[i>>20&15]+qt[i>>16&15]+qt[i>>12&15]+qt[i>>8&15]+qt[i>>4&15]+qt[i&15]};Rs.prototype.toString=Rs.prototype.hex;Rs.prototype.digest=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,i=this.h4;return[n>>24&255,n>>16&255,n>>8&255,n&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24&255,r>>16&255,r>>8&255,r&255,i>>24&255,i>>16&255,i>>8&255,i&255]};Rs.prototype.array=Rs.prototype.digest;Rs.prototype.arrayBuffer=function(){this.finalize();var n=new ArrayBuffer(20),e=new DataView(n);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),n};let eU=!1;const U5=n=>(eU||(console.warn(["The default method for hashing keys is insecure and will be replaced in a future version,","but hasn't been replaced yet as to not break existing caches. It's recommended that you use","a more secure hashing algorithm to avoid cache poisoning.","","See this page for more information:","|","└> https://js.langchain.com/docs/troubleshooting/warnings/insecure-cache-algorithm"].join(`
`)),eU=!0),new Rs(!0).update(n).hex());/**
 * [js-sha256]{@link https://github.com/emn178/js-sha256}
 *
 * @version 0.11.1
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2025
 * @license MIT
 */var ct="0123456789abcdef".split(""),_re=[-2147483648,8388608,32768,128],cs=[24,16,8,0],qy=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],Nr=[];function Is(n,e){e?(Nr[0]=Nr[16]=Nr[1]=Nr[2]=Nr[3]=Nr[4]=Nr[5]=Nr[6]=Nr[7]=Nr[8]=Nr[9]=Nr[10]=Nr[11]=Nr[12]=Nr[13]=Nr[14]=Nr[15]=0,this.blocks=Nr):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=n}Is.prototype.update=function(n){if(!this.finalized){var e,t=typeof n;if(t!=="string"){if(t==="object"){if(n===null)throw new Error(ERROR);if(ARRAY_BUFFER&&n.constructor===ArrayBuffer)n=new Uint8Array(n);else if(!Array.isArray(n)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(n)))throw new Error(ERROR)}else throw new Error(ERROR);e=!0}for(var r,i=0,a,s=n.length,o=this.blocks;i<s;){if(this.hashed&&(this.hashed=!1,o[0]=this.block,this.block=o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0),e)for(a=this.start;i<s&&a<64;++i)o[a>>>2]|=n[i]<<cs[a++&3];else for(a=this.start;i<s&&a<64;++i)r=n.charCodeAt(i),r<128?o[a>>>2]|=r<<cs[a++&3]:r<2048?(o[a>>>2]|=(192|r>>>6)<<cs[a++&3],o[a>>>2]|=(128|r&63)<<cs[a++&3]):r<55296||r>=57344?(o[a>>>2]|=(224|r>>>12)<<cs[a++&3],o[a>>>2]|=(128|r>>>6&63)<<cs[a++&3],o[a>>>2]|=(128|r&63)<<cs[a++&3]):(r=65536+((r&1023)<<10|n.charCodeAt(++i)&1023),o[a>>>2]|=(240|r>>>18)<<cs[a++&3],o[a>>>2]|=(128|r>>>12&63)<<cs[a++&3],o[a>>>2]|=(128|r>>>6&63)<<cs[a++&3],o[a>>>2]|=(128|r&63)<<cs[a++&3]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.block=o[16],this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};Is.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var n=this.blocks,e=this.lastByteIndex;n[16]=this.block,n[e>>>2]|=_re[e&3],this.block=n[16],e>=56&&(this.hashed||this.hash(),n[0]=this.block,n[16]=n[1]=n[2]=n[3]=n[4]=n[5]=n[6]=n[7]=n[8]=n[9]=n[10]=n[11]=n[12]=n[13]=n[14]=n[15]=0),n[14]=this.hBytes<<3|this.bytes>>>29,n[15]=this.bytes<<3,this.hash()}};Is.prototype.hash=function(){var n=this.h0,e=this.h1,t=this.h2,r=this.h3,i=this.h4,a=this.h5,s=this.h6,o=this.h7,u=this.blocks,c,d,h,m,g,_,w,S,E,C,A;for(c=16;c<64;++c)g=u[c-15],d=(g>>>7|g<<25)^(g>>>18|g<<14)^g>>>3,g=u[c-2],h=(g>>>17|g<<15)^(g>>>19|g<<13)^g>>>10,u[c]=u[c-16]+d+u[c-7]+h<<0;for(A=e&t,c=0;c<64;c+=4)this.first?(this.is224?(S=300032,g=u[0]-1413257819,o=g-150054599<<0,r=g+24177077<<0):(S=704751109,g=u[0]-210244248,o=g-1521486534<<0,r=g+143694565<<0),this.first=!1):(d=(n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10),h=(i>>>6|i<<26)^(i>>>11|i<<21)^(i>>>25|i<<7),S=n&e,m=S^n&t^A,w=i&a^~i&s,g=o+h+w+qy[c]+u[c],_=d+m,o=r+g<<0,r=g+_<<0),d=(r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10),h=(o>>>6|o<<26)^(o>>>11|o<<21)^(o>>>25|o<<7),E=r&n,m=E^r&e^S,w=s&o^~s&i,g=a+h+w+qy[c+1]+u[c+1],_=d+m,s=t+g<<0,t=g+_<<0,d=(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10),h=(s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7),C=t&r,m=C^t&n^E,w=a&s^~a&o,g=i+h+w+qy[c+2]+u[c+2],_=d+m,a=e+g<<0,e=g+_<<0,d=(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10),h=(a>>>6|a<<26)^(a>>>11|a<<21)^(a>>>25|a<<7),A=e&t,m=A^e&r^C,w=a&s^~a&o,g=i+h+w+qy[c+3]+u[c+3],_=d+m,i=n+g<<0,n=g+_<<0,this.chromeBugWorkAround=!0;this.h0=this.h0+n<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+r<<0,this.h4=this.h4+i<<0,this.h5=this.h5+a<<0,this.h6=this.h6+s<<0,this.h7=this.h7+o<<0};Is.prototype.hex=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,i=this.h4,a=this.h5,s=this.h6,o=this.h7,u=ct[n>>>28&15]+ct[n>>>24&15]+ct[n>>>20&15]+ct[n>>>16&15]+ct[n>>>12&15]+ct[n>>>8&15]+ct[n>>>4&15]+ct[n&15]+ct[e>>>28&15]+ct[e>>>24&15]+ct[e>>>20&15]+ct[e>>>16&15]+ct[e>>>12&15]+ct[e>>>8&15]+ct[e>>>4&15]+ct[e&15]+ct[t>>>28&15]+ct[t>>>24&15]+ct[t>>>20&15]+ct[t>>>16&15]+ct[t>>>12&15]+ct[t>>>8&15]+ct[t>>>4&15]+ct[t&15]+ct[r>>>28&15]+ct[r>>>24&15]+ct[r>>>20&15]+ct[r>>>16&15]+ct[r>>>12&15]+ct[r>>>8&15]+ct[r>>>4&15]+ct[r&15]+ct[i>>>28&15]+ct[i>>>24&15]+ct[i>>>20&15]+ct[i>>>16&15]+ct[i>>>12&15]+ct[i>>>8&15]+ct[i>>>4&15]+ct[i&15]+ct[a>>>28&15]+ct[a>>>24&15]+ct[a>>>20&15]+ct[a>>>16&15]+ct[a>>>12&15]+ct[a>>>8&15]+ct[a>>>4&15]+ct[a&15]+ct[s>>>28&15]+ct[s>>>24&15]+ct[s>>>20&15]+ct[s>>>16&15]+ct[s>>>12&15]+ct[s>>>8&15]+ct[s>>>4&15]+ct[s&15];return this.is224||(u+=ct[o>>>28&15]+ct[o>>>24&15]+ct[o>>>20&15]+ct[o>>>16&15]+ct[o>>>12&15]+ct[o>>>8&15]+ct[o>>>4&15]+ct[o&15]),u};Is.prototype.toString=Is.prototype.hex;Is.prototype.digest=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,i=this.h4,a=this.h5,s=this.h6,o=this.h7,u=[n>>>24&255,n>>>16&255,n>>>8&255,n&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255,a>>>24&255,a>>>16&255,a>>>8&255,a&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255];return this.is224||u.push(o>>>24&255,o>>>16&255,o>>>8&255,o&255),u};Is.prototype.array=Is.prototype.digest;Is.prototype.arrayBuffer=function(){this.finalize();var n=new ArrayBuffer(this.is224?28:32),e=new DataView(n);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),e.setUint32(20,this.h5),e.setUint32(24,this.h6),this.is224||e.setUint32(28,this.h7),n};const bre=(...n)=>new Is(!1,!0).update(n.join("")).hex(),wre=Object.freeze(Object.defineProperty({__proto__:null,insecureHash:U5,sha256:bre},Symbol.toStringTag,{value:"Module"})),j5=(...n)=>U5(n.join("_"));function Ere(n){return n.message!==void 0?{text:n.text,message:cI(n.message)}:{text:n.text}}function Sre(n){const e={text:n.text};return n.message!==void 0&&(e.message=n.message.toDict()),e}let F5=class{constructor(){Object.defineProperty(this,"keyEncoder",{enumerable:!0,configurable:!0,writable:!0,value:j5})}makeDefaultKeyEncoder(e){this.keyEncoder=e}};const Tre=new Map;class jb extends F5{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(this.keyEncoder(e,t))??null)}async update(e,t,r){this.cache.set(this.keyEncoder(e,t),r)}static global(){return new jb(Tre)}}const Are=Object.freeze(Object.defineProperty({__proto__:null,BaseCache:F5,InMemoryCache:jb,deserializeStoredGeneration:Ere,getCacheKey:j5,serializeGeneration:Sre},Symbol.toStringTag,{value:"Module"}));class Fb extends wa{}class NI extends Fb{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new oi(this.value)]}}class MI extends Fb{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return Bm(this.messages)}toChatMessages(){return this.messages}}class B5 extends Fb{static lc_name(){return"ImagePromptValue"}constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"imageUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new oi({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}}const Cre=Object.freeze(Object.defineProperty({__proto__:null,BasePromptValue:Fb,ChatPromptValue:MI,ImagePromptValue:B5,StringPromptValue:NI},Symbol.toStringTag,{value:"Module"}));var tp={},tU;function xre(){if(tU)return tp;tU=1,tp.byteLength=o,tp.toByteArray=c,tp.fromByteArray=m;for(var n=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,a=r.length;i<a;++i)n[i]=r[i],e[r.charCodeAt(i)]=i;e[45]=62,e[95]=63;function s(g){var _=g.length;if(_%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var w=g.indexOf("=");w===-1&&(w=_);var S=w===_?0:4-w%4;return[w,S]}function o(g){var _=s(g),w=_[0],S=_[1];return(w+S)*3/4-S}function u(g,_,w){return(_+w)*3/4-w}function c(g){var _,w=s(g),S=w[0],E=w[1],C=new t(u(g,S,E)),A=0,R=E>0?S-4:S,P;for(P=0;P<R;P+=4)_=e[g.charCodeAt(P)]<<18|e[g.charCodeAt(P+1)]<<12|e[g.charCodeAt(P+2)]<<6|e[g.charCodeAt(P+3)],C[A++]=_>>16&255,C[A++]=_>>8&255,C[A++]=_&255;return E===2&&(_=e[g.charCodeAt(P)]<<2|e[g.charCodeAt(P+1)]>>4,C[A++]=_&255),E===1&&(_=e[g.charCodeAt(P)]<<10|e[g.charCodeAt(P+1)]<<4|e[g.charCodeAt(P+2)]>>2,C[A++]=_>>8&255,C[A++]=_&255),C}function d(g){return n[g>>18&63]+n[g>>12&63]+n[g>>6&63]+n[g&63]}function h(g,_,w){for(var S,E=[],C=_;C<w;C+=3)S=(g[C]<<16&16711680)+(g[C+1]<<8&65280)+(g[C+2]&255),E.push(d(S));return E.join("")}function m(g){for(var _,w=g.length,S=w%3,E=[],C=16383,A=0,R=w-S;A<R;A+=C)E.push(h(g,A,A+C>R?R:A+C));return S===1?(_=g[w-1],E.push(n[_>>2]+n[_<<4&63]+"==")):S===2&&(_=(g[w-2]<<8)+g[w-1],E.push(n[_>>10]+n[_>>4&63]+n[_<<2&63]+"=")),E.join("")}return tp}var Rre=xre();const Ire=Za(Rre);var Pre=Object.defineProperty,Ore=(n,e,t)=>e in n?Pre(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,kre=(n,e,t)=>(Ore(n,e+"",t),t);function Nre(n,e){let t=Array.from({length:n.length},(r,i)=>({start:i,end:i+1}));for(;t.length>1;){let r=null;for(let i=0;i<t.length-1;i++){const a=n.slice(t[i].start,t[i+1].end),s=e.get(a.join(","));s!=null&&(r==null||s<r[0])&&(r=[s,i])}if(r!=null){const i=r[1];t[i]={start:t[i].start,end:t[i+1].end},t.splice(i+1,1)}else break}return t}function Mre(n,e){return n.length===1?[e.get(n.join(","))]:Nre(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function Dre(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var Px=class{constructor(n,e){ti(this,"specialTokens");ti(this,"inverseSpecialTokens");ti(this,"patStr");ti(this,"textEncoder",new TextEncoder);ti(this,"textDecoder",new TextDecoder("utf-8"));ti(this,"rankMap",new Map);ti(this,"textMap",new Map);this.patStr=n.pat_str;const t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,i)=>{const[a,s,...o]=i.split(" "),u=Number.parseInt(s,10);return o.forEach((c,d)=>r[c]=u+d),r},{});for(const[r,i]of Object.entries(t)){const a=Ire.toByteArray(r);this.rankMap.set(a.join(","),i),this.textMap.set(i,a)}this.specialTokens={...n.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[i,a])=>(r[a]=this.textEncoder.encode(i),r),{})}encode(n,e=[],t="all"){const r=new RegExp(this.patStr,"ug"),i=Px.specialTokenRegex(Object.keys(this.specialTokens)),a=[],s=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(c=>!s.has(c)):t);if(o.size>0){const c=Px.specialTokenRegex([...o]),d=n.match(c);if(d!=null)throw new Error(`The text contains a special token that is not allowed: ${d[0]}`)}let u=0;for(;;){let c=null,d=u;for(;i.lastIndex=d,c=i.exec(n),!(c==null||s.has(c[0]));)d=c.index+1;const h=(c==null?void 0:c.index)??n.length;for(const g of n.substring(u,h).matchAll(r)){const _=this.textEncoder.encode(g[0]),w=this.rankMap.get(_.join(","));if(w!=null){a.push(w);continue}a.push(...Mre(_,this.rankMap))}if(c==null)break;let m=this.specialTokens[c[0]];a.push(m),u=c.index+c[0].length}return a}decode(n){const e=[];let t=0;for(let a=0;a<n.length;++a){const s=n[a],o=this.textMap.get(s)??this.inverseSpecialTokens[s];o!=null&&(e.push(o),t+=o.length)}const r=new Uint8Array(t);let i=0;for(const a of e)r.set(a,i),i+=a.length;return this.textDecoder.decode(r)}},q5=Px;kre(q5,"specialTokenRegex",n=>new RegExp(n.map(e=>Dre(e)).join("|"),"g"));function $re(n){switch(n){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":return"o200k_base";default:throw new Error("Unknown model")}}const Vy={},Lre=new Hm({});async function V5(n){return n in Vy||(Vy[n]=Lre.fetch(`https://tiktoken.pages.dev/js/${n}.json`).then(e=>e.json()).then(e=>new q5(e)).catch(e=>{throw delete Vy[n],e})),await Vy[n]}async function DI(n){return V5($re(n))}const Ure=Object.freeze(Object.defineProperty({__proto__:null,encodingForModel:DI,getEncoding:V5},Symbol.toStringTag,{value:"Module"})),Bb=n=>n.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":n.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":n.startsWith("gpt-4-32k")?"gpt-4-32k":n.startsWith("gpt-4-")?"gpt-4":n.startsWith("gpt-4o")?"gpt-4o":n,jre=n=>{switch(n){case"text-embedding-ada-002":return 8191;default:return 2046}},z5=n=>{switch(Bb(n)){case"gpt-3.5-turbo-16k":return 16384;case"gpt-3.5-turbo":return 4096;case"gpt-4-32k":return 32768;case"gpt-4":return 8192;case"text-davinci-003":return 4097;case"text-curie-001":return 2048;case"text-babbage-001":return 2048;case"text-ada-001":return 2048;case"code-davinci-002":return 8e3;case"code-cushman-001":return 2048;default:return 4097}};function Fd(n){return typeof n!="object"||!n?!1:!!("type"in n&&n.type==="function"&&"function"in n&&typeof n.function=="object"&&n.function&&"name"in n.function&&"parameters"in n.function)}const Fre=async({prompt:n,modelName:e})=>{let t;try{t=(await DI(Bb(e))).encode(n).length}catch{console.warn("Failed to calculate number of tokens, falling back to approximate count"),t=Math.ceil(n.length/4)}return z5(e)-t},Bre=()=>!1;class $I extends Gt{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??Bre(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class LI extends $I{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){const{cache:i,...a}=r;super({callbacks:e??t,...a}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof i=="object"?this.cache=i:i?this.cache=jb.global():this.cache=void 0,this.caller=new Hm(r??{})}async getNumTokens(e){let t;typeof e=="string"?t=e:t=e.map(i=>typeof i=="string"?i:i.type==="text"&&"text"in i?i.text:"").join("");let r=Math.ceil(t.length/4);if(!this._encoding)try{this._encoding=await DI("modelName"in this?Bb(this.modelName):"gpt2")}catch(i){console.warn("Failed to calculate number of tokens, falling back to approximate count",i)}if(this._encoding)try{r=this._encoding.encode(t).length}catch(i){console.warn("Failed to calculate number of tokens, falling back to approximate count",i)}return r}static _convertInputToPromptValue(e){return typeof e=="string"?new NI(e):Array.isArray(e)?new MI(e.map(_s)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const r={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(r).filter(([s,o])=>o!==void 0).map(([s,o])=>`${s}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}const qre=Object.freeze(Object.defineProperty({__proto__:null,BaseLangChain:$I,BaseLanguageModel:LI,calculateMaxTokens:Fre,getEmbeddingContextSize:jre,getModelContextSize:z5,getModelNameForTiktoken:Bb,isOpenAITool:Fd},Symbol.toStringTag,{value:"Module"}));function UI(n){return n!==void 0&&Array.isArray(n.lc_namespace)}function jI(n){return n!==void 0&&Gt.isRunnable(n)&&"lc_name"in n.constructor&&typeof n.constructor.lc_name=="function"&&n.constructor.lc_name()==="RunnableToolLike"}function FI(n){return!!n&&typeof n=="object"&&"name"in n&&"schema"in n&&(Ui(n.schema)||n.schema!=null&&typeof n.schema=="object"&&"type"in n.schema&&typeof n.schema.type=="string"&&["null","boolean","object","array","number","string"].includes(n.schema.type))}function Pc(n){return FI(n)||jI(n)||UI(n)}class qb extends $I{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"verboseParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"content"}),this.verboseParsingErrors=(e==null?void 0:e.verboseParsingErrors)??this.verboseParsingErrors,this.responseFormat=(e==null?void 0:e.responseFormat)??this.responseFormat}async invoke(e,t){let r,i=Qt(t);return Bp(e)?(r=e.args,i={...i,toolCall:e}):r=e,this.call(r,i)}async call(e,t,r){const i=Bp(e)?e.args:e;let a;if(Ui(this.schema))try{a=await Lb(this.schema,i)}catch(_){let w="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(w=`${w}
Details: ${_.message}`),new m_(w,JSON.stringify(e))}else{const _=Ln(i,this.schema);if(!_.valid){let w="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(w=`${w}
Details: ${_.errors.map(S=>`${S.keywordLocation}: ${S.error}`).join(`
`)}`),new m_(w,JSON.stringify(e))}a=i}const s=Vm(t),o=tr.configure(s.callbacks,this.callbacks,s.tags||r,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),u=await(o==null?void 0:o.handleToolStart(this.toJSON(),typeof e=="string"?e:JSON.stringify(e),s.runId,void 0,void 0,void 0,s.runName));delete s.runId;let c;try{c=await this._call(a,u,s)}catch(_){throw await(u==null?void 0:u.handleToolError(_)),_}let d,h;if(this.responseFormat==="content_and_artifact")if(Array.isArray(c)&&c.length===2)[d,h]=c;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(c)}`);else d=c;let m;Bp(e)&&(m=e.id),!m&&iX(s)&&(m=s.toolCall.id);const g=Hre({content:d,artifact:h,toolCallId:m,name:this.name});return await(u==null?void 0:u.handleToolEnd(g)),g}}class H5 extends qb{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:rt({input:$e().optional()}).transform(t=>t.input)})}call(e,t){const r=typeof e=="string"||e==null?{input:e}:e;return super.call(r,t)}}class G5 extends H5{static lc_name(){return"DynamicTool"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect}async call(e,t){const r=Vm(t);return r.runName===void 0&&(r.runName=this.name),super.call(e,r)}async _call(e,t,r){return this.func(e,t,r)}}class BI extends qb{static lc_name(){return"DynamicStructuredTool"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect,this.schema=e.schema}async call(e,t,r){const i=Vm(t);return i.runName===void 0&&(i.runName=this.name),super.call(e,i,r)}_call(e,t,r){return this.func(e,t,r)}}class Vre{getTools(){return this.tools}}function zre(n,e){var s;const t=CI(e.schema),r=zp(e.schema);if(!e.schema||t||r)return new G5({...e,description:e.description??((s=e.schema)==null?void 0:s.description)??`${e.name} tool`,func:async(o,u,c)=>new Promise((d,h)=>{const m=fn(c,{callbacks:u==null?void 0:u.getChild()});Hi.runWithConfig(el(m),async()=>{try{d(n(o,m))}catch(g){h(g)}})})});const i=e.schema,a=e.description??e.schema.description??`${e.name} tool`;return new BI({...e,description:a,schema:i,func:async(o,u,c)=>new Promise((d,h)=>{const m=fn(c,{callbacks:u==null?void 0:u.getChild()});Hi.runWithConfig(el(m),async()=>{try{d(n(o,m))}catch(g){h(g)}})})})}function Hre(n){const{content:e,artifact:t,toolCallId:r}=n;return r&&!WZ(e)?typeof e=="string"||Array.isArray(e)&&e.every(i=>typeof i=="object")?new Yo({content:e,artifact:t,tool_call_id:r,name:n.name}):new Yo({content:Gre(e),artifact:t,tool_call_id:r,name:n.name}):e}function Gre(n){try{return JSON.stringify(n,null,2)??""}catch{return`${n}`}}const Wre=Object.freeze(Object.defineProperty({__proto__:null,BaseToolkit:Vre,DynamicStructuredTool:BI,DynamicTool:G5,StructuredTool:qb,Tool:H5,ToolInputParsingException:m_,isLangChainTool:Pc,isRunnableToolLike:jI,isStructuredTool:UI,isStructuredToolParams:FI,tool:zre},Symbol.toStringTag,{value:"Module"})),Vb="2025-06-18",Kre=[Vb,"2025-03-26","2024-11-05","2024-10-07"],zb="2.0",W5=In([$e(),Yn().int()]),K5=$e(),Jre=rt({progressToken:Ke(W5)}).passthrough(),es=rt({_meta:Ke(Jre)}).passthrough(),Xi=rt({method:$e(),params:Ke(es)}),Wm=rt({_meta:Ke(rt({}).passthrough())}).passthrough(),mo=rt({method:$e(),params:Ke(Wm)}),ts=rt({_meta:Ke(rt({}).passthrough())}).passthrough(),Hb=In([$e(),Yn().int()]),J5=rt({jsonrpc:Pt(zb),id:Hb}).merge(Xi).strict(),Y5=n=>J5.safeParse(n).success,Z5=rt({jsonrpc:Pt(zb)}).merge(mo).strict(),Yre=n=>Z5.safeParse(n).success,X5=rt({jsonrpc:Pt(zb),id:Hb,result:ts}).strict(),Ox=n=>X5.safeParse(n).success;var Ws;(function(n){n[n.ConnectionClosed=-32e3]="ConnectionClosed",n[n.RequestTimeout=-32001]="RequestTimeout",n[n.ParseError=-32700]="ParseError",n[n.InvalidRequest=-32600]="InvalidRequest",n[n.MethodNotFound=-32601]="MethodNotFound",n[n.InvalidParams=-32602]="InvalidParams",n[n.InternalError=-32603]="InternalError"})(Ws||(Ws={}));const Q5=rt({jsonrpc:Pt(zb),id:Hb,error:rt({code:Yn().int(),message:$e(),data:Ke(dc())})}).strict(),Zre=n=>Q5.safeParse(n).success,ud=In([J5,Z5,X5,Q5]),Kf=ts.strict(),qI=mo.extend({method:Pt("notifications/cancelled"),params:Wm.extend({requestId:Hb,reason:$e().optional()})}),Km=rt({name:$e(),title:Ke($e())}).passthrough(),eq=Km.extend({version:$e()}),Xre=rt({experimental:Ke(rt({}).passthrough()),sampling:Ke(rt({}).passthrough()),elicitation:Ke(rt({}).passthrough()),roots:Ke(rt({listChanged:Ke(Jr())}).passthrough())}).passthrough(),Qre=Xi.extend({method:Pt("initialize"),params:es.extend({protocolVersion:$e(),capabilities:Xre,clientInfo:eq})}),eie=rt({experimental:Ke(rt({}).passthrough()),logging:Ke(rt({}).passthrough()),completions:Ke(rt({}).passthrough()),prompts:Ke(rt({listChanged:Ke(Jr())}).passthrough()),resources:Ke(rt({subscribe:Ke(Jr()),listChanged:Ke(Jr())}).passthrough()),tools:Ke(rt({listChanged:Ke(Jr())}).passthrough())}).passthrough(),tq=ts.extend({protocolVersion:$e(),capabilities:eie,serverInfo:eq,instructions:Ke($e())}),nq=mo.extend({method:Pt("notifications/initialized")}),tie=n=>nq.safeParse(n).success,VI=Xi.extend({method:Pt("ping")}),nie=rt({progress:Yn(),total:Ke(Yn()),message:Ke($e())}).passthrough(),zI=mo.extend({method:Pt("notifications/progress"),params:Wm.merge(nie).extend({progressToken:W5})}),Gb=Xi.extend({params:es.extend({cursor:Ke(K5)}).optional()}),Wb=ts.extend({nextCursor:Ke(K5)}),rq=rt({uri:$e(),mimeType:Ke($e()),_meta:Ke(rt({}).passthrough())}).passthrough(),iq=rq.extend({text:$e()}),aq=rq.extend({blob:$e().base64()}),sq=Km.extend({uri:$e(),description:Ke($e()),mimeType:Ke($e()),_meta:Ke(rt({}).passthrough())}),rie=Km.extend({uriTemplate:$e(),description:Ke($e()),mimeType:Ke($e()),_meta:Ke(rt({}).passthrough())}),iie=Gb.extend({method:Pt("resources/list")}),oq=Wb.extend({resources:kt(sq)}),aie=Gb.extend({method:Pt("resources/templates/list")}),lq=Wb.extend({resourceTemplates:kt(rie)}),sie=Xi.extend({method:Pt("resources/read"),params:es.extend({uri:$e()})}),uq=ts.extend({contents:kt(In([iq,aq]))}),oie=mo.extend({method:Pt("notifications/resources/list_changed")}),lie=Xi.extend({method:Pt("resources/subscribe"),params:es.extend({uri:$e()})}),uie=Xi.extend({method:Pt("resources/unsubscribe"),params:es.extend({uri:$e()})}),cie=mo.extend({method:Pt("notifications/resources/updated"),params:Wm.extend({uri:$e()})}),fie=rt({name:$e(),description:Ke($e()),required:Ke(Jr())}).passthrough(),die=Km.extend({description:Ke($e()),arguments:Ke(kt(fie)),_meta:Ke(rt({}).passthrough())}),hie=Gb.extend({method:Pt("prompts/list")}),cq=Wb.extend({prompts:kt(die)}),pie=Xi.extend({method:Pt("prompts/get"),params:es.extend({name:$e(),arguments:Ke(gs($e()))})}),HI=rt({type:Pt("text"),text:$e(),_meta:Ke(rt({}).passthrough())}).passthrough(),GI=rt({type:Pt("image"),data:$e().base64(),mimeType:$e(),_meta:Ke(rt({}).passthrough())}).passthrough(),WI=rt({type:Pt("audio"),data:$e().base64(),mimeType:$e(),_meta:Ke(rt({}).passthrough())}).passthrough(),mie=rt({type:Pt("resource"),resource:In([iq,aq]),_meta:Ke(rt({}).passthrough())}).passthrough(),gie=sq.extend({type:Pt("resource_link")}),fq=In([HI,GI,WI,gie,mie]),yie=rt({role:xs(["user","assistant"]),content:fq}).passthrough(),dq=ts.extend({description:Ke($e()),messages:kt(yie)}),vie=mo.extend({method:Pt("notifications/prompts/list_changed")}),_ie=rt({title:Ke($e()),readOnlyHint:Ke(Jr()),destructiveHint:Ke(Jr()),idempotentHint:Ke(Jr()),openWorldHint:Ke(Jr())}).passthrough(),bie=Km.extend({description:Ke($e()),inputSchema:rt({type:Pt("object"),properties:Ke(rt({}).passthrough()),required:Ke(kt($e()))}).passthrough(),outputSchema:Ke(rt({type:Pt("object"),properties:Ke(rt({}).passthrough()),required:Ke(kt($e()))}).passthrough()),annotations:Ke(_ie),_meta:Ke(rt({}).passthrough())}),wie=Gb.extend({method:Pt("tools/list")}),KI=Wb.extend({tools:kt(bie)}),Kb=ts.extend({content:kt(fq).default([]),structuredContent:rt({}).passthrough().optional(),isError:Ke(Jr())});Kb.or(ts.extend({toolResult:dc()}));const Eie=Xi.extend({method:Pt("tools/call"),params:es.extend({name:$e(),arguments:Ke(gs(dc()))})}),Sie=mo.extend({method:Pt("notifications/tools/list_changed")}),hq=xs(["debug","info","notice","warning","error","critical","alert","emergency"]),Tie=Xi.extend({method:Pt("logging/setLevel"),params:es.extend({level:hq})}),Aie=mo.extend({method:Pt("notifications/message"),params:Wm.extend({level:hq,logger:Ke($e()),data:dc()})}),Cie=rt({name:$e().optional()}).passthrough(),xie=rt({hints:Ke(kt(Cie)),costPriority:Ke(Yn().min(0).max(1)),speedPriority:Ke(Yn().min(0).max(1)),intelligencePriority:Ke(Yn().min(0).max(1))}).passthrough(),Rie=rt({role:xs(["user","assistant"]),content:In([HI,GI,WI])}).passthrough(),Iie=Xi.extend({method:Pt("sampling/createMessage"),params:es.extend({messages:kt(Rie),systemPrompt:Ke($e()),includeContext:Ke(xs(["none","thisServer","allServers"])),temperature:Ke(Yn()),maxTokens:Yn().int(),stopSequences:Ke(kt($e())),metadata:Ke(rt({}).passthrough()),modelPreferences:Ke(xie)})}),Pie=ts.extend({model:$e(),stopReason:Ke(xs(["endTurn","stopSequence","maxTokens"]).or($e())),role:xs(["user","assistant"]),content:DX("type",[HI,GI,WI])}),Oie=rt({type:Pt("boolean"),title:Ke($e()),description:Ke($e()),default:Ke(Jr())}).passthrough(),kie=rt({type:Pt("string"),title:Ke($e()),description:Ke($e()),minLength:Ke(Yn()),maxLength:Ke(Yn()),format:Ke(xs(["email","uri","date","date-time"]))}).passthrough(),Nie=rt({type:xs(["number","integer"]),title:Ke($e()),description:Ke($e()),minimum:Ke(Yn()),maximum:Ke(Yn())}).passthrough(),Mie=rt({type:Pt("string"),title:Ke($e()),description:Ke($e()),enum:kt($e()),enumNames:Ke(kt($e()))}).passthrough(),Die=In([Oie,kie,Nie,Mie]),$ie=Xi.extend({method:Pt("elicitation/create"),params:es.extend({message:$e(),requestedSchema:rt({type:Pt("object"),properties:gs($e(),Die),required:Ke(kt($e()))}).passthrough()})}),Lie=ts.extend({action:xs(["accept","reject","cancel"]),content:Ke(gs($e(),dc()))}),Uie=rt({type:Pt("ref/resource"),uri:$e()}).passthrough(),jie=rt({type:Pt("ref/prompt"),name:$e()}).passthrough(),Fie=Xi.extend({method:Pt("completion/complete"),params:es.extend({ref:In([jie,Uie]),argument:rt({name:$e(),value:$e()}).passthrough(),context:Ke(rt({arguments:Ke(gs($e(),$e()))}))})}),pq=ts.extend({completion:rt({values:kt($e()).max(100),total:Ke(Yn().int()),hasMore:Ke(Jr())}).passthrough()}),Bie=rt({uri:$e().startsWith("file://"),name:Ke($e()),_meta:Ke(rt({}).passthrough())}).passthrough(),qie=Xi.extend({method:Pt("roots/list")}),Vie=ts.extend({roots:kt(Bie)}),zie=mo.extend({method:Pt("notifications/roots/list_changed")});In([VI,Qre,Fie,Tie,pie,hie,iie,aie,sie,lie,uie,Eie,wie]);In([qI,zI,nq,zie]);In([Kf,Pie,Lie,Vie]);In([VI,Iie,$ie,qie]);In([qI,zI,Aie,cie,oie,Sie,vie]);In([Kf,tq,pq,dq,cq,oq,lq,uq,Kb,KI]);class Hl extends Error{constructor(e,t,r){super(`MCP error ${e}: ${t}`),this.code=e,this.data=r,this.name="McpError"}}const Hie=6e4;class Gie{constructor(e){this._options=e,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this.setNotificationHandler(qI,t=>{const r=this._requestHandlerAbortControllers.get(t.params.requestId);r==null||r.abort(t.params.reason)}),this.setNotificationHandler(zI,t=>{this._onprogress(t)}),this.setRequestHandler(VI,t=>({}))}_setupTimeout(e,t,r,i,a=!1){this._timeoutInfo.set(e,{timeoutId:setTimeout(i,t),startTime:Date.now(),timeout:t,maxTotalTimeout:r,resetTimeoutOnProgress:a,onTimeout:i})}_resetTimeout(e){const t=this._timeoutInfo.get(e);if(!t)return!1;const r=Date.now()-t.startTime;if(t.maxTotalTimeout&&r>=t.maxTotalTimeout)throw this._timeoutInfo.delete(e),new Hl(Ws.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:t.maxTotalTimeout,totalElapsed:r});return clearTimeout(t.timeoutId),t.timeoutId=setTimeout(t.onTimeout,t.timeout),!0}_cleanupTimeout(e){const t=this._timeoutInfo.get(e);t&&(clearTimeout(t.timeoutId),this._timeoutInfo.delete(e))}async connect(e){var t,r,i;this._transport=e;const a=(t=this.transport)===null||t===void 0?void 0:t.onclose;this._transport.onclose=()=>{a==null||a(),this._onclose()};const s=(r=this.transport)===null||r===void 0?void 0:r.onerror;this._transport.onerror=u=>{s==null||s(u),this._onerror(u)};const o=(i=this._transport)===null||i===void 0?void 0:i.onmessage;this._transport.onmessage=(u,c)=>{o==null||o(u,c),Ox(u)||Zre(u)?this._onresponse(u):Y5(u)?this._onrequest(u,c):Yre(u)?this._onnotification(u):this._onerror(new Error(`Unknown message type: ${JSON.stringify(u)}`))},await this._transport.start()}_onclose(){var e;const t=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._transport=void 0,(e=this.onclose)===null||e===void 0||e.call(this);const r=new Hl(Ws.ConnectionClosed,"Connection closed");for(const i of t.values())i(r)}_onerror(e){var t;(t=this.onerror)===null||t===void 0||t.call(this,e)}_onnotification(e){var t;const r=(t=this._notificationHandlers.get(e.method))!==null&&t!==void 0?t:this.fallbackNotificationHandler;r!==void 0&&Promise.resolve().then(()=>r(e)).catch(i=>this._onerror(new Error(`Uncaught error in notification handler: ${i}`)))}_onrequest(e,t){var r,i,a,s;const o=(r=this._requestHandlers.get(e.method))!==null&&r!==void 0?r:this.fallbackRequestHandler;if(o===void 0){(i=this._transport)===null||i===void 0||i.send({jsonrpc:"2.0",id:e.id,error:{code:Ws.MethodNotFound,message:"Method not found"}}).catch(d=>this._onerror(new Error(`Failed to send an error response: ${d}`)));return}const u=new AbortController;this._requestHandlerAbortControllers.set(e.id,u);const c={signal:u.signal,sessionId:(a=this._transport)===null||a===void 0?void 0:a.sessionId,_meta:(s=e.params)===null||s===void 0?void 0:s._meta,sendNotification:d=>this.notification(d,{relatedRequestId:e.id}),sendRequest:(d,h,m)=>this.request(d,h,{...m,relatedRequestId:e.id}),authInfo:t==null?void 0:t.authInfo,requestId:e.id,requestInfo:t==null?void 0:t.requestInfo};Promise.resolve().then(()=>o(e,c)).then(d=>{var h;if(!u.signal.aborted)return(h=this._transport)===null||h===void 0?void 0:h.send({result:d,jsonrpc:"2.0",id:e.id})},d=>{var h,m;if(!u.signal.aborted)return(h=this._transport)===null||h===void 0?void 0:h.send({jsonrpc:"2.0",id:e.id,error:{code:Number.isSafeInteger(d.code)?d.code:Ws.InternalError,message:(m=d.message)!==null&&m!==void 0?m:"Internal error"}})}).catch(d=>this._onerror(new Error(`Failed to send response: ${d}`))).finally(()=>{this._requestHandlerAbortControllers.delete(e.id)})}_onprogress(e){const{progressToken:t,...r}=e.params,i=Number(t),a=this._progressHandlers.get(i);if(!a){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(e)}`));return}const s=this._responseHandlers.get(i),o=this._timeoutInfo.get(i);if(o&&s&&o.resetTimeoutOnProgress)try{this._resetTimeout(i)}catch(u){s(u);return}a(r)}_onresponse(e){const t=Number(e.id),r=this._responseHandlers.get(t);if(r===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(e)}`));return}if(this._responseHandlers.delete(t),this._progressHandlers.delete(t),this._cleanupTimeout(t),Ox(e))r(e);else{const i=new Hl(e.error.code,e.error.message,e.error.data);r(i)}}get transport(){return this._transport}async close(){var e;await((e=this._transport)===null||e===void 0?void 0:e.close())}request(e,t,r){const{relatedRequestId:i,resumptionToken:a,onresumptiontoken:s}=r??{};return new Promise((o,u)=>{var c,d,h,m,g,_;if(!this._transport){u(new Error("Not connected"));return}((c=this._options)===null||c===void 0?void 0:c.enforceStrictCapabilities)===!0&&this.assertCapabilityForMethod(e.method),(d=r==null?void 0:r.signal)===null||d===void 0||d.throwIfAborted();const w=this._requestMessageId++,S={...e,jsonrpc:"2.0",id:w};r!=null&&r.onprogress&&(this._progressHandlers.set(w,r.onprogress),S.params={...e.params,_meta:{...((h=e.params)===null||h===void 0?void 0:h._meta)||{},progressToken:w}});const E=R=>{var P;this._responseHandlers.delete(w),this._progressHandlers.delete(w),this._cleanupTimeout(w),(P=this._transport)===null||P===void 0||P.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:w,reason:String(R)}},{relatedRequestId:i,resumptionToken:a,onresumptiontoken:s}).catch(N=>this._onerror(new Error(`Failed to send cancellation: ${N}`))),u(R)};this._responseHandlers.set(w,R=>{var P;if(!(!((P=r==null?void 0:r.signal)===null||P===void 0)&&P.aborted)){if(R instanceof Error)return u(R);try{const N=t.parse(R.result);o(N)}catch(N){u(N)}}}),(m=r==null?void 0:r.signal)===null||m===void 0||m.addEventListener("abort",()=>{var R;E((R=r==null?void 0:r.signal)===null||R===void 0?void 0:R.reason)});const C=(g=r==null?void 0:r.timeout)!==null&&g!==void 0?g:Hie,A=()=>E(new Hl(Ws.RequestTimeout,"Request timed out",{timeout:C}));this._setupTimeout(w,C,r==null?void 0:r.maxTotalTimeout,A,(_=r==null?void 0:r.resetTimeoutOnProgress)!==null&&_!==void 0?_:!1),this._transport.send(S,{relatedRequestId:i,resumptionToken:a,onresumptiontoken:s}).catch(R=>{this._cleanupTimeout(w),u(R)})})}async notification(e,t){if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(e.method);const r={...e,jsonrpc:"2.0"};await this._transport.send(r,t)}setRequestHandler(e,t){const r=e.shape.method.value;this.assertRequestHandlerCapability(r),this._requestHandlers.set(r,(i,a)=>Promise.resolve(t(e.parse(i),a)))}removeRequestHandler(e){this._requestHandlers.delete(e)}assertCanSetRequestHandler(e){if(this._requestHandlers.has(e))throw new Error(`A request handler for ${e} already exists, which would be overridden`)}setNotificationHandler(e,t){this._notificationHandlers.set(e.shape.method.value,r=>Promise.resolve(t(e.parse(r))))}removeNotificationHandler(e){this._notificationHandlers.delete(e)}}function Wie(n,e){return Object.entries(e).reduce((t,[r,i])=>(i&&typeof i=="object"?t[r]=t[r]?{...t[r],...i}:i:t[r]=i,t),{...n})}var bp={exports:{}};/** @license URI.js v4.4.1 (c) 2011 Gary Court. License: http://github.com/garycourt/uri-js */var Kie=bp.exports,nU;function Jie(){return nU||(nU=1,function(n,e){(function(t,r){r(e)})(Kie,function(t){function r(){for(var Q=arguments.length,ne=Array(Q),de=0;de<Q;de++)ne[de]=arguments[de];if(ne.length>1){ne[0]=ne[0].slice(0,-1);for(var Se=ne.length-1,Ee=1;Ee<Se;++Ee)ne[Ee]=ne[Ee].slice(1,-1);return ne[Se]=ne[Se].slice(1),ne.join("")}else return ne[0]}function i(Q){return"(?:"+Q+")"}function a(Q){return Q===void 0?"undefined":Q===null?"null":Object.prototype.toString.call(Q).split(" ").pop().split("]").shift().toLowerCase()}function s(Q){return Q.toUpperCase()}function o(Q){return Q!=null?Q instanceof Array?Q:typeof Q.length!="number"||Q.split||Q.setInterval||Q.call?[Q]:Array.prototype.slice.call(Q):[]}function u(Q,ne){var de=Q;if(ne)for(var Se in ne)de[Se]=ne[Se];return de}function c(Q){var ne="[A-Za-z]",de="[0-9]",Se=r(de,"[A-Fa-f]"),Ee=i(i("%[EFef]"+Se+"%"+Se+Se+"%"+Se+Se)+"|"+i("%[89A-Fa-f]"+Se+"%"+Se+Se)+"|"+i("%"+Se+Se)),et="[\\:\\/\\?\\#\\[\\]\\@]",dt="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",$t=r(et,dt),on=Q?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]",_n=Q?"[\\uE000-\\uF8FF]":"[]",gt=r(ne,de,"[\\-\\.\\_\\~]",on);i(ne+r(ne,de,"[\\+\\-\\.]")+"*"),i(i(Ee+"|"+r(gt,dt,"[\\:]"))+"*");var pn=i(i("25[0-5]")+"|"+i("2[0-4]"+de)+"|"+i("1"+de+de)+"|"+i("0?[1-9]"+de)+"|0?0?"+de),Dn=i(pn+"\\."+pn+"\\."+pn+"\\."+pn),vt=i(Se+"{1,4}"),ln=i(i(vt+"\\:"+vt)+"|"+Dn),Gn=i(i(vt+"\\:")+"{6}"+ln),An=i("\\:\\:"+i(vt+"\\:")+"{5}"+ln),ns=i(i(vt)+"?\\:\\:"+i(vt+"\\:")+"{4}"+ln),Ca=i(i(i(vt+"\\:")+"{0,1}"+vt)+"?\\:\\:"+i(vt+"\\:")+"{3}"+ln),di=i(i(i(vt+"\\:")+"{0,2}"+vt)+"?\\:\\:"+i(vt+"\\:")+"{2}"+ln),rs=i(i(i(vt+"\\:")+"{0,3}"+vt)+"?\\:\\:"+vt+"\\:"+ln),Lr=i(i(i(vt+"\\:")+"{0,4}"+vt)+"?\\:\\:"+ln),Qr=i(i(i(vt+"\\:")+"{0,5}"+vt)+"?\\:\\:"+vt),ea=i(i(i(vt+"\\:")+"{0,6}"+vt)+"?\\:\\:"),Ci=i([Gn,An,ns,Ca,di,rs,Lr,Qr,ea].join("|")),ta=i(i(gt+"|"+Ee)+"+");i("[vV]"+Se+"+\\."+r(gt,dt,"[\\:]")+"+"),i(i(Ee+"|"+r(gt,dt))+"*");var go=i(Ee+"|"+r(gt,dt,"[\\:\\@]"));return i(i(Ee+"|"+r(gt,dt,"[\\@]"))+"+"),i(i(go+"|"+r("[\\/\\?]",_n))+"*"),{NOT_SCHEME:new RegExp(r("[^]",ne,de,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(r("[^\\%\\:]",gt,dt),"g"),NOT_HOST:new RegExp(r("[^\\%\\[\\]\\:]",gt,dt),"g"),NOT_PATH:new RegExp(r("[^\\%\\/\\:\\@]",gt,dt),"g"),NOT_PATH_NOSCHEME:new RegExp(r("[^\\%\\/\\@]",gt,dt),"g"),NOT_QUERY:new RegExp(r("[^\\%]",gt,dt,"[\\:\\@\\/\\?]",_n),"g"),NOT_FRAGMENT:new RegExp(r("[^\\%]",gt,dt,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(r("[^]",gt,dt),"g"),UNRESERVED:new RegExp(gt,"g"),OTHER_CHARS:new RegExp(r("[^\\%]",gt,$t),"g"),PCT_ENCODED:new RegExp(Ee,"g"),IPV4ADDRESS:new RegExp("^("+Dn+")$"),IPV6ADDRESS:new RegExp("^\\[?("+Ci+")"+i(i("\\%25|\\%(?!"+Se+"{2})")+"("+ta+")")+"?\\]?$")}}var d=c(!1),h=c(!0),m=function(){function Q(ne,de){var Se=[],Ee=!0,et=!1,dt=void 0;try{for(var $t=ne[Symbol.iterator](),on;!(Ee=(on=$t.next()).done)&&(Se.push(on.value),!(de&&Se.length===de));Ee=!0);}catch(_n){et=!0,dt=_n}finally{try{!Ee&&$t.return&&$t.return()}finally{if(et)throw dt}}return Se}return function(ne,de){if(Array.isArray(ne))return ne;if(Symbol.iterator in Object(ne))return Q(ne,de);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),g=function(Q){if(Array.isArray(Q)){for(var ne=0,de=Array(Q.length);ne<Q.length;ne++)de[ne]=Q[ne];return de}else return Array.from(Q)},_=2147483647,w=36,S=1,E=26,C=38,A=700,R=72,P=128,N="-",U=/^xn--/,k=/[^\0-\x7E]/,B=/[\x2E\u3002\uFF0E\uFF61]/g,H={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},G=w-S,z=Math.floor,oe=String.fromCharCode;function te(Q){throw new RangeError(H[Q])}function se(Q,ne){for(var de=[],Se=Q.length;Se--;)de[Se]=ne(Q[Se]);return de}function ee(Q,ne){var de=Q.split("@"),Se="";de.length>1&&(Se=de[0]+"@",Q=de[1]),Q=Q.replace(B,".");var Ee=Q.split("."),et=se(Ee,ne).join(".");return Se+et}function le(Q){for(var ne=[],de=0,Se=Q.length;de<Se;){var Ee=Q.charCodeAt(de++);if(Ee>=55296&&Ee<=56319&&de<Se){var et=Q.charCodeAt(de++);(et&64512)==56320?ne.push(((Ee&1023)<<10)+(et&1023)+65536):(ne.push(Ee),de--)}else ne.push(Ee)}return ne}var pe=function(ne){return String.fromCodePoint.apply(String,g(ne))},we=function(ne){return ne-48<10?ne-22:ne-65<26?ne-65:ne-97<26?ne-97:w},$=function(ne,de){return ne+22+75*(ne<26)-((de!=0)<<5)},ve=function(ne,de,Se){var Ee=0;for(ne=Se?z(ne/A):ne>>1,ne+=z(ne/de);ne>G*E>>1;Ee+=w)ne=z(ne/G);return z(Ee+(G+1)*ne/(ne+C))},Te=function(ne){var de=[],Se=ne.length,Ee=0,et=P,dt=R,$t=ne.lastIndexOf(N);$t<0&&($t=0);for(var on=0;on<$t;++on)ne.charCodeAt(on)>=128&&te("not-basic"),de.push(ne.charCodeAt(on));for(var _n=$t>0?$t+1:0;_n<Se;){for(var gt=Ee,pn=1,Dn=w;;Dn+=w){_n>=Se&&te("invalid-input");var vt=we(ne.charCodeAt(_n++));(vt>=w||vt>z((_-Ee)/pn))&&te("overflow"),Ee+=vt*pn;var ln=Dn<=dt?S:Dn>=dt+E?E:Dn-dt;if(vt<ln)break;var Gn=w-ln;pn>z(_/Gn)&&te("overflow"),pn*=Gn}var An=de.length+1;dt=ve(Ee-gt,An,gt==0),z(Ee/An)>_-et&&te("overflow"),et+=z(Ee/An),Ee%=An,de.splice(Ee++,0,et)}return String.fromCodePoint.apply(String,de)},F=function(ne){var de=[];ne=le(ne);var Se=ne.length,Ee=P,et=0,dt=R,$t=!0,on=!1,_n=void 0;try{for(var gt=ne[Symbol.iterator](),pn;!($t=(pn=gt.next()).done);$t=!0){var Dn=pn.value;Dn<128&&de.push(oe(Dn))}}catch(Ms){on=!0,_n=Ms}finally{try{!$t&&gt.return&&gt.return()}finally{if(on)throw _n}}var vt=de.length,ln=vt;for(vt&&de.push(N);ln<Se;){var Gn=_,An=!0,ns=!1,Ca=void 0;try{for(var di=ne[Symbol.iterator](),rs;!(An=(rs=di.next()).done);An=!0){var Lr=rs.value;Lr>=Ee&&Lr<Gn&&(Gn=Lr)}}catch(Ms){ns=!0,Ca=Ms}finally{try{!An&&di.return&&di.return()}finally{if(ns)throw Ca}}var Qr=ln+1;Gn-Ee>z((_-et)/Qr)&&te("overflow"),et+=(Gn-Ee)*Qr,Ee=Gn;var ea=!0,Ci=!1,ta=void 0;try{for(var go=ne[Symbol.iterator](),Eg;!(ea=(Eg=go.next()).done);ea=!0){var Qd=Eg.value;if(Qd<Ee&&++et>_&&te("overflow"),Qd==Ee){for(var Ur=et,hu=w;;hu+=w){var Uc=hu<=dt?S:hu>=dt+E?E:hu-dt;if(Ur<Uc)break;var pu=Ur-Uc,eh=w-Uc;de.push(oe($(Uc+pu%eh,0))),Ur=z(pu/eh)}de.push(oe($(Ur,0))),dt=ve(et,Qr,ln==vt),et=0,++ln}}}catch(Ms){Ci=!0,ta=Ms}finally{try{!ea&&go.return&&go.return()}finally{if(Ci)throw ta}}++et,++Ee}return de.join("")},ae=function(ne){return ee(ne,function(de){return U.test(de)?Te(de.slice(4).toLowerCase()):de})},fe=function(ne){return ee(ne,function(de){return k.test(de)?"xn--"+F(de):de})},I={version:"2.1.0",ucs2:{decode:le,encode:pe},decode:Te,encode:F,toASCII:fe,toUnicode:ae},O={};function J(Q){var ne=Q.charCodeAt(0),de=void 0;return ne<16?de="%0"+ne.toString(16).toUpperCase():ne<128?de="%"+ne.toString(16).toUpperCase():ne<2048?de="%"+(ne>>6|192).toString(16).toUpperCase()+"%"+(ne&63|128).toString(16).toUpperCase():de="%"+(ne>>12|224).toString(16).toUpperCase()+"%"+(ne>>6&63|128).toString(16).toUpperCase()+"%"+(ne&63|128).toString(16).toUpperCase(),de}function X(Q){for(var ne="",de=0,Se=Q.length;de<Se;){var Ee=parseInt(Q.substr(de+1,2),16);if(Ee<128)ne+=String.fromCharCode(Ee),de+=3;else if(Ee>=194&&Ee<224){if(Se-de>=6){var et=parseInt(Q.substr(de+4,2),16);ne+=String.fromCharCode((Ee&31)<<6|et&63)}else ne+=Q.substr(de,6);de+=6}else if(Ee>=224){if(Se-de>=9){var dt=parseInt(Q.substr(de+4,2),16),$t=parseInt(Q.substr(de+7,2),16);ne+=String.fromCharCode((Ee&15)<<12|(dt&63)<<6|$t&63)}else ne+=Q.substr(de,9);de+=9}else ne+=Q.substr(de,3),de+=3}return ne}function ue(Q,ne){function de(Se){var Ee=X(Se);return Ee.match(ne.UNRESERVED)?Ee:Se}return Q.scheme&&(Q.scheme=String(Q.scheme).replace(ne.PCT_ENCODED,de).toLowerCase().replace(ne.NOT_SCHEME,"")),Q.userinfo!==void 0&&(Q.userinfo=String(Q.userinfo).replace(ne.PCT_ENCODED,de).replace(ne.NOT_USERINFO,J).replace(ne.PCT_ENCODED,s)),Q.host!==void 0&&(Q.host=String(Q.host).replace(ne.PCT_ENCODED,de).toLowerCase().replace(ne.NOT_HOST,J).replace(ne.PCT_ENCODED,s)),Q.path!==void 0&&(Q.path=String(Q.path).replace(ne.PCT_ENCODED,de).replace(Q.scheme?ne.NOT_PATH:ne.NOT_PATH_NOSCHEME,J).replace(ne.PCT_ENCODED,s)),Q.query!==void 0&&(Q.query=String(Q.query).replace(ne.PCT_ENCODED,de).replace(ne.NOT_QUERY,J).replace(ne.PCT_ENCODED,s)),Q.fragment!==void 0&&(Q.fragment=String(Q.fragment).replace(ne.PCT_ENCODED,de).replace(ne.NOT_FRAGMENT,J).replace(ne.PCT_ENCODED,s)),Q}function V(Q){return Q.replace(/^0*(.*)/,"$1")||"0"}function K(Q,ne){var de=Q.match(ne.IPV4ADDRESS)||[],Se=m(de,2),Ee=Se[1];return Ee?Ee.split(".").map(V).join("."):Q}function _e(Q,ne){var de=Q.match(ne.IPV6ADDRESS)||[],Se=m(de,3),Ee=Se[1],et=Se[2];if(Ee){for(var dt=Ee.toLowerCase().split("::").reverse(),$t=m(dt,2),on=$t[0],_n=$t[1],gt=_n?_n.split(":").map(V):[],pn=on.split(":").map(V),Dn=ne.IPV4ADDRESS.test(pn[pn.length-1]),vt=Dn?7:8,ln=pn.length-vt,Gn=Array(vt),An=0;An<vt;++An)Gn[An]=gt[An]||pn[ln+An]||"";Dn&&(Gn[vt-1]=K(Gn[vt-1],ne));var ns=Gn.reduce(function(Qr,ea,Ci){if(!ea||ea==="0"){var ta=Qr[Qr.length-1];ta&&ta.index+ta.length===Ci?ta.length++:Qr.push({index:Ci,length:1})}return Qr},[]),Ca=ns.sort(function(Qr,ea){return ea.length-Qr.length})[0],di=void 0;if(Ca&&Ca.length>1){var rs=Gn.slice(0,Ca.index),Lr=Gn.slice(Ca.index+Ca.length);di=rs.join(":")+"::"+Lr.join(":")}else di=Gn.join(":");return et&&(di+="%"+et),di}else return Q}var Me=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,tt="".match(/(){0}/)[1]===void 0;function je(Q){var ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},de={},Se=ne.iri!==!1?h:d;ne.reference==="suffix"&&(Q=(ne.scheme?ne.scheme+":":"")+"//"+Q);var Ee=Q.match(Me);if(Ee){tt?(de.scheme=Ee[1],de.userinfo=Ee[3],de.host=Ee[4],de.port=parseInt(Ee[5],10),de.path=Ee[6]||"",de.query=Ee[7],de.fragment=Ee[8],isNaN(de.port)&&(de.port=Ee[5])):(de.scheme=Ee[1]||void 0,de.userinfo=Q.indexOf("@")!==-1?Ee[3]:void 0,de.host=Q.indexOf("//")!==-1?Ee[4]:void 0,de.port=parseInt(Ee[5],10),de.path=Ee[6]||"",de.query=Q.indexOf("?")!==-1?Ee[7]:void 0,de.fragment=Q.indexOf("#")!==-1?Ee[8]:void 0,isNaN(de.port)&&(de.port=Q.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?Ee[4]:void 0)),de.host&&(de.host=_e(K(de.host,Se),Se)),de.scheme===void 0&&de.userinfo===void 0&&de.host===void 0&&de.port===void 0&&!de.path&&de.query===void 0?de.reference="same-document":de.scheme===void 0?de.reference="relative":de.fragment===void 0?de.reference="absolute":de.reference="uri",ne.reference&&ne.reference!=="suffix"&&ne.reference!==de.reference&&(de.error=de.error||"URI is not a "+ne.reference+" reference.");var et=O[(ne.scheme||de.scheme||"").toLowerCase()];if(!ne.unicodeSupport&&(!et||!et.unicodeSupport)){if(de.host&&(ne.domainHost||et&&et.domainHost))try{de.host=I.toASCII(de.host.replace(Se.PCT_ENCODED,X).toLowerCase())}catch(dt){de.error=de.error||"Host's domain name can not be converted to ASCII via punycode: "+dt}ue(de,d)}else ue(de,Se);et&&et.parse&&et.parse(de,ne)}else de.error=de.error||"URI can not be parsed.";return de}function We(Q,ne){var de=ne.iri!==!1?h:d,Se=[];return Q.userinfo!==void 0&&(Se.push(Q.userinfo),Se.push("@")),Q.host!==void 0&&Se.push(_e(K(String(Q.host),de),de).replace(de.IPV6ADDRESS,function(Ee,et,dt){return"["+et+(dt?"%25"+dt:"")+"]"})),(typeof Q.port=="number"||typeof Q.port=="string")&&(Se.push(":"),Se.push(String(Q.port))),Se.length?Se.join(""):void 0}var Ot=/^\.\.?\//,Pe=/^\/\.(\/|$)/,He=/^\/\.\.(\/|$)/,At=/^\/?(?:.|\n)*?(?=\/|$)/;function Ge(Q){for(var ne=[];Q.length;)if(Q.match(Ot))Q=Q.replace(Ot,"");else if(Q.match(Pe))Q=Q.replace(Pe,"/");else if(Q.match(He))Q=Q.replace(He,"/"),ne.pop();else if(Q==="."||Q==="..")Q="";else{var de=Q.match(At);if(de){var Se=de[0];Q=Q.slice(Se.length),ne.push(Se)}else throw new Error("Unexpected dot segment condition")}return ne.join("")}function ze(Q){var ne=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},de=ne.iri?h:d,Se=[],Ee=O[(ne.scheme||Q.scheme||"").toLowerCase()];if(Ee&&Ee.serialize&&Ee.serialize(Q,ne),Q.host&&!de.IPV6ADDRESS.test(Q.host)){if(ne.domainHost||Ee&&Ee.domainHost)try{Q.host=ne.iri?I.toUnicode(Q.host):I.toASCII(Q.host.replace(de.PCT_ENCODED,X).toLowerCase())}catch($t){Q.error=Q.error||"Host's domain name can not be converted to "+(ne.iri?"Unicode":"ASCII")+" via punycode: "+$t}}ue(Q,de),ne.reference!=="suffix"&&Q.scheme&&(Se.push(Q.scheme),Se.push(":"));var et=We(Q,ne);if(et!==void 0&&(ne.reference!=="suffix"&&Se.push("//"),Se.push(et),Q.path&&Q.path.charAt(0)!=="/"&&Se.push("/")),Q.path!==void 0){var dt=Q.path;!ne.absolutePath&&(!Ee||!Ee.absolutePath)&&(dt=Ge(dt)),et===void 0&&(dt=dt.replace(/^\/\//,"/%2F")),Se.push(dt)}return Q.query!==void 0&&(Se.push("?"),Se.push(Q.query)),Q.fragment!==void 0&&(Se.push("#"),Se.push(Q.fragment)),Se.join("")}function it(Q,ne){var de=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},Se=arguments[3],Ee={};return Se||(Q=je(ze(Q,de),de),ne=je(ze(ne,de),de)),de=de||{},!de.tolerant&&ne.scheme?(Ee.scheme=ne.scheme,Ee.userinfo=ne.userinfo,Ee.host=ne.host,Ee.port=ne.port,Ee.path=Ge(ne.path||""),Ee.query=ne.query):(ne.userinfo!==void 0||ne.host!==void 0||ne.port!==void 0?(Ee.userinfo=ne.userinfo,Ee.host=ne.host,Ee.port=ne.port,Ee.path=Ge(ne.path||""),Ee.query=ne.query):(ne.path?(ne.path.charAt(0)==="/"?Ee.path=Ge(ne.path):((Q.userinfo!==void 0||Q.host!==void 0||Q.port!==void 0)&&!Q.path?Ee.path="/"+ne.path:Q.path?Ee.path=Q.path.slice(0,Q.path.lastIndexOf("/")+1)+ne.path:Ee.path=ne.path,Ee.path=Ge(Ee.path)),Ee.query=ne.query):(Ee.path=Q.path,ne.query!==void 0?Ee.query=ne.query:Ee.query=Q.query),Ee.userinfo=Q.userinfo,Ee.host=Q.host,Ee.port=Q.port),Ee.scheme=Q.scheme),Ee.fragment=ne.fragment,Ee}function Ze(Q,ne,de){var Se=u({scheme:"null"},de);return ze(it(je(Q,Se),je(ne,Se),Se,!0),Se)}function he(Q,ne){return typeof Q=="string"?Q=ze(je(Q,ne),ne):a(Q)==="object"&&(Q=je(ze(Q,ne),ne)),Q}function Ie(Q,ne,de){return typeof Q=="string"?Q=ze(je(Q,de),de):a(Q)==="object"&&(Q=ze(Q,de)),typeof ne=="string"?ne=ze(je(ne,de),de):a(ne)==="object"&&(ne=ze(ne,de)),Q===ne}function Be(Q,ne){return Q&&Q.toString().replace(!ne||!ne.iri?d.ESCAPE:h.ESCAPE,J)}function nt(Q,ne){return Q&&Q.toString().replace(!ne||!ne.iri?d.PCT_ENCODED:h.PCT_ENCODED,X)}var W={scheme:"http",domainHost:!0,parse:function(ne,de){return ne.host||(ne.error=ne.error||"HTTP URIs must have a host."),ne},serialize:function(ne,de){var Se=String(ne.scheme).toLowerCase()==="https";return(ne.port===(Se?443:80)||ne.port==="")&&(ne.port=void 0),ne.path||(ne.path="/"),ne}},M={scheme:"https",domainHost:W.domainHost,parse:W.parse,serialize:W.serialize};function L(Q){return typeof Q.secure=="boolean"?Q.secure:String(Q.scheme).toLowerCase()==="wss"}var re={scheme:"ws",domainHost:!0,parse:function(ne,de){var Se=ne;return Se.secure=L(Se),Se.resourceName=(Se.path||"/")+(Se.query?"?"+Se.query:""),Se.path=void 0,Se.query=void 0,Se},serialize:function(ne,de){if((ne.port===(L(ne)?443:80)||ne.port==="")&&(ne.port=void 0),typeof ne.secure=="boolean"&&(ne.scheme=ne.secure?"wss":"ws",ne.secure=void 0),ne.resourceName){var Se=ne.resourceName.split("?"),Ee=m(Se,2),et=Ee[0],dt=Ee[1];ne.path=et&&et!=="/"?et:void 0,ne.query=dt,ne.resourceName=void 0}return ne.fragment=void 0,ne}},me={scheme:"wss",domainHost:re.domainHost,parse:re.parse,serialize:re.serialize},Ce={},Le="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",ft="[0-9A-Fa-f]",Bt=i(i("%[EFef]"+ft+"%"+ft+ft+"%"+ft+ft)+"|"+i("%[89A-Fa-f]"+ft+"%"+ft+ft)+"|"+i("%"+ft+ft)),sn="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",hn="[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",Xt=r(hn,'[\\"\\\\]'),Aa="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",Ai=new RegExp(Le,"g"),Qi=new RegExp(Bt,"g"),Lc=new RegExp(r("[^]",sn,"[\\.]",'[\\"]',Xt),"g"),fi=new RegExp(r("[^]",Le,Aa),"g"),du=fi;function Y(Q){var ne=X(Q);return ne.match(Ai)?ne:Q}var D={scheme:"mailto",parse:function(ne,de){var Se=ne,Ee=Se.to=Se.path?Se.path.split(","):[];if(Se.path=void 0,Se.query){for(var et=!1,dt={},$t=Se.query.split("&"),on=0,_n=$t.length;on<_n;++on){var gt=$t[on].split("=");switch(gt[0]){case"to":for(var pn=gt[1].split(","),Dn=0,vt=pn.length;Dn<vt;++Dn)Ee.push(pn[Dn]);break;case"subject":Se.subject=nt(gt[1],de);break;case"body":Se.body=nt(gt[1],de);break;default:et=!0,dt[nt(gt[0],de)]=nt(gt[1],de);break}}et&&(Se.headers=dt)}Se.query=void 0;for(var ln=0,Gn=Ee.length;ln<Gn;++ln){var An=Ee[ln].split("@");if(An[0]=nt(An[0]),de.unicodeSupport)An[1]=nt(An[1],de).toLowerCase();else try{An[1]=I.toASCII(nt(An[1],de).toLowerCase())}catch(ns){Se.error=Se.error||"Email address's domain name can not be converted to ASCII via punycode: "+ns}Ee[ln]=An.join("@")}return Se},serialize:function(ne,de){var Se=ne,Ee=o(ne.to);if(Ee){for(var et=0,dt=Ee.length;et<dt;++et){var $t=String(Ee[et]),on=$t.lastIndexOf("@"),_n=$t.slice(0,on).replace(Qi,Y).replace(Qi,s).replace(Lc,J),gt=$t.slice(on+1);try{gt=de.iri?I.toUnicode(gt):I.toASCII(nt(gt,de).toLowerCase())}catch(ln){Se.error=Se.error||"Email address's domain name can not be converted to "+(de.iri?"Unicode":"ASCII")+" via punycode: "+ln}Ee[et]=_n+"@"+gt}Se.path=Ee.join(",")}var pn=ne.headers=ne.headers||{};ne.subject&&(pn.subject=ne.subject),ne.body&&(pn.body=ne.body);var Dn=[];for(var vt in pn)pn[vt]!==Ce[vt]&&Dn.push(vt.replace(Qi,Y).replace(Qi,s).replace(fi,J)+"="+pn[vt].replace(Qi,Y).replace(Qi,s).replace(du,J));return Dn.length&&(Se.query=Dn.join("&")),Se}},j=/^([^\:]+)\:(.*)/,ie={scheme:"urn",parse:function(ne,de){var Se=ne.path&&ne.path.match(j),Ee=ne;if(Se){var et=de.scheme||Ee.scheme||"urn",dt=Se[1].toLowerCase(),$t=Se[2],on=et+":"+(de.nid||dt),_n=O[on];Ee.nid=dt,Ee.nss=$t,Ee.path=void 0,_n&&(Ee=_n.parse(Ee,de))}else Ee.error=Ee.error||"URN can not be parsed.";return Ee},serialize:function(ne,de){var Se=de.scheme||ne.scheme||"urn",Ee=ne.nid,et=Se+":"+(de.nid||Ee),dt=O[et];dt&&(ne=dt.serialize(ne,de));var $t=ne,on=ne.nss;return $t.path=(Ee||de.nid)+":"+on,$t}},ge=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,Oe={scheme:"urn:uuid",parse:function(ne,de){var Se=ne;return Se.uuid=Se.nss,Se.nss=void 0,!de.tolerant&&(!Se.uuid||!Se.uuid.match(ge))&&(Se.error=Se.error||"UUID is not valid."),Se},serialize:function(ne,de){var Se=ne;return Se.nss=(ne.uuid||"").toLowerCase(),Se}};O[W.scheme]=W,O[M.scheme]=M,O[re.scheme]=re,O[me.scheme]=me,O[D.scheme]=D,O[ie.scheme]=ie,O[Oe.scheme]=Oe,t.SCHEMES=O,t.pctEncChar=J,t.pctDecChars=X,t.parse=je,t.removeDotSegments=Ge,t.serialize=ze,t.resolveComponents=it,t.resolve=Ze,t.normalize=he,t.equal=Ie,t.escapeComponent=Be,t.unescapeComponent=nt,Object.defineProperty(t,"__esModule",{value:!0})})}(bp,bp.exports)),bp.exports}var vT,rU;function JI(){return rU||(rU=1,vT=function n(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,i,a;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(i=r;i--!==0;)if(!n(e[i],t[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(a=Object.keys(e),r=a.length,r!==Object.keys(t).length)return!1;for(i=r;i--!==0;)if(!Object.prototype.hasOwnProperty.call(t,a[i]))return!1;for(i=r;i--!==0;){var s=a[i];if(!n(e[s],t[s]))return!1}return!0}return e!==e&&t!==t}),vT}var _T,iU;function Yie(){return iU||(iU=1,_T=function(e){for(var t=0,r=e.length,i=0,a;i<r;)t++,a=e.charCodeAt(i++),a>=55296&&a<=56319&&i<r&&(a=e.charCodeAt(i),(a&64512)==56320&&i++);return t}),_T}var bT,aU;function Bd(){if(aU)return bT;aU=1,bT={copy:n,checkDataType:e,checkDataTypes:t,coerceToTypes:i,toHash:a,getProperty:u,escapeQuotes:c,equal:JI(),ucs2length:Yie(),varOccurences:d,varReplace:h,schemaHasRules:m,schemaHasRulesExcept:g,schemaUnknownRules:_,toQuotedString:w,getPathExpr:S,getPath:E,getData:R,unescapeFragment:N,unescapeJsonPointer:B,escapeFragment:U,escapeJsonPointer:k};function n(H,G){G=G||{};for(var z in H)G[z]=H[z];return G}function e(H,G,z,oe){var te=oe?" !== ":" === ",se=oe?" || ":" && ",ee=oe?"!":"",le=oe?"":"!";switch(H){case"null":return G+te+"null";case"array":return ee+"Array.isArray("+G+")";case"object":return"("+ee+G+se+"typeof "+G+te+'"object"'+se+le+"Array.isArray("+G+"))";case"integer":return"(typeof "+G+te+'"number"'+se+le+"("+G+" % 1)"+se+G+te+G+(z?se+ee+"isFinite("+G+")":"")+")";case"number":return"(typeof "+G+te+'"'+H+'"'+(z?se+ee+"isFinite("+G+")":"")+")";default:return"typeof "+G+te+'"'+H+'"'}}function t(H,G,z){switch(H.length){case 1:return e(H[0],G,z,!0);default:var oe="",te=a(H);te.array&&te.object&&(oe=te.null?"(":"(!"+G+" || ",oe+="typeof "+G+' !== "object")',delete te.null,delete te.array,delete te.object),te.number&&delete te.integer;for(var se in te)oe+=(oe?" && ":"")+e(se,G,z,!0);return oe}}var r=a(["string","number","integer","boolean","null"]);function i(H,G){if(Array.isArray(G)){for(var z=[],oe=0;oe<G.length;oe++){var te=G[oe];(r[te]||H==="array"&&te==="array")&&(z[z.length]=te)}if(z.length)return z}else{if(r[G])return[G];if(H==="array"&&G==="array")return["array"]}}function a(H){for(var G={},z=0;z<H.length;z++)G[H[z]]=!0;return G}var s=/^[a-z$_][a-z$_0-9]*$/i,o=/'|\\/g;function u(H){return typeof H=="number"?"["+H+"]":s.test(H)?"."+H:"['"+c(H)+"']"}function c(H){return H.replace(o,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}function d(H,G){G+="[^0-9]";var z=H.match(new RegExp(G,"g"));return z?z.length:0}function h(H,G,z){return G+="([^0-9])",z=z.replace(/\$/g,"$$$$"),H.replace(new RegExp(G,"g"),z+"$1")}function m(H,G){if(typeof H=="boolean")return!H;for(var z in H)if(G[z])return!0}function g(H,G,z){if(typeof H=="boolean")return!H&&z!="not";for(var oe in H)if(oe!=z&&G[oe])return!0}function _(H,G){if(typeof H!="boolean"){for(var z in H)if(!G[z])return z}}function w(H){return"'"+c(H)+"'"}function S(H,G,z,oe){var te=z?"'/' + "+G+(oe?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):oe?"'[' + "+G+" + ']'":"'[\\'' + "+G+" + '\\']'";return P(H,te)}function E(H,G,z){var oe=w(z?"/"+k(G):u(G));return P(H,oe)}var C=/^\/(?:[^~]|~0|~1)*$/,A=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function R(H,G,z){var oe,te,se,ee;if(H==="")return"rootData";if(H[0]=="/"){if(!C.test(H))throw new Error("Invalid JSON-pointer: "+H);te=H,se="rootData"}else{if(ee=H.match(A),!ee)throw new Error("Invalid JSON-pointer: "+H);if(oe=+ee[1],te=ee[2],te=="#"){if(oe>=G)throw new Error("Cannot access property/index "+oe+" levels up, current level is "+G);return z[G-oe]}if(oe>G)throw new Error("Cannot access data "+oe+" levels up, current level is "+G);if(se="data"+(G-oe||""),!te)return se}for(var le=se,pe=te.split("/"),we=0;we<pe.length;we++){var $=pe[we];$&&(se+=u(B($)),le+=" && "+se)}return le}function P(H,G){return H=='""'?G:(H+" + "+G).replace(/([^\\])' \+ '/g,"$1")}function N(H){return B(decodeURIComponent(H))}function U(H){return encodeURIComponent(k(H))}function k(H){return H.replace(/~/g,"~0").replace(/\//g,"~1")}function B(H){return H.replace(/~1/g,"/").replace(/~0/g,"~")}return bT}var wT,sU;function mq(){if(sU)return wT;sU=1;var n=Bd();wT=e;function e(t){n.copy(t,this)}return wT}var ET={exports:{}},oU;function Zie(){if(oU)return ET.exports;oU=1;var n=ET.exports=function(r,i,a){typeof i=="function"&&(a=i,i={}),a=i.cb||a;var s=typeof a=="function"?a:a.pre||function(){},o=a.post||function(){};e(i,s,o,r,"",r)};n.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0},n.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},n.propsKeywords={definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},n.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function e(r,i,a,s,o,u,c,d,h,m){if(s&&typeof s=="object"&&!Array.isArray(s)){i(s,o,u,c,d,h,m);for(var g in s){var _=s[g];if(Array.isArray(_)){if(g in n.arrayKeywords)for(var w=0;w<_.length;w++)e(r,i,a,_[w],o+"/"+g+"/"+w,u,o,g,s,w)}else if(g in n.propsKeywords){if(_&&typeof _=="object")for(var S in _)e(r,i,a,_[S],o+"/"+g+"/"+t(S),u,o,g,s,S)}else(g in n.keywords||r.allKeys&&!(g in n.skipKeywords))&&e(r,i,a,_,o+"/"+g,u,o,g,s)}a(s,o,u,c,d,h,m)}}function t(r){return r.replace(/~/g,"~0").replace(/\//g,"~1")}return ET.exports}var ST,lU;function YI(){if(lU)return ST;lU=1;var n=Jie(),e=JI(),t=Bd(),r=mq(),i=Zie();ST=a,a.normalizeId=E,a.fullPath=_,a.url=C,a.ids=A,a.inlineRef=h,a.schema=s;function a(R,P,N){var U=this._refs[N];if(typeof U=="string")if(this._refs[U])U=this._refs[U];else return a.call(this,R,P,U);if(U=U||this._schemas[N],U instanceof r)return h(U.schema,this._opts.inlineRefs)?U.schema:U.validate||this._compile(U);var k=s.call(this,P,N),B,H,G;return k&&(B=k.schema,P=k.root,G=k.baseId),B instanceof r?H=B.validate||R.call(this,B.schema,P,void 0,G):B!==void 0&&(H=h(B,this._opts.inlineRefs)?B:R.call(this,B,P,void 0,G)),H}function s(R,P){var N=n.parse(P),U=w(N),k=_(this._getId(R.schema));if(Object.keys(R.schema).length===0||U!==k){var B=E(U),H=this._refs[B];if(typeof H=="string")return o.call(this,R,H,N);if(H instanceof r)H.validate||this._compile(H),R=H;else if(H=this._schemas[B],H instanceof r){if(H.validate||this._compile(H),B==E(P))return{schema:H,root:R,baseId:k};R=H}else return;if(!R.schema)return;k=_(this._getId(R.schema))}return c.call(this,N,k,R.schema,R)}function o(R,P,N){var U=s.call(this,R,P);if(U){var k=U.schema,B=U.baseId;R=U.root;var H=this._getId(k);return H&&(B=C(B,H)),c.call(this,N,B,k,R)}}var u=t.toHash(["properties","patternProperties","enum","dependencies","definitions"]);function c(R,P,N,U){if(R.fragment=R.fragment||"",R.fragment.slice(0,1)=="/"){for(var k=R.fragment.split("/"),B=1;B<k.length;B++){var H=k[B];if(H){if(H=t.unescapeFragment(H),N=N[H],N===void 0)break;var G;if(!u[H]&&(G=this._getId(N),G&&(P=C(P,G)),N.$ref)){var z=C(P,N.$ref),oe=s.call(this,U,z);oe&&(N=oe.schema,U=oe.root,P=oe.baseId)}}}if(N!==void 0&&N!==U.schema)return{schema:N,root:U,baseId:P}}}var d=t.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]);function h(R,P){if(P===!1)return!1;if(P===void 0||P===!0)return m(R);if(P)return g(R)<=P}function m(R){var P;if(Array.isArray(R)){for(var N=0;N<R.length;N++)if(P=R[N],typeof P=="object"&&!m(P))return!1}else for(var U in R)if(U=="$ref"||(P=R[U],typeof P=="object"&&!m(P)))return!1;return!0}function g(R){var P=0,N;if(Array.isArray(R)){for(var U=0;U<R.length;U++)if(N=R[U],typeof N=="object"&&(P+=g(N)),P==1/0)return 1/0}else for(var k in R){if(k=="$ref")return 1/0;if(d[k])P++;else if(N=R[k],typeof N=="object"&&(P+=g(N)+1),P==1/0)return 1/0}return P}function _(R,P){P!==!1&&(R=E(R));var N=n.parse(R);return w(N)}function w(R){return n.serialize(R).split("#")[0]+"#"}var S=/#\/?$/;function E(R){return R?R.replace(S,""):""}function C(R,P){return P=E(P),n.resolve(R,P)}function A(R){var P=E(this._getId(R)),N={"":P},U={"":_(P,!1)},k={},B=this;return i(R,{allKeys:!0},function(H,G,z,oe,te,se,ee){if(G!==""){var le=B._getId(H),pe=N[oe],we=U[oe]+"/"+te;if(ee!==void 0&&(we+="/"+(typeof ee=="number"?ee:t.escapeFragment(ee))),typeof le=="string"){le=pe=E(pe?n.resolve(pe,le):le);var $=B._refs[le];if(typeof $=="string"&&($=B._refs[$]),$&&$.schema){if(!e(H,$.schema))throw new Error('id "'+le+'" resolves to more than one schema')}else if(le!=E(we))if(le[0]=="#"){if(k[le]&&!e(H,k[le]))throw new Error('id "'+le+'" resolves to more than one schema');k[le]=H}else B._refs[le]=we}N[G]=pe,U[G]=we}}),k}return ST}var TT,uU;function ZI(){if(uU)return TT;uU=1;var n=YI();TT={Validation:r(e),MissingRef:r(t)};function e(i){this.message="validation failed",this.errors=i,this.ajv=this.validation=!0}t.message=function(i,a){return"can't resolve reference "+a+" from id "+i};function t(i,a,s){this.message=s||t.message(i,a),this.missingRef=n.url(i,a),this.missingSchema=n.normalizeId(n.fullPath(this.missingRef))}function r(i){return i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i}return TT}var AT,cU;function gq(){return cU||(cU=1,AT=function(n,e){e||(e={}),typeof e=="function"&&(e={cmp:e});var t=typeof e.cycles=="boolean"?e.cycles:!1,r=e.cmp&&function(a){return function(s){return function(o,u){var c={key:o,value:s[o]},d={key:u,value:s[u]};return a(c,d)}}}(e.cmp),i=[];return function a(s){if(s&&s.toJSON&&typeof s.toJSON=="function"&&(s=s.toJSON()),s!==void 0){if(typeof s=="number")return isFinite(s)?""+s:"null";if(typeof s!="object")return JSON.stringify(s);var o,u;if(Array.isArray(s)){for(u="[",o=0;o<s.length;o++)o&&(u+=","),u+=a(s[o])||"null";return u+"]"}if(s===null)return"null";if(i.indexOf(s)!==-1){if(t)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var c=i.push(s)-1,d=Object.keys(s).sort(r&&r(s));for(u="",o=0;o<d.length;o++){var h=d[o],m=a(s[h]);m&&(u&&(u+=","),u+=JSON.stringify(h)+":"+m)}return i.splice(c,1),"{"+u+"}"}}(n)}),AT}var CT,fU;function yq(){return fU||(fU=1,CT=function(e,t,r){var i="",a=e.schema.$async===!0,s=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"),o=e.self._getId(e.schema);if(e.opts.strictKeywords){var u=e.util.schemaUnknownRules(e.schema,e.RULES.keywords);if(u){var c="unknown keyword: "+u;if(e.opts.strictKeywords==="log")e.logger.warn(c);else throw new Error(c)}}if(e.isTop&&(i+=" var validate = ",a&&(e.async=!0,i+="async "),i+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",o&&(e.opts.sourceCode||e.opts.processCode)&&(i+=" "+("/*# sourceURL="+o+" */")+" ")),typeof e.schema=="boolean"||!(s||e.schema.$ref)){var t="false schema",d=e.level,h=e.dataLevel,m=e.schema[t],g=e.schemaPath+e.util.getProperty(t),_=e.errSchemaPath+"/"+t,P=!e.opts.allErrors,k,w="data"+(h||""),R="valid"+d;if(e.schema===!1){e.isTop?P=!0:i+=" var "+R+" = false; ";var S=S||[];S.push(i),i="",e.createErrors!==!1?(i+=" { keyword: '"+(k||"false schema")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: {} ",e.opts.messages!==!1&&(i+=" , message: 'boolean schema is false' "),e.opts.verbose&&(i+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+w+" "),i+=" } "):i+=" {} ";var E=i;i=S.pop(),!e.compositeRule&&P?e.async?i+=" throw new ValidationError(["+E+"]); ":i+=" validate.errors = ["+E+"]; return false; ":i+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else e.isTop?a?i+=" return data; ":i+=" validate.errors = null; return true; ":i+=" var "+R+" = true; ";return e.isTop&&(i+=" }; return validate; "),i}if(e.isTop){var C=e.isTop,d=e.level=0,h=e.dataLevel=0,w="data";if(e.rootId=e.resolve.fullPath(e.self._getId(e.root.schema)),e.baseId=e.baseId||e.rootId,delete e.isTop,e.dataPathArr=[""],e.schema.default!==void 0&&e.opts.useDefaults&&e.opts.strictDefaults){var A="default is ignored in the schema root";if(e.opts.strictDefaults==="log")e.logger.warn(A);else throw new Error(A)}i+=" var vErrors = null; ",i+=" var errors = 0;     ",i+=" if (rootData === undefined) rootData = data; "}else{var d=e.level,h=e.dataLevel,w="data"+(h||"");if(o&&(e.baseId=e.resolve.url(e.baseId,o)),a&&!e.async)throw new Error("async schema in sync schema");i+=" var errs_"+d+" = errors;"}var R="valid"+d,P=!e.opts.allErrors,N="",U="",k,B=e.schema.type,H=Array.isArray(B);if(B&&e.opts.nullable&&e.schema.nullable===!0&&(H?B.indexOf("null")==-1&&(B=B.concat("null")):B!="null"&&(B=[B,"null"],H=!0)),H&&B.length==1&&(B=B[0],H=!1),e.schema.$ref&&s){if(e.opts.extendRefs=="fail")throw new Error('$ref: validation keywords used in schema at path "'+e.errSchemaPath+'" (see option extendRefs)');e.opts.extendRefs!==!0&&(s=!1,e.logger.warn('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"'))}if(e.schema.$comment&&e.opts.$comment&&(i+=" "+e.RULES.all.$comment.code(e,"$comment")),B){if(e.opts.coerceTypes)var G=e.util.coerceToTypes(e.opts.coerceTypes,B);var z=e.RULES.types[B];if(G||H||z===!0||z&&!Pe(z)){var g=e.schemaPath+".type",_=e.errSchemaPath+"/type",g=e.schemaPath+".type",_=e.errSchemaPath+"/type",oe=H?"checkDataTypes":"checkDataType";if(i+=" if ("+e.util[oe](B,w,e.opts.strictNumbers,!0)+") { ",G){var te="dataType"+d,se="coerced"+d;i+=" var "+te+" = typeof "+w+"; var "+se+" = undefined; ",e.opts.coerceTypes=="array"&&(i+=" if ("+te+" == 'object' && Array.isArray("+w+") && "+w+".length == 1) { "+w+" = "+w+"[0]; "+te+" = typeof "+w+"; if ("+e.util.checkDataType(e.schema.type,w,e.opts.strictNumbers)+") "+se+" = "+w+"; } "),i+=" if ("+se+" !== undefined) ; ";var ee=G;if(ee)for(var le,pe=-1,we=ee.length-1;pe<we;)le=ee[pe+=1],le=="string"?i+=" else if ("+te+" == 'number' || "+te+" == 'boolean') "+se+" = '' + "+w+"; else if ("+w+" === null) "+se+" = ''; ":le=="number"||le=="integer"?(i+=" else if ("+te+" == 'boolean' || "+w+" === null || ("+te+" == 'string' && "+w+" && "+w+" == +"+w+" ",le=="integer"&&(i+=" && !("+w+" % 1)"),i+=")) "+se+" = +"+w+"; "):le=="boolean"?i+=" else if ("+w+" === 'false' || "+w+" === 0 || "+w+" === null) "+se+" = false; else if ("+w+" === 'true' || "+w+" === 1) "+se+" = true; ":le=="null"?i+=" else if ("+w+" === '' || "+w+" === 0 || "+w+" === false) "+se+" = null; ":e.opts.coerceTypes=="array"&&le=="array"&&(i+=" else if ("+te+" == 'string' || "+te+" == 'number' || "+te+" == 'boolean' || "+w+" == null) "+se+" = ["+w+"]; ");i+=" else {   ";var S=S||[];S.push(i),i="",e.createErrors!==!1?(i+=" { keyword: '"+(k||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { type: '",H?i+=""+B.join(","):i+=""+B,i+="' } ",e.opts.messages!==!1&&(i+=" , message: 'should be ",H?i+=""+B.join(","):i+=""+B,i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+g+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+w+" "),i+=" } "):i+=" {} ";var E=i;i=S.pop(),!e.compositeRule&&P?e.async?i+=" throw new ValidationError(["+E+"]); ":i+=" validate.errors = ["+E+"]; return false; ":i+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } if ("+se+" !== undefined) {  ";var $=h?"data"+(h-1||""):"parentData",ve=h?e.dataPathArr[h]:"parentDataProperty";i+=" "+w+" = "+se+"; ",h||(i+="if ("+$+" !== undefined)"),i+=" "+$+"["+ve+"] = "+se+"; } "}else{var S=S||[];S.push(i),i="",e.createErrors!==!1?(i+=" { keyword: '"+(k||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { type: '",H?i+=""+B.join(","):i+=""+B,i+="' } ",e.opts.messages!==!1&&(i+=" , message: 'should be ",H?i+=""+B.join(","):i+=""+B,i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+g+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+w+" "),i+=" } "):i+=" {} ";var E=i;i=S.pop(),!e.compositeRule&&P?e.async?i+=" throw new ValidationError(["+E+"]); ":i+=" validate.errors = ["+E+"]; return false; ":i+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}i+=" } "}}if(e.schema.$ref&&!s)i+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",P&&(i+=" } if (errors === ",C?i+="0":i+="errs_"+d,i+=") { ",U+="}");else{var Te=e.RULES;if(Te){for(var z,F=-1,ae=Te.length-1;F<ae;)if(z=Te[F+=1],Pe(z)){if(z.type&&(i+=" if ("+e.util.checkDataType(z.type,w,e.opts.strictNumbers)+") { "),e.opts.useDefaults){if(z.type=="object"&&e.schema.properties){var m=e.schema.properties,fe=Object.keys(m),I=fe;if(I)for(var O,J=-1,X=I.length-1;J<X;){O=I[J+=1];var ue=m[O];if(ue.default!==void 0){var V=w+e.util.getProperty(O);if(e.compositeRule){if(e.opts.strictDefaults){var A="default is ignored for: "+V;if(e.opts.strictDefaults==="log")e.logger.warn(A);else throw new Error(A)}}else i+=" if ("+V+" === undefined ",e.opts.useDefaults=="empty"&&(i+=" || "+V+" === null || "+V+" === '' "),i+=" ) "+V+" = ",e.opts.useDefaults=="shared"?i+=" "+e.useDefault(ue.default)+" ":i+=" "+JSON.stringify(ue.default)+" ",i+="; "}}}else if(z.type=="array"&&Array.isArray(e.schema.items)){var K=e.schema.items;if(K){for(var ue,pe=-1,_e=K.length-1;pe<_e;)if(ue=K[pe+=1],ue.default!==void 0){var V=w+"["+pe+"]";if(e.compositeRule){if(e.opts.strictDefaults){var A="default is ignored for: "+V;if(e.opts.strictDefaults==="log")e.logger.warn(A);else throw new Error(A)}}else i+=" if ("+V+" === undefined ",e.opts.useDefaults=="empty"&&(i+=" || "+V+" === null || "+V+" === '' "),i+=" ) "+V+" = ",e.opts.useDefaults=="shared"?i+=" "+e.useDefault(ue.default)+" ":i+=" "+JSON.stringify(ue.default)+" ",i+="; "}}}}var Me=z.rules;if(Me){for(var tt,je=-1,We=Me.length-1;je<We;)if(tt=Me[je+=1],He(tt)){var Ot=tt.code(e,tt.keyword,z.type);Ot&&(i+=" "+Ot+" ",P&&(N+="}"))}}if(P&&(i+=" "+N+" ",N=""),z.type&&(i+=" } ",B&&B===z.type&&!G)){i+=" else { ";var g=e.schemaPath+".type",_=e.errSchemaPath+"/type",S=S||[];S.push(i),i="",e.createErrors!==!1?(i+=" { keyword: '"+(k||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(_)+" , params: { type: '",H?i+=""+B.join(","):i+=""+B,i+="' } ",e.opts.messages!==!1&&(i+=" , message: 'should be ",H?i+=""+B.join(","):i+=""+B,i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+g+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+w+" "),i+=" } "):i+=" {} ";var E=i;i=S.pop(),!e.compositeRule&&P?e.async?i+=" throw new ValidationError(["+E+"]); ":i+=" validate.errors = ["+E+"]; return false; ":i+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } "}P&&(i+=" if (errors === ",C?i+="0":i+="errs_"+d,i+=") { ",U+="}")}}}P&&(i+=" "+U+" "),C?(a?(i+=" if (errors === 0) return data;           ",i+=" else throw new ValidationError(vErrors); "):(i+=" validate.errors = vErrors; ",i+=" return errors === 0;       "),i+=" }; return validate;"):i+=" var "+R+" = errors === errs_"+d+";";function Pe(Ge){for(var ze=Ge.rules,it=0;it<ze.length;it++)if(He(ze[it]))return!0}function He(Ge){return e.schema[Ge.keyword]!==void 0||Ge.implements&&At(Ge)}function At(Ge){for(var ze=Ge.implements,it=0;it<ze.length;it++)if(e.schema[ze[it]]!==void 0)return!0}return i}),CT}var xT,dU;function Xie(){if(dU)return xT;dU=1;var n=YI(),e=Bd(),t=ZI(),r=gq(),i=yq(),a=e.ucs2length,s=JI(),o=t.Validation;xT=u;function u(E,C,A,R){var P=this,N=this._opts,U=[void 0],k={},B=[],H={},G=[],z={},oe=[];C=C||{schema:E,refVal:U,refs:k};var te=c.call(this,E,C,R),se=this._compilations[te.index];if(te.compiling)return se.callValidate=$;var ee=this._formats,le=this.RULES;try{var pe=ve(E,C,A,R);se.validate=pe;var we=se.callValidate;return we&&(we.schema=pe.schema,we.errors=null,we.refs=pe.refs,we.refVal=pe.refVal,we.root=pe.root,we.$async=pe.$async,N.sourceCode&&(we.source=pe.source)),pe}finally{d.call(this,E,C,R)}function $(){var ue=se.validate,V=ue.apply(this,arguments);return $.errors=ue.errors,V}function ve(ue,V,K,_e){var Me=!V||V&&V.schema==ue;if(V.schema!=C.schema)return u.call(P,ue,V,K,_e);var tt=ue.$async===!0,je=i({isTop:!0,schema:ue,isRoot:Me,baseId:_e,root:V,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:t.MissingRef,RULES:le,validate:i,util:e,resolve:n,resolveRef:Te,usePattern:O,useDefault:J,useCustomRule:X,opts:N,formats:ee,logger:P.logger,self:P});je=S(U,_)+S(B,m)+S(G,g)+S(oe,w)+je,N.processCode&&(je=N.processCode(je,ue));var We;try{var Ot=new Function("self","RULES","formats","root","refVal","defaults","customRules","equal","ucs2length","ValidationError",je);We=Ot(P,le,ee,C,U,G,oe,s,a,o),U[0]=We}catch(Pe){throw P.logger.error("Error compiling schema, function code:",je),Pe}return We.schema=ue,We.errors=null,We.refs=k,We.refVal=U,We.root=Me?We:V,tt&&(We.$async=!0),N.sourceCode===!0&&(We.source={code:je,patterns:B,defaults:G}),We}function Te(ue,V,K){V=n.url(ue,V);var _e=k[V],Me,tt;if(_e!==void 0)return Me=U[_e],tt="refVal["+_e+"]",I(Me,tt);if(!K&&C.refs){var je=C.refs[V];if(je!==void 0)return Me=C.refVal[je],tt=F(V,Me),I(Me,tt)}tt=F(V);var We=n.call(P,ve,C,V);if(We===void 0){var Ot=A&&A[V];Ot&&(We=n.inlineRef(Ot,N.inlineRefs)?Ot:u.call(P,Ot,C,A,ue))}if(We===void 0)ae(V);else return fe(V,We),I(We,tt)}function F(ue,V){var K=U.length;return U[K]=V,k[ue]=K,"refVal"+K}function ae(ue){delete k[ue]}function fe(ue,V){var K=k[ue];U[K]=V}function I(ue,V){return typeof ue=="object"||typeof ue=="boolean"?{code:V,schema:ue,inline:!0}:{code:V,$async:ue&&!!ue.$async}}function O(ue){var V=H[ue];return V===void 0&&(V=H[ue]=B.length,B[V]=ue),"pattern"+V}function J(ue){switch(typeof ue){case"boolean":case"number":return""+ue;case"string":return e.toQuotedString(ue);case"object":if(ue===null)return"null";var V=r(ue),K=z[V];return K===void 0&&(K=z[V]=G.length,G[K]=ue),"default"+K}}function X(ue,V,K,_e){if(P._opts.validateSchema!==!1){var Me=ue.definition.dependencies;if(Me&&!Me.every(function(ze){return Object.prototype.hasOwnProperty.call(K,ze)}))throw new Error("parent schema must have all required keywords: "+Me.join(","));var tt=ue.definition.validateSchema;if(tt){var je=tt(V);if(!je){var We="keyword schema is invalid: "+P.errorsText(tt.errors);if(P._opts.validateSchema=="log")P.logger.error(We);else throw new Error(We)}}}var Ot=ue.definition.compile,Pe=ue.definition.inline,He=ue.definition.macro,At;if(Ot)At=Ot.call(P,V,K,_e);else if(He)At=He.call(P,V,K,_e),N.validateSchema!==!1&&P.validateSchema(At,!0);else if(Pe)At=Pe.call(P,_e,ue.keyword,V,K);else if(At=ue.definition.validate,!At)return;if(At===void 0)throw new Error('custom keyword "'+ue.keyword+'"failed to compile');var Ge=oe.length;return oe[Ge]=At,{code:"customRule"+Ge,validate:At}}}function c(E,C,A){var R=h.call(this,E,C,A);return R>=0?{index:R,compiling:!0}:(R=this._compilations.length,this._compilations[R]={schema:E,root:C,baseId:A},{index:R,compiling:!1})}function d(E,C,A){var R=h.call(this,E,C,A);R>=0&&this._compilations.splice(R,1)}function h(E,C,A){for(var R=0;R<this._compilations.length;R++){var P=this._compilations[R];if(P.schema==E&&P.root==C&&P.baseId==A)return R}return-1}function m(E,C){return"var pattern"+E+" = new RegExp("+e.toQuotedString(C[E])+");"}function g(E){return"var default"+E+" = defaults["+E+"];"}function _(E,C){return C[E]===void 0?"":"var refVal"+E+" = refVal["+E+"];"}function w(E){return"var customRule"+E+" = customRules["+E+"];"}function S(E,C){if(!E.length)return"";for(var A="",R=0;R<E.length;R++)A+=C(R,E);return A}return xT}var RT={exports:{}},hU;function Qie(){if(hU)return RT.exports;hU=1;var n=RT.exports=function(){this._cache={}};return n.prototype.put=function(t,r){this._cache[t]=r},n.prototype.get=function(t){return this._cache[t]},n.prototype.del=function(t){delete this._cache[t]},n.prototype.clear=function(){this._cache={}},RT.exports}var IT,pU;function eae(){if(pU)return IT;pU=1;var n=Bd(),e=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,t=[0,31,28,31,30,31,30,31,31,30,31,30,31],r=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,i=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,a=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,s=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,o=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,u=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,c=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,d=/^(?:\/(?:[^~/]|~0|~1)*)*$/,h=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,m=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/;IT=g;function g(U){return U=U=="full"?"full":"fast",n.copy(g[U])}g.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,"uri-template":o,url:u,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:N,uuid:c,"json-pointer":d,"json-pointer-uri-fragment":h,"relative-json-pointer":m},g.full={date:w,time:S,"date-time":C,uri:R,"uri-reference":s,"uri-template":o,url:u,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:N,uuid:c,"json-pointer":d,"json-pointer-uri-fragment":h,"relative-json-pointer":m};function _(U){return U%4===0&&(U%100!==0||U%400===0)}function w(U){var k=U.match(e);if(!k)return!1;var B=+k[1],H=+k[2],G=+k[3];return H>=1&&H<=12&&G>=1&&G<=(H==2&&_(B)?29:t[H])}function S(U,k){var B=U.match(r);if(!B)return!1;var H=B[1],G=B[2],z=B[3],oe=B[5];return(H<=23&&G<=59&&z<=59||H==23&&G==59&&z==60)&&(!k||oe)}var E=/t|\s/i;function C(U){var k=U.split(E);return k.length==2&&w(k[0])&&S(k[1],!0)}var A=/\/|:/;function R(U){return A.test(U)&&a.test(U)}var P=/[^\\]\\Z/;function N(U){if(P.test(U))return!1;try{return new RegExp(U),!0}catch{return!1}}return IT}var PT,mU;function tae(){return mU||(mU=1,PT=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(s||""),h="valid"+a,m,g;if(o=="#"||o=="#/")e.isRoot?(m=e.async,g="validate"):(m=e.root.schema.$async===!0,g="root.refVal[0]");else{var _=e.resolveRef(e.baseId,o,e.isRoot);if(_===void 0){var w=e.MissingRefError.message(e.baseId,o);if(e.opts.missingRefs=="fail"){e.logger.error(w);var S=S||[];S.push(i),i="",e.createErrors!==!1?(i+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { ref: '"+e.util.escapeQuotes(o)+"' } ",e.opts.messages!==!1&&(i+=" , message: 'can\\'t resolve reference "+e.util.escapeQuotes(o)+"' "),e.opts.verbose&&(i+=" , schema: "+e.util.toQuotedString(o)+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var E=i;i=S.pop(),!e.compositeRule&&c?e.async?i+=" throw new ValidationError(["+E+"]); ":i+=" validate.errors = ["+E+"]; return false; ":i+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c&&(i+=" if (false) { ")}else if(e.opts.missingRefs=="ignore")e.logger.warn(w),c&&(i+=" if (true) { ");else throw new e.MissingRefError(e.baseId,o,w)}else if(_.inline){var C=e.util.copy(e);C.level++;var A="valid"+C.level;C.schema=_.schema,C.schemaPath="",C.errSchemaPath=o;var R=e.validate(C).replace(/validate\.schema/g,_.code);i+=" "+R+" ",c&&(i+=" if ("+A+") { ")}else m=_.$async===!0||e.async&&_.$async!==!1,g=_.code}if(g){var S=S||[];S.push(i),i="",e.opts.passContext?i+=" "+g+".call(this, ":i+=" "+g+"( ",i+=" "+d+", (dataPath || '')",e.errorPath!='""'&&(i+=" + "+e.errorPath);var P=s?"data"+(s-1||""):"parentData",N=s?e.dataPathArr[s]:"parentDataProperty";i+=" , "+P+" , "+N+", rootData)  ";var U=i;if(i=S.pop(),m){if(!e.async)throw new Error("async schema referenced by sync schema");c&&(i+=" var "+h+"; "),i+=" try { await "+U+"; ",c&&(i+=" "+h+" = true; "),i+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ",c&&(i+=" "+h+" = false; "),i+=" } ",c&&(i+=" if ("+h+") { ")}else i+=" if (!"+U+") { if (vErrors === null) vErrors = "+g+".errors; else vErrors = vErrors.concat("+g+".errors); errors = vErrors.length; } ",c&&(i+=" else { ")}return i}),PT}var OT,gU;function nae(){return gU||(gU=1,OT=function(e,t,r){var i=" ",a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),o=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c=e.util.copy(e),d="";c.level++;var h="valid"+c.level,m=c.baseId,g=!0,_=a;if(_)for(var w,S=-1,E=_.length-1;S<E;)w=_[S+=1],(e.opts.strictKeywords?typeof w=="object"&&Object.keys(w).length>0||w===!1:e.util.schemaHasRules(w,e.RULES.all))&&(g=!1,c.schema=w,c.schemaPath=s+"["+S+"]",c.errSchemaPath=o+"/"+S,i+="  "+e.validate(c)+" ",c.baseId=m,u&&(i+=" if ("+h+") { ",d+="}"));return u&&(g?i+=" if (true) { ":i+=" "+d.slice(0,-1)+" "),i}),OT}var kT,yU;function rae(){return yU||(yU=1,kT=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,h="data"+(s||""),m="valid"+a,g="errs__"+a,_=e.util.copy(e),w="";_.level++;var S="valid"+_.level,E=o.every(function(k){return e.opts.strictKeywords?typeof k=="object"&&Object.keys(k).length>0||k===!1:e.util.schemaHasRules(k,e.RULES.all)});if(E){var C=_.baseId;i+=" var "+g+" = errors; var "+m+" = false;  ";var A=e.compositeRule;e.compositeRule=_.compositeRule=!0;var R=o;if(R)for(var P,N=-1,U=R.length-1;N<U;)P=R[N+=1],_.schema=P,_.schemaPath=u+"["+N+"]",_.errSchemaPath=c+"/"+N,i+="  "+e.validate(_)+" ",_.baseId=C,i+=" "+m+" = "+m+" || "+S+"; if (!"+m+") { ",w+="}";e.compositeRule=_.compositeRule=A,i+=" "+w+" if (!"+m+") {   var err =   ",e.createErrors!==!1?(i+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",e.opts.messages!==!1&&(i+=" , message: 'should match some schema in anyOf' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(e.async?i+=" throw new ValidationError(vErrors); ":i+=" validate.errors = vErrors; return false; "),i+=" } else {  errors = "+g+"; if (vErrors !== null) { if ("+g+") vErrors.length = "+g+"; else vErrors = null; } ",e.opts.allErrors&&(i+=" } ")}else d&&(i+=" if (true) { ");return i}),kT}var NT,vU;function iae(){return vU||(vU=1,NT=function(e,t,r){var i=" ",a=e.schema[t],s=e.errSchemaPath+"/"+t;e.opts.allErrors;var o=e.util.toQuotedString(a);return e.opts.$comment===!0?i+=" console.log("+o+");":typeof e.opts.$comment=="function"&&(i+=" self._opts.$comment("+o+", "+e.util.toQuotedString(s)+", validate.root.schema);"),i}),NT}var MT,_U;function aae(){return _U||(_U=1,MT=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,h="data"+(s||""),m="valid"+a,g=e.opts.$data&&o&&o.$data;g&&(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; "),g||(i+=" var schema"+a+" = validate.schema"+u+";"),i+="var "+m+" = equal("+h+", schema"+a+"); if (!"+m+") {   ";var _=_||[];_.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'const' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { allowedValue: schema"+a+" } ",e.opts.messages!==!1&&(i+=" , message: 'should be equal to constant' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var w=i;return i=_.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+w+"]); ":i+=" validate.errors = ["+w+"]; return false; ":i+=" var err = "+w+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" }",d&&(i+=" else { "),i}),MT}var DT,bU;function sae(){return bU||(bU=1,DT=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,h="data"+(s||""),m="valid"+a,g="errs__"+a,_=e.util.copy(e),w="";_.level++;var S="valid"+_.level,E="i"+a,C=_.dataLevel=e.dataLevel+1,A="data"+C,R=e.baseId,P=e.opts.strictKeywords?typeof o=="object"&&Object.keys(o).length>0||o===!1:e.util.schemaHasRules(o,e.RULES.all);if(i+="var "+g+" = errors;var "+m+";",P){var N=e.compositeRule;e.compositeRule=_.compositeRule=!0,_.schema=o,_.schemaPath=u,_.errSchemaPath=c,i+=" var "+S+" = false; for (var "+E+" = 0; "+E+" < "+h+".length; "+E+"++) { ",_.errorPath=e.util.getPathExpr(e.errorPath,E,e.opts.jsonPointers,!0);var U=h+"["+E+"]";_.dataPathArr[C]=E;var k=e.validate(_);_.baseId=R,e.util.varOccurences(k,A)<2?i+=" "+e.util.varReplace(k,A,U)+" ":i+=" var "+A+" = "+U+"; "+k+" ",i+=" if ("+S+") break; }  ",e.compositeRule=_.compositeRule=N,i+=" "+w+" if (!"+S+") {"}else i+=" if ("+h+".length == 0) {";var B=B||[];B.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",e.opts.messages!==!1&&(i+=" , message: 'should contain a valid item' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var H=i;return i=B.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+H+"]); ":i+=" validate.errors = ["+H+"]; return false; ":i+=" var err = "+H+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else { ",P&&(i+="  errors = "+g+"; if (vErrors !== null) { if ("+g+") vErrors.length = "+g+"; else vErrors = null; } "),e.opts.allErrors&&(i+=" } "),i}),DT}var $T,wU;function oae(){return wU||(wU=1,$T=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,h="data"+(s||""),m="errs__"+a,g=e.util.copy(e),_="";g.level++;var w="valid"+g.level,S={},E={},C=e.opts.ownProperties;for(N in o)if(N!="__proto__"){var A=o[N],R=Array.isArray(A)?E:S;R[N]=A}i+="var "+m+" = errors;";var P=e.errorPath;i+="var missing"+a+";";for(var N in E)if(R=E[N],R.length){if(i+=" if ( "+h+e.util.getProperty(N)+" !== undefined ",C&&(i+=" && Object.prototype.hasOwnProperty.call("+h+", '"+e.util.escapeQuotes(N)+"') "),d){i+=" && ( ";var U=R;if(U)for(var k,B=-1,H=U.length-1;B<H;){k=U[B+=1],B&&(i+=" || ");var G=e.util.getProperty(k),z=h+G;i+=" ( ( "+z+" === undefined ",C&&(i+=" || ! Object.prototype.hasOwnProperty.call("+h+", '"+e.util.escapeQuotes(k)+"') "),i+=") && (missing"+a+" = "+e.util.toQuotedString(e.opts.jsonPointers?k:G)+") ) "}i+=")) {  ";var oe="missing"+a,te="' + "+oe+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(P,oe,!0):P+" + "+oe);var se=se||[];se.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { property: '"+e.util.escapeQuotes(N)+"', missingProperty: '"+te+"', depsCount: "+R.length+", deps: '"+e.util.escapeQuotes(R.length==1?R[0]:R.join(", "))+"' } ",e.opts.messages!==!1&&(i+=" , message: 'should have ",R.length==1?i+="property "+e.util.escapeQuotes(R[0]):i+="properties "+e.util.escapeQuotes(R.join(", ")),i+=" when property "+e.util.escapeQuotes(N)+" is present' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var ee=i;i=se.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+ee+"]); ":i+=" validate.errors = ["+ee+"]; return false; ":i+=" var err = "+ee+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{i+=" ) { ";var le=R;if(le)for(var k,pe=-1,we=le.length-1;pe<we;){k=le[pe+=1];var G=e.util.getProperty(k),te=e.util.escapeQuotes(k),z=h+G;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(P,k,e.opts.jsonPointers)),i+=" if ( "+z+" === undefined ",C&&(i+=" || ! Object.prototype.hasOwnProperty.call("+h+", '"+e.util.escapeQuotes(k)+"') "),i+=") {  var err =   ",e.createErrors!==!1?(i+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { property: '"+e.util.escapeQuotes(N)+"', missingProperty: '"+te+"', depsCount: "+R.length+", deps: '"+e.util.escapeQuotes(R.length==1?R[0]:R.join(", "))+"' } ",e.opts.messages!==!1&&(i+=" , message: 'should have ",R.length==1?i+="property "+e.util.escapeQuotes(R[0]):i+="properties "+e.util.escapeQuotes(R.join(", ")),i+=" when property "+e.util.escapeQuotes(N)+" is present' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}i+=" }   ",d&&(_+="}",i+=" else { ")}e.errorPath=P;var $=g.baseId;for(var N in S){var A=S[N];(e.opts.strictKeywords?typeof A=="object"&&Object.keys(A).length>0||A===!1:e.util.schemaHasRules(A,e.RULES.all))&&(i+=" "+w+" = true; if ( "+h+e.util.getProperty(N)+" !== undefined ",C&&(i+=" && Object.prototype.hasOwnProperty.call("+h+", '"+e.util.escapeQuotes(N)+"') "),i+=") { ",g.schema=A,g.schemaPath=u+e.util.getProperty(N),g.errSchemaPath=c+"/"+e.util.escapeFragment(N),i+="  "+e.validate(g)+" ",g.baseId=$,i+=" }  ",d&&(i+=" if ("+w+") { ",_+="}"))}return d&&(i+="   "+_+" if ("+m+" == errors) {"),i}),$T}var LT,EU;function lae(){return EU||(EU=1,LT=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,h="data"+(s||""),m="valid"+a,g=e.opts.$data&&o&&o.$data;g&&(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ");var _="i"+a,w="schema"+a;g||(i+=" var "+w+" = validate.schema"+u+";"),i+="var "+m+";",g&&(i+=" if (schema"+a+" === undefined) "+m+" = true; else if (!Array.isArray(schema"+a+")) "+m+" = false; else {"),i+=""+m+" = false;for (var "+_+"=0; "+_+"<"+w+".length; "+_+"++) if (equal("+h+", "+w+"["+_+"])) { "+m+" = true; break; }",g&&(i+="  }  "),i+=" if (!"+m+") {   ";var S=S||[];S.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { allowedValues: schema"+a+" } ",e.opts.messages!==!1&&(i+=" , message: 'should be equal to one of the allowed values' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var E=i;return i=S.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+E+"]); ":i+=" validate.errors = ["+E+"]; return false; ":i+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" }",d&&(i+=" else { "),i}),LT}var UT,SU;function uae(){return SU||(SU=1,UT=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,h="data"+(s||"");if(e.opts.format===!1)return d&&(i+=" if (true) { "),i;var m=e.opts.$data&&o&&o.$data,g;m?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",g="schema"+a):g=o;var _=e.opts.unknownFormats,w=Array.isArray(_);if(m){var S="format"+a,E="isObject"+a,C="formatType"+a;i+=" var "+S+" = formats["+g+"]; var "+E+" = typeof "+S+" == 'object' && !("+S+" instanceof RegExp) && "+S+".validate; var "+C+" = "+E+" && "+S+".type || 'string'; if ("+E+") { ",e.async&&(i+=" var async"+a+" = "+S+".async; "),i+=" "+S+" = "+S+".validate; } if (  ",m&&(i+=" ("+g+" !== undefined && typeof "+g+" != 'string') || "),i+=" (",_!="ignore"&&(i+=" ("+g+" && !"+S+" ",w&&(i+=" && self._opts.unknownFormats.indexOf("+g+") == -1 "),i+=") || "),i+=" ("+S+" && "+C+" == '"+r+"' && !(typeof "+S+" == 'function' ? ",e.async?i+=" (async"+a+" ? await "+S+"("+h+") : "+S+"("+h+")) ":i+=" "+S+"("+h+") ",i+=" : "+S+".test("+h+"))))) {"}else{var S=e.formats[o];if(!S){if(_=="ignore")return e.logger.warn('unknown format "'+o+'" ignored in schema at path "'+e.errSchemaPath+'"'),d&&(i+=" if (true) { "),i;if(w&&_.indexOf(o)>=0)return d&&(i+=" if (true) { "),i;throw new Error('unknown format "'+o+'" is used in schema at path "'+e.errSchemaPath+'"')}var E=typeof S=="object"&&!(S instanceof RegExp)&&S.validate,C=E&&S.type||"string";if(E){var A=S.async===!0;S=S.validate}if(C!=r)return d&&(i+=" if (true) { "),i;if(A){if(!e.async)throw new Error("async format in sync schema");var R="formats"+e.util.getProperty(o)+".validate";i+=" if (!(await "+R+"("+h+"))) { "}else{i+=" if (! ";var R="formats"+e.util.getProperty(o);E&&(R+=".validate"),typeof S=="function"?i+=" "+R+"("+h+") ":i+=" "+R+".test("+h+") ",i+=") { "}}var P=P||[];P.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'format' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { format:  ",m?i+=""+g:i+=""+e.util.toQuotedString(o),i+="  } ",e.opts.messages!==!1&&(i+=` , message: 'should match format "`,m?i+="' + "+g+" + '":i+=""+e.util.escapeQuotes(o),i+=`"' `),e.opts.verbose&&(i+=" , schema:  ",m?i+="validate.schema"+u:i+=""+e.util.toQuotedString(o),i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var N=i;return i=P.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+N+"]); ":i+=" validate.errors = ["+N+"]; return false; ":i+=" var err = "+N+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",d&&(i+=" else { "),i}),UT}var jT,TU;function cae(){return TU||(TU=1,jT=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,h="data"+(s||""),m="valid"+a,g="errs__"+a,_=e.util.copy(e);_.level++;var w="valid"+_.level,S=e.schema.then,E=e.schema.else,C=S!==void 0&&(e.opts.strictKeywords?typeof S=="object"&&Object.keys(S).length>0||S===!1:e.util.schemaHasRules(S,e.RULES.all)),A=E!==void 0&&(e.opts.strictKeywords?typeof E=="object"&&Object.keys(E).length>0||E===!1:e.util.schemaHasRules(E,e.RULES.all)),R=_.baseId;if(C||A){var P;_.createErrors=!1,_.schema=o,_.schemaPath=u,_.errSchemaPath=c,i+=" var "+g+" = errors; var "+m+" = true;  ";var N=e.compositeRule;e.compositeRule=_.compositeRule=!0,i+="  "+e.validate(_)+" ",_.baseId=R,_.createErrors=!0,i+="  errors = "+g+"; if (vErrors !== null) { if ("+g+") vErrors.length = "+g+"; else vErrors = null; }  ",e.compositeRule=_.compositeRule=N,C?(i+=" if ("+w+") {  ",_.schema=e.schema.then,_.schemaPath=e.schemaPath+".then",_.errSchemaPath=e.errSchemaPath+"/then",i+="  "+e.validate(_)+" ",_.baseId=R,i+=" "+m+" = "+w+"; ",C&&A?(P="ifClause"+a,i+=" var "+P+" = 'then'; "):P="'then'",i+=" } ",A&&(i+=" else { ")):i+=" if (!"+w+") { ",A&&(_.schema=e.schema.else,_.schemaPath=e.schemaPath+".else",_.errSchemaPath=e.errSchemaPath+"/else",i+="  "+e.validate(_)+" ",_.baseId=R,i+=" "+m+" = "+w+"; ",C&&A?(P="ifClause"+a,i+=" var "+P+" = 'else'; "):P="'else'",i+=" } "),i+=" if (!"+m+") {   var err =   ",e.createErrors!==!1?(i+=" { keyword: 'if' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { failingKeyword: "+P+" } ",e.opts.messages!==!1&&(i+=` , message: 'should match "' + `+P+` + '" schema' `),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(e.async?i+=" throw new ValidationError(vErrors); ":i+=" validate.errors = vErrors; return false; "),i+=" }   ",d&&(i+=" else { ")}else d&&(i+=" if (true) { ");return i}),jT}var FT,AU;function fae(){return AU||(AU=1,FT=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,h="data"+(s||""),m="valid"+a,g="errs__"+a,_=e.util.copy(e),w="";_.level++;var S="valid"+_.level,E="i"+a,C=_.dataLevel=e.dataLevel+1,A="data"+C,R=e.baseId;if(i+="var "+g+" = errors;var "+m+";",Array.isArray(o)){var P=e.schema.additionalItems;if(P===!1){i+=" "+m+" = "+h+".length <= "+o.length+"; ";var N=c;c=e.errSchemaPath+"/additionalItems",i+="  if (!"+m+") {   ";var U=U||[];U.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+o.length+" } ",e.opts.messages!==!1&&(i+=" , message: 'should NOT have more than "+o.length+" items' "),e.opts.verbose&&(i+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var k=i;i=U.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+k+"]); ":i+=" validate.errors = ["+k+"]; return false; ":i+=" var err = "+k+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",c=N,d&&(w+="}",i+=" else { ")}var B=o;if(B){for(var H,G=-1,z=B.length-1;G<z;)if(H=B[G+=1],e.opts.strictKeywords?typeof H=="object"&&Object.keys(H).length>0||H===!1:e.util.schemaHasRules(H,e.RULES.all)){i+=" "+S+" = true; if ("+h+".length > "+G+") { ";var oe=h+"["+G+"]";_.schema=H,_.schemaPath=u+"["+G+"]",_.errSchemaPath=c+"/"+G,_.errorPath=e.util.getPathExpr(e.errorPath,G,e.opts.jsonPointers,!0),_.dataPathArr[C]=G;var te=e.validate(_);_.baseId=R,e.util.varOccurences(te,A)<2?i+=" "+e.util.varReplace(te,A,oe)+" ":i+=" var "+A+" = "+oe+"; "+te+" ",i+=" }  ",d&&(i+=" if ("+S+") { ",w+="}")}}if(typeof P=="object"&&(e.opts.strictKeywords?typeof P=="object"&&Object.keys(P).length>0||P===!1:e.util.schemaHasRules(P,e.RULES.all))){_.schema=P,_.schemaPath=e.schemaPath+".additionalItems",_.errSchemaPath=e.errSchemaPath+"/additionalItems",i+=" "+S+" = true; if ("+h+".length > "+o.length+") {  for (var "+E+" = "+o.length+"; "+E+" < "+h+".length; "+E+"++) { ",_.errorPath=e.util.getPathExpr(e.errorPath,E,e.opts.jsonPointers,!0);var oe=h+"["+E+"]";_.dataPathArr[C]=E;var te=e.validate(_);_.baseId=R,e.util.varOccurences(te,A)<2?i+=" "+e.util.varReplace(te,A,oe)+" ":i+=" var "+A+" = "+oe+"; "+te+" ",d&&(i+=" if (!"+S+") break; "),i+=" } }  ",d&&(i+=" if ("+S+") { ",w+="}")}}else if(e.opts.strictKeywords?typeof o=="object"&&Object.keys(o).length>0||o===!1:e.util.schemaHasRules(o,e.RULES.all)){_.schema=o,_.schemaPath=u,_.errSchemaPath=c,i+="  for (var "+E+" = 0; "+E+" < "+h+".length; "+E+"++) { ",_.errorPath=e.util.getPathExpr(e.errorPath,E,e.opts.jsonPointers,!0);var oe=h+"["+E+"]";_.dataPathArr[C]=E;var te=e.validate(_);_.baseId=R,e.util.varOccurences(te,A)<2?i+=" "+e.util.varReplace(te,A,oe)+" ":i+=" var "+A+" = "+oe+"; "+te+" ",d&&(i+=" if (!"+S+") break; "),i+=" }"}return d&&(i+=" "+w+" if ("+g+" == errors) {"),i}),FT}var BT,CU;function xU(){return CU||(CU=1,BT=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,R,h="data"+(s||""),m=e.opts.$data&&o&&o.$data,g;m?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",g="schema"+a):g=o;var _=t=="maximum",w=_?"exclusiveMaximum":"exclusiveMinimum",S=e.schema[w],E=e.opts.$data&&S&&S.$data,C=_?"<":">",A=_?">":"<",R=void 0;if(!(m||typeof o=="number"||o===void 0))throw new Error(t+" must be number");if(!(E||S===void 0||typeof S=="number"||typeof S=="boolean"))throw new Error(w+" must be number or boolean");if(E){var P=e.util.getData(S.$data,s,e.dataPathArr),N="exclusive"+a,U="exclType"+a,k="exclIsNumber"+a,B="op"+a,H="' + "+B+" + '";i+=" var schemaExcl"+a+" = "+P+"; ",P="schemaExcl"+a,i+=" var "+N+"; var "+U+" = typeof "+P+"; if ("+U+" != 'boolean' && "+U+" != 'undefined' && "+U+" != 'number') { ";var R=w,G=G||[];G.push(i),i="",e.createErrors!==!1?(i+=" { keyword: '"+(R||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",e.opts.messages!==!1&&(i+=" , message: '"+w+" should be boolean' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var z=i;i=G.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+z+"]); ":i+=" validate.errors = ["+z+"]; return false; ":i+=" var err = "+z+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else if ( ",m&&(i+=" ("+g+" !== undefined && typeof "+g+" != 'number') || "),i+=" "+U+" == 'number' ? ( ("+N+" = "+g+" === undefined || "+P+" "+C+"= "+g+") ? "+h+" "+A+"= "+P+" : "+h+" "+A+" "+g+" ) : ( ("+N+" = "+P+" === true) ? "+h+" "+A+"= "+g+" : "+h+" "+A+" "+g+" ) || "+h+" !== "+h+") { var op"+a+" = "+N+" ? '"+C+"' : '"+C+"='; ",o===void 0&&(R=w,c=e.errSchemaPath+"/"+w,g=P,m=E)}else{var k=typeof S=="number",H=C;if(k&&m){var B="'"+H+"'";i+=" if ( ",m&&(i+=" ("+g+" !== undefined && typeof "+g+" != 'number') || "),i+=" ( "+g+" === undefined || "+S+" "+C+"= "+g+" ? "+h+" "+A+"= "+S+" : "+h+" "+A+" "+g+" ) || "+h+" !== "+h+") { "}else{k&&o===void 0?(N=!0,R=w,c=e.errSchemaPath+"/"+w,g=S,A+="="):(k&&(g=Math[_?"min":"max"](S,o)),S===(k?g:!0)?(N=!0,R=w,c=e.errSchemaPath+"/"+w,A+="="):(N=!1,H+="="));var B="'"+H+"'";i+=" if ( ",m&&(i+=" ("+g+" !== undefined && typeof "+g+" != 'number') || "),i+=" "+h+" "+A+" "+g+" || "+h+" !== "+h+") { "}}R=R||t;var G=G||[];G.push(i),i="",e.createErrors!==!1?(i+=" { keyword: '"+(R||"_limit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { comparison: "+B+", limit: "+g+", exclusive: "+N+" } ",e.opts.messages!==!1&&(i+=" , message: 'should be "+H+" ",m?i+="' + "+g:i+=""+g+"'"),e.opts.verbose&&(i+=" , schema:  ",m?i+="validate.schema"+u:i+=""+o,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var z=i;return i=G.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+z+"]); ":i+=" validate.errors = ["+z+"]; return false; ":i+=" var err = "+z+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",d&&(i+=" else { "),i}),BT}var qT,RU;function IU(){return RU||(RU=1,qT=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,w,h="data"+(s||""),m=e.opts.$data&&o&&o.$data,g;if(m?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",g="schema"+a):g=o,!(m||typeof o=="number"))throw new Error(t+" must be number");var _=t=="maxItems"?">":"<";i+="if ( ",m&&(i+=" ("+g+" !== undefined && typeof "+g+" != 'number') || "),i+=" "+h+".length "+_+" "+g+") { ";var w=t,S=S||[];S.push(i),i="",e.createErrors!==!1?(i+=" { keyword: '"+(w||"_limitItems")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+g+" } ",e.opts.messages!==!1&&(i+=" , message: 'should NOT have ",t=="maxItems"?i+="more":i+="fewer",i+=" than ",m?i+="' + "+g+" + '":i+=""+o,i+=" items' "),e.opts.verbose&&(i+=" , schema:  ",m?i+="validate.schema"+u:i+=""+o,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var E=i;return i=S.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+E+"]); ":i+=" validate.errors = ["+E+"]; return false; ":i+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",d&&(i+=" else { "),i}),qT}var VT,PU;function OU(){return PU||(PU=1,VT=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,w,h="data"+(s||""),m=e.opts.$data&&o&&o.$data,g;if(m?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",g="schema"+a):g=o,!(m||typeof o=="number"))throw new Error(t+" must be number");var _=t=="maxLength"?">":"<";i+="if ( ",m&&(i+=" ("+g+" !== undefined && typeof "+g+" != 'number') || "),e.opts.unicode===!1?i+=" "+h+".length ":i+=" ucs2length("+h+") ",i+=" "+_+" "+g+") { ";var w=t,S=S||[];S.push(i),i="",e.createErrors!==!1?(i+=" { keyword: '"+(w||"_limitLength")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+g+" } ",e.opts.messages!==!1&&(i+=" , message: 'should NOT be ",t=="maxLength"?i+="longer":i+="shorter",i+=" than ",m?i+="' + "+g+" + '":i+=""+o,i+=" characters' "),e.opts.verbose&&(i+=" , schema:  ",m?i+="validate.schema"+u:i+=""+o,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var E=i;return i=S.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+E+"]); ":i+=" validate.errors = ["+E+"]; return false; ":i+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",d&&(i+=" else { "),i}),VT}var zT,kU;function NU(){return kU||(kU=1,zT=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,w,h="data"+(s||""),m=e.opts.$data&&o&&o.$data,g;if(m?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",g="schema"+a):g=o,!(m||typeof o=="number"))throw new Error(t+" must be number");var _=t=="maxProperties"?">":"<";i+="if ( ",m&&(i+=" ("+g+" !== undefined && typeof "+g+" != 'number') || "),i+=" Object.keys("+h+").length "+_+" "+g+") { ";var w=t,S=S||[];S.push(i),i="",e.createErrors!==!1?(i+=" { keyword: '"+(w||"_limitProperties")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+g+" } ",e.opts.messages!==!1&&(i+=" , message: 'should NOT have ",t=="maxProperties"?i+="more":i+="fewer",i+=" than ",m?i+="' + "+g+" + '":i+=""+o,i+=" properties' "),e.opts.verbose&&(i+=" , schema:  ",m?i+="validate.schema"+u:i+=""+o,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var E=i;return i=S.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+E+"]); ":i+=" validate.errors = ["+E+"]; return false; ":i+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",d&&(i+=" else { "),i}),zT}var HT,MU;function dae(){return MU||(MU=1,HT=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,h="data"+(s||""),m=e.opts.$data&&o&&o.$data,g;if(m?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",g="schema"+a):g=o,!(m||typeof o=="number"))throw new Error(t+" must be number");i+="var division"+a+";if (",m&&(i+=" "+g+" !== undefined && ( typeof "+g+" != 'number' || "),i+=" (division"+a+" = "+h+" / "+g+", ",e.opts.multipleOfPrecision?i+=" Math.abs(Math.round(division"+a+") - division"+a+") > 1e-"+e.opts.multipleOfPrecision+" ":i+=" division"+a+" !== parseInt(division"+a+") ",i+=" ) ",m&&(i+="  )  "),i+=" ) {   ";var _=_||[];_.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { multipleOf: "+g+" } ",e.opts.messages!==!1&&(i+=" , message: 'should be multiple of ",m?i+="' + "+g:i+=""+g+"'"),e.opts.verbose&&(i+=" , schema:  ",m?i+="validate.schema"+u:i+=""+o,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var w=i;return i=_.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+w+"]); ":i+=" validate.errors = ["+w+"]; return false; ":i+=" var err = "+w+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",d&&(i+=" else { "),i}),HT}var GT,DU;function hae(){return DU||(DU=1,GT=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,h="data"+(s||""),m="errs__"+a,g=e.util.copy(e);g.level++;var _="valid"+g.level;if(e.opts.strictKeywords?typeof o=="object"&&Object.keys(o).length>0||o===!1:e.util.schemaHasRules(o,e.RULES.all)){g.schema=o,g.schemaPath=u,g.errSchemaPath=c,i+=" var "+m+" = errors;  ";var w=e.compositeRule;e.compositeRule=g.compositeRule=!0,g.createErrors=!1;var S;g.opts.allErrors&&(S=g.opts.allErrors,g.opts.allErrors=!1),i+=" "+e.validate(g)+" ",g.createErrors=!0,S&&(g.opts.allErrors=S),e.compositeRule=g.compositeRule=w,i+=" if ("+_+") {   ";var E=E||[];E.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",e.opts.messages!==!1&&(i+=" , message: 'should NOT be valid' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var C=i;i=E.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+C+"]); ":i+=" validate.errors = ["+C+"]; return false; ":i+=" var err = "+C+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else {  errors = "+m+"; if (vErrors !== null) { if ("+m+") vErrors.length = "+m+"; else vErrors = null; } ",e.opts.allErrors&&(i+=" } ")}else i+="  var err =   ",e.createErrors!==!1?(i+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",e.opts.messages!==!1&&(i+=" , message: 'should NOT be valid' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",d&&(i+=" if (false) { ");return i}),GT}var WT,$U;function pae(){return $U||($U=1,WT=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,h="data"+(s||""),m="valid"+a,g="errs__"+a,_=e.util.copy(e),w="";_.level++;var S="valid"+_.level,E=_.baseId,C="prevValid"+a,A="passingSchemas"+a;i+="var "+g+" = errors , "+C+" = false , "+m+" = false , "+A+" = null; ";var R=e.compositeRule;e.compositeRule=_.compositeRule=!0;var P=o;if(P)for(var N,U=-1,k=P.length-1;U<k;)N=P[U+=1],(e.opts.strictKeywords?typeof N=="object"&&Object.keys(N).length>0||N===!1:e.util.schemaHasRules(N,e.RULES.all))?(_.schema=N,_.schemaPath=u+"["+U+"]",_.errSchemaPath=c+"/"+U,i+="  "+e.validate(_)+" ",_.baseId=E):i+=" var "+S+" = true; ",U&&(i+=" if ("+S+" && "+C+") { "+m+" = false; "+A+" = ["+A+", "+U+"]; } else { ",w+="}"),i+=" if ("+S+") { "+m+" = "+C+" = true; "+A+" = "+U+"; }";return e.compositeRule=_.compositeRule=R,i+=""+w+"if (!"+m+") {   var err =   ",e.createErrors!==!1?(i+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { passingSchemas: "+A+" } ",e.opts.messages!==!1&&(i+=" , message: 'should match exactly one schema in oneOf' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(e.async?i+=" throw new ValidationError(vErrors); ":i+=" validate.errors = vErrors; return false; "),i+="} else {  errors = "+g+"; if (vErrors !== null) { if ("+g+") vErrors.length = "+g+"; else vErrors = null; }",e.opts.allErrors&&(i+=" } "),i}),WT}var KT,LU;function mae(){return LU||(LU=1,KT=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,h="data"+(s||""),m=e.opts.$data&&o&&o.$data,g;m?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",g="schema"+a):g=o;var _=m?"(new RegExp("+g+"))":e.usePattern(o);i+="if ( ",m&&(i+=" ("+g+" !== undefined && typeof "+g+" != 'string') || "),i+=" !"+_+".test("+h+") ) {   ";var w=w||[];w.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { pattern:  ",m?i+=""+g:i+=""+e.util.toQuotedString(o),i+="  } ",e.opts.messages!==!1&&(i+=` , message: 'should match pattern "`,m?i+="' + "+g+" + '":i+=""+e.util.escapeQuotes(o),i+=`"' `),e.opts.verbose&&(i+=" , schema:  ",m?i+="validate.schema"+u:i+=""+e.util.toQuotedString(o),i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var S=i;return i=w.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+S+"]); ":i+=" validate.errors = ["+S+"]; return false; ":i+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",d&&(i+=" else { "),i}),KT}var JT,UU;function gae(){return UU||(UU=1,JT=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,h="data"+(s||""),m="errs__"+a,g=e.util.copy(e),_="";g.level++;var w="valid"+g.level,S="key"+a,E="idx"+a,C=g.dataLevel=e.dataLevel+1,A="data"+C,R="dataProperties"+a,P=Object.keys(o||{}).filter(pe),N=e.schema.patternProperties||{},U=Object.keys(N).filter(pe),k=e.schema.additionalProperties,B=P.length||U.length,H=k===!1,G=typeof k=="object"&&Object.keys(k).length,z=e.opts.removeAdditional,oe=H||G||z,te=e.opts.ownProperties,se=e.baseId,ee=e.schema.required;if(ee&&!(e.opts.$data&&ee.$data)&&ee.length<e.opts.loopRequired)var le=e.util.toHash(ee);function pe(Ie){return Ie!=="__proto__"}if(i+="var "+m+" = errors;var "+w+" = true;",te&&(i+=" var "+R+" = undefined;"),oe){if(te?i+=" "+R+" = "+R+" || Object.keys("+h+"); for (var "+E+"=0; "+E+"<"+R+".length; "+E+"++) { var "+S+" = "+R+"["+E+"]; ":i+=" for (var "+S+" in "+h+") { ",B){if(i+=" var isAdditional"+a+" = !(false ",P.length)if(P.length>8)i+=" || validate.schema"+u+".hasOwnProperty("+S+") ";else{var we=P;if(we)for(var $,ve=-1,Te=we.length-1;ve<Te;)$=we[ve+=1],i+=" || "+S+" == "+e.util.toQuotedString($)+" "}if(U.length){var F=U;if(F)for(var ae,fe=-1,I=F.length-1;fe<I;)ae=F[fe+=1],i+=" || "+e.usePattern(ae)+".test("+S+") "}i+=" ); if (isAdditional"+a+") { "}if(z=="all")i+=" delete "+h+"["+S+"]; ";else{var O=e.errorPath,J="' + "+S+" + '";if(e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(e.errorPath,S,e.opts.jsonPointers)),H)if(z)i+=" delete "+h+"["+S+"]; ";else{i+=" "+w+" = false; ";var X=c;c=e.errSchemaPath+"/additionalProperties";var ue=ue||[];ue.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { additionalProperty: '"+J+"' } ",e.opts.messages!==!1&&(i+=" , message: '",e.opts._errorDataPathProperty?i+="is an invalid additional property":i+="should NOT have additional properties",i+="' "),e.opts.verbose&&(i+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var V=i;i=ue.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+V+"]); ":i+=" validate.errors = ["+V+"]; return false; ":i+=" var err = "+V+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c=X,d&&(i+=" break; ")}else if(G)if(z=="failing"){i+=" var "+m+" = errors;  ";var K=e.compositeRule;e.compositeRule=g.compositeRule=!0,g.schema=k,g.schemaPath=e.schemaPath+".additionalProperties",g.errSchemaPath=e.errSchemaPath+"/additionalProperties",g.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,S,e.opts.jsonPointers);var _e=h+"["+S+"]";g.dataPathArr[C]=S;var Me=e.validate(g);g.baseId=se,e.util.varOccurences(Me,A)<2?i+=" "+e.util.varReplace(Me,A,_e)+" ":i+=" var "+A+" = "+_e+"; "+Me+" ",i+=" if (!"+w+") { errors = "+m+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+h+"["+S+"]; }  ",e.compositeRule=g.compositeRule=K}else{g.schema=k,g.schemaPath=e.schemaPath+".additionalProperties",g.errSchemaPath=e.errSchemaPath+"/additionalProperties",g.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,S,e.opts.jsonPointers);var _e=h+"["+S+"]";g.dataPathArr[C]=S;var Me=e.validate(g);g.baseId=se,e.util.varOccurences(Me,A)<2?i+=" "+e.util.varReplace(Me,A,_e)+" ":i+=" var "+A+" = "+_e+"; "+Me+" ",d&&(i+=" if (!"+w+") break; ")}e.errorPath=O}B&&(i+=" } "),i+=" }  ",d&&(i+=" if ("+w+") { ",_+="}")}var tt=e.opts.useDefaults&&!e.compositeRule;if(P.length){var je=P;if(je)for(var $,We=-1,Ot=je.length-1;We<Ot;){$=je[We+=1];var Pe=o[$];if(e.opts.strictKeywords?typeof Pe=="object"&&Object.keys(Pe).length>0||Pe===!1:e.util.schemaHasRules(Pe,e.RULES.all)){var He=e.util.getProperty($),_e=h+He,At=tt&&Pe.default!==void 0;g.schema=Pe,g.schemaPath=u+He,g.errSchemaPath=c+"/"+e.util.escapeFragment($),g.errorPath=e.util.getPath(e.errorPath,$,e.opts.jsonPointers),g.dataPathArr[C]=e.util.toQuotedString($);var Me=e.validate(g);if(g.baseId=se,e.util.varOccurences(Me,A)<2){Me=e.util.varReplace(Me,A,_e);var Ge=_e}else{var Ge=A;i+=" var "+A+" = "+_e+"; "}if(At)i+=" "+Me+" ";else{if(le&&le[$]){i+=" if ( "+Ge+" === undefined ",te&&(i+=" || ! Object.prototype.hasOwnProperty.call("+h+", '"+e.util.escapeQuotes($)+"') "),i+=") { "+w+" = false; ";var O=e.errorPath,X=c,ze=e.util.escapeQuotes($);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(O,$,e.opts.jsonPointers)),c=e.errSchemaPath+"/required";var ue=ue||[];ue.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+ze+"' } ",e.opts.messages!==!1&&(i+=" , message: '",e.opts._errorDataPathProperty?i+="is a required property":i+="should have required property \\'"+ze+"\\'",i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var V=i;i=ue.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+V+"]); ":i+=" validate.errors = ["+V+"]; return false; ":i+=" var err = "+V+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c=X,e.errorPath=O,i+=" } else { "}else d?(i+=" if ( "+Ge+" === undefined ",te&&(i+=" || ! Object.prototype.hasOwnProperty.call("+h+", '"+e.util.escapeQuotes($)+"') "),i+=") { "+w+" = true; } else { "):(i+=" if ("+Ge+" !== undefined ",te&&(i+=" &&   Object.prototype.hasOwnProperty.call("+h+", '"+e.util.escapeQuotes($)+"') "),i+=" ) { ");i+=" "+Me+" } "}}d&&(i+=" if ("+w+") { ",_+="}")}}if(U.length){var it=U;if(it)for(var ae,Ze=-1,he=it.length-1;Ze<he;){ae=it[Ze+=1];var Pe=N[ae];if(e.opts.strictKeywords?typeof Pe=="object"&&Object.keys(Pe).length>0||Pe===!1:e.util.schemaHasRules(Pe,e.RULES.all)){g.schema=Pe,g.schemaPath=e.schemaPath+".patternProperties"+e.util.getProperty(ae),g.errSchemaPath=e.errSchemaPath+"/patternProperties/"+e.util.escapeFragment(ae),te?i+=" "+R+" = "+R+" || Object.keys("+h+"); for (var "+E+"=0; "+E+"<"+R+".length; "+E+"++) { var "+S+" = "+R+"["+E+"]; ":i+=" for (var "+S+" in "+h+") { ",i+=" if ("+e.usePattern(ae)+".test("+S+")) { ",g.errorPath=e.util.getPathExpr(e.errorPath,S,e.opts.jsonPointers);var _e=h+"["+S+"]";g.dataPathArr[C]=S;var Me=e.validate(g);g.baseId=se,e.util.varOccurences(Me,A)<2?i+=" "+e.util.varReplace(Me,A,_e)+" ":i+=" var "+A+" = "+_e+"; "+Me+" ",d&&(i+=" if (!"+w+") break; "),i+=" } ",d&&(i+=" else "+w+" = true; "),i+=" }  ",d&&(i+=" if ("+w+") { ",_+="}")}}}return d&&(i+=" "+_+" if ("+m+" == errors) {"),i}),JT}var YT,jU;function yae(){return jU||(jU=1,YT=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,h="data"+(s||""),m="errs__"+a,g=e.util.copy(e),_="";g.level++;var w="valid"+g.level;if(i+="var "+m+" = errors;",e.opts.strictKeywords?typeof o=="object"&&Object.keys(o).length>0||o===!1:e.util.schemaHasRules(o,e.RULES.all)){g.schema=o,g.schemaPath=u,g.errSchemaPath=c;var S="key"+a,E="idx"+a,C="i"+a,A="' + "+S+" + '",R=g.dataLevel=e.dataLevel+1,P="data"+R,N="dataProperties"+a,U=e.opts.ownProperties,k=e.baseId;U&&(i+=" var "+N+" = undefined; "),U?i+=" "+N+" = "+N+" || Object.keys("+h+"); for (var "+E+"=0; "+E+"<"+N+".length; "+E+"++) { var "+S+" = "+N+"["+E+"]; ":i+=" for (var "+S+" in "+h+") { ",i+=" var startErrs"+a+" = errors; ";var B=S,H=e.compositeRule;e.compositeRule=g.compositeRule=!0;var G=e.validate(g);g.baseId=k,e.util.varOccurences(G,P)<2?i+=" "+e.util.varReplace(G,P,B)+" ":i+=" var "+P+" = "+B+"; "+G+" ",e.compositeRule=g.compositeRule=H,i+=" if (!"+w+") { for (var "+C+"=startErrs"+a+"; "+C+"<errors; "+C+"++) { vErrors["+C+"].propertyName = "+S+"; }   var err =   ",e.createErrors!==!1?(i+=" { keyword: 'propertyNames' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { propertyName: '"+A+"' } ",e.opts.messages!==!1&&(i+=" , message: 'property name \\'"+A+"\\' is invalid' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(e.async?i+=" throw new ValidationError(vErrors); ":i+=" validate.errors = vErrors; return false; "),d&&(i+=" break; "),i+=" } }"}return d&&(i+=" "+_+" if ("+m+" == errors) {"),i}),YT}var ZT,FU;function vae(){return FU||(FU=1,ZT=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,h="data"+(s||""),m="valid"+a,g=e.opts.$data&&o&&o.$data;g&&(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ");var _="schema"+a;if(!g)if(o.length<e.opts.loopRequired&&e.schema.properties&&Object.keys(e.schema.properties).length){var w=[],S=o;if(S)for(var E,C=-1,A=S.length-1;C<A;){E=S[C+=1];var R=e.schema.properties[E];R&&(e.opts.strictKeywords?typeof R=="object"&&Object.keys(R).length>0||R===!1:e.util.schemaHasRules(R,e.RULES.all))||(w[w.length]=E)}}else var w=o;if(g||w.length){var P=e.errorPath,N=g||w.length>=e.opts.loopRequired,U=e.opts.ownProperties;if(d)if(i+=" var missing"+a+"; ",N){g||(i+=" var "+_+" = validate.schema"+u+"; ");var k="i"+a,B="schema"+a+"["+k+"]",H="' + "+B+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(P,B,e.opts.jsonPointers)),i+=" var "+m+" = true; ",g&&(i+=" if (schema"+a+" === undefined) "+m+" = true; else if (!Array.isArray(schema"+a+")) "+m+" = false; else {"),i+=" for (var "+k+" = 0; "+k+" < "+_+".length; "+k+"++) { "+m+" = "+h+"["+_+"["+k+"]] !== undefined ",U&&(i+=" &&   Object.prototype.hasOwnProperty.call("+h+", "+_+"["+k+"]) "),i+="; if (!"+m+") break; } ",g&&(i+="  }  "),i+="  if (!"+m+") {   ";var G=G||[];G.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+H+"' } ",e.opts.messages!==!1&&(i+=" , message: '",e.opts._errorDataPathProperty?i+="is a required property":i+="should have required property \\'"+H+"\\'",i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var z=i;i=G.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+z+"]); ":i+=" validate.errors = ["+z+"]; return false; ":i+=" var err = "+z+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else { "}else{i+=" if ( ";var oe=w;if(oe)for(var te,k=-1,se=oe.length-1;k<se;){te=oe[k+=1],k&&(i+=" || ");var ee=e.util.getProperty(te),le=h+ee;i+=" ( ( "+le+" === undefined ",U&&(i+=" || ! Object.prototype.hasOwnProperty.call("+h+", '"+e.util.escapeQuotes(te)+"') "),i+=") && (missing"+a+" = "+e.util.toQuotedString(e.opts.jsonPointers?te:ee)+") ) "}i+=") {  ";var B="missing"+a,H="' + "+B+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(P,B,!0):P+" + "+B);var G=G||[];G.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+H+"' } ",e.opts.messages!==!1&&(i+=" , message: '",e.opts._errorDataPathProperty?i+="is a required property":i+="should have required property \\'"+H+"\\'",i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var z=i;i=G.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+z+"]); ":i+=" validate.errors = ["+z+"]; return false; ":i+=" var err = "+z+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else { "}else if(N){g||(i+=" var "+_+" = validate.schema"+u+"; ");var k="i"+a,B="schema"+a+"["+k+"]",H="' + "+B+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(P,B,e.opts.jsonPointers)),g&&(i+=" if ("+_+" && !Array.isArray("+_+")) {  var err =   ",e.createErrors!==!1?(i+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+H+"' } ",e.opts.messages!==!1&&(i+=" , message: '",e.opts._errorDataPathProperty?i+="is a required property":i+="should have required property \\'"+H+"\\'",i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+_+" !== undefined) { "),i+=" for (var "+k+" = 0; "+k+" < "+_+".length; "+k+"++) { if ("+h+"["+_+"["+k+"]] === undefined ",U&&(i+=" || ! Object.prototype.hasOwnProperty.call("+h+", "+_+"["+k+"]) "),i+=") {  var err =   ",e.createErrors!==!1?(i+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+H+"' } ",e.opts.messages!==!1&&(i+=" , message: '",e.opts._errorDataPathProperty?i+="is a required property":i+="should have required property \\'"+H+"\\'",i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",g&&(i+="  }  ")}else{var pe=w;if(pe)for(var te,we=-1,$=pe.length-1;we<$;){te=pe[we+=1];var ee=e.util.getProperty(te),H=e.util.escapeQuotes(te),le=h+ee;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(P,te,e.opts.jsonPointers)),i+=" if ( "+le+" === undefined ",U&&(i+=" || ! Object.prototype.hasOwnProperty.call("+h+", '"+e.util.escapeQuotes(te)+"') "),i+=") {  var err =   ",e.createErrors!==!1?(i+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+H+"' } ",e.opts.messages!==!1&&(i+=" , message: '",e.opts._errorDataPathProperty?i+="is a required property":i+="should have required property \\'"+H+"\\'",i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}e.errorPath=P}else d&&(i+=" if (true) {");return i}),ZT}var XT,BU;function _ae(){return BU||(BU=1,XT=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,h="data"+(s||""),m="valid"+a,g=e.opts.$data&&o&&o.$data,_;if(g?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",_="schema"+a):_=o,(o||g)&&e.opts.uniqueItems!==!1){g&&(i+=" var "+m+"; if ("+_+" === false || "+_+" === undefined) "+m+" = true; else if (typeof "+_+" != 'boolean') "+m+" = false; else { "),i+=" var i = "+h+".length , "+m+" = true , j; if (i > 1) { ";var w=e.schema.items&&e.schema.items.type,S=Array.isArray(w);if(!w||w=="object"||w=="array"||S&&(w.indexOf("object")>=0||w.indexOf("array")>=0))i+=" outer: for (;i--;) { for (j = i; j--;) { if (equal("+h+"[i], "+h+"[j])) { "+m+" = false; break outer; } } } ";else{i+=" var itemIndices = {}, item; for (;i--;) { var item = "+h+"[i]; ";var E="checkDataType"+(S?"s":"");i+=" if ("+e.util[E](w,"item",e.opts.strictNumbers,!0)+") continue; ",S&&(i+=` if (typeof item == 'string') item = '"' + item; `),i+=" if (typeof itemIndices[item] == 'number') { "+m+" = false; j = itemIndices[item]; break; } itemIndices[item] = i; } "}i+=" } ",g&&(i+="  }  "),i+=" if (!"+m+") {   ";var C=C||[];C.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { i: i, j: j } ",e.opts.messages!==!1&&(i+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),e.opts.verbose&&(i+=" , schema:  ",g?i+="validate.schema"+u:i+=""+o,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+h+" "),i+=" } "):i+=" {} ";var A=i;i=C.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+A+"]); ":i+=" validate.errors = ["+A+"]; return false; ":i+=" var err = "+A+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",d&&(i+=" else { ")}else d&&(i+=" if (true) { ");return i}),XT}var QT,qU;function bae(){return qU||(qU=1,QT={$ref:tae(),allOf:nae(),anyOf:rae(),$comment:iae(),const:aae(),contains:sae(),dependencies:oae(),enum:lae(),format:uae(),if:cae(),items:fae(),maximum:xU(),minimum:xU(),maxItems:IU(),minItems:IU(),maxLength:OU(),minLength:OU(),maxProperties:NU(),minProperties:NU(),multipleOf:dae(),not:hae(),oneOf:pae(),pattern:mae(),properties:gae(),propertyNames:yae(),required:vae(),uniqueItems:_ae(),validate:yq()}),QT}var e1,VU;function wae(){if(VU)return e1;VU=1;var n=bae(),e=Bd().toHash;return e1=function(){var r=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","items","contains","uniqueItems"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf","if"]}],i=["type","$comment"],a=["$schema","$id","id","$data","$async","title","description","default","definitions","examples","readOnly","writeOnly","contentMediaType","contentEncoding","additionalItems","then","else"],s=["number","integer","string","array","object","boolean","null"];return r.all=e(i),r.types=e(s),r.forEach(function(o){o.rules=o.rules.map(function(u){var c;if(typeof u=="object"){var d=Object.keys(u)[0];c=u[d],u=d,c.forEach(function(m){i.push(m),r.all[m]=!0})}i.push(u);var h=r.all[u]={keyword:u,code:n[u],implements:c};return h}),r.all.$comment={keyword:"$comment",code:n.$comment},o.type&&(r.types[o.type]=o)}),r.keywords=e(i.concat(a)),r.custom={},r},e1}var t1,zU;function Eae(){if(zU)return t1;zU=1;var n=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"];return t1=function(e,t){for(var r=0;r<t.length;r++){e=JSON.parse(JSON.stringify(e));var i=t[r].split("/"),a=e,s;for(s=1;s<i.length;s++)a=a[i[s]];for(s=0;s<n.length;s++){var o=n[s],u=a[o];u&&(a[o]={anyOf:[u,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]})}}return e},t1}var n1,HU;function Sae(){if(HU)return n1;HU=1;var n=ZI().MissingRef;n1=e;function e(t,r,i){var a=this;if(typeof this._opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");typeof r=="function"&&(i=r,r=void 0);var s=o(t).then(function(){var c=a._addSchema(t,void 0,r);return c.validate||u(c)});return i&&s.then(function(c){i(null,c)},i),s;function o(c){var d=c.$schema;return d&&!a.getSchema(d)?e.call(a,{$ref:d},!0):Promise.resolve()}function u(c){try{return a._compile(c)}catch(h){if(h instanceof n)return d(h);throw h}function d(h){var m=h.missingSchema;if(w(m))throw new Error("Schema "+m+" is loaded but "+h.missingRef+" cannot be resolved");var g=a._loadingSchemas[m];return g||(g=a._loadingSchemas[m]=a._opts.loadSchema(m),g.then(_,_)),g.then(function(S){if(!w(m))return o(S).then(function(){w(m)||a.addSchema(S,m,void 0,r)})}).then(function(){return u(c)});function _(){delete a._loadingSchemas[m]}function w(S){return a._refs[S]||a._schemas[S]}}}}return n1}var r1,GU;function Tae(){return GU||(GU=1,r1=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,h,m="data"+(s||""),g="valid"+a,_="errs__"+a,w=e.opts.$data&&o&&o.$data,S;w?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",S="schema"+a):S=o;var E=this,C="definition"+a,A=E.definition,R="",P,N,U,k,B;if(w&&A.$data){B="keywordValidate"+a;var H=A.validateSchema;i+=" var "+C+" = RULES.custom['"+t+"'].definition; var "+B+" = "+C+".validate;"}else{if(k=e.useCustomRule(E,o,e.schema,e),!k)return;S="validate.schema"+u,B=k.code,P=A.compile,N=A.inline,U=A.macro}var G=B+".errors",z="i"+a,oe="ruleErr"+a,te=A.async;if(te&&!e.async)throw new Error("async keyword in sync schema");if(N||U||(i+=""+G+" = null;"),i+="var "+_+" = errors;var "+g+";",w&&A.$data&&(R+="}",i+=" if ("+S+" === undefined) { "+g+" = true; } else { ",H&&(R+="}",i+=" "+g+" = "+C+".validateSchema("+S+"); if ("+g+") { ")),N)A.statements?i+=" "+k.validate+" ":i+=" "+g+" = "+k.validate+"; ";else if(U){var se=e.util.copy(e),R="";se.level++;var ee="valid"+se.level;se.schema=k.validate,se.schemaPath="";var le=e.compositeRule;e.compositeRule=se.compositeRule=!0;var pe=e.validate(se).replace(/validate\.schema/g,B);e.compositeRule=se.compositeRule=le,i+=" "+pe}else{var we=we||[];we.push(i),i="",i+="  "+B+".call( ",e.opts.passContext?i+="this":i+="self",P||A.schema===!1?i+=" , "+m+" ":i+=" , "+S+" , "+m+" , validate.schema"+e.schemaPath+" ",i+=" , (dataPath || '')",e.errorPath!='""'&&(i+=" + "+e.errorPath);var $=s?"data"+(s-1||""):"parentData",ve=s?e.dataPathArr[s]:"parentDataProperty";i+=" , "+$+" , "+ve+" , rootData )  ";var Te=i;i=we.pop(),A.errors===!1?(i+=" "+g+" = ",te&&(i+="await "),i+=""+Te+"; "):te?(G="customErrors"+a,i+=" var "+G+" = null; try { "+g+" = await "+Te+"; } catch (e) { "+g+" = false; if (e instanceof ValidationError) "+G+" = e.errors; else throw e; } "):i+=" "+G+" = null; "+g+" = "+Te+"; "}if(A.modifying&&(i+=" if ("+$+") "+m+" = "+$+"["+ve+"];"),i+=""+R,A.valid)d&&(i+=" if (true) { ");else{i+=" if ( ",A.valid===void 0?(i+=" !",U?i+=""+ee:i+=""+g):i+=" "+!A.valid+" ",i+=") { ",h=E.keyword;var we=we||[];we.push(i),i="";var we=we||[];we.push(i),i="",e.createErrors!==!1?(i+=" { keyword: '"+(h||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { keyword: '"+E.keyword+"' } ",e.opts.messages!==!1&&(i+=` , message: 'should pass "`+E.keyword+`" keyword validation' `),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),i+=" } "):i+=" {} ";var F=i;i=we.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+F+"]); ":i+=" validate.errors = ["+F+"]; return false; ":i+=" var err = "+F+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";var ae=i;i=we.pop(),N?A.errors?A.errors!="full"&&(i+="  for (var "+z+"="+_+"; "+z+"<errors; "+z+"++) { var "+oe+" = vErrors["+z+"]; if ("+oe+".dataPath === undefined) "+oe+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+oe+".schemaPath === undefined) { "+oe+'.schemaPath = "'+c+'"; } ',e.opts.verbose&&(i+=" "+oe+".schema = "+S+"; "+oe+".data = "+m+"; "),i+=" } "):A.errors===!1?i+=" "+ae+" ":(i+=" if ("+_+" == errors) { "+ae+" } else {  for (var "+z+"="+_+"; "+z+"<errors; "+z+"++) { var "+oe+" = vErrors["+z+"]; if ("+oe+".dataPath === undefined) "+oe+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+oe+".schemaPath === undefined) { "+oe+'.schemaPath = "'+c+'"; } ',e.opts.verbose&&(i+=" "+oe+".schema = "+S+"; "+oe+".data = "+m+"; "),i+=" } } "):U?(i+="   var err =   ",e.createErrors!==!1?(i+=" { keyword: '"+(h||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { keyword: '"+E.keyword+"' } ",e.opts.messages!==!1&&(i+=` , message: 'should pass "`+E.keyword+`" keyword validation' `),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(e.async?i+=" throw new ValidationError(vErrors); ":i+=" validate.errors = vErrors; return false; ")):A.errors===!1?i+=" "+ae+" ":(i+=" if (Array.isArray("+G+")) { if (vErrors === null) vErrors = "+G+"; else vErrors = vErrors.concat("+G+"); errors = vErrors.length;  for (var "+z+"="+_+"; "+z+"<errors; "+z+"++) { var "+oe+" = vErrors["+z+"]; if ("+oe+".dataPath === undefined) "+oe+".dataPath = (dataPath || '') + "+e.errorPath+";  "+oe+'.schemaPath = "'+c+'";  ',e.opts.verbose&&(i+=" "+oe+".schema = "+S+"; "+oe+".data = "+m+"; "),i+=" } } else { "+ae+" } "),i+=" } ",d&&(i+=" else { ")}return i}),r1}const Aae="http://json-schema.org/draft-07/schema#",Cae="http://json-schema.org/draft-07/schema#",xae="Core schema meta-schema",Rae={schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},Iae=["object","boolean"],Pae={$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},vq={$schema:Aae,$id:Cae,title:xae,definitions:Rae,type:Iae,properties:Pae,default:!0};var i1,WU;function Oae(){if(WU)return i1;WU=1;var n=vq;return i1={$id:"https://github.com/ajv-validator/ajv/blob/master/lib/definition_schema.js",definitions:{simpleTypes:n.definitions.simpleTypes},type:"object",dependencies:{schema:["validate"],$data:["validate"],statements:["inline"],valid:{not:{required:["macro"]}}},properties:{type:n.properties.type,schema:{type:"boolean"},statements:{type:"boolean"},dependencies:{type:"array",items:{type:"string"}},metaSchema:{type:"object"},modifying:{type:"boolean"},valid:{type:"boolean"},$data:{type:"boolean"},async:{type:"boolean"},errors:{anyOf:[{type:"boolean"},{const:"full"}]}}},i1}var a1,KU;function kae(){if(KU)return a1;KU=1;var n=/^[a-z_$][a-z0-9_$-]*$/i,e=Tae(),t=Oae();a1={add:r,get:i,remove:a,validate:s};function r(o,u){var c=this.RULES;if(c.keywords[o])throw new Error("Keyword "+o+" is already defined");if(!n.test(o))throw new Error("Keyword "+o+" is not a valid identifier");if(u){this.validateKeyword(u,!0);var d=u.type;if(Array.isArray(d))for(var h=0;h<d.length;h++)g(o,d[h],u);else g(o,d,u);var m=u.metaSchema;m&&(u.$data&&this._opts.$data&&(m={anyOf:[m,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]}),u.validateSchema=this.compile(m,!0))}c.keywords[o]=c.all[o]=!0;function g(_,w,S){for(var E,C=0;C<c.length;C++){var A=c[C];if(A.type==w){E=A;break}}E||(E={type:w,rules:[]},c.push(E));var R={keyword:_,definition:S,custom:!0,code:e,implements:S.implements};E.rules.push(R),c.custom[_]=R}return this}function i(o){var u=this.RULES.custom[o];return u?u.definition:this.RULES.keywords[o]||!1}function a(o){var u=this.RULES;delete u.keywords[o],delete u.all[o],delete u.custom[o];for(var c=0;c<u.length;c++)for(var d=u[c].rules,h=0;h<d.length;h++)if(d[h].keyword==o){d.splice(h,1);break}return this}function s(o,u){s.errors=null;var c=this._validateKeyword=this._validateKeyword||this.compile(t,!0);if(c(o))return!0;if(s.errors=c.errors,u)throw new Error("custom keyword definition is invalid: "+this.errorsText(c.errors));return!1}return a1}const Nae="http://json-schema.org/draft-07/schema#",Mae="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",Dae="Meta-schema for $data reference (JSON Schema extension proposal)",$ae="object",Lae=["$data"],Uae={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},jae=!1,Fae={$schema:Nae,$id:Mae,description:Dae,type:$ae,required:Lae,properties:Uae,additionalProperties:jae};var s1,JU;function Bae(){if(JU)return s1;JU=1;var n=Xie(),e=YI(),t=Qie(),r=mq(),i=gq(),a=eae(),s=wae(),o=Eae(),u=Bd();s1=_,_.prototype.validate=w,_.prototype.compile=S,_.prototype.addSchema=E,_.prototype.addMetaSchema=C,_.prototype.validateSchema=A,_.prototype.getSchema=P,_.prototype.removeSchema=k,_.prototype.addFormat=le,_.prototype.errorsText=ee,_.prototype._addSchema=H,_.prototype._compile=G,_.prototype.compileAsync=Sae();var c=kae();_.prototype.addKeyword=c.add,_.prototype.getKeyword=c.get,_.prototype.removeKeyword=c.remove,_.prototype.validateKeyword=c.validate;var d=ZI();_.ValidationError=d.Validation,_.MissingRefError=d.MissingRef,_.$dataMetaSchema=o;var h="http://json-schema.org/draft-07/schema",m=["removeAdditional","useDefaults","coerceTypes","strictDefaults"],g=["/properties"];function _(I){if(!(this instanceof _))return new _(I);I=this._opts=u.copy(I)||{},ae(this),this._schemas={},this._refs={},this._fragments={},this._formats=a(I.format),this._cache=I.cache||new t,this._loadingSchemas={},this._compilations=[],this.RULES=s(),this._getId=z(I),I.loopRequired=I.loopRequired||1/0,I.errorDataPath=="property"&&(I._errorDataPathProperty=!0),I.serialize===void 0&&(I.serialize=i),this._metaOpts=F(this),I.formats&&$(this),I.keywords&&ve(this),pe(this),typeof I.meta=="object"&&this.addMetaSchema(I.meta),I.nullable&&this.addKeyword("nullable",{metaSchema:{type:"boolean"}}),we(this)}function w(I,O){var J;if(typeof I=="string"){if(J=this.getSchema(I),!J)throw new Error('no schema with key or ref "'+I+'"')}else{var X=this._addSchema(I);J=X.validate||this._compile(X)}var ue=J(O);return J.$async!==!0&&(this.errors=J.errors),ue}function S(I,O){var J=this._addSchema(I,void 0,O);return J.validate||this._compile(J)}function E(I,O,J,X){if(Array.isArray(I)){for(var ue=0;ue<I.length;ue++)this.addSchema(I[ue],void 0,J,X);return this}var V=this._getId(I);if(V!==void 0&&typeof V!="string")throw new Error("schema id must be string");return O=e.normalizeId(O||V),Te(this,O),this._schemas[O]=this._addSchema(I,J,X,!0),this}function C(I,O,J){return this.addSchema(I,O,J,!0),this}function A(I,O){var J=I.$schema;if(J!==void 0&&typeof J!="string")throw new Error("$schema must be a string");if(J=J||this._opts.defaultMeta||R(this),!J)return this.logger.warn("meta-schema not available"),this.errors=null,!0;var X=this.validate(J,I);if(!X&&O){var ue="schema is invalid: "+this.errorsText();if(this._opts.validateSchema=="log")this.logger.error(ue);else throw new Error(ue)}return X}function R(I){var O=I._opts.meta;return I._opts.defaultMeta=typeof O=="object"?I._getId(O)||O:I.getSchema(h)?h:void 0,I._opts.defaultMeta}function P(I){var O=U(this,I);switch(typeof O){case"object":return O.validate||this._compile(O);case"string":return this.getSchema(O);case"undefined":return N(this,I)}}function N(I,O){var J=e.schema.call(I,{schema:{}},O);if(J){var X=J.schema,ue=J.root,V=J.baseId,K=n.call(I,X,ue,void 0,V);return I._fragments[O]=new r({ref:O,fragment:!0,schema:X,root:ue,baseId:V,validate:K}),K}}function U(I,O){return O=e.normalizeId(O),I._schemas[O]||I._refs[O]||I._fragments[O]}function k(I){if(I instanceof RegExp)return B(this,this._schemas,I),B(this,this._refs,I),this;switch(typeof I){case"undefined":return B(this,this._schemas),B(this,this._refs),this._cache.clear(),this;case"string":var O=U(this,I);return O&&this._cache.del(O.cacheKey),delete this._schemas[I],delete this._refs[I],this;case"object":var J=this._opts.serialize,X=J?J(I):I;this._cache.del(X);var ue=this._getId(I);ue&&(ue=e.normalizeId(ue),delete this._schemas[ue],delete this._refs[ue])}return this}function B(I,O,J){for(var X in O){var ue=O[X];!ue.meta&&(!J||J.test(X))&&(I._cache.del(ue.cacheKey),delete O[X])}}function H(I,O,J,X){if(typeof I!="object"&&typeof I!="boolean")throw new Error("schema should be object or boolean");var ue=this._opts.serialize,V=ue?ue(I):I,K=this._cache.get(V);if(K)return K;X=X||this._opts.addUsedSchema!==!1;var _e=e.normalizeId(this._getId(I));_e&&X&&Te(this,_e);var Me=this._opts.validateSchema!==!1&&!O,tt;Me&&!(tt=_e&&_e==e.normalizeId(I.$schema))&&this.validateSchema(I,!0);var je=e.ids.call(this,I),We=new r({id:_e,schema:I,localRefs:je,cacheKey:V,meta:J});return _e[0]!="#"&&X&&(this._refs[_e]=We),this._cache.put(V,We),Me&&tt&&this.validateSchema(I,!0),We}function G(I,O){if(I.compiling)return I.validate=ue,ue.schema=I.schema,ue.errors=null,ue.root=O||ue,I.schema.$async===!0&&(ue.$async=!0),ue;I.compiling=!0;var J;I.meta&&(J=this._opts,this._opts=this._metaOpts);var X;try{X=n.call(this,I.schema,O,I.localRefs)}catch(V){throw delete I.validate,V}finally{I.compiling=!1,I.meta&&(this._opts=J)}return I.validate=X,I.refs=X.refs,I.refVal=X.refVal,I.root=X.root,X;function ue(){var V=I.validate,K=V.apply(this,arguments);return ue.errors=V.errors,K}}function z(I){switch(I.schemaId){case"auto":return se;case"id":return oe;default:return te}}function oe(I){return I.$id&&this.logger.warn("schema $id ignored",I.$id),I.id}function te(I){return I.id&&this.logger.warn("schema id ignored",I.id),I.$id}function se(I){if(I.$id&&I.id&&I.$id!=I.id)throw new Error("schema $id is different from id");return I.$id||I.id}function ee(I,O){if(I=I||this.errors,!I)return"No errors";O=O||{};for(var J=O.separator===void 0?", ":O.separator,X=O.dataVar===void 0?"data":O.dataVar,ue="",V=0;V<I.length;V++){var K=I[V];K&&(ue+=X+K.dataPath+" "+K.message+J)}return ue.slice(0,-J.length)}function le(I,O){return typeof O=="string"&&(O=new RegExp(O)),this._formats[I]=O,this}function pe(I){var O;if(I._opts.$data&&(O=Fae,I.addMetaSchema(O,O.$id,!0)),I._opts.meta!==!1){var J=vq;I._opts.$data&&(J=o(J,g)),I.addMetaSchema(J,h,!0),I._refs["http://json-schema.org/schema"]=h}}function we(I){var O=I._opts.schemas;if(O)if(Array.isArray(O))I.addSchema(O);else for(var J in O)I.addSchema(O[J],J)}function $(I){for(var O in I._opts.formats){var J=I._opts.formats[O];I.addFormat(O,J)}}function ve(I){for(var O in I._opts.keywords){var J=I._opts.keywords[O];I.addKeyword(O,J)}}function Te(I,O){if(I._schemas[O]||I._refs[O])throw new Error('schema with key or id "'+O+'" already exists')}function F(I){for(var O=u.copy(I._opts),J=0;J<m.length;J++)delete O[m[J]];return O}function ae(I){var O=I._opts.logger;if(O===!1)I.logger={log:fe,warn:fe,error:fe};else{if(O===void 0&&(O=console),!(typeof O=="object"&&O.log&&O.warn&&O.error))throw new Error("logger must implement log, warn and error methods");I.logger=O}}function fe(){}return s1}var qae=Bae();const Vae=Za(qae);class kx extends Gie{constructor(e,t){var r;super(t),this._clientInfo=e,this._cachedToolOutputValidators=new Map,this._capabilities=(r=t==null?void 0:t.capabilities)!==null&&r!==void 0?r:{},this._ajv=new Vae}registerCapabilities(e){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=Wie(this._capabilities,e)}assertCapability(e,t){var r;if(!(!((r=this._serverCapabilities)===null||r===void 0)&&r[e]))throw new Error(`Server does not support ${e} (required for ${t})`)}async connect(e,t){if(await super.connect(e),e.sessionId===void 0)try{const r=await this.request({method:"initialize",params:{protocolVersion:Vb,capabilities:this._capabilities,clientInfo:this._clientInfo}},tq,t);if(r===void 0)throw new Error(`Server sent invalid initialize result: ${r}`);if(!Kre.includes(r.protocolVersion))throw new Error(`Server's protocol version is not supported: ${r.protocolVersion}`);this._serverCapabilities=r.capabilities,this._serverVersion=r.serverInfo,e.setProtocolVersion&&e.setProtocolVersion(r.protocolVersion),this._instructions=r.instructions,await this.notification({method:"notifications/initialized"})}catch(r){throw this.close(),r}}getServerCapabilities(){return this._serverCapabilities}getServerVersion(){return this._serverVersion}getInstructions(){return this._instructions}assertCapabilityForMethod(e){var t,r,i,a,s;switch(e){case"logging/setLevel":if(!(!((t=this._serverCapabilities)===null||t===void 0)&&t.logging))throw new Error(`Server does not support logging (required for ${e})`);break;case"prompts/get":case"prompts/list":if(!(!((r=this._serverCapabilities)===null||r===void 0)&&r.prompts))throw new Error(`Server does not support prompts (required for ${e})`);break;case"resources/list":case"resources/templates/list":case"resources/read":case"resources/subscribe":case"resources/unsubscribe":if(!(!((i=this._serverCapabilities)===null||i===void 0)&&i.resources))throw new Error(`Server does not support resources (required for ${e})`);if(e==="resources/subscribe"&&!this._serverCapabilities.resources.subscribe)throw new Error(`Server does not support resource subscriptions (required for ${e})`);break;case"tools/call":case"tools/list":if(!(!((a=this._serverCapabilities)===null||a===void 0)&&a.tools))throw new Error(`Server does not support tools (required for ${e})`);break;case"completion/complete":if(!(!((s=this._serverCapabilities)===null||s===void 0)&&s.completions))throw new Error(`Server does not support completions (required for ${e})`);break}}assertNotificationCapability(e){var t;switch(e){case"notifications/roots/list_changed":if(!(!((t=this._capabilities.roots)===null||t===void 0)&&t.listChanged))throw new Error(`Client does not support roots list changed notifications (required for ${e})`);break}}assertRequestHandlerCapability(e){switch(e){case"sampling/createMessage":if(!this._capabilities.sampling)throw new Error(`Client does not support sampling capability (required for ${e})`);break;case"elicitation/create":if(!this._capabilities.elicitation)throw new Error(`Client does not support elicitation capability (required for ${e})`);break;case"roots/list":if(!this._capabilities.roots)throw new Error(`Client does not support roots capability (required for ${e})`);break}}async ping(e){return this.request({method:"ping"},Kf,e)}async complete(e,t){return this.request({method:"completion/complete",params:e},pq,t)}async setLoggingLevel(e,t){return this.request({method:"logging/setLevel",params:{level:e}},Kf,t)}async getPrompt(e,t){return this.request({method:"prompts/get",params:e},dq,t)}async listPrompts(e,t){return this.request({method:"prompts/list",params:e},cq,t)}async listResources(e,t){return this.request({method:"resources/list",params:e},oq,t)}async listResourceTemplates(e,t){return this.request({method:"resources/templates/list",params:e},lq,t)}async readResource(e,t){return this.request({method:"resources/read",params:e},uq,t)}async subscribeResource(e,t){return this.request({method:"resources/subscribe",params:e},Kf,t)}async unsubscribeResource(e,t){return this.request({method:"resources/unsubscribe",params:e},Kf,t)}async callTool(e,t=Kb,r){const i=await this.request({method:"tools/call",params:e},t,r),a=this.getToolOutputValidator(e.name);if(a){if(!i.structuredContent&&!i.isError)throw new Hl(Ws.InvalidRequest,`Tool ${e.name} has an output schema but did not return structured content`);if(i.structuredContent)try{if(!a(i.structuredContent))throw new Hl(Ws.InvalidParams,`Structured content does not match the tool's output schema: ${this._ajv.errorsText(a.errors)}`)}catch(s){throw s instanceof Hl?s:new Hl(Ws.InvalidParams,`Failed to validate structured content: ${s instanceof Error?s.message:String(s)}`)}}return i}cacheToolOutputSchemas(e){this._cachedToolOutputValidators.clear();for(const t of e)if(t.outputSchema)try{const r=this._ajv.compile(t.outputSchema);this._cachedToolOutputValidators.set(t.name,r)}catch{}}getToolOutputValidator(e){return this._cachedToolOutputValidators.get(e)}async listTools(e,t){const r=await this.request({method:"tools/list",params:e},KI,t);return this.cacheToolOutputSchemas(r.tools),r}async sendRootsListChanged(){return this.notification({method:"notifications/roots/list_changed"})}}class YU extends Error{constructor(e,t){super(e),this.name="ParseError",this.type=t.type,this.field=t.field,this.value=t.value,this.line=t.line}}function o1(n){}function _q(n){if(typeof n=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:e=o1,onError:t=o1,onRetry:r=o1,onComment:i}=n;let a="",s=!0,o,u="",c="";function d(w){const S=s?w.replace(/^\xEF\xBB\xBF/,""):w,[E,C]=zae(`${a}${S}`);for(const A of E)h(A);a=C,s=!1}function h(w){if(w===""){g();return}if(w.startsWith(":")){i&&i(w.slice(w.startsWith(": ")?2:1));return}const S=w.indexOf(":");if(S!==-1){const E=w.slice(0,S),C=w[S+1]===" "?2:1,A=w.slice(S+C);m(E,A,w);return}m(w,"",w)}function m(w,S,E){switch(w){case"event":c=S;break;case"data":u=`${u}${S}
`;break;case"id":o=S.includes("\0")?void 0:S;break;case"retry":/^\d+$/.test(S)?r(parseInt(S,10)):t(new YU(`Invalid \`retry\` value: "${S}"`,{type:"invalid-retry",value:S,line:E}));break;default:t(new YU(`Unknown field "${w.length>20?`${w.slice(0,20)}…`:w}"`,{type:"unknown-field",field:w,value:S,line:E}));break}}function g(){u.length>0&&e({id:o,event:c||void 0,data:u.endsWith(`
`)?u.slice(0,-1):u}),o=void 0,u="",c=""}function _(w={}){a&&w.consume&&h(a),s=!0,o=void 0,u="",c="",a=""}return{feed:d,reset:_}}function zae(n){const e=[];let t="",r=0;for(;r<n.length;){const i=n.indexOf("\r",r),a=n.indexOf(`
`,r);let s=-1;if(i!==-1&&a!==-1?s=Math.min(i,a):i!==-1?s=i:a!==-1&&(s=a),s===-1){t=n.slice(r);break}else{const o=n.slice(r,s);e.push(o),r=s+1,n[r-1]==="\r"&&n[r]===`
`&&r++}}return[e,t]}class ZU extends Event{constructor(e,t){var r,i;super(e),this.code=(r=t==null?void 0:t.code)!=null?r:void 0,this.message=(i=t==null?void 0:t.message)!=null?i:void 0}[Symbol.for("nodejs.util.inspect.custom")](e,t,r){return r(XU(this),t)}[Symbol.for("Deno.customInspect")](e,t){return e(XU(this),t)}}function Hae(n){const e=globalThis.DOMException;return typeof e=="function"?new e(n,"SyntaxError"):new SyntaxError(n)}function Nx(n){return n instanceof Error?"errors"in n&&Array.isArray(n.errors)?n.errors.map(Nx).join(", "):"cause"in n&&n.cause instanceof Error?`${n}: ${Nx(n.cause)}`:n.message:`${n}`}function XU(n){return{type:n.type,message:n.message,code:n.code,defaultPrevented:n.defaultPrevented,cancelable:n.cancelable,timeStamp:n.timeStamp}}var bq=n=>{throw TypeError(n)},XI=(n,e,t)=>e.has(n)||bq("Cannot "+t),Jt=(n,e,t)=>(XI(n,e,"read from private field"),t?t.call(n):e.get(n)),yr=(n,e,t)=>e.has(n)?bq("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),Un=(n,e,t,r)=>(XI(n,e,"write to private field"),e.set(n,t),t),Lo=(n,e,t)=>(XI(n,e,"access private method"),t),Di,Uu,Lf,$v,L_,Hp,Jf,Gp,ql,Uf,cd,jf,wp,ps,Mx,Dx,$x,QU,Lx,Ux,Ep,jx,Fx;class Lv extends EventTarget{constructor(e,t){var r,i;super(),yr(this,ps),this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,yr(this,Di),yr(this,Uu),yr(this,Lf),yr(this,$v),yr(this,L_),yr(this,Hp),yr(this,Jf),yr(this,Gp,null),yr(this,ql),yr(this,Uf),yr(this,cd,null),yr(this,jf,null),yr(this,wp,null),yr(this,Dx,async a=>{var s;Jt(this,Uf).reset();const{body:o,redirected:u,status:c,headers:d}=a;if(c===204){Lo(this,ps,Ep).call(this,"Server sent HTTP 204, not reconnecting",204),this.close();return}if(u?Un(this,Lf,new URL(a.url)):Un(this,Lf,void 0),c!==200){Lo(this,ps,Ep).call(this,`Non-200 status code (${c})`,c);return}if(!(d.get("content-type")||"").startsWith("text/event-stream")){Lo(this,ps,Ep).call(this,'Invalid content type, expected "text/event-stream"',c);return}if(Jt(this,Di)===this.CLOSED)return;Un(this,Di,this.OPEN);const h=new Event("open");if((s=Jt(this,wp))==null||s.call(this,h),this.dispatchEvent(h),typeof o!="object"||!o||!("getReader"in o)){Lo(this,ps,Ep).call(this,"Invalid response body, expected a web ReadableStream",c),this.close();return}const m=new TextDecoder,g=o.getReader();let _=!0;do{const{done:w,value:S}=await g.read();S&&Jt(this,Uf).feed(m.decode(S,{stream:!w})),w&&(_=!1,Jt(this,Uf).reset(),Lo(this,ps,jx).call(this))}while(_)}),yr(this,$x,a=>{Un(this,ql,void 0),!(a.name==="AbortError"||a.type==="aborted")&&Lo(this,ps,jx).call(this,Nx(a))}),yr(this,Lx,a=>{typeof a.id=="string"&&Un(this,Gp,a.id);const s=new MessageEvent(a.event||"message",{data:a.data,origin:Jt(this,Lf)?Jt(this,Lf).origin:Jt(this,Uu).origin,lastEventId:a.id||""});Jt(this,jf)&&(!a.event||a.event==="message")&&Jt(this,jf).call(this,s),this.dispatchEvent(s)}),yr(this,Ux,a=>{Un(this,Hp,a)}),yr(this,Fx,()=>{Un(this,Jf,void 0),Jt(this,Di)===this.CONNECTING&&Lo(this,ps,Mx).call(this)});try{if(e instanceof URL)Un(this,Uu,e);else if(typeof e=="string")Un(this,Uu,new URL(e,Gae()));else throw new Error("Invalid URL")}catch{throw Hae("An invalid or illegal string was specified")}Un(this,Uf,_q({onEvent:Jt(this,Lx),onRetry:Jt(this,Ux)})),Un(this,Di,this.CONNECTING),Un(this,Hp,3e3),Un(this,L_,(r=t==null?void 0:t.fetch)!=null?r:globalThis.fetch),Un(this,$v,(i=t==null?void 0:t.withCredentials)!=null?i:!1),Lo(this,ps,Mx).call(this)}get readyState(){return Jt(this,Di)}get url(){return Jt(this,Uu).href}get withCredentials(){return Jt(this,$v)}get onerror(){return Jt(this,cd)}set onerror(e){Un(this,cd,e)}get onmessage(){return Jt(this,jf)}set onmessage(e){Un(this,jf,e)}get onopen(){return Jt(this,wp)}set onopen(e){Un(this,wp,e)}addEventListener(e,t,r){const i=t;super.addEventListener(e,i,r)}removeEventListener(e,t,r){const i=t;super.removeEventListener(e,i,r)}close(){Jt(this,Jf)&&clearTimeout(Jt(this,Jf)),Jt(this,Di)!==this.CLOSED&&(Jt(this,ql)&&Jt(this,ql).abort(),Un(this,Di,this.CLOSED),Un(this,ql,void 0))}}Di=new WeakMap,Uu=new WeakMap,Lf=new WeakMap,$v=new WeakMap,L_=new WeakMap,Hp=new WeakMap,Jf=new WeakMap,Gp=new WeakMap,ql=new WeakMap,Uf=new WeakMap,cd=new WeakMap,jf=new WeakMap,wp=new WeakMap,ps=new WeakSet,Mx=function(){Un(this,Di,this.CONNECTING),Un(this,ql,new AbortController),Jt(this,L_)(Jt(this,Uu),Lo(this,ps,QU).call(this)).then(Jt(this,Dx)).catch(Jt(this,$x))},Dx=new WeakMap,$x=new WeakMap,QU=function(){var n;const e={mode:"cors",redirect:"follow",headers:{Accept:"text/event-stream",...Jt(this,Gp)?{"Last-Event-ID":Jt(this,Gp)}:void 0},cache:"no-store",signal:(n=Jt(this,ql))==null?void 0:n.signal};return"window"in globalThis&&(e.credentials=this.withCredentials?"include":"same-origin"),e},Lx=new WeakMap,Ux=new WeakMap,Ep=function(n,e){var t;Jt(this,Di)!==this.CLOSED&&Un(this,Di,this.CLOSED);const r=new ZU("error",{code:e,message:n});(t=Jt(this,cd))==null||t.call(this,r),this.dispatchEvent(r)},jx=function(n,e){var t;if(Jt(this,Di)===this.CLOSED)return;Un(this,Di,this.CONNECTING);const r=new ZU("error",{code:e,message:n});(t=Jt(this,cd))==null||t.call(this,r),this.dispatchEvent(r),Un(this,Jf,setTimeout(Jt(this,Fx),Jt(this,Hp)))},Fx=new WeakMap,Lv.CONNECTING=0,Lv.OPEN=1,Lv.CLOSED=2;function Gae(){const n="document"in globalThis?globalThis.document:void 0;return n&&typeof n=="object"&&"baseURI"in n&&typeof n.baseURI=="string"?n.baseURI:void 0}let QI;QI=globalThis.crypto;async function Wae(n){return(await QI).getRandomValues(new Uint8Array(n))}async function Kae(n){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~";let t="";const r=await Wae(n);for(let i=0;i<n;i++){const a=r[i]%e.length;t+=e[a]}return t}async function Jae(n){return await Kae(n)}async function Yae(n){const e=await(await QI).subtle.digest("SHA-256",new TextEncoder().encode(n));return btoa(String.fromCharCode(...new Uint8Array(e))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}async function Zae(n){if(n||(n=43),n<43||n>128)throw`Expected a length between 43 and 128. Received ${n}.`;const e=await Jae(n),t=await Yae(e);return{code_verifier:e,code_challenge:t}}const Xae=rt({resource:$e().url(),authorization_servers:kt($e().url()).optional(),jwks_uri:$e().url().optional(),scopes_supported:kt($e()).optional(),bearer_methods_supported:kt($e()).optional(),resource_signing_alg_values_supported:kt($e()).optional(),resource_name:$e().optional(),resource_documentation:$e().optional(),resource_policy_uri:$e().url().optional(),resource_tos_uri:$e().url().optional(),tls_client_certificate_bound_access_tokens:Jr().optional(),authorization_details_types_supported:kt($e()).optional(),dpop_signing_alg_values_supported:kt($e()).optional(),dpop_bound_access_tokens_required:Jr().optional()}).passthrough(),Qae=rt({issuer:$e(),authorization_endpoint:$e(),token_endpoint:$e(),registration_endpoint:$e().optional(),scopes_supported:kt($e()).optional(),response_types_supported:kt($e()),response_modes_supported:kt($e()).optional(),grant_types_supported:kt($e()).optional(),token_endpoint_auth_methods_supported:kt($e()).optional(),token_endpoint_auth_signing_alg_values_supported:kt($e()).optional(),service_documentation:$e().optional(),revocation_endpoint:$e().optional(),revocation_endpoint_auth_methods_supported:kt($e()).optional(),revocation_endpoint_auth_signing_alg_values_supported:kt($e()).optional(),introspection_endpoint:$e().optional(),introspection_endpoint_auth_methods_supported:kt($e()).optional(),introspection_endpoint_auth_signing_alg_values_supported:kt($e()).optional(),code_challenge_methods_supported:kt($e()).optional()}).passthrough(),wq=rt({access_token:$e(),token_type:$e(),expires_in:Yn().optional(),scope:$e().optional(),refresh_token:$e().optional()}).strip();rt({error:$e(),error_description:$e().optional(),error_uri:$e().optional()});const ese=rt({redirect_uris:kt($e()).refine(n=>n.every(e=>URL.canParse(e)),{message:"redirect_uris must contain valid URLs"}),token_endpoint_auth_method:$e().optional(),grant_types:kt($e()).optional(),response_types:kt($e()).optional(),client_name:$e().optional(),client_uri:$e().optional(),logo_uri:$e().optional(),scope:$e().optional(),contacts:kt($e()).optional(),tos_uri:$e().optional(),policy_uri:$e().optional(),jwks_uri:$e().optional(),jwks:Va().optional(),software_id:$e().optional(),software_version:$e().optional(),software_statement:$e().optional()}).strip(),tse=rt({client_id:$e(),client_secret:$e().optional(),client_id_issued_at:Yn().optional(),client_secret_expires_at:Yn().optional()}).strip(),nse=ese.merge(tse);rt({error:$e(),error_description:$e().optional()}).strip();rt({token:$e(),token_type_hint:$e().optional()}).strip();function rse(n){const e=typeof n=="string"?new URL(n):new URL(n.href);return e.hash="",e}function ise({requestedResource:n,configuredResource:e}){const t=typeof n=="string"?new URL(n):new URL(n.href),r=typeof e=="string"?new URL(e):new URL(e.href);if(t.origin!==r.origin||t.pathname.length<r.pathname.length)return!1;const i=t.pathname.endsWith("/")?t.pathname:t.pathname+"/",a=r.pathname.endsWith("/")?r.pathname:r.pathname+"/";return i.startsWith(a)}class Ks extends Error{constructor(e){super(e??"Unauthorized")}}async function fd(n,{serverUrl:e,authorizationCode:t,scope:r,resourceMetadataUrl:i}){let a,s=e;try{a=await sse(e,{resourceMetadataUrl:i}),a.authorization_servers&&a.authorization_servers.length>0&&(s=a.authorization_servers[0])}catch{}const o=await ase(e,n,a),u=await cse(s);let c=await Promise.resolve(n.clientInformation());if(!c){if(t!==void 0)throw new Error("Existing OAuth client information is required when exchanging an authorization code");if(!n.saveClientInformation)throw new Error("OAuth client information must be saveable for dynamic registration");const _=await pse(s,{metadata:u,clientMetadata:n.clientMetadata});await n.saveClientInformation(_),c=_}if(t!==void 0){const _=await n.codeVerifier(),w=await dse(s,{metadata:u,clientInformation:c,authorizationCode:t,codeVerifier:_,redirectUri:n.redirectUrl,resource:o});return await n.saveTokens(w),"AUTHORIZED"}const d=await n.tokens();if(d!=null&&d.refresh_token)try{const _=await hse(s,{metadata:u,clientInformation:c,refreshToken:d.refresh_token,resource:o});return await n.saveTokens(_),"AUTHORIZED"}catch{}const h=n.state?await n.state():void 0,{authorizationUrl:m,codeVerifier:g}=await fse(s,{metadata:u,clientInformation:c,state:h,redirectUrl:n.redirectUrl,scope:r||n.clientMetadata.scope,resource:o});return await n.saveCodeVerifier(g),await n.redirectToAuthorization(m),"REDIRECT"}async function ase(n,e,t){const r=rse(n);if(e.validateResourceURL)return await e.validateResourceURL(r,t==null?void 0:t.resource);if(t){if(!ise({requestedResource:r,configuredResource:t.resource}))throw new Error(`Protected resource ${t.resource} does not match expected ${r} (or origin)`);return new URL(t.resource)}}function Bx(n){const e=n.headers.get("WWW-Authenticate");if(!e)return;const[t,r]=e.split(" ");if(t.toLowerCase()!=="bearer"||!r)return;const a=/resource_metadata="([^"]*)"/.exec(e);if(a)try{return new URL(a[1])}catch{return}}async function sse(n,e){var t;let r;e!=null&&e.resourceMetadataUrl?r=new URL(e==null?void 0:e.resourceMetadataUrl):r=new URL("/.well-known/oauth-protected-resource",n);let i;try{i=await fetch(r,{headers:{"MCP-Protocol-Version":(t=e==null?void 0:e.protocolVersion)!==null&&t!==void 0?t:Vb}})}catch(a){if(a instanceof TypeError)i=await fetch(r);else throw a}if(i.status===404)throw new Error("Resource server does not implement OAuth 2.0 Protected Resource Metadata.");if(!i.ok)throw new Error(`HTTP ${i.status} trying to load well-known OAuth protected resource metadata.`);return Xae.parse(await i.json())}async function ose(n,e){try{return await fetch(n,{headers:e})}catch(t){if(t instanceof TypeError)return await fetch(n);throw t}}function lse(n){let e=`/.well-known/oauth-authorization-server${n}`;return n.endsWith("/")&&(e=e.slice(0,-1)),e}async function e4(n,e){return await ose(n,{"MCP-Protocol-Version":e})}function use(n,e){return n.status===404&&e!=="/"}async function cse(n,e){var t;const r=new URL(n),i=(t=void 0)!==null&&t!==void 0?t:Vb,a=lse(r.pathname),s=new URL(a,r);let o=await e4(s,i);if(use(o,r.pathname))try{const u=new URL("/.well-known/oauth-authorization-server",r);if(o=await e4(u,i),o.status===404)return}catch{return}else if(o.status===404)return;if(!o.ok)throw new Error(`HTTP ${o.status} trying to load well-known OAuth metadata`);return Qae.parse(await o.json())}async function fse(n,{metadata:e,clientInformation:t,redirectUrl:r,scope:i,state:a,resource:s}){const o="code",u="S256";let c;if(e){if(c=new URL(e.authorization_endpoint),!e.response_types_supported.includes(o))throw new Error(`Incompatible auth server: does not support response type ${o}`);if(!e.code_challenge_methods_supported||!e.code_challenge_methods_supported.includes(u))throw new Error(`Incompatible auth server: does not support code challenge method ${u}`)}else c=new URL("/authorize",n);const d=await Zae(),h=d.code_verifier,m=d.code_challenge;return c.searchParams.set("response_type",o),c.searchParams.set("client_id",t.client_id),c.searchParams.set("code_challenge",m),c.searchParams.set("code_challenge_method",u),c.searchParams.set("redirect_uri",String(r)),a&&c.searchParams.set("state",a),i&&c.searchParams.set("scope",i),s&&c.searchParams.set("resource",s.href),{authorizationUrl:c,codeVerifier:h}}async function dse(n,{metadata:e,clientInformation:t,authorizationCode:r,codeVerifier:i,redirectUri:a,resource:s}){const o="authorization_code";let u;if(e){if(u=new URL(e.token_endpoint),e.grant_types_supported&&!e.grant_types_supported.includes(o))throw new Error(`Incompatible auth server: does not support grant type ${o}`)}else u=new URL("/token",n);const c=new URLSearchParams({grant_type:o,client_id:t.client_id,code:r,code_verifier:i,redirect_uri:String(a)});t.client_secret&&c.set("client_secret",t.client_secret),s&&c.set("resource",s.href);const d=await fetch(u,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c});if(!d.ok)throw new Error(`Token exchange failed: HTTP ${d.status}`);return wq.parse(await d.json())}async function hse(n,{metadata:e,clientInformation:t,refreshToken:r,resource:i}){const a="refresh_token";let s;if(e){if(s=new URL(e.token_endpoint),e.grant_types_supported&&!e.grant_types_supported.includes(a))throw new Error(`Incompatible auth server: does not support grant type ${a}`)}else s=new URL("/token",n);const o=new URLSearchParams({grant_type:a,client_id:t.client_id,refresh_token:r});t.client_secret&&o.set("client_secret",t.client_secret),i&&o.set("resource",i.href);const u=await fetch(s,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o});if(!u.ok)throw new Error(`Token refresh failed: HTTP ${u.status}`);return wq.parse({refresh_token:r,...await u.json()})}async function pse(n,{metadata:e,clientMetadata:t}){let r;if(e){if(!e.registration_endpoint)throw new Error("Incompatible auth server: does not support dynamic client registration");r=new URL(e.registration_endpoint)}else r=new URL("/register",n);const i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!i.ok)throw new Error(`Dynamic client registration failed: HTTP ${i.status}`);return nse.parse(await i.json())}class mse extends Error{constructor(e,t,r){super(`SSE error: ${t}`),this.code=e,this.event=r}}class t4{constructor(e,t){this._url=e,this._resourceMetadataUrl=void 0,this._eventSourceInit=t==null?void 0:t.eventSourceInit,this._requestInit=t==null?void 0:t.requestInit,this._authProvider=t==null?void 0:t.authProvider}async _authThenStart(){var e;if(!this._authProvider)throw new Ks("No auth provider");let t;try{t=await fd(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl})}catch(r){throw(e=this.onerror)===null||e===void 0||e.call(this,r),r}if(t!=="AUTHORIZED")throw new Ks;return await this._startOrAuth()}async _commonHeaders(){var e;const t={...(e=this._requestInit)===null||e===void 0?void 0:e.headers};if(this._authProvider){const r=await this._authProvider.tokens();r&&(t.Authorization=`Bearer ${r.access_token}`)}return this._protocolVersion&&(t["mcp-protocol-version"]=this._protocolVersion),t}_startOrAuth(){var e;const t=((e=this===null||this===void 0?void 0:this._eventSourceInit)===null||e===void 0?void 0:e.fetch)||fetch;return new Promise((r,i)=>{this._eventSource=new Lv(this._url.href,{...this._eventSourceInit,fetch:async(a,s)=>{const o=await this._commonHeaders(),u=await t(a,{...s,headers:new Headers({...o,Accept:"text/event-stream"})});return u.status===401&&u.headers.has("www-authenticate")&&(this._resourceMetadataUrl=Bx(u)),u}}),this._abortController=new AbortController,this._eventSource.onerror=a=>{var s;if(a.code===401&&this._authProvider){this._authThenStart().then(r,i);return}const o=new mse(a.code,a.message,a);i(o),(s=this.onerror)===null||s===void 0||s.call(this,o)},this._eventSource.onopen=()=>{},this._eventSource.addEventListener("endpoint",a=>{var s;const o=a;try{if(this._endpoint=new URL(o.data,this._url),this._endpoint.origin!==this._url.origin)throw new Error(`Endpoint origin does not match connection origin: ${this._endpoint.origin}`)}catch(u){i(u),(s=this.onerror)===null||s===void 0||s.call(this,u),this.close();return}r()}),this._eventSource.onmessage=a=>{var s,o;const u=a;let c;try{c=ud.parse(JSON.parse(u.data))}catch(d){(s=this.onerror)===null||s===void 0||s.call(this,d);return}(o=this.onmessage)===null||o===void 0||o.call(this,c)}})}async start(){if(this._eventSource)throw new Error("SSEClientTransport already started! If using Client class, note that connect() calls start() automatically.");return await this._startOrAuth()}async finishAuth(e){if(!this._authProvider)throw new Ks("No auth provider");if(await fd(this._authProvider,{serverUrl:this._url,authorizationCode:e,resourceMetadataUrl:this._resourceMetadataUrl})!=="AUTHORIZED")throw new Ks("Failed to authorize")}async close(){var e,t,r;(e=this._abortController)===null||e===void 0||e.abort(),(t=this._eventSource)===null||t===void 0||t.close(),(r=this.onclose)===null||r===void 0||r.call(this)}async send(e){var t,r;if(!this._endpoint)throw new Error("Not connected");try{const i=await this._commonHeaders(),a=new Headers(i);a.set("content-type","application/json");const s={...this._requestInit,method:"POST",headers:a,body:JSON.stringify(e),signal:(t=this._abortController)===null||t===void 0?void 0:t.signal},o=await fetch(this._endpoint,s);if(!o.ok){if(o.status===401&&this._authProvider){if(this._resourceMetadataUrl=Bx(o),await fd(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl})!=="AUTHORIZED")throw new Ks;return this.send(e)}const u=await o.text().catch(()=>null);throw new Error(`Error POSTing to endpoint (HTTP ${o.status}): ${u}`)}}catch(i){throw(r=this.onerror)===null||r===void 0||r.call(this,i),i}}setProtocolVersion(e){this._protocolVersion=e}}class gse extends TransformStream{constructor({onError:e,onRetry:t,onComment:r}={}){let i;super({start(a){i=_q({onEvent:s=>{a.enqueue(s)},onError(s){e==="terminate"?a.error(s):typeof e=="function"&&e(s)},onRetry:t,onComment:r})},transform(a){i.feed(a)}})}}const yse={initialReconnectionDelay:1e3,maxReconnectionDelay:3e4,reconnectionDelayGrowFactor:1.5,maxRetries:2};class l1 extends Error{constructor(e,t){super(`Streamable HTTP error: ${t}`),this.code=e}}class qx{constructor(e,t){var r;this._url=e,this._resourceMetadataUrl=void 0,this._requestInit=t==null?void 0:t.requestInit,this._authProvider=t==null?void 0:t.authProvider,this._sessionId=t==null?void 0:t.sessionId,this._reconnectionOptions=(r=t==null?void 0:t.reconnectionOptions)!==null&&r!==void 0?r:yse}async _authThenStart(){var e;if(!this._authProvider)throw new Ks("No auth provider");let t;try{t=await fd(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl})}catch(r){throw(e=this.onerror)===null||e===void 0||e.call(this,r),r}if(t!=="AUTHORIZED")throw new Ks;return await this._startOrAuthSse({resumptionToken:void 0})}async _commonHeaders(){var e;const t={};if(this._authProvider){const r=await this._authProvider.tokens();r&&(t.Authorization=`Bearer ${r.access_token}`)}return this._sessionId&&(t["mcp-session-id"]=this._sessionId),this._protocolVersion&&(t["mcp-protocol-version"]=this._protocolVersion),new Headers({...t,...(e=this._requestInit)===null||e===void 0?void 0:e.headers})}async _startOrAuthSse(e){var t,r;const{resumptionToken:i}=e;try{const a=await this._commonHeaders();a.set("Accept","text/event-stream"),i&&a.set("last-event-id",i);const s=await fetch(this._url,{method:"GET",headers:a,signal:(t=this._abortController)===null||t===void 0?void 0:t.signal});if(!s.ok){if(s.status===401&&this._authProvider)return await this._authThenStart();if(s.status===405)return;throw new l1(s.status,`Failed to open SSE stream: ${s.statusText}`)}this._handleSseStream(s.body,e)}catch(a){throw(r=this.onerror)===null||r===void 0||r.call(this,a),a}}_getNextReconnectionDelay(e){const t=this._reconnectionOptions.initialReconnectionDelay,r=this._reconnectionOptions.reconnectionDelayGrowFactor,i=this._reconnectionOptions.maxReconnectionDelay;return Math.min(t*Math.pow(r,e),i)}_scheduleReconnection(e,t=0){var r;const i=this._reconnectionOptions.maxRetries;if(i>0&&t>=i){(r=this.onerror)===null||r===void 0||r.call(this,new Error(`Maximum reconnection attempts (${i}) exceeded.`));return}const a=this._getNextReconnectionDelay(t);setTimeout(()=>{this._startOrAuthSse(e).catch(s=>{var o;(o=this.onerror)===null||o===void 0||o.call(this,new Error(`Failed to reconnect SSE stream: ${s instanceof Error?s.message:String(s)}`)),this._scheduleReconnection(e,t+1)})},a)}_handleSseStream(e,t){if(!e)return;const{onresumptiontoken:r,replayMessageId:i}=t;let a;(async()=>{var o,u,c,d;try{const h=e.pipeThrough(new TextDecoderStream).pipeThrough(new gse).getReader();for(;;){const{value:m,done:g}=await h.read();if(g)break;if(m.id&&(a=m.id,r==null||r(m.id)),!m.event||m.event==="message")try{const _=ud.parse(JSON.parse(m.data));i!==void 0&&Ox(_)&&(_.id=i),(o=this.onmessage)===null||o===void 0||o.call(this,_)}catch(_){(u=this.onerror)===null||u===void 0||u.call(this,_)}}}catch(h){if((c=this.onerror)===null||c===void 0||c.call(this,new Error(`SSE stream disconnected: ${h}`)),this._abortController&&!this._abortController.signal.aborted&&a!==void 0)try{this._scheduleReconnection({resumptionToken:a,onresumptiontoken:r,replayMessageId:i},0)}catch(m){(d=this.onerror)===null||d===void 0||d.call(this,new Error(`Failed to reconnect: ${m instanceof Error?m.message:String(m)}`))}}})()}async start(){if(this._abortController)throw new Error("StreamableHTTPClientTransport already started! If using Client class, note that connect() calls start() automatically.");this._abortController=new AbortController}async finishAuth(e){if(!this._authProvider)throw new Ks("No auth provider");if(await fd(this._authProvider,{serverUrl:this._url,authorizationCode:e,resourceMetadataUrl:this._resourceMetadataUrl})!=="AUTHORIZED")throw new Ks("Failed to authorize")}async close(){var e,t;(e=this._abortController)===null||e===void 0||e.abort(),(t=this.onclose)===null||t===void 0||t.call(this)}async send(e,t){var r,i,a;try{const{resumptionToken:s,onresumptiontoken:o}=t||{};if(s){this._startOrAuthSse({resumptionToken:s,replayMessageId:Y5(e)?e.id:void 0}).catch(w=>{var S;return(S=this.onerror)===null||S===void 0?void 0:S.call(this,w)});return}const u=await this._commonHeaders();u.set("content-type","application/json"),u.set("accept","application/json, text/event-stream");const c={...this._requestInit,method:"POST",headers:u,body:JSON.stringify(e),signal:(r=this._abortController)===null||r===void 0?void 0:r.signal},d=await fetch(this._url,c),h=d.headers.get("mcp-session-id");if(h&&(this._sessionId=h),!d.ok){if(d.status===401&&this._authProvider){if(this._resourceMetadataUrl=Bx(d),await fd(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl})!=="AUTHORIZED")throw new Ks;return this.send(e)}const w=await d.text().catch(()=>null);throw new Error(`Error POSTing to endpoint (HTTP ${d.status}): ${w}`)}if(d.status===202){tie(e)&&this._startOrAuthSse({resumptionToken:void 0}).catch(w=>{var S;return(S=this.onerror)===null||S===void 0?void 0:S.call(this,w)});return}const g=(Array.isArray(e)?e:[e]).filter(w=>"method"in w&&"id"in w&&w.id!==void 0).length>0,_=d.headers.get("content-type");if(g)if(_!=null&&_.includes("text/event-stream"))this._handleSseStream(d.body,{onresumptiontoken:o});else if(_!=null&&_.includes("application/json")){const w=await d.json(),S=Array.isArray(w)?w.map(E=>ud.parse(E)):[ud.parse(w)];for(const E of S)(i=this.onmessage)===null||i===void 0||i.call(this,E)}else throw new l1(-1,`Unexpected content type: ${_}`)}catch(s){throw(a=this.onerror)===null||a===void 0||a.call(this,s),s}}get sessionId(){return this._sessionId}async terminateSession(){var e,t;if(this._sessionId)try{const r=await this._commonHeaders(),i={...this._requestInit,method:"DELETE",headers:r,signal:(e=this._abortController)===null||e===void 0?void 0:e.signal},a=await fetch(this._url,i);if(!a.ok&&a.status!==405)throw new l1(a.status,`Failed to terminate session: ${a.statusText}`);this._sessionId=void 0}catch(r){throw(t=this.onerror)===null||t===void 0||t.call(this,r),r}}setProtocolVersion(e){this._protocolVersion=e}get protocolVersion(){return this._protocolVersion}}var Ou={exports:{}},vse=null;const _se=Object.freeze(Object.defineProperty({__proto__:null,default:vse},Symbol.toStringTag,{value:"Module"})),Jb=B7(_se);var u1,n4;function eP(){if(n4)return u1;n4=1;function n(i){if(typeof i!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(i))}function e(i,a){for(var s="",o=0,u=-1,c=0,d,h=0;h<=i.length;++h){if(h<i.length)d=i.charCodeAt(h);else{if(d===47)break;d=47}if(d===47){if(!(u===h-1||c===1))if(u!==h-1&&c===2){if(s.length<2||o!==2||s.charCodeAt(s.length-1)!==46||s.charCodeAt(s.length-2)!==46){if(s.length>2){var m=s.lastIndexOf("/");if(m!==s.length-1){m===-1?(s="",o=0):(s=s.slice(0,m),o=s.length-1-s.lastIndexOf("/")),u=h,c=0;continue}}else if(s.length===2||s.length===1){s="",o=0,u=h,c=0;continue}}a&&(s.length>0?s+="/..":s="..",o=2)}else s.length>0?s+="/"+i.slice(u+1,h):s=i.slice(u+1,h),o=h-u-1;u=h,c=0}else d===46&&c!==-1?++c:c=-1}return s}function t(i,a){var s=a.dir||a.root,o=a.base||(a.name||"")+(a.ext||"");return s?s===a.root?s+o:s+i+o:o}var r={resolve:function(){for(var a="",s=!1,o,u=arguments.length-1;u>=-1&&!s;u--){var c;u>=0?c=arguments[u]:(o===void 0&&(o=ot.cwd()),c=o),n(c),c.length!==0&&(a=c+"/"+a,s=c.charCodeAt(0)===47)}return a=e(a,!s),s?a.length>0?"/"+a:"/":a.length>0?a:"."},normalize:function(a){if(n(a),a.length===0)return".";var s=a.charCodeAt(0)===47,o=a.charCodeAt(a.length-1)===47;return a=e(a,!s),a.length===0&&!s&&(a="."),a.length>0&&o&&(a+="/"),s?"/"+a:a},isAbsolute:function(a){return n(a),a.length>0&&a.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var a,s=0;s<arguments.length;++s){var o=arguments[s];n(o),o.length>0&&(a===void 0?a=o:a+="/"+o)}return a===void 0?".":r.normalize(a)},relative:function(a,s){if(n(a),n(s),a===s||(a=r.resolve(a),s=r.resolve(s),a===s))return"";for(var o=1;o<a.length&&a.charCodeAt(o)===47;++o);for(var u=a.length,c=u-o,d=1;d<s.length&&s.charCodeAt(d)===47;++d);for(var h=s.length,m=h-d,g=c<m?c:m,_=-1,w=0;w<=g;++w){if(w===g){if(m>g){if(s.charCodeAt(d+w)===47)return s.slice(d+w+1);if(w===0)return s.slice(d+w)}else c>g&&(a.charCodeAt(o+w)===47?_=w:w===0&&(_=0));break}var S=a.charCodeAt(o+w),E=s.charCodeAt(d+w);if(S!==E)break;S===47&&(_=w)}var C="";for(w=o+_+1;w<=u;++w)(w===u||a.charCodeAt(w)===47)&&(C.length===0?C+="..":C+="/..");return C.length>0?C+s.slice(d+_):(d+=_,s.charCodeAt(d)===47&&++d,s.slice(d))},_makeLong:function(a){return a},dirname:function(a){if(n(a),a.length===0)return".";for(var s=a.charCodeAt(0),o=s===47,u=-1,c=!0,d=a.length-1;d>=1;--d)if(s=a.charCodeAt(d),s===47){if(!c){u=d;break}}else c=!1;return u===-1?o?"/":".":o&&u===1?"//":a.slice(0,u)},basename:function(a,s){if(s!==void 0&&typeof s!="string")throw new TypeError('"ext" argument must be a string');n(a);var o=0,u=-1,c=!0,d;if(s!==void 0&&s.length>0&&s.length<=a.length){if(s.length===a.length&&s===a)return"";var h=s.length-1,m=-1;for(d=a.length-1;d>=0;--d){var g=a.charCodeAt(d);if(g===47){if(!c){o=d+1;break}}else m===-1&&(c=!1,m=d+1),h>=0&&(g===s.charCodeAt(h)?--h===-1&&(u=d):(h=-1,u=m))}return o===u?u=m:u===-1&&(u=a.length),a.slice(o,u)}else{for(d=a.length-1;d>=0;--d)if(a.charCodeAt(d)===47){if(!c){o=d+1;break}}else u===-1&&(c=!1,u=d+1);return u===-1?"":a.slice(o,u)}},extname:function(a){n(a);for(var s=-1,o=0,u=-1,c=!0,d=0,h=a.length-1;h>=0;--h){var m=a.charCodeAt(h);if(m===47){if(!c){o=h+1;break}continue}u===-1&&(c=!1,u=h+1),m===46?s===-1?s=h:d!==1&&(d=1):s!==-1&&(d=-1)}return s===-1||u===-1||d===0||d===1&&s===u-1&&s===o+1?"":a.slice(s,u)},format:function(a){if(a===null||typeof a!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof a);return t("/",a)},parse:function(a){n(a);var s={root:"",dir:"",base:"",ext:"",name:""};if(a.length===0)return s;var o=a.charCodeAt(0),u=o===47,c;u?(s.root="/",c=1):c=0;for(var d=-1,h=0,m=-1,g=!0,_=a.length-1,w=0;_>=c;--_){if(o=a.charCodeAt(_),o===47){if(!g){h=_+1;break}continue}m===-1&&(g=!1,m=_+1),o===46?d===-1?d=_:w!==1&&(w=1):d!==-1&&(w=-1)}return d===-1||m===-1||w===0||w===1&&d===m-1&&d===h+1?m!==-1&&(h===0&&u?s.base=s.name=a.slice(1,m):s.base=s.name=a.slice(h,m)):(h===0&&u?(s.name=a.slice(1,d),s.base=a.slice(1,m)):(s.name=a.slice(h,d),s.base=a.slice(h,m)),s.ext=a.slice(d,m)),h>0?s.dir=a.slice(0,h-1):u&&(s.dir="/"),s},sep:"/",delimiter:":",win32:null,posix:null};return r.posix=r,u1=r,u1}var c1,r4;function bse(){if(r4)return c1;r4=1;var n={};c1=i,i.sync=a;var e=Jb;function t(s,o){var u=o.pathExt!==void 0?o.pathExt:n.PATHEXT;if(!u||(u=u.split(";"),u.indexOf("")!==-1))return!0;for(var c=0;c<u.length;c++){var d=u[c].toLowerCase();if(d&&s.substr(-d.length).toLowerCase()===d)return!0}return!1}function r(s,o,u){return!s.isSymbolicLink()&&!s.isFile()?!1:t(o,u)}function i(s,o,u){e.stat(s,function(c,d){u(c,c?!1:r(d,s,o))})}function a(s,o){return r(e.statSync(s),s,o)}return c1}var f1,i4;function wse(){if(i4)return f1;i4=1,f1=e,e.sync=t;var n=Jb;function e(a,s,o){n.stat(a,function(u,c){o(u,u?!1:r(c,s))})}function t(a,s){return r(n.statSync(a),s)}function r(a,s){return a.isFile()&&i(a,s)}function i(a,s){var o=a.mode,u=a.uid,c=a.gid,d=s.uid!==void 0?s.uid:ot.getuid&&ot.getuid(),h=s.gid!==void 0?s.gid:ot.getgid&&ot.getgid(),m=parseInt("100",8),g=parseInt("010",8),_=parseInt("001",8),w=m|g,S=o&_||o&g&&c===h||o&m&&u===d||o&w&&d===0;return S}return f1}var d1,a4;function Ese(){if(a4)return d1;a4=1;var n;ot.platform==="win32"||window.TESTING_WINDOWS?n=bse():n=wse(),d1=e,e.sync=t;function e(r,i,a){if(typeof i=="function"&&(a=i,i={}),!a){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(s,o){e(r,i||{},function(u,c){u?o(u):s(c)})})}n(r,i||{},function(s,o){s&&(s.code==="EACCES"||i&&i.ignoreErrors)&&(s=null,o=!1),a(s,o)})}function t(r,i){try{return n.sync(r,i||{})}catch(a){if(i&&i.ignoreErrors||a.code==="EACCES")return!1;throw a}}return d1}var h1,s4;function Sse(){if(s4)return h1;s4=1;var n={};const e=ot.platform==="win32"||n.OSTYPE==="cygwin"||n.OSTYPE==="msys",t=eP(),r=e?";":":",i=Ese(),a=c=>Object.assign(new Error(`not found: ${c}`),{code:"ENOENT"}),s=(c,d)=>{const h=d.colon||r,m=c.match(/\//)||e&&c.match(/\\/)?[""]:[...e?[ot.cwd()]:[],...(d.path||n.PATH||"").split(h)],g=e?d.pathExt||n.PATHEXT||".EXE;.CMD;.BAT;.COM":"",_=e?g.split(h):[""];return e&&c.indexOf(".")!==-1&&_[0]!==""&&_.unshift(""),{pathEnv:m,pathExt:_,pathExtExe:g}},o=(c,d,h)=>{typeof d=="function"&&(h=d,d={}),d||(d={});const{pathEnv:m,pathExt:g,pathExtExe:_}=s(c,d),w=[],S=C=>new Promise((A,R)=>{if(C===m.length)return d.all&&w.length?A(w):R(a(c));const P=m[C],N=/^".*"$/.test(P)?P.slice(1,-1):P,U=t.join(N,c),k=!N&&/^\.[\\\/]/.test(c)?c.slice(0,2)+U:U;A(E(k,C,0))}),E=(C,A,R)=>new Promise((P,N)=>{if(R===g.length)return P(S(A+1));const U=g[R];i(C+U,{pathExt:_},(k,B)=>{if(!k&&B)if(d.all)w.push(C+U);else return P(C+U);return P(E(C,A,R+1))})});return h?S(0).then(C=>h(null,C),h):S(0)},u=(c,d)=>{d=d||{};const{pathEnv:h,pathExt:m,pathExtExe:g}=s(c,d),_=[];for(let w=0;w<h.length;w++){const S=h[w],E=/^".*"$/.test(S)?S.slice(1,-1):S,C=t.join(E,c),A=!E&&/^\.[\\\/]/.test(c)?c.slice(0,2)+C:C;for(let R=0;R<m.length;R++){const P=A+m[R];try{if(i.sync(P,{pathExt:g}))if(d.all)_.push(P);else return P}catch{}}}if(d.all&&_.length)return _;if(d.nothrow)return null;throw a(c)};return h1=o,o.sync=u,h1}var zy={exports:{}},o4;function Tse(){if(o4)return zy.exports;o4=1;var n={};const e=(t={})=>{const r=t.env||n;return(t.platform||ot.platform)!=="win32"?"PATH":Object.keys(r).reverse().find(a=>a.toUpperCase()==="PATH")||"Path"};return zy.exports=e,zy.exports.default=e,zy.exports}var p1,l4;function Ase(){if(l4)return p1;l4=1;var n={};const e=eP(),t=Sse(),r=Tse();function i(s,o){const u=s.options.env||n,c=ot.cwd(),d=s.options.cwd!=null,h=d&&ot.chdir!==void 0&&!ot.chdir.disabled;if(h)try{ot.chdir(s.options.cwd)}catch{}let m;try{m=t.sync(s.command,{path:u[r({env:u})],pathExt:o?e.delimiter:void 0})}catch{}finally{h&&ot.chdir(c)}return m&&(m=e.resolve(d?s.options.cwd:"",m)),m}function a(s){return i(s)||i(s,!0)}return p1=a,p1}var Hy={},u4;function Cse(){if(u4)return Hy;u4=1;const n=/([()\][%!^"`<>&|;, *?])/g;function e(r){return r=r.replace(n,"^$1"),r}function t(r,i){return r=`${r}`,r=r.replace(/(?=(\\+?)?)\1"/g,'$1$1\\"'),r=r.replace(/(?=(\\+?)?)\1$/,"$1$1"),r=`"${r}"`,r=r.replace(n,"^$1"),i&&(r=r.replace(n,"^$1")),r}return Hy.command=e,Hy.argument=t,Hy}var Eq={},Yb={};Yb.byteLength=Ise;Yb.toByteArray=Ose;Yb.fromByteArray=Mse;var Js=[],Ua=[],xse=typeof Uint8Array<"u"?Uint8Array:Array,m1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var Sf=0,Rse=m1.length;Sf<Rse;++Sf)Js[Sf]=m1[Sf],Ua[m1.charCodeAt(Sf)]=Sf;Ua[45]=62;Ua[95]=63;function Sq(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function Ise(n){var e=Sq(n),t=e[0],r=e[1];return(t+r)*3/4-r}function Pse(n,e,t){return(e+t)*3/4-t}function Ose(n){var e,t=Sq(n),r=t[0],i=t[1],a=new xse(Pse(n,r,i)),s=0,o=i>0?r-4:r,u;for(u=0;u<o;u+=4)e=Ua[n.charCodeAt(u)]<<18|Ua[n.charCodeAt(u+1)]<<12|Ua[n.charCodeAt(u+2)]<<6|Ua[n.charCodeAt(u+3)],a[s++]=e>>16&255,a[s++]=e>>8&255,a[s++]=e&255;return i===2&&(e=Ua[n.charCodeAt(u)]<<2|Ua[n.charCodeAt(u+1)]>>4,a[s++]=e&255),i===1&&(e=Ua[n.charCodeAt(u)]<<10|Ua[n.charCodeAt(u+1)]<<4|Ua[n.charCodeAt(u+2)]>>2,a[s++]=e>>8&255,a[s++]=e&255),a}function kse(n){return Js[n>>18&63]+Js[n>>12&63]+Js[n>>6&63]+Js[n&63]}function Nse(n,e,t){for(var r,i=[],a=e;a<t;a+=3)r=(n[a]<<16&16711680)+(n[a+1]<<8&65280)+(n[a+2]&255),i.push(kse(r));return i.join("")}function Mse(n){for(var e,t=n.length,r=t%3,i=[],a=16383,s=0,o=t-r;s<o;s+=a)i.push(Nse(n,s,s+a>o?o:s+a));return r===1?(e=n[t-1],i.push(Js[e>>2]+Js[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],i.push(Js[e>>10]+Js[e>>4&63]+Js[e<<2&63]+"=")),i.join("")}var tP={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */tP.read=function(n,e,t,r,i){var a,s,o=i*8-r-1,u=(1<<o)-1,c=u>>1,d=-7,h=t?i-1:0,m=t?-1:1,g=n[e+h];for(h+=m,a=g&(1<<-d)-1,g>>=-d,d+=o;d>0;a=a*256+n[e+h],h+=m,d-=8);for(s=a&(1<<-d)-1,a>>=-d,d+=r;d>0;s=s*256+n[e+h],h+=m,d-=8);if(a===0)a=1-c;else{if(a===u)return s?NaN:(g?-1:1)*(1/0);s=s+Math.pow(2,r),a=a-c}return(g?-1:1)*s*Math.pow(2,a-r)};tP.write=function(n,e,t,r,i,a){var s,o,u,c=a*8-i-1,d=(1<<c)-1,h=d>>1,m=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,g=r?0:a-1,_=r?1:-1,w=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,s=d):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),s+h>=1?e+=m/u:e+=m*Math.pow(2,1-h),e*u>=2&&(s++,u/=2),s+h>=d?(o=0,s=d):s+h>=1?(o=(e*u-1)*Math.pow(2,i),s=s+h):(o=e*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;n[t+g]=o&255,g+=_,o/=256,i-=8);for(s=s<<i|o,c+=i;c>0;n[t+g]=s&255,g+=_,s/=256,c-=8);n[t+g-_]|=w*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(n){const e=Yb,t=tP,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=d,n.SlowBuffer=P,n.INSPECT_MAX_BYTES=50;const i=2147483647;n.kMaxLength=i;const{Uint8Array:a,ArrayBuffer:s,SharedArrayBuffer:o}=globalThis;d.TYPED_ARRAY_SUPPORT=u(),!d.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function u(){try{const W=new a(1),M={foo:function(){return 42}};return Object.setPrototypeOf(M,a.prototype),Object.setPrototypeOf(W,M),W.foo()===42}catch{return!1}}Object.defineProperty(d.prototype,"parent",{enumerable:!0,get:function(){if(d.isBuffer(this))return this.buffer}}),Object.defineProperty(d.prototype,"offset",{enumerable:!0,get:function(){if(d.isBuffer(this))return this.byteOffset}});function c(W){if(W>i)throw new RangeError('The value "'+W+'" is invalid for option "size"');const M=new a(W);return Object.setPrototypeOf(M,d.prototype),M}function d(W,M,L){if(typeof W=="number"){if(typeof M=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return _(W)}return h(W,M,L)}d.poolSize=8192;function h(W,M,L){if(typeof W=="string")return w(W,M);if(s.isView(W))return E(W);if(W==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof W);if(Ze(W,s)||W&&Ze(W.buffer,s)||typeof o<"u"&&(Ze(W,o)||W&&Ze(W.buffer,o)))return C(W,M,L);if(typeof W=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const re=W.valueOf&&W.valueOf();if(re!=null&&re!==W)return d.from(re,M,L);const me=A(W);if(me)return me;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof W[Symbol.toPrimitive]=="function")return d.from(W[Symbol.toPrimitive]("string"),M,L);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof W)}d.from=function(W,M,L){return h(W,M,L)},Object.setPrototypeOf(d.prototype,a.prototype),Object.setPrototypeOf(d,a);function m(W){if(typeof W!="number")throw new TypeError('"size" argument must be of type number');if(W<0)throw new RangeError('The value "'+W+'" is invalid for option "size"')}function g(W,M,L){return m(W),W<=0?c(W):M!==void 0?typeof L=="string"?c(W).fill(M,L):c(W).fill(M):c(W)}d.alloc=function(W,M,L){return g(W,M,L)};function _(W){return m(W),c(W<0?0:R(W)|0)}d.allocUnsafe=function(W){return _(W)},d.allocUnsafeSlow=function(W){return _(W)};function w(W,M){if((typeof M!="string"||M==="")&&(M="utf8"),!d.isEncoding(M))throw new TypeError("Unknown encoding: "+M);const L=N(W,M)|0;let re=c(L);const me=re.write(W,M);return me!==L&&(re=re.slice(0,me)),re}function S(W){const M=W.length<0?0:R(W.length)|0,L=c(M);for(let re=0;re<M;re+=1)L[re]=W[re]&255;return L}function E(W){if(Ze(W,a)){const M=new a(W);return C(M.buffer,M.byteOffset,M.byteLength)}return S(W)}function C(W,M,L){if(M<0||W.byteLength<M)throw new RangeError('"offset" is outside of buffer bounds');if(W.byteLength<M+(L||0))throw new RangeError('"length" is outside of buffer bounds');let re;return M===void 0&&L===void 0?re=new a(W):L===void 0?re=new a(W,M):re=new a(W,M,L),Object.setPrototypeOf(re,d.prototype),re}function A(W){if(d.isBuffer(W)){const M=R(W.length)|0,L=c(M);return L.length===0||W.copy(L,0,0,M),L}if(W.length!==void 0)return typeof W.length!="number"||he(W.length)?c(0):S(W);if(W.type==="Buffer"&&Array.isArray(W.data))return S(W.data)}function R(W){if(W>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return W|0}function P(W){return+W!=W&&(W=0),d.alloc(+W)}d.isBuffer=function(M){return M!=null&&M._isBuffer===!0&&M!==d.prototype},d.compare=function(M,L){if(Ze(M,a)&&(M=d.from(M,M.offset,M.byteLength)),Ze(L,a)&&(L=d.from(L,L.offset,L.byteLength)),!d.isBuffer(M)||!d.isBuffer(L))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(M===L)return 0;let re=M.length,me=L.length;for(let Ce=0,Le=Math.min(re,me);Ce<Le;++Ce)if(M[Ce]!==L[Ce]){re=M[Ce],me=L[Ce];break}return re<me?-1:me<re?1:0},d.isEncoding=function(M){switch(String(M).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.concat=function(M,L){if(!Array.isArray(M))throw new TypeError('"list" argument must be an Array of Buffers');if(M.length===0)return d.alloc(0);let re;if(L===void 0)for(L=0,re=0;re<M.length;++re)L+=M[re].length;const me=d.allocUnsafe(L);let Ce=0;for(re=0;re<M.length;++re){let Le=M[re];if(Ze(Le,a))Ce+Le.length>me.length?(d.isBuffer(Le)||(Le=d.from(Le)),Le.copy(me,Ce)):a.prototype.set.call(me,Le,Ce);else if(d.isBuffer(Le))Le.copy(me,Ce);else throw new TypeError('"list" argument must be an Array of Buffers');Ce+=Le.length}return me};function N(W,M){if(d.isBuffer(W))return W.length;if(s.isView(W)||Ze(W,s))return W.byteLength;if(typeof W!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof W);const L=W.length,re=arguments.length>2&&arguments[2]===!0;if(!re&&L===0)return 0;let me=!1;for(;;)switch(M){case"ascii":case"latin1":case"binary":return L;case"utf8":case"utf-8":return He(W).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L*2;case"hex":return L>>>1;case"base64":return ze(W).length;default:if(me)return re?-1:He(W).length;M=(""+M).toLowerCase(),me=!0}}d.byteLength=N;function U(W,M,L){let re=!1;if((M===void 0||M<0)&&(M=0),M>this.length||((L===void 0||L>this.length)&&(L=this.length),L<=0)||(L>>>=0,M>>>=0,L<=M))return"";for(W||(W="utf8");;)switch(W){case"hex":return Te(this,M,L);case"utf8":case"utf-8":return le(this,M,L);case"ascii":return $(this,M,L);case"latin1":case"binary":return ve(this,M,L);case"base64":return ee(this,M,L);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return F(this,M,L);default:if(re)throw new TypeError("Unknown encoding: "+W);W=(W+"").toLowerCase(),re=!0}}d.prototype._isBuffer=!0;function k(W,M,L){const re=W[M];W[M]=W[L],W[L]=re}d.prototype.swap16=function(){const M=this.length;if(M%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let L=0;L<M;L+=2)k(this,L,L+1);return this},d.prototype.swap32=function(){const M=this.length;if(M%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let L=0;L<M;L+=4)k(this,L,L+3),k(this,L+1,L+2);return this},d.prototype.swap64=function(){const M=this.length;if(M%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let L=0;L<M;L+=8)k(this,L,L+7),k(this,L+1,L+6),k(this,L+2,L+5),k(this,L+3,L+4);return this},d.prototype.toString=function(){const M=this.length;return M===0?"":arguments.length===0?le(this,0,M):U.apply(this,arguments)},d.prototype.toLocaleString=d.prototype.toString,d.prototype.equals=function(M){if(!d.isBuffer(M))throw new TypeError("Argument must be a Buffer");return this===M?!0:d.compare(this,M)===0},d.prototype.inspect=function(){let M="";const L=n.INSPECT_MAX_BYTES;return M=this.toString("hex",0,L).replace(/(.{2})/g,"$1 ").trim(),this.length>L&&(M+=" ... "),"<Buffer "+M+">"},r&&(d.prototype[r]=d.prototype.inspect),d.prototype.compare=function(M,L,re,me,Ce){if(Ze(M,a)&&(M=d.from(M,M.offset,M.byteLength)),!d.isBuffer(M))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof M);if(L===void 0&&(L=0),re===void 0&&(re=M?M.length:0),me===void 0&&(me=0),Ce===void 0&&(Ce=this.length),L<0||re>M.length||me<0||Ce>this.length)throw new RangeError("out of range index");if(me>=Ce&&L>=re)return 0;if(me>=Ce)return-1;if(L>=re)return 1;if(L>>>=0,re>>>=0,me>>>=0,Ce>>>=0,this===M)return 0;let Le=Ce-me,ft=re-L;const Bt=Math.min(Le,ft),sn=this.slice(me,Ce),hn=M.slice(L,re);for(let Xt=0;Xt<Bt;++Xt)if(sn[Xt]!==hn[Xt]){Le=sn[Xt],ft=hn[Xt];break}return Le<ft?-1:ft<Le?1:0};function B(W,M,L,re,me){if(W.length===0)return-1;if(typeof L=="string"?(re=L,L=0):L>2147483647?L=2147483647:L<-2147483648&&(L=-2147483648),L=+L,he(L)&&(L=me?0:W.length-1),L<0&&(L=W.length+L),L>=W.length){if(me)return-1;L=W.length-1}else if(L<0)if(me)L=0;else return-1;if(typeof M=="string"&&(M=d.from(M,re)),d.isBuffer(M))return M.length===0?-1:H(W,M,L,re,me);if(typeof M=="number")return M=M&255,typeof a.prototype.indexOf=="function"?me?a.prototype.indexOf.call(W,M,L):a.prototype.lastIndexOf.call(W,M,L):H(W,[M],L,re,me);throw new TypeError("val must be string, number or Buffer")}function H(W,M,L,re,me){let Ce=1,Le=W.length,ft=M.length;if(re!==void 0&&(re=String(re).toLowerCase(),re==="ucs2"||re==="ucs-2"||re==="utf16le"||re==="utf-16le")){if(W.length<2||M.length<2)return-1;Ce=2,Le/=2,ft/=2,L/=2}function Bt(hn,Xt){return Ce===1?hn[Xt]:hn.readUInt16BE(Xt*Ce)}let sn;if(me){let hn=-1;for(sn=L;sn<Le;sn++)if(Bt(W,sn)===Bt(M,hn===-1?0:sn-hn)){if(hn===-1&&(hn=sn),sn-hn+1===ft)return hn*Ce}else hn!==-1&&(sn-=sn-hn),hn=-1}else for(L+ft>Le&&(L=Le-ft),sn=L;sn>=0;sn--){let hn=!0;for(let Xt=0;Xt<ft;Xt++)if(Bt(W,sn+Xt)!==Bt(M,Xt)){hn=!1;break}if(hn)return sn}return-1}d.prototype.includes=function(M,L,re){return this.indexOf(M,L,re)!==-1},d.prototype.indexOf=function(M,L,re){return B(this,M,L,re,!0)},d.prototype.lastIndexOf=function(M,L,re){return B(this,M,L,re,!1)};function G(W,M,L,re){L=Number(L)||0;const me=W.length-L;re?(re=Number(re),re>me&&(re=me)):re=me;const Ce=M.length;re>Ce/2&&(re=Ce/2);let Le;for(Le=0;Le<re;++Le){const ft=parseInt(M.substr(Le*2,2),16);if(he(ft))return Le;W[L+Le]=ft}return Le}function z(W,M,L,re){return it(He(M,W.length-L),W,L,re)}function oe(W,M,L,re){return it(At(M),W,L,re)}function te(W,M,L,re){return it(ze(M),W,L,re)}function se(W,M,L,re){return it(Ge(M,W.length-L),W,L,re)}d.prototype.write=function(M,L,re,me){if(L===void 0)me="utf8",re=this.length,L=0;else if(re===void 0&&typeof L=="string")me=L,re=this.length,L=0;else if(isFinite(L))L=L>>>0,isFinite(re)?(re=re>>>0,me===void 0&&(me="utf8")):(me=re,re=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Ce=this.length-L;if((re===void 0||re>Ce)&&(re=Ce),M.length>0&&(re<0||L<0)||L>this.length)throw new RangeError("Attempt to write outside buffer bounds");me||(me="utf8");let Le=!1;for(;;)switch(me){case"hex":return G(this,M,L,re);case"utf8":case"utf-8":return z(this,M,L,re);case"ascii":case"latin1":case"binary":return oe(this,M,L,re);case"base64":return te(this,M,L,re);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return se(this,M,L,re);default:if(Le)throw new TypeError("Unknown encoding: "+me);me=(""+me).toLowerCase(),Le=!0}},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ee(W,M,L){return M===0&&L===W.length?e.fromByteArray(W):e.fromByteArray(W.slice(M,L))}function le(W,M,L){L=Math.min(W.length,L);const re=[];let me=M;for(;me<L;){const Ce=W[me];let Le=null,ft=Ce>239?4:Ce>223?3:Ce>191?2:1;if(me+ft<=L){let Bt,sn,hn,Xt;switch(ft){case 1:Ce<128&&(Le=Ce);break;case 2:Bt=W[me+1],(Bt&192)===128&&(Xt=(Ce&31)<<6|Bt&63,Xt>127&&(Le=Xt));break;case 3:Bt=W[me+1],sn=W[me+2],(Bt&192)===128&&(sn&192)===128&&(Xt=(Ce&15)<<12|(Bt&63)<<6|sn&63,Xt>2047&&(Xt<55296||Xt>57343)&&(Le=Xt));break;case 4:Bt=W[me+1],sn=W[me+2],hn=W[me+3],(Bt&192)===128&&(sn&192)===128&&(hn&192)===128&&(Xt=(Ce&15)<<18|(Bt&63)<<12|(sn&63)<<6|hn&63,Xt>65535&&Xt<1114112&&(Le=Xt))}}Le===null?(Le=65533,ft=1):Le>65535&&(Le-=65536,re.push(Le>>>10&1023|55296),Le=56320|Le&1023),re.push(Le),me+=ft}return we(re)}const pe=4096;function we(W){const M=W.length;if(M<=pe)return String.fromCharCode.apply(String,W);let L="",re=0;for(;re<M;)L+=String.fromCharCode.apply(String,W.slice(re,re+=pe));return L}function $(W,M,L){let re="";L=Math.min(W.length,L);for(let me=M;me<L;++me)re+=String.fromCharCode(W[me]&127);return re}function ve(W,M,L){let re="";L=Math.min(W.length,L);for(let me=M;me<L;++me)re+=String.fromCharCode(W[me]);return re}function Te(W,M,L){const re=W.length;(!M||M<0)&&(M=0),(!L||L<0||L>re)&&(L=re);let me="";for(let Ce=M;Ce<L;++Ce)me+=Ie[W[Ce]];return me}function F(W,M,L){const re=W.slice(M,L);let me="";for(let Ce=0;Ce<re.length-1;Ce+=2)me+=String.fromCharCode(re[Ce]+re[Ce+1]*256);return me}d.prototype.slice=function(M,L){const re=this.length;M=~~M,L=L===void 0?re:~~L,M<0?(M+=re,M<0&&(M=0)):M>re&&(M=re),L<0?(L+=re,L<0&&(L=0)):L>re&&(L=re),L<M&&(L=M);const me=this.subarray(M,L);return Object.setPrototypeOf(me,d.prototype),me};function ae(W,M,L){if(W%1!==0||W<0)throw new RangeError("offset is not uint");if(W+M>L)throw new RangeError("Trying to access beyond buffer length")}d.prototype.readUintLE=d.prototype.readUIntLE=function(M,L,re){M=M>>>0,L=L>>>0,re||ae(M,L,this.length);let me=this[M],Ce=1,Le=0;for(;++Le<L&&(Ce*=256);)me+=this[M+Le]*Ce;return me},d.prototype.readUintBE=d.prototype.readUIntBE=function(M,L,re){M=M>>>0,L=L>>>0,re||ae(M,L,this.length);let me=this[M+--L],Ce=1;for(;L>0&&(Ce*=256);)me+=this[M+--L]*Ce;return me},d.prototype.readUint8=d.prototype.readUInt8=function(M,L){return M=M>>>0,L||ae(M,1,this.length),this[M]},d.prototype.readUint16LE=d.prototype.readUInt16LE=function(M,L){return M=M>>>0,L||ae(M,2,this.length),this[M]|this[M+1]<<8},d.prototype.readUint16BE=d.prototype.readUInt16BE=function(M,L){return M=M>>>0,L||ae(M,2,this.length),this[M]<<8|this[M+1]},d.prototype.readUint32LE=d.prototype.readUInt32LE=function(M,L){return M=M>>>0,L||ae(M,4,this.length),(this[M]|this[M+1]<<8|this[M+2]<<16)+this[M+3]*16777216},d.prototype.readUint32BE=d.prototype.readUInt32BE=function(M,L){return M=M>>>0,L||ae(M,4,this.length),this[M]*16777216+(this[M+1]<<16|this[M+2]<<8|this[M+3])},d.prototype.readBigUInt64LE=Be(function(M){M=M>>>0,je(M,"offset");const L=this[M],re=this[M+7];(L===void 0||re===void 0)&&We(M,this.length-8);const me=L+this[++M]*2**8+this[++M]*2**16+this[++M]*2**24,Ce=this[++M]+this[++M]*2**8+this[++M]*2**16+re*2**24;return BigInt(me)+(BigInt(Ce)<<BigInt(32))}),d.prototype.readBigUInt64BE=Be(function(M){M=M>>>0,je(M,"offset");const L=this[M],re=this[M+7];(L===void 0||re===void 0)&&We(M,this.length-8);const me=L*2**24+this[++M]*2**16+this[++M]*2**8+this[++M],Ce=this[++M]*2**24+this[++M]*2**16+this[++M]*2**8+re;return(BigInt(me)<<BigInt(32))+BigInt(Ce)}),d.prototype.readIntLE=function(M,L,re){M=M>>>0,L=L>>>0,re||ae(M,L,this.length);let me=this[M],Ce=1,Le=0;for(;++Le<L&&(Ce*=256);)me+=this[M+Le]*Ce;return Ce*=128,me>=Ce&&(me-=Math.pow(2,8*L)),me},d.prototype.readIntBE=function(M,L,re){M=M>>>0,L=L>>>0,re||ae(M,L,this.length);let me=L,Ce=1,Le=this[M+--me];for(;me>0&&(Ce*=256);)Le+=this[M+--me]*Ce;return Ce*=128,Le>=Ce&&(Le-=Math.pow(2,8*L)),Le},d.prototype.readInt8=function(M,L){return M=M>>>0,L||ae(M,1,this.length),this[M]&128?(255-this[M]+1)*-1:this[M]},d.prototype.readInt16LE=function(M,L){M=M>>>0,L||ae(M,2,this.length);const re=this[M]|this[M+1]<<8;return re&32768?re|4294901760:re},d.prototype.readInt16BE=function(M,L){M=M>>>0,L||ae(M,2,this.length);const re=this[M+1]|this[M]<<8;return re&32768?re|4294901760:re},d.prototype.readInt32LE=function(M,L){return M=M>>>0,L||ae(M,4,this.length),this[M]|this[M+1]<<8|this[M+2]<<16|this[M+3]<<24},d.prototype.readInt32BE=function(M,L){return M=M>>>0,L||ae(M,4,this.length),this[M]<<24|this[M+1]<<16|this[M+2]<<8|this[M+3]},d.prototype.readBigInt64LE=Be(function(M){M=M>>>0,je(M,"offset");const L=this[M],re=this[M+7];(L===void 0||re===void 0)&&We(M,this.length-8);const me=this[M+4]+this[M+5]*2**8+this[M+6]*2**16+(re<<24);return(BigInt(me)<<BigInt(32))+BigInt(L+this[++M]*2**8+this[++M]*2**16+this[++M]*2**24)}),d.prototype.readBigInt64BE=Be(function(M){M=M>>>0,je(M,"offset");const L=this[M],re=this[M+7];(L===void 0||re===void 0)&&We(M,this.length-8);const me=(L<<24)+this[++M]*2**16+this[++M]*2**8+this[++M];return(BigInt(me)<<BigInt(32))+BigInt(this[++M]*2**24+this[++M]*2**16+this[++M]*2**8+re)}),d.prototype.readFloatLE=function(M,L){return M=M>>>0,L||ae(M,4,this.length),t.read(this,M,!0,23,4)},d.prototype.readFloatBE=function(M,L){return M=M>>>0,L||ae(M,4,this.length),t.read(this,M,!1,23,4)},d.prototype.readDoubleLE=function(M,L){return M=M>>>0,L||ae(M,8,this.length),t.read(this,M,!0,52,8)},d.prototype.readDoubleBE=function(M,L){return M=M>>>0,L||ae(M,8,this.length),t.read(this,M,!1,52,8)};function fe(W,M,L,re,me,Ce){if(!d.isBuffer(W))throw new TypeError('"buffer" argument must be a Buffer instance');if(M>me||M<Ce)throw new RangeError('"value" argument is out of bounds');if(L+re>W.length)throw new RangeError("Index out of range")}d.prototype.writeUintLE=d.prototype.writeUIntLE=function(M,L,re,me){if(M=+M,L=L>>>0,re=re>>>0,!me){const ft=Math.pow(2,8*re)-1;fe(this,M,L,re,ft,0)}let Ce=1,Le=0;for(this[L]=M&255;++Le<re&&(Ce*=256);)this[L+Le]=M/Ce&255;return L+re},d.prototype.writeUintBE=d.prototype.writeUIntBE=function(M,L,re,me){if(M=+M,L=L>>>0,re=re>>>0,!me){const ft=Math.pow(2,8*re)-1;fe(this,M,L,re,ft,0)}let Ce=re-1,Le=1;for(this[L+Ce]=M&255;--Ce>=0&&(Le*=256);)this[L+Ce]=M/Le&255;return L+re},d.prototype.writeUint8=d.prototype.writeUInt8=function(M,L,re){return M=+M,L=L>>>0,re||fe(this,M,L,1,255,0),this[L]=M&255,L+1},d.prototype.writeUint16LE=d.prototype.writeUInt16LE=function(M,L,re){return M=+M,L=L>>>0,re||fe(this,M,L,2,65535,0),this[L]=M&255,this[L+1]=M>>>8,L+2},d.prototype.writeUint16BE=d.prototype.writeUInt16BE=function(M,L,re){return M=+M,L=L>>>0,re||fe(this,M,L,2,65535,0),this[L]=M>>>8,this[L+1]=M&255,L+2},d.prototype.writeUint32LE=d.prototype.writeUInt32LE=function(M,L,re){return M=+M,L=L>>>0,re||fe(this,M,L,4,4294967295,0),this[L+3]=M>>>24,this[L+2]=M>>>16,this[L+1]=M>>>8,this[L]=M&255,L+4},d.prototype.writeUint32BE=d.prototype.writeUInt32BE=function(M,L,re){return M=+M,L=L>>>0,re||fe(this,M,L,4,4294967295,0),this[L]=M>>>24,this[L+1]=M>>>16,this[L+2]=M>>>8,this[L+3]=M&255,L+4};function I(W,M,L,re,me){tt(M,re,me,W,L,7);let Ce=Number(M&BigInt(4294967295));W[L++]=Ce,Ce=Ce>>8,W[L++]=Ce,Ce=Ce>>8,W[L++]=Ce,Ce=Ce>>8,W[L++]=Ce;let Le=Number(M>>BigInt(32)&BigInt(4294967295));return W[L++]=Le,Le=Le>>8,W[L++]=Le,Le=Le>>8,W[L++]=Le,Le=Le>>8,W[L++]=Le,L}function O(W,M,L,re,me){tt(M,re,me,W,L,7);let Ce=Number(M&BigInt(4294967295));W[L+7]=Ce,Ce=Ce>>8,W[L+6]=Ce,Ce=Ce>>8,W[L+5]=Ce,Ce=Ce>>8,W[L+4]=Ce;let Le=Number(M>>BigInt(32)&BigInt(4294967295));return W[L+3]=Le,Le=Le>>8,W[L+2]=Le,Le=Le>>8,W[L+1]=Le,Le=Le>>8,W[L]=Le,L+8}d.prototype.writeBigUInt64LE=Be(function(M,L=0){return I(this,M,L,BigInt(0),BigInt("0xffffffffffffffff"))}),d.prototype.writeBigUInt64BE=Be(function(M,L=0){return O(this,M,L,BigInt(0),BigInt("0xffffffffffffffff"))}),d.prototype.writeIntLE=function(M,L,re,me){if(M=+M,L=L>>>0,!me){const Bt=Math.pow(2,8*re-1);fe(this,M,L,re,Bt-1,-Bt)}let Ce=0,Le=1,ft=0;for(this[L]=M&255;++Ce<re&&(Le*=256);)M<0&&ft===0&&this[L+Ce-1]!==0&&(ft=1),this[L+Ce]=(M/Le>>0)-ft&255;return L+re},d.prototype.writeIntBE=function(M,L,re,me){if(M=+M,L=L>>>0,!me){const Bt=Math.pow(2,8*re-1);fe(this,M,L,re,Bt-1,-Bt)}let Ce=re-1,Le=1,ft=0;for(this[L+Ce]=M&255;--Ce>=0&&(Le*=256);)M<0&&ft===0&&this[L+Ce+1]!==0&&(ft=1),this[L+Ce]=(M/Le>>0)-ft&255;return L+re},d.prototype.writeInt8=function(M,L,re){return M=+M,L=L>>>0,re||fe(this,M,L,1,127,-128),M<0&&(M=255+M+1),this[L]=M&255,L+1},d.prototype.writeInt16LE=function(M,L,re){return M=+M,L=L>>>0,re||fe(this,M,L,2,32767,-32768),this[L]=M&255,this[L+1]=M>>>8,L+2},d.prototype.writeInt16BE=function(M,L,re){return M=+M,L=L>>>0,re||fe(this,M,L,2,32767,-32768),this[L]=M>>>8,this[L+1]=M&255,L+2},d.prototype.writeInt32LE=function(M,L,re){return M=+M,L=L>>>0,re||fe(this,M,L,4,2147483647,-2147483648),this[L]=M&255,this[L+1]=M>>>8,this[L+2]=M>>>16,this[L+3]=M>>>24,L+4},d.prototype.writeInt32BE=function(M,L,re){return M=+M,L=L>>>0,re||fe(this,M,L,4,2147483647,-2147483648),M<0&&(M=4294967295+M+1),this[L]=M>>>24,this[L+1]=M>>>16,this[L+2]=M>>>8,this[L+3]=M&255,L+4},d.prototype.writeBigInt64LE=Be(function(M,L=0){return I(this,M,L,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),d.prototype.writeBigInt64BE=Be(function(M,L=0){return O(this,M,L,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function J(W,M,L,re,me,Ce){if(L+re>W.length)throw new RangeError("Index out of range");if(L<0)throw new RangeError("Index out of range")}function X(W,M,L,re,me){return M=+M,L=L>>>0,me||J(W,M,L,4),t.write(W,M,L,re,23,4),L+4}d.prototype.writeFloatLE=function(M,L,re){return X(this,M,L,!0,re)},d.prototype.writeFloatBE=function(M,L,re){return X(this,M,L,!1,re)};function ue(W,M,L,re,me){return M=+M,L=L>>>0,me||J(W,M,L,8),t.write(W,M,L,re,52,8),L+8}d.prototype.writeDoubleLE=function(M,L,re){return ue(this,M,L,!0,re)},d.prototype.writeDoubleBE=function(M,L,re){return ue(this,M,L,!1,re)},d.prototype.copy=function(M,L,re,me){if(!d.isBuffer(M))throw new TypeError("argument should be a Buffer");if(re||(re=0),!me&&me!==0&&(me=this.length),L>=M.length&&(L=M.length),L||(L=0),me>0&&me<re&&(me=re),me===re||M.length===0||this.length===0)return 0;if(L<0)throw new RangeError("targetStart out of bounds");if(re<0||re>=this.length)throw new RangeError("Index out of range");if(me<0)throw new RangeError("sourceEnd out of bounds");me>this.length&&(me=this.length),M.length-L<me-re&&(me=M.length-L+re);const Ce=me-re;return this===M&&typeof a.prototype.copyWithin=="function"?this.copyWithin(L,re,me):a.prototype.set.call(M,this.subarray(re,me),L),Ce},d.prototype.fill=function(M,L,re,me){if(typeof M=="string"){if(typeof L=="string"?(me=L,L=0,re=this.length):typeof re=="string"&&(me=re,re=this.length),me!==void 0&&typeof me!="string")throw new TypeError("encoding must be a string");if(typeof me=="string"&&!d.isEncoding(me))throw new TypeError("Unknown encoding: "+me);if(M.length===1){const Le=M.charCodeAt(0);(me==="utf8"&&Le<128||me==="latin1")&&(M=Le)}}else typeof M=="number"?M=M&255:typeof M=="boolean"&&(M=Number(M));if(L<0||this.length<L||this.length<re)throw new RangeError("Out of range index");if(re<=L)return this;L=L>>>0,re=re===void 0?this.length:re>>>0,M||(M=0);let Ce;if(typeof M=="number")for(Ce=L;Ce<re;++Ce)this[Ce]=M;else{const Le=d.isBuffer(M)?M:d.from(M,me),ft=Le.length;if(ft===0)throw new TypeError('The value "'+M+'" is invalid for argument "value"');for(Ce=0;Ce<re-L;++Ce)this[Ce+L]=Le[Ce%ft]}return this};const V={};function K(W,M,L){V[W]=class extends L{constructor(){super(),Object.defineProperty(this,"message",{value:M.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${W}]`,this.stack,delete this.name}get code(){return W}set code(me){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:me,writable:!0})}toString(){return`${this.name} [${W}]: ${this.message}`}}}K("ERR_BUFFER_OUT_OF_BOUNDS",function(W){return W?`${W} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),K("ERR_INVALID_ARG_TYPE",function(W,M){return`The "${W}" argument must be of type number. Received type ${typeof M}`},TypeError),K("ERR_OUT_OF_RANGE",function(W,M,L){let re=`The value of "${W}" is out of range.`,me=L;return Number.isInteger(L)&&Math.abs(L)>2**32?me=_e(String(L)):typeof L=="bigint"&&(me=String(L),(L>BigInt(2)**BigInt(32)||L<-(BigInt(2)**BigInt(32)))&&(me=_e(me)),me+="n"),re+=` It must be ${M}. Received ${me}`,re},RangeError);function _e(W){let M="",L=W.length;const re=W[0]==="-"?1:0;for(;L>=re+4;L-=3)M=`_${W.slice(L-3,L)}${M}`;return`${W.slice(0,L)}${M}`}function Me(W,M,L){je(M,"offset"),(W[M]===void 0||W[M+L]===void 0)&&We(M,W.length-(L+1))}function tt(W,M,L,re,me,Ce){if(W>L||W<M){const Le=typeof M=="bigint"?"n":"";let ft;throw M===0||M===BigInt(0)?ft=`>= 0${Le} and < 2${Le} ** ${(Ce+1)*8}${Le}`:ft=`>= -(2${Le} ** ${(Ce+1)*8-1}${Le}) and < 2 ** ${(Ce+1)*8-1}${Le}`,new V.ERR_OUT_OF_RANGE("value",ft,W)}Me(re,me,Ce)}function je(W,M){if(typeof W!="number")throw new V.ERR_INVALID_ARG_TYPE(M,"number",W)}function We(W,M,L){throw Math.floor(W)!==W?(je(W,L),new V.ERR_OUT_OF_RANGE("offset","an integer",W)):M<0?new V.ERR_BUFFER_OUT_OF_BOUNDS:new V.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${M}`,W)}const Ot=/[^+/0-9A-Za-z-_]/g;function Pe(W){if(W=W.split("=")[0],W=W.trim().replace(Ot,""),W.length<2)return"";for(;W.length%4!==0;)W=W+"=";return W}function He(W,M){M=M||1/0;let L;const re=W.length;let me=null;const Ce=[];for(let Le=0;Le<re;++Le){if(L=W.charCodeAt(Le),L>55295&&L<57344){if(!me){if(L>56319){(M-=3)>-1&&Ce.push(239,191,189);continue}else if(Le+1===re){(M-=3)>-1&&Ce.push(239,191,189);continue}me=L;continue}if(L<56320){(M-=3)>-1&&Ce.push(239,191,189),me=L;continue}L=(me-55296<<10|L-56320)+65536}else me&&(M-=3)>-1&&Ce.push(239,191,189);if(me=null,L<128){if((M-=1)<0)break;Ce.push(L)}else if(L<2048){if((M-=2)<0)break;Ce.push(L>>6|192,L&63|128)}else if(L<65536){if((M-=3)<0)break;Ce.push(L>>12|224,L>>6&63|128,L&63|128)}else if(L<1114112){if((M-=4)<0)break;Ce.push(L>>18|240,L>>12&63|128,L>>6&63|128,L&63|128)}else throw new Error("Invalid code point")}return Ce}function At(W){const M=[];for(let L=0;L<W.length;++L)M.push(W.charCodeAt(L)&255);return M}function Ge(W,M){let L,re,me;const Ce=[];for(let Le=0;Le<W.length&&!((M-=2)<0);++Le)L=W.charCodeAt(Le),re=L>>8,me=L%256,Ce.push(me),Ce.push(re);return Ce}function ze(W){return e.toByteArray(Pe(W))}function it(W,M,L,re){let me;for(me=0;me<re&&!(me+L>=M.length||me>=W.length);++me)M[me+L]=W[me];return me}function Ze(W,M){return W instanceof M||W!=null&&W.constructor!=null&&W.constructor.name!=null&&W.constructor.name===M.name}function he(W){return W!==W}const Ie=function(){const W="0123456789abcdef",M=new Array(256);for(let L=0;L<16;++L){const re=L*16;for(let me=0;me<16;++me)M[re+me]=W[L]+W[me]}return M}();function Be(W){return typeof BigInt>"u"?nt:W}function nt(){throw new Error("BigInt not supported")}})(Eq);const Yu=Eq.Buffer;var g1,c4;function Dse(){return c4||(c4=1,g1=/^#!(.*)/),g1}var y1,f4;function $se(){if(f4)return y1;f4=1;const n=Dse();return y1=(e="")=>{const t=e.match(n);if(!t)return null;const[r,i]=t[0].replace(/#! ?/,"").split(" "),a=r.split("/").pop();return a==="env"?i:i?`${a} ${i}`:a},y1}var v1,d4;function Lse(){if(d4)return v1;d4=1;const n=Jb,e=$se();function t(r){const a=Yu.alloc(150);let s;try{s=n.openSync(r,"r"),n.readSync(s,a,0,150,0),n.closeSync(s)}catch{}return e(a.toString())}return v1=t,v1}var _1,h4;function Use(){if(h4)return _1;h4=1;var n={};const e=eP(),t=Ase(),r=Cse(),i=Lse(),a=ot.platform==="win32",s=/\.(?:com|exe)$/i,o=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function u(h){h.file=t(h);const m=h.file&&i(h.file);return m?(h.args.unshift(h.file),h.command=m,t(h)):h.file}function c(h){if(!a)return h;const m=u(h),g=!s.test(m);if(h.options.forceShell||g){const _=o.test(m);h.command=e.normalize(h.command),h.command=r.command(h.command),h.args=h.args.map(S=>r.argument(S,_));const w=[h.command].concat(h.args).join(" ");h.args=["/d","/s","/c",`"${w}"`],h.command=n.comspec||"cmd.exe",h.options.windowsVerbatimArguments=!0}return h}function d(h,m,g){m&&!Array.isArray(m)&&(g=m,m=null),m=m?m.slice(0):[],g=Object.assign({},g);const _={command:h,args:m,options:g,file:void 0,original:{command:h,args:m}};return g.shell?_:c(_)}return _1=d,_1}var b1,p4;function jse(){if(p4)return b1;p4=1;const n=ot.platform==="win32";function e(a,s){return Object.assign(new Error(`${s} ${a.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${s} ${a.command}`,path:a.command,spawnargs:a.args})}function t(a,s){if(!n)return;const o=a.emit;a.emit=function(u,c){if(u==="exit"){const d=r(c,s);if(d)return o.call(a,"error",d)}return o.apply(a,arguments)}}function r(a,s){return n&&a===1&&!s.file?e(s.original,"spawn"):null}function i(a,s){return n&&a===1&&!s.file?e(s.original,"spawnSync"):null}return b1={hookChildProcess:t,verifyENOENT:r,verifyENOENTSync:i,notFoundError:e},b1}var m4;function Fse(){if(m4)return Ou.exports;m4=1;const n=Jb,e=Use(),t=jse();function r(a,s,o){const u=e(a,s,o),c=n.spawn(u.command,u.args,u.options);return t.hookChildProcess(c,u),c}function i(a,s,o){const u=e(a,s,o),c=n.spawnSync(u.command,u.args,u.options);return c.error=c.error||t.verifyENOENTSync(c.status,u),c}return Ou.exports=r,Ou.exports.spawn=r,Ou.exports.sync=i,Ou.exports._parse=e,Ou.exports._enoent=t,Ou.exports}var Bse=Fse();const qse=Za(Bse);var Gy={exports:{}},g4;function nP(){if(g4)return Gy.exports;g4=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(P,N,U){return Function.prototype.apply.call(P,N,U)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(P){return Object.getOwnPropertyNames(P).concat(Object.getOwnPropertySymbols(P))}:t=function(P){return Object.getOwnPropertyNames(P)};function r(R){console&&console.warn&&console.warn(R)}var i=Number.isNaN||function(P){return P!==P};function a(){a.init.call(this)}Gy.exports=a,Gy.exports.once=E,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var s=10;function o(R){if(typeof R!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof R)}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(R){if(typeof R!="number"||R<0||i(R))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+R+".");s=R}}),a.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(P){if(typeof P!="number"||P<0||i(P))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+P+".");return this._maxListeners=P,this};function u(R){return R._maxListeners===void 0?a.defaultMaxListeners:R._maxListeners}a.prototype.getMaxListeners=function(){return u(this)},a.prototype.emit=function(P){for(var N=[],U=1;U<arguments.length;U++)N.push(arguments[U]);var k=P==="error",B=this._events;if(B!==void 0)k=k&&B.error===void 0;else if(!k)return!1;if(k){var H;if(N.length>0&&(H=N[0]),H instanceof Error)throw H;var G=new Error("Unhandled error."+(H?" ("+H.message+")":""));throw G.context=H,G}var z=B[P];if(z===void 0)return!1;if(typeof z=="function")e(z,this,N);else for(var oe=z.length,te=_(z,oe),U=0;U<oe;++U)e(te[U],this,N);return!0};function c(R,P,N,U){var k,B,H;if(o(N),B=R._events,B===void 0?(B=R._events=Object.create(null),R._eventsCount=0):(B.newListener!==void 0&&(R.emit("newListener",P,N.listener?N.listener:N),B=R._events),H=B[P]),H===void 0)H=B[P]=N,++R._eventsCount;else if(typeof H=="function"?H=B[P]=U?[N,H]:[H,N]:U?H.unshift(N):H.push(N),k=u(R),k>0&&H.length>k&&!H.warned){H.warned=!0;var G=new Error("Possible EventEmitter memory leak detected. "+H.length+" "+String(P)+" listeners added. Use emitter.setMaxListeners() to increase limit");G.name="MaxListenersExceededWarning",G.emitter=R,G.type=P,G.count=H.length,r(G)}return R}a.prototype.addListener=function(P,N){return c(this,P,N,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(P,N){return c(this,P,N,!0)};function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(R,P,N){var U={fired:!1,wrapFn:void 0,target:R,type:P,listener:N},k=d.bind(U);return k.listener=N,U.wrapFn=k,k}a.prototype.once=function(P,N){return o(N),this.on(P,h(this,P,N)),this},a.prototype.prependOnceListener=function(P,N){return o(N),this.prependListener(P,h(this,P,N)),this},a.prototype.removeListener=function(P,N){var U,k,B,H,G;if(o(N),k=this._events,k===void 0)return this;if(U=k[P],U===void 0)return this;if(U===N||U.listener===N)--this._eventsCount===0?this._events=Object.create(null):(delete k[P],k.removeListener&&this.emit("removeListener",P,U.listener||N));else if(typeof U!="function"){for(B=-1,H=U.length-1;H>=0;H--)if(U[H]===N||U[H].listener===N){G=U[H].listener,B=H;break}if(B<0)return this;B===0?U.shift():w(U,B),U.length===1&&(k[P]=U[0]),k.removeListener!==void 0&&this.emit("removeListener",P,G||N)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(P){var N,U,k;if(U=this._events,U===void 0)return this;if(U.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):U[P]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete U[P]),this;if(arguments.length===0){var B=Object.keys(U),H;for(k=0;k<B.length;++k)H=B[k],H!=="removeListener"&&this.removeAllListeners(H);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(N=U[P],typeof N=="function")this.removeListener(P,N);else if(N!==void 0)for(k=N.length-1;k>=0;k--)this.removeListener(P,N[k]);return this};function m(R,P,N){var U=R._events;if(U===void 0)return[];var k=U[P];return k===void 0?[]:typeof k=="function"?N?[k.listener||k]:[k]:N?S(k):_(k,k.length)}a.prototype.listeners=function(P){return m(this,P,!0)},a.prototype.rawListeners=function(P){return m(this,P,!1)},a.listenerCount=function(R,P){return typeof R.listenerCount=="function"?R.listenerCount(P):g.call(R,P)},a.prototype.listenerCount=g;function g(R){var P=this._events;if(P!==void 0){var N=P[R];if(typeof N=="function")return 1;if(N!==void 0)return N.length}return 0}a.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function _(R,P){for(var N=new Array(P),U=0;U<P;++U)N[U]=R[U];return N}function w(R,P){for(;P+1<R.length;P++)R[P]=R[P+1];R.pop()}function S(R){for(var P=new Array(R.length),N=0;N<P.length;++N)P[N]=R[N].listener||R[N];return P}function E(R,P){return new Promise(function(N,U){function k(H){R.removeListener(P,B),U(H)}function B(){typeof R.removeListener=="function"&&R.removeListener("error",k),N([].slice.call(arguments))}A(R,P,B,{once:!0}),P!=="error"&&C(R,k,{once:!0})})}function C(R,P,N){typeof R.on=="function"&&A(R,"error",P,N)}function A(R,P,N,U){if(typeof R.on=="function")U.once?R.once(P,N):R.on(P,N);else if(typeof R.addEventListener=="function")R.addEventListener(P,function k(B){U.once&&R.removeEventListener(P,k),N(B)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof R)}return Gy.exports}var Wy={exports:{}},y4;function Oc(){return y4||(y4=1,typeof Object.create=="function"?Wy.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:Wy.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}),Wy.exports}var w1,v4;function Tq(){return v4||(v4=1,w1=nP().EventEmitter),w1}var E1={},_4;function Zb(){return _4||(_4=1,function(n){Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var e={},t={};t.byteLength=d,t.toByteArray=m,t.fromByteArray=w;for(var r=[],i=[],a=typeof Uint8Array<"u"?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,u=s.length;o<u;++o)r[o]=s[o],i[s.charCodeAt(o)]=o;i[45]=62,i[95]=63;function c(C){var A=C.length;if(A%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var R=C.indexOf("=");R===-1&&(R=A);var P=R===A?0:4-R%4;return[R,P]}function d(C){var A=c(C),R=A[0],P=A[1];return(R+P)*3/4-P}function h(C,A,R){return(A+R)*3/4-R}function m(C){var A,R=c(C),P=R[0],N=R[1],U=new a(h(C,P,N)),k=0,B=N>0?P-4:P,H;for(H=0;H<B;H+=4)A=i[C.charCodeAt(H)]<<18|i[C.charCodeAt(H+1)]<<12|i[C.charCodeAt(H+2)]<<6|i[C.charCodeAt(H+3)],U[k++]=A>>16&255,U[k++]=A>>8&255,U[k++]=A&255;return N===2&&(A=i[C.charCodeAt(H)]<<2|i[C.charCodeAt(H+1)]>>4,U[k++]=A&255),N===1&&(A=i[C.charCodeAt(H)]<<10|i[C.charCodeAt(H+1)]<<4|i[C.charCodeAt(H+2)]>>2,U[k++]=A>>8&255,U[k++]=A&255),U}function g(C){return r[C>>18&63]+r[C>>12&63]+r[C>>6&63]+r[C&63]}function _(C,A,R){for(var P,N=[],U=A;U<R;U+=3)P=(C[U]<<16&16711680)+(C[U+1]<<8&65280)+(C[U+2]&255),N.push(g(P));return N.join("")}function w(C){for(var A,R=C.length,P=R%3,N=[],U=16383,k=0,B=R-P;k<B;k+=U)N.push(_(C,k,k+U>B?B:k+U));return P===1?(A=C[R-1],N.push(r[A>>2]+r[A<<4&63]+"==")):P===2&&(A=(C[R-2]<<8)+C[R-1],N.push(r[A>>10]+r[A>>4&63]+r[A<<2&63]+"=")),N.join("")}var S={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */S.read=function(C,A,R,P,N){var U,k,B=N*8-P-1,H=(1<<B)-1,G=H>>1,z=-7,oe=R?N-1:0,te=R?-1:1,se=C[A+oe];for(oe+=te,U=se&(1<<-z)-1,se>>=-z,z+=B;z>0;U=U*256+C[A+oe],oe+=te,z-=8);for(k=U&(1<<-z)-1,U>>=-z,z+=P;z>0;k=k*256+C[A+oe],oe+=te,z-=8);if(U===0)U=1-G;else{if(U===H)return k?NaN:(se?-1:1)*(1/0);k=k+Math.pow(2,P),U=U-G}return(se?-1:1)*k*Math.pow(2,U-P)},S.write=function(C,A,R,P,N,U){var k,B,H,G=U*8-N-1,z=(1<<G)-1,oe=z>>1,te=N===23?Math.pow(2,-24)-Math.pow(2,-77):0,se=P?0:U-1,ee=P?1:-1,le=A<0||A===0&&1/A<0?1:0;for(A=Math.abs(A),isNaN(A)||A===1/0?(B=isNaN(A)?1:0,k=z):(k=Math.floor(Math.log(A)/Math.LN2),A*(H=Math.pow(2,-k))<1&&(k--,H*=2),k+oe>=1?A+=te/H:A+=te*Math.pow(2,1-oe),A*H>=2&&(k++,H/=2),k+oe>=z?(B=0,k=z):k+oe>=1?(B=(A*H-1)*Math.pow(2,N),k=k+oe):(B=A*Math.pow(2,oe-1)*Math.pow(2,N),k=0));N>=8;C[R+se]=B&255,se+=ee,B/=256,N-=8);for(k=k<<N|B,G+=N;G>0;C[R+se]=k&255,se+=ee,k/=256,G-=8);C[R+se-ee]|=le*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(C){const A=t,R=S,P=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;C.Buffer=z,C.SlowBuffer=F,C.INSPECT_MAX_BYTES=50;const N=2147483647;C.kMaxLength=N;const{Uint8Array:U,ArrayBuffer:k,SharedArrayBuffer:B}=globalThis;z.TYPED_ARRAY_SUPPORT=H(),!z.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function H(){try{const Y=new U(1),D={foo:function(){return 42}};return Object.setPrototypeOf(D,U.prototype),Object.setPrototypeOf(Y,D),Y.foo()===42}catch{return!1}}Object.defineProperty(z.prototype,"parent",{enumerable:!0,get:function(){if(z.isBuffer(this))return this.buffer}}),Object.defineProperty(z.prototype,"offset",{enumerable:!0,get:function(){if(z.isBuffer(this))return this.byteOffset}});function G(Y){if(Y>N)throw new RangeError('The value "'+Y+'" is invalid for option "size"');const D=new U(Y);return Object.setPrototypeOf(D,z.prototype),D}function z(Y,D,j){if(typeof Y=="number"){if(typeof D=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return ee(Y)}return oe(Y,D,j)}z.poolSize=8192;function oe(Y,D,j){if(typeof Y=="string")return le(Y,D);if(k.isView(Y))return we(Y);if(Y==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Y);if(Ai(Y,k)||Y&&Ai(Y.buffer,k)||typeof B<"u"&&(Ai(Y,B)||Y&&Ai(Y.buffer,B)))return $(Y,D,j);if(typeof Y=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const ie=Y.valueOf&&Y.valueOf();if(ie!=null&&ie!==Y)return z.from(ie,D,j);const ge=ve(Y);if(ge)return ge;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof Y[Symbol.toPrimitive]=="function")return z.from(Y[Symbol.toPrimitive]("string"),D,j);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof Y)}z.from=function(Y,D,j){return oe(Y,D,j)},Object.setPrototypeOf(z.prototype,U.prototype),Object.setPrototypeOf(z,U);function te(Y){if(typeof Y!="number")throw new TypeError('"size" argument must be of type number');if(Y<0)throw new RangeError('The value "'+Y+'" is invalid for option "size"')}function se(Y,D,j){return te(Y),Y<=0?G(Y):D!==void 0?typeof j=="string"?G(Y).fill(D,j):G(Y).fill(D):G(Y)}z.alloc=function(Y,D,j){return se(Y,D,j)};function ee(Y){return te(Y),G(Y<0?0:Te(Y)|0)}z.allocUnsafe=function(Y){return ee(Y)},z.allocUnsafeSlow=function(Y){return ee(Y)};function le(Y,D){if((typeof D!="string"||D==="")&&(D="utf8"),!z.isEncoding(D))throw new TypeError("Unknown encoding: "+D);const j=ae(Y,D)|0;let ie=G(j);const ge=ie.write(Y,D);return ge!==j&&(ie=ie.slice(0,ge)),ie}function pe(Y){const D=Y.length<0?0:Te(Y.length)|0,j=G(D);for(let ie=0;ie<D;ie+=1)j[ie]=Y[ie]&255;return j}function we(Y){if(Ai(Y,U)){const D=new U(Y);return $(D.buffer,D.byteOffset,D.byteLength)}return pe(Y)}function $(Y,D,j){if(D<0||Y.byteLength<D)throw new RangeError('"offset" is outside of buffer bounds');if(Y.byteLength<D+(j||0))throw new RangeError('"length" is outside of buffer bounds');let ie;return D===void 0&&j===void 0?ie=new U(Y):j===void 0?ie=new U(Y,D):ie=new U(Y,D,j),Object.setPrototypeOf(ie,z.prototype),ie}function ve(Y){if(z.isBuffer(Y)){const D=Te(Y.length)|0,j=G(D);return j.length===0||Y.copy(j,0,0,D),j}if(Y.length!==void 0)return typeof Y.length!="number"||Qi(Y.length)?G(0):pe(Y);if(Y.type==="Buffer"&&Array.isArray(Y.data))return pe(Y.data)}function Te(Y){if(Y>=N)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+N.toString(16)+" bytes");return Y|0}function F(Y){return+Y!=Y&&(Y=0),z.alloc(+Y)}z.isBuffer=function(D){return D!=null&&D._isBuffer===!0&&D!==z.prototype},z.compare=function(D,j){if(Ai(D,U)&&(D=z.from(D,D.offset,D.byteLength)),Ai(j,U)&&(j=z.from(j,j.offset,j.byteLength)),!z.isBuffer(D)||!z.isBuffer(j))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(D===j)return 0;let ie=D.length,ge=j.length;for(let Oe=0,Q=Math.min(ie,ge);Oe<Q;++Oe)if(D[Oe]!==j[Oe]){ie=D[Oe],ge=j[Oe];break}return ie<ge?-1:ge<ie?1:0},z.isEncoding=function(D){switch(String(D).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},z.concat=function(D,j){if(!Array.isArray(D))throw new TypeError('"list" argument must be an Array of Buffers');if(D.length===0)return z.alloc(0);let ie;if(j===void 0)for(j=0,ie=0;ie<D.length;++ie)j+=D[ie].length;const ge=z.allocUnsafe(j);let Oe=0;for(ie=0;ie<D.length;++ie){let Q=D[ie];if(Ai(Q,U))Oe+Q.length>ge.length?(z.isBuffer(Q)||(Q=z.from(Q)),Q.copy(ge,Oe)):U.prototype.set.call(ge,Q,Oe);else if(z.isBuffer(Q))Q.copy(ge,Oe);else throw new TypeError('"list" argument must be an Array of Buffers');Oe+=Q.length}return ge};function ae(Y,D){if(z.isBuffer(Y))return Y.length;if(k.isView(Y)||Ai(Y,k))return Y.byteLength;if(typeof Y!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof Y);const j=Y.length,ie=arguments.length>2&&arguments[2]===!0;if(!ie&&j===0)return 0;let ge=!1;for(;;)switch(D){case"ascii":case"latin1":case"binary":return j;case"utf8":case"utf-8":return Bt(Y).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return j*2;case"hex":return j>>>1;case"base64":return Xt(Y).length;default:if(ge)return ie?-1:Bt(Y).length;D=(""+D).toLowerCase(),ge=!0}}z.byteLength=ae;function fe(Y,D,j){let ie=!1;if((D===void 0||D<0)&&(D=0),D>this.length||((j===void 0||j>this.length)&&(j=this.length),j<=0)||(j>>>=0,D>>>=0,j<=D))return"";for(Y||(Y="utf8");;)switch(Y){case"hex":return He(this,D,j);case"utf8":case"utf-8":return tt(this,D,j);case"ascii":return Ot(this,D,j);case"latin1":case"binary":return Pe(this,D,j);case"base64":return Me(this,D,j);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return At(this,D,j);default:if(ie)throw new TypeError("Unknown encoding: "+Y);Y=(Y+"").toLowerCase(),ie=!0}}z.prototype._isBuffer=!0;function I(Y,D,j){const ie=Y[D];Y[D]=Y[j],Y[j]=ie}z.prototype.swap16=function(){const D=this.length;if(D%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let j=0;j<D;j+=2)I(this,j,j+1);return this},z.prototype.swap32=function(){const D=this.length;if(D%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let j=0;j<D;j+=4)I(this,j,j+3),I(this,j+1,j+2);return this},z.prototype.swap64=function(){const D=this.length;if(D%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let j=0;j<D;j+=8)I(this,j,j+7),I(this,j+1,j+6),I(this,j+2,j+5),I(this,j+3,j+4);return this},z.prototype.toString=function(){const D=this.length;return D===0?"":arguments.length===0?tt(this,0,D):fe.apply(this,arguments)},z.prototype.toLocaleString=z.prototype.toString,z.prototype.equals=function(D){if(!z.isBuffer(D))throw new TypeError("Argument must be a Buffer");return this===D?!0:z.compare(this,D)===0},z.prototype.inspect=function(){let D="";const j=C.INSPECT_MAX_BYTES;return D=this.toString("hex",0,j).replace(/(.{2})/g,"$1 ").trim(),this.length>j&&(D+=" ... "),"<Buffer "+D+">"},P&&(z.prototype[P]=z.prototype.inspect),z.prototype.compare=function(D,j,ie,ge,Oe){if(Ai(D,U)&&(D=z.from(D,D.offset,D.byteLength)),!z.isBuffer(D))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof D);if(j===void 0&&(j=0),ie===void 0&&(ie=D?D.length:0),ge===void 0&&(ge=0),Oe===void 0&&(Oe=this.length),j<0||ie>D.length||ge<0||Oe>this.length)throw new RangeError("out of range index");if(ge>=Oe&&j>=ie)return 0;if(ge>=Oe)return-1;if(j>=ie)return 1;if(j>>>=0,ie>>>=0,ge>>>=0,Oe>>>=0,this===D)return 0;let Q=Oe-ge,ne=ie-j;const de=Math.min(Q,ne),Se=this.slice(ge,Oe),Ee=D.slice(j,ie);for(let et=0;et<de;++et)if(Se[et]!==Ee[et]){Q=Se[et],ne=Ee[et];break}return Q<ne?-1:ne<Q?1:0};function O(Y,D,j,ie,ge){if(Y.length===0)return-1;if(typeof j=="string"?(ie=j,j=0):j>2147483647?j=2147483647:j<-2147483648&&(j=-2147483648),j=+j,Qi(j)&&(j=ge?0:Y.length-1),j<0&&(j=Y.length+j),j>=Y.length){if(ge)return-1;j=Y.length-1}else if(j<0)if(ge)j=0;else return-1;if(typeof D=="string"&&(D=z.from(D,ie)),z.isBuffer(D))return D.length===0?-1:J(Y,D,j,ie,ge);if(typeof D=="number")return D=D&255,typeof U.prototype.indexOf=="function"?ge?U.prototype.indexOf.call(Y,D,j):U.prototype.lastIndexOf.call(Y,D,j):J(Y,[D],j,ie,ge);throw new TypeError("val must be string, number or Buffer")}function J(Y,D,j,ie,ge){let Oe=1,Q=Y.length,ne=D.length;if(ie!==void 0&&(ie=String(ie).toLowerCase(),ie==="ucs2"||ie==="ucs-2"||ie==="utf16le"||ie==="utf-16le")){if(Y.length<2||D.length<2)return-1;Oe=2,Q/=2,ne/=2,j/=2}function de(Ee,et){return Oe===1?Ee[et]:Ee.readUInt16BE(et*Oe)}let Se;if(ge){let Ee=-1;for(Se=j;Se<Q;Se++)if(de(Y,Se)===de(D,Ee===-1?0:Se-Ee)){if(Ee===-1&&(Ee=Se),Se-Ee+1===ne)return Ee*Oe}else Ee!==-1&&(Se-=Se-Ee),Ee=-1}else for(j+ne>Q&&(j=Q-ne),Se=j;Se>=0;Se--){let Ee=!0;for(let et=0;et<ne;et++)if(de(Y,Se+et)!==de(D,et)){Ee=!1;break}if(Ee)return Se}return-1}z.prototype.includes=function(D,j,ie){return this.indexOf(D,j,ie)!==-1},z.prototype.indexOf=function(D,j,ie){return O(this,D,j,ie,!0)},z.prototype.lastIndexOf=function(D,j,ie){return O(this,D,j,ie,!1)};function X(Y,D,j,ie){j=Number(j)||0;const ge=Y.length-j;ie?(ie=Number(ie),ie>ge&&(ie=ge)):ie=ge;const Oe=D.length;ie>Oe/2&&(ie=Oe/2);let Q;for(Q=0;Q<ie;++Q){const ne=parseInt(D.substr(Q*2,2),16);if(Qi(ne))return Q;Y[j+Q]=ne}return Q}function ue(Y,D,j,ie){return Aa(Bt(D,Y.length-j),Y,j,ie)}function V(Y,D,j,ie){return Aa(sn(D),Y,j,ie)}function K(Y,D,j,ie){return Aa(Xt(D),Y,j,ie)}function _e(Y,D,j,ie){return Aa(hn(D,Y.length-j),Y,j,ie)}z.prototype.write=function(D,j,ie,ge){if(j===void 0)ge="utf8",ie=this.length,j=0;else if(ie===void 0&&typeof j=="string")ge=j,ie=this.length,j=0;else if(isFinite(j))j=j>>>0,isFinite(ie)?(ie=ie>>>0,ge===void 0&&(ge="utf8")):(ge=ie,ie=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Oe=this.length-j;if((ie===void 0||ie>Oe)&&(ie=Oe),D.length>0&&(ie<0||j<0)||j>this.length)throw new RangeError("Attempt to write outside buffer bounds");ge||(ge="utf8");let Q=!1;for(;;)switch(ge){case"hex":return X(this,D,j,ie);case"utf8":case"utf-8":return ue(this,D,j,ie);case"ascii":case"latin1":case"binary":return V(this,D,j,ie);case"base64":return K(this,D,j,ie);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return _e(this,D,j,ie);default:if(Q)throw new TypeError("Unknown encoding: "+ge);ge=(""+ge).toLowerCase(),Q=!0}},z.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function Me(Y,D,j){return D===0&&j===Y.length?A.fromByteArray(Y):A.fromByteArray(Y.slice(D,j))}function tt(Y,D,j){j=Math.min(Y.length,j);const ie=[];let ge=D;for(;ge<j;){const Oe=Y[ge];let Q=null,ne=Oe>239?4:Oe>223?3:Oe>191?2:1;if(ge+ne<=j){let de,Se,Ee,et;switch(ne){case 1:Oe<128&&(Q=Oe);break;case 2:de=Y[ge+1],(de&192)===128&&(et=(Oe&31)<<6|de&63,et>127&&(Q=et));break;case 3:de=Y[ge+1],Se=Y[ge+2],(de&192)===128&&(Se&192)===128&&(et=(Oe&15)<<12|(de&63)<<6|Se&63,et>2047&&(et<55296||et>57343)&&(Q=et));break;case 4:de=Y[ge+1],Se=Y[ge+2],Ee=Y[ge+3],(de&192)===128&&(Se&192)===128&&(Ee&192)===128&&(et=(Oe&15)<<18|(de&63)<<12|(Se&63)<<6|Ee&63,et>65535&&et<1114112&&(Q=et))}}Q===null?(Q=65533,ne=1):Q>65535&&(Q-=65536,ie.push(Q>>>10&1023|55296),Q=56320|Q&1023),ie.push(Q),ge+=ne}return We(ie)}const je=4096;function We(Y){const D=Y.length;if(D<=je)return String.fromCharCode.apply(String,Y);let j="",ie=0;for(;ie<D;)j+=String.fromCharCode.apply(String,Y.slice(ie,ie+=je));return j}function Ot(Y,D,j){let ie="";j=Math.min(Y.length,j);for(let ge=D;ge<j;++ge)ie+=String.fromCharCode(Y[ge]&127);return ie}function Pe(Y,D,j){let ie="";j=Math.min(Y.length,j);for(let ge=D;ge<j;++ge)ie+=String.fromCharCode(Y[ge]);return ie}function He(Y,D,j){const ie=Y.length;(!D||D<0)&&(D=0),(!j||j<0||j>ie)&&(j=ie);let ge="";for(let Oe=D;Oe<j;++Oe)ge+=Lc[Y[Oe]];return ge}function At(Y,D,j){const ie=Y.slice(D,j);let ge="";for(let Oe=0;Oe<ie.length-1;Oe+=2)ge+=String.fromCharCode(ie[Oe]+ie[Oe+1]*256);return ge}z.prototype.slice=function(D,j){const ie=this.length;D=~~D,j=j===void 0?ie:~~j,D<0?(D+=ie,D<0&&(D=0)):D>ie&&(D=ie),j<0?(j+=ie,j<0&&(j=0)):j>ie&&(j=ie),j<D&&(j=D);const ge=this.subarray(D,j);return Object.setPrototypeOf(ge,z.prototype),ge};function Ge(Y,D,j){if(Y%1!==0||Y<0)throw new RangeError("offset is not uint");if(Y+D>j)throw new RangeError("Trying to access beyond buffer length")}z.prototype.readUintLE=z.prototype.readUIntLE=function(D,j,ie){D=D>>>0,j=j>>>0,ie||Ge(D,j,this.length);let ge=this[D],Oe=1,Q=0;for(;++Q<j&&(Oe*=256);)ge+=this[D+Q]*Oe;return ge},z.prototype.readUintBE=z.prototype.readUIntBE=function(D,j,ie){D=D>>>0,j=j>>>0,ie||Ge(D,j,this.length);let ge=this[D+--j],Oe=1;for(;j>0&&(Oe*=256);)ge+=this[D+--j]*Oe;return ge},z.prototype.readUint8=z.prototype.readUInt8=function(D,j){return D=D>>>0,j||Ge(D,1,this.length),this[D]},z.prototype.readUint16LE=z.prototype.readUInt16LE=function(D,j){return D=D>>>0,j||Ge(D,2,this.length),this[D]|this[D+1]<<8},z.prototype.readUint16BE=z.prototype.readUInt16BE=function(D,j){return D=D>>>0,j||Ge(D,2,this.length),this[D]<<8|this[D+1]},z.prototype.readUint32LE=z.prototype.readUInt32LE=function(D,j){return D=D>>>0,j||Ge(D,4,this.length),(this[D]|this[D+1]<<8|this[D+2]<<16)+this[D+3]*16777216},z.prototype.readUint32BE=z.prototype.readUInt32BE=function(D,j){return D=D>>>0,j||Ge(D,4,this.length),this[D]*16777216+(this[D+1]<<16|this[D+2]<<8|this[D+3])},z.prototype.readBigUInt64LE=fi(function(D){D=D>>>0,me(D,"offset");const j=this[D],ie=this[D+7];(j===void 0||ie===void 0)&&Ce(D,this.length-8);const ge=j+this[++D]*2**8+this[++D]*2**16+this[++D]*2**24,Oe=this[++D]+this[++D]*2**8+this[++D]*2**16+ie*2**24;return BigInt(ge)+(BigInt(Oe)<<BigInt(32))}),z.prototype.readBigUInt64BE=fi(function(D){D=D>>>0,me(D,"offset");const j=this[D],ie=this[D+7];(j===void 0||ie===void 0)&&Ce(D,this.length-8);const ge=j*2**24+this[++D]*2**16+this[++D]*2**8+this[++D],Oe=this[++D]*2**24+this[++D]*2**16+this[++D]*2**8+ie;return(BigInt(ge)<<BigInt(32))+BigInt(Oe)}),z.prototype.readIntLE=function(D,j,ie){D=D>>>0,j=j>>>0,ie||Ge(D,j,this.length);let ge=this[D],Oe=1,Q=0;for(;++Q<j&&(Oe*=256);)ge+=this[D+Q]*Oe;return Oe*=128,ge>=Oe&&(ge-=Math.pow(2,8*j)),ge},z.prototype.readIntBE=function(D,j,ie){D=D>>>0,j=j>>>0,ie||Ge(D,j,this.length);let ge=j,Oe=1,Q=this[D+--ge];for(;ge>0&&(Oe*=256);)Q+=this[D+--ge]*Oe;return Oe*=128,Q>=Oe&&(Q-=Math.pow(2,8*j)),Q},z.prototype.readInt8=function(D,j){return D=D>>>0,j||Ge(D,1,this.length),this[D]&128?(255-this[D]+1)*-1:this[D]},z.prototype.readInt16LE=function(D,j){D=D>>>0,j||Ge(D,2,this.length);const ie=this[D]|this[D+1]<<8;return ie&32768?ie|4294901760:ie},z.prototype.readInt16BE=function(D,j){D=D>>>0,j||Ge(D,2,this.length);const ie=this[D+1]|this[D]<<8;return ie&32768?ie|4294901760:ie},z.prototype.readInt32LE=function(D,j){return D=D>>>0,j||Ge(D,4,this.length),this[D]|this[D+1]<<8|this[D+2]<<16|this[D+3]<<24},z.prototype.readInt32BE=function(D,j){return D=D>>>0,j||Ge(D,4,this.length),this[D]<<24|this[D+1]<<16|this[D+2]<<8|this[D+3]},z.prototype.readBigInt64LE=fi(function(D){D=D>>>0,me(D,"offset");const j=this[D],ie=this[D+7];(j===void 0||ie===void 0)&&Ce(D,this.length-8);const ge=this[D+4]+this[D+5]*2**8+this[D+6]*2**16+(ie<<24);return(BigInt(ge)<<BigInt(32))+BigInt(j+this[++D]*2**8+this[++D]*2**16+this[++D]*2**24)}),z.prototype.readBigInt64BE=fi(function(D){D=D>>>0,me(D,"offset");const j=this[D],ie=this[D+7];(j===void 0||ie===void 0)&&Ce(D,this.length-8);const ge=(j<<24)+this[++D]*2**16+this[++D]*2**8+this[++D];return(BigInt(ge)<<BigInt(32))+BigInt(this[++D]*2**24+this[++D]*2**16+this[++D]*2**8+ie)}),z.prototype.readFloatLE=function(D,j){return D=D>>>0,j||Ge(D,4,this.length),R.read(this,D,!0,23,4)},z.prototype.readFloatBE=function(D,j){return D=D>>>0,j||Ge(D,4,this.length),R.read(this,D,!1,23,4)},z.prototype.readDoubleLE=function(D,j){return D=D>>>0,j||Ge(D,8,this.length),R.read(this,D,!0,52,8)},z.prototype.readDoubleBE=function(D,j){return D=D>>>0,j||Ge(D,8,this.length),R.read(this,D,!1,52,8)};function ze(Y,D,j,ie,ge,Oe){if(!z.isBuffer(Y))throw new TypeError('"buffer" argument must be a Buffer instance');if(D>ge||D<Oe)throw new RangeError('"value" argument is out of bounds');if(j+ie>Y.length)throw new RangeError("Index out of range")}z.prototype.writeUintLE=z.prototype.writeUIntLE=function(D,j,ie,ge){if(D=+D,j=j>>>0,ie=ie>>>0,!ge){const ne=Math.pow(2,8*ie)-1;ze(this,D,j,ie,ne,0)}let Oe=1,Q=0;for(this[j]=D&255;++Q<ie&&(Oe*=256);)this[j+Q]=D/Oe&255;return j+ie},z.prototype.writeUintBE=z.prototype.writeUIntBE=function(D,j,ie,ge){if(D=+D,j=j>>>0,ie=ie>>>0,!ge){const ne=Math.pow(2,8*ie)-1;ze(this,D,j,ie,ne,0)}let Oe=ie-1,Q=1;for(this[j+Oe]=D&255;--Oe>=0&&(Q*=256);)this[j+Oe]=D/Q&255;return j+ie},z.prototype.writeUint8=z.prototype.writeUInt8=function(D,j,ie){return D=+D,j=j>>>0,ie||ze(this,D,j,1,255,0),this[j]=D&255,j+1},z.prototype.writeUint16LE=z.prototype.writeUInt16LE=function(D,j,ie){return D=+D,j=j>>>0,ie||ze(this,D,j,2,65535,0),this[j]=D&255,this[j+1]=D>>>8,j+2},z.prototype.writeUint16BE=z.prototype.writeUInt16BE=function(D,j,ie){return D=+D,j=j>>>0,ie||ze(this,D,j,2,65535,0),this[j]=D>>>8,this[j+1]=D&255,j+2},z.prototype.writeUint32LE=z.prototype.writeUInt32LE=function(D,j,ie){return D=+D,j=j>>>0,ie||ze(this,D,j,4,4294967295,0),this[j+3]=D>>>24,this[j+2]=D>>>16,this[j+1]=D>>>8,this[j]=D&255,j+4},z.prototype.writeUint32BE=z.prototype.writeUInt32BE=function(D,j,ie){return D=+D,j=j>>>0,ie||ze(this,D,j,4,4294967295,0),this[j]=D>>>24,this[j+1]=D>>>16,this[j+2]=D>>>8,this[j+3]=D&255,j+4};function it(Y,D,j,ie,ge){re(D,ie,ge,Y,j,7);let Oe=Number(D&BigInt(4294967295));Y[j++]=Oe,Oe=Oe>>8,Y[j++]=Oe,Oe=Oe>>8,Y[j++]=Oe,Oe=Oe>>8,Y[j++]=Oe;let Q=Number(D>>BigInt(32)&BigInt(4294967295));return Y[j++]=Q,Q=Q>>8,Y[j++]=Q,Q=Q>>8,Y[j++]=Q,Q=Q>>8,Y[j++]=Q,j}function Ze(Y,D,j,ie,ge){re(D,ie,ge,Y,j,7);let Oe=Number(D&BigInt(4294967295));Y[j+7]=Oe,Oe=Oe>>8,Y[j+6]=Oe,Oe=Oe>>8,Y[j+5]=Oe,Oe=Oe>>8,Y[j+4]=Oe;let Q=Number(D>>BigInt(32)&BigInt(4294967295));return Y[j+3]=Q,Q=Q>>8,Y[j+2]=Q,Q=Q>>8,Y[j+1]=Q,Q=Q>>8,Y[j]=Q,j+8}z.prototype.writeBigUInt64LE=fi(function(D,j=0){return it(this,D,j,BigInt(0),BigInt("0xffffffffffffffff"))}),z.prototype.writeBigUInt64BE=fi(function(D,j=0){return Ze(this,D,j,BigInt(0),BigInt("0xffffffffffffffff"))}),z.prototype.writeIntLE=function(D,j,ie,ge){if(D=+D,j=j>>>0,!ge){const de=Math.pow(2,8*ie-1);ze(this,D,j,ie,de-1,-de)}let Oe=0,Q=1,ne=0;for(this[j]=D&255;++Oe<ie&&(Q*=256);)D<0&&ne===0&&this[j+Oe-1]!==0&&(ne=1),this[j+Oe]=(D/Q>>0)-ne&255;return j+ie},z.prototype.writeIntBE=function(D,j,ie,ge){if(D=+D,j=j>>>0,!ge){const de=Math.pow(2,8*ie-1);ze(this,D,j,ie,de-1,-de)}let Oe=ie-1,Q=1,ne=0;for(this[j+Oe]=D&255;--Oe>=0&&(Q*=256);)D<0&&ne===0&&this[j+Oe+1]!==0&&(ne=1),this[j+Oe]=(D/Q>>0)-ne&255;return j+ie},z.prototype.writeInt8=function(D,j,ie){return D=+D,j=j>>>0,ie||ze(this,D,j,1,127,-128),D<0&&(D=255+D+1),this[j]=D&255,j+1},z.prototype.writeInt16LE=function(D,j,ie){return D=+D,j=j>>>0,ie||ze(this,D,j,2,32767,-32768),this[j]=D&255,this[j+1]=D>>>8,j+2},z.prototype.writeInt16BE=function(D,j,ie){return D=+D,j=j>>>0,ie||ze(this,D,j,2,32767,-32768),this[j]=D>>>8,this[j+1]=D&255,j+2},z.prototype.writeInt32LE=function(D,j,ie){return D=+D,j=j>>>0,ie||ze(this,D,j,4,2147483647,-2147483648),this[j]=D&255,this[j+1]=D>>>8,this[j+2]=D>>>16,this[j+3]=D>>>24,j+4},z.prototype.writeInt32BE=function(D,j,ie){return D=+D,j=j>>>0,ie||ze(this,D,j,4,2147483647,-2147483648),D<0&&(D=4294967295+D+1),this[j]=D>>>24,this[j+1]=D>>>16,this[j+2]=D>>>8,this[j+3]=D&255,j+4},z.prototype.writeBigInt64LE=fi(function(D,j=0){return it(this,D,j,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),z.prototype.writeBigInt64BE=fi(function(D,j=0){return Ze(this,D,j,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function he(Y,D,j,ie,ge,Oe){if(j+ie>Y.length)throw new RangeError("Index out of range");if(j<0)throw new RangeError("Index out of range")}function Ie(Y,D,j,ie,ge){return D=+D,j=j>>>0,ge||he(Y,D,j,4),R.write(Y,D,j,ie,23,4),j+4}z.prototype.writeFloatLE=function(D,j,ie){return Ie(this,D,j,!0,ie)},z.prototype.writeFloatBE=function(D,j,ie){return Ie(this,D,j,!1,ie)};function Be(Y,D,j,ie,ge){return D=+D,j=j>>>0,ge||he(Y,D,j,8),R.write(Y,D,j,ie,52,8),j+8}z.prototype.writeDoubleLE=function(D,j,ie){return Be(this,D,j,!0,ie)},z.prototype.writeDoubleBE=function(D,j,ie){return Be(this,D,j,!1,ie)},z.prototype.copy=function(D,j,ie,ge){if(!z.isBuffer(D))throw new TypeError("argument should be a Buffer");if(ie||(ie=0),!ge&&ge!==0&&(ge=this.length),j>=D.length&&(j=D.length),j||(j=0),ge>0&&ge<ie&&(ge=ie),ge===ie||D.length===0||this.length===0)return 0;if(j<0)throw new RangeError("targetStart out of bounds");if(ie<0||ie>=this.length)throw new RangeError("Index out of range");if(ge<0)throw new RangeError("sourceEnd out of bounds");ge>this.length&&(ge=this.length),D.length-j<ge-ie&&(ge=D.length-j+ie);const Oe=ge-ie;return this===D&&typeof U.prototype.copyWithin=="function"?this.copyWithin(j,ie,ge):U.prototype.set.call(D,this.subarray(ie,ge),j),Oe},z.prototype.fill=function(D,j,ie,ge){if(typeof D=="string"){if(typeof j=="string"?(ge=j,j=0,ie=this.length):typeof ie=="string"&&(ge=ie,ie=this.length),ge!==void 0&&typeof ge!="string")throw new TypeError("encoding must be a string");if(typeof ge=="string"&&!z.isEncoding(ge))throw new TypeError("Unknown encoding: "+ge);if(D.length===1){const Q=D.charCodeAt(0);(ge==="utf8"&&Q<128||ge==="latin1")&&(D=Q)}}else typeof D=="number"?D=D&255:typeof D=="boolean"&&(D=Number(D));if(j<0||this.length<j||this.length<ie)throw new RangeError("Out of range index");if(ie<=j)return this;j=j>>>0,ie=ie===void 0?this.length:ie>>>0,D||(D=0);let Oe;if(typeof D=="number")for(Oe=j;Oe<ie;++Oe)this[Oe]=D;else{const Q=z.isBuffer(D)?D:z.from(D,ge),ne=Q.length;if(ne===0)throw new TypeError('The value "'+D+'" is invalid for argument "value"');for(Oe=0;Oe<ie-j;++Oe)this[Oe+j]=Q[Oe%ne]}return this};const nt={};function W(Y,D,j){nt[Y]=class extends j{constructor(){super(),Object.defineProperty(this,"message",{value:D.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${Y}]`,this.stack,delete this.name}get code(){return Y}set code(ge){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:ge,writable:!0})}toString(){return`${this.name} [${Y}]: ${this.message}`}}}W("ERR_BUFFER_OUT_OF_BOUNDS",function(Y){return Y?`${Y} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),W("ERR_INVALID_ARG_TYPE",function(Y,D){return`The "${Y}" argument must be of type number. Received type ${typeof D}`},TypeError),W("ERR_OUT_OF_RANGE",function(Y,D,j){let ie=`The value of "${Y}" is out of range.`,ge=j;return Number.isInteger(j)&&Math.abs(j)>2**32?ge=M(String(j)):typeof j=="bigint"&&(ge=String(j),(j>BigInt(2)**BigInt(32)||j<-(BigInt(2)**BigInt(32)))&&(ge=M(ge)),ge+="n"),ie+=` It must be ${D}. Received ${ge}`,ie},RangeError);function M(Y){let D="",j=Y.length;const ie=Y[0]==="-"?1:0;for(;j>=ie+4;j-=3)D=`_${Y.slice(j-3,j)}${D}`;return`${Y.slice(0,j)}${D}`}function L(Y,D,j){me(D,"offset"),(Y[D]===void 0||Y[D+j]===void 0)&&Ce(D,Y.length-(j+1))}function re(Y,D,j,ie,ge,Oe){if(Y>j||Y<D){const Q=typeof D=="bigint"?"n":"";let ne;throw D===0||D===BigInt(0)?ne=`>= 0${Q} and < 2${Q} ** ${(Oe+1)*8}${Q}`:ne=`>= -(2${Q} ** ${(Oe+1)*8-1}${Q}) and < 2 ** ${(Oe+1)*8-1}${Q}`,new nt.ERR_OUT_OF_RANGE("value",ne,Y)}L(ie,ge,Oe)}function me(Y,D){if(typeof Y!="number")throw new nt.ERR_INVALID_ARG_TYPE(D,"number",Y)}function Ce(Y,D,j){throw Math.floor(Y)!==Y?(me(Y,j),new nt.ERR_OUT_OF_RANGE("offset","an integer",Y)):D<0?new nt.ERR_BUFFER_OUT_OF_BOUNDS:new nt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${D}`,Y)}const Le=/[^+/0-9A-Za-z-_]/g;function ft(Y){if(Y=Y.split("=")[0],Y=Y.trim().replace(Le,""),Y.length<2)return"";for(;Y.length%4!==0;)Y=Y+"=";return Y}function Bt(Y,D){D=D||1/0;let j;const ie=Y.length;let ge=null;const Oe=[];for(let Q=0;Q<ie;++Q){if(j=Y.charCodeAt(Q),j>55295&&j<57344){if(!ge){if(j>56319){(D-=3)>-1&&Oe.push(239,191,189);continue}else if(Q+1===ie){(D-=3)>-1&&Oe.push(239,191,189);continue}ge=j;continue}if(j<56320){(D-=3)>-1&&Oe.push(239,191,189),ge=j;continue}j=(ge-55296<<10|j-56320)+65536}else ge&&(D-=3)>-1&&Oe.push(239,191,189);if(ge=null,j<128){if((D-=1)<0)break;Oe.push(j)}else if(j<2048){if((D-=2)<0)break;Oe.push(j>>6|192,j&63|128)}else if(j<65536){if((D-=3)<0)break;Oe.push(j>>12|224,j>>6&63|128,j&63|128)}else if(j<1114112){if((D-=4)<0)break;Oe.push(j>>18|240,j>>12&63|128,j>>6&63|128,j&63|128)}else throw new Error("Invalid code point")}return Oe}function sn(Y){const D=[];for(let j=0;j<Y.length;++j)D.push(Y.charCodeAt(j)&255);return D}function hn(Y,D){let j,ie,ge;const Oe=[];for(let Q=0;Q<Y.length&&!((D-=2)<0);++Q)j=Y.charCodeAt(Q),ie=j>>8,ge=j%256,Oe.push(ge),Oe.push(ie);return Oe}function Xt(Y){return A.toByteArray(ft(Y))}function Aa(Y,D,j,ie){let ge;for(ge=0;ge<ie&&!(ge+j>=D.length||ge>=Y.length);++ge)D[ge+j]=Y[ge];return ge}function Ai(Y,D){return Y instanceof D||Y!=null&&Y.constructor!=null&&Y.constructor.name!=null&&Y.constructor.name===D.name}function Qi(Y){return Y!==Y}const Lc=function(){const Y="0123456789abcdef",D=new Array(256);for(let j=0;j<16;++j){const ie=j*16;for(let ge=0;ge<16;++ge)D[ie+ge]=Y[j]+Y[ge]}return D}();function fi(Y){return typeof BigInt>"u"?du:Y}function du(){throw new Error("BigInt not supported")}})(e);const E=e.Buffer;n.Blob=e.Blob,n.BlobOptions=e.BlobOptions,n.Buffer=e.Buffer,n.File=e.File,n.FileOptions=e.FileOptions,n.INSPECT_MAX_BYTES=e.INSPECT_MAX_BYTES,n.SlowBuffer=e.SlowBuffer,n.TranscodeEncoding=e.TranscodeEncoding,n.atob=e.atob,n.btoa=e.btoa,n.constants=e.constants,n.default=E,n.isAscii=e.isAscii,n.isUtf8=e.isUtf8,n.kMaxLength=e.kMaxLength,n.kStringMaxLength=e.kStringMaxLength,n.resolveObjectURL=e.resolveObjectURL,n.transcode=e.transcode}(E1)),E1}var S1={},T1={},A1,b4;function Aq(){return b4||(b4=1,A1=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),r=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var i=42;e[t]=i;for(var a in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var s=Object.getOwnPropertySymbols(e);if(s.length!==1||s[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(e,t);if(o.value!==i||o.enumerable!==!0)return!1}return!0}),A1}var C1,w4;function Xb(){if(w4)return C1;w4=1;var n=Aq();return C1=function(){return n()&&!!Symbol.toStringTag},C1}var x1,E4;function Cq(){return E4||(E4=1,x1=Object),x1}var R1,S4;function Vse(){return S4||(S4=1,R1=Error),R1}var I1,T4;function zse(){return T4||(T4=1,I1=EvalError),I1}var P1,A4;function Hse(){return A4||(A4=1,P1=RangeError),P1}var O1,C4;function Gse(){return C4||(C4=1,O1=ReferenceError),O1}var k1,x4;function xq(){return x4||(x4=1,k1=SyntaxError),k1}var N1,R4;function Jm(){return R4||(R4=1,N1=TypeError),N1}var M1,I4;function Wse(){return I4||(I4=1,M1=URIError),M1}var D1,P4;function Kse(){return P4||(P4=1,D1=Math.abs),D1}var $1,O4;function Jse(){return O4||(O4=1,$1=Math.floor),$1}var L1,k4;function Yse(){return k4||(k4=1,L1=Math.max),L1}var U1,N4;function Zse(){return N4||(N4=1,U1=Math.min),U1}var j1,M4;function Xse(){return M4||(M4=1,j1=Math.pow),j1}var F1,D4;function Qse(){return D4||(D4=1,F1=Math.round),F1}var B1,$4;function eoe(){return $4||($4=1,B1=Number.isNaN||function(e){return e!==e}),B1}var q1,L4;function toe(){if(L4)return q1;L4=1;var n=eoe();return q1=function(t){return n(t)||t===0?t:t<0?-1:1},q1}var V1,U4;function noe(){return U4||(U4=1,V1=Object.getOwnPropertyDescriptor),V1}var z1,j4;function qd(){if(j4)return z1;j4=1;var n=noe();if(n)try{n([],"length")}catch{n=null}return z1=n,z1}var H1,F4;function Qb(){if(F4)return H1;F4=1;var n=Object.defineProperty||!1;if(n)try{n({},"a",{value:1})}catch{n=!1}return H1=n,H1}var G1,B4;function roe(){if(B4)return G1;B4=1;var n=typeof Symbol<"u"&&Symbol,e=Aq();return G1=function(){return typeof n!="function"||typeof Symbol!="function"||typeof n("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},G1}var W1,q4;function Rq(){return q4||(q4=1,W1=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),W1}var K1,V4;function Iq(){if(V4)return K1;V4=1;var n=Cq();return K1=n.getPrototypeOf||null,K1}var J1,z4;function ioe(){if(z4)return J1;z4=1;var n="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,r="[object Function]",i=function(u,c){for(var d=[],h=0;h<u.length;h+=1)d[h]=u[h];for(var m=0;m<c.length;m+=1)d[m+u.length]=c[m];return d},a=function(u,c){for(var d=[],h=c,m=0;h<u.length;h+=1,m+=1)d[m]=u[h];return d},s=function(o,u){for(var c="",d=0;d<o.length;d+=1)c+=o[d],d+1<o.length&&(c+=u);return c};return J1=function(u){var c=this;if(typeof c!="function"||e.apply(c)!==r)throw new TypeError(n+c);for(var d=a(arguments,1),h,m=function(){if(this instanceof h){var E=c.apply(this,i(d,arguments));return Object(E)===E?E:this}return c.apply(u,i(d,arguments))},g=t(0,c.length-d.length),_=[],w=0;w<g;w++)_[w]="$"+w;if(h=Function("binder","return function ("+s(_,",")+"){ return binder.apply(this,arguments); }")(m),c.prototype){var S=function(){};S.prototype=c.prototype,h.prototype=new S,S.prototype=null}return h},J1}var Y1,H4;function Ym(){if(H4)return Y1;H4=1;var n=ioe();return Y1=Function.prototype.bind||n,Y1}var Z1,G4;function rP(){return G4||(G4=1,Z1=Function.prototype.call),Z1}var X1,W4;function iP(){return W4||(W4=1,X1=Function.prototype.apply),X1}var Q1,K4;function aoe(){return K4||(K4=1,Q1=typeof Reflect<"u"&&Reflect&&Reflect.apply),Q1}var eA,J4;function Pq(){if(J4)return eA;J4=1;var n=Ym(),e=iP(),t=rP(),r=aoe();return eA=r||n.call(t,e),eA}var tA,Y4;function aP(){if(Y4)return tA;Y4=1;var n=Ym(),e=Jm(),t=rP(),r=Pq();return tA=function(a){if(a.length<1||typeof a[0]!="function")throw new e("a function is required");return r(n,t,a)},tA}var nA,Z4;function soe(){if(Z4)return nA;Z4=1;var n=aP(),e=qd(),t;try{t=[].__proto__===Array.prototype}catch(s){if(!s||typeof s!="object"||!("code"in s)||s.code!=="ERR_PROTO_ACCESS")throw s}var r=!!t&&e&&e(Object.prototype,"__proto__"),i=Object,a=i.getPrototypeOf;return nA=r&&typeof r.get=="function"?n([r.get]):typeof a=="function"?function(o){return a(o==null?o:i(o))}:!1,nA}var rA,X4;function sP(){if(X4)return rA;X4=1;var n=Rq(),e=Iq(),t=soe();return rA=n?function(i){return n(i)}:e?function(i){if(!i||typeof i!="object"&&typeof i!="function")throw new TypeError("getProto: not an object");return e(i)}:t?function(i){return t(i)}:null,rA}var iA,Q4;function Oq(){if(Q4)return iA;Q4=1;var n=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=Ym();return iA=t.call(n,e),iA}var aA,ej;function kq(){if(ej)return aA;ej=1;var n,e=Cq(),t=Vse(),r=zse(),i=Hse(),a=Gse(),s=xq(),o=Jm(),u=Wse(),c=Kse(),d=Jse(),h=Yse(),m=Zse(),g=Xse(),_=Qse(),w=toe(),S=Function,E=function(X){try{return S('"use strict"; return ('+X+").constructor;")()}catch{}},C=qd(),A=Qb(),R=function(){throw new o},P=C?function(){try{return arguments.callee,R}catch{try{return C(arguments,"callee").get}catch{return R}}}():R,N=roe()(),U=sP(),k=Iq(),B=Rq(),H=iP(),G=rP(),z={},oe=typeof Uint8Array>"u"||!U?n:U(Uint8Array),te={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?n:ArrayBuffer,"%ArrayIteratorPrototype%":N&&U?U([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":z,"%AsyncGenerator%":z,"%AsyncGeneratorFunction%":z,"%AsyncIteratorPrototype%":z,"%Atomics%":typeof Atomics>"u"?n:Atomics,"%BigInt%":typeof BigInt>"u"?n:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?n:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":t,"%eval%":eval,"%EvalError%":r,"%Float16Array%":typeof Float16Array>"u"?n:Float16Array,"%Float32Array%":typeof Float32Array>"u"?n:Float32Array,"%Float64Array%":typeof Float64Array>"u"?n:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?n:FinalizationRegistry,"%Function%":S,"%GeneratorFunction%":z,"%Int8Array%":typeof Int8Array>"u"?n:Int8Array,"%Int16Array%":typeof Int16Array>"u"?n:Int16Array,"%Int32Array%":typeof Int32Array>"u"?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":N&&U?U(U([][Symbol.iterator]())):n,"%JSON%":typeof JSON=="object"?JSON:n,"%Map%":typeof Map>"u"?n:Map,"%MapIteratorPrototype%":typeof Map>"u"||!N||!U?n:U(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":C,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?n:Promise,"%Proxy%":typeof Proxy>"u"?n:Proxy,"%RangeError%":i,"%ReferenceError%":a,"%Reflect%":typeof Reflect>"u"?n:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?n:Set,"%SetIteratorPrototype%":typeof Set>"u"||!N||!U?n:U(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":N&&U?U(""[Symbol.iterator]()):n,"%Symbol%":N?Symbol:n,"%SyntaxError%":s,"%ThrowTypeError%":P,"%TypedArray%":oe,"%TypeError%":o,"%Uint8Array%":typeof Uint8Array>"u"?n:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?n:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?n:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?n:Uint32Array,"%URIError%":u,"%WeakMap%":typeof WeakMap>"u"?n:WeakMap,"%WeakRef%":typeof WeakRef>"u"?n:WeakRef,"%WeakSet%":typeof WeakSet>"u"?n:WeakSet,"%Function.prototype.call%":G,"%Function.prototype.apply%":H,"%Object.defineProperty%":A,"%Object.getPrototypeOf%":k,"%Math.abs%":c,"%Math.floor%":d,"%Math.max%":h,"%Math.min%":m,"%Math.pow%":g,"%Math.round%":_,"%Math.sign%":w,"%Reflect.getPrototypeOf%":B};if(U)try{null.error}catch(X){var se=U(U(X));te["%Error.prototype%"]=se}var ee=function X(ue){var V;if(ue==="%AsyncFunction%")V=E("async function () {}");else if(ue==="%GeneratorFunction%")V=E("function* () {}");else if(ue==="%AsyncGeneratorFunction%")V=E("async function* () {}");else if(ue==="%AsyncGenerator%"){var K=X("%AsyncGeneratorFunction%");K&&(V=K.prototype)}else if(ue==="%AsyncIteratorPrototype%"){var _e=X("%AsyncGenerator%");_e&&U&&(V=U(_e.prototype))}return te[ue]=V,V},le={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},pe=Ym(),we=Oq(),$=pe.call(G,Array.prototype.concat),ve=pe.call(H,Array.prototype.splice),Te=pe.call(G,String.prototype.replace),F=pe.call(G,String.prototype.slice),ae=pe.call(G,RegExp.prototype.exec),fe=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,I=/\\(\\)?/g,O=function(ue){var V=F(ue,0,1),K=F(ue,-1);if(V==="%"&&K!=="%")throw new s("invalid intrinsic syntax, expected closing `%`");if(K==="%"&&V!=="%")throw new s("invalid intrinsic syntax, expected opening `%`");var _e=[];return Te(ue,fe,function(Me,tt,je,We){_e[_e.length]=je?Te(We,I,"$1"):tt||Me}),_e},J=function(ue,V){var K=ue,_e;if(we(le,K)&&(_e=le[K],K="%"+_e[0]+"%"),we(te,K)){var Me=te[K];if(Me===z&&(Me=ee(K)),typeof Me>"u"&&!V)throw new o("intrinsic "+ue+" exists, but is not available. Please file an issue!");return{alias:_e,name:K,value:Me}}throw new s("intrinsic "+ue+" does not exist!")};return aA=function(ue,V){if(typeof ue!="string"||ue.length===0)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof V!="boolean")throw new o('"allowMissing" argument must be a boolean');if(ae(/^%?[^%]*%?$/,ue)===null)throw new s("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var K=O(ue),_e=K.length>0?K[0]:"",Me=J("%"+_e+"%",V),tt=Me.name,je=Me.value,We=!1,Ot=Me.alias;Ot&&(_e=Ot[0],ve(K,$([0,1],Ot)));for(var Pe=1,He=!0;Pe<K.length;Pe+=1){var At=K[Pe],Ge=F(At,0,1),ze=F(At,-1);if((Ge==='"'||Ge==="'"||Ge==="`"||ze==='"'||ze==="'"||ze==="`")&&Ge!==ze)throw new s("property names with quotes must have matching quotes");if((At==="constructor"||!He)&&(We=!0),_e+="."+At,tt="%"+_e+"%",we(te,tt))je=te[tt];else if(je!=null){if(!(At in je)){if(!V)throw new o("base intrinsic for "+ue+" exists, but the property is not available.");return}if(C&&Pe+1>=K.length){var it=C(je,At);He=!!it,He&&"get"in it&&!("originalValue"in it.get)?je=it.get:je=je[At]}else He=we(je,At),je=je[At];He&&!We&&(te[tt]=je)}}return je},aA}var sA,tj;function Zm(){if(tj)return sA;tj=1;var n=kq(),e=aP(),t=e([n("%String.prototype.indexOf%")]);return sA=function(i,a){var s=n(i,!!a);return typeof s=="function"&&t(i,".prototype.")>-1?e([s]):s},sA}var oA,nj;function ooe(){if(nj)return oA;nj=1;var n=Xb()(),e=Zm(),t=e("Object.prototype.toString"),r=function(o){return n&&o&&typeof o=="object"&&Symbol.toStringTag in o?!1:t(o)==="[object Arguments]"},i=function(o){return r(o)?!0:o!==null&&typeof o=="object"&&"length"in o&&typeof o.length=="number"&&o.length>=0&&t(o)!=="[object Array]"&&"callee"in o&&t(o.callee)==="[object Function]"},a=function(){return r(arguments)}();return r.isLegacyArguments=i,oA=a?r:i,oA}var lA,rj;function loe(){if(rj)return lA;rj=1;var n=Zm(),e=Xb()(),t=Oq(),r=qd(),i;if(e){var a=n("RegExp.prototype.exec"),s={},o=function(){throw s},u={toString:o,valueOf:o};typeof Symbol.toPrimitive=="symbol"&&(u[Symbol.toPrimitive]=o),i=function(m){if(!m||typeof m!="object")return!1;var g=r(m,"lastIndex"),_=g&&t(g,"value");if(!_)return!1;try{a(m,u)}catch(w){return w===s}}}else{var c=n("Object.prototype.toString"),d="[object RegExp]";i=function(m){return!m||typeof m!="object"&&typeof m!="function"?!1:c(m)===d}}return lA=i,lA}var uA,ij;function uoe(){if(ij)return uA;ij=1;var n=Zm(),e=loe(),t=n("RegExp.prototype.exec"),r=Jm();return uA=function(a){if(!e(a))throw new r("`regex` must be a RegExp");return function(o){return t(a,o)!==null}},uA}var cA,aj;function coe(){if(aj)return cA;aj=1;var n=Zm(),e=uoe(),t=e(/^\s*(?:function)?\*/),r=Xb()(),i=sP(),a=n("Object.prototype.toString"),s=n("Function.prototype.toString"),o=function(){if(!r)return!1;try{return Function("return function*() {}")()}catch{}},u;return cA=function(d){if(typeof d!="function")return!1;if(t(s(d)))return!0;if(!r){var h=a(d);return h==="[object GeneratorFunction]"}if(!i)return!1;if(typeof u>"u"){var m=o();u=m?i(m):!1}return i(d)===u},cA}var fA,sj;function foe(){if(sj)return fA;sj=1;var n=Function.prototype.toString,e=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,t,r;if(typeof e=="function"&&typeof Object.defineProperty=="function")try{t=Object.defineProperty({},"length",{get:function(){throw r}}),r={},e(function(){throw 42},null,t)}catch(C){C!==r&&(e=null)}else e=null;var i=/^\s*class\b/,a=function(A){try{var R=n.call(A);return i.test(R)}catch{return!1}},s=function(A){try{return a(A)?!1:(n.call(A),!0)}catch{return!1}},o=Object.prototype.toString,u="[object Object]",c="[object Function]",d="[object GeneratorFunction]",h="[object HTMLAllCollection]",m="[object HTML document.all class]",g="[object HTMLCollection]",_=typeof Symbol=="function"&&!!Symbol.toStringTag,w=!(0 in[,]),S=function(){return!1};if(typeof document=="object"){var E=document.all;o.call(E)===o.call(document.all)&&(S=function(A){if((w||!A)&&(typeof A>"u"||typeof A=="object"))try{var R=o.call(A);return(R===h||R===m||R===g||R===u)&&A("")==null}catch{}return!1})}return fA=e?function(A){if(S(A))return!0;if(!A||typeof A!="function"&&typeof A!="object")return!1;try{e(A,null,t)}catch(R){if(R!==r)return!1}return!a(A)&&s(A)}:function(A){if(S(A))return!0;if(!A||typeof A!="function"&&typeof A!="object")return!1;if(_)return s(A);if(a(A))return!1;var R=o.call(A);return R!==c&&R!==d&&!/^\[object HTML/.test(R)?!1:s(A)},fA}var dA,oj;function doe(){if(oj)return dA;oj=1;var n=foe(),e=Object.prototype.toString,t=Object.prototype.hasOwnProperty,r=function(u,c,d){for(var h=0,m=u.length;h<m;h++)t.call(u,h)&&(d==null?c(u[h],h,u):c.call(d,u[h],h,u))},i=function(u,c,d){for(var h=0,m=u.length;h<m;h++)d==null?c(u.charAt(h),h,u):c.call(d,u.charAt(h),h,u)},a=function(u,c,d){for(var h in u)t.call(u,h)&&(d==null?c(u[h],h,u):c.call(d,u[h],h,u))};function s(o){return e.call(o)==="[object Array]"}return dA=function(u,c,d){if(!n(c))throw new TypeError("iterator must be a function");var h;arguments.length>=3&&(h=d),s(u)?r(u,c,h):typeof u=="string"?i(u,c,h):a(u,c,h)},dA}var hA,lj;function hoe(){return lj||(lj=1,hA=["Float16Array","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"]),hA}var pA,uj;function poe(){if(uj)return pA;uj=1;var n=hoe(),e=typeof globalThis>"u"?window:globalThis;return pA=function(){for(var r=[],i=0;i<n.length;i++)typeof e[n[i]]=="function"&&(r[r.length]=n[i]);return r},pA}var mA={exports:{}},gA,cj;function moe(){if(cj)return gA;cj=1;var n=Qb(),e=xq(),t=Jm(),r=qd();return gA=function(a,s,o){if(!a||typeof a!="object"&&typeof a!="function")throw new t("`obj` must be an object or a function`");if(typeof s!="string"&&typeof s!="symbol")throw new t("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new t("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new t("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new t("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new t("`loose`, if provided, must be a boolean");var u=arguments.length>3?arguments[3]:null,c=arguments.length>4?arguments[4]:null,d=arguments.length>5?arguments[5]:null,h=arguments.length>6?arguments[6]:!1,m=!!r&&r(a,s);if(n)n(a,s,{configurable:d===null&&m?m.configurable:!d,enumerable:u===null&&m?m.enumerable:!u,value:o,writable:c===null&&m?m.writable:!c});else if(h||!u&&!c&&!d)a[s]=o;else throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},gA}var yA,fj;function goe(){if(fj)return yA;fj=1;var n=Qb(),e=function(){return!!n};return e.hasArrayLengthDefineBug=function(){if(!n)return null;try{return n([],"length",{value:1}).length!==1}catch{return!0}},yA=e,yA}var vA,dj;function yoe(){if(dj)return vA;dj=1;var n=kq(),e=moe(),t=goe()(),r=qd(),i=Jm(),a=n("%Math.floor%");return vA=function(o,u){if(typeof o!="function")throw new i("`fn` is not a function");if(typeof u!="number"||u<0||u>4294967295||a(u)!==u)throw new i("`length` must be a positive 32-bit integer");var c=arguments.length>2&&!!arguments[2],d=!0,h=!0;if("length"in o&&r){var m=r(o,"length");m&&!m.configurable&&(d=!1),m&&!m.writable&&(h=!1)}return(d||h||!c)&&(t?e(o,"length",u,!0,!0):e(o,"length",u)),o},vA}var _A,hj;function voe(){if(hj)return _A;hj=1;var n=Ym(),e=iP(),t=Pq();return _A=function(){return t(n,e,arguments)},_A}var pj;function _oe(){return pj||(pj=1,function(n){var e=yoe(),t=Qb(),r=aP(),i=voe();n.exports=function(s){var o=r(arguments),u=s.length-(arguments.length-1);return e(o,1+(u>0?u:0),!0)},t?t(n.exports,"apply",{value:i}):n.exports.apply=i}(mA)),mA.exports}var bA,mj;function Nq(){if(mj)return bA;mj=1;var n=doe(),e=poe(),t=_oe(),r=Zm(),i=qd(),a=sP(),s=r("Object.prototype.toString"),o=Xb()(),u=typeof globalThis>"u"?window:globalThis,c=e(),d=r("String.prototype.slice"),h=r("Array.prototype.indexOf",!0)||function(S,E){for(var C=0;C<S.length;C+=1)if(S[C]===E)return C;return-1},m={__proto__:null};o&&i&&a?n(c,function(w){var S=new u[w];if(Symbol.toStringTag in S&&a){var E=a(S),C=i(E,Symbol.toStringTag);if(!C&&E){var A=a(E);C=i(A,Symbol.toStringTag)}m["$"+w]=t(C.get)}}):n(c,function(w){var S=new u[w],E=S.slice||S.set;E&&(m["$"+w]=t(E))});var g=function(S){var E=!1;return n(m,function(C,A){if(!E)try{"$"+C(S)===A&&(E=d(A,1))}catch{}}),E},_=function(S){var E=!1;return n(m,function(C,A){if(!E)try{C(S),E=d(A,1)}catch{}}),E};return bA=function(S){if(!S||typeof S!="object")return!1;if(!o){var E=d(s(S),8,-1);return h(c,E)>-1?E:E!=="Object"?!1:_(S)}return i?g(S):null},bA}var wA,gj;function boe(){if(gj)return wA;gj=1;var n=Nq();return wA=function(t){return!!n(t)},wA}var yj;function woe(){return yj||(yj=1,function(n){var e=ooe(),t=coe(),r=Nq(),i=boe();function a(Pe){return Pe.call.bind(Pe)}var s=typeof BigInt<"u",o=typeof Symbol<"u",u=a(Object.prototype.toString),c=a(Number.prototype.valueOf),d=a(String.prototype.valueOf),h=a(Boolean.prototype.valueOf);if(s)var m=a(BigInt.prototype.valueOf);if(o)var g=a(Symbol.prototype.valueOf);function _(Pe,He){if(typeof Pe!="object")return!1;try{return He(Pe),!0}catch{return!1}}n.isArgumentsObject=e,n.isGeneratorFunction=t,n.isTypedArray=i;function w(Pe){return typeof Promise<"u"&&Pe instanceof Promise||Pe!==null&&typeof Pe=="object"&&typeof Pe.then=="function"&&typeof Pe.catch=="function"}n.isPromise=w;function S(Pe){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(Pe):i(Pe)||F(Pe)}n.isArrayBufferView=S;function E(Pe){return r(Pe)==="Uint8Array"}n.isUint8Array=E;function C(Pe){return r(Pe)==="Uint8ClampedArray"}n.isUint8ClampedArray=C;function A(Pe){return r(Pe)==="Uint16Array"}n.isUint16Array=A;function R(Pe){return r(Pe)==="Uint32Array"}n.isUint32Array=R;function P(Pe){return r(Pe)==="Int8Array"}n.isInt8Array=P;function N(Pe){return r(Pe)==="Int16Array"}n.isInt16Array=N;function U(Pe){return r(Pe)==="Int32Array"}n.isInt32Array=U;function k(Pe){return r(Pe)==="Float32Array"}n.isFloat32Array=k;function B(Pe){return r(Pe)==="Float64Array"}n.isFloat64Array=B;function H(Pe){return r(Pe)==="BigInt64Array"}n.isBigInt64Array=H;function G(Pe){return r(Pe)==="BigUint64Array"}n.isBigUint64Array=G;function z(Pe){return u(Pe)==="[object Map]"}z.working=typeof Map<"u"&&z(new Map);function oe(Pe){return typeof Map>"u"?!1:z.working?z(Pe):Pe instanceof Map}n.isMap=oe;function te(Pe){return u(Pe)==="[object Set]"}te.working=typeof Set<"u"&&te(new Set);function se(Pe){return typeof Set>"u"?!1:te.working?te(Pe):Pe instanceof Set}n.isSet=se;function ee(Pe){return u(Pe)==="[object WeakMap]"}ee.working=typeof WeakMap<"u"&&ee(new WeakMap);function le(Pe){return typeof WeakMap>"u"?!1:ee.working?ee(Pe):Pe instanceof WeakMap}n.isWeakMap=le;function pe(Pe){return u(Pe)==="[object WeakSet]"}pe.working=typeof WeakSet<"u"&&pe(new WeakSet);function we(Pe){return pe(Pe)}n.isWeakSet=we;function $(Pe){return u(Pe)==="[object ArrayBuffer]"}$.working=typeof ArrayBuffer<"u"&&$(new ArrayBuffer);function ve(Pe){return typeof ArrayBuffer>"u"?!1:$.working?$(Pe):Pe instanceof ArrayBuffer}n.isArrayBuffer=ve;function Te(Pe){return u(Pe)==="[object DataView]"}Te.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&Te(new DataView(new ArrayBuffer(1),0,1));function F(Pe){return typeof DataView>"u"?!1:Te.working?Te(Pe):Pe instanceof DataView}n.isDataView=F;var ae=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function fe(Pe){return u(Pe)==="[object SharedArrayBuffer]"}function I(Pe){return typeof ae>"u"?!1:(typeof fe.working>"u"&&(fe.working=fe(new ae)),fe.working?fe(Pe):Pe instanceof ae)}n.isSharedArrayBuffer=I;function O(Pe){return u(Pe)==="[object AsyncFunction]"}n.isAsyncFunction=O;function J(Pe){return u(Pe)==="[object Map Iterator]"}n.isMapIterator=J;function X(Pe){return u(Pe)==="[object Set Iterator]"}n.isSetIterator=X;function ue(Pe){return u(Pe)==="[object Generator]"}n.isGeneratorObject=ue;function V(Pe){return u(Pe)==="[object WebAssembly.Module]"}n.isWebAssemblyCompiledModule=V;function K(Pe){return _(Pe,c)}n.isNumberObject=K;function _e(Pe){return _(Pe,d)}n.isStringObject=_e;function Me(Pe){return _(Pe,h)}n.isBooleanObject=Me;function tt(Pe){return s&&_(Pe,m)}n.isBigIntObject=tt;function je(Pe){return o&&_(Pe,g)}n.isSymbolObject=je;function We(Pe){return K(Pe)||_e(Pe)||Me(Pe)||tt(Pe)||je(Pe)}n.isBoxedPrimitive=We;function Ot(Pe){return typeof Uint8Array<"u"&&(ve(Pe)||I(Pe))}n.isAnyArrayBuffer=Ot,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(Pe){Object.defineProperty(n,Pe,{enumerable:!1,value:function(){throw new Error(Pe+" is not supported in userland")}})})}(T1)),T1}var EA,vj;function Eoe(){return vj||(vj=1,EA=function(e){return e&&typeof e=="object"&&typeof e.copy=="function"&&typeof e.fill=="function"&&typeof e.readUInt8=="function"}),EA}var _j;function Mq(){return _j||(_j=1,function(n){var e={},t=Object.getOwnPropertyDescriptors||function(ae){for(var fe=Object.keys(ae),I={},O=0;O<fe.length;O++)I[fe[O]]=Object.getOwnPropertyDescriptor(ae,fe[O]);return I},r=/%[sdj%]/g;n.format=function(F){if(!N(F)){for(var ae=[],fe=0;fe<arguments.length;fe++)ae.push(o(arguments[fe]));return ae.join(" ")}for(var fe=1,I=arguments,O=I.length,J=String(F).replace(r,function(ue){if(ue==="%%")return"%";if(fe>=O)return ue;switch(ue){case"%s":return String(I[fe++]);case"%d":return Number(I[fe++]);case"%j":try{return JSON.stringify(I[fe++])}catch{return"[Circular]"}default:return ue}}),X=I[fe];fe<O;X=I[++fe])A(X)||!H(X)?J+=" "+X:J+=" "+o(X);return J},n.deprecate=function(F,ae){if(typeof ot<"u"&&ot.noDeprecation===!0)return F;if(typeof ot>"u")return function(){return n.deprecate(F,ae).apply(this,arguments)};var fe=!1;function I(){if(!fe){if(ot.throwDeprecation)throw new Error(ae);ot.traceDeprecation?console.trace(ae):console.error(ae),fe=!0}return F.apply(this,arguments)}return I};var i={},a=/^$/;if(e.NODE_DEBUG){var s=e.NODE_DEBUG;s=s.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),a=new RegExp("^"+s+"$","i")}n.debuglog=function(F){if(F=F.toUpperCase(),!i[F])if(a.test(F)){var ae=ot.pid;i[F]=function(){var fe=n.format.apply(n,arguments);console.error("%s %d: %s",F,ae,fe)}}else i[F]=function(){};return i[F]};function o(F,ae){var fe={seen:[],stylize:c};return arguments.length>=3&&(fe.depth=arguments[2]),arguments.length>=4&&(fe.colors=arguments[3]),C(ae)?fe.showHidden=ae:ae&&n._extend(fe,ae),k(fe.showHidden)&&(fe.showHidden=!1),k(fe.depth)&&(fe.depth=2),k(fe.colors)&&(fe.colors=!1),k(fe.customInspect)&&(fe.customInspect=!0),fe.colors&&(fe.stylize=u),h(fe,F,fe.depth)}n.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function u(F,ae){var fe=o.styles[ae];return fe?"\x1B["+o.colors[fe][0]+"m"+F+"\x1B["+o.colors[fe][1]+"m":F}function c(F,ae){return F}function d(F){var ae={};return F.forEach(function(fe,I){ae[fe]=!0}),ae}function h(F,ae,fe){if(F.customInspect&&ae&&oe(ae.inspect)&&ae.inspect!==n.inspect&&!(ae.constructor&&ae.constructor.prototype===ae)){var I=ae.inspect(fe,F);return N(I)||(I=h(F,I,fe)),I}var O=m(F,ae);if(O)return O;var J=Object.keys(ae),X=d(J);if(F.showHidden&&(J=Object.getOwnPropertyNames(ae)),z(ae)&&(J.indexOf("message")>=0||J.indexOf("description")>=0))return g(ae);if(J.length===0){if(oe(ae)){var ue=ae.name?": "+ae.name:"";return F.stylize("[Function"+ue+"]","special")}if(B(ae))return F.stylize(RegExp.prototype.toString.call(ae),"regexp");if(G(ae))return F.stylize(Date.prototype.toString.call(ae),"date");if(z(ae))return g(ae)}var V="",K=!1,_e=["{","}"];if(E(ae)&&(K=!0,_e=["[","]"]),oe(ae)){var Me=ae.name?": "+ae.name:"";V=" [Function"+Me+"]"}if(B(ae)&&(V=" "+RegExp.prototype.toString.call(ae)),G(ae)&&(V=" "+Date.prototype.toUTCString.call(ae)),z(ae)&&(V=" "+g(ae)),J.length===0&&(!K||ae.length==0))return _e[0]+V+_e[1];if(fe<0)return B(ae)?F.stylize(RegExp.prototype.toString.call(ae),"regexp"):F.stylize("[Object]","special");F.seen.push(ae);var tt;return K?tt=_(F,ae,fe,X,J):tt=J.map(function(je){return w(F,ae,fe,X,je,K)}),F.seen.pop(),S(tt,V,_e)}function m(F,ae){if(k(ae))return F.stylize("undefined","undefined");if(N(ae)){var fe="'"+JSON.stringify(ae).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return F.stylize(fe,"string")}if(P(ae))return F.stylize(""+ae,"number");if(C(ae))return F.stylize(""+ae,"boolean");if(A(ae))return F.stylize("null","null")}function g(F){return"["+Error.prototype.toString.call(F)+"]"}function _(F,ae,fe,I,O){for(var J=[],X=0,ue=ae.length;X<ue;++X)we(ae,String(X))?J.push(w(F,ae,fe,I,String(X),!0)):J.push("");return O.forEach(function(V){V.match(/^\d+$/)||J.push(w(F,ae,fe,I,V,!0))}),J}function w(F,ae,fe,I,O,J){var X,ue,V;if(V=Object.getOwnPropertyDescriptor(ae,O)||{value:ae[O]},V.get?V.set?ue=F.stylize("[Getter/Setter]","special"):ue=F.stylize("[Getter]","special"):V.set&&(ue=F.stylize("[Setter]","special")),we(I,O)||(X="["+O+"]"),ue||(F.seen.indexOf(V.value)<0?(A(fe)?ue=h(F,V.value,null):ue=h(F,V.value,fe-1),ue.indexOf(`
`)>-1&&(J?ue=ue.split(`
`).map(function(K){return"  "+K}).join(`
`).slice(2):ue=`
`+ue.split(`
`).map(function(K){return"   "+K}).join(`
`))):ue=F.stylize("[Circular]","special")),k(X)){if(J&&O.match(/^\d+$/))return ue;X=JSON.stringify(""+O),X.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(X=X.slice(1,-1),X=F.stylize(X,"name")):(X=X.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),X=F.stylize(X,"string"))}return X+": "+ue}function S(F,ae,fe){var I=F.reduce(function(O,J){return J.indexOf(`
`)>=0,O+J.replace(/\u001b\[\d\d?m/g,"").length+1},0);return I>60?fe[0]+(ae===""?"":ae+`
 `)+" "+F.join(`,
  `)+" "+fe[1]:fe[0]+ae+" "+F.join(", ")+" "+fe[1]}n.types=woe();function E(F){return Array.isArray(F)}n.isArray=E;function C(F){return typeof F=="boolean"}n.isBoolean=C;function A(F){return F===null}n.isNull=A;function R(F){return F==null}n.isNullOrUndefined=R;function P(F){return typeof F=="number"}n.isNumber=P;function N(F){return typeof F=="string"}n.isString=N;function U(F){return typeof F=="symbol"}n.isSymbol=U;function k(F){return F===void 0}n.isUndefined=k;function B(F){return H(F)&&se(F)==="[object RegExp]"}n.isRegExp=B,n.types.isRegExp=B;function H(F){return typeof F=="object"&&F!==null}n.isObject=H;function G(F){return H(F)&&se(F)==="[object Date]"}n.isDate=G,n.types.isDate=G;function z(F){return H(F)&&(se(F)==="[object Error]"||F instanceof Error)}n.isError=z,n.types.isNativeError=z;function oe(F){return typeof F=="function"}n.isFunction=oe;function te(F){return F===null||typeof F=="boolean"||typeof F=="number"||typeof F=="string"||typeof F=="symbol"||typeof F>"u"}n.isPrimitive=te,n.isBuffer=Eoe();function se(F){return Object.prototype.toString.call(F)}function ee(F){return F<10?"0"+F.toString(10):F.toString(10)}var le=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function pe(){var F=new Date,ae=[ee(F.getHours()),ee(F.getMinutes()),ee(F.getSeconds())].join(":");return[F.getDate(),le[F.getMonth()],ae].join(" ")}n.log=function(){console.log("%s - %s",pe(),n.format.apply(n,arguments))},n.inherits=Oc(),n._extend=function(F,ae){if(!ae||!H(ae))return F;for(var fe=Object.keys(ae),I=fe.length;I--;)F[fe[I]]=ae[fe[I]];return F};function we(F,ae){return Object.prototype.hasOwnProperty.call(F,ae)}var $=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;n.promisify=function(ae){if(typeof ae!="function")throw new TypeError('The "original" argument must be of type Function');if($&&ae[$]){var fe=ae[$];if(typeof fe!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(fe,$,{value:fe,enumerable:!1,writable:!1,configurable:!0}),fe}function fe(){for(var I,O,J=new Promise(function(V,K){I=V,O=K}),X=[],ue=0;ue<arguments.length;ue++)X.push(arguments[ue]);X.push(function(V,K){V?O(V):I(K)});try{ae.apply(this,X)}catch(V){O(V)}return J}return Object.setPrototypeOf(fe,Object.getPrototypeOf(ae)),$&&Object.defineProperty(fe,$,{value:fe,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(fe,t(ae))},n.promisify.custom=$;function ve(F,ae){if(!F){var fe=new Error("Promise was rejected with a falsy value");fe.reason=F,F=fe}return ae(F)}function Te(F){if(typeof F!="function")throw new TypeError('The "original" argument must be of type Function');function ae(){for(var fe=[],I=0;I<arguments.length;I++)fe.push(arguments[I]);var O=fe.pop();if(typeof O!="function")throw new TypeError("The last argument must be of type Function");var J=this,X=function(){return O.apply(J,arguments)};F.apply(this,fe).then(function(ue){ot.nextTick(X.bind(null,null,ue))},function(ue){ot.nextTick(ve.bind(null,ue,X))})}return Object.setPrototypeOf(ae,Object.getPrototypeOf(F)),Object.defineProperties(ae,t(F)),ae}n.callbackify=Te}(S1)),S1}var SA,bj;function Soe(){if(bj)return SA;bj=1;function n(_,w){var S=Object.keys(_);if(Object.getOwnPropertySymbols){var E=Object.getOwnPropertySymbols(_);w&&(E=E.filter(function(C){return Object.getOwnPropertyDescriptor(_,C).enumerable})),S.push.apply(S,E)}return S}function e(_){for(var w=1;w<arguments.length;w++){var S=arguments[w]!=null?arguments[w]:{};w%2?n(Object(S),!0).forEach(function(E){t(_,E,S[E])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_,Object.getOwnPropertyDescriptors(S)):n(Object(S)).forEach(function(E){Object.defineProperty(_,E,Object.getOwnPropertyDescriptor(S,E))})}return _}function t(_,w,S){return w=s(w),w in _?Object.defineProperty(_,w,{value:S,enumerable:!0,configurable:!0,writable:!0}):_[w]=S,_}function r(_,w){if(!(_ instanceof w))throw new TypeError("Cannot call a class as a function")}function i(_,w){for(var S=0;S<w.length;S++){var E=w[S];E.enumerable=E.enumerable||!1,E.configurable=!0,"value"in E&&(E.writable=!0),Object.defineProperty(_,s(E.key),E)}}function a(_,w,S){return w&&i(_.prototype,w),Object.defineProperty(_,"prototype",{writable:!1}),_}function s(_){var w=o(_,"string");return typeof w=="symbol"?w:String(w)}function o(_,w){if(typeof _!="object"||_===null)return _;var S=_[Symbol.toPrimitive];if(S!==void 0){var E=S.call(_,w);if(typeof E!="object")return E;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(_)}var u=Zb(),c=u.Buffer,d=Mq(),h=d.inspect,m=h&&h.custom||"inspect";function g(_,w,S){c.prototype.copy.call(_,w,S)}return SA=function(){function _(){r(this,_),this.head=null,this.tail=null,this.length=0}return a(_,[{key:"push",value:function(S){var E={data:S,next:null};this.length>0?this.tail.next=E:this.head=E,this.tail=E,++this.length}},{key:"unshift",value:function(S){var E={data:S,next:this.head};this.length===0&&(this.tail=E),this.head=E,++this.length}},{key:"shift",value:function(){if(this.length!==0){var S=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,S}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(S){if(this.length===0)return"";for(var E=this.head,C=""+E.data;E=E.next;)C+=S+E.data;return C}},{key:"concat",value:function(S){if(this.length===0)return c.alloc(0);for(var E=c.allocUnsafe(S>>>0),C=this.head,A=0;C;)g(C.data,E,A),A+=C.data.length,C=C.next;return E}},{key:"consume",value:function(S,E){var C;return S<this.head.data.length?(C=this.head.data.slice(0,S),this.head.data=this.head.data.slice(S)):S===this.head.data.length?C=this.shift():C=E?this._getString(S):this._getBuffer(S),C}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(S){var E=this.head,C=1,A=E.data;for(S-=A.length;E=E.next;){var R=E.data,P=S>R.length?R.length:S;if(P===R.length?A+=R:A+=R.slice(0,S),S-=P,S===0){P===R.length?(++C,E.next?this.head=E.next:this.head=this.tail=null):(this.head=E,E.data=R.slice(P));break}++C}return this.length-=C,A}},{key:"_getBuffer",value:function(S){var E=c.allocUnsafe(S),C=this.head,A=1;for(C.data.copy(E),S-=C.data.length;C=C.next;){var R=C.data,P=S>R.length?R.length:S;if(R.copy(E,E.length-S,0,P),S-=P,S===0){P===R.length?(++A,C.next?this.head=C.next:this.head=this.tail=null):(this.head=C,C.data=R.slice(P));break}++A}return this.length-=A,E}},{key:m,value:function(S,E){return h(this,e(e({},E),{},{depth:0,customInspect:!1}))}}]),_}(),SA}var TA,wj;function Dq(){if(wj)return TA;wj=1;function n(s,o){var u=this,c=this._readableState&&this._readableState.destroyed,d=this._writableState&&this._writableState.destroyed;return c||d?(o?o(s):s&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,ot.nextTick(i,this,s)):ot.nextTick(i,this,s)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(s||null,function(h){!o&&h?u._writableState?u._writableState.errorEmitted?ot.nextTick(t,u):(u._writableState.errorEmitted=!0,ot.nextTick(e,u,h)):ot.nextTick(e,u,h):o?(ot.nextTick(t,u),o(h)):ot.nextTick(t,u)}),this)}function e(s,o){i(s,o),t(s)}function t(s){s._writableState&&!s._writableState.emitClose||s._readableState&&!s._readableState.emitClose||s.emit("close")}function r(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function i(s,o){s.emit("error",o)}function a(s,o){var u=s._readableState,c=s._writableState;u&&u.autoDestroy||c&&c.autoDestroy?s.destroy(o):s.emit("error",o)}return TA={destroy:n,undestroy:r,errorOrDestroy:a},TA}var AA={},Ej;function Vd(){if(Ej)return AA;Ej=1;function n(o,u){o.prototype=Object.create(u.prototype),o.prototype.constructor=o,o.__proto__=u}var e={};function t(o,u,c){c||(c=Error);function d(m,g,_){return typeof u=="string"?u:u(m,g,_)}var h=function(m){n(g,m);function g(_,w,S){return m.call(this,d(_,w,S))||this}return g}(c);h.prototype.name=c.name,h.prototype.code=o,e[o]=h}function r(o,u){if(Array.isArray(o)){var c=o.length;return o=o.map(function(d){return String(d)}),c>2?"one of ".concat(u," ").concat(o.slice(0,c-1).join(", "),", or ")+o[c-1]:c===2?"one of ".concat(u," ").concat(o[0]," or ").concat(o[1]):"of ".concat(u," ").concat(o[0])}else return"of ".concat(u," ").concat(String(o))}function i(o,u,c){return o.substr(0,u.length)===u}function a(o,u,c){return(c===void 0||c>o.length)&&(c=o.length),o.substring(c-u.length,c)===u}function s(o,u,c){return typeof c!="number"&&(c=0),c+u.length>o.length?!1:o.indexOf(u,c)!==-1}return t("ERR_INVALID_OPT_VALUE",function(o,u){return'The value "'+u+'" is invalid for option "'+o+'"'},TypeError),t("ERR_INVALID_ARG_TYPE",function(o,u,c){var d;typeof u=="string"&&i(u,"not ")?(d="must not be",u=u.replace(/^not /,"")):d="must be";var h;if(a(o," argument"))h="The ".concat(o," ").concat(d," ").concat(r(u,"type"));else{var m=s(o,".")?"property":"argument";h='The "'.concat(o,'" ').concat(m," ").concat(d," ").concat(r(u,"type"))}return h+=". Received type ".concat(typeof c),h},TypeError),t("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),t("ERR_METHOD_NOT_IMPLEMENTED",function(o){return"The "+o+" method is not implemented"}),t("ERR_STREAM_PREMATURE_CLOSE","Premature close"),t("ERR_STREAM_DESTROYED",function(o){return"Cannot call "+o+" after a stream was destroyed"}),t("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),t("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),t("ERR_STREAM_WRITE_AFTER_END","write after end"),t("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),t("ERR_UNKNOWN_ENCODING",function(o){return"Unknown encoding: "+o},TypeError),t("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),AA.codes=e,AA}var CA,Sj;function $q(){if(Sj)return CA;Sj=1;var n=Vd().codes.ERR_INVALID_OPT_VALUE;function e(r,i,a){return r.highWaterMark!=null?r.highWaterMark:i?r[a]:null}function t(r,i,a,s){var o=e(i,s,a);if(o!=null){if(!(isFinite(o)&&Math.floor(o)===o)||o<0){var u=s?a:"highWaterMark";throw new n(u,o)}return Math.floor(o)}return r.objectMode?16:16*1024}return CA={getHighWaterMark:t},CA}var xA,Tj;function Toe(){if(Tj)return xA;Tj=1,xA=n;function n(t,r){if(e("noDeprecation"))return t;var i=!1;function a(){if(!i){if(e("throwDeprecation"))throw new Error(r);e("traceDeprecation")?console.trace(r):console.warn(r),i=!0}return t.apply(this,arguments)}return a}function e(t){try{if(!window.localStorage)return!1}catch{return!1}var r=window.localStorage[t];return r==null?!1:String(r).toLowerCase()==="true"}return xA}var RA,Aj;function Lq(){if(Aj)return RA;Aj=1,RA=k;function n(I){var O=this;this.next=null,this.entry=null,this.finish=function(){fe(O,I)}}var e;k.WritableState=N;var t={deprecate:Toe()},r=Tq(),i=Zb().Buffer,a=(typeof window<"u"||typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function s(I){return i.from(I)}function o(I){return i.isBuffer(I)||I instanceof a}var u=Dq(),c=$q(),d=c.getHighWaterMark,h=Vd().codes,m=h.ERR_INVALID_ARG_TYPE,g=h.ERR_METHOD_NOT_IMPLEMENTED,_=h.ERR_MULTIPLE_CALLBACK,w=h.ERR_STREAM_CANNOT_PIPE,S=h.ERR_STREAM_DESTROYED,E=h.ERR_STREAM_NULL_VALUES,C=h.ERR_STREAM_WRITE_AFTER_END,A=h.ERR_UNKNOWN_ENCODING,R=u.errorOrDestroy;Oc()(k,r);function P(){}function N(I,O,J){e=e||Cd(),I=I||{},typeof J!="boolean"&&(J=O instanceof e),this.objectMode=!!I.objectMode,J&&(this.objectMode=this.objectMode||!!I.writableObjectMode),this.highWaterMark=d(this,I,"writableHighWaterMark",J),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var X=I.decodeStrings===!1;this.decodeStrings=!X,this.defaultEncoding=I.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(ue){ee(O,ue)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=I.emitClose!==!1,this.autoDestroy=!!I.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new n(this)}N.prototype.getBuffer=function(){for(var O=this.bufferedRequest,J=[];O;)J.push(O),O=O.next;return J},function(){try{Object.defineProperty(N.prototype,"buffer",{get:t.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var U;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(U=Function.prototype[Symbol.hasInstance],Object.defineProperty(k,Symbol.hasInstance,{value:function(O){return U.call(this,O)?!0:this!==k?!1:O&&O._writableState instanceof N}})):U=function(O){return O instanceof this};function k(I){e=e||Cd();var O=this instanceof e;if(!O&&!U.call(k,this))return new k(I);this._writableState=new N(I,this,O),this.writable=!0,I&&(typeof I.write=="function"&&(this._write=I.write),typeof I.writev=="function"&&(this._writev=I.writev),typeof I.destroy=="function"&&(this._destroy=I.destroy),typeof I.final=="function"&&(this._final=I.final)),r.call(this)}k.prototype.pipe=function(){R(this,new w)};function B(I,O){var J=new C;R(I,J),ot.nextTick(O,J)}function H(I,O,J,X){var ue;return J===null?ue=new E:typeof J!="string"&&!O.objectMode&&(ue=new m("chunk",["string","Buffer"],J)),ue?(R(I,ue),ot.nextTick(X,ue),!1):!0}k.prototype.write=function(I,O,J){var X=this._writableState,ue=!1,V=!X.objectMode&&o(I);return V&&!i.isBuffer(I)&&(I=s(I)),typeof O=="function"&&(J=O,O=null),V?O="buffer":O||(O=X.defaultEncoding),typeof J!="function"&&(J=P),X.ending?B(this,J):(V||H(this,X,I,J))&&(X.pendingcb++,ue=z(this,X,V,I,O,J)),ue},k.prototype.cork=function(){this._writableState.corked++},k.prototype.uncork=function(){var I=this._writableState;I.corked&&(I.corked--,!I.writing&&!I.corked&&!I.bufferProcessing&&I.bufferedRequest&&we(this,I))},k.prototype.setDefaultEncoding=function(O){if(typeof O=="string"&&(O=O.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((O+"").toLowerCase())>-1))throw new A(O);return this._writableState.defaultEncoding=O,this},Object.defineProperty(k.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function G(I,O,J){return!I.objectMode&&I.decodeStrings!==!1&&typeof O=="string"&&(O=i.from(O,J)),O}Object.defineProperty(k.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function z(I,O,J,X,ue,V){if(!J){var K=G(O,X,ue);X!==K&&(J=!0,ue="buffer",X=K)}var _e=O.objectMode?1:X.length;O.length+=_e;var Me=O.length<O.highWaterMark;if(Me||(O.needDrain=!0),O.writing||O.corked){var tt=O.lastBufferedRequest;O.lastBufferedRequest={chunk:X,encoding:ue,isBuf:J,callback:V,next:null},tt?tt.next=O.lastBufferedRequest:O.bufferedRequest=O.lastBufferedRequest,O.bufferedRequestCount+=1}else oe(I,O,!1,_e,X,ue,V);return Me}function oe(I,O,J,X,ue,V,K){O.writelen=X,O.writecb=K,O.writing=!0,O.sync=!0,O.destroyed?O.onwrite(new S("write")):J?I._writev(ue,O.onwrite):I._write(ue,V,O.onwrite),O.sync=!1}function te(I,O,J,X,ue){--O.pendingcb,J?(ot.nextTick(ue,X),ot.nextTick(F,I,O),I._writableState.errorEmitted=!0,R(I,X)):(ue(X),I._writableState.errorEmitted=!0,R(I,X),F(I,O))}function se(I){I.writing=!1,I.writecb=null,I.length-=I.writelen,I.writelen=0}function ee(I,O){var J=I._writableState,X=J.sync,ue=J.writecb;if(typeof ue!="function")throw new _;if(se(J),O)te(I,J,X,O,ue);else{var V=$(J)||I.destroyed;!V&&!J.corked&&!J.bufferProcessing&&J.bufferedRequest&&we(I,J),X?ot.nextTick(le,I,J,V,ue):le(I,J,V,ue)}}function le(I,O,J,X){J||pe(I,O),O.pendingcb--,X(),F(I,O)}function pe(I,O){O.length===0&&O.needDrain&&(O.needDrain=!1,I.emit("drain"))}function we(I,O){O.bufferProcessing=!0;var J=O.bufferedRequest;if(I._writev&&J&&J.next){var X=O.bufferedRequestCount,ue=new Array(X),V=O.corkedRequestsFree;V.entry=J;for(var K=0,_e=!0;J;)ue[K]=J,J.isBuf||(_e=!1),J=J.next,K+=1;ue.allBuffers=_e,oe(I,O,!0,O.length,ue,"",V.finish),O.pendingcb++,O.lastBufferedRequest=null,V.next?(O.corkedRequestsFree=V.next,V.next=null):O.corkedRequestsFree=new n(O),O.bufferedRequestCount=0}else{for(;J;){var Me=J.chunk,tt=J.encoding,je=J.callback,We=O.objectMode?1:Me.length;if(oe(I,O,!1,We,Me,tt,je),J=J.next,O.bufferedRequestCount--,O.writing)break}J===null&&(O.lastBufferedRequest=null)}O.bufferedRequest=J,O.bufferProcessing=!1}k.prototype._write=function(I,O,J){J(new g("_write()"))},k.prototype._writev=null,k.prototype.end=function(I,O,J){var X=this._writableState;return typeof I=="function"?(J=I,I=null,O=null):typeof O=="function"&&(J=O,O=null),I!=null&&this.write(I,O),X.corked&&(X.corked=1,this.uncork()),X.ending||ae(this,X,J),this},Object.defineProperty(k.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function $(I){return I.ending&&I.length===0&&I.bufferedRequest===null&&!I.finished&&!I.writing}function ve(I,O){I._final(function(J){O.pendingcb--,J&&R(I,J),O.prefinished=!0,I.emit("prefinish"),F(I,O)})}function Te(I,O){!O.prefinished&&!O.finalCalled&&(typeof I._final=="function"&&!O.destroyed?(O.pendingcb++,O.finalCalled=!0,ot.nextTick(ve,I,O)):(O.prefinished=!0,I.emit("prefinish")))}function F(I,O){var J=$(O);if(J&&(Te(I,O),O.pendingcb===0&&(O.finished=!0,I.emit("finish"),O.autoDestroy))){var X=I._readableState;(!X||X.autoDestroy&&X.endEmitted)&&I.destroy()}return J}function ae(I,O,J){O.ending=!0,F(I,O),J&&(O.finished?ot.nextTick(J):I.once("finish",J)),O.ended=!0,I.writable=!1}function fe(I,O,J){var X=I.entry;for(I.entry=null;X;){var ue=X.callback;O.pendingcb--,ue(J),X=X.next}O.corkedRequestsFree.next=I}return Object.defineProperty(k.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(O){this._writableState&&(this._writableState.destroyed=O)}}),k.prototype.destroy=u.destroy,k.prototype._undestroy=u.undestroy,k.prototype._destroy=function(I,O){O(I)},RA}var IA,Cj;function Cd(){if(Cj)return IA;Cj=1;var n=Object.keys||function(c){var d=[];for(var h in c)d.push(h);return d};IA=s;var e=Uq(),t=Lq();Oc()(s,e);for(var r=n(t.prototype),i=0;i<r.length;i++){var a=r[i];s.prototype[a]||(s.prototype[a]=t.prototype[a])}function s(c){if(!(this instanceof s))return new s(c);e.call(this,c),t.call(this,c),this.allowHalfOpen=!0,c&&(c.readable===!1&&(this.readable=!1),c.writable===!1&&(this.writable=!1),c.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",o)))}Object.defineProperty(s.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(s.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(s.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function o(){this._writableState.ended||ot.nextTick(u,this)}function u(c){c.end()}return Object.defineProperty(s.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(d){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=d,this._writableState.destroyed=d)}}),IA}var PA={},Ky={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var xj;function Aoe(){return xj||(xj=1,function(n,e){var t=Zb(),r=t.Buffer;function i(s,o){for(var u in s)o[u]=s[u]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?n.exports=t:(i(t,e),e.Buffer=a);function a(s,o,u){return r(s,o,u)}a.prototype=Object.create(r.prototype),i(r,a),a.from=function(s,o,u){if(typeof s=="number")throw new TypeError("Argument must not be a number");return r(s,o,u)},a.alloc=function(s,o,u){if(typeof s!="number")throw new TypeError("Argument must be a number");var c=r(s);return o!==void 0?typeof u=="string"?c.fill(o,u):c.fill(o):c.fill(0),c},a.allocUnsafe=function(s){if(typeof s!="number")throw new TypeError("Argument must be a number");return r(s)},a.allocUnsafeSlow=function(s){if(typeof s!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(s)}}(Ky,Ky.exports)),Ky.exports}var Rj;function Ij(){if(Rj)return PA;Rj=1;var n=Aoe().Buffer,e=n.isEncoding||function(E){switch(E=""+E,E&&E.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function t(E){if(!E)return"utf8";for(var C;;)switch(E){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return E;default:if(C)return;E=(""+E).toLowerCase(),C=!0}}function r(E){var C=t(E);if(typeof C!="string"&&(n.isEncoding===e||!e(E)))throw new Error("Unknown encoding: "+E);return C||E}PA.StringDecoder=i;function i(E){this.encoding=r(E);var C;switch(this.encoding){case"utf16le":this.text=h,this.end=m,C=4;break;case"utf8":this.fillLast=u,C=4;break;case"base64":this.text=g,this.end=_,C=3;break;default:this.write=w,this.end=S;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(C)}i.prototype.write=function(E){if(E.length===0)return"";var C,A;if(this.lastNeed){if(C=this.fillLast(E),C===void 0)return"";A=this.lastNeed,this.lastNeed=0}else A=0;return A<E.length?C?C+this.text(E,A):this.text(E,A):C||""},i.prototype.end=d,i.prototype.text=c,i.prototype.fillLast=function(E){if(this.lastNeed<=E.length)return E.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);E.copy(this.lastChar,this.lastTotal-this.lastNeed,0,E.length),this.lastNeed-=E.length};function a(E){return E<=127?0:E>>5===6?2:E>>4===14?3:E>>3===30?4:E>>6===2?-1:-2}function s(E,C,A){var R=C.length-1;if(R<A)return 0;var P=a(C[R]);return P>=0?(P>0&&(E.lastNeed=P-1),P):--R<A||P===-2?0:(P=a(C[R]),P>=0?(P>0&&(E.lastNeed=P-2),P):--R<A||P===-2?0:(P=a(C[R]),P>=0?(P>0&&(P===2?P=0:E.lastNeed=P-3),P):0))}function o(E,C,A){if((C[0]&192)!==128)return E.lastNeed=0,"�";if(E.lastNeed>1&&C.length>1){if((C[1]&192)!==128)return E.lastNeed=1,"�";if(E.lastNeed>2&&C.length>2&&(C[2]&192)!==128)return E.lastNeed=2,"�"}}function u(E){var C=this.lastTotal-this.lastNeed,A=o(this,E);if(A!==void 0)return A;if(this.lastNeed<=E.length)return E.copy(this.lastChar,C,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);E.copy(this.lastChar,C,0,E.length),this.lastNeed-=E.length}function c(E,C){var A=s(this,E,C);if(!this.lastNeed)return E.toString("utf8",C);this.lastTotal=A;var R=E.length-(A-this.lastNeed);return E.copy(this.lastChar,0,R),E.toString("utf8",C,R)}function d(E){var C=E&&E.length?this.write(E):"";return this.lastNeed?C+"�":C}function h(E,C){if((E.length-C)%2===0){var A=E.toString("utf16le",C);if(A){var R=A.charCodeAt(A.length-1);if(R>=55296&&R<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=E[E.length-2],this.lastChar[1]=E[E.length-1],A.slice(0,-1)}return A}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=E[E.length-1],E.toString("utf16le",C,E.length-1)}function m(E){var C=E&&E.length?this.write(E):"";if(this.lastNeed){var A=this.lastTotal-this.lastNeed;return C+this.lastChar.toString("utf16le",0,A)}return C}function g(E,C){var A=(E.length-C)%3;return A===0?E.toString("base64",C):(this.lastNeed=3-A,this.lastTotal=3,A===1?this.lastChar[0]=E[E.length-1]:(this.lastChar[0]=E[E.length-2],this.lastChar[1]=E[E.length-1]),E.toString("base64",C,E.length-A))}function _(E){var C=E&&E.length?this.write(E):"";return this.lastNeed?C+this.lastChar.toString("base64",0,3-this.lastNeed):C}function w(E){return E.toString(this.encoding)}function S(E){return E&&E.length?this.write(E):""}return PA}var OA,Pj;function oP(){if(Pj)return OA;Pj=1;var n=Vd().codes.ERR_STREAM_PREMATURE_CLOSE;function e(a){var s=!1;return function(){if(!s){s=!0;for(var o=arguments.length,u=new Array(o),c=0;c<o;c++)u[c]=arguments[c];a.apply(this,u)}}}function t(){}function r(a){return a.setHeader&&typeof a.abort=="function"}function i(a,s,o){if(typeof s=="function")return i(a,null,s);s||(s={}),o=e(o||t);var u=s.readable||s.readable!==!1&&a.readable,c=s.writable||s.writable!==!1&&a.writable,d=function(){a.writable||m()},h=a._writableState&&a._writableState.finished,m=function(){c=!1,h=!0,u||o.call(a)},g=a._readableState&&a._readableState.endEmitted,_=function(){u=!1,g=!0,c||o.call(a)},w=function(A){o.call(a,A)},S=function(){var A;if(u&&!g)return(!a._readableState||!a._readableState.ended)&&(A=new n),o.call(a,A);if(c&&!h)return(!a._writableState||!a._writableState.ended)&&(A=new n),o.call(a,A)},E=function(){a.req.on("finish",m)};return r(a)?(a.on("complete",m),a.on("abort",S),a.req?E():a.on("request",E)):c&&!a._writableState&&(a.on("end",d),a.on("close",d)),a.on("end",_),a.on("finish",m),s.error!==!1&&a.on("error",w),a.on("close",S),function(){a.removeListener("complete",m),a.removeListener("abort",S),a.removeListener("request",E),a.req&&a.req.removeListener("finish",m),a.removeListener("end",d),a.removeListener("close",d),a.removeListener("finish",m),a.removeListener("end",_),a.removeListener("error",w),a.removeListener("close",S)}}return OA=i,OA}var kA,Oj;function Coe(){if(Oj)return kA;Oj=1;var n;function e(A,R,P){return R=t(R),R in A?Object.defineProperty(A,R,{value:P,enumerable:!0,configurable:!0,writable:!0}):A[R]=P,A}function t(A){var R=r(A,"string");return typeof R=="symbol"?R:String(R)}function r(A,R){if(typeof A!="object"||A===null)return A;var P=A[Symbol.toPrimitive];if(P!==void 0){var N=P.call(A,R);if(typeof N!="object")return N;throw new TypeError("@@toPrimitive must return a primitive value.")}return(R==="string"?String:Number)(A)}var i=oP(),a=Symbol("lastResolve"),s=Symbol("lastReject"),o=Symbol("error"),u=Symbol("ended"),c=Symbol("lastPromise"),d=Symbol("handlePromise"),h=Symbol("stream");function m(A,R){return{value:A,done:R}}function g(A){var R=A[a];if(R!==null){var P=A[h].read();P!==null&&(A[c]=null,A[a]=null,A[s]=null,R(m(P,!1)))}}function _(A){ot.nextTick(g,A)}function w(A,R){return function(P,N){A.then(function(){if(R[u]){P(m(void 0,!0));return}R[d](P,N)},N)}}var S=Object.getPrototypeOf(function(){}),E=Object.setPrototypeOf((n={get stream(){return this[h]},next:function(){var R=this,P=this[o];if(P!==null)return Promise.reject(P);if(this[u])return Promise.resolve(m(void 0,!0));if(this[h].destroyed)return new Promise(function(B,H){ot.nextTick(function(){R[o]?H(R[o]):B(m(void 0,!0))})});var N=this[c],U;if(N)U=new Promise(w(N,this));else{var k=this[h].read();if(k!==null)return Promise.resolve(m(k,!1));U=new Promise(this[d])}return this[c]=U,U}},e(n,Symbol.asyncIterator,function(){return this}),e(n,"return",function(){var R=this;return new Promise(function(P,N){R[h].destroy(null,function(U){if(U){N(U);return}P(m(void 0,!0))})})}),n),S),C=function(R){var P,N=Object.create(E,(P={},e(P,h,{value:R,writable:!0}),e(P,a,{value:null,writable:!0}),e(P,s,{value:null,writable:!0}),e(P,o,{value:null,writable:!0}),e(P,u,{value:R._readableState.endEmitted,writable:!0}),e(P,d,{value:function(k,B){var H=N[h].read();H?(N[c]=null,N[a]=null,N[s]=null,k(m(H,!1))):(N[a]=k,N[s]=B)},writable:!0}),P));return N[c]=null,i(R,function(U){if(U&&U.code!=="ERR_STREAM_PREMATURE_CLOSE"){var k=N[s];k!==null&&(N[c]=null,N[a]=null,N[s]=null,k(U)),N[o]=U;return}var B=N[a];B!==null&&(N[c]=null,N[a]=null,N[s]=null,B(m(void 0,!0))),N[u]=!0}),R.on("readable",_.bind(null,N)),N};return kA=C,kA}var NA,kj;function xoe(){return kj||(kj=1,NA=function(){throw new Error("Readable.from is not available in the browser")}),NA}var MA,Nj;function Uq(){if(Nj)return MA;Nj=1,MA=B;var n;B.ReadableState=k,nP().EventEmitter;var e=function(K,_e){return K.listeners(_e).length},t=Tq(),r=Zb().Buffer,i=(typeof window<"u"||typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function a(V){return r.from(V)}function s(V){return r.isBuffer(V)||V instanceof i}var o=Mq(),u;o&&o.debuglog?u=o.debuglog("stream"):u=function(){};var c=Soe(),d=Dq(),h=$q(),m=h.getHighWaterMark,g=Vd().codes,_=g.ERR_INVALID_ARG_TYPE,w=g.ERR_STREAM_PUSH_AFTER_EOF,S=g.ERR_METHOD_NOT_IMPLEMENTED,E=g.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,C,A,R;Oc()(B,t);var P=d.errorOrDestroy,N=["error","close","destroy","pause","resume"];function U(V,K,_e){if(typeof V.prependListener=="function")return V.prependListener(K,_e);!V._events||!V._events[K]?V.on(K,_e):Array.isArray(V._events[K])?V._events[K].unshift(_e):V._events[K]=[_e,V._events[K]]}function k(V,K,_e){n=n||Cd(),V=V||{},typeof _e!="boolean"&&(_e=K instanceof n),this.objectMode=!!V.objectMode,_e&&(this.objectMode=this.objectMode||!!V.readableObjectMode),this.highWaterMark=m(this,V,"readableHighWaterMark",_e),this.buffer=new c,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=V.emitClose!==!1,this.autoDestroy=!!V.autoDestroy,this.destroyed=!1,this.defaultEncoding=V.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,V.encoding&&(C||(C=Ij().StringDecoder),this.decoder=new C(V.encoding),this.encoding=V.encoding)}function B(V){if(n=n||Cd(),!(this instanceof B))return new B(V);var K=this instanceof n;this._readableState=new k(V,this,K),this.readable=!0,V&&(typeof V.read=="function"&&(this._read=V.read),typeof V.destroy=="function"&&(this._destroy=V.destroy)),t.call(this)}Object.defineProperty(B.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(K){this._readableState&&(this._readableState.destroyed=K)}}),B.prototype.destroy=d.destroy,B.prototype._undestroy=d.undestroy,B.prototype._destroy=function(V,K){K(V)},B.prototype.push=function(V,K){var _e=this._readableState,Me;return _e.objectMode?Me=!0:typeof V=="string"&&(K=K||_e.defaultEncoding,K!==_e.encoding&&(V=r.from(V,K),K=""),Me=!0),H(this,V,K,!1,Me)},B.prototype.unshift=function(V){return H(this,V,null,!0,!1)};function H(V,K,_e,Me,tt){u("readableAddChunk",K);var je=V._readableState;if(K===null)je.reading=!1,ee(V,je);else{var We;if(tt||(We=z(je,K)),We)P(V,We);else if(je.objectMode||K&&K.length>0)if(typeof K!="string"&&!je.objectMode&&Object.getPrototypeOf(K)!==r.prototype&&(K=a(K)),Me)je.endEmitted?P(V,new E):G(V,je,K,!0);else if(je.ended)P(V,new w);else{if(je.destroyed)return!1;je.reading=!1,je.decoder&&!_e?(K=je.decoder.write(K),je.objectMode||K.length!==0?G(V,je,K,!1):we(V,je)):G(V,je,K,!1)}else Me||(je.reading=!1,we(V,je))}return!je.ended&&(je.length<je.highWaterMark||je.length===0)}function G(V,K,_e,Me){K.flowing&&K.length===0&&!K.sync?(K.awaitDrain=0,V.emit("data",_e)):(K.length+=K.objectMode?1:_e.length,Me?K.buffer.unshift(_e):K.buffer.push(_e),K.needReadable&&le(V)),we(V,K)}function z(V,K){var _e;return!s(K)&&typeof K!="string"&&K!==void 0&&!V.objectMode&&(_e=new _("chunk",["string","Buffer","Uint8Array"],K)),_e}B.prototype.isPaused=function(){return this._readableState.flowing===!1},B.prototype.setEncoding=function(V){C||(C=Ij().StringDecoder);var K=new C(V);this._readableState.decoder=K,this._readableState.encoding=this._readableState.decoder.encoding;for(var _e=this._readableState.buffer.head,Me="";_e!==null;)Me+=K.write(_e.data),_e=_e.next;return this._readableState.buffer.clear(),Me!==""&&this._readableState.buffer.push(Me),this._readableState.length=Me.length,this};var oe=1073741824;function te(V){return V>=oe?V=oe:(V--,V|=V>>>1,V|=V>>>2,V|=V>>>4,V|=V>>>8,V|=V>>>16,V++),V}function se(V,K){return V<=0||K.length===0&&K.ended?0:K.objectMode?1:V!==V?K.flowing&&K.length?K.buffer.head.data.length:K.length:(V>K.highWaterMark&&(K.highWaterMark=te(V)),V<=K.length?V:K.ended?K.length:(K.needReadable=!0,0))}B.prototype.read=function(V){u("read",V),V=parseInt(V,10);var K=this._readableState,_e=V;if(V!==0&&(K.emittedReadable=!1),V===0&&K.needReadable&&((K.highWaterMark!==0?K.length>=K.highWaterMark:K.length>0)||K.ended))return u("read: emitReadable",K.length,K.ended),K.length===0&&K.ended?J(this):le(this),null;if(V=se(V,K),V===0&&K.ended)return K.length===0&&J(this),null;var Me=K.needReadable;u("need readable",Me),(K.length===0||K.length-V<K.highWaterMark)&&(Me=!0,u("length less than watermark",Me)),K.ended||K.reading?(Me=!1,u("reading or ended",Me)):Me&&(u("do read"),K.reading=!0,K.sync=!0,K.length===0&&(K.needReadable=!0),this._read(K.highWaterMark),K.sync=!1,K.reading||(V=se(_e,K)));var tt;return V>0?tt=O(V,K):tt=null,tt===null?(K.needReadable=K.length<=K.highWaterMark,V=0):(K.length-=V,K.awaitDrain=0),K.length===0&&(K.ended||(K.needReadable=!0),_e!==V&&K.ended&&J(this)),tt!==null&&this.emit("data",tt),tt};function ee(V,K){if(u("onEofChunk"),!K.ended){if(K.decoder){var _e=K.decoder.end();_e&&_e.length&&(K.buffer.push(_e),K.length+=K.objectMode?1:_e.length)}K.ended=!0,K.sync?le(V):(K.needReadable=!1,K.emittedReadable||(K.emittedReadable=!0,pe(V)))}}function le(V){var K=V._readableState;u("emitReadable",K.needReadable,K.emittedReadable),K.needReadable=!1,K.emittedReadable||(u("emitReadable",K.flowing),K.emittedReadable=!0,ot.nextTick(pe,V))}function pe(V){var K=V._readableState;u("emitReadable_",K.destroyed,K.length,K.ended),!K.destroyed&&(K.length||K.ended)&&(V.emit("readable"),K.emittedReadable=!1),K.needReadable=!K.flowing&&!K.ended&&K.length<=K.highWaterMark,I(V)}function we(V,K){K.readingMore||(K.readingMore=!0,ot.nextTick($,V,K))}function $(V,K){for(;!K.reading&&!K.ended&&(K.length<K.highWaterMark||K.flowing&&K.length===0);){var _e=K.length;if(u("maybeReadMore read 0"),V.read(0),_e===K.length)break}K.readingMore=!1}B.prototype._read=function(V){P(this,new S("_read()"))},B.prototype.pipe=function(V,K){var _e=this,Me=this._readableState;switch(Me.pipesCount){case 0:Me.pipes=V;break;case 1:Me.pipes=[Me.pipes,V];break;default:Me.pipes.push(V);break}Me.pipesCount+=1,u("pipe count=%d opts=%j",Me.pipesCount,K);var tt=(!K||K.end!==!1)&&V!==ot.stdout&&V!==ot.stderr,je=tt?Ot:he;Me.endEmitted?ot.nextTick(je):_e.once("end",je),V.on("unpipe",We);function We(Ie,Be){u("onunpipe"),Ie===_e&&Be&&Be.hasUnpiped===!1&&(Be.hasUnpiped=!0,At())}function Ot(){u("onend"),V.end()}var Pe=ve(_e);V.on("drain",Pe);var He=!1;function At(){u("cleanup"),V.removeListener("close",it),V.removeListener("finish",Ze),V.removeListener("drain",Pe),V.removeListener("error",ze),V.removeListener("unpipe",We),_e.removeListener("end",Ot),_e.removeListener("end",he),_e.removeListener("data",Ge),He=!0,Me.awaitDrain&&(!V._writableState||V._writableState.needDrain)&&Pe()}_e.on("data",Ge);function Ge(Ie){u("ondata");var Be=V.write(Ie);u("dest.write",Be),Be===!1&&((Me.pipesCount===1&&Me.pipes===V||Me.pipesCount>1&&ue(Me.pipes,V)!==-1)&&!He&&(u("false write response, pause",Me.awaitDrain),Me.awaitDrain++),_e.pause())}function ze(Ie){u("onerror",Ie),he(),V.removeListener("error",ze),e(V,"error")===0&&P(V,Ie)}U(V,"error",ze);function it(){V.removeListener("finish",Ze),he()}V.once("close",it);function Ze(){u("onfinish"),V.removeListener("close",it),he()}V.once("finish",Ze);function he(){u("unpipe"),_e.unpipe(V)}return V.emit("pipe",_e),Me.flowing||(u("pipe resume"),_e.resume()),V};function ve(V){return function(){var _e=V._readableState;u("pipeOnDrain",_e.awaitDrain),_e.awaitDrain&&_e.awaitDrain--,_e.awaitDrain===0&&e(V,"data")&&(_e.flowing=!0,I(V))}}B.prototype.unpipe=function(V){var K=this._readableState,_e={hasUnpiped:!1};if(K.pipesCount===0)return this;if(K.pipesCount===1)return V&&V!==K.pipes?this:(V||(V=K.pipes),K.pipes=null,K.pipesCount=0,K.flowing=!1,V&&V.emit("unpipe",this,_e),this);if(!V){var Me=K.pipes,tt=K.pipesCount;K.pipes=null,K.pipesCount=0,K.flowing=!1;for(var je=0;je<tt;je++)Me[je].emit("unpipe",this,{hasUnpiped:!1});return this}var We=ue(K.pipes,V);return We===-1?this:(K.pipes.splice(We,1),K.pipesCount-=1,K.pipesCount===1&&(K.pipes=K.pipes[0]),V.emit("unpipe",this,_e),this)},B.prototype.on=function(V,K){var _e=t.prototype.on.call(this,V,K),Me=this._readableState;return V==="data"?(Me.readableListening=this.listenerCount("readable")>0,Me.flowing!==!1&&this.resume()):V==="readable"&&!Me.endEmitted&&!Me.readableListening&&(Me.readableListening=Me.needReadable=!0,Me.flowing=!1,Me.emittedReadable=!1,u("on readable",Me.length,Me.reading),Me.length?le(this):Me.reading||ot.nextTick(F,this)),_e},B.prototype.addListener=B.prototype.on,B.prototype.removeListener=function(V,K){var _e=t.prototype.removeListener.call(this,V,K);return V==="readable"&&ot.nextTick(Te,this),_e},B.prototype.removeAllListeners=function(V){var K=t.prototype.removeAllListeners.apply(this,arguments);return(V==="readable"||V===void 0)&&ot.nextTick(Te,this),K};function Te(V){var K=V._readableState;K.readableListening=V.listenerCount("readable")>0,K.resumeScheduled&&!K.paused?K.flowing=!0:V.listenerCount("data")>0&&V.resume()}function F(V){u("readable nexttick read 0"),V.read(0)}B.prototype.resume=function(){var V=this._readableState;return V.flowing||(u("resume"),V.flowing=!V.readableListening,ae(this,V)),V.paused=!1,this};function ae(V,K){K.resumeScheduled||(K.resumeScheduled=!0,ot.nextTick(fe,V,K))}function fe(V,K){u("resume",K.reading),K.reading||V.read(0),K.resumeScheduled=!1,V.emit("resume"),I(V),K.flowing&&!K.reading&&V.read(0)}B.prototype.pause=function(){return u("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(u("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function I(V){var K=V._readableState;for(u("flow",K.flowing);K.flowing&&V.read()!==null;);}B.prototype.wrap=function(V){var K=this,_e=this._readableState,Me=!1;V.on("end",function(){if(u("wrapped end"),_e.decoder&&!_e.ended){var We=_e.decoder.end();We&&We.length&&K.push(We)}K.push(null)}),V.on("data",function(We){if(u("wrapped data"),_e.decoder&&(We=_e.decoder.write(We)),!(_e.objectMode&&We==null)&&!(!_e.objectMode&&(!We||!We.length))){var Ot=K.push(We);Ot||(Me=!0,V.pause())}});for(var tt in V)this[tt]===void 0&&typeof V[tt]=="function"&&(this[tt]=function(Ot){return function(){return V[Ot].apply(V,arguments)}}(tt));for(var je=0;je<N.length;je++)V.on(N[je],this.emit.bind(this,N[je]));return this._read=function(We){u("wrapped _read",We),Me&&(Me=!1,V.resume())},this},typeof Symbol=="function"&&(B.prototype[Symbol.asyncIterator]=function(){return A===void 0&&(A=Coe()),A(this)}),Object.defineProperty(B.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(B.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(B.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(K){this._readableState&&(this._readableState.flowing=K)}}),B._fromList=O,Object.defineProperty(B.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function O(V,K){if(K.length===0)return null;var _e;return K.objectMode?_e=K.buffer.shift():!V||V>=K.length?(K.decoder?_e=K.buffer.join(""):K.buffer.length===1?_e=K.buffer.first():_e=K.buffer.concat(K.length),K.buffer.clear()):_e=K.buffer.consume(V,K.decoder),_e}function J(V){var K=V._readableState;u("endReadable",K.endEmitted),K.endEmitted||(K.ended=!0,ot.nextTick(X,K,V))}function X(V,K){if(u("endReadableNT",V.endEmitted,V.length),!V.endEmitted&&V.length===0&&(V.endEmitted=!0,K.readable=!1,K.emit("end"),V.autoDestroy)){var _e=K._writableState;(!_e||_e.autoDestroy&&_e.finished)&&K.destroy()}}typeof Symbol=="function"&&(B.from=function(V,K){return R===void 0&&(R=xoe()),R(B,V,K)});function ue(V,K){for(var _e=0,Me=V.length;_e<Me;_e++)if(V[_e]===K)return _e;return-1}return MA}var DA,Mj;function jq(){if(Mj)return DA;Mj=1,DA=o;var n=Vd().codes,e=n.ERR_METHOD_NOT_IMPLEMENTED,t=n.ERR_MULTIPLE_CALLBACK,r=n.ERR_TRANSFORM_ALREADY_TRANSFORMING,i=n.ERR_TRANSFORM_WITH_LENGTH_0,a=Cd();Oc()(o,a);function s(d,h){var m=this._transformState;m.transforming=!1;var g=m.writecb;if(g===null)return this.emit("error",new t);m.writechunk=null,m.writecb=null,h!=null&&this.push(h),g(d);var _=this._readableState;_.reading=!1,(_.needReadable||_.length<_.highWaterMark)&&this._read(_.highWaterMark)}function o(d){if(!(this instanceof o))return new o(d);a.call(this,d),this._transformState={afterTransform:s.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,d&&(typeof d.transform=="function"&&(this._transform=d.transform),typeof d.flush=="function"&&(this._flush=d.flush)),this.on("prefinish",u)}function u(){var d=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(h,m){c(d,h,m)}):c(this,null,null)}o.prototype.push=function(d,h){return this._transformState.needTransform=!1,a.prototype.push.call(this,d,h)},o.prototype._transform=function(d,h,m){m(new e("_transform()"))},o.prototype._write=function(d,h,m){var g=this._transformState;if(g.writecb=m,g.writechunk=d,g.writeencoding=h,!g.transforming){var _=this._readableState;(g.needTransform||_.needReadable||_.length<_.highWaterMark)&&this._read(_.highWaterMark)}},o.prototype._read=function(d){var h=this._transformState;h.writechunk!==null&&!h.transforming?(h.transforming=!0,this._transform(h.writechunk,h.writeencoding,h.afterTransform)):h.needTransform=!0},o.prototype._destroy=function(d,h){a.prototype._destroy.call(this,d,function(m){h(m)})};function c(d,h,m){if(h)return d.emit("error",h);if(m!=null&&d.push(m),d._writableState.length)throw new i;if(d._transformState.transforming)throw new r;return d.push(null)}return DA}var $A,Dj;function Roe(){if(Dj)return $A;Dj=1,$A=e;var n=jq();Oc()(e,n);function e(t){if(!(this instanceof e))return new e(t);n.call(this,t)}return e.prototype._transform=function(t,r,i){i(null,t)},$A}var LA,$j;function Ioe(){if($j)return LA;$j=1;var n;function e(m){var g=!1;return function(){g||(g=!0,m.apply(void 0,arguments))}}var t=Vd().codes,r=t.ERR_MISSING_ARGS,i=t.ERR_STREAM_DESTROYED;function a(m){if(m)throw m}function s(m){return m.setHeader&&typeof m.abort=="function"}function o(m,g,_,w){w=e(w);var S=!1;m.on("close",function(){S=!0}),n===void 0&&(n=oP()),n(m,{readable:g,writable:_},function(C){if(C)return w(C);S=!0,w()});var E=!1;return function(C){if(!S&&!E){if(E=!0,s(m))return m.abort();if(typeof m.destroy=="function")return m.destroy();w(C||new i("pipe"))}}}function u(m){m()}function c(m,g){return m.pipe(g)}function d(m){return!m.length||typeof m[m.length-1]!="function"?a:m.pop()}function h(){for(var m=arguments.length,g=new Array(m),_=0;_<m;_++)g[_]=arguments[_];var w=d(g);if(Array.isArray(g[0])&&(g=g[0]),g.length<2)throw new r("streams");var S,E=g.map(function(C,A){var R=A<g.length-1,P=A>0;return o(C,R,P,function(N){S||(S=N),N&&E.forEach(u),!R&&(E.forEach(u),w(S))})});return g.reduce(c)}return LA=h,LA}var UA,Lj;function Poe(){if(Lj)return UA;Lj=1,UA=t;var n=nP().EventEmitter,e=Oc();e(t,n),t.Readable=Uq(),t.Writable=Lq(),t.Duplex=Cd(),t.Transform=jq(),t.PassThrough=Roe(),t.finished=oP(),t.pipeline=Ioe(),t.Stream=t;function t(){n.call(this)}return t.prototype.pipe=function(r,i){var a=this;function s(g){r.writable&&r.write(g)===!1&&a.pause&&a.pause()}a.on("data",s);function o(){a.readable&&a.resume&&a.resume()}r.on("drain",o),!r._isStdio&&(!i||i.end!==!1)&&(a.on("end",c),a.on("close",d));var u=!1;function c(){u||(u=!0,r.end())}function d(){u||(u=!0,typeof r.destroy=="function"&&r.destroy())}function h(g){if(m(),n.listenerCount(this,"error")===0)throw g}a.on("error",h),r.on("error",h);function m(){a.removeListener("data",s),r.removeListener("drain",o),a.removeListener("end",c),a.removeListener("close",d),a.removeListener("error",h),r.removeListener("error",h),a.removeListener("end",m),a.removeListener("close",m),r.removeListener("close",m)}return a.on("end",m),a.on("close",m),r.on("close",m),r.emit("pipe",a),r},UA}var Ooe=Poe();class koe{append(e){this._buffer=this._buffer?Yu.concat([this._buffer,e]):e}readMessage(){if(!this._buffer)return null;const e=this._buffer.indexOf(`
`);if(e===-1)return null;const t=this._buffer.toString("utf8",0,e).replace(/\r$/,"");return this._buffer=this._buffer.subarray(e+1),Noe(t)}clear(){this._buffer=void 0}}function Noe(n){return ud.parse(JSON.parse(n))}function Moe(n){return JSON.stringify(n)+`
`}const Doe=ot.platform==="win32"?["APPDATA","HOMEDRIVE","HOMEPATH","LOCALAPPDATA","PATH","PROCESSOR_ARCHITECTURE","SYSTEMDRIVE","SYSTEMROOT","TEMP","USERNAME","USERPROFILE"]:["HOME","LOGNAME","PATH","SHELL","TERM","USER"];function $oe(){const n={};for(const e of Doe){const t=ot.env[e];t!==void 0&&(t.startsWith("()")||(n[e]=t))}return n}class Loe{constructor(e){this._abortController=new AbortController,this._readBuffer=new koe,this._stderrStream=null,this._serverParams=e,(e.stderr==="pipe"||e.stderr==="overlapped")&&(this._stderrStream=new Ooe.PassThrough)}async start(){if(this._process)throw new Error("StdioClientTransport already started! If using Client class, note that connect() calls start() automatically.");return new Promise((e,t)=>{var r,i,a,s,o,u;this._process=qse(this._serverParams.command,(r=this._serverParams.args)!==null&&r!==void 0?r:[],{env:(i=this._serverParams.env)!==null&&i!==void 0?i:$oe(),stdio:["pipe","pipe",(a=this._serverParams.stderr)!==null&&a!==void 0?a:"inherit"],shell:!1,signal:this._abortController.signal,windowsHide:ot.platform==="win32"&&Uoe(),cwd:this._serverParams.cwd}),this._process.on("error",c=>{var d,h;if(c.name==="AbortError"){(d=this.onclose)===null||d===void 0||d.call(this);return}t(c),(h=this.onerror)===null||h===void 0||h.call(this,c)}),this._process.on("spawn",()=>{e()}),this._process.on("close",c=>{var d;this._process=void 0,(d=this.onclose)===null||d===void 0||d.call(this)}),(s=this._process.stdin)===null||s===void 0||s.on("error",c=>{var d;(d=this.onerror)===null||d===void 0||d.call(this,c)}),(o=this._process.stdout)===null||o===void 0||o.on("data",c=>{this._readBuffer.append(c),this.processReadBuffer()}),(u=this._process.stdout)===null||u===void 0||u.on("error",c=>{var d;(d=this.onerror)===null||d===void 0||d.call(this,c)}),this._stderrStream&&this._process.stderr&&this._process.stderr.pipe(this._stderrStream)})}get stderr(){var e,t;return this._stderrStream?this._stderrStream:(t=(e=this._process)===null||e===void 0?void 0:e.stderr)!==null&&t!==void 0?t:null}processReadBuffer(){for(var e,t;;)try{const r=this._readBuffer.readMessage();if(r===null)break;(e=this.onmessage)===null||e===void 0||e.call(this,r)}catch(r){(t=this.onerror)===null||t===void 0||t.call(this,r)}}async close(){this._abortController.abort(),this._process=void 0,this._readBuffer.clear()}send(e){return new Promise(t=>{var r;if(!(!((r=this._process)===null||r===void 0)&&r.stdin))throw new Error("Not connected");const i=Moe(e);this._process.stdin.write(i)?t():this._process.stdin.once("drain",t)})}}function Uoe(){return"type"in ot}const joe="mcp";class Foe{constructor(e){this._url=e}start(){if(this._socket)throw new Error("WebSocketClientTransport already started! If using Client class, note that connect() calls start() automatically.");return new Promise((e,t)=>{this._socket=new WebSocket(this._url,joe),this._socket.onerror=r=>{var i;const a="error"in r?r.error:new Error(`WebSocket error: ${JSON.stringify(r)}`);t(a),(i=this.onerror)===null||i===void 0||i.call(this,a)},this._socket.onopen=()=>{e()},this._socket.onclose=()=>{var r;(r=this.onclose)===null||r===void 0||r.call(this)},this._socket.onmessage=r=>{var i,a;let s;try{s=ud.parse(JSON.parse(r.data))}catch(o){(i=this.onerror)===null||i===void 0||i.call(this,o);return}(a=this.onmessage)===null||a===void 0||a.call(this,s)}})}async close(){var e;(e=this._socket)===null||e===void 0||e.close()}send(e){return new Promise((t,r)=>{var i;if(!this._socket){r(new Error("Not connected"));return}(i=this._socket)===null||i===void 0||i.send(JSON.stringify(e)),t()})}}const Fq=(n,e)=>n.allOf.map((r,i)=>wi(r,{...e,path:[...e.path,"allOf",i]})).reduce((r,i)=>r.and(i)),Bq=(n,e)=>{const t=n.anyOf.map((r,i)=>wi(r,{...e,path:[...e.path,"anyOf",i]}));return In(t)};function vs(n,e,t,r){var a;const i=e[t];if(i!==void 0){const s=(a=e.errorMessage)==null?void 0:a[t];return r(n,i,s)}return n}const Boe=(n,e)=>{const t=n.items;let r;if(Array.isArray(t)){const a=t.map((s,o)=>wi(s,{...e,path:[...e.path,"items",o]}));if(r=$X(a),n.additionalItems!==void 0&&n.additionalItems!==!1){const s=wi(n.additionalItems,{...e,path:[...e.path,"additionalItems"]});r=r.rest(s)}}else{const a=wi(t??!0,{...e,path:[...e.path,"items"]});r=kt(a)}const i=r;return r=vs(r,n,"minItems",(a,s,o)=>i.min(s,o)),r=vs(r,n,"maxItems",(a,s,o)=>i.max(s,o)),n.uniqueItems&&(r=r.refine(a=>new Set(a.map(s=>JSON.stringify(s))).size===a.length,{message:"Array items must be unique"})),r},qoe=n=>Jr(),Voe=n=>{const e=n.const;return Pt(e)},zoe=n=>Va(),Hoe=n=>{if(n.enum.length===0)return F6();if(n.enum.length===1)return Pt(n.enum[0]);const e=typeof n.enum[0];if(n.enum.every(r=>typeof r===e)){if(e==="string")return xs(n.enum);if(e==="number"||e==="boolean")return In(n.enum.map(r=>Pt(r)))}return In(n.enum.map(r=>Pt(r)))},Goe=(n,e)=>{wi(n.if,{...e,path:[...e.path,"if"]});const t=wi(n.then,{...e,path:[...e.path,"then"]}),r=wi(n.else,{...e,path:[...e.path,"else"]});return In([t,r])},Woe=(n,e)=>{const r=n.type.map(i=>wi({...n,type:i},e));return In(r)},Koe=(n,e)=>{const t=wi(n.not,{...e,path:[...e.path,"not"]});return Va().refine(r=>!t.safeParse(r).success,{message:"Value must not match the forbidden schema"})},Joe=n=>j6(),Yoe=(n,e)=>{const{parseSchema:t}=require("./parse-schema"),{nullable:r,...i}=n,a=t(i,e);return In([a,j6()])},Zoe=n=>{var r;let e=Yn();n.type==="integer"&&(e=e.int());const t=e;return e=vs(e,n,"minimum",(i,a,s)=>t.gte(a,s)),e=vs(e,n,"exclusiveMinimum",(i,a,s)=>{if(typeof a=="boolean"){const o=n.minimum;return a&&o!==void 0?t.gt(o,s):i}return t.gt(a,s)}),e=vs(e,n,"maximum",(i,a,s)=>t.lte(a,s)),e=vs(e,n,"exclusiveMaximum",(i,a,s)=>{if(typeof a=="boolean"){const o=n.maximum;return a&&o!==void 0?t.lt(o,s):i}return t.lt(a,s)}),n.multipleOf!==void 0?Yn().refine(i=>i%n.multipleOf===0,{message:((r=n.errorMessage)==null?void 0:r.multipleOf)??`value must be a multiple of ${n.multipleOf}`}):e},qq=(n,e)=>{const t=n.oneOf.map((r,i)=>wi(r,{...e,path:[...e.path,"oneOf",i]}));return In(t)},br={an:{object:n=>n.type==="object",array:n=>n.type==="array",anyOf:n=>n.anyOf!==void 0,allOf:n=>n.allOf!==void 0,enum:n=>n.enum!==void 0},a:{nullable:n=>n.nullable===!0,multipleType:n=>Array.isArray(n.type),not:n=>n.not!==void 0,const:n=>n.const!==void 0,primitive:(n,e)=>n.type===e,conditional:n=>!!("if"in n&&n.if&&"then"in n&&"else"in n&&n.then&&n.else),oneOf:n=>n.oneOf!==void 0}};function Xoe(n,e){if(!n.properties)return;const t=Object.keys(n.properties);if(t.length===0)return rt({});const r={};for(const i of t){const a=n.properties[i],s=wi(a,{...e,path:[...e.path,"properties",i]}),o=typeof a=="object"&&a.default!==void 0,u=Array.isArray(n.required)?n.required.includes(i):typeof a=="object"&&a.required===!0,c=!o&&!u;r[i]=c?s.optional():s}return rt(r)}function Qoe(n,e){const t=Object.keys(n.patternProperties??{}).length>0,r=Xoe(n,e);let i=r;const a=n.additionalProperties!==void 0?wi(n.additionalProperties,{...e,path:[...e.path,"additionalProperties"]}):void 0;if(n.patternProperties){const o=Object.fromEntries(Object.entries(n.patternProperties).map(([d,h])=>[d,wi(h,{...e,path:[...e.path,"patternProperties",d]})])),u=Object.values(o);r?a?i=r.catchall(In([...u,a])):Object.keys(o).length>1?i=r.catchall(In(u)):i=r.catchall(u[0]):a?i=gs(In([...u,a])):u.length>1?i=gs(In(u)):i=gs(u[0]);const c=new Set(Object.keys(n.properties??{}));i=i.superRefine((d,h)=>{for(const m in d){let g=c.has(m);for(const _ in n.patternProperties){const w=new RegExp(_);if(m.match(w)){g=!0;const S=o[_].safeParse(d[m]);S.success||h.addIssue({path:[...h.path,m],code:"custom",message:`Invalid input: Key matching regex /${m}/ must match schema`,params:{issues:S.error.issues}})}}if(!g&&a){const _=a.safeParse(d[m]);_.success||h.addIssue({path:[...h.path,m],code:"custom",message:"Invalid input: must match catchall schema",params:{issues:_.error.issues}})}}})}let s;return r?t?s=i:a?a instanceof Xo?s=r.strict():s=r.catchall(a):s=i:t?s=i:a?s=gs(a):s=gs(Va()),br.an.anyOf(n)&&(s=s.and(Bq({...n,anyOf:n.anyOf.map(o=>typeof o=="object"&&!o.type&&(o.properties??o.additionalProperties??o.patternProperties)?{...o,type:"object"}:o)},e))),br.a.oneOf(n)&&(s=s.and(qq({...n,oneOf:n.oneOf.map(o=>typeof o=="object"&&!o.type&&(o.properties??o.additionalProperties??o.patternProperties)?{...o,type:"object"}:o)},e))),br.an.allOf(n)&&(s=s.and(Fq({...n,allOf:n.allOf.map(o=>typeof o=="object"&&!o.type&&(o.properties??o.additionalProperties??o.patternProperties)?{...o,type:"object"}:o)},e))),s}const ele=n=>{let e=$e();return e=vs(e,n,"format",(t,r,i)=>{switch(r){case"email":return t.email(i);case"ip":return t.ip(i);case"ipv4":return t.ip({version:"v4",message:i});case"ipv6":return t.ip({version:"v6",message:i});case"uri":return t.url(i);case"uuid":return t.uuid(i);case"date-time":return t.datetime({offset:!0,message:i});case"time":return t.time(i);case"date":return t.date(i);case"binary":return t.base64(i);case"duration":return t.duration(i);default:return t}}),e=vs(e,n,"contentEncoding",(t,r,i)=>t.base64(i)),e=vs(e,n,"pattern",(t,r,i)=>t.regex(new RegExp(r),i)),e=vs(e,n,"minLength",(t,r,i)=>t.min(r,i)),e=vs(e,n,"maxLength",(t,r,i)=>t.max(r,i)),e},tle=(n,e)=>(n.description&&(e=e.describe(n.description)),e),nle=(n,e)=>(n.default!==void 0&&(e=e.default(n.default)),e),rle=(n,e)=>(n.readOnly&&(e=e.readonly()),e),ile=(n,e)=>br.a.nullable(n)?Yoe(n,e):br.an.object(n)?Qoe(n,e):br.an.array(n)?Boe(n,e):br.an.anyOf(n)?Bq(n,e):br.an.allOf(n)?Fq(n,e):br.a.oneOf(n)?qq(n,e):br.a.not(n)?Koe(n,e):br.an.enum(n)?Hoe(n):br.a.const(n)?Voe(n):br.a.multipleType(n)?Woe(n,e):br.a.primitive(n,"string")?ele(n):br.a.primitive(n,"number")||br.a.primitive(n,"integer")?Zoe(n):br.a.primitive(n,"boolean")?qoe():br.a.primitive(n,"null")?Joe():br.a.conditional(n)?Goe(n,e):zoe(),wi=(n,e={seen:new Map,path:[]},t)=>{if(typeof n!="object")return n?Va():F6();if(e.parserOverride){const a=e.parserOverride(n,e);if(a instanceof Yt)return a}let r=e.seen.get(n);if(r){if(r.r!==void 0)return r.r;if(e.depth===void 0||r.n>=e.depth)return Va();r.n+=1}else r={r:void 0,n:0},e.seen.set(n,r);let i=ile(n,e);return e.withoutDescribes||(i=tle(n,i)),e.withoutDefaults||(i=nle(n,i)),i=rle(n,i),r.r=i,i},ale=(n,e={})=>wi(n,{path:[],seen:new Map,...e});var Jn;(function(n){n[n.TRACE=0]="TRACE",n[n.DEBUG=1]="DEBUG",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.FATAL=5]="FATAL"})(Jn||(Jn={}));const sle={[Jn.TRACE]:"\x1B[90m",[Jn.DEBUG]:"\x1B[90m",[Jn.INFO]:"\x1B[90m",[Jn.WARN]:"\x1B[1;93m",[Jn.ERROR]:"\x1B[1;91m",[Jn.FATAL]:"\x1B[1;101m"},ole={trace:Jn.TRACE,debug:Jn.DEBUG,info:Jn.INFO,warn:Jn.WARN,error:Jn.ERROR,fatal:Jn.FATAL};var Wu;let lle=(Wu=class{constructor({level:e=Jn.INFO}={}){ti(this,"level");this.level=this.parseLogLevel(e)}parseLogLevel(e){return typeof e=="number"?e:ole[e.toLowerCase()]}log(e,...t){if(e<this.level)return;const r=sle[e],i=`[${Jn[e].toLowerCase()}]`;console.log(`${r}${i}${Wu.RESET}`,...t.map(this.formatValue))}formatValue(e){return e===null?"null":e===void 0?"undefined":typeof e=="object"?JSON.stringify(e,null,2):String(e)}trace(...e){this.log(Jn.TRACE,...e)}debug(...e){this.log(Jn.DEBUG,...e)}info(...e){this.log(Jn.INFO,...e)}warn(...e){this.log(Jn.WARN,...e)}error(...e){this.log(Jn.ERROR,...e)}fatal(...e){this.log(Jn.FATAL,...e)}},ti(Wu,"RESET","\x1B[0m"),Wu);var ule={};class ku extends Error{constructor(t,r,i){super(r);ti(this,"serverName");ti(this,"details");this.serverName=t,this.details=i,this.name="McpInitializationError"}}async function cle(n,e){const t=[],r=[],i=(e==null?void 0:e.logger)||new lle({level:e==null?void 0:e.logLevel}),a=Object.entries(n).map(async([c,d])=>{const h=await mle(c,d,i);return{name:c,result:h}}),s=Object.keys(n);(await Promise.allSettled(a)).forEach((c,d)=>{if(c.status==="fulfilled"){const{result:{tools:h,cleanup:m}}=c.value;t.push(...h),r.push(m)}else throw i.error(`MCP server "${s[d]}": failed to initialize: ${c.reason.details}`),c.reason});async function u(){(await Promise.allSettled(r.map(h=>h()))).filter(h=>h.status==="rejected").forEach((h,m)=>{i.error(`MCP server "${s[m]}": failed to close: ${h.reason}`)})}return i.info(`MCP servers initialized: ${t.length} tool(s) available in total`),t.forEach(c=>i.debug(`- ${c.name}`)),{tools:t,cleanup:u}}function Mu(n,e,t){if(typeof n!="object"||n===null)return n;const r={...n},i=[],a=[];if(r.exclusiveMinimum!==void 0&&(i.push("exclusiveMinimum"),delete r.exclusiveMinimum),r.exclusiveMaximum!==void 0&&(i.push("exclusiveMaximum"),delete r.exclusiveMaximum),n.exclusiveMinimum!==void 0&&(r.minimum=n.exclusiveMinimum,a.push("exclusiveMinimum → minimum")),n.exclusiveMaximum!==void 0&&(r.maximum=n.exclusiveMaximum,a.push("exclusiveMaximum → maximum")),r.type==="string"&&r.format&&(["enum","date-time"].includes(r.format)||(i.push(`format: ${r.format}`),delete r.format)),e&&t&&(i.length>0||a.length>0)){const s=[];i.length>0&&s.push(`removed: ${i.join(", ")}`),a.length>0&&s.push(`converted: ${a.join(", ")}`),e.warn(`MCP tool "${t}": schema sanitized for Gemini compatibility (${s.join("; ")})`)}return r.properties&&(r.properties=Object.fromEntries(Object.entries(r.properties).map(([s,o])=>[s,Mu(o,e,t)]))),r.anyOf&&(r.anyOf=r.anyOf.map(s=>Mu(s,e,t))),r.oneOf&&(r.oneOf=r.oneOf.map(s=>Mu(s,e,t))),r.allOf&&(r.allOf=r.allOf.map(s=>Mu(s,e,t))),r.items&&(r.items=Mu(r.items,e,t)),r.additionalProperties&&typeof r.additionalProperties=="object"&&(r.additionalProperties=Mu(r.additionalProperties,e,t)),r}function Uj(n,e,t){const r={};return n.streamableHTTPOptions?(n.streamableHTTPOptions.authProvider&&(r.authProvider=n.streamableHTTPOptions.authProvider,e.info(`MCP server "${t}": configuring Streamable HTTP with authentication provider`)),n.streamableHTTPOptions.requestInit&&(r.requestInit=n.streamableHTTPOptions.requestInit),n.streamableHTTPOptions.reconnectionOptions&&(r.reconnectionOptions=n.streamableHTTPOptions.reconnectionOptions),n.streamableHTTPOptions.sessionId&&(r.sessionId=n.streamableHTTPOptions.sessionId)):n.headers&&(r.requestInit={headers:n.headers}),Object.keys(r).length>0?r:void 0}function jj(n,e,t){const r={};return n.sseOptions&&(n.sseOptions.authProvider&&(r.authProvider=n.sseOptions.authProvider,e.info(`MCP server "${t}": configuring SSE with authentication provider`)),n.sseOptions.eventSourceInit&&(r.eventSourceInit=n.sseOptions.eventSourceInit),n.sseOptions.requestInit?r.requestInit=n.sseOptions.requestInit:n.headers&&(r.requestInit={headers:n.headers})),Object.keys(r).length>0?r:void 0}function fle(n){if(!n||typeof n!="object")return!1;const e=n;if(e.status&&typeof e.status=="number")return e.status>=400&&e.status<500;if(e.response&&e.response.status&&typeof e.response.status=="number")return e.response.status>=400&&e.response.status<500;const t=e.message||e.toString();return typeof t=="string"?/4[0-9]{2}/.test(t)||t.includes("Bad Request")||t.includes("Unauthorized")||t.includes("Forbidden")||t.includes("Not Found")||t.includes("Method Not Allowed"):!1}async function dle(n,e,t,r){var s,o,u,c,d,h;t.debug(`MCP server "${r}": testing Streamable HTTP suppor`);const i={jsonrpc:"2.0",id:`transport-test-${Date.now()}`,method:"initialize",params:{protocolVersion:"2024-11-05",capabilities:{},clientInfo:{name:"mcp-transport-test",version:"1.0.0"}}},a={"Content-Type":"application/json",Accept:"application/json, text/event-stream"};if((s=e.streamableHTTPOptions)!=null&&s.authProvider)try{const m=await e.streamableHTTPOptions.authProvider.tokens();m!=null&&m.access_token&&(a.Authorization=`${m.token_type||"Bearer"} ${m.access_token}`,t.debug(`MCP server "${r}": added authentication to transport test`))}catch(m){t.debug(`MCP server "${r}": authentication setup failed for transport test:`,m)}(u=(o=e.streamableHTTPOptions)==null?void 0:o.requestInit)!=null&&u.headers&&Object.assign(a,e.streamableHTTPOptions.requestInit.headers),(d=(c=e.sseOptions)==null?void 0:c.requestInit)!=null&&d.headers&&Object.assign(a,e.sseOptions.requestInit.headers),e.headers&&Object.assign(a,e.headers);try{t.debug(`MCP server "${r}": POST InitializeRequest to test Streamable HTTP support`);const m=await fetch(n.toString(),{method:"POST",headers:a,body:JSON.stringify(i),...(h=e.streamableHTTPOptions)==null?void 0:h.requestInit});if(t.debug(`MCP server "${r}": transport test response: ${m.status} ${m.statusText}`),m.ok)return t.info(`MCP server "${r}": detected Streamable HTTP transport support`),"streamable_http";if(m.status>=400&&m.status<500)return t.info(`MCP server "${r}": received ${m.status}, falling back to SSE transport`),"sse";throw new Error(`HTTP ${m.status}: ${m.statusText}`)}catch(m){if(t.debug(`MCP server "${r}": transport test failed:`,m),fle(m))return t.info(`MCP server "${r}": transport test failed with 4xx-like error, falling back to SSE`),"sse";throw m}}async function hle(n,e,t,r){const i=e.transport||e.type;if(i==="streamable_http"||i==="http"){t.debug(`MCP server "${r}": using explicitly configured Streamable HTTP transport`);const a=Uj(e,t,r);return new qx(n,a)}if(i==="sse"){t.debug(`MCP server "${r}": using explicitly configured SSE transport`);const a=jj(e,t,r);return new t4(n,a)}t.debug(`MCP server "${r}": auto-detecting transport using MCP specification method`);try{if(await dle(n,e,t,r)==="streamable_http"){const s=Uj(e,t,r);return new qx(n,s)}else{const s=jj(e,t,r);return new t4(n,s)}}catch(a){throw t.error(`MCP server "${r}": transport detection failed:`,a),a}}function ple(n){const e=n.shape,t={};if(!e)return rt(t);for(const[r,i]of Object.entries(e))i instanceof oo&&!(i instanceof Qo)||i instanceof fm&&!(i instanceof Qo)?t[r]=i.nullable():t[r]=i;return rt(t)}async function mle(n,e,t){let r=null;try{let i=null;t.info(`MCP server "${n}": initializing with: ${JSON.stringify(e)}`);let a;try{a=new URL(e.url)}catch{}if(!(e!=null&&e.command)&&!a)throw new ku(n,`Failed to initialize MCP server: ${n}: Either a command or a valid URL must be specified`);if(e!=null&&e.command&&a)throw new ku(n,`Configuration error: Cannot specify both 'command' (${e.command}) and 'url' (${a.href}). Use 'command' for local servers or 'url' for remote servers.`);const s=(e==null?void 0:e.transport)||(e==null?void 0:e.type);if(s==="http"||s==="streamable_http"||!s&&((a==null?void 0:a.protocol)==="http:"||(a==null?void 0:a.protocol)==="https:")){if(!((a==null?void 0:a.protocol)==="http:"||(a==null?void 0:a.protocol)==="https:"))throw new ku(n,`Failed to initialize MCP server: ${n}: URL protocol to be http: or https: : ${a}`);const d=e;let h=!1;r=await hle(a,d,t,n),t.info(`MCP server "${n}": created transport, attempting connection`)}else if(s==="ws"||s==="websocket"||!s&&((a==null?void 0:a.protocol)==="ws:"||(a==null?void 0:a.protocol)==="wss:")){if(!((a==null?void 0:a.protocol)==="ws:"||(a==null?void 0:a.protocol)==="wss:"))throw new ku(n,`Failed to initialize MCP server: ${n}: URL protocol to be ws: or wss: : ${a}`);r=new Foe(a)}else if(s==="stdio"||!s&&(e!=null&&e.command)){if(!(e!=null&&e.command))throw new ku(n,`Failed to initialize MCP server: ${n}: Command to be specified`);const d=e,h={...d.env};h.PATH||(h.PATH=ule.PATH||""),r=new Loe({command:d.command,args:d.args,env:h,stderr:d.stderr,cwd:d.cwd})}else throw new ku(n,`Failed to initialize MCP server: ${n}: Unknown transport type: ${e==null?void 0:e.transport}`);i||(i=new kx({name:"mcp-client",version:"0.0.1"},{capabilities:{}}),await i.connect(r),t.info(`MCP server "${n}": connected`));const u=(await i.request({method:"tools/list"},KI)).tools.map(d=>{const h=Mu(d.inputSchema,t,`${n}/${d.name}`),m=ale(h),g=ple(m);return new BI({name:d.name,description:d.description||"",schema:g,func:async function(_){t.info(`MCP tool "${n}"/"${d.name}" received input:`,_);try{const w=await(i==null?void 0:i.request({method:"tools/call",params:{name:d.name,arguments:_}},Kb));if(!(w!=null&&w.content))return t.info(`MCP tool "${n}"/"${d.name}" received null/undefined result`),"";const S=w.content.filter(C=>C.type==="text").map(C=>C.text).join(`

`),E=new TextEncoder().encode(S).length;return t.info(`MCP tool "${n}"/"${d.name}" received result (size: ${E})`),S||"No text content available in response"}catch(w){return t.warn(`MCP tool "${n}"/"${d.name}" caused error: ${w}`),`Error executing MCP tool: ${w}`}}})});t.info(`MCP server "${n}": ${u.length} tool(s) available:`),u.forEach(d=>t.info(`- ${d.name}`));async function c(){r&&(await r.close(),t.info(`MCP server "${n}": session closed`))}return{tools:u,cleanup:c}}catch(i){if(r)try{await r.close()}catch(a){t.error(`Failed to cleanup during initialization error: ${a}`)}throw new ku(n,`Failed to initialize MCP server: ${n}: ${i instanceof Error?i.message:String(i)}`,i)}}function Ct(n,e,t,r,i){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}function Ne(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)}let Vq=function(){const{crypto:n}=globalThis;if(n!=null&&n.randomUUID)return Vq=n.randomUUID.bind(n),n.randomUUID();const e=new Uint8Array(1),t=n?()=>n.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^t()&15>>+r/4).toString(16))};function Vx(n){return typeof n=="object"&&n!==null&&("name"in n&&n.name==="AbortError"||"message"in n&&String(n.message).includes("FetchRequestCanceledException"))}const zx=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null){try{if(Object.prototype.toString.call(n)==="[object Error]"){const e=new Error(n.message,n.cause?{cause:n.cause}:{});return n.stack&&(e.stack=n.stack),n.cause&&!e.cause&&(e.cause=n.cause),n.name&&(e.name=n.name),e}}catch{}try{return new Error(JSON.stringify(n))}catch{}}return new Error(n)};class Tt extends Error{}let Ki=class Hx extends Tt{constructor(e,t,r,i){super(`${Hx.makeMessage(e,t,r)}`),this.status=e,this.headers=i,this.requestID=i==null?void 0:i.get("x-request-id"),this.error=t;const a=t;this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,t,r){const i=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,t,r,i){if(!e||!i)return new ew({message:r,cause:zx(t)});const a=t==null?void 0:t.error;return e===400?new zq(e,a,r,i):e===401?new Hq(e,a,r,i):e===403?new Gq(e,a,r,i):e===404?new Wq(e,a,r,i):e===409?new Kq(e,a,r,i):e===422?new Jq(e,a,r,i):e===429?new Yq(e,a,r,i):e>=500?new Zq(e,a,r,i):new Hx(e,a,r,i)}},_a=class extends Ki{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},ew=class extends Ki{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},tw=class extends ew{constructor({message:e}={}){super({message:e??"Request timed out."})}},zq=class extends Ki{},Hq=class extends Ki{},Gq=class extends Ki{},Wq=class extends Ki{},Kq=class extends Ki{},Jq=class extends Ki{},Yq=class extends Ki{},Zq=class extends Ki{};class Xq extends Tt{constructor(){super("Could not parse response content as the length limit was reached")}}class Qq extends Tt{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class Sp extends Error{constructor(e){super(e)}}const gle=/^[a-z][a-z0-9+.-]*:/i,yle=n=>gle.test(n);let Li=n=>(Li=Array.isArray,Li(n)),Fj=Li;function vle(n){return typeof n!="object"?{}:n??{}}function _le(n){if(!n)return!0;for(const e in n)return!1;return!0}function ble(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function jA(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}const wle=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Tt(`${n} must be an integer`);if(e<0)throw new Tt(`${n} must be a positive integer`);return e},Ele=n=>{try{return JSON.parse(n)}catch{return}},Xm=n=>new Promise(e=>setTimeout(e,n)),Ff="5.8.1",Sle=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function Tle(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const Ale=()=>{var t;const n=Tle();if(n==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ff,"X-Stainless-OS":qj(Deno.build.os),"X-Stainless-Arch":Bj(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((t=Deno.version)==null?void 0:t.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ff,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(n==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ff,"X-Stainless-OS":qj(globalThis.process.platform??"unknown"),"X-Stainless-Arch":Bj(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const e=Cle();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ff,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ff,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Cle(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const i=r[1]||0,a=r[2]||0,s=r[3]||0;return{browser:e,version:`${i}.${a}.${s}`}}}return null}const Bj=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",qj=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let Vj;const xle=()=>Vj??(Vj=Ale());function Rle(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function e9(...n){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...n)}function t9(n){let e=Symbol.asyncIterator in n?n[Symbol.asyncIterator]():n[Symbol.iterator]();return e9({start(){},async pull(t){const{done:r,value:i}=await e.next();r?t.close():t.enqueue(i)},async cancel(){var t;await((t=e.return)==null?void 0:t.call(e))}})}function n9(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Ile(n){var r,i;if(n===null||typeof n!="object")return;if(n[Symbol.asyncIterator]){await((i=(r=n[Symbol.asyncIterator]()).return)==null?void 0:i.call(r));return}const e=n.getReader(),t=e.cancel();e.releaseLock(),await t}const Ple=({headers:n,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)}),r9="RFC3986",i9=n=>String(n),zj={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:i9},Ole="RFC1738";let Gx=(n,e)=>(Gx=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),Gx(n,e));const Bs=(()=>{const n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})(),FA=1024,kle=(n,e,t,r,i)=>{if(n.length===0)return n;let a=n;if(typeof n=="symbol"?a=Symbol.prototype.toString.call(n):typeof n!="string"&&(a=String(n)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let s="";for(let o=0;o<a.length;o+=FA){const u=a.length>=FA?a.slice(o,o+FA):a,c=[];for(let d=0;d<u.length;++d){let h=u.charCodeAt(d);if(h===45||h===46||h===95||h===126||h>=48&&h<=57||h>=65&&h<=90||h>=97&&h<=122||i===Ole&&(h===40||h===41)){c[c.length]=u.charAt(d);continue}if(h<128){c[c.length]=Bs[h];continue}if(h<2048){c[c.length]=Bs[192|h>>6]+Bs[128|h&63];continue}if(h<55296||h>=57344){c[c.length]=Bs[224|h>>12]+Bs[128|h>>6&63]+Bs[128|h&63];continue}d+=1,h=65536+((h&1023)<<10|u.charCodeAt(d)&1023),c[c.length]=Bs[240|h>>18]+Bs[128|h>>12&63]+Bs[128|h>>6&63]+Bs[128|h&63]}s+=c.join("")}return s};function Nle(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function Hj(n,e){if(Li(n)){const t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}const a9={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},s9=function(n,e){Array.prototype.push.apply(n,Li(e)?e:[e])};let Gj;const wr={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:kle,encodeValuesOnly:!1,format:r9,formatter:i9,indices:!1,serializeDate(n){return(Gj??(Gj=Function.prototype.call.bind(Date.prototype.toISOString)))(n)},skipNulls:!1,strictNullHandling:!1};function Mle(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}const BA={};function o9(n,e,t,r,i,a,s,o,u,c,d,h,m,g,_,w,S,E){let C=n,A=E,R=0,P=!1;for(;(A=A.get(BA))!==void 0&&!P;){const H=A.get(n);if(R+=1,typeof H<"u"){if(H===R)throw new RangeError("Cyclic object value");P=!0}typeof A.get(BA)>"u"&&(R=0)}if(typeof c=="function"?C=c(e,C):C instanceof Date?C=m==null?void 0:m(C):t==="comma"&&Li(C)&&(C=Hj(C,function(H){return H instanceof Date?m==null?void 0:m(H):H})),C===null){if(a)return u&&!w?u(e,wr.encoder,S,"key",g):e;C=""}if(Mle(C)||Nle(C)){if(u){const H=w?e:u(e,wr.encoder,S,"key",g);return[(_==null?void 0:_(H))+"="+(_==null?void 0:_(u(C,wr.encoder,S,"value",g)))]}return[(_==null?void 0:_(e))+"="+(_==null?void 0:_(String(C)))]}const N=[];if(typeof C>"u")return N;let U;if(t==="comma"&&Li(C))w&&u&&(C=Hj(C,u)),U=[{value:C.length>0?C.join(",")||null:void 0}];else if(Li(c))U=c;else{const H=Object.keys(C);U=d?H.sort(d):H}const k=o?String(e).replace(/\./g,"%2E"):String(e),B=r&&Li(C)&&C.length===1?k+"[]":k;if(i&&Li(C)&&C.length===0)return B+"[]";for(let H=0;H<U.length;++H){const G=U[H],z=typeof G=="object"&&typeof G.value<"u"?G.value:C[G];if(s&&z===null)continue;const oe=h&&o?G.replace(/\./g,"%2E"):G,te=Li(C)?typeof t=="function"?t(B,oe):B:B+(h?"."+oe:"["+oe+"]");E.set(n,R);const se=new WeakMap;se.set(BA,E),s9(N,o9(z,te,t,r,i,a,s,o,t==="comma"&&w&&Li(C)?null:u,c,d,h,m,g,_,w,S,se))}return N}function Dle(n=wr){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=n.charset||wr.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=r9;if(typeof n.format<"u"){if(!Gx(zj,n.format))throw new TypeError("Unknown format option provided.");t=n.format}const r=zj[t];let i=wr.filter;(typeof n.filter=="function"||Li(n.filter))&&(i=n.filter);let a;if(n.arrayFormat&&n.arrayFormat in a9?a=n.arrayFormat:"indices"in n?a=n.indices?"indices":"repeat":a=wr.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const s=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:wr.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:wr.addQueryPrefix,allowDots:s,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:wr.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:wr.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?wr.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:wr.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:wr.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:wr.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:wr.encodeValuesOnly,filter:i,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:wr.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:wr.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:wr.strictNullHandling}}function $le(n,e={}){let t=n;const r=Dle(e);let i,a;typeof r.filter=="function"?(a=r.filter,t=a("",t)):Li(r.filter)&&(a=r.filter,i=a);const s=[];if(typeof t!="object"||t===null)return"";const o=a9[r.arrayFormat],u=o==="comma"&&r.commaRoundTrip;i||(i=Object.keys(t)),r.sort&&i.sort(r.sort);const c=new WeakMap;for(let m=0;m<i.length;++m){const g=i[m];r.skipNulls&&t[g]===null||s9(s,o9(t[g],g,o,u,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,c))}const d=s.join(r.delimiter);let h=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),d.length>0?h+d:""}function Lle(n){let e=0;for(const i of n)e+=i.length;const t=new Uint8Array(e);let r=0;for(const i of n)t.set(i,r),r+=i.length;return t}let Wj;function lP(n){let e;return(Wj??(e=new globalThis.TextEncoder,Wj=e.encode.bind(e)))(n)}let Kj;function Jj(n){let e;return(Kj??(e=new globalThis.TextDecoder,Kj=e.decode.bind(e)))(n)}var fa,da;let nw=class{constructor(){fa.set(this,void 0),da.set(this,void 0),Ct(this,fa,new Uint8Array),Ct(this,da,null)}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?lP(e):e;Ct(this,fa,Lle([Ne(this,fa,"f"),t]));const r=[];let i;for(;(i=Ule(Ne(this,fa,"f"),Ne(this,da,"f")))!=null;){if(i.carriage&&Ne(this,da,"f")==null){Ct(this,da,i.index);continue}if(Ne(this,da,"f")!=null&&(i.index!==Ne(this,da,"f")+1||i.carriage)){r.push(Jj(Ne(this,fa,"f").subarray(0,Ne(this,da,"f")-1))),Ct(this,fa,Ne(this,fa,"f").subarray(Ne(this,da,"f"))),Ct(this,da,null);continue}const a=Ne(this,da,"f")!==null?i.preceding-1:i.preceding,s=Jj(Ne(this,fa,"f").subarray(0,a));r.push(s),Ct(this,fa,Ne(this,fa,"f").subarray(i.index)),Ct(this,da,null)}return r}flush(){return Ne(this,fa,"f").length?this.decode(`
`):[]}};fa=new WeakMap,da=new WeakMap;nw.NEWLINE_CHARS=new Set([`
`,"\r"]);nw.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Ule(n,e){for(let i=e??0;i<n.length;i++){if(n[i]===10)return{preceding:i,index:i+1,carriage:!1};if(n[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function jle(n){for(let r=0;r<n.length-1;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}let ym=class Tp{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*i(){if(r)throw new Tt("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const s of Fle(e,t))if(!a){if(s.data.startsWith("[DONE]")){a=!0;continue}if(s.event===null||s.event.startsWith("response.")||s.event.startsWith("transcript.")){let o;try{o=JSON.parse(s.data)}catch(u){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),u}if(o&&o.error)throw new Ki(void 0,o.error,void 0,e.headers);yield o}else{let o;try{o=JSON.parse(s.data)}catch(u){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),u}if(s.event=="error")throw new Ki(void 0,o.error,o.message,void 0);yield{event:s.event,data:o}}}a=!0}catch(s){if(Vx(s))return;throw s}finally{a||t.abort()}}return new Tp(i,t)}static fromReadableStream(e,t){let r=!1;async function*i(){const s=new nw,o=n9(e);for await(const u of o)for(const c of s.decode(u))yield c;for(const u of s.flush())yield u}async function*a(){if(r)throw new Tt("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(const o of i())s||o&&(yield JSON.parse(o));s=!0}catch(o){if(Vx(o))return;throw o}finally{s||t.abort()}}return new Tp(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),i=a=>({next:()=>{if(a.length===0){const s=r.next();e.push(s),t.push(s)}return a.shift()}});return[new Tp(()=>i(e),this.controller),new Tp(()=>i(t),this.controller)]}toReadableStream(){const e=this;let t;return e9({async start(){t=e[Symbol.asyncIterator]()},async pull(r){try{const{value:i,done:a}=await t.next();if(a)return r.close();const s=lP(JSON.stringify(i)+`
`);r.enqueue(s)}catch(i){r.error(i)}},async cancel(){var r;await((r=t.return)==null?void 0:r.call(t))}})}};async function*Fle(n,e){if(!n.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new Tt("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Tt("Attempted to iterate over a response with no body");const t=new qle,r=new nw,i=n9(n.body);for await(const a of Ble(i))for(const s of r.decode(a)){const o=t.decode(s);o&&(yield o)}for(const a of r.flush()){const s=t.decode(a);s&&(yield s)}}async function*Ble(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?lP(t):t;let i=new Uint8Array(e.length+r.length);i.set(e),i.set(r,e.length),e=i;let a;for(;(a=jle(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}let qle=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,i]=Vle(e,":");return i.startsWith(" ")&&(i=i.substring(1)),t==="event"?this.event=i:t==="data"&&this.data.push(i),null}};function Vle(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}const U_={off:0,error:200,warn:300,info:400,debug:500},Yj=(n,e,t)=>{if(n){if(ble(U_,n))return n;ii(t).warn(`${e} was set to ${JSON.stringify(n)}, expected one of ${JSON.stringify(Object.keys(U_))}`)}};function Ap(){}function Jy(n,e,t){return!e||U_[n]>U_[t]?Ap:e[n].bind(e)}const zle={error:Ap,warn:Ap,info:Ap,debug:Ap};let Zj=new WeakMap;function ii(n){const e=n.logger,t=n.logLevel??"off";if(!e)return zle;const r=Zj.get(e);if(r&&r[0]===t)return r[1];const i={error:Jy("error",e,t),warn:Jy("warn",e,t),info:Jy("info",e,t),debug:Jy("debug",e,t)};return Zj.set(e,[t,i]),i}const Du=n=>(n.options&&(n.options={...n.options},delete n.options.headers),n.headers&&(n.headers=Object.fromEntries((n.headers instanceof Headers?[...n.headers]:Object.entries(n.headers)).map(([e,t])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in n&&(n.retryOfRequestLogID&&(n.retryOf=n.retryOfRequestLogID),delete n.retryOfRequestLogID),n);async function l9(n,e){const{response:t,requestLogID:r,retryOfRequestLogID:i,startTime:a}=e,s=await(async()=>{var h;if(e.options.stream)return ii(n).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):ym.fromSSEResponse(t,e.controller);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const o=t.headers.get("content-type"),u=(h=o==null?void 0:o.split(";")[0])==null?void 0:h.trim();if((u==null?void 0:u.includes("application/json"))||(u==null?void 0:u.endsWith("+json"))){const m=await t.json();return u9(m,t)}return await t.text()})();return ii(n).debug(`[${r}] response parsed`,Du({retryOfRequestLogID:i,url:t.url,status:t.status,body:s,durationMs:Date.now()-a})),s}function u9(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var Cp;let c9=class f9 extends Promise{constructor(e,t,r=l9){super(i=>{i(null)}),this.responsePromise=t,this.parseResponse=r,Cp.set(this,void 0),Ct(this,Cp,e)}_thenUnwrap(e){return new f9(Ne(this,Cp,"f"),this.responsePromise,async(t,r)=>u9(e(await this.parseResponse(t,r),r),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(Ne(this,Cp,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};Cp=new WeakMap;var Yy;let d9=class{constructor(e,t,r,i){Yy.set(this,void 0),Ct(this,Yy,e),this.options=i,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new Tt("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await Ne(this,Yy,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Yy=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}},Hle=class extends c9{constructor(e,t,r){super(e,t,async(i,a)=>new r(i,a.response,await l9(i,a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}},rw=class extends d9{constructor(e,t,r,i){super(e,t,r,i),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}};class fr extends d9{constructor(e,t,r,i){super(e,t,r,i),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){var r;const e=this.getPaginatedItems(),t=(r=e[e.length-1])==null?void 0:r.id;return t?{...this.options,query:{...vle(this.options.query),after:t}}:null}}const h9=()=>{var n;if(typeof File>"u"){const{process:e}=globalThis,t=typeof((n=e==null?void 0:e.versions)==null?void 0:n.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function Wp(n,e,t){return h9(),new File(n,e??"unknown_file",t)}function Uv(n){return(typeof n=="object"&&n!==null&&("name"in n&&n.name&&String(n.name)||"url"in n&&n.url&&String(n.url)||"filename"in n&&n.filename&&String(n.filename)||"path"in n&&n.path&&String(n.path))||"").split(/[\\/]/).pop()||void 0}const p9=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",hc=async(n,e)=>({...n,body:await Wle(n.body,e)}),Xj=new WeakMap;function Gle(n){const e=typeof n=="function"?n:n.fetch,t=Xj.get(e);if(t)return t;const r=(async()=>{try{const i="Response"in e?e.Response:(await e("data:,")).constructor,a=new FormData;return a.toString()!==await new i(a).text()}catch{return!0}})();return Xj.set(e,r),r}const Wle=async(n,e)=>{if(!await Gle(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const t=new FormData;return await Promise.all(Object.entries(n||{}).map(([r,i])=>Wx(t,r,i))),t},Kle=n=>n instanceof Blob&&"name"in n,Wx=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(t instanceof Response)n.append(e,Wp([await t.blob()],Uv(t)));else if(p9(t))n.append(e,Wp([await new Response(t9(t)).blob()],Uv(t)));else if(Kle(t))n.append(e,t,Uv(t));else if(Array.isArray(t))await Promise.all(t.map(r=>Wx(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,i])=>Wx(n,`${e}[${r}]`,i)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}},m9=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",Jle=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&m9(n),Yle=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function";async function Zle(n,e,t){if(h9(),n=await n,Jle(n))return n instanceof File?n:Wp([await n.arrayBuffer()],n.name);if(Yle(n)){const i=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()),Wp(await Kx(i),e,t)}const r=await Kx(n);if(e||(e=Uv(n)),!(t!=null&&t.type)){const i=r.find(a=>typeof a=="object"&&"type"in a&&a.type);typeof i=="string"&&(t={...t,type:i})}return Wp(r,e,t)}async function Kx(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(m9(n))e.push(n instanceof Blob?n:await n.arrayBuffer());else if(p9(n))for await(const r of n)e.push(...await Kx(r));else{const r=(t=n==null?void 0:n.constructor)==null?void 0:t.name;throw new Error(`Unexpected data type: ${typeof n}${r?`; constructor: ${r}`:""}${Xle(n)}`)}return e}function Xle(n){return typeof n!="object"||n===null?"":`; props: [${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}let It=class{constructor(e){this._client=e}};function g9(n){return n.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const Qle=(n=g9)=>function(t,...r){if(t.length===1)return t[0];let i=!1;const a=t.reduce((d,h,m)=>(/[?#]/.test(h)&&(i=!0),d+h+(m===r.length?"":(i?encodeURIComponent:n)(String(r[m])))),""),s=a.split(/[?#]/,1)[0],o=[],u=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let c;for(;(c=u.exec(s))!==null;)o.push({start:c.index,length:c[0].length});if(o.length>0){let d=0;const h=o.reduce((m,g)=>{const _=" ".repeat(g.start-d),w="^".repeat(g.length);return d=g.start+g.length,m+_+w},"");throw new Tt(`Path parameters result in path with invalid segments:
${a}
${h}`)}return a},at=Qle(g9);let y9=class extends It{list(e,t={},r){return this._client.getAPIList(at`/chat/completions/${e}/messages`,fr,{query:t,...r})}};function eue(n){return typeof n.parse=="function"}const j_=n=>(n==null?void 0:n.role)==="assistant",v9=n=>(n==null?void 0:n.role)==="tool";var Jx,jv,Fv,xp,Rp,Bv,Ip,Uo,Pp,F_,B_,Bf,_9;class uP{constructor(){Jx.add(this),this.controller=new AbortController,jv.set(this,void 0),Fv.set(this,()=>{}),xp.set(this,()=>{}),Rp.set(this,void 0),Bv.set(this,()=>{}),Ip.set(this,()=>{}),Uo.set(this,{}),Pp.set(this,!1),F_.set(this,!1),B_.set(this,!1),Bf.set(this,!1),Ct(this,jv,new Promise((e,t)=>{Ct(this,Fv,e,"f"),Ct(this,xp,t,"f")})),Ct(this,Rp,new Promise((e,t)=>{Ct(this,Bv,e,"f"),Ct(this,Ip,t,"f")})),Ne(this,jv,"f").catch(()=>{}),Ne(this,Rp,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},Ne(this,Jx,"m",_9).bind(this))},0)}_connected(){this.ended||(Ne(this,Fv,"f").call(this),this._emit("connect"))}get ended(){return Ne(this,Pp,"f")}get errored(){return Ne(this,F_,"f")}get aborted(){return Ne(this,B_,"f")}abort(){this.controller.abort()}on(e,t){return(Ne(this,Uo,"f")[e]||(Ne(this,Uo,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=Ne(this,Uo,"f")[e];if(!r)return this;const i=r.findIndex(a=>a.listener===t);return i>=0&&r.splice(i,1),this}once(e,t){return(Ne(this,Uo,"f")[e]||(Ne(this,Uo,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{Ct(this,Bf,!0),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){Ct(this,Bf,!0),await Ne(this,Rp,"f")}_emit(e,...t){if(Ne(this,Pp,"f"))return;e==="end"&&(Ct(this,Pp,!0),Ne(this,Bv,"f").call(this));const r=Ne(this,Uo,"f")[e];if(r&&(Ne(this,Uo,"f")[e]=r.filter(i=>!i.once),r.forEach(({listener:i})=>i(...t))),e==="abort"){const i=t[0];!Ne(this,Bf,"f")&&!(r!=null&&r.length)&&Promise.reject(i),Ne(this,xp,"f").call(this,i),Ne(this,Ip,"f").call(this,i),this._emit("end");return}if(e==="error"){const i=t[0];!Ne(this,Bf,"f")&&!(r!=null&&r.length)&&Promise.reject(i),Ne(this,xp,"f").call(this,i),Ne(this,Ip,"f").call(this,i),this._emit("end")}}_emitFinal(){}}jv=new WeakMap,Fv=new WeakMap,xp=new WeakMap,Rp=new WeakMap,Bv=new WeakMap,Ip=new WeakMap,Uo=new WeakMap,Pp=new WeakMap,F_=new WeakMap,B_=new WeakMap,Bf=new WeakMap,Jx=new WeakSet,_9=function(e){if(Ct(this,F_,!0),e instanceof Error&&e.name==="AbortError"&&(e=new _a),e instanceof _a)return Ct(this,B_,!0),this._emit("abort",e);if(e instanceof Tt)return this._emit("error",e);if(e instanceof Error){const t=new Tt(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new Tt(String(e)))};function tue(n,e){const t={...n};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function cP(n){return(n==null?void 0:n.$brand)==="auto-parseable-response-format"}function Qm(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function nue(n,e){return!e||!b9(e)?{...n,choices:n.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:fP(n,e)}function fP(n,e){const t=n.choices.map(r=>{var i;if(r.finish_reason==="length")throw new Xq;if(r.finish_reason==="content_filter")throw new Qq;return{...r,message:{...r.message,...r.message.tool_calls?{tool_calls:((i=r.message.tool_calls)==null?void 0:i.map(a=>iue(e,a)))??void 0}:void 0,parsed:r.message.content&&!r.message.refusal?rue(e,r.message.content):null}}});return{...n,choices:t}}function rue(n,e){var t,r;return((t=n.response_format)==null?void 0:t.type)!=="json_schema"?null:((r=n.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function iue(n,e){var r;const t=(r=n.tools)==null?void 0:r.find(i=>{var a;return((a=i.function)==null?void 0:a.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:Qm(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function aue(n,e){var r;if(!n)return!1;const t=(r=n.tools)==null?void 0:r.find(i=>{var a;return((a=i.function)==null?void 0:a.name)===e.function.name});return Qm(t)||(t==null?void 0:t.function.strict)||!1}function b9(n){var e;return cP(n.response_format)?!0:((e=n.tools)==null?void 0:e.some(t=>Qm(t)||t.type==="function"&&t.function.strict===!0))??!1}function sue(n){for(const e of n??[]){if(e.type!=="function")throw new Tt(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new Tt(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var gi,Yx,q_,Zx,Xx,Qx,w9,E9;const oue=10;class S9 extends uP{constructor(){super(...arguments),gi.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),v9(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(j_(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionToolCall",r.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new Tt("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),Ne(this,gi,"m",Yx).call(this)}async finalMessage(){return await this.done(),Ne(this,gi,"m",q_).call(this)}async finalFunctionToolCall(){return await this.done(),Ne(this,gi,"m",Zx).call(this)}async finalFunctionToolCallResult(){return await this.done(),Ne(this,gi,"m",Xx).call(this)}async totalUsage(){return await this.done(),Ne(this,gi,"m",Qx).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=Ne(this,gi,"m",q_).call(this);t&&this._emit("finalMessage",t);const r=Ne(this,gi,"m",Yx).call(this);r&&this._emit("finalContent",r);const i=Ne(this,gi,"m",Zx).call(this);i&&this._emit("finalFunctionToolCall",i);const a=Ne(this,gi,"m",Xx).call(this);a!=null&&this._emit("finalFunctionToolCallResult",a),this._chatCompletions.some(s=>s.usage)&&this._emit("totalUsage",Ne(this,gi,"m",Qx).call(this))}async _createChatCompletion(e,t,r){const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),Ne(this,gi,"m",w9).call(this,t);const a=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(fP(a,t))}async _runChatCompletion(e,t,r){for(const i of t.messages)this._addMessage(i,!1);return await this._createChatCompletion(e,t,r)}async _runTools(e,t,r){var g,_,w;const i="tool",{tool_choice:a="auto",stream:s,...o}=t,u=typeof a!="string"&&((g=a==null?void 0:a.function)==null?void 0:g.name),{maxChatCompletions:c=oue}=r||{},d=t.tools.map(S=>{if(Qm(S)){if(!S.$callback)throw new Tt("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:S.$callback,name:S.function.name,description:S.function.description||"",parameters:S.function.parameters,parse:S.$parseRaw,strict:!0}}}return S}),h={};for(const S of d)S.type==="function"&&(h[S.function.name||S.function.function.name]=S.function);const m="tools"in t?d.map(S=>S.type==="function"?{type:"function",function:{name:S.function.name||S.function.function.name,parameters:S.function.parameters,description:S.function.description,strict:S.function.strict}}:S):void 0;for(const S of t.messages)this._addMessage(S,!1);for(let S=0;S<c;++S){const C=(_=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:m,messages:[...this.messages]},r)).choices[0])==null?void 0:_.message;if(!C)throw new Tt("missing message in ChatCompletion response");if(!((w=C.tool_calls)!=null&&w.length))return;for(const A of C.tool_calls){if(A.type!=="function")continue;const R=A.id,{name:P,arguments:N}=A.function,U=h[P];if(U){if(u&&u!==P){const G=`Invalid tool_call: ${JSON.stringify(P)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:i,tool_call_id:R,content:G});continue}}else{const G=`Invalid tool_call: ${JSON.stringify(P)}. Available options are: ${Object.keys(h).map(z=>JSON.stringify(z)).join(", ")}. Please try again`;this._addMessage({role:i,tool_call_id:R,content:G});continue}let k;try{k=eue(U)?await U.parse(N):N}catch(G){const z=G instanceof Error?G.message:String(G);this._addMessage({role:i,tool_call_id:R,content:z});continue}const B=await U.function(k,this),H=Ne(this,gi,"m",E9).call(this,B);if(this._addMessage({role:i,tool_call_id:R,content:H}),u)return}}}}gi=new WeakSet,Yx=function(){return Ne(this,gi,"m",q_).call(this).content??null},q_=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(j_(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new Tt("stream ended without producing a ChatCompletionMessage with role=assistant")},Zx=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){const i=this.messages[r];if(j_(i)&&((e=i==null?void 0:i.tool_calls)!=null&&e.length))return(t=i.tool_calls.at(-1))==null?void 0:t.function}},Xx=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(v9(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>{var i;return r.role==="assistant"&&((i=r.tool_calls)==null?void 0:i.some(a=>a.type==="function"&&a.id===t.tool_call_id))}))return t.content}},Qx=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},w9=function(e){if(e.n!=null&&e.n>1)throw new Tt("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},E9=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class dP extends S9{static runTools(e,t,r){const i=new dP,a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,t,a)),i}_addMessage(e,t=!0){super._addMessage(e,t),j_(e)&&e.content&&this._emit("content",e.content)}}const T9=1,A9=2,C9=4,x9=8,R9=16,I9=32,P9=64,O9=128,k9=256,N9=O9|k9,M9=R9|I9|N9|P9,D9=T9|A9|M9,$9=C9|x9,lue=D9|$9,Mr={STR:T9,NUM:A9,ARR:C9,OBJ:x9,NULL:R9,BOOL:I9,NAN:P9,INFINITY:O9,MINUS_INFINITY:k9,INF:N9,SPECIAL:M9,ATOM:D9,COLLECTION:$9,ALL:lue};class uue extends Error{}class cue extends Error{}function fue(n,e=Mr.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return due(n.trim(),e)}const due=(n,e)=>{const t=n.length;let r=0;const i=m=>{throw new uue(`${m} at position ${r}`)},a=m=>{throw new cue(`${m} at position ${r}`)},s=()=>(h(),r>=t&&i("Unexpected end of input"),n[r]==='"'?o():n[r]==="{"?u():n[r]==="["?c():n.substring(r,r+4)==="null"||Mr.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||Mr.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||Mr.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||Mr.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||Mr.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||Mr.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):d()),o=()=>{const m=r;let g=!1;for(r++;r<t&&(n[r]!=='"'||g&&n[r-1]==="\\");)g=n[r]==="\\"?!g:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(m,++r-Number(g)))}catch(_){a(String(_))}else if(Mr.STR&e)try{return JSON.parse(n.substring(m,r-Number(g))+'"')}catch{return JSON.parse(n.substring(m,n.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},u=()=>{r++,h();const m={};try{for(;n[r]!=="}";){if(h(),r>=t&&Mr.OBJ&e)return m;const g=o();h(),r++;try{const _=s();Object.defineProperty(m,g,{value:_,writable:!0,enumerable:!0,configurable:!0})}catch(_){if(Mr.OBJ&e)return m;throw _}h(),n[r]===","&&r++}}catch{if(Mr.OBJ&e)return m;i("Expected '}' at end of object")}return r++,m},c=()=>{r++;const m=[];try{for(;n[r]!=="]";)m.push(s()),h(),n[r]===","&&r++}catch{if(Mr.ARR&e)return m;i("Expected ']' at end of array")}return r++,m},d=()=>{if(r===0){n==="-"&&Mr.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(n)}catch(g){if(Mr.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}a(String(g))}}const m=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(Mr.NUM&e)&&i("Unterminated number literal");try{return JSON.parse(n.substring(m,r))}catch{n.substring(m,r)==="-"&&Mr.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(n.substring(m,n.lastIndexOf("e")))}catch(_){a(String(_))}}},h=()=>{for(;r<t&&` 
\r	`.includes(n[r]);)r++};return s()},Qj=n=>fue(n,Mr.ALL^Mr.NUM);var vr,ko,Tf,Nl,qA,Zy,VA,zA,HA,Xy,GA,e2;class vm extends S9{constructor(e){super(),vr.add(this),ko.set(this,void 0),Tf.set(this,void 0),Nl.set(this,void 0),Ct(this,ko,e),Ct(this,Tf,[])}get currentChatCompletionSnapshot(){return Ne(this,Nl,"f")}static fromReadableStream(e){const t=new vm(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){const i=new vm(t);return i._run(()=>i._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createChatCompletion(e,t,r){var s;super._createChatCompletion;const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),Ne(this,vr,"m",qA).call(this);const a=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of a)Ne(this,vr,"m",VA).call(this,o);if((s=a.controller.signal)!=null&&s.aborted)throw new _a;return this._addChatCompletion(Ne(this,vr,"m",Xy).call(this))}async _fromReadableStream(e,t){var s;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Ne(this,vr,"m",qA).call(this),this._connected();const i=ym.fromReadableStream(e,this.controller);let a;for await(const o of i)a&&a!==o.id&&this._addChatCompletion(Ne(this,vr,"m",Xy).call(this)),Ne(this,vr,"m",VA).call(this,o),a=o.id;if((s=i.controller.signal)!=null&&s.aborted)throw new _a;return this._addChatCompletion(Ne(this,vr,"m",Xy).call(this))}[(ko=new WeakMap,Tf=new WeakMap,Nl=new WeakMap,vr=new WeakSet,qA=function(){this.ended||Ct(this,Nl,void 0)},Zy=function(t){let r=Ne(this,Tf,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Ne(this,Tf,"f")[t.index]=r,r)},VA=function(t){var i,a,s,o,u,c,d,h,m,g,_,w,S,E,C;if(this.ended)return;const r=Ne(this,vr,"m",e2).call(this,t);this._emit("chunk",t,r);for(const A of t.choices){const R=r.choices[A.index];A.delta.content!=null&&((i=R.message)==null?void 0:i.role)==="assistant"&&((a=R.message)!=null&&a.content)&&(this._emit("content",A.delta.content,R.message.content),this._emit("content.delta",{delta:A.delta.content,snapshot:R.message.content,parsed:R.message.parsed})),A.delta.refusal!=null&&((s=R.message)==null?void 0:s.role)==="assistant"&&((o=R.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:A.delta.refusal,snapshot:R.message.refusal}),((u=A.logprobs)==null?void 0:u.content)!=null&&((c=R.message)==null?void 0:c.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(d=A.logprobs)==null?void 0:d.content,snapshot:((h=R.logprobs)==null?void 0:h.content)??[]}),((m=A.logprobs)==null?void 0:m.refusal)!=null&&((g=R.message)==null?void 0:g.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(_=A.logprobs)==null?void 0:_.refusal,snapshot:((w=R.logprobs)==null?void 0:w.refusal)??[]});const P=Ne(this,vr,"m",Zy).call(this,R);R.finish_reason&&(Ne(this,vr,"m",HA).call(this,R),P.current_tool_call_index!=null&&Ne(this,vr,"m",zA).call(this,R,P.current_tool_call_index));for(const N of A.delta.tool_calls??[])P.current_tool_call_index!==N.index&&(Ne(this,vr,"m",HA).call(this,R),P.current_tool_call_index!=null&&Ne(this,vr,"m",zA).call(this,R,P.current_tool_call_index)),P.current_tool_call_index=N.index;for(const N of A.delta.tool_calls??[]){const U=(S=R.message.tool_calls)==null?void 0:S[N.index];U!=null&&U.type&&((U==null?void 0:U.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(E=U.function)==null?void 0:E.name,index:N.index,arguments:U.function.arguments,parsed_arguments:U.function.parsed_arguments,arguments_delta:((C=N.function)==null?void 0:C.arguments)??""}):(U==null||U.type,void 0))}}},zA=function(t,r){var s,o,u;if(Ne(this,vr,"m",Zy).call(this,t).done_tool_calls.has(r))return;const a=(s=t.message.tool_calls)==null?void 0:s[r];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){const c=(u=(o=Ne(this,ko,"f"))==null?void 0:o.tools)==null?void 0:u.find(d=>d.type==="function"&&d.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:r,arguments:a.function.arguments,parsed_arguments:Qm(c)?c.$parseRaw(a.function.arguments):c!=null&&c.function.strict?JSON.parse(a.function.arguments):null})}else a.type},HA=function(t){var i,a;const r=Ne(this,vr,"m",Zy).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;const s=Ne(this,vr,"m",GA).call(this);this._emit("content.done",{content:t.message.content,parsed:s?s.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(i=t.logprobs)!=null&&i.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(a=t.logprobs)!=null&&a.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Xy=function(){if(this.ended)throw new Tt("stream has ended, this shouldn't happen");const t=Ne(this,Nl,"f");if(!t)throw new Tt("request ended without sending any chunks");return Ct(this,Nl,void 0),Ct(this,Tf,[]),hue(t,Ne(this,ko,"f"))},GA=function(){var r;const t=(r=Ne(this,ko,"f"))==null?void 0:r.response_format;return cP(t)?t:null},e2=function(t){var r,i,a,s;let o=Ne(this,Nl,"f");const{choices:u,...c}=t;o?Object.assign(o,c):o=Ct(this,Nl,{...c,choices:[]});for(const{delta:d,finish_reason:h,index:m,logprobs:g=null,..._}of t.choices){let w=o.choices[m];if(w||(w=o.choices[m]={finish_reason:h,index:m,message:{},logprobs:g,..._}),g)if(!w.logprobs)w.logprobs=Object.assign({},g);else{const{content:N,refusal:U,...k}=g;Object.assign(w.logprobs,k),N&&((r=w.logprobs).content??(r.content=[]),w.logprobs.content.push(...N)),U&&((i=w.logprobs).refusal??(i.refusal=[]),w.logprobs.refusal.push(...U))}if(h&&(w.finish_reason=h,Ne(this,ko,"f")&&b9(Ne(this,ko,"f")))){if(h==="length")throw new Xq;if(h==="content_filter")throw new Qq}if(Object.assign(w,_),!d)continue;const{content:S,refusal:E,function_call:C,role:A,tool_calls:R,...P}=d;if(Object.assign(w.message,P),E&&(w.message.refusal=(w.message.refusal||"")+E),A&&(w.message.role=A),C&&(w.message.function_call?(C.name&&(w.message.function_call.name=C.name),C.arguments&&((a=w.message.function_call).arguments??(a.arguments=""),w.message.function_call.arguments+=C.arguments)):w.message.function_call=C),S&&(w.message.content=(w.message.content||"")+S,!w.message.refusal&&Ne(this,vr,"m",GA).call(this)&&(w.message.parsed=Qj(w.message.content))),R){w.message.tool_calls||(w.message.tool_calls=[]);for(const{index:N,id:U,type:k,function:B,...H}of R){const G=(s=w.message.tool_calls)[N]??(s[N]={});Object.assign(G,H),U&&(G.id=U),k&&(G.type=k),B&&(G.function??(G.function={name:B.name??"",arguments:""})),B!=null&&B.name&&(G.function.name=B.name),B!=null&&B.arguments&&(G.function.arguments+=B.arguments,aue(Ne(this,ko,"f"),G)&&(G.function.parsed_arguments=Qj(G.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",i=>{const a=t.shift();a?a.resolve(i):e.push(i)}),this.on("end",()=>{r=!0;for(const i of t)i.resolve(void 0);t.length=0}),this.on("abort",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),this.on("error",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,s)=>t.push({resolve:a,reject:s})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new ym(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function hue(n,e){const{id:t,choices:r,created:i,model:a,system_fingerprint:s,...o}=n,u={...o,id:t,choices:r.map(({message:c,finish_reason:d,index:h,logprobs:m,...g})=>{if(!d)throw new Tt(`missing finish_reason for choice ${h}`);const{content:_=null,function_call:w,tool_calls:S,...E}=c,C=c.role;if(!C)throw new Tt(`missing role for choice ${h}`);if(w){const{arguments:A,name:R}=w;if(A==null)throw new Tt(`missing function_call.arguments for choice ${h}`);if(!R)throw new Tt(`missing function_call.name for choice ${h}`);return{...g,message:{content:_,function_call:{arguments:A,name:R},role:C,refusal:c.refusal??null},finish_reason:d,index:h,logprobs:m}}return S?{...g,index:h,finish_reason:d,logprobs:m,message:{...E,role:C,content:_,refusal:c.refusal??null,tool_calls:S.map((A,R)=>{const{function:P,type:N,id:U,...k}=A,{arguments:B,name:H,...G}=P||{};if(U==null)throw new Tt(`missing choices[${h}].tool_calls[${R}].id
${Qy(n)}`);if(N==null)throw new Tt(`missing choices[${h}].tool_calls[${R}].type
${Qy(n)}`);if(H==null)throw new Tt(`missing choices[${h}].tool_calls[${R}].function.name
${Qy(n)}`);if(B==null)throw new Tt(`missing choices[${h}].tool_calls[${R}].function.arguments
${Qy(n)}`);return{...k,id:U,type:N,function:{...G,name:H,arguments:B}}})}}:{...g,message:{...E,content:_,role:C,refusal:c.refusal??null},finish_reason:d,index:h,logprobs:m}}),created:i,model:a,object:"chat.completion",...s?{system_fingerprint:s}:{}};return nue(u,e)}function Qy(n){return JSON.stringify(n)}class V_ extends vm{static fromReadableStream(e){const t=new V_(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,r){const i=new V_(t),a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,t,a)),i}}let hP=class extends It{constructor(){super(...arguments),this.messages=new y9(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(at`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(at`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/chat/completions",fr,{query:e,...t})}delete(e,t){return this._client.delete(at`/chat/completions/${e}`,t)}parse(e,t){return sue(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(r=>fP(r,e))}runTools(e,t){return e.stream?V_.runTools(this._client,e,t):dP.runTools(this._client,e,t)}stream(e,t){return vm.createChatCompletion(this._client,e,t)}};hP.Messages=y9;let pP=class extends It{constructor(){super(...arguments),this.completions=new hP(this._client)}};pP.Completions=hP;const L9=Symbol("brand.privateNullableHeaders");function*pue(n){if(!n)return;if(L9 in n){const{values:r,nulls:i}=n;yield*r.entries();for(const a of i)yield[a,null];return}let e=!1,t;n instanceof Headers?t=n.entries():Fj(n)?t=n:(e=!0,t=Object.entries(n??{}));for(let r of t){const i=r[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");const a=Fj(r[1])?r[1]:[r[1]];let s=!1;for(const o of a)o!==void 0&&(e&&!s&&(s=!0,yield[i,null]),yield[i,o])}}const yt=n=>{const e=new Headers,t=new Set;for(const r of n){const i=new Set;for(const[a,s]of pue(r)){const o=a.toLowerCase();i.has(o)||(e.delete(a),i.add(o)),s===null?(e.delete(a),t.add(o)):(e.append(a,s),t.delete(o))}}return{[L9]:!0,values:e,nulls:t}};class U9 extends It{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:yt([{Accept:"application/octet-stream"},t==null?void 0:t.headers]),__binaryResponse:!0})}}class j9 extends It{create(e,t){return this._client.post("/audio/transcriptions",hc({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class F9 extends It{create(e,t){return this._client.post("/audio/translations",hc({body:e,...t,__metadata:{model:e.model}},this._client))}}class eg extends It{constructor(){super(...arguments),this.transcriptions=new j9(this._client),this.translations=new F9(this._client),this.speech=new U9(this._client)}}eg.Transcriptions=j9;eg.Translations=F9;eg.Speech=U9;let B9=class extends It{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(at`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",fr,{query:e,...t})}cancel(e,t){return this._client.post(at`/batches/${e}/cancel`,t)}};class q9 extends It{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:yt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(at`/assistants/${e}`,{...t,headers:yt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,r){return this._client.post(at`/assistants/${e}`,{body:t,...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e={},t){return this._client.getAPIList("/assistants",fr,{query:e,...t,headers:yt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete(at`/assistants/${e}`,{...t,headers:yt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}class V9 extends It{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:yt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}class z9 extends It{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:yt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}class iw extends It{constructor(){super(...arguments),this.sessions=new V9(this._client),this.transcriptionSessions=new z9(this._client)}}iw.Sessions=V9;iw.TranscriptionSessions=z9;let H9=class extends It{create(e,t,r){return this._client.post(at`/threads/${e}/messages`,{body:t,...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}retrieve(e,t,r){const{thread_id:i}=t;return this._client.get(at`/threads/${i}/messages/${e}`,{...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}update(e,t,r){const{thread_id:i,...a}=t;return this._client.post(at`/threads/${i}/messages/${e}`,{body:a,...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e,t={},r){return this._client.getAPIList(at`/threads/${e}/messages`,fr,{query:t,...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}delete(e,t,r){const{thread_id:i}=t;return this._client.delete(at`/threads/${i}/messages/${e}`,{...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}};class G9 extends It{retrieve(e,t,r){const{thread_id:i,run_id:a,...s}=t;return this._client.get(at`/threads/${i}/runs/${a}/steps/${e}`,{query:s,...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e,t,r){const{thread_id:i,...a}=t;return this._client.getAPIList(at`/threads/${i}/runs/${e}/steps`,fr,{query:a,...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}}const mue=n=>{if(typeof Yu<"u"){const e=Yu.from(n,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(n),t=e.length,r=new Uint8Array(t);for(let i=0;i<t;i++)r[i]=e.charCodeAt(i);return Array.from(new Float32Array(r.buffer))}};var WA={};const Af=n=>{var e,t,r,i;if(typeof globalThis.process<"u")return((e=WA==null?void 0:WA[n])==null?void 0:e.trim())??void 0;if(typeof globalThis.Deno<"u")return(i=(r=(t=globalThis.Deno.env)==null?void 0:t.get)==null?void 0:r.call(t,n))==null?void 0:i.trim()};var Wr,qu,eR,Hs,qv,ms,Vu,Yf,ju,z_,ma,Vv,zv,Kp,Op,kp,t2,n2,r2,i2,a2,s2,o2;class Jp extends uP{constructor(){super(...arguments),Wr.add(this),eR.set(this,[]),Hs.set(this,{}),qv.set(this,{}),ms.set(this,void 0),Vu.set(this,void 0),Yf.set(this,void 0),ju.set(this,void 0),z_.set(this,void 0),ma.set(this,void 0),Vv.set(this,void 0),zv.set(this,void 0),Kp.set(this,void 0)}[(eR=new WeakMap,Hs=new WeakMap,qv=new WeakMap,ms=new WeakMap,Vu=new WeakMap,Yf=new WeakMap,ju=new WeakMap,z_=new WeakMap,ma=new WeakMap,Vv=new WeakMap,zv=new WeakMap,Kp=new WeakMap,Wr=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",i=>{const a=t.shift();a?a.resolve(i):e.push(i)}),this.on("end",()=>{r=!0;for(const i of t)i.resolve(void 0);t.length=0}),this.on("abort",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),this.on("error",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,s)=>t.push({resolve:a,reject:s})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new qu;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var a;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const i=ym.fromReadableStream(e,this.controller);for await(const s of i)Ne(this,Wr,"m",Op).call(this,s);if((a=i.controller.signal)!=null&&a.aborted)throw new _a;return this._addRun(Ne(this,Wr,"m",kp).call(this))}toReadableStream(){return new ym(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,i){const a=new qu;return a._run(()=>a._runToolAssistantStream(e,t,r,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,r,i){var u;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const s={...r,stream:!0},o=await e.submitToolOutputs(t,s,{...i,signal:this.controller.signal});this._connected();for await(const c of o)Ne(this,Wr,"m",Op).call(this,c);if((u=o.controller.signal)!=null&&u.aborted)throw new _a;return this._addRun(Ne(this,Wr,"m",kp).call(this))}static createThreadAssistantStream(e,t,r){const i=new qu;return i._run(()=>i._threadAssistantStream(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(e,t,r,i){const a=new qu;return a._run(()=>a._runAssistantStream(e,t,r,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return Ne(this,Vv,"f")}currentRun(){return Ne(this,zv,"f")}currentMessageSnapshot(){return Ne(this,ms,"f")}currentRunStepSnapshot(){return Ne(this,Kp,"f")}async finalRunSteps(){return await this.done(),Object.values(Ne(this,Hs,"f"))}async finalMessages(){return await this.done(),Object.values(Ne(this,qv,"f"))}async finalRun(){if(await this.done(),!Ne(this,Vu,"f"))throw Error("Final run was not received.");return Ne(this,Vu,"f")}async _createThreadAssistantStream(e,t,r){var o;const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...t,stream:!0},s=await e.createAndRun(a,{...r,signal:this.controller.signal});this._connected();for await(const u of s)Ne(this,Wr,"m",Op).call(this,u);if((o=s.controller.signal)!=null&&o.aborted)throw new _a;return this._addRun(Ne(this,Wr,"m",kp).call(this))}async _createAssistantStream(e,t,r,i){var u;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const s={...r,stream:!0},o=await e.create(t,s,{...i,signal:this.controller.signal});this._connected();for await(const c of o)Ne(this,Wr,"m",Op).call(this,c);if((u=o.controller.signal)!=null&&u.aborted)throw new _a;return this._addRun(Ne(this,Wr,"m",kp).call(this))}static accumulateDelta(e,t){for(const[r,i]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=i;continue}let a=e[r];if(a==null){e[r]=i;continue}if(r==="index"||r==="type"){e[r]=i;continue}if(typeof a=="string"&&typeof i=="string")a+=i;else if(typeof a=="number"&&typeof i=="number")a+=i;else if(jA(a)&&jA(i))a=this.accumulateDelta(a,i);else if(Array.isArray(a)&&Array.isArray(i)){if(a.every(s=>typeof s=="string"||typeof s=="number")){a.push(...i);continue}for(const s of i){if(!jA(s))throw new Error(`Expected array delta entry to be an object but got: ${s}`);const o=s.index;if(o==null)throw console.error(s),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const u=a[o];u==null?a.push(s):a[o]=this.accumulateDelta(u,s)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${i}, accValue: ${a}`);e[r]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,i){return await this._createAssistantStream(t,e,r,i)}async _runToolAssistantStream(e,t,r,i){return await this._createToolAssistantStream(t,e,r,i)}}qu=Jp,Op=function(e){if(!this.ended)switch(Ct(this,Vv,e),Ne(this,Wr,"m",r2).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":Ne(this,Wr,"m",o2).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Ne(this,Wr,"m",n2).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":Ne(this,Wr,"m",t2).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},kp=function(){if(this.ended)throw new Tt("stream has ended, this shouldn't happen");if(!Ne(this,Vu,"f"))throw Error("Final run has not been received");return Ne(this,Vu,"f")},t2=function(e){const[t,r]=Ne(this,Wr,"m",a2).call(this,e,Ne(this,ms,"f"));Ct(this,ms,t),Ne(this,qv,"f")[t.id]=t;for(const i of r){const a=t.content[i.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const i of e.data.delta.content){if(i.type=="text"&&i.text){let a=i.text,s=t.content[i.index];if(s&&s.type=="text")this._emit("textDelta",a,s.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(i.index!=Ne(this,Yf,"f")){if(Ne(this,ju,"f"))switch(Ne(this,ju,"f").type){case"text":this._emit("textDone",Ne(this,ju,"f").text,Ne(this,ms,"f"));break;case"image_file":this._emit("imageFileDone",Ne(this,ju,"f").image_file,Ne(this,ms,"f"));break}Ct(this,Yf,i.index)}Ct(this,ju,t.content[i.index])}break;case"thread.message.completed":case"thread.message.incomplete":if(Ne(this,Yf,"f")!==void 0){const i=e.data.content[Ne(this,Yf,"f")];if(i)switch(i.type){case"image_file":this._emit("imageFileDone",i.image_file,Ne(this,ms,"f"));break;case"text":this._emit("textDone",i.text,Ne(this,ms,"f"));break}}Ne(this,ms,"f")&&this._emit("messageDone",e.data),Ct(this,ms,void 0)}},n2=function(e){const t=Ne(this,Wr,"m",i2).call(this,e);switch(Ct(this,Kp,t),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const a of r.step_details.tool_calls)a.index==Ne(this,z_,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(Ne(this,ma,"f")&&this._emit("toolCallDone",Ne(this,ma,"f")),Ct(this,z_,a.index),Ct(this,ma,t.step_details.tool_calls[a.index]),Ne(this,ma,"f")&&this._emit("toolCallCreated",Ne(this,ma,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Ct(this,Kp,void 0),e.data.step_details.type=="tool_calls"&&Ne(this,ma,"f")&&(this._emit("toolCallDone",Ne(this,ma,"f")),Ct(this,ma,void 0)),this._emit("runStepDone",e.data,t);break}},r2=function(e){Ne(this,eR,"f").push(e),this._emit("event",e)},i2=function(e){switch(e.event){case"thread.run.step.created":return Ne(this,Hs,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=Ne(this,Hs,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const i=qu.accumulateDelta(t,r.delta);Ne(this,Hs,"f")[e.data.id]=i}return Ne(this,Hs,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":Ne(this,Hs,"f")[e.data.id]=e.data;break}if(Ne(this,Hs,"f")[e.data.id])return Ne(this,Hs,"f")[e.data.id];throw new Error("No snapshot available")},a2=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=e.data;if(i.delta.content)for(const a of i.delta.content)if(a.index in t.content){let s=t.content[a.index];t.content[a.index]=Ne(this,Wr,"m",s2).call(this,a,s)}else t.content[a.index]=a,r.push(a);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},s2=function(e,t){return qu.accumulateDelta(t,e)},o2=function(e){switch(Ct(this,zv,e.data),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":Ct(this,Vu,e.data),Ne(this,ma,"f")&&(this._emit("toolCallDone",Ne(this,ma,"f")),Ct(this,ma,void 0));break}};let mP=class extends It{constructor(){super(...arguments),this.steps=new G9(this._client)}create(e,t,r){const{include:i,...a}=t;return this._client.post(at`/threads/${e}/runs`,{query:{include:i},body:a,...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers]),stream:t.stream??!1})}retrieve(e,t,r){const{thread_id:i}=t;return this._client.get(at`/threads/${i}/runs/${e}`,{...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}update(e,t,r){const{thread_id:i,...a}=t;return this._client.post(at`/threads/${i}/runs/${e}`,{body:a,...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e,t={},r){return this._client.getAPIList(at`/threads/${e}/runs`,fr,{query:t,...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}cancel(e,t,r){const{thread_id:i}=t;return this._client.post(at`/threads/${i}/runs/${e}/cancel`,{...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async createAndPoll(e,t,r){const i=await this.create(e,t,r);return await this.poll(i.id,{thread_id:e},r)}createAndStream(e,t,r){return Jp.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){var a;const i=yt([r==null?void 0:r.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((a=r==null?void 0:r.pollIntervalMs)==null?void 0:a.toString())??void 0}]);for(;;){const{data:s,response:o}=await this.retrieve(e,t,{...r,headers:{...r==null?void 0:r.headers,...i}}).withResponse();switch(s.status){case"queued":case"in_progress":case"cancelling":let u=5e3;if(r!=null&&r.pollIntervalMs)u=r.pollIntervalMs;else{const c=o.headers.get("openai-poll-after-ms");if(c){const d=parseInt(c);isNaN(d)||(u=d)}}await Xm(u);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return s}}}stream(e,t,r){return Jp.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r){const{thread_id:i,...a}=t;return this._client.post(at`/threads/${i}/runs/${e}/submit_tool_outputs`,{body:a,...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,r){const i=await this.submitToolOutputs(e,t,r);return await this.poll(i.id,t,r)}submitToolOutputsStream(e,t,r){return Jp.createToolAssistantStream(e,this._client.beta.threads.runs,t,r)}};mP.Steps=G9;class aw extends It{constructor(){super(...arguments),this.runs=new mP(this._client),this.messages=new H9(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:yt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(at`/threads/${e}`,{...t,headers:yt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,r){return this._client.post(at`/threads/${e}`,{body:t,...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}delete(e,t){return this._client.delete(at`/threads/${e}`,{...t,headers:yt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:yt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){const r=await this.createAndRun(e,t);return await this.runs.poll(r.id,{thread_id:r.thread_id},t)}createAndRunStream(e,t){return Jp.createThreadAssistantStream(e,this._client.beta.threads,t)}}aw.Runs=mP;aw.Messages=H9;let tg=class extends It{constructor(){super(...arguments),this.realtime=new iw(this._client),this.assistants=new q9(this._client),this.threads=new aw(this._client)}};tg.Realtime=iw;tg.Assistants=q9;tg.Threads=aw;let W9=class extends It{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};class K9 extends It{retrieve(e,t,r){const{container_id:i}=t;return this._client.get(at`/containers/${i}/files/${e}/content`,{...r,headers:yt([{Accept:"application/binary"},r==null?void 0:r.headers]),__binaryResponse:!0})}}let gP=class extends It{constructor(){super(...arguments),this.content=new K9(this._client)}create(e,t,r){return this._client.post(at`/containers/${e}/files`,hc({body:t,...r},this._client))}retrieve(e,t,r){const{container_id:i}=t;return this._client.get(at`/containers/${i}/files/${e}`,r)}list(e,t={},r){return this._client.getAPIList(at`/containers/${e}/files`,fr,{query:t,...r})}delete(e,t,r){const{container_id:i}=t;return this._client.delete(at`/containers/${i}/files/${e}`,{...r,headers:yt([{Accept:"*/*"},r==null?void 0:r.headers])})}};gP.Content=K9;class yP extends It{constructor(){super(...arguments),this.files=new gP(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(at`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",fr,{query:e,...t})}delete(e,t){return this._client.delete(at`/containers/${e}`,{...t,headers:yt([{Accept:"*/*"},t==null?void 0:t.headers])})}}yP.Files=gP;let J9=class extends It{create(e,t){const r=!!e.encoding_format;let i=r?e.encoding_format:"base64";r&&ii(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const a=this._client.post("/embeddings",{body:{...e,encoding_format:i},...t});return r?a:(ii(this._client).debug("embeddings/decoding base64 embeddings from base64"),a._thenUnwrap(s=>(s&&s.data&&s.data.forEach(o=>{const u=o.embedding;o.embedding=mue(u)}),s)))}};class Y9 extends It{retrieve(e,t,r){const{eval_id:i,run_id:a}=t;return this._client.get(at`/evals/${i}/runs/${a}/output_items/${e}`,r)}list(e,t,r){const{eval_id:i,...a}=t;return this._client.getAPIList(at`/evals/${i}/runs/${e}/output_items`,fr,{query:a,...r})}}class vP extends It{constructor(){super(...arguments),this.outputItems=new Y9(this._client)}create(e,t,r){return this._client.post(at`/evals/${e}/runs`,{body:t,...r})}retrieve(e,t,r){const{eval_id:i}=t;return this._client.get(at`/evals/${i}/runs/${e}`,r)}list(e,t={},r){return this._client.getAPIList(at`/evals/${e}/runs`,fr,{query:t,...r})}delete(e,t,r){const{eval_id:i}=t;return this._client.delete(at`/evals/${i}/runs/${e}`,r)}cancel(e,t,r){const{eval_id:i}=t;return this._client.post(at`/evals/${i}/runs/${e}`,r)}}vP.OutputItems=Y9;class _P extends It{constructor(){super(...arguments),this.runs=new vP(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(at`/evals/${e}`,t)}update(e,t,r){return this._client.post(at`/evals/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/evals",fr,{query:e,...t})}delete(e,t){return this._client.delete(at`/evals/${e}`,t)}}_P.Runs=vP;let Z9=class extends It{create(e,t){return this._client.post("/files",hc({body:e,...t},this._client))}retrieve(e,t){return this._client.get(at`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",fr,{query:e,...t})}delete(e,t){return this._client.delete(at`/files/${e}`,t)}content(e,t){return this._client.get(at`/files/${e}/content`,{...t,headers:yt([{Accept:"application/binary"},t==null?void 0:t.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){const i=new Set(["processed","error","deleted"]),a=Date.now();let s=await this.retrieve(e);for(;!s.status||!i.has(s.status);)if(await Xm(t),s=await this.retrieve(e),Date.now()-a>r)throw new tw({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return s}};class X9 extends It{}let Q9=class extends It{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};class bP extends It{constructor(){super(...arguments),this.graders=new Q9(this._client)}}bP.Graders=Q9;class eV extends It{create(e,t,r){return this._client.getAPIList(at`/fine_tuning/checkpoints/${e}/permissions`,rw,{body:t,method:"post",...r})}retrieve(e,t={},r){return this._client.get(at`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...r})}delete(e,t,r){const{fine_tuned_model_checkpoint:i}=t;return this._client.delete(at`/fine_tuning/checkpoints/${i}/permissions/${e}`,r)}}let wP=class extends It{constructor(){super(...arguments),this.permissions=new eV(this._client)}};wP.Permissions=eV;class tV extends It{list(e,t={},r){return this._client.getAPIList(at`/fine_tuning/jobs/${e}/checkpoints`,fr,{query:t,...r})}}class EP extends It{constructor(){super(...arguments),this.checkpoints=new tV(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(at`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",fr,{query:e,...t})}cancel(e,t){return this._client.post(at`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return this._client.getAPIList(at`/fine_tuning/jobs/${e}/events`,fr,{query:t,...r})}pause(e,t){return this._client.post(at`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(at`/fine_tuning/jobs/${e}/resume`,t)}}EP.Checkpoints=tV;class zd extends It{constructor(){super(...arguments),this.methods=new X9(this._client),this.jobs=new EP(this._client),this.checkpoints=new wP(this._client),this.alpha=new bP(this._client)}}zd.Methods=X9;zd.Jobs=EP;zd.Checkpoints=wP;zd.Alpha=bP;class nV extends It{}class SP extends It{constructor(){super(...arguments),this.graderModels=new nV(this._client)}}SP.GraderModels=nV;class rV extends It{createVariation(e,t){return this._client.post("/images/variations",hc({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",hc({body:e,...t},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}let iV=class extends It{retrieve(e,t){return this._client.get(at`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",rw,e)}delete(e,t){return this._client.delete(at`/models/${e}`,t)}};class aV extends It{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function gue(n,e){return!e||!vue(e)?{...n,output_parsed:null,output:n.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(r=>({...r,parsed:null}))}:t)}:sV(n,e)}function sV(n,e){const t=n.output.map(i=>{if(i.type==="function_call")return{...i,parsed_arguments:wue(e,i)};if(i.type==="message"){const a=i.content.map(s=>s.type==="output_text"?{...s,parsed:yue(e,s.text)}:s);return{...i,content:a}}return i}),r=Object.assign({},n,{output:t});return Object.getOwnPropertyDescriptor(n,"output_text")||tR(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(const i of r.output)if(i.type==="message"){for(const a of i.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),r}function yue(n,e){var t,r,i,a;return((r=(t=n.text)==null?void 0:t.format)==null?void 0:r.type)!=="json_schema"?null:"$parseRaw"in((i=n.text)==null?void 0:i.format)?((a=n.text)==null?void 0:a.format).$parseRaw(e):JSON.parse(e)}function vue(n){var e;return!!cP((e=n.text)==null?void 0:e.format)}function _ue(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function bue(n,e){return n.find(t=>t.type==="function"&&t.name===e)}function wue(n,e){const t=bue(n.tools??[],e.name);return{...e,...e,parsed_arguments:_ue(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function tR(n){const e=[];for(const t of n.output)if(t.type==="message")for(const r of t.content)r.type==="output_text"&&e.push(r.text);n.output_text=e.join("")}var Cf,ev,Ml,tv,l2,u2,c2,f2;class TP extends uP{constructor(e){super(),Cf.add(this),ev.set(this,void 0),Ml.set(this,void 0),tv.set(this,void 0),Ct(this,ev,e)}static createResponse(e,t,r){const i=new TP(t);return i._run(()=>i._createOrRetrieveResponse(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createOrRetrieveResponse(e,t,r){var o;const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),Ne(this,Cf,"m",l2).call(this);let a,s=null;"response_id"in t?(a=await e.responses.retrieve(t.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),s=t.starting_after??null):a=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal}),this._connected();for await(const u of a)Ne(this,Cf,"m",u2).call(this,u,s);if((o=a.controller.signal)!=null&&o.aborted)throw new _a;return Ne(this,Cf,"m",c2).call(this)}[(ev=new WeakMap,Ml=new WeakMap,tv=new WeakMap,Cf=new WeakSet,l2=function(){this.ended||Ct(this,Ml,void 0)},u2=function(t,r){if(this.ended)return;const i=(s,o)=>{(r==null||o.sequence_number>r)&&this._emit(s,o)},a=Ne(this,Cf,"m",f2).call(this,t);switch(i("event",t),t.type){case"response.output_text.delta":{const s=a.output[t.output_index];if(!s)throw new Tt(`missing output at index ${t.output_index}`);if(s.type==="message"){const o=s.content[t.content_index];if(!o)throw new Tt(`missing content at index ${t.content_index}`);if(o.type!=="output_text")throw new Tt(`expected content to be 'output_text', got ${o.type}`);i("response.output_text.delta",{...t,snapshot:o.text})}break}case"response.function_call_arguments.delta":{const s=a.output[t.output_index];if(!s)throw new Tt(`missing output at index ${t.output_index}`);s.type==="function_call"&&i("response.function_call_arguments.delta",{...t,snapshot:s.arguments});break}default:i(t.type,t);break}},c2=function(){if(this.ended)throw new Tt("stream has ended, this shouldn't happen");const t=Ne(this,Ml,"f");if(!t)throw new Tt("request ended without sending any events");Ct(this,Ml,void 0);const r=Eue(t,Ne(this,ev,"f"));return Ct(this,tv,r),r},f2=function(t){let r=Ne(this,Ml,"f");if(!r){if(t.type!=="response.created")throw new Tt(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return r=Ct(this,Ml,t.response),r}switch(t.type){case"response.output_item.added":{r.output.push(t.item);break}case"response.content_part.added":{const i=r.output[t.output_index];if(!i)throw new Tt(`missing output at index ${t.output_index}`);i.type==="message"&&i.content.push(t.part);break}case"response.output_text.delta":{const i=r.output[t.output_index];if(!i)throw new Tt(`missing output at index ${t.output_index}`);if(i.type==="message"){const a=i.content[t.content_index];if(!a)throw new Tt(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new Tt(`expected content to be 'output_text', got ${a.type}`);a.text+=t.delta}break}case"response.function_call_arguments.delta":{const i=r.output[t.output_index];if(!i)throw new Tt(`missing output at index ${t.output_index}`);i.type==="function_call"&&(i.arguments+=t.delta);break}case"response.completed":{Ct(this,Ml,t.response);break}}return r},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",i=>{const a=t.shift();a?a.resolve(i):e.push(i)}),this.on("end",()=>{r=!0;for(const i of t)i.resolve(void 0);t.length=0}),this.on("abort",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),this.on("error",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,s)=>t.push({resolve:a,reject:s})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=Ne(this,tv,"f");if(!e)throw new Tt("stream ended without producing a ChatCompletion");return e}}function Eue(n,e){return gue(n,e)}class oV extends It{list(e,t={},r){return this._client.getAPIList(at`/responses/${e}/input_items`,fr,{query:t,...r})}}class AP extends It{constructor(){super(...arguments),this.inputItems=new oV(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&tR(r),r))}retrieve(e,t={},r){return this._client.get(at`/responses/${e}`,{query:t,...r,stream:(t==null?void 0:t.stream)??!1})._thenUnwrap(i=>("object"in i&&i.object==="response"&&tR(i),i))}delete(e,t){return this._client.delete(at`/responses/${e}`,{...t,headers:yt([{Accept:"*/*"},t==null?void 0:t.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(r=>sV(r,e))}stream(e,t){return TP.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(at`/responses/${e}/cancel`,t)}}AP.InputItems=oV;class lV extends It{create(e,t,r){return this._client.post(at`/uploads/${e}/parts`,hc({body:t,...r},this._client))}}class CP extends It{constructor(){super(...arguments),this.parts=new lV(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(at`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(at`/uploads/${e}/complete`,{body:t,...r})}}CP.Parts=lV;const Sue=async n=>{const e=await Promise.allSettled(n),t=e.filter(i=>i.status==="rejected");if(t.length){for(const i of t)console.error(i.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const r=[];for(const i of e)i.status==="fulfilled"&&r.push(i.value);return r};class uV extends It{create(e,t,r){return this._client.post(at`/vector_stores/${e}/file_batches`,{body:t,...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}retrieve(e,t,r){const{vector_store_id:i}=t;return this._client.get(at`/vector_stores/${i}/file_batches/${e}`,{...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}cancel(e,t,r){const{vector_store_id:i}=t;return this._client.post(at`/vector_stores/${i}/file_batches/${e}/cancel`,{...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async createAndPoll(e,t,r){const i=await this.create(e,t);return await this.poll(e,i.id,r)}listFiles(e,t,r){const{vector_store_id:i,...a}=t;return this._client.getAPIList(at`/vector_stores/${i}/file_batches/${e}/files`,fr,{query:a,...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async poll(e,t,r){var a;const i=yt([r==null?void 0:r.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((a=r==null?void 0:r.pollIntervalMs)==null?void 0:a.toString())??void 0}]);for(;;){const{data:s,response:o}=await this.retrieve(t,{vector_store_id:e},{...r,headers:i}).withResponse();switch(s.status){case"in_progress":let u=5e3;if(r!=null&&r.pollIntervalMs)u=r.pollIntervalMs;else{const c=o.headers.get("openai-poll-after-ms");if(c){const d=parseInt(c);isNaN(d)||(u=d)}}await Xm(u);break;case"failed":case"cancelled":case"completed":return s}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},i){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=(i==null?void 0:i.maxConcurrency)??5,s=Math.min(a,t.length),o=this._client,u=t.values(),c=[...r];async function d(m){for(let g of m){const _=await o.files.create({file:g,purpose:"assistants"},i);c.push(_.id)}}const h=Array(s).fill(u).map(d);return await Sue(h),await this.createAndPoll(e,{file_ids:c})}}let cV=class extends It{create(e,t,r){return this._client.post(at`/vector_stores/${e}/files`,{body:t,...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}retrieve(e,t,r){const{vector_store_id:i}=t;return this._client.get(at`/vector_stores/${i}/files/${e}`,{...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}update(e,t,r){const{vector_store_id:i,...a}=t;return this._client.post(at`/vector_stores/${i}/files/${e}`,{body:a,...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e,t={},r){return this._client.getAPIList(at`/vector_stores/${e}/files`,fr,{query:t,...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}delete(e,t,r){const{vector_store_id:i}=t;return this._client.delete(at`/vector_stores/${i}/files/${e}`,{...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async createAndPoll(e,t,r){const i=await this.create(e,t,r);return await this.poll(e,i.id,r)}async poll(e,t,r){var a;const i=yt([r==null?void 0:r.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((a=r==null?void 0:r.pollIntervalMs)==null?void 0:a.toString())??void 0}]);for(;;){const s=await this.retrieve(t,{vector_store_id:e},{...r,headers:i}).withResponse(),o=s.data;switch(o.status){case"in_progress":let u=5e3;if(r!=null&&r.pollIntervalMs)u=r.pollIntervalMs;else{const c=s.response.headers.get("openai-poll-after-ms");if(c){const d=parseInt(c);isNaN(d)||(u=d)}}await Xm(u);break;case"failed":case"completed":return o}}}async upload(e,t,r){const i=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:i.id},r)}async uploadAndPoll(e,t,r){const i=await this.upload(e,t,r);return await this.poll(e,i.id,r)}content(e,t,r){const{vector_store_id:i}=t;return this._client.getAPIList(at`/vector_stores/${i}/files/${e}/content`,rw,{...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}};class sw extends It{constructor(){super(...arguments),this.files=new cV(this._client),this.fileBatches=new uV(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:yt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(at`/vector_stores/${e}`,{...t,headers:yt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,r){return this._client.post(at`/vector_stores/${e}`,{body:t,...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",fr,{query:e,...t,headers:yt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete(at`/vector_stores/${e}`,{...t,headers:yt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}search(e,t,r){return this._client.getAPIList(at`/vector_stores/${e}/search`,rw,{body:t,method:"post",...r,headers:yt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}}sw.Files=cV;sw.FileBatches=uV;var qf,fV,Hv;class dV extends It{constructor(){super(...arguments),qf.add(this)}async unwrap(e,t,r=this._client.webhookSecret,i=300){return await this.verifySignature(e,t,r,i),JSON.parse(e)}async verifySignature(e,t,r=this._client.webhookSecret,i=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");Ne(this,qf,"m",fV).call(this,r);const a=yt([t]).values,s=Ne(this,qf,"m",Hv).call(this,a,"webhook-signature"),o=Ne(this,qf,"m",Hv).call(this,a,"webhook-timestamp"),u=Ne(this,qf,"m",Hv).call(this,a,"webhook-id"),c=parseInt(o,10);if(isNaN(c))throw new Sp("Invalid webhook timestamp format");const d=Math.floor(Date.now()/1e3);if(d-c>i)throw new Sp("Webhook timestamp is too old");if(c>d+i)throw new Sp("Webhook timestamp is too new");const h=s.split(" ").map(w=>w.startsWith("v1,")?w.substring(3):w),m=r.startsWith("whsec_")?Yu.from(r.replace("whsec_",""),"base64"):Yu.from(r,"utf-8"),g=u?`${u}.${o}.${e}`:`${o}.${e}`,_=await crypto.subtle.importKey("raw",m,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const w of h)try{const S=Yu.from(w,"base64");if(await crypto.subtle.verify("HMAC",_,S,new TextEncoder().encode(g)))return}catch{continue}throw new Sp("The given webhook signature does not match the expected signature")}}qf=new WeakSet,fV=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},Hv=function(e,t){if(!e)throw new Error("Headers are required");const r=e.get(t);if(r==null)throw new Error(`Missing required header: ${t}`);return r};var nR,xP,Gv,hV;let Zt=class{constructor({baseURL:e=Af("OPENAI_BASE_URL"),apiKey:t=Af("OPENAI_API_KEY"),organization:r=Af("OPENAI_ORG_ID")??null,project:i=Af("OPENAI_PROJECT_ID")??null,webhookSecret:a=Af("OPENAI_WEBHOOK_SECRET")??null,...s}={}){if(nR.add(this),Gv.set(this,void 0),this.completions=new W9(this),this.chat=new pP(this),this.embeddings=new J9(this),this.files=new Z9(this),this.images=new rV(this),this.audio=new eg(this),this.moderations=new aV(this),this.models=new iV(this),this.fineTuning=new zd(this),this.graders=new SP(this),this.vectorStores=new sw(this),this.webhooks=new dV(this),this.beta=new tg(this),this.batches=new B9(this),this.uploads=new CP(this),this.responses=new AP(this),this.evals=new _P(this),this.containers=new yP(this),t===void 0)throw new Tt("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const o={apiKey:t,organization:r,project:i,webhookSecret:a,...s,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&Sle())throw new Tt(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=o.baseURL,this.timeout=o.timeout??xP.DEFAULT_TIMEOUT,this.logger=o.logger??console;const u="warn";this.logLevel=u,this.logLevel=Yj(o.logLevel,"ClientOptions.logLevel",this)??Yj(Af("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??u,this.fetchOptions=o.fetchOptions,this.maxRetries=o.maxRetries??2,this.fetch=o.fetch??Rle(),Ct(this,Gv,Ple),this._options=o,this.apiKey=t,this.organization=r,this.project=i,this.webhookSecret=a}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}authHeaders(e){return yt([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return $le(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${Ff}`}defaultIdempotencyKey(){return`stainless-node-retry-${Vq()}`}makeStatusError(e,t,r,i){return Ki.generate(e,t,r,i)}buildURL(e,t,r){const i=!Ne(this,nR,"m",hV).call(this)&&r||this.baseURL,a=yle(e)?new URL(e):new URL(i+(i.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return _le(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(a.search=this.stringifyQuery(t)),a.toString()}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(i=>({method:e,path:t,...i})))}request(e,t=null){return new c9(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,r){var E,C;const i=await e,a=i.maxRetries??this.maxRetries;t==null&&(t=a),await this.prepareOptions(i);const{req:s,url:o,timeout:u}=this.buildRequest(i,{retryCount:a-t});await this.prepareRequest(s,{url:o,options:i});const c="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),d=r===void 0?"":`, retryOf: ${r}`,h=Date.now();if(ii(this).debug(`[${c}] sending request`,Du({retryOfRequestLogID:r,method:i.method,url:o,options:i,headers:s.headers})),(E=i.signal)!=null&&E.aborted)throw new _a;const m=new AbortController,g=await this.fetchWithTimeout(o,s,u,m).catch(zx),_=Date.now();if(g instanceof Error){const A=`retrying, ${t} attempts remaining`;if((C=i.signal)!=null&&C.aborted)throw new _a;const R=Vx(g)||/timed? ?out/i.test(String(g)+("cause"in g?String(g.cause):""));if(t)return ii(this).info(`[${c}] connection ${R?"timed out":"failed"} - ${A}`),ii(this).debug(`[${c}] connection ${R?"timed out":"failed"} (${A})`,Du({retryOfRequestLogID:r,url:o,durationMs:_-h,message:g.message})),this.retryRequest(i,t,r??c);throw ii(this).info(`[${c}] connection ${R?"timed out":"failed"} - error; no more retries left`),ii(this).debug(`[${c}] connection ${R?"timed out":"failed"} (error; no more retries left)`,Du({retryOfRequestLogID:r,url:o,durationMs:_-h,message:g.message})),R?new tw:new ew({cause:g})}const w=[...g.headers.entries()].filter(([A])=>A==="x-request-id").map(([A,R])=>", "+A+": "+JSON.stringify(R)).join(""),S=`[${c}${d}${w}] ${s.method} ${o} ${g.ok?"succeeded":"failed"} with status ${g.status} in ${_-h}ms`;if(!g.ok){const A=this.shouldRetry(g);if(t&&A){const B=`retrying, ${t} attempts remaining`;return await Ile(g.body),ii(this).info(`${S} - ${B}`),ii(this).debug(`[${c}] response error (${B})`,Du({retryOfRequestLogID:r,url:g.url,status:g.status,headers:g.headers,durationMs:_-h})),this.retryRequest(i,t,r??c,g.headers)}const R=A?"error; no more retries left":"error; not retryable";ii(this).info(`${S} - ${R}`);const P=await g.text().catch(B=>zx(B).message),N=Ele(P),U=N?void 0:P;throw ii(this).debug(`[${c}] response error (${R})`,Du({retryOfRequestLogID:r,url:g.url,status:g.status,headers:g.headers,message:U,durationMs:Date.now()-h})),this.makeStatusError(g.status,N,U,g.headers)}return ii(this).info(S),ii(this).debug(`[${c}] response start`,Du({retryOfRequestLogID:r,url:g.url,status:g.status,headers:g.headers,durationMs:_-h})),{response:g,options:i,controller:m,requestLogID:c,retryOfRequestLogID:r,startTime:h}}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}requestAPIList(e,t){const r=this.makeRequest(t,null,void 0);return new Hle(this,r,e)}async fetchWithTimeout(e,t,r,i){const{signal:a,method:s,...o}=t||{};a&&a.addEventListener("abort",()=>i.abort());const u=setTimeout(()=>i.abort(),r),c=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||typeof o.body=="object"&&o.body!==null&&Symbol.asyncIterator in o.body,d={signal:i.signal,...c?{duplex:"half"}:{},method:"GET",...o};s&&(d.method=s.toUpperCase());try{return await this.fetch.call(void 0,e,d)}finally{clearTimeout(u)}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r,i){let a;const s=i==null?void 0:i.get("retry-after-ms");if(s){const u=parseFloat(s);Number.isNaN(u)||(a=u)}const o=i==null?void 0:i.get("retry-after");if(o&&!a){const u=parseFloat(o);Number.isNaN(u)?a=Date.parse(o)-Date.now():a=u*1e3}if(!(a&&0<=a&&a<60*1e3)){const u=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,u)}return await Xm(a),this.makeRequest(e,t-1,r)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,s=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return s*o*1e3}buildRequest(e,{retryCount:t=0}={}){const r={...e},{method:i,path:a,query:s,defaultBaseURL:o}=r,u=this.buildURL(a,s,o);"timeout"in r&&wle("timeout",r.timeout),r.timeout=r.timeout??this.timeout;const{bodyHeaders:c,body:d}=this.buildBody({options:r}),h=this.buildHeaders({options:e,method:i,bodyHeaders:c,retryCount:t});return{req:{method:i,headers:h,...r.signal&&{signal:r.signal},...globalThis.ReadableStream&&d instanceof globalThis.ReadableStream&&{duplex:"half"},...d&&{body:d},...this.fetchOptions??{},...r.fetchOptions??{}},url:u,timeout:r.timeout}}buildHeaders({options:e,method:t,bodyHeaders:r,retryCount:i}){let a={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const s=yt([a,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...xle(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},this.authHeaders(e),this._options.defaultHeaders,r,e.headers]);return this.validateHeaders(s),s.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const r=yt([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&r.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:t9(e)}:Ne(this,Gv,"f").call(this,{body:e,headers:r})}};xP=Zt,Gv=new WeakMap,nR=new WeakSet,hV=function(){return this.baseURL!=="https://api.openai.com/v1"};Zt.OpenAI=xP;Zt.DEFAULT_TIMEOUT=6e5;Zt.OpenAIError=Tt;Zt.APIError=Ki;Zt.APIConnectionError=ew;Zt.APIConnectionTimeoutError=tw;Zt.APIUserAbortError=_a;Zt.NotFoundError=Wq;Zt.ConflictError=Kq;Zt.RateLimitError=Yq;Zt.BadRequestError=zq;Zt.AuthenticationError=Hq;Zt.InternalServerError=Zq;Zt.PermissionDeniedError=Gq;Zt.UnprocessableEntityError=Jq;Zt.InvalidWebhookSignatureError=Sp;Zt.toFile=Zle;Zt.Completions=W9;Zt.Chat=pP;Zt.Embeddings=J9;Zt.Files=Z9;Zt.Images=rV;Zt.Audio=eg;Zt.Moderations=aV;Zt.Models=iV;Zt.FineTuning=zd;Zt.Graders=SP;Zt.VectorStores=sw;Zt.Webhooks=dV;Zt.Beta=tg;Zt.Batches=B9;Zt.Uploads=CP;Zt.Responses=AP;Zt.Evals=_P;Zt.Containers=yP;class Ps extends Gt{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){const r=Qt(t);return this.func&&await this.func(e,r),this._callWithConfig(i=>Promise.resolve(i),e,r)}async*transform(e,t){const r=Qt(t);let i,a=!0;for await(const s of this._transformStreamWithConfig(e,o=>o,r))if(yield s,a)if(i===void 0)i=s;else try{i=_i(i,s)}catch{i=void 0,a=!1}this.func&&i!==void 0&&await this.func(i,r)}static assign(e){return new OI(new lu({steps:e}))}}function Tue(){const n=new TextEncoder;return new TransformStream({transform(e,t){t.enqueue(n.encode(typeof e.content=="string"?e.content:JSON.stringify(e.content)))}})}function KA(n){const e=[];for(const t of n){let r=t;if(Array.isArray(t.content))for(let i=0;i<t.content.length;i++){const a=t.content[i];(I6(a)||P6(a))&&r===t&&(r=new t.constructor({...r,content:[...t.content.slice(0,i),O6(a),...t.content.slice(i+1)]}))}e.push(r)}return e}class yi extends LI{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){const[t,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=t.signal,[t,r]}async invoke(e,t){const r=yi._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t==null?void 0:t.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}async*_streamIterator(e,t){var r;if(this._streamResponseChunks===yi.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,t);else{const a=yi._convertInputToPromptValue(e).toChatMessages(),[s,o]=this._separateRunnableConfigFromCallOptionsCompat(t),u={...s.metadata,...this.getLsParams(o)},c=await tr.configure(s.callbacks,this.callbacks,s.tags,this.tags,u,this.metadata,{verbose:this.verbose}),d={options:o,invocation_params:this==null?void 0:this.invocationParams(o),batch_size:1},h=await(c==null?void 0:c.handleChatModelStart(this.toJSON(),[KA(a)],s.runId,void 0,d,void 0,void 0,s.runName));let m,g;try{for await(const _ of this._streamResponseChunks(a,o,h==null?void 0:h[0])){if(_.message.id==null){const w=(r=h==null?void 0:h.at(0))==null?void 0:r.runId;w!=null&&_.message._updateId(`run-${w}`)}_.message.response_metadata={..._.generationInfo,..._.message.response_metadata},yield _.message,m?m=m.concat(_):m=_,p_(_.message)&&_.message.usage_metadata!==void 0&&(g={tokenUsage:{promptTokens:_.message.usage_metadata.input_tokens,completionTokens:_.message.usage_metadata.output_tokens,totalTokens:_.message.usage_metadata.total_tokens}})}}catch(_){throw await Promise.all((h??[]).map(w=>w==null?void 0:w.handleLLMError(_))),_}await Promise.all((h??[]).map(_=>_==null?void 0:_.handleLLMEnd({generations:[[m]],llmOutput:g})))}}getLsParams(e){const t=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:t}}async _generateUncached(e,t,r,i){var h,m;const a=e.map(g=>g.map(_s));let s;if(i!==void 0&&i.length===a.length)s=i;else{const g={...r.metadata,...this.getLsParams(t)},_=await tr.configure(r.callbacks,this.callbacks,r.tags,this.tags,g,this.metadata,{verbose:this.verbose}),w={options:t,invocation_params:this==null?void 0:this.invocationParams(t),batch_size:1};s=await(_==null?void 0:_.handleChatModelStart(this.toJSON(),a.map(KA),r.runId,void 0,w,void 0,void 0,r.runName))}const o=[],u=[];if(!!(s!=null&&s[0].handlers.find(EI))&&!this.disableStreaming&&a.length===1&&this._streamResponseChunks!==yi.prototype._streamResponseChunks)try{const g=await this._streamResponseChunks(a[0],t,s==null?void 0:s[0]);let _,w;for await(const S of g){if(S.message.id==null){const E=(h=s==null?void 0:s.at(0))==null?void 0:h.runId;E!=null&&S.message._updateId(`run-${E}`)}_===void 0?_=S:_=_i(_,S),p_(S.message)&&S.message.usage_metadata!==void 0&&(w={tokenUsage:{promptTokens:S.message.usage_metadata.input_tokens,completionTokens:S.message.usage_metadata.output_tokens,totalTokens:S.message.usage_metadata.total_tokens}})}if(_===void 0)throw new Error("Received empty response from chat model call.");o.push([_]),await(s==null?void 0:s[0].handleLLMEnd({generations:o,llmOutput:w}))}catch(g){throw await(s==null?void 0:s[0].handleLLMError(g)),g}else{const g=await Promise.allSettled(a.map((_,w)=>this._generate(_,{...t,promptIndex:w},s==null?void 0:s[w])));await Promise.all(g.map(async(_,w)=>{var S,E,C;if(_.status==="fulfilled"){const A=_.value;for(const R of A.generations){if(R.message.id==null){const P=(S=s==null?void 0:s.at(0))==null?void 0:S.runId;P!=null&&R.message._updateId(`run-${P}`)}R.message.response_metadata={...R.generationInfo,...R.message.response_metadata}}return A.generations.length===1&&(A.generations[0].message.response_metadata={...A.llmOutput,...A.generations[0].message.response_metadata}),o[w]=A.generations,u[w]=A.llmOutput,(E=s==null?void 0:s[w])==null?void 0:E.handleLLMEnd({generations:[A.generations],llmOutput:A.llmOutput})}else return await((C=s==null?void 0:s[w])==null?void 0:C.handleLLMError(_.reason)),Promise.reject(_.reason)}))}const d={generations:o,llmOutput:u.length?(m=this._combineLLMOutput)==null?void 0:m.call(this,...u):void 0};return Object.defineProperty(d,mm,{value:s?{runIds:s==null?void 0:s.map(g=>g.runId)}:void 0,configurable:!0}),d}async _generateCached({messages:e,cache:t,llmStringKey:r,parsedOptions:i,handledOptions:a}){const s=e.map(S=>S.map(_s)),o={...a.metadata,...this.getLsParams(i)},u=await tr.configure(a.callbacks,this.callbacks,a.tags,this.tags,o,this.metadata,{verbose:this.verbose}),c={options:i,invocation_params:this==null?void 0:this.invocationParams(i),batch_size:1},d=await(u==null?void 0:u.handleChatModelStart(this.toJSON(),s.map(KA),a.runId,void 0,c,void 0,void 0,a.runName)),h=[],g=(await Promise.allSettled(s.map(async(S,E)=>{const C=yi._convertInputToPromptValue(S).toString(),A=await t.lookup(C,r);return A==null&&h.push(E),A}))).map((S,E)=>({result:S,runManager:d==null?void 0:d[E]})).filter(({result:S})=>S.status==="fulfilled"&&S.value!=null||S.status==="rejected"),_=[];await Promise.all(g.map(async({result:S,runManager:E},C)=>{if(S.status==="fulfilled"){const A=S.value;return _[C]=A.map(R=>("message"in R&&Vn(R.message)&&Ea(R.message)&&(R.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0}),R.generationInfo={...R.generationInfo,tokenUsage:{}},R)),A.length&&await(E==null?void 0:E.handleLLMNewToken(A[0].text)),E==null?void 0:E.handleLLMEnd({generations:[A]},void 0,void 0,void 0,{cached:!0})}else return await(E==null?void 0:E.handleLLMError(S.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(S.reason)}));const w={generations:_,missingPromptIndices:h,startedRunManagers:d};return Object.defineProperty(w,mm,{value:d?{runIds:d==null?void 0:d.map(S=>S.runId)}:void 0,configurable:!0}),w}async generate(e,t,r){let i;Array.isArray(t)?i={stop:t}:i=t;const a=e.map(_=>_.map(_s)),[s,o]=this._separateRunnableConfigFromCallOptionsCompat(i);if(s.callbacks=s.callbacks??r,!this.cache)return this._generateUncached(a,o,s);const{cache:u}=this,c=this._getSerializedCacheKeyParametersForCall(o),{generations:d,missingPromptIndices:h,startedRunManagers:m}=await this._generateCached({messages:a,cache:u,llmStringKey:c,parsedOptions:o,handledOptions:s});let g={};if(h.length>0){const _=await this._generateUncached(h.map(w=>a[w]),o,s,m!==void 0?h.map(w=>m==null?void 0:m[w]):void 0);await Promise.all(_.generations.map(async(w,S)=>{const E=h[S];d[E]=w;const C=yi._convertInputToPromptValue(a[E]).toString();return u.update(C,c,w)})),g=_.llmOutput??{}}return{generations:d,llmOutput:g}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,r){const i=e.map(a=>a.toChatMessages());return this.generate(i,t,r)}async call(e,t,r){return(await this.generate([e.map(_s)],t,r)).generations[0][0].message}async callPrompt(e,t,r){const i=e.toChatMessages();return this.call(i,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){const i=new oi(e),a=await this.call([i],t,r);if(typeof a.content!="string")throw new Error("Cannot use predict when output is not a string.");return a.content}withStructuredOutput(e,t){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(t!=null&&t.strict)throw new Error('"strict" mode is not supported for this model by default.');const r=e,i=t==null?void 0:t.name,a=Ad(r)??"A function available to call.",s=t==null?void 0:t.method,o=t==null?void 0:t.includeRaw;if(s==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let u=i??"extract",c;Ui(r)?c=[{type:"function",function:{name:u,description:a,parameters:Tr(r)}}]:("name"in r&&(u=r.name),c=[{type:"function",function:{name:u,description:a,parameters:r}}]);const d=this.bindTools(c),h=Cr.from(w=>{if(!w.tool_calls||w.tool_calls.length===0)throw new Error("No tool calls found in the response.");const S=w.tool_calls.find(E=>E.name===u);if(!S)throw new Error(`No tool call found with name ${u}.`);return S.args});if(!o)return d.pipe(h).withConfig({runName:"StructuredOutput"});const m=Ps.assign({parsed:(w,S)=>h.invoke(w.raw,S)}),g=Ps.assign({parsed:()=>null}),_=m.withFallbacks({fallbacks:[g]});return Ar.from([{raw:d},_]).withConfig({runName:"StructuredOutputRunnable"})}}class Aue extends yi{async _generate(e,t,r){const i=await this._call(e,t,r),a=new Tn(i);if(typeof a.content!="string")throw new Error("Cannot generate with a simple chat model when output is not a string.");return{generations:[{text:a.content,message:a}]}}}const Cue=Object.freeze(Object.defineProperty({__proto__:null,BaseChatModel:yi,SimpleChatModel:Aue,createChatMessageChunkEncoderStream:Tue},Symbol.toStringTag,{value:"Module"}));class xue extends Gt{static lc_name(){return"RouterRunnable"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnables=e.runnables}async invoke(e,t){const{key:r,input:i}=e,a=this.runnables[r];if(a===void 0)throw new Error(`No runnable associated with key "${r}".`);return a.invoke(i,Qt(t))}async batch(e,t,r){var m;const i=e.map(g=>g.key),a=e.map(g=>g.input);if(i.find(g=>this.runnables[g]===void 0)!==void 0)throw new Error("One or more keys do not have a corresponding runnable.");const o=i.map(g=>this.runnables[g]),u=this._getOptionsList(t??{},e.length),c=((m=u[0])==null?void 0:m.maxConcurrency)??(r==null?void 0:r.maxConcurrency),d=c&&c>0?c:e.length,h=[];for(let g=0;g<a.length;g+=d){const _=a.slice(g,g+d).map((S,E)=>o[E].invoke(S,u[E])),w=await Promise.all(_);h.push(w)}return h.flat()}async stream(e,t){const{key:r,input:i}=e,a=this.runnables[r];if(a===void 0)throw new Error(`No runnable associated with key "${r}".`);return a.stream(i,t)}}class Rue extends Gt{static lc_name(){return"RunnableBranch"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"default",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"branches",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.branches=e.branches,this.default=e.default}static from(e){if(e.length<1)throw new Error("RunnableBranch requires at least one branch");const r=e.slice(0,-1).map(([a,s])=>[Yr(a),Yr(s)]),i=Yr(e[e.length-1]);return new this({branches:r,default:i})}async _invoke(e,t,r){let i;for(let a=0;a<this.branches.length;a+=1){const[s,o]=this.branches[a];if(await s.invoke(e,fn(t,{callbacks:r==null?void 0:r.getChild(`condition:${a+1}`)}))){i=await o.invoke(e,fn(t,{callbacks:r==null?void 0:r.getChild(`branch:${a+1}`)}));break}}return i||(i=await this.default.invoke(e,fn(t,{callbacks:r==null?void 0:r.getChild("branch:default")}))),i}async invoke(e,t={}){return this._callWithConfig(this._invoke,e,t)}async*_streamIterator(e,t){const r=await Gi(t),i=await(r==null?void 0:r.handleChainStart(this.toJSON(),Sr(e,"input"),t==null?void 0:t.runId,void 0,void 0,void 0,t==null?void 0:t.runName));let a,s=!0,o;try{for(let u=0;u<this.branches.length;u+=1){const[c,d]=this.branches[u];if(await c.invoke(e,fn(t,{callbacks:i==null?void 0:i.getChild(`condition:${u+1}`)}))){o=await d.stream(e,fn(t,{callbacks:i==null?void 0:i.getChild(`branch:${u+1}`)}));for await(const m of o)if(yield m,s)if(a===void 0)a=m;else try{a=_i(a,m)}catch{a=void 0,s=!1}break}}if(o===void 0){o=await this.default.stream(e,fn(t,{callbacks:i==null?void 0:i.getChild("branch:default")}));for await(const u of o)if(yield u,s)if(a===void 0)a=u;else try{a=_i(a,u)}catch{a=void 0,s=!1}}}catch(u){throw await(i==null?void 0:i.handleChainError(u)),u}await(i==null?void 0:i.handleChainEnd(a??{}))}}class Iue extends bi{constructor(e){let t=Cr.from((s,o)=>this._enterHistory(s,o??{})).withConfig({runName:"loadHistory"});const r=e.historyMessagesKey??e.inputMessagesKey;r&&(t=Ps.assign({[r]:t}).withConfig({runName:"insertHistory"}));const i=t.pipe(e.runnable.withListeners({onEnd:(s,o)=>this._exitHistory(s,o??{})})).withConfig({runName:"RunnableWithMessageHistory"}),a=e.config??{};super({...e,config:a,bound:i}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"historyMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getMessageHistory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.getMessageHistory=e.getMessageHistory,this.inputMessagesKey=e.inputMessagesKey,this.outputMessagesKey=e.outputMessagesKey,this.historyMessagesKey=e.historyMessagesKey}_getInputMessages(e){let t;if(typeof e=="object"&&!Array.isArray(e)&&!Vn(e)){let r;this.inputMessagesKey?r=this.inputMessagesKey:Object.keys(e).length===1?r=Object.keys(e)[0]:r="input",Array.isArray(e[r])&&Array.isArray(e[r][0])?t=e[r][0]:t=e[r]}else t=e;if(typeof t=="string")return[new oi(t)];if(Array.isArray(t))return t;if(Vn(t))return[t];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages.
Got ${JSON.stringify(t,null,2)}`)}_getOutputMessages(e){let t;if(!Array.isArray(e)&&!Vn(e)&&typeof e!="string"){let r;this.outputMessagesKey!==void 0?r=this.outputMessagesKey:Object.keys(e).length===1?r=Object.keys(e)[0]:r="output",e.generations!==void 0?t=e.generations[0][0].message:t=e[r]}else t=e;if(typeof t=="string")return[new Tn(t)];if(Array.isArray(t))return t;if(Vn(t))return[t];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages. Received: ${JSON.stringify(t,null,2)}`)}async _enterHistory(e,t){var a;const i=await((a=t==null?void 0:t.configurable)==null?void 0:a.messageHistory).getMessages();return this.historyMessagesKey===void 0?i.concat(this._getInputMessages(e)):i}async _exitHistory(e,t){var u;const r=(u=t.configurable)==null?void 0:u.messageHistory;let i;Array.isArray(e.inputs)&&Array.isArray(e.inputs[0])?i=e.inputs[0]:i=e.inputs;let a=this._getInputMessages(i);if(this.historyMessagesKey===void 0){const c=await r.getMessages();a=a.slice(c.length)}const s=e.outputs;if(!s)throw new Error(`Output values from 'Run' undefined. Run: ${JSON.stringify(e,null,2)}`);const o=this._getOutputMessages(s);await r.addMessages([...a,...o])}async _mergeConfig(...e){const t=await super._mergeConfig(...e);if(!t.configurable||!t.configurable.sessionId){const i={[this.inputMessagesKey??"input"]:"foo"},a={configurable:{sessionId:"123"}};throw new Error(`sessionId is required. Pass it in as part of the config argument to .invoke() or .stream()
eg. chain.invoke(${JSON.stringify(i)}, ${JSON.stringify(a)})`)}const{sessionId:r}=t.configurable;return t.configurable.messageHistory=await this.getMessageHistory(r),t}}const Pue=Object.freeze(Object.defineProperty({__proto__:null,RouterRunnable:xue,Runnable:Gt,RunnableAssign:OI,RunnableBinding:bi,RunnableBranch:Rue,RunnableEach:gm,RunnableLambda:Cr,RunnableMap:lu,RunnableParallel:ore,RunnablePassthrough:Ps,RunnablePick:D5,RunnableRetry:II,RunnableSequence:Ar,RunnableToolLike:Rx,RunnableWithFallbacks:M5,RunnableWithMessageHistory:Iue,_coerceToRunnable:Yr,ensureConfig:Qt,getCallbackManagerForConfig:Gi,mergeConfigs:bs,patchConfig:fn,pickRunnableConfigKeys:el},Symbol.toStringTag,{value:"Module"}));class ow extends Gt{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(r,i)=>this.parseResult([{text:r}],i==null?void 0:i.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(r,i)=>this.parseResult([{message:r,text:this._baseMessageToString(r)}],i==null?void 0:i.callbacks),e,{...t,runType:"parser"})}}class ng extends ow{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}}class Ga extends Error{constructor(e,t,r,i=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=r,this.sendToLLM=i,i&&(r===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");Cb(this,"OUTPUT_PARSING_FAILURE")}}class rg extends ng{async*_transform(e){for await(const t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class lw extends rg{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=(e==null?void 0:e.diff)??this.diff}async*_transform(e){let t,r;for await(const i of e){if(typeof i!="string"&&typeof i.content!="string")throw new Error("Cannot handle non-string output.");let a;if(wd(i)){if(typeof i.content!="string")throw new Error("Cannot handle non-string message output.");a=new Sa({message:i,text:i.content})}else if(Vn(i)){if(typeof i.content!="string")throw new Error("Cannot handle non-string message output.");a=new Sa({message:g_(i),text:i.content})}else a=new tu({text:i});r===void 0?r=a:r=r.concat(a);const s=await this.parsePartialResult([r]);s!=null&&!Ju(s,t)&&(this.diff?yield this._diff(t,s):yield s,t=s)}}getFormatInstructions(){return""}}class Oue extends rg{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","bytes"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"textEncoder",{enumerable:!0,configurable:!0,writable:!0,value:new TextEncoder})}static lc_name(){return"BytesOutputParser"}parse(e){return Promise.resolve(this.textEncoder.encode(e))}getFormatInstructions(){return""}}class ig extends rg{constructor(){super(...arguments),Object.defineProperty(this,"re",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}async*_transform(e){let t="";for await(const r of e)if(typeof r=="string"?t+=r:t+=r.content,this.re){const i=[...t.matchAll(this.re)];if(i.length>1){let a=0;for(const s of i.slice(0,-1))yield[s[1]],a+=(s.index??0)+s[0].length;t=t.slice(a)}}else{const i=await this.parse(t);if(i.length>1){for(const a of i.slice(0,-1))yield[a];t=i[i.length-1]}}for(const r of await this.parse(t))yield[r]}}class kue extends ig{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","list"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"CommaSeparatedListOutputParser"}async parse(e){try{return e.trim().split(",").map(t=>t.trim())}catch{throw new Ga(`Could not parse output: ${e}`,e)}}getFormatInstructions(){return"Your response should be a list of comma separated values, eg: `foo, bar, baz`"}}class Nue extends ig{constructor({length:e,separator:t}){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","list"]}),Object.defineProperty(this,"length",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"separator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.length=e,this.separator=t||","}async parse(e){try{const t=e.trim().split(this.separator).map(r=>r.trim());if(this.length!==void 0&&t.length!==this.length)throw new Ga(`Incorrect number of items. Expected ${this.length}, got ${t.length}.`);return t}catch(t){throw Object.getPrototypeOf(t)===Ga.prototype?t:new Ga(`Could not parse output: ${e}`)}}getFormatInstructions(){return`Your response should be a list of ${this.length===void 0?"":`${this.length} `}items separated by "${this.separator}" (eg: \`foo${this.separator} bar${this.separator} baz\`)`}}class Mue extends ig{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","list"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"re",{enumerable:!0,configurable:!0,writable:!0,value:/\d+\.\s([^\n]+)/g})}static lc_name(){return"NumberedListOutputParser"}getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}async parse(e){return[...e.matchAll(this.re)??[]].map(t=>t[1])}}class Due extends ig{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","list"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"re",{enumerable:!0,configurable:!0,writable:!0,value:/^\s*[-*]\s([^\n]+)$/gm})}static lc_name(){return"NumberedListOutputParser"}getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}async parse(e){return[...e.matchAll(this.re)??[]].map(t=>t[1])}}class $ue extends rg{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","string"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"StrOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}_textContentToString(e){return e.text}_imageUrlContentToString(e){throw new Error('Cannot coerce a multimodal "image_url" message part into a string.')}_messageContentComplexToString(e){switch(e.type){case"text":case"text_delta":if("text"in e)return this._textContentToString(e);break;case"image_url":if("image_url"in e)return this._imageUrlContentToString(e);break;default:throw new Error(`Cannot coerce "${e.type}" message part into a string.`)}throw new Error(`Invalid content type: ${e.type}`)}_baseMessageContentToString(e){return e.reduce((t,r)=>t+this._messageContentComplexToString(r),"")}}class H_ extends ng{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const t=rt(Object.fromEntries(Object.entries(e).map(([r,i])=>[r,$e().describe(i)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(Tr(this.schema))}
\`\`\`
`}async parse(e){try{const r=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(i,a)=>`"${a.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await Lb(this.schema,JSON.parse(r))}catch(t){throw new Ga(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}}class pV extends H_{static lc_name(){return"JsonMarkdownStructuredOutputParser"}getFormatInstructions(e){const t=(e==null?void 0:e.interpolationDepth)??1;if(t<1)throw new Error("f string interpolation depth must be at least 1");return`Return a markdown code snippet with a JSON object formatted to look like:
\`\`\`json
${this._schemaToInstruction(Tr(this.schema)).replaceAll("{","{".repeat(t)).replaceAll("}","}".repeat(t))}
\`\`\``}_schemaToInstruction(e,t=2){const r=e;if("type"in r){let i=!1,a;if(Array.isArray(r.type)){const u=r.type.findIndex(c=>c==="null");u!==-1&&(i=!0,r.type.splice(u,1)),a=r.type.join(" | ")}else a=r.type;if(r.type==="object"&&r.properties){const u=r.description?` // ${r.description}`:"";return`{
${Object.entries(r.properties).map(([d,h])=>{var g;const m=(g=r.required)!=null&&g.includes(d)?"":" (optional)";return`${" ".repeat(t)}"${d}": ${this._schemaToInstruction(h,t+2)}${m}`}).join(`
`)}
${" ".repeat(t-2)}}${u}`}if(r.type==="array"&&r.items){const u=r.description?` // ${r.description}`:"";return`array[
${" ".repeat(t)}${this._schemaToInstruction(r.items,t+2)}
${" ".repeat(t-2)}] ${u}`}const s=i?" (nullable)":"",o=r.description?` // ${r.description}`:"";return`${a}${o}${s}`}if("anyOf"in r)return r.anyOf.map(i=>this._schemaToInstruction(i,t)).join(`
${" ".repeat(t-2)}`);throw new Error("unsupported schema type")}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const t=rt(Object.fromEntries(Object.entries(e).map(([r,i])=>[r,$e().describe(i)])));return new this(t)}}class Lue extends ng{constructor({inputSchema:e}){super(...arguments),Object.defineProperty(this,"structuredInputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.structuredInputParser=new pV(e)}async parse(e){let t;try{t=await this.structuredInputParser.parse(e)}catch(r){throw new Ga(`Failed to parse. Text: "${e}". Error: ${r}`,e)}return this.outputProcessor(t)}getFormatInstructions(){return this.structuredInputParser.getFormatInstructions()}}const Uue=Object.freeze(Object.defineProperty({__proto__:null,applyPatch:dm,compare:bI},Symbol.toStringTag,{value:"Module"}));class G_ extends lw{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){if(t)return e?bI(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return nx(e[0].text)}async parse(e){return nx(e,JSON.parse)}getFormatInstructions(){return""}}const jue=function(){const n={};n.parser=function(I,O){return new t(I,O)},n.SAXParser=t,n.SAXStream=c,n.createStream=u,n.MAX_BUFFER_LENGTH=64*1024;const e=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];n.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function t(I,O){if(!(this instanceof t))return new t(I,O);var J=this;i(J),J.q=J.c="",J.bufferCheckPosition=n.MAX_BUFFER_LENGTH,J.opt=O||{},J.opt.lowercase=J.opt.lowercase||J.opt.lowercasetags,J.looseCase=J.opt.lowercase?"toLowerCase":"toUpperCase",J.tags=[],J.closed=J.closedRoot=J.sawRoot=!1,J.tag=J.error=null,J.strict=!!I,J.noscript=!!(I||J.opt.noscript),J.state=k.BEGIN,J.strictEntities=J.opt.strictEntities,J.ENTITIES=J.strictEntities?Object.create(n.XML_ENTITIES):Object.create(n.ENTITIES),J.attribList=[],J.opt.xmlns&&(J.ns=Object.create(_)),J.trackPosition=J.opt.position!==!1,J.trackPosition&&(J.position=J.line=J.column=0),H(J,"onready")}Object.create||(Object.create=function(I){function O(){}O.prototype=I;var J=new O;return J}),Object.keys||(Object.keys=function(I){var O=[];for(var J in I)I.hasOwnProperty(J)&&O.push(J);return O});function r(I){for(var O=Math.max(n.MAX_BUFFER_LENGTH,10),J=0,X=0,ue=e.length;X<ue;X++){var V=I[e[X]].length;if(V>O)switch(e[X]){case"textNode":z(I);break;case"cdata":G(I,"oncdata",I.cdata),I.cdata="";break;case"script":G(I,"onscript",I.script),I.script="";break;default:te(I,"Max buffer length exceeded: "+e[X])}J=Math.max(J,V)}var K=n.MAX_BUFFER_LENGTH-J;I.bufferCheckPosition=K+I.position}function i(I){for(var O=0,J=e.length;O<J;O++)I[e[O]]=""}function a(I){z(I),I.cdata!==""&&(G(I,"oncdata",I.cdata),I.cdata=""),I.script!==""&&(G(I,"onscript",I.script),I.script="")}t.prototype={end:function(){se(this)},write:fe,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){a(this)}};var s=ReadableStream;s||(s=function(){});var o=n.EVENTS.filter(function(I){return I!=="error"&&I!=="end"});function u(I,O){return new c(I,O)}function c(I,O){if(!(this instanceof c))return new c(I,O);s.apply(this),this._parser=new t(I,O),this.writable=!0,this.readable=!0;var J=this;this._parser.onend=function(){J.emit("end")},this._parser.onerror=function(X){J.emit("error",X),J._parser.error=null},this._decoder=null,o.forEach(function(X){Object.defineProperty(J,"on"+X,{get:function(){return J._parser["on"+X]},set:function(ue){if(!ue)return J.removeAllListeners(X),J._parser["on"+X]=ue,ue;J.on(X,ue)},enumerable:!0,configurable:!1})})}c.prototype=Object.create(s.prototype,{constructor:{value:c}}),c.prototype.write=function(I){return this._parser.write(I.toString()),this.emit("data",I),!0},c.prototype.end=function(I){return I&&I.length&&this.write(I),this._parser.end(),!0},c.prototype.on=function(I,O){var J=this;return!J._parser["on"+I]&&o.indexOf(I)!==-1&&(J._parser["on"+I]=function(){var X=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);X.splice(0,0,I),J.emit.apply(J,X)}),s.prototype.on.call(J,I,O)};var d="[CDATA[",h="DOCTYPE",m="http://www.w3.org/XML/1998/namespace",g="http://www.w3.org/2000/xmlns/",_={xml:m,xmlns:g},w=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,S=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,E=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,C=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function A(I){return I===" "||I===`
`||I==="\r"||I==="	"}function R(I){return I==='"'||I==="'"}function P(I){return I===">"||A(I)}function N(I,O){return I.test(O)}function U(I,O){return!N(I,O)}var k=0;n.STATE={BEGIN:k++,BEGIN_WHITESPACE:k++,TEXT:k++,TEXT_ENTITY:k++,OPEN_WAKA:k++,SGML_DECL:k++,SGML_DECL_QUOTED:k++,DOCTYPE:k++,DOCTYPE_QUOTED:k++,DOCTYPE_DTD:k++,DOCTYPE_DTD_QUOTED:k++,COMMENT_STARTING:k++,COMMENT:k++,COMMENT_ENDING:k++,COMMENT_ENDED:k++,CDATA:k++,CDATA_ENDING:k++,CDATA_ENDING_2:k++,PROC_INST:k++,PROC_INST_BODY:k++,PROC_INST_ENDING:k++,OPEN_TAG:k++,OPEN_TAG_SLASH:k++,ATTRIB:k++,ATTRIB_NAME:k++,ATTRIB_NAME_SAW_WHITE:k++,ATTRIB_VALUE:k++,ATTRIB_VALUE_QUOTED:k++,ATTRIB_VALUE_CLOSED:k++,ATTRIB_VALUE_UNQUOTED:k++,ATTRIB_VALUE_ENTITY_Q:k++,ATTRIB_VALUE_ENTITY_U:k++,CLOSE_TAG:k++,CLOSE_TAG_SAW_WHITE:k++,SCRIPT:k++,SCRIPT_ENDING:k++},n.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},n.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(n.ENTITIES).forEach(function(I){var O=n.ENTITIES[I],J=typeof O=="number"?String.fromCharCode(O):O;n.ENTITIES[I]=J});for(var B in n.STATE)n.STATE[n.STATE[B]]=B;k=n.STATE;function H(I,O,J){I[O]&&I[O](J)}function G(I,O,J){I.textNode&&z(I),H(I,O,J)}function z(I){I.textNode=oe(I.opt,I.textNode),I.textNode&&H(I,"ontext",I.textNode),I.textNode=""}function oe(I,O){return I.trim&&(O=O.trim()),I.normalize&&(O=O.replace(/\s+/g," ")),O}function te(I,O){return z(I),I.trackPosition&&(O+=`
Line: `+I.line+`
Column: `+I.column+`
Char: `+I.c),O=new Error(O),I.error=O,H(I,"onerror",O),I}function se(I){return I.sawRoot&&!I.closedRoot&&ee(I,"Unclosed root tag"),I.state!==k.BEGIN&&I.state!==k.BEGIN_WHITESPACE&&I.state!==k.TEXT&&te(I,"Unexpected end"),z(I),I.c="",I.closed=!0,H(I,"onend"),t.call(I,I.strict,I.opt),I}function ee(I,O){if(typeof I!="object"||!(I instanceof t))throw new Error("bad call to strictFail");I.strict&&te(I,O)}function le(I){I.strict||(I.tagName=I.tagName[I.looseCase]());var O=I.tags[I.tags.length-1]||I,J=I.tag={name:I.tagName,attributes:{}};I.opt.xmlns&&(J.ns=O.ns),I.attribList.length=0,G(I,"onopentagstart",J)}function pe(I,O){var J=I.indexOf(":"),X=J<0?["",I]:I.split(":"),ue=X[0],V=X[1];return O&&I==="xmlns"&&(ue="xmlns",V=""),{prefix:ue,local:V}}function we(I){if(I.strict||(I.attribName=I.attribName[I.looseCase]()),I.attribList.indexOf(I.attribName)!==-1||I.tag.attributes.hasOwnProperty(I.attribName)){I.attribName=I.attribValue="";return}if(I.opt.xmlns){var O=pe(I.attribName,!0),J=O.prefix,X=O.local;if(J==="xmlns")if(X==="xml"&&I.attribValue!==m)ee(I,"xml: prefix must be bound to "+m+`
Actual: `+I.attribValue);else if(X==="xmlns"&&I.attribValue!==g)ee(I,"xmlns: prefix must be bound to "+g+`
Actual: `+I.attribValue);else{var ue=I.tag,V=I.tags[I.tags.length-1]||I;ue.ns===V.ns&&(ue.ns=Object.create(V.ns)),ue.ns[X]=I.attribValue}I.attribList.push([I.attribName,I.attribValue])}else I.tag.attributes[I.attribName]=I.attribValue,G(I,"onattribute",{name:I.attribName,value:I.attribValue});I.attribName=I.attribValue=""}function $(I,O){if(I.opt.xmlns){var J=I.tag,X=pe(I.tagName);J.prefix=X.prefix,J.local=X.local,J.uri=J.ns[X.prefix]||"",J.prefix&&!J.uri&&(ee(I,"Unbound namespace prefix: "+JSON.stringify(I.tagName)),J.uri=X.prefix);var ue=I.tags[I.tags.length-1]||I;J.ns&&ue.ns!==J.ns&&Object.keys(J.ns).forEach(function(At){G(I,"onopennamespace",{prefix:At,uri:J.ns[At]})});for(var V=0,K=I.attribList.length;V<K;V++){var _e=I.attribList[V],Me=_e[0],tt=_e[1],je=pe(Me,!0),We=je.prefix,Ot=je.local,Pe=We===""?"":J.ns[We]||"",He={name:Me,value:tt,prefix:We,local:Ot,uri:Pe};We&&We!=="xmlns"&&!Pe&&(ee(I,"Unbound namespace prefix: "+JSON.stringify(We)),He.uri=We),I.tag.attributes[Me]=He,G(I,"onattribute",He)}I.attribList.length=0}I.tag.isSelfClosing=!!O,I.sawRoot=!0,I.tags.push(I.tag),G(I,"onopentag",I.tag),O||(!I.noscript&&I.tagName.toLowerCase()==="script"?I.state=k.SCRIPT:I.state=k.TEXT,I.tag=null,I.tagName=""),I.attribName=I.attribValue="",I.attribList.length=0}function ve(I){if(!I.tagName){ee(I,"Weird empty close tag."),I.textNode+="</>",I.state=k.TEXT;return}if(I.script){if(I.tagName!=="script"){I.script+="</"+I.tagName+">",I.tagName="",I.state=k.SCRIPT;return}G(I,"onscript",I.script),I.script=""}var O=I.tags.length,J=I.tagName;I.strict||(J=J[I.looseCase]());for(var X=J;O--;){var ue=I.tags[O];if(ue.name!==X)ee(I,"Unexpected close tag");else break}if(O<0){ee(I,"Unmatched closing tag: "+I.tagName),I.textNode+="</"+I.tagName+">",I.state=k.TEXT;return}I.tagName=J;for(var V=I.tags.length;V-- >O;){var K=I.tag=I.tags.pop();I.tagName=I.tag.name,G(I,"onclosetag",I.tagName);var _e={};for(var Me in K.ns)_e[Me]=K.ns[Me];var tt=I.tags[I.tags.length-1]||I;I.opt.xmlns&&K.ns!==tt.ns&&Object.keys(K.ns).forEach(function(je){var We=K.ns[je];G(I,"onclosenamespace",{prefix:je,uri:We})})}O===0&&(I.closedRoot=!0),I.tagName=I.attribValue=I.attribName="",I.attribList.length=0,I.state=k.TEXT}function Te(I){var O=I.entity,J=O.toLowerCase(),X,ue="";return I.ENTITIES[O]?I.ENTITIES[O]:I.ENTITIES[J]?I.ENTITIES[J]:(O=J,O.charAt(0)==="#"&&(O.charAt(1)==="x"?(O=O.slice(2),X=parseInt(O,16),ue=X.toString(16)):(O=O.slice(1),X=parseInt(O,10),ue=X.toString(10))),O=O.replace(/^0+/,""),isNaN(X)||ue.toLowerCase()!==O?(ee(I,"Invalid character entity"),"&"+I.entity+";"):String.fromCodePoint(X))}function F(I,O){O==="<"?(I.state=k.OPEN_WAKA,I.startTagPosition=I.position):A(O)||(ee(I,"Non-whitespace before first tag."),I.textNode=O,I.state=k.TEXT)}function ae(I,O){var J="";return O<I.length&&(J=I.charAt(O)),J}function fe(I){var O=this;if(this.error)throw this.error;if(O.closed)return te(O,"Cannot write after close. Assign an onready handler.");if(I===null)return se(O);typeof I=="object"&&(I=I.toString());for(var J=0,X="";X=ae(I,J++),O.c=X,!!X;)switch(O.trackPosition&&(O.position++,X===`
`?(O.line++,O.column=0):O.column++),O.state){case k.BEGIN:if(O.state=k.BEGIN_WHITESPACE,X==="\uFEFF")continue;F(O,X);continue;case k.BEGIN_WHITESPACE:F(O,X);continue;case k.TEXT:if(O.sawRoot&&!O.closedRoot){for(var ue=J-1;X&&X!=="<"&&X!=="&";)X=ae(I,J++),X&&O.trackPosition&&(O.position++,X===`
`?(O.line++,O.column=0):O.column++);O.textNode+=I.substring(ue,J-1)}X==="<"&&!(O.sawRoot&&O.closedRoot&&!O.strict)?(O.state=k.OPEN_WAKA,O.startTagPosition=O.position):(!A(X)&&(!O.sawRoot||O.closedRoot)&&ee(O,"Text data outside of root node."),X==="&"?O.state=k.TEXT_ENTITY:O.textNode+=X);continue;case k.SCRIPT:X==="<"?O.state=k.SCRIPT_ENDING:O.script+=X;continue;case k.SCRIPT_ENDING:X==="/"?O.state=k.CLOSE_TAG:(O.script+="<"+X,O.state=k.SCRIPT);continue;case k.OPEN_WAKA:if(X==="!")O.state=k.SGML_DECL,O.sgmlDecl="";else if(!A(X))if(N(w,X))O.state=k.OPEN_TAG,O.tagName=X;else if(X==="/")O.state=k.CLOSE_TAG,O.tagName="";else if(X==="?")O.state=k.PROC_INST,O.procInstName=O.procInstBody="";else{if(ee(O,"Unencoded <"),O.startTagPosition+1<O.position){var V=O.position-O.startTagPosition;X=new Array(V).join(" ")+X}O.textNode+="<"+X,O.state=k.TEXT}continue;case k.SGML_DECL:(O.sgmlDecl+X).toUpperCase()===d?(G(O,"onopencdata"),O.state=k.CDATA,O.sgmlDecl="",O.cdata=""):O.sgmlDecl+X==="--"?(O.state=k.COMMENT,O.comment="",O.sgmlDecl=""):(O.sgmlDecl+X).toUpperCase()===h?(O.state=k.DOCTYPE,(O.doctype||O.sawRoot)&&ee(O,"Inappropriately located doctype declaration"),O.doctype="",O.sgmlDecl=""):X===">"?(G(O,"onsgmldeclaration",O.sgmlDecl),O.sgmlDecl="",O.state=k.TEXT):(R(X)&&(O.state=k.SGML_DECL_QUOTED),O.sgmlDecl+=X);continue;case k.SGML_DECL_QUOTED:X===O.q&&(O.state=k.SGML_DECL,O.q=""),O.sgmlDecl+=X;continue;case k.DOCTYPE:X===">"?(O.state=k.TEXT,G(O,"ondoctype",O.doctype),O.doctype=!0):(O.doctype+=X,X==="["?O.state=k.DOCTYPE_DTD:R(X)&&(O.state=k.DOCTYPE_QUOTED,O.q=X));continue;case k.DOCTYPE_QUOTED:O.doctype+=X,X===O.q&&(O.q="",O.state=k.DOCTYPE);continue;case k.DOCTYPE_DTD:O.doctype+=X,X==="]"?O.state=k.DOCTYPE:R(X)&&(O.state=k.DOCTYPE_DTD_QUOTED,O.q=X);continue;case k.DOCTYPE_DTD_QUOTED:O.doctype+=X,X===O.q&&(O.state=k.DOCTYPE_DTD,O.q="");continue;case k.COMMENT:X==="-"?O.state=k.COMMENT_ENDING:O.comment+=X;continue;case k.COMMENT_ENDING:X==="-"?(O.state=k.COMMENT_ENDED,O.comment=oe(O.opt,O.comment),O.comment&&G(O,"oncomment",O.comment),O.comment=""):(O.comment+="-"+X,O.state=k.COMMENT);continue;case k.COMMENT_ENDED:X!==">"?(ee(O,"Malformed comment"),O.comment+="--"+X,O.state=k.COMMENT):O.state=k.TEXT;continue;case k.CDATA:X==="]"?O.state=k.CDATA_ENDING:O.cdata+=X;continue;case k.CDATA_ENDING:X==="]"?O.state=k.CDATA_ENDING_2:(O.cdata+="]"+X,O.state=k.CDATA);continue;case k.CDATA_ENDING_2:X===">"?(O.cdata&&G(O,"oncdata",O.cdata),G(O,"onclosecdata"),O.cdata="",O.state=k.TEXT):X==="]"?O.cdata+="]":(O.cdata+="]]"+X,O.state=k.CDATA);continue;case k.PROC_INST:X==="?"?O.state=k.PROC_INST_ENDING:A(X)?O.state=k.PROC_INST_BODY:O.procInstName+=X;continue;case k.PROC_INST_BODY:if(!O.procInstBody&&A(X))continue;X==="?"?O.state=k.PROC_INST_ENDING:O.procInstBody+=X;continue;case k.PROC_INST_ENDING:X===">"?(G(O,"onprocessinginstruction",{name:O.procInstName,body:O.procInstBody}),O.procInstName=O.procInstBody="",O.state=k.TEXT):(O.procInstBody+="?"+X,O.state=k.PROC_INST_BODY);continue;case k.OPEN_TAG:N(S,X)?O.tagName+=X:(le(O),X===">"?$(O):X==="/"?O.state=k.OPEN_TAG_SLASH:(A(X)||ee(O,"Invalid character in tag name"),O.state=k.ATTRIB));continue;case k.OPEN_TAG_SLASH:X===">"?($(O,!0),ve(O)):(ee(O,"Forward-slash in opening tag not followed by >"),O.state=k.ATTRIB);continue;case k.ATTRIB:if(A(X))continue;X===">"?$(O):X==="/"?O.state=k.OPEN_TAG_SLASH:N(w,X)?(O.attribName=X,O.attribValue="",O.state=k.ATTRIB_NAME):ee(O,"Invalid attribute name");continue;case k.ATTRIB_NAME:X==="="?O.state=k.ATTRIB_VALUE:X===">"?(ee(O,"Attribute without value"),O.attribValue=O.attribName,we(O),$(O)):A(X)?O.state=k.ATTRIB_NAME_SAW_WHITE:N(S,X)?O.attribName+=X:ee(O,"Invalid attribute name");continue;case k.ATTRIB_NAME_SAW_WHITE:if(X==="=")O.state=k.ATTRIB_VALUE;else{if(A(X))continue;ee(O,"Attribute without value"),O.tag.attributes[O.attribName]="",O.attribValue="",G(O,"onattribute",{name:O.attribName,value:""}),O.attribName="",X===">"?$(O):N(w,X)?(O.attribName=X,O.state=k.ATTRIB_NAME):(ee(O,"Invalid attribute name"),O.state=k.ATTRIB)}continue;case k.ATTRIB_VALUE:if(A(X))continue;R(X)?(O.q=X,O.state=k.ATTRIB_VALUE_QUOTED):(ee(O,"Unquoted attribute value"),O.state=k.ATTRIB_VALUE_UNQUOTED,O.attribValue=X);continue;case k.ATTRIB_VALUE_QUOTED:if(X!==O.q){X==="&"?O.state=k.ATTRIB_VALUE_ENTITY_Q:O.attribValue+=X;continue}we(O),O.q="",O.state=k.ATTRIB_VALUE_CLOSED;continue;case k.ATTRIB_VALUE_CLOSED:A(X)?O.state=k.ATTRIB:X===">"?$(O):X==="/"?O.state=k.OPEN_TAG_SLASH:N(w,X)?(ee(O,"No whitespace between attributes"),O.attribName=X,O.attribValue="",O.state=k.ATTRIB_NAME):ee(O,"Invalid attribute name");continue;case k.ATTRIB_VALUE_UNQUOTED:if(!P(X)){X==="&"?O.state=k.ATTRIB_VALUE_ENTITY_U:O.attribValue+=X;continue}we(O),X===">"?$(O):O.state=k.ATTRIB;continue;case k.CLOSE_TAG:if(O.tagName)X===">"?ve(O):N(S,X)?O.tagName+=X:O.script?(O.script+="</"+O.tagName,O.tagName="",O.state=k.SCRIPT):(A(X)||ee(O,"Invalid tagname in closing tag"),O.state=k.CLOSE_TAG_SAW_WHITE);else{if(A(X))continue;U(w,X)?O.script?(O.script+="</"+X,O.state=k.SCRIPT):ee(O,"Invalid tagname in closing tag."):O.tagName=X}continue;case k.CLOSE_TAG_SAW_WHITE:if(A(X))continue;X===">"?ve(O):ee(O,"Invalid characters in closing tag");continue;case k.TEXT_ENTITY:case k.ATTRIB_VALUE_ENTITY_Q:case k.ATTRIB_VALUE_ENTITY_U:var K,_e;switch(O.state){case k.TEXT_ENTITY:K=k.TEXT,_e="textNode";break;case k.ATTRIB_VALUE_ENTITY_Q:K=k.ATTRIB_VALUE_QUOTED,_e="attribValue";break;case k.ATTRIB_VALUE_ENTITY_U:K=k.ATTRIB_VALUE_UNQUOTED,_e="attribValue";break}if(X===";")if(O.opt.unparsedEntities){var Me=Te(O);O.entity="",O.state=K,O.write(Me)}else O[_e]+=Te(O),O.entity="",O.state=K;else N(O.entity.length?C:E,X)?O.entity+=X:(ee(O,"Invalid character in entity name"),O[_e]+="&"+O.entity+X,O.entity="",O.state=K);continue;default:throw new Error(O,"Unknown state: "+O.state)}return O.position>=O.bufferCheckPosition&&r(O),O}/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */return String.fromCodePoint||function(){var I=String.fromCharCode,O=Math.floor,J=function(){var X=16384,ue=[],V,K,_e=-1,Me=arguments.length;if(!Me)return"";for(var tt="";++_e<Me;){var je=Number(arguments[_e]);if(!isFinite(je)||je<0||je>1114111||O(je)!==je)throw RangeError("Invalid code point: "+je);je<=65535?ue.push(je):(je-=65536,V=(je>>10)+55296,K=je%1024+56320,ue.push(V,K)),(_e+1===Me||ue.length>X)&&(tt+=I.apply(null,ue),ue.length=0)}return tt};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:J,configurable:!0,writable:!0}):String.fromCodePoint=J}(),n},Fue=jue(),rR=`The output should be formatted as a XML file.
1. Output should conform to the tags below. 
2. If tags are not given, make them on your own.
3. Remember to always open and close all the tags.

As an example, for the tags ["foo", "bar", "baz"]:
1. String "<foo>
   <bar>
      <baz></baz>
   </bar>
</foo>" is a well-formatted instance of the schema. 
2. String "<foo>
   <bar>
   </foo>" is a badly-formatted instance.
3. String "<foo>
   <tag>
   </tag>
</foo>" is a badly-formatted instance.

Here are the output tags:
\`\`\`
{tags}
\`\`\``;class Bue extends lw{constructor(e){super(e),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.tags=e==null?void 0:e.tags}static lc_name(){return"XMLOutputParser"}_diff(e,t){if(t)return e?bI(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return iR(e[0].text)}async parse(e){return iR(e)}getFormatInstructions(){var t;return!!(this.tags&&this.tags.length>0)?rR.replace("{tags}",((t=this.tags)==null?void 0:t.join(", "))??""):rR}}const que=n=>n.split(`
`).map(e=>e.replace(/^\s+/,"")).join(`
`).trim(),mV=n=>{if(Object.keys(n).length===0)return{};const e={};return n.children.length>0?(e[n.name]=n.children.map(mV),e):(e[n.name]=n.text??void 0,e)};function iR(n){const e=que(n),t=Fue.parser(!0);let r={};const i=[];t.onopentag=o=>{const u={name:o.name,attributes:o.attributes,children:[],text:"",isSelfClosing:o.isSelfClosing};i.length>0?i[i.length-1].children.push(u):r=u,o.isSelfClosing||i.push(u)},t.onclosetag=()=>{if(i.length>0){const o=i.pop();i.length===0&&o&&(r=o)}},t.ontext=o=>{if(i.length>0){const u=i[i.length-1];u.text+=o}},t.onattribute=o=>{if(i.length>0){const u=i[i.length-1];u.attributes[o.name]=o.value}};const a=/```(xml)?(.*)```/s.exec(e),s=a?a[2]:e;return t.write(s).close(),r&&r.name==="?xml"&&(r=r.children[0]),mV(r)}const Vue=Object.freeze(Object.defineProperty({__proto__:null,AsymmetricStructuredOutputParser:Lue,BaseCumulativeTransformOutputParser:lw,BaseLLMOutputParser:ow,BaseOutputParser:ng,BaseTransformOutputParser:rg,BytesOutputParser:Oue,CommaSeparatedListOutputParser:kue,CustomListOutputParser:Nue,JsonMarkdownStructuredOutputParser:pV,JsonOutputParser:G_,ListOutputParser:ig,MarkdownListOutputParser:Due,NumberedListOutputParser:Mue,OutputParserException:Ga,StringOutputParser:$ue,StructuredOutputParser:H_,XMLOutputParser:Bue,XML_FORMAT_INSTRUCTIONS:rR,parseJsonMarkdown:nx,parsePartialJson:Sb,parseXMLMarkdown:iR},Symbol.toStringTag,{value:"Module"}));function RP(n,e){if(n.function===void 0)return;let t;if(e!=null&&e.partial)try{t=Sb(n.function.arguments??"{}")}catch{return}else try{t=JSON.parse(n.function.arguments)}catch(i){throw new Ga([`Function "${n.function.name}" arguments:`,"",n.function.arguments,"","are not valid JSON.",`Error: ${i.message}`].join(`
`))}const r={name:n.function.name,args:t,type:"tool_call"};return e!=null&&e.returnId&&(r.id=n.id),r}function zue(n){if(n.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:n.id,type:"function",function:{name:n.name,arguments:JSON.stringify(n.args)}}}function gV(n,e){var t,r;return{name:(t=n.function)==null?void 0:t.name,args:(r=n.function)==null?void 0:r.arguments,id:n.id,error:e,type:"invalid_tool_call"}}class Hue extends lw{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(e==null?void 0:e.returnId)??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){var s;const r=e[0].message;let i;if(Ea(r)&&((s=r.tool_calls)!=null&&s.length)?i=r.tool_calls.map(o=>{const{id:u,...c}=o;return this.returnId?{id:u,...c}:c}):r.additional_kwargs.tool_calls!==void 0&&(i=JSON.parse(JSON.stringify(r.additional_kwargs.tool_calls)).map(u=>RP(u,{returnId:this.returnId,partial:t}))),!i)return[];const a=[];for(const o of i)if(o!==void 0){const u={type:o.name,args:o.args,id:o.id};a.push(u)}return a}}class d2 extends Hue{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){var r;if(this.zodSchema===void 0)return e;const t=await $b(this.zodSchema,e);if(t.success)return t.data;throw new Ga(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify((r=t.error)==null?void 0:r.issues)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){const r=(await super.parsePartialResult(e)).filter(a=>a.type===this.keyName);let i=r;if(r.length)return this.returnId||(i=r.map(a=>a.args)),this.returnSingle?i[0]:i}async parseResult(e){const r=(await super.parsePartialResult(e,!1)).filter(s=>s.type===this.keyName);let i=r;return r.length?(this.returnId||(i=r.map(s=>s.args)),this.returnSingle?this._validateResult(i[0]):await Promise.all(i.map(s=>this._validateResult(s)))):void 0}}const Gue=Symbol("Let zodToJsonSchema decide on which parser to use"),h2={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Wue=n=>typeof n=="string"?{...h2,basePath:["#"],definitions:{},name:n}:{...h2,basePath:["#"],definitions:{},...n},aR=n=>"_def"in n?n._def:n;function Kue(n){if(!n)return!0;for(const e in n)return!1;return!0}const Jue=n=>{const e=Wue(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([r,i])=>[aR(i),{def:aR(i),path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function yV(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function vn(n,e,t,r,i){n[e]=t,yV(n,e,r,i)}function Yue(){return{}}function Zue(n,e){var r,i;const t={type:"array"};return((i=(r=n.type)==null?void 0:r._def)==null?void 0:i.typeName)!==Ue.ZodAny&&(t.items=rn(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&vn(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&vn(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(vn(t,"minItems",n.exactLength.value,n.exactLength.message,e),vn(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function Xue(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?vn(t,"minimum",r.value,r.message,e):vn(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),vn(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?vn(t,"maximum",r.value,r.message,e):vn(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),vn(t,"maximum",r.value,r.message,e));break;case"multipleOf":vn(t,"multipleOf",r.value,r.message,e);break}return t}function Que(){return{type:"boolean"}}function ece(n,e){return rn(n.type._def,e)}const tce=(n,e)=>rn(n.innerType._def,e);function vV(n,e,t){const r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((i,a)=>vV(n,e,i))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return nce(n,e)}}const nce=(n,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const r of n.checks)switch(r.kind){case"min":vn(t,"minimum",r.value,r.message,e);break;case"max":vn(t,"maximum",r.value,r.message,e);break}return t};function rce(n,e){return{...rn(n.innerType._def,e),default:n.defaultValue()}}function ice(n,e,t){return e.effectStrategy==="input"?rn(n.schema._def,e,t):{}}function ace(n){return{type:"string",enum:[...n.values]}}const sce=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function oce(n,e){const t=[rn(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),rn(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const i=[];return t.forEach(a=>{if(sce(a))i.push(...a.allOf),a.unevaluatedProperties===void 0&&(r=void 0);else{let s=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...u}=a;s=u}else r=void 0;i.push(s)}}),i.length?{allOf:i,...r}:void 0}function lce(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}let JA;const Nu={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(JA===void 0&&(JA=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),JA),base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function _V(n,e){const t={type:"string"};function r(i){return e.patternStrategy==="escape"?uce(i):i}if(n.checks)for(const i of n.checks)switch(i.kind){case"min":vn(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,i.value):i.value,i.message,e);break;case"max":vn(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,i.value):i.value,i.message,e);break;case"email":switch(e.emailStrategy){case"format:email":fs(t,"email",i.message,e);break;case"format:idn-email":fs(t,"idn-email",i.message,e);break;case"pattern:zod":ds(t,Nu.email,i.message,e);break}break;case"url":fs(t,"uri",i.message,e);break;case"uuid":fs(t,"uuid",i.message,e);break;case"regex":ds(t,i.regex,i.message,e);break;case"cuid":ds(t,Nu.cuid,i.message,e);break;case"cuid2":ds(t,Nu.cuid2,i.message,e);break;case"startsWith":ds(t,RegExp(`^${r(i.value)}`),i.message,e);break;case"endsWith":ds(t,RegExp(`${r(i.value)}$`),i.message,e);break;case"datetime":fs(t,"date-time",i.message,e);break;case"date":fs(t,"date",i.message,e);break;case"time":fs(t,"time",i.message,e);break;case"duration":fs(t,"duration",i.message,e);break;case"length":vn(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,i.value):i.value,i.message,e),vn(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,i.value):i.value,i.message,e);break;case"includes":{ds(t,RegExp(r(i.value)),i.message,e);break}case"ip":{i.version!=="v6"&&fs(t,"ipv4",i.message,e),i.version!=="v4"&&fs(t,"ipv6",i.message,e);break}case"emoji":ds(t,Nu.emoji,i.message,e);break;case"ulid":{ds(t,Nu.ulid,i.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{fs(t,"binary",i.message,e);break}case"contentEncoding:base64":{vn(t,"contentEncoding","base64",i.message,e);break}case"pattern:zod":{ds(t,Nu.base64,i.message,e);break}}break}case"nanoid":ds(t,Nu.nanoid,i.message,e)}return t}const uce=n=>Array.from(n).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),fs=(n,e,t,r)=>{var i;n.format||(i=n.anyOf)!=null&&i.some(a=>a.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):vn(n,"format",e,t,r)},ds=(n,e,t,r)=>{var i;n.pattern||(i=n.allOf)!=null&&i.some(a=>a.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:p2(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):vn(n,"pattern",p2(e,r),t,r)},p2=(n,e)=>{var c;const t=typeof n=="function"?n():n;if(!e.applyRegexFlags||!t.flags)return t.source;const r={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},i=r.i?t.source.toLowerCase():t.source;let a="",s=!1,o=!1,u=!1;for(let d=0;d<i.length;d++){if(s){a+=i[d],s=!1;continue}if(r.i){if(o){if(i[d].match(/[a-z]/)){u?(a+=i[d],a+=`${i[d-2]}-${i[d]}`.toUpperCase(),u=!1):i[d+1]==="-"&&((c=i[d+2])!=null&&c.match(/[a-z]/))?(a+=i[d],u=!0):a+=`${i[d]}${i[d].toUpperCase()}`;continue}}else if(i[d].match(/[a-z]/)){a+=`[${i[d]}${i[d].toUpperCase()}]`;continue}}if(r.m){if(i[d]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(i[d]==="$"){a+=`($|(?=[\r
]))`;continue}}if(r.s&&i[d]==="."){a+=o?`${i[d]}\r
`:`[${i[d]}\r
]`;continue}a+=i[d],i[d]==="\\"?s=!0:o&&i[d]==="]"?o=!1:!o&&i[d]==="["&&(o=!0)}try{const d=new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return a};function bV(n,e){var r,i,a,s;if(e.target==="openApi3"&&((r=n.keyType)==null?void 0:r._def.typeName)===Ue.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((o,u)=>({...o,[u]:rn(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",u]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:rn(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((i=n.keyType)==null?void 0:i._def.typeName)===Ue.ZodString&&((a=n.keyType._def.checks)!=null&&a.length)){const o=Object.entries(_V(n.keyType._def,e)).reduce((u,[c,d])=>c==="type"?u:{...u,[c]:d},{});return{...t,propertyNames:o}}else if(((s=n.keyType)==null?void 0:s._def.typeName)===Ue.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};return t}function cce(n,e){if(e.mapStrategy==="record")return bV(n,e);const t=rn(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=rn(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function fce(n){const e=n.values,r=Object.keys(n.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),i=Array.from(new Set(r.map(a=>typeof a)));return{type:i.length===1?i[0]==="string"?"string":"number":["string","number"],enum:r}}function dce(){return{not:{}}}function hce(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const W_={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function pce(n,e){if(e.target==="openApi3")return m2(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in W_&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((i,a)=>{const s=W_[a._def.typeName];return s&&!i.includes(s)?[...i,s]:i},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((i,a)=>{const s=typeof a._def.value;switch(s){case"string":case"number":case"boolean":return[...i,s];case"bigint":return[...i,"integer"];case"object":if(a._def.value===null)return[...i,"null"];case"symbol":case"undefined":case"function":default:return i}},[]);if(r.length===t.length){const i=r.filter((a,s,o)=>o.indexOf(a)===s);return{type:i.length>1?i:i[0],enum:t.reduce((a,s)=>a.includes(s._def.value)?a:[...a,s._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,i)=>[...r,...i._def.values.filter(a=>!r.includes(a))],[])};return m2(n,e)}const m2=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,i)=>rn(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${i}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function mce(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:W_[n.innerType._def.typeName],nullable:!0}:{type:[W_[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=rn(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const t=rn(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function gce(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",yV(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?vn(t,"minimum",r.value,r.message,e):vn(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),vn(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?vn(t,"maximum",r.value,r.message,e):vn(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),vn(t,"maximum",r.value,r.message,e));break;case"multipleOf":vn(t,"multipleOf",r.value,r.message,e);break}return t}function yce(n,e){return e.removeAdditionalStrategy==="strict"?n.catchall._def.typeName==="ZodNever"?n.unknownKeys!=="strict":rn(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:n.catchall._def.typeName==="ZodNever"?n.unknownKeys==="passthrough":rn(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function vce(n,e){const t={type:"object",...Object.entries(n.shape()).reduce((r,[i,a])=>{var u;if(a===void 0||a._def===void 0)return r;const s=[...e.currentPath,"properties",i],o=rn(a._def,{...e,currentPath:s,propertyPath:s});if(o===void 0)return r;if(e.openaiStrictMode&&a.isOptional()&&!a.isNullable()&&typeof((u=a._def)==null?void 0:u.defaultValue)>"u")throw new Error(`Zod field at \`${s.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required`);return{properties:{...r.properties,[i]:o},required:a.isOptional()&&!e.openaiStrictMode?r.required:[...r.required,i]}},{properties:{},required:[]}),additionalProperties:yce(n,e)};return t.required.length||delete t.required,t}const _ce=(n,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return rn(n.innerType._def,e);const t=rn(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},bce=(n,e)=>{if(e.pipeStrategy==="input")return rn(n.in._def,e);if(e.pipeStrategy==="output")return rn(n.out._def,e);const t=rn(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=rn(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(i=>i!==void 0)}};function wce(n,e){return rn(n.type._def,e)}function Ece(n,e){const r={type:"array",uniqueItems:!0,items:rn(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&vn(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&vn(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function Sce(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>rn(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:rn(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>rn(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function Tce(){return{not:{}}}function Ace(){return{}}const Cce=(n,e)=>rn(n.innerType._def,e);function rn(n,e,t=!1){var s;const r=e.seen.get(n);if(e.override){const o=(s=e.override)==null?void 0:s.call(e,n,e,r,t);if(o!==Gue)return o}if(r&&!t){const o=xce(r,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}const i={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,i);const a=Ice(n,n.typeName,e,t);return a&&Pce(n,e,a),i.jsonSchema=a,a}const xce=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"extract-to-root":const t=n.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=n.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:Rce(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((r,i)=>e.currentPath[i]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},Rce=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")},Ice=(n,e,t,r)=>{switch(e){case Ue.ZodString:return _V(n,t);case Ue.ZodNumber:return gce(n,t);case Ue.ZodObject:return vce(n,t);case Ue.ZodBigInt:return Xue(n,t);case Ue.ZodBoolean:return Que();case Ue.ZodDate:return vV(n,t);case Ue.ZodUndefined:return Tce();case Ue.ZodNull:return hce(t);case Ue.ZodArray:return Zue(n,t);case Ue.ZodUnion:case Ue.ZodDiscriminatedUnion:return pce(n,t);case Ue.ZodIntersection:return oce(n,t);case Ue.ZodTuple:return Sce(n,t);case Ue.ZodRecord:return bV(n,t);case Ue.ZodLiteral:return lce(n,t);case Ue.ZodEnum:return ace(n);case Ue.ZodNativeEnum:return fce(n);case Ue.ZodNullable:return mce(n,t);case Ue.ZodOptional:return _ce(n,t);case Ue.ZodMap:return cce(n,t);case Ue.ZodSet:return Ece(n,t);case Ue.ZodLazy:return rn(n.getter()._def,t);case Ue.ZodPromise:return wce(n,t);case Ue.ZodNaN:case Ue.ZodNever:return dce();case Ue.ZodEffects:return ice(n,t,r);case Ue.ZodAny:return Yue();case Ue.ZodUnknown:return Ace();case Ue.ZodDefault:return rce(n,t);case Ue.ZodBranded:return ece(n,t);case Ue.ZodReadonly:return Cce(n,t);case Ue.ZodCatch:return tce(n,t);case Ue.ZodPipeline:return bce(n,t);case Ue.ZodFunction:case Ue.ZodVoid:case Ue.ZodSymbol:return;default:return(i=>{})()}},Pce=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),Oce=(n,e)=>{const t=Jue(e),r=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,i=rn(n._def,r===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,r]},!1)??{},a=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;a!==void 0&&(i.title=a);const s=(()=>{if(Kue(t.definitions))return;const u={},c=new Set;for(let d=0;d<500;d++){const h=Object.entries(t.definitions).filter(([m])=>!c.has(m));if(h.length===0)break;for(const[m,g]of h)u[m]=rn(aR(g),{...t,currentPath:[...t.basePath,t.definitionPath,m]},!0)??{},c.add(m)}return u})(),o=r===void 0?s?{...i,[t.definitionPath]:s}:i:t.nameStrategy==="duplicate-ref"?{...i,...s||t.seenRefs.size?{[t.definitionPath]:{...s,...t.seenRefs.size?{[r]:i}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,r].join("/"),[t.definitionPath]:{...s,[r]:i}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function kce(n,e){return Oce(n,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function Nce(n,e,t){return tue({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:kce(n,{name:e})}},r=>n.parse(JSON.parse(r)))}const Mce=Object.freeze(Object.defineProperty({__proto__:null,extendInteropZodObject:k5,getInteropZodDefaultGetter:Xne,getInteropZodObjectShape:Tx,getSchemaDescription:Ad,interopParse:Dv,interopParseAsync:Lb,interopSafeParse:Yne,interopSafeParseAsync:$b,interopZodObjectPartial:RI,interopZodObjectPassthrough:Ax,interopZodObjectStrict:M_,interopZodTransformInputSchema:Wf,isInteropZodObject:Wo,isInteropZodSchema:Ui,isShapelessZodSchema:Zne,isSimpleStringZodSchema:CI,isZodArrayV4:Ub,isZodObjectV3:xI,isZodObjectV4:lo,isZodSchema:Jne,isZodSchemaV3:hr,isZodSchemaV4:dr},Symbol.toStringTag,{value:"Module"}));function Dce(n){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:r,azureOpenAIBasePath:i,baseURL:a,azureADTokenProvider:s,azureOpenAIEndpoint:o}=n;if((r||s)&&i&&e)return`${i}/${e}`;if((r||s)&&o&&e)return`${o}/openai/deployments/${e}`;if(r||s){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return a}function wV(n,e){const t=typeof e=="number"?void 0:e;return{name:n.name,description:n.description,parameters:Tr(n.schema),...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}}function EV(n,e){const t=typeof e=="number"?void 0:e;let r;return Pc(n)?r={type:"function",function:wV(n)}:r=n,(t==null?void 0:t.strict)!==void 0&&(r.function.strict=t.strict),r}const $ce=Object.freeze(Object.defineProperty({__proto__:null,convertToOpenAIFunction:wV,convertToOpenAITool:EV,isLangChainTool:Pc,isRunnableToolLike:jI,isStructuredTool:UI,isStructuredToolParams:FI},Symbol.toStringTag,{value:"Module"}));function nv(n,e){return n.lc_error_code=e,n.message=`${n.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,n}function YA(n){let e;return n.constructor.name===tw.name?(e=new Error(n.message),e.name="TimeoutError"):n.constructor.name===_a.name?(e=new Error(n.message),e.name="AbortError"):n.status===400&&n.message.includes("tool_calls")?e=nv(n,"INVALID_TOOL_RESULTS"):n.status===401?e=nv(n,"MODEL_AUTHENTICATION"):n.status===429?e=nv(n,"MODEL_RATE_LIMIT"):n.status===404?e=nv(n,"MODEL_NOT_FOUND"):e=n,e}function g2(n){if(n)return n==="any"||n==="required"?"required":n==="auto"?"auto":n==="none"?"none":typeof n=="string"?{type:"function",function:{name:n}}:n}function Lce(n){return n.anyOf!==void 0&&Array.isArray(n.anyOf)}function Uce(n){const e=["namespace functions {",""];for(const t of n)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(SV(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function SV(n,e){var r;const t=[];for(const[i,a]of Object.entries(n.properties??{}))a.description&&e<2&&t.push(`// ${a.description}`),(r=n.required)!=null&&r.includes(i)?t.push(`${i}: ${K_(a,e)},`):t.push(`${i}?: ${K_(a,e)},`);return t.map(i=>" ".repeat(e)+i).join(`
`)}function K_(n,e){if(Lce(n))return n.anyOf.map(t=>K_(t,e)).join(" | ");switch(n.type){case"string":return n.enum?n.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",SV(n,e+2),"}"].join(`
`);case"array":return n.items?`${K_(n.items,e)}[]`:"any[]";default:return""}}function jce(n,e){let t;return Pc(n)?t=EV(n):t=n,(e==null?void 0:e.strict)!==void 0&&(t.function.strict=e.strict),t}function Fce(n){return n.role!=="system"&&n.role!=="developer"&&n.role!=="assistant"&&n.role!=="user"&&n.role!=="function"&&n.role!=="tool"&&console.warn(`Unknown message role: ${n.role}`),n.role}function IP(n){const e=n._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!Xa.isInstance(n))throw new Error("Invalid generic chat message");return Fce(n)}default:throw new Error(`Unknown message type: ${e}`)}}const TV={providerName:"ChatOpenAI",fromStandardTextBlock(n){return{type:"text",text:n.text}},fromStandardImageBlock(n){var e,t;if(n.source_type==="url")return{type:"image_url",image_url:{url:n.url,...(e=n.metadata)!=null&&e.detail?{detail:n.metadata.detail}:{}}};if(n.source_type==="base64")return{type:"image_url",image_url:{url:`data:${n.mime_type??""};base64,${n.data}`,...(t=n.metadata)!=null&&t.detail?{detail:n.metadata.detail}:{}}};throw new Error(`Image content blocks with source_type ${n.source_type} are not supported for ChatOpenAI`)},fromStandardAudioBlock(n){if(n.source_type==="url"){const e=Kl({dataUrl:n.url});if(!e)throw new Error(`URL audio blocks with source_type ${n.source_type} must be formatted as a data URL for ChatOpenAI`);const t=e.mime_type||n.mime_type||"";let r;try{r=rx(t)}catch{throw new Error(`Audio blocks with source_type ${n.source_type} must have mime type of audio/wav or audio/mp3`)}if(r.type!=="audio"||r.subtype!=="wav"&&r.subtype!=="mp3")throw new Error(`Audio blocks with source_type ${n.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:r.subtype,data:e.data}}}if(n.source_type==="base64"){let e;try{e=rx(n.mime_type??"")}catch{throw new Error(`Audio blocks with source_type ${n.source_type} must have mime type of audio/wav or audio/mp3`)}if(e.type!=="audio"||e.subtype!=="wav"&&e.subtype!=="mp3")throw new Error(`Audio blocks with source_type ${n.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:e.subtype,data:n.data}}}throw new Error(`Audio content blocks with source_type ${n.source_type} are not supported for ChatOpenAI`)},fromStandardFileBlock(n){var e,t,r,i,a,s,o,u,c,d;if(n.source_type==="url"){if(!Kl({dataUrl:n.url}))throw new Error(`URL file blocks with source_type ${n.source_type} must be formatted as a data URL for ChatOpenAI`);return{type:"file",file:{file_data:n.url,...(e=n.metadata)!=null&&e.filename||(t=n.metadata)!=null&&t.name?{filename:((r=n.metadata)==null?void 0:r.filename)||((i=n.metadata)==null?void 0:i.name)}:{}}}}if(n.source_type==="base64")return{type:"file",file:{file_data:`data:${n.mime_type??""};base64,${n.data}`,...(a=n.metadata)!=null&&a.filename||(s=n.metadata)!=null&&s.name||(o=n.metadata)!=null&&o.title?{filename:((u=n.metadata)==null?void 0:u.filename)||((c=n.metadata)==null?void 0:c.name)||((d=n.metadata)==null?void 0:d.title)}:{}}};if(n.source_type==="id")return{type:"file",file:{file_id:n.id}};throw new Error(`File content blocks with source_type ${n.source_type} are not supported for ChatOpenAI`)}};function y2(n,e){return n.flatMap(t=>{var s;let r=IP(t);r==="system"&&J_(e)&&(r="developer");const i=typeof t.content=="string"?t.content:t.content.map(o=>Ja(o)?jm(o,TV):o),a={role:r,content:i};if(t.name!=null&&(a.name=t.name),t.additional_kwargs.function_call!=null&&(a.function_call=t.additional_kwargs.function_call,a.content=""),Ea(t)&&((s=t.tool_calls)!=null&&s.length)?(a.tool_calls=t.tool_calls.map(zue),a.content=""):(t.additional_kwargs.tool_calls!=null&&(a.tool_calls=t.additional_kwargs.tool_calls),t.tool_call_id!=null&&(a.tool_call_id=t.tool_call_id)),t.additional_kwargs.audio&&typeof t.additional_kwargs.audio=="object"&&"id"in t.additional_kwargs.audio){const o={role:"assistant",audio:{id:t.additional_kwargs.audio.id}};return[a,o]}return a})}const Zf="__openai_function_call_ids__";function Bce(n){const e=(n.summary.length>1?n.summary.reduce((t,r)=>{const i=t.at(-1);return i.index===r.index?i.text+=r.text:t.push(r),t},[{...n.summary[0]}]):n.summary).map(t=>Object.fromEntries(Object.entries(t).filter(([r])=>r!=="index")));return{...n,summary:e}}function v2(n,e,t){return n.flatMap(r=>{var s,o,u;const i=r.additional_kwargs;let a=IP(r);if(a==="system"&&J_(e)&&(a="developer"),a==="function")throw new Error("Function messages are not supported in Responses API");if(a==="tool"){const c=r;return(i==null?void 0:i.type)==="computer_call_output"?{type:"computer_call_output",output:(()=>{if(typeof c.content=="string")return{type:"computer_screenshot",image_url:c.content};if(Array.isArray(c.content)){const h=c.content.find(g=>g.type==="computer_screenshot");if(h)return h;const m=c.content.find(g=>g.type==="image_url");if(m)return{type:"computer_screenshot",image_url:typeof m.image_url=="string"?m.image_url:m.image_url.url}}throw new Error("Invalid computer call output")})(),call_id:c.tool_call_id}:{type:"function_call_output",call_id:c.tool_call_id,id:(s=c.id)!=null&&s.startsWith("fc_")?c.id:void 0,output:typeof c.content!="string"?JSON.stringify(c.content):c.content}}if(a==="assistant"){if(!t&&r.response_metadata.output!=null&&Array.isArray(r.response_metadata.output)&&r.response_metadata.output.length>0&&r.response_metadata.output.every(_=>"type"in _))return r.response_metadata.output;const c=[];if(i!=null&&i.reasoning&&!t){const _=Bce(i.reasoning);c.push(_)}let{content:d}=r;i!=null&&i.refusal&&(typeof d=="string"&&(d=[{type:"output_text",text:d,annotations:[]}]),d=[...d,{type:"refusal",refusal:i.refusal}]),c.push({type:"message",role:"assistant",...r.id&&!t?{id:r.id}:{},content:typeof d=="string"?d:d.flatMap(_=>_.type==="text"?{type:"output_text",text:_.text,annotations:_.annotations??[]}:_.type==="output_text"||_.type==="refusal"?_:[])});const h=i==null?void 0:i[Zf];Ea(r)&&((o=r.tool_calls)!=null&&o.length)?c.push(...r.tool_calls.map(_=>({type:"function_call",name:_.name,arguments:JSON.stringify(_.args),call_id:_.id,...t?{id:h==null?void 0:h[_.id]}:{}}))):i!=null&&i.tool_calls&&c.push(...i.tool_calls.map(_=>({type:"function_call",name:_.function.name,call_id:_.id,arguments:_.function.arguments,...t?{id:h==null?void 0:h[_.id]}:{}})));const m=(u=r.response_metadata.output)!=null&&u.length?r.response_metadata.output:i.tool_outputs,g=["computer_call","mcp_call","code_interpreter_call","image_generation_call"];if(m!=null){const _=m,w=_==null?void 0:_.filter(S=>g.includes(S.type));w.length>0&&c.push(...w)}return c}if(a==="user"||a==="system"||a==="developer"){if(typeof r.content=="string")return{type:"message",role:a,content:r.content};const c=[],d=r.content.flatMap(h=>(h.type==="mcp_approval_response"&&c.push({type:"mcp_approval_response",approval_request_id:h.approval_request_id,approve:h.approve}),Ja(h)?jm(h,TV):h.type==="text"?{type:"input_text",text:h.text}:h.type==="image_url"?{type:"input_image",image_url:typeof h.image_url=="string"?h.image_url:h.image_url.url,detail:typeof h.image_url=="string"?"auto":h.image_url.detail}:h.type==="input_text"||h.type==="input_image"||h.type==="input_file"?h:[]));return d.length>0&&c.push({type:"message",role:a,content:d}),c}return console.warn(`Unsupported role found when converting to OpenAI Responses API: ${a}`),[]})}function AV(n){if(n.error){const o=new Error(n.error.message);throw o.name=n.error.code,o}let e;const t=[],r=[],i=[],a={model:n.model,created_at:n.created_at,id:n.id,incomplete_details:n.incomplete_details,metadata:n.metadata,object:n.object,status:n.status,user:n.user,service_tier:n.service_tier,model_name:n.model},s={};for(const o of n.output)if(o.type==="message")e=o.id,t.push(...o.content.flatMap(u=>u.type==="output_text"?("parsed"in u&&u.parsed!=null&&(s.parsed=u.parsed),{type:"text",text:u.text,annotations:u.annotations}):u.type==="refusal"?(s.refusal=u.refusal,[]):u));else if(o.type==="function_call"){const u={function:{name:o.name,arguments:o.arguments},id:o.call_id};try{r.push(RP(u,{returnId:!0}))}catch(c){let d;typeof c=="object"&&c!=null&&"message"in c&&typeof c.message=="string"&&(d=c.message),i.push(gV(u,d))}s[Zf]??(s[Zf]={}),o.id&&(s[Zf][o.call_id]=o.id)}else o.type==="reasoning"?s.reasoning=o:(s.tool_outputs??(s.tool_outputs=[]),s.tool_outputs.push(o));return new Tn({id:e,content:t,tool_calls:r,invalid_tool_calls:i,usage_metadata:n.usage,additional_kwargs:s,response_metadata:a})}function qce(n){var u,c;const e=[];let t={},r;const i=[],a={},s={};let o;if(n.type==="response.output_text.delta")e.push({type:"text",text:n.delta,index:n.content_index});else if(n.type==="response.output_text_annotation.added")e.push({type:"text",text:"",annotations:[n.annotation],index:n.content_index});else if(n.type==="response.output_item.added"&&n.item.type==="message")o=n.item.id;else if(n.type==="response.output_item.added"&&n.item.type==="function_call")i.push({type:"tool_call_chunk",name:n.item.name,args:n.item.arguments,id:n.item.call_id,index:n.output_index}),s[Zf]={[n.item.call_id]:n.item.id};else if(n.type==="response.output_item.done"&&["web_search_call","file_search_call","computer_call","code_interpreter_call","mcp_call","mcp_list_tools","mcp_approval_request","image_generation_call"].includes(n.item.type))s.tool_outputs=[n.item];else if(n.type==="response.created")a.id=n.response.id,a.model_name=n.response.model,a.model=n.response.model;else if(n.type==="response.completed"){const d=AV(n.response);r=n.response.usage,((c=(u=n.response.text)==null?void 0:u.format)==null?void 0:c.type)==="json_schema"&&(s.parsed??(s.parsed=JSON.parse(d.text)));for(const[h,m]of Object.entries(n.response))h!=="id"&&(a[h]=m)}else if(n.type==="response.function_call_arguments.delta")i.push({type:"tool_call_chunk",args:n.delta,index:n.output_index});else if(n.type==="response.web_search_call.completed"||n.type==="response.file_search_call.completed")t={tool_outputs:{id:n.item_id,type:n.type.replace("response.","").replace(".completed",""),status:"completed"}};else if(n.type==="response.refusal.done")s.refusal=n.refusal;else if(n.type==="response.output_item.added"&&"item"in n&&n.item.type==="reasoning"){const d=n.item.summary?n.item.summary.map((h,m)=>({...h,index:m})):void 0;s.reasoning={id:n.item.id,type:n.item.type,...d?{summary:d}:{}}}else if(n.type==="response.reasoning_summary_part.added")s.reasoning={type:"reasoning",summary:[{...n.part,index:n.summary_index}]};else if(n.type==="response.reasoning_summary_text.delta")s.reasoning={type:"reasoning",summary:[{text:n.delta,type:"summary_text",index:n.summary_index}]};else return n.type==="response.image_generation_call.partial_image",null;return new Sa({text:e.map(d=>d.text).join(""),message:new xn({id:o,content:e,tool_call_chunks:i,usage_metadata:r,additional_kwargs:s,response_metadata:a}),generationInfo:t})}function sR(n){return"type"in n&&n.type!=="function"}function Vce(n){return n!=null&&typeof n=="object"&&"type"in n&&n.type!=="function"}function zce(n,e){const t=[];for(const r of n)sR(r)?(r.type==="image_generation"&&(e!=null&&e.stream)&&(r.partial_images=1),t.push(r)):Fd(r)&&t.push({type:"function",name:r.function.name,parameters:r.function.parameters,description:r.function.description,strict:(e==null?void 0:e.strict)??null});return t}function _2(n,e){return Fd(n)?(e==null?void 0:e.strict)!==void 0?{...n,function:{...n.function,strict:e.strict}}:n:jce(n,e)}function J_(n){return n&&/^o\d/.test(n)}class Hce extends yi{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort","service_tier"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","reasoningEffort","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","modelName","model","modelKwargs","stop","stopSequences","timeout","openAIApiKey","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming","useResponsesApi","zdrEnabled","reasoning"]}constructor(e){var t,r,i;super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoning",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useResponsesApi",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zdrEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"service_tier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??((t=e==null?void 0:e.configuration)==null?void 0:t.apiKey)??zi("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.organization=((r=e==null?void 0:e.configuration)==null?void 0:r.organization)??zi("OPENAI_ORGANIZATION"),this.model=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.modelName=this.model,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoningEffort=(e==null?void 0:e.reasoningEffort)??((i=e==null?void 0:e.reasoning)==null?void 0:i.effort),this.reasoning=(e==null?void 0:e.reasoning)??(e!=null&&e.reasoningEffort?{effort:e.reasoningEffort}:void 0),this.maxTokens=(e==null?void 0:e.maxCompletionTokens)??(e==null?void 0:e.maxTokens),this.useResponsesApi=(e==null?void 0:e.useResponsesApi)??this.useResponsesApi,this.disableStreaming=(e==null?void 0:e.disableStreaming)??this.disableStreaming,this.streaming=(e==null?void 0:e.streaming)??!1,this.disableStreaming&&(this.streaming=!1),this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.disableStreaming&&(this.streamUsage=!1),this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling),(e==null?void 0:e.service_tier)!==void 0&&(this.service_tier=e.service_tier),this.zdrEnabled=(e==null?void 0:e.zdrEnabled)??!1}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){let r;return(t==null?void 0:t.strict)!==void 0?r=t.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling),this.withConfig({tools:e.map(i=>sR(i)?i:_2(i,{strict:r})),...t})}createResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&Ui(e.json_schema.schema)?Kce(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}getReasoningParams(e){if(!J_(this.model))return;let t;return this.reasoningEffort!==void 0&&(t={effort:this.reasoningEffort}),this.reasoning!==void 0&&(t={...t,...this.reasoning}),(e==null?void 0:e.reasoning_effort)!==void 0&&(t={...t,effort:e.reasoning_effort}),(e==null?void 0:e.reasoning)!==void 0&&(t={...t,...e.reasoning}),t}invocationParams(e,t){var o,u;let r;if((e==null?void 0:e.strict)!==void 0?r=e.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling),this._useResponseApi(e)){const c={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:e==null?void 0:e.previous_response_id,truncation:e==null?void 0:e.truncation,include:e==null?void 0:e.include,tools:(o=e==null?void 0:e.tools)!=null&&o.length?zce(e.tools,{stream:this.streaming,strict:r}):void 0,tool_choice:Vce(e==null?void 0:e.tool_choice)?e==null?void 0:e.tool_choice:(()=>{const h=g2(e==null?void 0:e.tool_choice);if(typeof h=="object"&&"type"in h)return{type:"function",name:h.function.name}})(),text:(()=>{if(e!=null&&e.text)return e.text;const h=this.createResponseFormat(e==null?void 0:e.response_format);return(h==null?void 0:h.type)==="json_schema"?h.json_schema.schema!=null?{format:{type:"json_schema",schema:h.json_schema.schema,description:h.json_schema.description,name:h.json_schema.name,strict:h.json_schema.strict}}:void 0:{format:h}})(),parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,max_output_tokens:this.maxTokens===-1?void 0:this.maxTokens,...this.zdrEnabled?{store:!1}:{},...this.modelKwargs},d=this.getReasoningParams(e);return d!==void 0&&(c.reasoning=d),c}let i={};(e==null?void 0:e.stream_options)!==void 0?i={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t!=null&&t.streaming)&&(i={stream_options:{include_usage:!0}});const a={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:(u=e==null?void 0:e.tools)!=null&&u.length?e.tools.map(c=>_2(c,{strict:r})):void 0,tool_choice:g2(e==null?void 0:e.tool_choice),response_format:this.createResponseFormat(e==null?void 0:e.response_format),seed:e==null?void 0:e.seed,...i,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.audio||e!=null&&e.audio?{audio:this.audio||(e==null?void 0:e.audio)}:{},...this.modalities||e!=null&&e.modalities?{modalities:this.modalities||(e==null?void 0:e.modalities)}:{},...this.modelKwargs};(e==null?void 0:e.prediction)!==void 0&&(a.prediction=e.prediction),this.service_tier!==void 0&&(a.service_tier=this.service_tier),(e==null?void 0:e.service_tier)!==void 0&&(a.service_tier=e.service_tier);const s=this.getReasoningParams(e);return s!==void 0&&s.effort!==void 0&&(a.reasoning_effort=s.effort),J_(a.model)?a.max_completion_tokens=this.maxTokens===-1?void 0:this.maxTokens:a.max_tokens=this.maxTokens===-1?void 0:this.maxTokens,a}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const r=e.tool_calls;switch(e.role){case"assistant":{const i=[],a=[];for(const u of r??[])try{i.push(RP(u,{returnId:!0}))}catch(c){a.push(gV(u,c.message))}const s={function_call:e.function_call,tool_calls:r};this.__includeRawResponse!==void 0&&(s.__raw_response=t);const o={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(s.audio=e.audio),new Tn({content:e.content||"",tool_calls:i,invalid_tool_calls:a,additional_kwargs:s,response_metadata:o,id:t.id})}default:return new Xa(e.content||"",e.role??"unknown")}}_convertOpenAIDeltaToBaseMessageChunk(e,t,r){var u,c;const i=e.role??r,a=e.content??"";let s;e.function_call?s={function_call:e.function_call}:e.tool_calls?s={tool_calls:e.tool_calls}:s={},this.__includeRawResponse&&(s.__raw_response=t),e.audio&&(s.audio={...e.audio,index:t.choices[0].index});const o={usage:{...t.usage}};if(i==="user")return new xc({content:a,response_metadata:o});if(i==="assistant"){const d=[];if(Array.isArray(e.tool_calls))for(const h of e.tool_calls)d.push({name:(u=h.function)==null?void 0:u.name,args:(c=h.function)==null?void 0:c.arguments,id:h.id,index:h.index,type:"tool_call_chunk"});return new xn({content:a,tool_call_chunks:d,additional_kwargs:s,id:t.id,response_metadata:o})}else return i==="system"?new co({content:a,response_metadata:o}):i==="developer"?new co({content:a,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):i==="function"?new Cc({content:a,additional_kwargs:s,name:e.name,response_metadata:o}):i==="tool"?new Ld({content:a,additional_kwargs:s,tool_call_id:e.tool_call_id,response_metadata:o}):new Ac({content:a,role:i,response_metadata:o})}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,r){var c,d,h,m,g,_,w,S,E,C;if(this._useResponseApi(t)){const A=await this.responseApiWithRetry({...this.invocationParams(t,{streaming:!0}),input:v2(e,this.model,this.zdrEnabled),stream:!0},t);for await(const R of A){const P=qce(R);P!=null&&(yield P)}return}const i=y2(e,this.model),a={...this.invocationParams(t,{streaming:!0}),messages:i,stream:!0};let s;const o=await this.completionWithRetry(a,t);let u;for await(const A of o){const R=(c=A==null?void 0:A.choices)==null?void 0:c[0];if(A.usage&&(u=A.usage),!R)continue;const{delta:P}=R;if(!P)continue;const N=this._convertOpenAIDeltaToBaseMessageChunk(P,A,s);s=P.role??s;const U={prompt:t.promptIndex??0,completion:R.index??0};if(typeof N.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const k={...U};R.finish_reason!=null&&(k.finish_reason=R.finish_reason,k.system_fingerprint=A.system_fingerprint,k.model_name=A.model,k.service_tier=A.service_tier),this.logprobs&&(k.logprobs=R.logprobs);const B=new Sa({message:N,text:N.content,generationInfo:k});yield B,await(r==null?void 0:r.handleLLMNewToken(B.text??"",U,void 0,void 0,void 0,{chunk:B}))}if(u){const A={...((d=u.prompt_tokens_details)==null?void 0:d.audio_tokens)!==null&&{audio:(h=u.prompt_tokens_details)==null?void 0:h.audio_tokens},...((m=u.prompt_tokens_details)==null?void 0:m.cached_tokens)!==null&&{cache_read:(g=u.prompt_tokens_details)==null?void 0:g.cached_tokens}},R={...((_=u.completion_tokens_details)==null?void 0:_.audio_tokens)!==null&&{audio:(w=u.completion_tokens_details)==null?void 0:w.audio_tokens},...((S=u.completion_tokens_details)==null?void 0:S.reasoning_tokens)!==null&&{reasoning:(E=u.completion_tokens_details)==null?void 0:E.reasoning_tokens}};yield new Sa({message:new xn({content:"",response_metadata:{usage:{...u}},usage_metadata:{input_tokens:u.prompt_tokens,output_tokens:u.completion_tokens,total_tokens:u.total_tokens,...Object.keys(A).length>0&&{input_token_details:A},...Object.keys(R).length>0&&{output_token_details:R}}}),text:""})}if((C=t.signal)!=null&&C.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _responseApiGenerate(e,t,r){var o;const i=this.invocationParams(t);if(i.stream){const u=this._streamResponseChunks(e,t,r);let c;for await(const d of u)d.message.response_metadata={...d.generationInfo,...d.message.response_metadata},c=(c==null?void 0:c.concat(d))??d;return{generations:c?[c]:[],llmOutput:{estimatedTokenUsage:(o=c==null?void 0:c.message)==null?void 0:o.usage_metadata}}}const a=v2(e,this.model,this.zdrEnabled),s=await this.responseApiWithRetry({input:a,...i},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});return{generations:[{text:s.output_text,message:AV(s)}],llmOutput:{id:s.id,estimatedTokenUsage:s.usage?{promptTokens:s.usage.input_tokens,completionTokens:s.usage.output_tokens,totalTokens:s.usage.total_tokens}:void 0}}}_useResponseApi(e){var i,a,s;const t=(i=e==null?void 0:e.tools)==null?void 0:i.some(sR),r=(e==null?void 0:e.previous_response_id)!=null||(e==null?void 0:e.text)!=null||(e==null?void 0:e.truncation)!=null||(e==null?void 0:e.include)!=null||((a=e==null?void 0:e.reasoning)==null?void 0:a.summary)!=null||((s=this.reasoning)==null?void 0:s.summary)!=null;return this.useResponsesApi||t||r}async _generate(e,t,r){var o,u;if(this._useResponseApi(t))return this._responseApiGenerate(e,t,r);const i={},a=this.invocationParams(t),s=y2(e,this.model);if(a.stream){const c=this._streamResponseChunks(e,t,r),d={};for await(const S of c){S.message.response_metadata={...S.generationInfo,...S.message.response_metadata};const E=((o=S.generationInfo)==null?void 0:o.completion)??0;d[E]===void 0?d[E]=S:d[E]=d[E].concat(S)}const h=Object.entries(d).sort(([S],[E])=>parseInt(S,10)-parseInt(E,10)).map(([S,E])=>E),{functions:m,function_call:g}=this.invocationParams(t),_=await this.getEstimatedTokenCountFromPrompt(e,m,g),w=await this.getNumTokensFromGenerations(h);return i.input_tokens=_,i.output_tokens=w,i.total_tokens=_+w,{generations:h,llmOutput:{estimatedTokenUsage:{promptTokens:i.input_tokens,completionTokens:i.output_tokens,totalTokens:i.total_tokens}}}}else{let c;t.response_format&&t.response_format.type==="json_schema"?c=await this.betaParsedCompletionWithRetry({...a,stream:!1,messages:s},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}):c=await this.completionWithRetry({...a,stream:!1,messages:s},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});const{completion_tokens:d,prompt_tokens:h,total_tokens:m,prompt_tokens_details:g,completion_tokens_details:_}=(c==null?void 0:c.usage)??{};d&&(i.output_tokens=(i.output_tokens??0)+d),h&&(i.input_tokens=(i.input_tokens??0)+h),m&&(i.total_tokens=(i.total_tokens??0)+m),((g==null?void 0:g.audio_tokens)!==null||(g==null?void 0:g.cached_tokens)!==null)&&(i.input_token_details={...(g==null?void 0:g.audio_tokens)!==null&&{audio:g==null?void 0:g.audio_tokens},...(g==null?void 0:g.cached_tokens)!==null&&{cache_read:g==null?void 0:g.cached_tokens}}),((_==null?void 0:_.audio_tokens)!==null||(_==null?void 0:_.reasoning_tokens)!==null)&&(i.output_token_details={...(_==null?void 0:_.audio_tokens)!==null&&{audio:_==null?void 0:_.audio_tokens},...(_==null?void 0:_.reasoning_tokens)!==null&&{reasoning:_==null?void 0:_.reasoning_tokens}});const w=[];for(const S of(c==null?void 0:c.choices)??[]){const C={text:((u=S.message)==null?void 0:u.content)??"",message:this._convertOpenAIChatCompletionMessageToBaseMessage(S.message??{role:"assistant"},c)};C.generationInfo={...S.finish_reason?{finish_reason:S.finish_reason}:{},...S.logprobs?{logprobs:S.logprobs}:{}},Ea(C.message)&&(C.message.usage_metadata=i),C.message=new Tn(Object.fromEntries(Object.entries(C.message).filter(([A])=>!A.startsWith("lc_")))),w.push(C)}return{generations:w,llmOutput:{tokenUsage:{promptTokens:i.input_tokens,completionTokens:i.output_tokens,totalTokens:i.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,t,r){let i=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&r!=="auto"){const a=Uce(t);i+=await this.getNumTokens(a),i+=9}return t&&e.find(a=>a._getType()==="system")&&(i-=4),r==="none"?i+=1:typeof r=="object"&&(i+=await this.getNumTokens(r.name)+4),i}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async r=>{var i;return(i=r.message.additional_kwargs)!=null&&i.function_call?(await this.getNumTokensFromMessages([r.message])).countPerMessage[0]:await this.getNumTokens(r.message.content)}))).reduce((r,i)=>r+i,0)}async getNumTokensFromMessages(e){let t=0,r=0,i=0;this.model==="gpt-3.5-turbo-0301"?(r=4,i=-1):(r=3,i=1);const a=await Promise.all(e.map(async s=>{var m,g,_,w,S,E;const o=await this.getNumTokens(s.content),u=await this.getNumTokens(IP(s)),c=s.name!==void 0?i+await this.getNumTokens(s.name):0;let d=o+r+u+c;const h=s;if(h._getType()==="function"&&(d-=2),(m=h.additional_kwargs)!=null&&m.function_call&&(d+=3),(g=h==null?void 0:h.additional_kwargs.function_call)!=null&&g.name&&(d+=await this.getNumTokens((_=h.additional_kwargs.function_call)==null?void 0:_.name)),(w=h.additional_kwargs.function_call)!=null&&w.arguments)try{d+=await this.getNumTokens(JSON.stringify(JSON.parse((S=h.additional_kwargs.function_call)==null?void 0:S.arguments)))}catch(C){console.error("Error parsing function arguments",C,JSON.stringify(h.additional_kwargs.function_call)),d+=await this.getNumTokens((E=h.additional_kwargs.function_call)==null?void 0:E.arguments)}return t+=d,d}));return t+=3,{totalCount:t,countPerMessage:a}}async completionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(i){throw YA(i)}})}async responseApiWithRetry(e,t){return this.caller.call(async()=>{var i,a;const r=this._getClientOptions(t);try{return((a=(i=e.text)==null?void 0:i.format)==null?void 0:a.type)==="json_schema"&&!e.stream?await this.client.responses.parse(e,r):await this.client.responses.create(e,r)}catch(s){throw YA(s)}})}async betaParsedCompletionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.parse(e,r)}catch(i){throw YA(i)}})}_getClientOptions(e){if(!this.client){const r={baseURL:this.clientConfig.baseURL},i=Dce(r),a={...this.clientConfig,baseURL:i,timeout:this.timeout,maxRetries:0};a.baseURL||delete a.baseURL,this.client=new Zt(a)}return{...this.clientConfig,...e}}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,r)=>(r&&r.tokenUsage&&(t.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let r,i,a,s;Gce(e)?(r=e.schema,i=e.name,a=e.method,s=e.includeRaw):(r=e,i=t==null?void 0:t.name,a=t==null?void 0:t.method,s=t==null?void 0:t.includeRaw);let o,u;if((t==null?void 0:t.strict)!==void 0&&a==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"?a===void 0&&(a="jsonSchema"):a==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`),a==="jsonMode"){let m;Ui(r)?(u=H_.fromZodSchema(r),m=Tr(r)):u=new G_,o=this.withConfig({response_format:{type:"json_object"},ls_structured_output_format:{kwargs:{method:"jsonMode"},schema:m}})}else if(a==="jsonSchema")if(o=this.withConfig({response_format:{type:"json_schema",json_schema:{name:i??"extract",description:Ad(r),schema:r,strict:t==null?void 0:t.strict}},ls_structured_output_format:{kwargs:{method:"jsonSchema"},schema:Tr(r)}}),Ui(r)){const m=H_.fromZodSchema(r);u=Cr.from(g=>"parsed"in g.additional_kwargs?g.additional_kwargs.parsed:m)}else u=new G_;else{let m=i??"extract";if(Ui(r)){const g=Tr(r);o=this.withConfig({tools:[{type:"function",function:{name:m,description:g.description,parameters:g}}],tool_choice:{type:"function",function:{name:m}},ls_structured_output_format:{kwargs:{method:"functionCalling"},schema:g},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),u=new d2({returnSingle:!0,keyName:m,zodSchema:r})}else{let g;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(g=r,m=r.name):(m=r.title??m,g={name:m,description:r.description??"",parameters:r}),o=this.withConfig({tools:[{type:"function",function:g}],tool_choice:{type:"function",function:{name:m}},ls_structured_output_format:{kwargs:{method:"functionCalling"},schema:Tr(r)},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),u=new d2({returnSingle:!0,keyName:m})}}if(!s)return o.pipe(u);const c=Ps.assign({parsed:(m,g)=>u.invoke(m.raw,g)}),d=Ps.assign({parsed:()=>null}),h=c.withFallbacks({fallbacks:[d]});return Ar.from([{raw:o},h])}}function Gce(n){return n!==void 0&&typeof n.schema=="object"}function Wce(n,e){const t={...n};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function Kce(n,e,t){if(hr(n))return Nce(n,e,t);if(dr(n))return Wce({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:Sx(n,{cycles:"ref",reused:"ref",override(r){r.jsonSchema.title=e}})}},r=>Gm(n,JSON.parse(r)));throw new Error("Unsupported schema response format")}class zu extends LI{constructor({concurrency:e,...t}){super(e?{maxConcurrency:e,...t}:t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","llms",this._llmType()]})}async invoke(e,t){const r=zu._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t==null?void 0:t.callbacks)).generations[0][0].text}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}_separateRunnableConfigFromCallOptionsCompat(e){const[t,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=t.signal,[t,r]}async*_streamIterator(e,t){if(this._streamResponseChunks===zu.prototype._streamResponseChunks)yield this.invoke(e,t);else{const r=zu._convertInputToPromptValue(e),[i,a]=this._separateRunnableConfigFromCallOptionsCompat(t),s=await tr.configure(i.callbacks,this.callbacks,i.tags,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),o={options:a,invocation_params:this==null?void 0:this.invocationParams(a),batch_size:1},u=await(s==null?void 0:s.handleLLMStart(this.toJSON(),[r.toString()],i.runId,void 0,o,void 0,void 0,i.runName));let c=new tu({text:""});try{for await(const d of this._streamResponseChunks(r.toString(),a,u==null?void 0:u[0]))c?c=c.concat(d):c=d,typeof d.text=="string"&&(yield d.text)}catch(d){throw await Promise.all((u??[]).map(h=>h==null?void 0:h.handleLLMError(d))),d}await Promise.all((u??[]).map(d=>d==null?void 0:d.handleLLMEnd({generations:[[c]]})))}}async generatePrompt(e,t,r){const i=e.map(a=>a.toString());return this.generate(i,t,r)}invocationParams(e){return{}}_flattenLLMResult(e){const t=[];for(let r=0;r<e.generations.length;r+=1){const i=e.generations[r];if(r===0)t.push({generations:[i],llmOutput:e.llmOutput});else{const a=e.llmOutput?{...e.llmOutput,tokenUsage:{}}:void 0;t.push({generations:[i],llmOutput:a})}}return t}async _generateUncached(e,t,r,i){let a;if(i!==void 0&&i.length===e.length)a=i;else{const c=await tr.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),d={options:t,invocation_params:this==null?void 0:this.invocationParams(t),batch_size:e.length};a=await(c==null?void 0:c.handleLLMStart(this.toJSON(),e,r.runId,void 0,d,void 0,void 0,r==null?void 0:r.runName))}const s=!!(a!=null&&a[0].handlers.find(EI));let o;if(s&&e.length===1&&this._streamResponseChunks!==zu.prototype._streamResponseChunks)try{const c=await this._streamResponseChunks(e[0],t,a==null?void 0:a[0]);let d;for await(const h of c)d===void 0?d=h:d=_i(d,h);if(d===void 0)throw new Error("Received empty response from chat model call.");o={generations:[[d]],llmOutput:{}},await(a==null?void 0:a[0].handleLLMEnd(o))}catch(c){throw await(a==null?void 0:a[0].handleLLMError(c)),c}else{try{o=await this._generate(e,t,a==null?void 0:a[0])}catch(d){throw await Promise.all((a??[]).map(h=>h==null?void 0:h.handleLLMError(d))),d}const c=this._flattenLLMResult(o);await Promise.all((a??[]).map((d,h)=>d==null?void 0:d.handleLLMEnd(c[h])))}const u=(a==null?void 0:a.map(c=>c.runId))||void 0;return Object.defineProperty(o,mm,{value:u?{runIds:u}:void 0,configurable:!0}),o}async _generateCached({prompts:e,cache:t,llmStringKey:r,parsedOptions:i,handledOptions:a,runId:s}){const o=await tr.configure(a.callbacks,this.callbacks,a.tags,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),u={options:i,invocation_params:this==null?void 0:this.invocationParams(i),batch_size:e.length},c=await(o==null?void 0:o.handleLLMStart(this.toJSON(),e,s,void 0,u,void 0,void 0,a==null?void 0:a.runName)),d=[],m=(await Promise.allSettled(e.map(async(w,S)=>{const E=await t.lookup(w,r);return E==null&&d.push(S),E}))).map((w,S)=>({result:w,runManager:c==null?void 0:c[S]})).filter(({result:w})=>w.status==="fulfilled"&&w.value!=null||w.status==="rejected"),g=[];await Promise.all(m.map(async({result:w,runManager:S},E)=>{if(w.status==="fulfilled"){const C=w.value;return g[E]=C.map(A=>(A.generationInfo={...A.generationInfo,tokenUsage:{}},A)),C.length&&await(S==null?void 0:S.handleLLMNewToken(C[0].text)),S==null?void 0:S.handleLLMEnd({generations:[C]},void 0,void 0,void 0,{cached:!0})}else return await(S==null?void 0:S.handleLLMError(w.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(w.reason)}));const _={generations:g,missingPromptIndices:d,startedRunManagers:c};return Object.defineProperty(_,mm,{value:c?{runIds:c==null?void 0:c.map(w=>w.runId)}:void 0,configurable:!0}),_}async generate(e,t,r){if(!Array.isArray(e))throw new Error("Argument 'prompts' is expected to be a string[]");let i;Array.isArray(t)?i={stop:t}:i=t;const[a,s]=this._separateRunnableConfigFromCallOptionsCompat(i);if(a.callbacks=a.callbacks??r,!this.cache)return this._generateUncached(e,s,a);const{cache:o}=this,u=this._getSerializedCacheKeyParametersForCall(s),{generations:c,missingPromptIndices:d,startedRunManagers:h}=await this._generateCached({prompts:e,cache:o,llmStringKey:u,parsedOptions:s,handledOptions:a,runId:a.runId});let m={};if(d.length>0){const g=await this._generateUncached(d.map(_=>e[_]),s,a,h!==void 0?d.map(_=>h==null?void 0:h[_]):void 0);await Promise.all(g.generations.map(async(_,w)=>{const S=d[w];return c[S]=_,o.update(e[S],u,_)})),m=g.llmOutput??{}}return{generations:c,llmOutput:m}}async call(e,t,r){const{generations:i}=await this.generate([e],t,r);return i[0][0].text}async predict(e,t,r){return this.call(e,t,r)}async predictMessages(e,t,r){const i=Bm(e),a=await this.call(i,t,r);return new Tn(a)}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}_modelType(){return"base_llm"}}class PP extends zu{async _generate(e,t,r){return{generations:await Promise.all(e.map((a,s)=>this._call(a,{...t,promptIndex:s},r).then(o=>[{text:o}])))}}}const Jce=Object.freeze(Object.defineProperty({__proto__:null,BaseLLM:zu,LLM:PP},Symbol.toStringTag,{value:"Module"})),Yce=(n,e)=>n.reduce((t,r,i)=>{const a=Math.floor(i/e),s=t[a]||[];return t[a]=s.concat([r]),t},[]),Zce=Object.freeze(Object.defineProperty({__proto__:null,chunkArray:Yce},Symbol.toStringTag,{value:"Module"}));class OP{constructor(e){Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new Hm(e??{})}}const Xce=Object.freeze(Object.defineProperty({__proto__:null,Embeddings:OP},Symbol.toStringTag,{value:"Module"}));function Nt(n,e,t,r,i){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}function Ye(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)}let CV=function(){const{crypto:n}=globalThis;if(n!=null&&n.randomUUID)return CV=n.randomUUID.bind(n),n.randomUUID();const e=new Uint8Array(1),t=n?()=>n.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^t()&15>>+r/4).toString(16))};function _m(n){return typeof n=="object"&&n!==null&&("name"in n&&n.name==="AbortError"||"message"in n&&String(n.message).includes("FetchRequestCanceledException"))}const oR=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null){try{if(Object.prototype.toString.call(n)==="[object Error]"){const e=new Error(n.message,n.cause?{cause:n.cause}:{});return n.stack&&(e.stack=n.stack),n.cause&&!e.cause&&(e.cause=n.cause),n.name&&(e.name=n.name),e}}catch{}try{return new Error(JSON.stringify(n))}catch{}}return new Error(n)};class Ht extends Error{}class ui extends Ht{constructor(e,t,r,i){super(`${ui.makeMessage(e,t,r)}`),this.status=e,this.headers=i,this.requestID=i==null?void 0:i.get("request-id"),this.error=t}static makeMessage(e,t,r){const i=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,t,r,i){if(!e||!i)return new uw({message:r,cause:oR(t)});const a=t;return e===400?new RV(e,a,r,i):e===401?new IV(e,a,r,i):e===403?new PV(e,a,r,i):e===404?new OV(e,a,r,i):e===409?new kV(e,a,r,i):e===422?new NV(e,a,r,i):e===429?new MV(e,a,r,i):e>=500?new DV(e,a,r,i):new ui(e,a,r,i)}}class ws extends ui{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class uw extends ui{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class xV extends uw{constructor({message:e}={}){super({message:e??"Request timed out."})}}class RV extends ui{}class IV extends ui{}class PV extends ui{}class OV extends ui{}class kV extends ui{}class NV extends ui{}class MV extends ui{}class DV extends ui{}const Qce=/^[a-z][a-z0-9+.-]*:/i,efe=n=>Qce.test(n);function b2(n){return typeof n!="object"?{}:n??{}}function tfe(n){if(!n)return!0;for(const e in n)return!1;return!0}function nfe(n,e){return Object.prototype.hasOwnProperty.call(n,e)}const rfe=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Ht(`${n} must be an integer`);if(e<0)throw new Ht(`${n} must be a positive integer`);return e},$V=n=>{try{return JSON.parse(n)}catch{return}},ife=n=>new Promise(e=>setTimeout(e,n)),Y_={off:0,error:200,warn:300,info:400,debug:500},w2=(n,e,t)=>{if(n){if(nfe(Y_,n))return n;Ni(t).warn(`${e} was set to ${JSON.stringify(n)}, expected one of ${JSON.stringify(Object.keys(Y_))}`)}};function Np(){}function rv(n,e,t){return!e||Y_[n]>Y_[t]?Np:e[n].bind(e)}const afe={error:Np,warn:Np,info:Np,debug:Np};let E2=new WeakMap;function Ni(n){const e=n.logger,t=n.logLevel??"off";if(!e)return afe;const r=E2.get(e);if(r&&r[0]===t)return r[1];const i={error:rv("error",e,t),warn:rv("warn",e,t),info:rv("info",e,t),debug:rv("debug",e,t)};return E2.set(e,[t,i]),i}const $u=n=>(n.options&&(n.options={...n.options},delete n.options.headers),n.headers&&(n.headers=Object.fromEntries((n.headers instanceof Headers?[...n.headers]:Object.entries(n.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in n&&(n.retryOfRequestLogID&&(n.retryOf=n.retryOfRequestLogID),delete n.retryOfRequestLogID),n),Vf="0.52.0",sfe=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function ofe(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const lfe=()=>{var t;const n=ofe();if(n==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vf,"X-Stainless-OS":T2(Deno.build.os),"X-Stainless-Arch":S2(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((t=Deno.version)==null?void 0:t.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vf,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(n==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vf,"X-Stainless-OS":T2(globalThis.process.platform),"X-Stainless-Arch":S2(globalThis.process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version};const e=ufe();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vf,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Vf,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function ufe(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const i=r[1]||0,a=r[2]||0,s=r[3]||0;return{browser:e,version:`${i}.${a}.${s}`}}}return null}const S2=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",T2=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let A2;const cfe=()=>A2??(A2=lfe());function ffe(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function LV(...n){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...n)}function UV(n){let e=Symbol.asyncIterator in n?n[Symbol.asyncIterator]():n[Symbol.iterator]();return LV({start(){},async pull(t){const{done:r,value:i}=await e.next();r?t.close():t.enqueue(i)},async cancel(){var t;await((t=e.return)==null?void 0:t.call(e))}})}function kP(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function dfe(n){var r,i;if(n===null||typeof n!="object")return;if(n[Symbol.asyncIterator]){await((i=(r=n[Symbol.asyncIterator]()).return)==null?void 0:i.call(r));return}const e=n.getReader(),t=e.cancel();e.releaseLock(),await t}const hfe=({headers:n,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});function pfe(n){let e=0;for(const i of n)e+=i.length;const t=new Uint8Array(e);let r=0;for(const i of n)t.set(i,r),r+=i.length;return t}let C2;function NP(n){let e;return(C2??(e=new globalThis.TextEncoder,C2=e.encode.bind(e)))(n)}let x2;function R2(n){let e;return(x2??(e=new globalThis.TextDecoder,x2=e.decode.bind(e)))(n)}var ha,pa;class ag{constructor(){ha.set(this,void 0),pa.set(this,void 0),Nt(this,ha,new Uint8Array),Nt(this,pa,null)}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?NP(e):e;Nt(this,ha,pfe([Ye(this,ha,"f"),t]));const r=[];let i;for(;(i=mfe(Ye(this,ha,"f"),Ye(this,pa,"f")))!=null;){if(i.carriage&&Ye(this,pa,"f")==null){Nt(this,pa,i.index);continue}if(Ye(this,pa,"f")!=null&&(i.index!==Ye(this,pa,"f")+1||i.carriage)){r.push(R2(Ye(this,ha,"f").subarray(0,Ye(this,pa,"f")-1))),Nt(this,ha,Ye(this,ha,"f").subarray(Ye(this,pa,"f"))),Nt(this,pa,null);continue}const a=Ye(this,pa,"f")!==null?i.preceding-1:i.preceding,s=R2(Ye(this,ha,"f").subarray(0,a));r.push(s),Nt(this,ha,Ye(this,ha,"f").subarray(i.index)),Nt(this,pa,null)}return r}flush(){return Ye(this,ha,"f").length?this.decode(`
`):[]}}ha=new WeakMap,pa=new WeakMap;ag.NEWLINE_CHARS=new Set([`
`,"\r"]);ag.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function mfe(n,e){for(let i=e??0;i<n.length;i++){if(n[i]===10)return{preceding:i,index:i+1,carriage:!1};if(n[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function gfe(n){for(let r=0;r<n.length-1;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}class no{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*i(){if(r)throw new Ht("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const s of yfe(e,t)){if(s.event==="completion")try{yield JSON.parse(s.data)}catch(o){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),o}if(s.event==="message_start"||s.event==="message_delta"||s.event==="message_stop"||s.event==="content_block_start"||s.event==="content_block_delta"||s.event==="content_block_stop")try{yield JSON.parse(s.data)}catch(o){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),o}if(s.event!=="ping"&&s.event==="error")throw new ui(void 0,$V(s.data)??s.data,void 0,e.headers)}a=!0}catch(s){if(_m(s))return;throw s}finally{a||t.abort()}}return new no(i,t)}static fromReadableStream(e,t){let r=!1;async function*i(){const s=new ag,o=kP(e);for await(const u of o)for(const c of s.decode(u))yield c;for(const u of s.flush())yield u}async function*a(){if(r)throw new Ht("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(const o of i())s||o&&(yield JSON.parse(o));s=!0}catch(o){if(_m(o))return;throw o}finally{s||t.abort()}}return new no(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),i=a=>({next:()=>{if(a.length===0){const s=r.next();e.push(s),t.push(s)}return a.shift()}});return[new no(()=>i(e),this.controller),new no(()=>i(t),this.controller)]}toReadableStream(){const e=this;let t;return LV({async start(){t=e[Symbol.asyncIterator]()},async pull(r){try{const{value:i,done:a}=await t.next();if(a)return r.close();const s=NP(JSON.stringify(i)+`
`);r.enqueue(s)}catch(i){r.error(i)}},async cancel(){var r;await((r=t.return)==null?void 0:r.call(t))}})}}async function*yfe(n,e){if(!n.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new Ht("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Ht("Attempted to iterate over a response with no body");const t=new _fe,r=new ag,i=kP(n.body);for await(const a of vfe(i))for(const s of r.decode(a)){const o=t.decode(s);o&&(yield o)}for(const a of r.flush()){const s=t.decode(a);s&&(yield s)}}async function*vfe(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?NP(t):t;let i=new Uint8Array(e.length+r.length);i.set(e),i.set(r,e.length),e=i;let a;for(;(a=gfe(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}class _fe{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,i]=bfe(e,":");return i.startsWith(" ")&&(i=i.substring(1)),t==="event"?this.event=i:t==="data"&&this.data.push(i),null}}function bfe(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}async function jV(n,e){const{response:t,requestLogID:r,retryOfRequestLogID:i,startTime:a}=e,s=await(async()=>{var h;if(e.options.stream)return Ni(n).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):no.fromSSEResponse(t,e.controller);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const o=t.headers.get("content-type"),u=(h=o==null?void 0:o.split(";")[0])==null?void 0:h.trim();if((u==null?void 0:u.includes("application/json"))||(u==null?void 0:u.endsWith("+json"))){const m=await t.json();return FV(m,t)}return await t.text()})();return Ni(n).debug(`[${r}] response parsed`,$u({retryOfRequestLogID:i,url:t.url,status:t.status,body:s,durationMs:Date.now()-a})),s}function FV(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("request-id"),enumerable:!1})}var Mp;class cw extends Promise{constructor(e,t,r=jV){super(i=>{i(null)}),this.responsePromise=t,this.parseResponse=r,Mp.set(this,void 0),Nt(this,Mp,e)}_thenUnwrap(e){return new cw(Ye(this,Mp,"f"),this.responsePromise,async(t,r)=>FV(e(await this.parseResponse(t,r),r),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(Ye(this,Mp,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}Mp=new WeakMap;var iv;class wfe{constructor(e,t,r,i){iv.set(this,void 0),Nt(this,iv,e),this.options=i,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new Ht("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await Ye(this,iv,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(iv=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class Efe extends cw{constructor(e,t,r){super(e,t,async(i,a)=>new r(i,a.response,await jV(i,a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}class sg extends wfe{constructor(e,t,r,i){super(e,t,r,i),this.data=r.data||[],this.has_more=r.has_more||!1,this.first_id=r.first_id||null,this.last_id=r.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){var t;if((t=this.options.query)!=null&&t.before_id){const r=this.first_id;return r?{...this.options,query:{...b2(this.options.query),before_id:r}}:null}const e=this.last_id;return e?{...this.options,query:{...b2(this.options.query),after_id:e}}:null}}const BV=()=>{var n;if(typeof File>"u"){const{process:e}=globalThis,t=typeof((n=e==null?void 0:e.versions)==null?void 0:n.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function dd(n,e,t){return BV(),new File(n,e??"unknown_file",t)}function Wv(n){return(typeof n=="object"&&n!==null&&("name"in n&&n.name&&String(n.name)||"url"in n&&n.url&&String(n.url)||"filename"in n&&n.filename&&String(n.filename)||"path"in n&&n.path&&String(n.path))||"").split(/[\\/]/).pop()||void 0}const qV=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",Sfe=async(n,e)=>({...n,body:await Afe(n.body,e)}),I2=new WeakMap;function Tfe(n){const e=typeof n=="function"?n:n.fetch,t=I2.get(e);if(t)return t;const r=(async()=>{try{const i="Response"in e?e.Response:(await e("data:,")).constructor,a=new FormData;return a.toString()!==await new i(a).text()}catch{return!0}})();return I2.set(e,r),r}const Afe=async(n,e)=>{if(!await Tfe(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const t=new FormData;return await Promise.all(Object.entries(n||{}).map(([r,i])=>lR(t,r,i))),t},Cfe=n=>n instanceof Blob&&"name"in n,lR=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(t instanceof Response){let r={};const i=t.headers.get("Content-Type");i&&(r={type:i}),n.append(e,dd([await t.blob()],Wv(t),r))}else if(qV(t))n.append(e,dd([await new Response(UV(t)).blob()],Wv(t)));else if(Cfe(t))n.append(e,dd([t],Wv(t),{type:t.type}));else if(Array.isArray(t))await Promise.all(t.map(r=>lR(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,i])=>lR(n,`${e}[${r}]`,i)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}},VV=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",xfe=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&VV(n),Rfe=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function";async function Ife(n,e,t){if(BV(),n=await n,e||(e=Wv(n)),xfe(n))return n instanceof File&&e==null&&t==null?n:dd([await n.arrayBuffer()],e??n.name,{type:n.type,lastModified:n.lastModified,...t});if(Rfe(n)){const i=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()),dd(await uR(i),e,t)}const r=await uR(n);if(!(t!=null&&t.type)){const i=r.find(a=>typeof a=="object"&&"type"in a&&a.type);typeof i=="string"&&(t={...t,type:i})}return dd(r,e,t)}async function uR(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(VV(n))e.push(n instanceof Blob?n:await n.arrayBuffer());else if(qV(n))for await(const r of n)e.push(...await uR(r));else{const r=(t=n==null?void 0:n.constructor)==null?void 0:t.name;throw new Error(`Unexpected data type: ${typeof n}${r?`; constructor: ${r}`:""}${Pfe(n)}`)}return e}function Pfe(n){return typeof n!="object"||n===null?"":`; props: [${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}class il{constructor(e){this._client=e}}const zV=Symbol.for("brand.privateNullableHeaders"),P2=Array.isArray;function*Ofe(n){if(!n)return;if(zV in n){const{values:r,nulls:i}=n;yield*r.entries();for(const a of i)yield[a,null];return}let e=!1,t;n instanceof Headers?t=n.entries():P2(n)?t=n:(e=!0,t=Object.entries(n??{}));for(let r of t){const i=r[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");const a=P2(r[1])?r[1]:[r[1]];let s=!1;for(const o of a)o!==void 0&&(e&&!s&&(s=!0,yield[i,null]),yield[i,o])}}const Fn=n=>{const e=new Headers,t=new Set;for(const r of n){const i=new Set;for(const[a,s]of Ofe(r)){const o=a.toLowerCase();i.has(o)||(e.delete(a),i.add(o)),s===null?(e.delete(a),t.add(o)):(e.append(a,s),t.delete(o))}}return{[zV]:!0,values:e,nulls:t}};function HV(n){return n.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const kfe=(n=HV)=>function(t,...r){if(t.length===1)return t[0];let i=!1;const a=t.reduce((d,h,m)=>(/[?#]/.test(h)&&(i=!0),d+h+(m===r.length?"":(i?encodeURIComponent:n)(String(r[m])))),""),s=a.split(/[?#]/,1)[0],o=[],u=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let c;for(;(c=u.exec(s))!==null;)o.push({start:c.index,length:c[0].length});if(o.length>0){let d=0;const h=o.reduce((m,g)=>{const _=" ".repeat(g.start-d),w="^".repeat(g.length);return d=g.start+g.length,m+_+w},"");throw new Ht(`Path parameters result in path with invalid segments:
${a}
${h}`)}return a},Ts=kfe(HV);let GV=class extends il{list(e={},t){const{betas:r,...i}=e??{};return this._client.getAPIList("/v1/files",sg,{query:i,...t,headers:Fn([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},t==null?void 0:t.headers])})}delete(e,t={},r){const{betas:i}=t??{};return this._client.delete(Ts`/v1/files/${e}`,{...r,headers:Fn([{"anthropic-beta":[...i??[],"files-api-2025-04-14"].toString()},r==null?void 0:r.headers])})}download(e,t={},r){const{betas:i}=t??{};return this._client.get(Ts`/v1/files/${e}/content`,{...r,headers:Fn([{"anthropic-beta":[...i??[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},r==null?void 0:r.headers]),__binaryResponse:!0})}retrieveMetadata(e,t={},r){const{betas:i}=t??{};return this._client.get(Ts`/v1/files/${e}`,{...r,headers:Fn([{"anthropic-beta":[...i??[],"files-api-2025-04-14"].toString()},r==null?void 0:r.headers])})}upload(e,t){const{betas:r,...i}=e;return this._client.post("/v1/files",Sfe({body:i,...t,headers:Fn([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},t==null?void 0:t.headers])},this._client))}},WV=class extends il{retrieve(e,t={},r){const{betas:i}=t??{};return this._client.get(Ts`/v1/models/${e}?beta=true`,{...r,headers:Fn([{...(i==null?void 0:i.toString())!=null?{"anthropic-beta":i==null?void 0:i.toString()}:void 0},r==null?void 0:r.headers])})}list(e={},t){const{betas:r,...i}=e??{};return this._client.getAPIList("/v1/models?beta=true",sg,{query:i,...t,headers:Fn([{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0},t==null?void 0:t.headers])})}};class fw{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){const e=new ag;for await(const t of this.iterator)for(const r of e.decode(t))yield JSON.parse(r);for(const t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new Ht("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Ht("Attempted to iterate over a response with no body");return new fw(kP(e.body),t)}}let KV=class extends il{create(e,t){const{betas:r,...i}=e;return this._client.post("/v1/messages/batches?beta=true",{body:i,...t,headers:Fn([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},t==null?void 0:t.headers])})}retrieve(e,t={},r){const{betas:i}=t??{};return this._client.get(Ts`/v1/messages/batches/${e}?beta=true`,{...r,headers:Fn([{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString()},r==null?void 0:r.headers])})}list(e={},t){const{betas:r,...i}=e??{};return this._client.getAPIList("/v1/messages/batches?beta=true",sg,{query:i,...t,headers:Fn([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},t==null?void 0:t.headers])})}delete(e,t={},r){const{betas:i}=t??{};return this._client.delete(Ts`/v1/messages/batches/${e}?beta=true`,{...r,headers:Fn([{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString()},r==null?void 0:r.headers])})}cancel(e,t={},r){const{betas:i}=t??{};return this._client.post(Ts`/v1/messages/batches/${e}/cancel?beta=true`,{...r,headers:Fn([{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString()},r==null?void 0:r.headers])})}async results(e,t={},r){const i=await this.retrieve(e);if(!i.results_url)throw new Ht(`No batch \`results_url\`; Has it finished processing? ${i.processing_status} - ${i.id}`);const{betas:a}=t??{};return this._client.get(i.results_url,{...r,headers:Fn([{"anthropic-beta":[...a??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},r==null?void 0:r.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((s,o)=>fw.fromResponse(o.response,o.controller))}};const Nfe=n=>{let e=0,t=[];for(;e<n.length;){let r=n[e];if(r==="\\"){e++;continue}if(r==="{"){t.push({type:"brace",value:"{"}),e++;continue}if(r==="}"){t.push({type:"brace",value:"}"}),e++;continue}if(r==="["){t.push({type:"paren",value:"["}),e++;continue}if(r==="]"){t.push({type:"paren",value:"]"}),e++;continue}if(r===":"){t.push({type:"separator",value:":"}),e++;continue}if(r===","){t.push({type:"delimiter",value:","}),e++;continue}if(r==='"'){let o="",u=!1;for(r=n[++e];r!=='"';){if(e===n.length){u=!0;break}if(r==="\\"){if(e++,e===n.length){u=!0;break}o+=r+n[e],r=n[++e]}else o+=r,r=n[++e]}r=n[++e],u||t.push({type:"string",value:o});continue}if(r&&/\s/.test(r)){e++;continue}let a=/[0-9]/;if(r&&a.test(r)||r==="-"||r==="."){let o="";for(r==="-"&&(o+=r,r=n[++e]);r&&a.test(r)||r===".";)o+=r,r=n[++e];t.push({type:"number",value:o});continue}let s=/[a-z]/i;if(r&&s.test(r)){let o="";for(;r&&s.test(r)&&e!==n.length;)o+=r,r=n[++e];if(o=="true"||o=="false"||o==="null")t.push({type:"name",value:o});else{e++;continue}continue}e++}return t},zf=n=>{if(n.length===0)return n;let e=n[n.length-1];switch(e.type){case"separator":return n=n.slice(0,n.length-1),zf(n);case"number":let t=e.value[e.value.length-1];if(t==="."||t==="-")return n=n.slice(0,n.length-1),zf(n);case"string":let r=n[n.length-2];if((r==null?void 0:r.type)==="delimiter")return n=n.slice(0,n.length-1),zf(n);if((r==null?void 0:r.type)==="brace"&&r.value==="{")return n=n.slice(0,n.length-1),zf(n);break;case"delimiter":return n=n.slice(0,n.length-1),zf(n)}return n},Mfe=n=>{let e=[];return n.map(t=>{t.type==="brace"&&(t.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),t.type==="paren"&&(t.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{t==="}"?n.push({type:"brace",value:"}"}):t==="]"&&n.push({type:"paren",value:"]"})}),n},Dfe=n=>{let e="";return n.map(t=>{switch(t.type){case"string":e+='"'+t.value+'"';break;default:e+=t.value;break}}),e},JV=n=>JSON.parse(Dfe(Mfe(zf(Nfe(n)))));var Da,Dl,np,av,rp,ip,sv,ap,No,sp,ov,lv,xf,uv,cv,ZA,O2,XA,QA,eC,tC,k2;const N2="__json_buf";class Z_{constructor(){Da.add(this),this.messages=[],this.receivedMessages=[],Dl.set(this,void 0),this.controller=new AbortController,np.set(this,void 0),av.set(this,()=>{}),rp.set(this,()=>{}),ip.set(this,void 0),sv.set(this,()=>{}),ap.set(this,()=>{}),No.set(this,{}),sp.set(this,!1),ov.set(this,!1),lv.set(this,!1),xf.set(this,!1),uv.set(this,void 0),cv.set(this,void 0),XA.set(this,e=>{if(Nt(this,ov,!0),_m(e)&&(e=new ws),e instanceof ws)return Nt(this,lv,!0),this._emit("abort",e);if(e instanceof Ht)return this._emit("error",e);if(e instanceof Error){const t=new Ht(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new Ht(String(e)))}),Nt(this,np,new Promise((e,t)=>{Nt(this,av,e,"f"),Nt(this,rp,t,"f")})),Nt(this,ip,new Promise((e,t)=>{Nt(this,sv,e,"f"),Nt(this,ap,t,"f")})),Ye(this,np,"f").catch(()=>{}),Ye(this,ip,"f").catch(()=>{})}get response(){return Ye(this,uv,"f")}get request_id(){return Ye(this,cv,"f")}async withResponse(){const e=await Ye(this,np,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new Z_;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,r){const i=new Z_;for(const a of t.messages)i._addMessageParam(a);return i._run(()=>i._createMessage(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},Ye(this,XA,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,r){var o;const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),Ye(this,Da,"m",QA).call(this);const{response:a,data:s}=await e.create({...t,stream:!0},{...r,signal:this.controller.signal}).withResponse();this._connected(a);for await(const u of s)Ye(this,Da,"m",eC).call(this,u);if((o=s.controller.signal)!=null&&o.aborted)throw new ws;Ye(this,Da,"m",tC).call(this)}_connected(e){this.ended||(Nt(this,uv,e),Nt(this,cv,e==null?void 0:e.headers.get("request-id")),Ye(this,av,"f").call(this,e),this._emit("connect"))}get ended(){return Ye(this,sp,"f")}get errored(){return Ye(this,ov,"f")}get aborted(){return Ye(this,lv,"f")}abort(){this.controller.abort()}on(e,t){return(Ye(this,No,"f")[e]||(Ye(this,No,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=Ye(this,No,"f")[e];if(!r)return this;const i=r.findIndex(a=>a.listener===t);return i>=0&&r.splice(i,1),this}once(e,t){return(Ye(this,No,"f")[e]||(Ye(this,No,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{Nt(this,xf,!0),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){Nt(this,xf,!0),await Ye(this,ip,"f")}get currentMessage(){return Ye(this,Dl,"f")}async finalMessage(){return await this.done(),Ye(this,Da,"m",ZA).call(this)}async finalText(){return await this.done(),Ye(this,Da,"m",O2).call(this)}_emit(e,...t){if(Ye(this,sp,"f"))return;e==="end"&&(Nt(this,sp,!0),Ye(this,sv,"f").call(this));const r=Ye(this,No,"f")[e];if(r&&(Ye(this,No,"f")[e]=r.filter(i=>!i.once),r.forEach(({listener:i})=>i(...t))),e==="abort"){const i=t[0];!Ye(this,xf,"f")&&!(r!=null&&r.length)&&Promise.reject(i),Ye(this,rp,"f").call(this,i),Ye(this,ap,"f").call(this,i),this._emit("end");return}if(e==="error"){const i=t[0];!Ye(this,xf,"f")&&!(r!=null&&r.length)&&Promise.reject(i),Ye(this,rp,"f").call(this,i),Ye(this,ap,"f").call(this,i),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",Ye(this,Da,"m",ZA).call(this))}async _fromReadableStream(e,t){var a;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Ye(this,Da,"m",QA).call(this),this._connected(null);const i=no.fromReadableStream(e,this.controller);for await(const s of i)Ye(this,Da,"m",eC).call(this,s);if((a=i.controller.signal)!=null&&a.aborted)throw new ws;Ye(this,Da,"m",tC).call(this)}[(Dl=new WeakMap,np=new WeakMap,av=new WeakMap,rp=new WeakMap,ip=new WeakMap,sv=new WeakMap,ap=new WeakMap,No=new WeakMap,sp=new WeakMap,ov=new WeakMap,lv=new WeakMap,xf=new WeakMap,uv=new WeakMap,cv=new WeakMap,XA=new WeakMap,Da=new WeakSet,ZA=function(){if(this.receivedMessages.length===0)throw new Ht("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},O2=function(){if(this.receivedMessages.length===0)throw new Ht("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(t.length===0)throw new Ht("stream ended without producing a content block with type=text");return t.join(" ")},QA=function(){this.ended||Nt(this,Dl,void 0)},eC=function(t){if(this.ended)return;const r=Ye(this,Da,"m",k2).call(this,t);switch(this._emit("streamEvent",t,r),t.type){case"content_block_delta":{const i=r.content.at(-1);switch(t.delta.type){case"text_delta":{i.type==="text"&&this._emit("text",t.delta.text,i.text||"");break}case"citations_delta":{i.type==="text"&&this._emit("citation",t.delta.citation,i.citations??[]);break}case"input_json_delta":{(i.type==="tool_use"||i.type==="mcp_tool_use")&&i.input&&this._emit("inputJson",t.delta.partial_json,i.input);break}case"thinking_delta":{i.type==="thinking"&&this._emit("thinking",t.delta.thinking,i.thinking);break}case"signature_delta":{i.type==="thinking"&&this._emit("signature",i.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(r),this._addMessage(r,!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{Nt(this,Dl,r);break}}},tC=function(){if(this.ended)throw new Ht("stream has ended, this shouldn't happen");const t=Ye(this,Dl,"f");if(!t)throw new Ht("request ended without sending any chunks");return Nt(this,Dl,void 0),t},k2=function(t){let r=Ye(this,Dl,"f");if(t.type==="message_start"){if(r)throw new Ht(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!r)throw new Ht(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return r;case"message_delta":return r.container=t.delta.container,r.stop_reason=t.delta.stop_reason,r.stop_sequence=t.delta.stop_sequence,r.usage.output_tokens=t.usage.output_tokens,t.usage.input_tokens!=null&&(r.usage.input_tokens=t.usage.input_tokens),t.usage.cache_creation_input_tokens!=null&&(r.usage.cache_creation_input_tokens=t.usage.cache_creation_input_tokens),t.usage.cache_read_input_tokens!=null&&(r.usage.cache_read_input_tokens=t.usage.cache_read_input_tokens),t.usage.server_tool_use!=null&&(r.usage.server_tool_use=t.usage.server_tool_use),r;case"content_block_start":return r.content.push(t.content_block),r;case"content_block_delta":{const i=r.content.at(t.index);switch(t.delta.type){case"text_delta":{(i==null?void 0:i.type)==="text"&&(i.text+=t.delta.text);break}case"citations_delta":{(i==null?void 0:i.type)==="text"&&(i.citations??(i.citations=[]),i.citations.push(t.delta.citation));break}case"input_json_delta":{if((i==null?void 0:i.type)==="tool_use"||(i==null?void 0:i.type)==="mcp_tool_use"){let a=i[N2]||"";a+=t.delta.partial_json,Object.defineProperty(i,N2,{value:a,enumerable:!1,writable:!0}),a&&(i.input=JV(a))}break}case"thinking_delta":{(i==null?void 0:i.type)==="thinking"&&(i.thinking+=t.delta.thinking);break}case"signature_delta":{(i==null?void 0:i.type)==="thinking"&&(i.signature=t.delta.signature);break}default:t.delta}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("streamEvent",i=>{const a=t.shift();a?a.resolve(i):e.push(i)}),this.on("end",()=>{r=!0;for(const i of t)i.resolve(void 0);t.length=0}),this.on("abort",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),this.on("error",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,s)=>t.push({resolve:a,reject:s})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new no(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}const YV={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192},M2={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};let MP=class extends il{constructor(){super(...arguments),this.batches=new KV(this._client)}create(e,t){const{betas:r,...i}=e;i.model in M2&&console.warn(`The model '${i.model}' is deprecated and will reach end-of-life on ${M2[i.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let a=this._client._options.timeout;if(!i.stream&&a==null){const s=YV[i.model]??void 0;a=this._client.calculateNonstreamingTimeout(i.max_tokens,s)}return this._client.post("/v1/messages?beta=true",{body:i,timeout:a??6e5,...t,headers:Fn([{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0},t==null?void 0:t.headers]),stream:e.stream??!1})}stream(e,t){return Z_.createMessage(this,e,t)}countTokens(e,t){const{betas:r,...i}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:i,...t,headers:Fn([{"anthropic-beta":[...r??[],"token-counting-2024-11-01"].toString()},t==null?void 0:t.headers])})}};MP.Batches=KV;class og extends il{constructor(){super(...arguments),this.models=new WV(this._client),this.messages=new MP(this._client),this.files=new GV(this._client)}}og.Models=WV;og.Messages=MP;og.Files=GV;class ZV extends il{create(e,t){const{betas:r,...i}=e;return this._client.post("/v1/complete",{body:i,timeout:this._client._options.timeout??6e5,...t,headers:Fn([{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0},t==null?void 0:t.headers]),stream:e.stream??!1})}}var $a,$l,op,fv,lp,up,dv,cp,Mo,fp,hv,pv,Rf,mv,gv,nC,D2,rC,iC,aC,sC,$2;const L2="__json_buf";class X_{constructor(){$a.add(this),this.messages=[],this.receivedMessages=[],$l.set(this,void 0),this.controller=new AbortController,op.set(this,void 0),fv.set(this,()=>{}),lp.set(this,()=>{}),up.set(this,void 0),dv.set(this,()=>{}),cp.set(this,()=>{}),Mo.set(this,{}),fp.set(this,!1),hv.set(this,!1),pv.set(this,!1),Rf.set(this,!1),mv.set(this,void 0),gv.set(this,void 0),rC.set(this,e=>{if(Nt(this,hv,!0),_m(e)&&(e=new ws),e instanceof ws)return Nt(this,pv,!0),this._emit("abort",e);if(e instanceof Ht)return this._emit("error",e);if(e instanceof Error){const t=new Ht(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new Ht(String(e)))}),Nt(this,op,new Promise((e,t)=>{Nt(this,fv,e,"f"),Nt(this,lp,t,"f")})),Nt(this,up,new Promise((e,t)=>{Nt(this,dv,e,"f"),Nt(this,cp,t,"f")})),Ye(this,op,"f").catch(()=>{}),Ye(this,up,"f").catch(()=>{})}get response(){return Ye(this,mv,"f")}get request_id(){return Ye(this,gv,"f")}async withResponse(){const e=await Ye(this,op,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new X_;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,r){const i=new X_;for(const a of t.messages)i._addMessageParam(a);return i._run(()=>i._createMessage(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},Ye(this,rC,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,r){var o;const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),Ye(this,$a,"m",iC).call(this);const{response:a,data:s}=await e.create({...t,stream:!0},{...r,signal:this.controller.signal}).withResponse();this._connected(a);for await(const u of s)Ye(this,$a,"m",aC).call(this,u);if((o=s.controller.signal)!=null&&o.aborted)throw new ws;Ye(this,$a,"m",sC).call(this)}_connected(e){this.ended||(Nt(this,mv,e),Nt(this,gv,e==null?void 0:e.headers.get("request-id")),Ye(this,fv,"f").call(this,e),this._emit("connect"))}get ended(){return Ye(this,fp,"f")}get errored(){return Ye(this,hv,"f")}get aborted(){return Ye(this,pv,"f")}abort(){this.controller.abort()}on(e,t){return(Ye(this,Mo,"f")[e]||(Ye(this,Mo,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=Ye(this,Mo,"f")[e];if(!r)return this;const i=r.findIndex(a=>a.listener===t);return i>=0&&r.splice(i,1),this}once(e,t){return(Ye(this,Mo,"f")[e]||(Ye(this,Mo,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{Nt(this,Rf,!0),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){Nt(this,Rf,!0),await Ye(this,up,"f")}get currentMessage(){return Ye(this,$l,"f")}async finalMessage(){return await this.done(),Ye(this,$a,"m",nC).call(this)}async finalText(){return await this.done(),Ye(this,$a,"m",D2).call(this)}_emit(e,...t){if(Ye(this,fp,"f"))return;e==="end"&&(Nt(this,fp,!0),Ye(this,dv,"f").call(this));const r=Ye(this,Mo,"f")[e];if(r&&(Ye(this,Mo,"f")[e]=r.filter(i=>!i.once),r.forEach(({listener:i})=>i(...t))),e==="abort"){const i=t[0];!Ye(this,Rf,"f")&&!(r!=null&&r.length)&&Promise.reject(i),Ye(this,lp,"f").call(this,i),Ye(this,cp,"f").call(this,i),this._emit("end");return}if(e==="error"){const i=t[0];!Ye(this,Rf,"f")&&!(r!=null&&r.length)&&Promise.reject(i),Ye(this,lp,"f").call(this,i),Ye(this,cp,"f").call(this,i),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",Ye(this,$a,"m",nC).call(this))}async _fromReadableStream(e,t){var a;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Ye(this,$a,"m",iC).call(this),this._connected(null);const i=no.fromReadableStream(e,this.controller);for await(const s of i)Ye(this,$a,"m",aC).call(this,s);if((a=i.controller.signal)!=null&&a.aborted)throw new ws;Ye(this,$a,"m",sC).call(this)}[($l=new WeakMap,op=new WeakMap,fv=new WeakMap,lp=new WeakMap,up=new WeakMap,dv=new WeakMap,cp=new WeakMap,Mo=new WeakMap,fp=new WeakMap,hv=new WeakMap,pv=new WeakMap,Rf=new WeakMap,mv=new WeakMap,gv=new WeakMap,rC=new WeakMap,$a=new WeakSet,nC=function(){if(this.receivedMessages.length===0)throw new Ht("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},D2=function(){if(this.receivedMessages.length===0)throw new Ht("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(t.length===0)throw new Ht("stream ended without producing a content block with type=text");return t.join(" ")},iC=function(){this.ended||Nt(this,$l,void 0)},aC=function(t){if(this.ended)return;const r=Ye(this,$a,"m",$2).call(this,t);switch(this._emit("streamEvent",t,r),t.type){case"content_block_delta":{const i=r.content.at(-1);switch(t.delta.type){case"text_delta":{i.type==="text"&&this._emit("text",t.delta.text,i.text||"");break}case"citations_delta":{i.type==="text"&&this._emit("citation",t.delta.citation,i.citations??[]);break}case"input_json_delta":{i.type==="tool_use"&&i.input&&this._emit("inputJson",t.delta.partial_json,i.input);break}case"thinking_delta":{i.type==="thinking"&&this._emit("thinking",t.delta.thinking,i.thinking);break}case"signature_delta":{i.type==="thinking"&&this._emit("signature",i.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(r),this._addMessage(r,!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{Nt(this,$l,r);break}}},sC=function(){if(this.ended)throw new Ht("stream has ended, this shouldn't happen");const t=Ye(this,$l,"f");if(!t)throw new Ht("request ended without sending any chunks");return Nt(this,$l,void 0),t},$2=function(t){let r=Ye(this,$l,"f");if(t.type==="message_start"){if(r)throw new Ht(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!r)throw new Ht(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return r;case"message_delta":return r.stop_reason=t.delta.stop_reason,r.stop_sequence=t.delta.stop_sequence,r.usage.output_tokens=t.usage.output_tokens,t.usage.input_tokens!=null&&(r.usage.input_tokens=t.usage.input_tokens),t.usage.cache_creation_input_tokens!=null&&(r.usage.cache_creation_input_tokens=t.usage.cache_creation_input_tokens),t.usage.cache_read_input_tokens!=null&&(r.usage.cache_read_input_tokens=t.usage.cache_read_input_tokens),t.usage.server_tool_use!=null&&(r.usage.server_tool_use=t.usage.server_tool_use),r;case"content_block_start":return r.content.push(t.content_block),r;case"content_block_delta":{const i=r.content.at(t.index);switch(t.delta.type){case"text_delta":{(i==null?void 0:i.type)==="text"&&(i.text+=t.delta.text);break}case"citations_delta":{(i==null?void 0:i.type)==="text"&&(i.citations??(i.citations=[]),i.citations.push(t.delta.citation));break}case"input_json_delta":{if((i==null?void 0:i.type)==="tool_use"){let a=i[L2]||"";a+=t.delta.partial_json,Object.defineProperty(i,L2,{value:a,enumerable:!1,writable:!0}),a&&(i.input=JV(a))}break}case"thinking_delta":{(i==null?void 0:i.type)==="thinking"&&(i.thinking+=t.delta.thinking);break}case"signature_delta":{(i==null?void 0:i.type)==="thinking"&&(i.signature=t.delta.signature);break}default:t.delta}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("streamEvent",i=>{const a=t.shift();a?a.resolve(i):e.push(i)}),this.on("end",()=>{r=!0;for(const i of t)i.resolve(void 0);t.length=0}),this.on("abort",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),this.on("error",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,s)=>t.push({resolve:a,reject:s})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new no(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class XV extends il{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(Ts`/v1/messages/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/v1/messages/batches",sg,{query:e,...t})}delete(e,t){return this._client.delete(Ts`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(Ts`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){const r=await this.retrieve(e);if(!r.results_url)throw new Ht(`No batch \`results_url\`; Has it finished processing? ${r.processing_status} - ${r.id}`);return this._client.get(r.results_url,{...t,headers:Fn([{Accept:"application/binary"},t==null?void 0:t.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((i,a)=>fw.fromResponse(a.response,a.controller))}}class DP extends il{constructor(){super(...arguments),this.batches=new XV(this._client)}create(e,t){e.model in U2&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${U2[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let r=this._client._options.timeout;if(!e.stream&&r==null){const i=YV[e.model]??void 0;r=this._client.calculateNonstreamingTimeout(e.max_tokens,i)}return this._client.post("/v1/messages",{body:e,timeout:r??6e5,...t,stream:e.stream??!1})}stream(e,t){return X_.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}}const U2={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};DP.Batches=XV;let QV=class extends il{retrieve(e,t={},r){const{betas:i}=t??{};return this._client.get(Ts`/v1/models/${e}`,{...r,headers:Fn([{...(i==null?void 0:i.toString())!=null?{"anthropic-beta":i==null?void 0:i.toString()}:void 0},r==null?void 0:r.headers])})}list(e={},t){const{betas:r,...i}=e??{};return this._client.getAPIList("/v1/models",sg,{query:i,...t,headers:Fn([{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0},t==null?void 0:t.headers])})}};var oC={};const yv=n=>{var e,t,r,i;if(typeof globalThis.process<"u")return((e=oC==null?void 0:oC[n])==null?void 0:e.trim())??void 0;if(typeof globalThis.Deno<"u")return(i=(r=(t=globalThis.Deno.env)==null?void 0:t.get)==null?void 0:r.call(t,n))==null?void 0:i.trim()};var e8,Kv;class pr{constructor({baseURL:e=yv("ANTHROPIC_BASE_URL"),apiKey:t=yv("ANTHROPIC_API_KEY")??null,authToken:r=yv("ANTHROPIC_AUTH_TOKEN")??null,...i}={}){Kv.set(this,void 0);const a={apiKey:t,authToken:r,...i,baseURL:e||"https://api.anthropic.com"};if(!a.dangerouslyAllowBrowser&&sfe())throw new Ht(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
`);this.baseURL=a.baseURL,this.timeout=a.timeout??kc.DEFAULT_TIMEOUT,this.logger=a.logger??console;const s="warn";this.logLevel=s,this.logLevel=w2(a.logLevel,"ClientOptions.logLevel",this)??w2(yv("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this)??s,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??ffe(),Nt(this,Kv,hfe),this._options=a,this.apiKey=t,this.authToken=r}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(this.apiKey&&e.get("x-api-key"))&&!t.has("x-api-key")&&!(this.authToken&&e.get("authorization"))&&!t.has("authorization"))throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(e){return Fn([this.apiKeyAuth(e),this.bearerAuth(e)])}apiKeyAuth(e){if(this.apiKey!=null)return Fn([{"X-Api-Key":this.apiKey}])}bearerAuth(e){if(this.authToken!=null)return Fn([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new Ht(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${Vf}`}defaultIdempotencyKey(){return`stainless-node-retry-${CV()}`}makeStatusError(e,t,r,i){return ui.generate(e,t,r,i)}buildURL(e,t){const r=efe(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return tfe(i)||(t={...i,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new Ht("Streaming is strongly recommended for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-python#streaming-responses for more details");return 600*1e3}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(i=>({method:e,path:t,...i})))}request(e,t=null){return new cw(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,r){var E,C;const i=await e,a=i.maxRetries??this.maxRetries;t==null&&(t=a),await this.prepareOptions(i);const{req:s,url:o,timeout:u}=this.buildRequest(i,{retryCount:a-t});await this.prepareRequest(s,{url:o,options:i});const c="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),d=r===void 0?"":`, retryOf: ${r}`,h=Date.now();if(Ni(this).debug(`[${c}] sending request`,$u({retryOfRequestLogID:r,method:i.method,url:o,options:i,headers:s.headers})),(E=i.signal)!=null&&E.aborted)throw new ws;const m=new AbortController,g=await this.fetchWithTimeout(o,s,u,m).catch(oR),_=Date.now();if(g instanceof Error){const A=`retrying, ${t} attempts remaining`;if((C=i.signal)!=null&&C.aborted)throw new ws;const R=_m(g)||/timed? ?out/i.test(String(g)+("cause"in g?String(g.cause):""));if(t)return Ni(this).info(`[${c}] connection ${R?"timed out":"failed"} - ${A}`),Ni(this).debug(`[${c}] connection ${R?"timed out":"failed"} (${A})`,$u({retryOfRequestLogID:r,url:o,durationMs:_-h,message:g.message})),this.retryRequest(i,t,r??c);throw Ni(this).info(`[${c}] connection ${R?"timed out":"failed"} - error; no more retries left`),Ni(this).debug(`[${c}] connection ${R?"timed out":"failed"} (error; no more retries left)`,$u({retryOfRequestLogID:r,url:o,durationMs:_-h,message:g.message})),R?new xV:new uw({cause:g})}const w=[...g.headers.entries()].filter(([A])=>A==="request-id").map(([A,R])=>", "+A+": "+JSON.stringify(R)).join(""),S=`[${c}${d}${w}] ${s.method} ${o} ${g.ok?"succeeded":"failed"} with status ${g.status} in ${_-h}ms`;if(!g.ok){const A=this.shouldRetry(g);if(t&&A){const B=`retrying, ${t} attempts remaining`;return await dfe(g.body),Ni(this).info(`${S} - ${B}`),Ni(this).debug(`[${c}] response error (${B})`,$u({retryOfRequestLogID:r,url:g.url,status:g.status,headers:g.headers,durationMs:_-h})),this.retryRequest(i,t,r??c,g.headers)}const R=A?"error; no more retries left":"error; not retryable";Ni(this).info(`${S} - ${R}`);const P=await g.text().catch(B=>oR(B).message),N=$V(P),U=N?void 0:P;throw Ni(this).debug(`[${c}] response error (${R})`,$u({retryOfRequestLogID:r,url:g.url,status:g.status,headers:g.headers,message:U,durationMs:Date.now()-h})),this.makeStatusError(g.status,N,U,g.headers)}return Ni(this).info(S),Ni(this).debug(`[${c}] response start`,$u({retryOfRequestLogID:r,url:g.url,status:g.status,headers:g.headers,durationMs:_-h})),{response:g,options:i,controller:m,requestLogID:c,retryOfRequestLogID:r,startTime:h}}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}requestAPIList(e,t){const r=this.makeRequest(t,null,void 0);return new Efe(this,r,e)}async fetchWithTimeout(e,t,r,i){const{signal:a,method:s,...o}=t||{};a&&a.addEventListener("abort",()=>i.abort());const u=setTimeout(()=>i.abort(),r),c=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||typeof o.body=="object"&&o.body!==null&&Symbol.asyncIterator in o.body,d={signal:i.signal,...c?{duplex:"half"}:{},method:"GET",...o};s&&(d.method=s.toUpperCase());try{return await this.fetch.call(void 0,e,d)}finally{clearTimeout(u)}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r,i){let a;const s=i==null?void 0:i.get("retry-after-ms");if(s){const u=parseFloat(s);Number.isNaN(u)||(a=u)}const o=i==null?void 0:i.get("retry-after");if(o&&!a){const u=parseFloat(o);Number.isNaN(u)?a=Date.parse(o)-Date.now():a=u*1e3}if(!(a&&0<=a&&a<60*1e3)){const u=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,u)}return await ife(a),this.makeRequest(e,t-1,r)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,s=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return s*o*1e3}calculateNonstreamingTimeout(e,t){if(36e5*e/128e3>6e5||t!=null&&e>t)throw new Ht("Streaming is strongly recommended for operations that may token longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return 6e5}buildRequest(e,{retryCount:t=0}={}){const r={...e},{method:i,path:a,query:s}=r,o=this.buildURL(a,s);"timeout"in r&&rfe("timeout",r.timeout),r.timeout=r.timeout??this.timeout;const{bodyHeaders:u,body:c}=this.buildBody({options:r}),d=this.buildHeaders({options:e,method:i,bodyHeaders:u,retryCount:t});return{req:{method:i,headers:d,...r.signal&&{signal:r.signal},...globalThis.ReadableStream&&c instanceof globalThis.ReadableStream&&{duplex:"half"},...c&&{body:c},...this.fetchOptions??{},...r.fetchOptions??{}},url:o,timeout:r.timeout}}buildHeaders({options:e,method:t,bodyHeaders:r,retryCount:i}){let a={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const s=Fn([a,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...cfe(),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},this.authHeaders(e),this._options.defaultHeaders,r,e.headers]);return this.validateHeaders(s),s.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const r=Fn([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&r.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:UV(e)}:Ye(this,Kv,"f").call(this,{body:e,headers:r})}}e8=pr,Kv=new WeakMap;pr.Anthropic=e8;pr.HUMAN_PROMPT=`

Human:`;pr.AI_PROMPT=`

Assistant:`;pr.DEFAULT_TIMEOUT=6e5;pr.AnthropicError=Ht;pr.APIError=ui;pr.APIConnectionError=uw;pr.APIConnectionTimeoutError=xV;pr.APIUserAbortError=ws;pr.NotFoundError=OV;pr.ConflictError=kV;pr.RateLimitError=MV;pr.BadRequestError=RV;pr.AuthenticationError=IV;pr.InternalServerError=DV;pr.PermissionDeniedError=PV;pr.UnprocessableEntityError=NV;pr.toFile=Ife;class kc extends pr{constructor(){super(...arguments),this.completions=new ZV(this),this.messages=new DP(this),this.models=new QV(this),this.beta=new og(this)}}kc.Completions=ZV;kc.Messages=DP;kc.Models=QV;kc.Beta=og;const{HUMAN_PROMPT:_Ie,AI_PROMPT:bIe}=kc;class j2 extends ow{static lc_name(){return"AnthropicToolsOutputParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","anthropic","output_parsers"]}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){let t=e;if(typeof e=="string")try{t=JSON.parse(e)}catch(i){throw new Ga(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(i.message)}`,e)}else t=e;if(this.zodSchema===void 0)return t;const r=await $b(this.zodSchema,t);if(r.success)return r.data;throw new Ga(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(r.error.issues)}`,JSON.stringify(t,null,2))}async parseResult(e){const t=e.flatMap(a=>{const{message:s}=a;return Array.isArray(s.content)?t8(s.content)[0]:[]});if(t[0]===void 0)throw new Error("No parseable tool calls provided to AnthropicToolsOutputParser.");const[r]=t;return await this._validateResult(r.args)}}function t8(n){const e=[];for(const t of n)t.type==="tool_use"?e.push({name:t.name,args:t.input,id:t.id,type:"tool_call"}):t.type==="server_tool_use"&&t.name==="web_search"&&e.push({name:t.name,args:t.input,id:t.id,type:"tool_call"});return e}function $fe(n){if(n)return n==="any"?{type:"any"}:n==="auto"?{type:"auto"}:typeof n=="string"?{type:"tool",name:n}:n}function Lfe(n){return n==null||typeof n!="object"||!("type"in n)||n.type!=="image"||!("source"in n)||typeof n.source!="object"||n.source==null||!("type"in n.source)?!1:n.source.type==="base64"?!(!("media_type"in n.source)||typeof n.source.media_type!="string"||!("data"in n.source)||typeof n.source.data!="string"):n.source.type==="url"?!(!("url"in n.source)||typeof n.source.url!="string"):!1}function F2(n){const e=Kl({dataUrl:n});if(e)return{type:"base64",media_type:e.mime_type,data:e.data};let t;try{t=new URL(n)}catch{throw new Error([`Malformed image URL: ${JSON.stringify(n)}. Content blocks of type 'image_url' must be a valid http, https, or base64-encoded data URL.`,"Example: data:image/png;base64,/9j/4AAQSk...","Example: https://example.com/image.jpg"].join(`

`))}if(t.protocol==="http:"||t.protocol==="https:")return{type:"url",url:n};throw new Error([`Invalid image URL protocol: ${JSON.stringify(t.protocol)}. Anthropic only supports images as http, https, or base64-encoded data URLs on 'image_url' content blocks.`,"Example: data:image/png;base64,/9j/4AAQSk...","Example: https://example.com/image.jpg"].join(`

`))}function Ufe(n){const e=[];for(const t of n)if(t._getType()==="tool")if(typeof t.content=="string"){const r=e[e.length-1];(r==null?void 0:r._getType())==="human"&&Array.isArray(r.content)&&"type"in r.content[0]&&r.content[0].type==="tool_result"?r.content.push({type:"tool_result",content:t.content,tool_use_id:t.tool_call_id}):e.push(new oi({content:[{type:"tool_result",content:t.content,tool_use_id:t.tool_call_id}]}))}else e.push(new oi({content:[{type:"tool_result",...t.content!=null?{content:cR(t.content)}:{},tool_use_id:t.tool_call_id}]}));else e.push(t);return e}function B2(n){if(n.id===void 0)throw new Error('Anthropic requires all tool calls to have an "id".');return{type:"tool_use",id:n.id,name:n.name,input:n.args}}const jfe={providerName:"anthropic",fromStandardTextBlock(n){return{type:"text",text:n.text,..."citations"in(n.metadata??{})?{citations:n.metadata.citations}:{},..."cache_control"in(n.metadata??{})?{cache_control:n.metadata.cache_control}:{}}},fromStandardImageBlock(n){if(n.source_type==="url"){const e=Kl({dataUrl:n.url,asTypedArray:!1});return e?{type:"image",source:{type:"base64",data:e.data,media_type:e.mime_type},..."cache_control"in(n.metadata??{})?{cache_control:n.metadata.cache_control}:{}}:{type:"image",source:{type:"url",url:n.url,media_type:n.mime_type??""},..."cache_control"in(n.metadata??{})?{cache_control:n.metadata.cache_control}:{}}}else{if(n.source_type==="base64")return{type:"image",source:{type:"base64",data:n.data,media_type:n.mime_type??""},..."cache_control"in(n.metadata??{})?{cache_control:n.metadata.cache_control}:{}};throw new Error(`Unsupported image source type: ${n.source_type}`)}},fromStandardFileBlock(n){const e=(n.mime_type??"").split(";")[0];if(n.source_type==="url"){if(e==="application/pdf"||e==="")return{type:"document",source:{type:"url",url:n.url,media_type:n.mime_type??""},..."cache_control"in(n.metadata??{})?{cache_control:n.metadata.cache_control}:{},..."citations"in(n.metadata??{})?{citations:n.metadata.citations}:{},..."context"in(n.metadata??{})?{context:n.metadata.context}:{},..."title"in(n.metadata??{})?{title:n.metadata.title}:{}};throw new Error(`Unsupported file mime type for file url source: ${n.mime_type}`)}else if(n.source_type==="text"){if(e==="text/plain"||e==="")return{type:"document",source:{type:"text",data:n.text,media_type:n.mime_type??""},..."cache_control"in(n.metadata??{})?{cache_control:n.metadata.cache_control}:{},..."citations"in(n.metadata??{})?{citations:n.metadata.citations}:{},..."context"in(n.metadata??{})?{context:n.metadata.context}:{},..."title"in(n.metadata??{})?{title:n.metadata.title}:{}};throw new Error(`Unsupported file mime type for file text source: ${n.mime_type}`)}else if(n.source_type==="base64"){if(e==="application/pdf"||e==="")return{type:"document",source:{type:"base64",data:n.data,media_type:"application/pdf"},..."cache_control"in(n.metadata??{})?{cache_control:n.metadata.cache_control}:{},..."citations"in(n.metadata??{})?{citations:n.metadata.citations}:{},..."context"in(n.metadata??{})?{context:n.metadata.context}:{},..."title"in(n.metadata??{})?{title:n.metadata.title}:{}};if(["image/jpeg","image/png","image/gif","image/webp"].includes(e))return{type:"document",source:{type:"content",content:[{type:"image",source:{type:"base64",data:n.data,media_type:e}}]},..."cache_control"in(n.metadata??{})?{cache_control:n.metadata.cache_control}:{},..."citations"in(n.metadata??{})?{citations:n.metadata.citations}:{},..."context"in(n.metadata??{})?{context:n.metadata.context}:{},..."title"in(n.metadata??{})?{title:n.metadata.title}:{}};throw new Error(`Unsupported file mime type for file base64 source: ${n.mime_type}`)}else throw new Error(`Unsupported file source type: ${n.source_type}`)}};function cR(n){const e=["tool_use","tool_result","input_json_delta","server_tool_use","web_search_tool_result","web_search_result"],t=["text","text_delta"];return typeof n=="string"?n:n.map(i=>{if(Ja(i))return jm(i,jfe);const a="cache_control"in i?i.cache_control:void 0;if(i.type==="image_url"){let s;return typeof i.image_url=="string"?s=F2(i.image_url):s=F2(i.image_url.url),{type:"image",source:s,...a?{cache_control:a}:{}}}else{if(Lfe(i))return i;if(i.type==="document")return{...i,...a?{cache_control:a}:{}};if(i.type==="thinking")return{type:"thinking",thinking:i.thinking,signature:i.signature,...a?{cache_control:a}:{}};if(i.type==="redacted_thinking")return{type:"redacted_thinking",data:i.data,...a?{cache_control:a}:{}};if(t.find(s=>s===i.type)&&"text"in i)return{type:"text",text:i.text,...a?{cache_control:a}:{},..."citations"in i&&i.citations?{citations:i.citations}:{}};if(e.find(s=>s===i.type)){const s={...i};if("index"in s&&delete s.index,s.type==="input_json_delta"&&(s.type="tool_use"),"input"in s&&typeof s.input=="string")try{s.input=JSON.parse(s.input)}catch{s.input={}}return{...s,...a?{cache_control:a}:{}}}else throw new Error("Unsupported message content format")}})}function q2(n){const e=Ufe(n);let t;e.length>0&&e[0]._getType()==="system"&&(t=n[0].content);const i=(t!==void 0?e.slice(1):e).map(a=>{var o;let s;if(a._getType()==="human")s="user";else if(a._getType()==="ai")s="assistant";else if(a._getType()==="tool")s="user";else throw a._getType()==="system"?new Error("System messages are only permitted as the first passed message."):new Error(`Message type "${a._getType()}" is not supported.`);if(Ea(a)&&((o=a.tool_calls)!=null&&o.length)){if(typeof a.content=="string")return a.content===""?{role:s,content:a.tool_calls.map(B2)}:{role:s,content:[{type:"text",text:a.content},...a.tool_calls.map(B2)]};{const{content:u}=a;return!a.tool_calls.every(d=>u.find(h=>(h.type==="tool_use"||h.type==="input_json_delta"||h.type==="server_tool_use")&&h.id===d.id))&&console.warn('The "tool_calls" field on a message is only respected if content is a string.'),{role:s,content:cR(a.content)}}}else return{role:s,content:cR(a.content)}});return{messages:Ffe(i),system:t}}function Ffe(n){if(!n||n.length<=1)return n;const e=[];let t=n[0];const r=a=>typeof a=="string"?[{type:"text",text:a}]:a,i=a=>a.role!=="user"||typeof a.content=="string"?!1:Array.isArray(a.content)&&a.content.every(s=>s.type==="tool_result");for(let a=1;a<n.length;a+=1){const s=n[a];i(t)&&i(s)?t={...t,content:[...r(t.content),...r(s.content)]}:(e.push(t),t=s)}return e.push(t),e}function Bfe(n,e){var t;if(n.type==="message_start"){const{content:r,usage:i,...a}=n.message,s={};for(const[h,m]of Object.entries(a))m!=null&&(s[h]=m);const{input_tokens:o,output_tokens:u,...c}=i??{},d={input_tokens:o,output_tokens:u,total_tokens:o+u,input_token_details:{cache_creation:c.cache_creation_input_tokens,cache_read:c.cache_read_input_tokens}};return{chunk:new xn({content:e.coerceContentToString?"":[],additional_kwargs:s,usage_metadata:e.streamUsage?d:void 0,response_metadata:{usage:{...c}},id:n.message.id})}}else if(n.type==="message_delta"){const r={input_tokens:0,output_tokens:n.usage.output_tokens,total_tokens:n.usage.output_tokens,input_token_details:{cache_creation:n.usage.cache_creation_input_tokens,cache_read:n.usage.cache_read_input_tokens}};return{chunk:new xn({content:e.coerceContentToString?"":[],additional_kwargs:{...n.delta},usage_metadata:e.streamUsage?r:void 0})}}else if(n.type==="content_block_start"&&["tool_use","document","server_tool_use","web_search_tool_result"].includes(n.content_block.type)){const r=n.content_block;let i;return r.type==="tool_use"?i=[{id:r.id,index:n.index,name:r.name,args:""}]:r.type==="server_tool_use"?i=[{id:r.id,index:n.index,name:r.name,args:""}]:i=[],{chunk:new xn({content:e.coerceContentToString?"":[{index:n.index,...n.content_block,input:r.type==="server_tool_use"||r.type==="tool_use"?"":void 0}],additional_kwargs:{},tool_call_chunks:i})}}else if(n.type==="content_block_delta"&&["text_delta","citations_delta","thinking_delta","signature_delta"].includes(n.delta.type)){if(e.coerceContentToString&&"text"in n.delta)return{chunk:new xn({content:n.delta.text})};{const r=n.delta;return"citation"in r&&(r.citations=[r.citation],delete r.citation),r.type==="thinking_delta"||r.type==="signature_delta"?{chunk:new xn({content:[{index:n.index,...r,type:"thinking"}]})}:{chunk:new xn({content:[{index:n.index,...r,type:"text"}]})}}}else{if(n.type==="content_block_delta"&&n.delta.type==="input_json_delta")return{chunk:new xn({content:e.coerceContentToString?"":[{index:n.index,input:n.delta.partial_json,type:n.delta.type}],additional_kwargs:{},tool_call_chunks:[{index:n.index,args:n.delta.partial_json}]})};if(n.type==="content_block_start"&&n.content_block.type==="text"){const r=(t=n.content_block)==null?void 0:t.text;if(r!==void 0)return{chunk:new xn({content:e.coerceContentToString?r:[{index:n.index,...n.content_block}],additional_kwargs:{}})}}else{if(n.type==="content_block_start"&&n.content_block.type==="redacted_thinking")return{chunk:new xn({content:e.coerceContentToString?"":[{index:n.index,...n.content_block}]})};if(n.type==="content_block_start"&&n.content_block.type==="thinking"){const r=n.content_block.thinking;return{chunk:new xn({content:e.coerceContentToString?r:[{index:n.index,...n.content_block}]})}}}}return null}function qfe(n,e){const t=e.usage,r=t!=null?{input_tokens:t.input_tokens??0,output_tokens:t.output_tokens??0,total_tokens:(t.input_tokens??0)+(t.output_tokens??0),input_token_details:{cache_creation:t.cache_creation_input_tokens,cache_read:t.cache_read_input_tokens}}:void 0;if(n.length===1&&n[0].type==="text")return[{text:n[0].text,message:new Tn({content:n[0].text,additional_kwargs:e,usage_metadata:r,response_metadata:e,id:e.id})}];{const i=t8(n);return[{text:"",message:new Tn({content:n,additional_kwargs:e,tool_calls:i,usage_metadata:r,response_metadata:e,id:e.id})}]}}function vv(n,e){return n.lc_error_code=e,n.message=`${n.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,n}function V2(n){let e;return n.status===400&&n.message.includes("tool")?e=vv(n,"INVALID_TOOL_RESULTS"):n.status===401?e=vv(n,"MODEL_AUTHENTICATION"):n.status===404?e=vv(n,"MODEL_NOT_FOUND"):n.status===429?e=vv(n,"MODEL_RATE_LIMIT"):e=n,e}function Vfe(n){return!!(n.tools&&n.tools.length>0)}function zfe(n){for(const e of n.messages??[])if(typeof e.content!="string"){for(const t of e.content??[])if(typeof t=="object"&&t!=null&&t.type==="document"&&typeof t.citations=="object"&&t.citations.enabled)return!0}return!1}function Hfe(n){return!!(n.thinking&&n.thinking.type==="enabled")}function Gfe(n){return"input_schema"in n}function Wfe(n){const e=["web_search"];return typeof n=="object"&&n!==null&&"type"in n&&"name"in n&&typeof n.type=="string"&&typeof n.name=="string"&&e.includes(n.name)}function Kfe(n){if(typeof n.content=="string")return n.content;if(Array.isArray(n.content)&&n.content.length>=1&&"input"in n.content[0])return typeof n.content[0].input=="string"?n.content[0].input:JSON.stringify(n.content[0].input);if(Array.isArray(n.content)&&n.content.length>=1&&"text"in n.content[0])return n.content[0].text}class Jfe extends yi{static lc_name(){return"ChatAnthropic"}get lc_secrets(){return{anthropicApiKey:"ANTHROPIC_API_KEY",apiKey:"ANTHROPIC_API_KEY"}}get lc_aliases(){return{modelName:"model"}}constructor(e){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"anthropicApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:2048}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"claude-2.1"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"claude-2.1"}),Object.defineProperty(this,"invocationKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"clientOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"thinking",{enumerable:!0,configurable:!0,writable:!0,value:{type:"disabled"}}),Object.defineProperty(this,"batchClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamingClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"createClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.anthropicApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.anthropicApiKey)??zi("ANTHROPIC_API_KEY"),!this.anthropicApiKey&&!(e!=null&&e.createClient))throw new Error("Anthropic API key not found");this.clientOptions=(e==null?void 0:e.clientOptions)??{},this.apiKey=this.anthropicApiKey,this.apiUrl=e==null?void 0:e.anthropicApiUrl,this.modelName=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.model=this.modelName,this.invocationKwargs=(e==null?void 0:e.invocationKwargs)??{},this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topK=(e==null?void 0:e.topK)??this.topK,this.topP=(e==null?void 0:e.topP)??this.topP,this.maxTokens=(e==null?void 0:e.maxTokensToSample)??(e==null?void 0:e.maxTokens)??this.maxTokens,this.stopSequences=(e==null?void 0:e.stopSequences)??this.stopSequences,this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.thinking=(e==null?void 0:e.thinking)??this.thinking,this.createClient=(e==null?void 0:e.createClient)??(t=>new kc(t))}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"anthropic",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}formatStructuredToolToAnthropic(e){if(!(!e||!e.length))return e.map(t=>{if(Wfe(t)||Gfe(t))return t;if(Fd(t))return{name:t.function.name,description:t.function.description,input_schema:t.function.parameters};if(Pc(t))return{name:t.name,description:t.description,input_schema:Ui(t.schema)?Tr(t.schema):t.schema};throw new Error(`Unknown tool type passed to ChatAnthropic: ${JSON.stringify(t,null,2)}`)})}bindTools(e,t){return this.withConfig({tools:this.formatStructuredToolToAnthropic(e),...t})}invocationParams(e){const t=$fe(e==null?void 0:e.tool_choice);if(this.thinking.type==="enabled"){if(this.topK!==-1)throw new Error("topK is not supported when thinking is enabled");if(this.topP!==-1)throw new Error("topP is not supported when thinking is enabled");if(this.temperature!==1)throw new Error("temperature is not supported when thinking is enabled");return{model:this.model,stop_sequences:(e==null?void 0:e.stop)??this.stopSequences,stream:this.streaming,max_tokens:this.maxTokens,tools:this.formatStructuredToolToAnthropic(e==null?void 0:e.tools),tool_choice:t,thinking:this.thinking,...this.invocationKwargs}}return{model:this.model,temperature:this.temperature,top_k:this.topK,top_p:this.topP,stop_sequences:(e==null?void 0:e.stop)??this.stopSequences,stream:this.streaming,max_tokens:this.maxTokens,tools:this.formatStructuredToolToAnthropic(e==null?void 0:e.tools),tool_choice:t,thinking:this.thinking,...this.invocationKwargs}}_identifyingParams(){return{model_name:this.model,...this.invocationParams()}}identifyingParams(){return{model_name:this.model,...this.invocationParams()}}async*_streamResponseChunks(e,t,r){var c;const i=this.invocationParams(t),a=q2(e),s={...i,...a,stream:!0},o=!Vfe(s)&&!zfe(s)&&!Hfe(s),u=await this.createStreamWithRetry(s,{headers:t.headers});for await(const d of u){if((c=t.signal)!=null&&c.aborted)throw u.controller.abort(),new Error("AbortError: User aborted the request.");const h=this.streamUsage??t.streamUsage,m=Bfe(d,{streamUsage:h,coerceContentToString:o});if(!m)continue;const{chunk:g}=m,_=Kfe(g),w=new Sa({message:new xn({content:g.content,additional_kwargs:g.additional_kwargs,tool_call_chunks:g.tool_call_chunks,usage_metadata:h?g.usage_metadata:void 0,response_metadata:g.response_metadata,id:g.id}),text:_??""});yield w,await(r==null?void 0:r.handleLLMNewToken(_??"",void 0,void 0,void 0,void 0,{chunk:w}))}}async _generateNonStreaming(e,t,r){const i=await this.completionWithRetry({...t,stream:!1,...q2(e)},r),{content:a,...s}=i,o=qfe(a,s),{role:u,type:c,...d}=s;return{generations:o,llmOutput:d}}async _generate(e,t,r){if(this.stopSequences&&t.stop)throw new Error('"stopSequence" parameter found in input and default params');const i=this.invocationParams(t);if(i.stream){let a;const s=this._streamResponseChunks(e,t,r);for await(const o of s)a===void 0?a=o:a=a.concat(o);if(a===void 0)throw new Error("No chunks returned from Anthropic API.");return{generations:[{text:a.text,message:a.message}]}}else return this._generateNonStreaming(e,i,{signal:t.signal,headers:t.headers})}async createStreamWithRetry(e,t){if(!this.streamingClient){const i=this.apiUrl?{baseURL:this.apiUrl}:void 0;this.streamingClient=this.createClient({dangerouslyAllowBrowser:!0,...this.clientOptions,...i,apiKey:this.apiKey,maxRetries:0})}const r=async()=>{try{return await this.streamingClient.messages.create({...e,...this.invocationKwargs,stream:!0},t)}catch(i){throw V2(i)}};return this.caller.call(r)}async completionWithRetry(e,t){if(!this.batchClient){const i=this.apiUrl?{baseURL:this.apiUrl}:void 0;this.batchClient=this.createClient({dangerouslyAllowBrowser:!0,...this.clientOptions,...i,apiKey:this.apiKey,maxRetries:0})}const r=async()=>{try{return await this.batchClient.messages.create({...e,...this.invocationKwargs},t)}catch(i){throw V2(i)}};return this.caller.callWithOptions({signal:t.signal??void 0},r)}_llmType(){return"anthropic"}withStructuredOutput(e,t){var _;const r=e,i=t==null?void 0:t.name,a=t==null?void 0:t.method,s=t==null?void 0:t.includeRaw;if(a==="jsonMode")throw new Error('Anthropic only supports "functionCalling" as a method.');let o=i??"extract",u,c;if(Ui(r)){const w=Tr(r);c=[{name:o,description:w.description??"A function available to call.",input_schema:w}],u=new j2({returnSingle:!0,keyName:o,zodSchema:r})}else{let w;typeof r.name=="string"&&typeof r.description=="string"&&typeof r.input_schema=="object"&&r.input_schema!=null?(w=r,o=r.name):w={name:o,description:r.description??"",input_schema:r},c=[w],u=new j2({returnSingle:!0,keyName:o})}let d;if(((_=this.thinking)==null?void 0:_.type)==="enabled"){const w="Anthropic structured output relies on forced tool calling, which is not supported when `thinking` is enabled. This method will raise OutputParserException if tool calls are not generated. Consider disabling `thinking` or adjust your prompt to ensure the tool is called.";console.warn(w),d=this.withConfig({tools:c,ls_structured_output_format:{kwargs:{method:"functionCalling"},schema:Tr(r)}});const S=E=>{if(!E.tool_calls||E.tool_calls.length===0)throw new Error(w);return E};d=d.pipe(S)}else d=this.withConfig({tools:c,tool_choice:{type:"tool",name:o},ls_structured_output_format:{kwargs:{method:"functionCalling"},schema:Tr(r)}});if(!s)return d.pipe(u).withConfig({runName:"ChatAnthropicStructuredOutput"});const h=Ps.assign({parsed:(w,S)=>u.invoke(w.raw,S)}),m=Ps.assign({parsed:()=>null}),g=h.withFallbacks({fallbacks:[m]});return Ar.from([{raw:d},g]).withConfig({runName:"StructuredOutputRunnable"})}}class Yfe extends Jfe{}var z2;(function(n){n.STRING="string",n.NUMBER="number",n.INTEGER="integer",n.BOOLEAN="boolean",n.ARRAY="array",n.OBJECT="object"})(z2||(z2={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var H2;(function(n){n.LANGUAGE_UNSPECIFIED="language_unspecified",n.PYTHON="python"})(H2||(H2={}));var G2;(function(n){n.OUTCOME_UNSPECIFIED="outcome_unspecified",n.OUTCOME_OK="outcome_ok",n.OUTCOME_FAILED="outcome_failed",n.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(G2||(G2={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W2=["user","model","function","system"];var K2;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(K2||(K2={}));var J2;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(J2||(J2={}));var Y2;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(Y2||(Y2={}));var Z2;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER"})(Z2||(Z2={}));var Yp;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.OTHER="OTHER"})(Yp||(Yp={}));var X2;(function(n){n.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",n.RETRIEVAL_QUERY="RETRIEVAL_QUERY",n.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",n.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",n.CLASSIFICATION="CLASSIFICATION",n.CLUSTERING="CLUSTERING"})(X2||(X2={}));var Xf;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(Xf||(Xf={}));var Q2;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(Q2||(Q2={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ai extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class If extends ai{constructor(e,t){super(e),this.response=t}}class n8 extends ai{constructor(e,t,r,i){super(e),this.status=t,this.statusText=r,this.errorDetails=i}}class Yl extends ai{}class r8 extends ai{}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Zfe="https://generativelanguage.googleapis.com",Xfe="v1beta",Qfe="0.24.1",ede="genai-js";var pc;(function(n){n.GENERATE_CONTENT="generateContent",n.STREAM_GENERATE_CONTENT="streamGenerateContent",n.COUNT_TOKENS="countTokens",n.EMBED_CONTENT="embedContent",n.BATCH_EMBED_CONTENTS="batchEmbedContents"})(pc||(pc={}));class tde{constructor(e,t,r,i,a){this.model=e,this.task=t,this.apiKey=r,this.stream=i,this.requestOptions=a}toString(){var e,t;const r=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||Xfe;let a=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||Zfe}/${r}/${this.model}:${this.task}`;return this.stream&&(a+="?alt=sse"),a}}function nde(n){const e=[];return n!=null&&n.apiClient&&e.push(n.apiClient),e.push(`${ede}/${Qfe}`),e.join(" ")}async function rde(n){var e;const t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",nde(n.requestOptions)),t.append("x-goog-api-key",n.apiKey);let r=(e=n.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(r){if(!(r instanceof Headers))try{r=new Headers(r)}catch(i){throw new Yl(`unable to convert customHeaders value ${JSON.stringify(r)} to Headers: ${i.message}`)}for(const[i,a]of r.entries()){if(i==="x-goog-api-key")throw new Yl(`Cannot set reserved header name ${i}`);if(i==="x-goog-api-client")throw new Yl(`Header name ${i} can only be set using the apiClient field`);t.append(i,a)}}return t}async function ide(n,e,t,r,i,a){const s=new tde(n,e,t,r,a);return{url:s.toString(),fetchOptions:Object.assign(Object.assign({},lde(a)),{method:"POST",headers:await rde(s),body:i})}}async function lg(n,e,t,r,i,a={},s=fetch){const{url:o,fetchOptions:u}=await ide(n,e,t,r,i,a);return ade(o,u,s)}async function ade(n,e,t=fetch){let r;try{r=await t(n,e)}catch(i){sde(i,n)}return r.ok||await ode(r,n),r}function sde(n,e){let t=n;throw t.name==="AbortError"?(t=new r8(`Request aborted when fetching ${e.toString()}: ${n.message}`),t.stack=n.stack):n instanceof n8||n instanceof Yl||(t=new ai(`Error fetching from ${e.toString()}: ${n.message}`),t.stack=n.stack),t}async function ode(n,e){let t="",r;try{const i=await n.json();t=i.error.message,i.error.details&&(t+=` ${JSON.stringify(i.error.details)}`,r=i.error.details)}catch{}throw new n8(`Error fetching from ${e.toString()}: [${n.status} ${n.statusText}] ${t}`,n.status,n.statusText,r)}function lde(n){const e={};if((n==null?void 0:n.signal)!==void 0||(n==null?void 0:n.timeout)>=0){const t=new AbortController;(n==null?void 0:n.timeout)>=0&&setTimeout(()=>t.abort(),n.timeout),n!=null&&n.signal&&n.signal.addEventListener("abort",()=>{t.abort()}),e.signal=t.signal}return e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $P(n){return n.text=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),Jv(n.candidates[0]))throw new If(`${Fl(n)}`,n);return ude(n)}else if(n.promptFeedback)throw new If(`Text not available. ${Fl(n)}`,n);return""},n.functionCall=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Jv(n.candidates[0]))throw new If(`${Fl(n)}`,n);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),eF(n)[0]}else if(n.promptFeedback)throw new If(`Function call not available. ${Fl(n)}`,n)},n.functionCalls=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),Jv(n.candidates[0]))throw new If(`${Fl(n)}`,n);return eF(n)}else if(n.promptFeedback)throw new If(`Function call not available. ${Fl(n)}`,n)},n}function ude(n){var e,t,r,i;const a=[];if(!((t=(e=n.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const s of(i=(r=n.candidates)===null||r===void 0?void 0:r[0].content)===null||i===void 0?void 0:i.parts)s.text&&a.push(s.text),s.executableCode&&a.push("\n```"+s.executableCode.language+`
`+s.executableCode.code+"\n```\n"),s.codeExecutionResult&&a.push("\n```\n"+s.codeExecutionResult.output+"\n```\n");return a.length>0?a.join(""):""}function eF(n){var e,t,r,i;const a=[];if(!((t=(e=n.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const s of(i=(r=n.candidates)===null||r===void 0?void 0:r[0].content)===null||i===void 0?void 0:i.parts)s.functionCall&&a.push(s.functionCall);if(a.length>0)return a}const cde=[Yp.RECITATION,Yp.SAFETY,Yp.LANGUAGE];function Jv(n){return!!n.finishReason&&cde.includes(n.finishReason)}function Fl(n){var e,t,r;let i="";if((!n.candidates||n.candidates.length===0)&&n.promptFeedback)i+="Response was blocked",!((e=n.promptFeedback)===null||e===void 0)&&e.blockReason&&(i+=` due to ${n.promptFeedback.blockReason}`),!((t=n.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(i+=`: ${n.promptFeedback.blockReasonMessage}`);else if(!((r=n.candidates)===null||r===void 0)&&r[0]){const a=n.candidates[0];Jv(a)&&(i+=`Candidate was blocked due to ${a.finishReason}`,a.finishMessage&&(i+=`: ${a.finishMessage}`))}return i}function bm(n){return this instanceof bm?(this.v=n,this):new bm(n)}function fde(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,a=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(m){r[m]&&(i[m]=function(g){return new Promise(function(_,w){a.push([m,g,_,w])>1||o(m,g)})})}function o(m,g){try{u(r[m](g))}catch(_){h(a[0][3],_)}}function u(m){m.value instanceof bm?Promise.resolve(m.value.v).then(c,d):h(a[0][2],m)}function c(m){o("next",m)}function d(m){o("throw",m)}function h(m,g){m(g),a.shift(),a.length&&o(a[0][0],a[0][1])}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tF=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function dde(n){const e=n.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=mde(e),[r,i]=t.tee();return{stream:pde(r),response:hde(i)}}async function hde(n){const e=[],t=n.getReader();for(;;){const{done:r,value:i}=await t.read();if(r)return $P(gde(e));e.push(i)}}function pde(n){return fde(this,arguments,function*(){const t=n.getReader();for(;;){const{value:r,done:i}=yield bm(t.read());if(i)break;yield yield bm($P(r))}})}function mde(n){const e=n.getReader();return new ReadableStream({start(r){let i="";return a();function a(){return e.read().then(({value:s,done:o})=>{if(o){if(i.trim()){r.error(new ai("Failed to parse stream"));return}r.close();return}i+=s;let u=i.match(tF),c;for(;u;){try{c=JSON.parse(u[1])}catch{r.error(new ai(`Error parsing JSON response: "${u[1]}"`));return}r.enqueue(c),i=i.substring(u[0].length),u=i.match(tF)}return a()}).catch(s=>{let o=s;throw o.stack=s.stack,o.name==="AbortError"?o=new r8("Request aborted when reading from the stream"):o=new ai("Error reading from the stream"),o})}}})}function gde(n){const e=n[n.length-1],t={promptFeedback:e==null?void 0:e.promptFeedback};for(const r of n){if(r.candidates){let i=0;for(const a of r.candidates)if(t.candidates||(t.candidates=[]),t.candidates[i]||(t.candidates[i]={index:i}),t.candidates[i].citationMetadata=a.citationMetadata,t.candidates[i].groundingMetadata=a.groundingMetadata,t.candidates[i].finishReason=a.finishReason,t.candidates[i].finishMessage=a.finishMessage,t.candidates[i].safetyRatings=a.safetyRatings,a.content&&a.content.parts){t.candidates[i].content||(t.candidates[i].content={role:a.content.role||"user",parts:[]});const s={};for(const o of a.content.parts)o.text&&(s.text=o.text),o.functionCall&&(s.functionCall=o.functionCall),o.executableCode&&(s.executableCode=o.executableCode),o.codeExecutionResult&&(s.codeExecutionResult=o.codeExecutionResult),Object.keys(s).length===0&&(s.text=""),t.candidates[i].content.parts.push(s)}i++}r.usageMetadata&&(t.usageMetadata=r.usageMetadata)}return t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function i8(n,e,t,r){const i=await lg(e,pc.STREAM_GENERATE_CONTENT,n,!0,JSON.stringify(t),r);return dde(i)}async function a8(n,e,t,r){const a=await(await lg(e,pc.GENERATE_CONTENT,n,!1,JSON.stringify(t),r)).json();return{response:$P(a)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function s8(n){if(n!=null){if(typeof n=="string")return{role:"system",parts:[{text:n}]};if(n.text)return{role:"system",parts:[n]};if(n.parts)return n.role?n:{role:"system",parts:n.parts}}}function wm(n){let e=[];if(typeof n=="string")e=[{text:n}];else for(const t of n)typeof t=="string"?e.push({text:t}):e.push(t);return yde(e)}function yde(n){const e={role:"user",parts:[]},t={role:"function",parts:[]};let r=!1,i=!1;for(const a of n)"functionResponse"in a?(t.parts.push(a),i=!0):(e.parts.push(a),r=!0);if(r&&i)throw new ai("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!r&&!i)throw new ai("No content is provided for sending chat message.");return r?e:t}function vde(n,e){var t;let r={model:e==null?void 0:e.model,generationConfig:e==null?void 0:e.generationConfig,safetySettings:e==null?void 0:e.safetySettings,tools:e==null?void 0:e.tools,toolConfig:e==null?void 0:e.toolConfig,systemInstruction:e==null?void 0:e.systemInstruction,cachedContent:(t=e==null?void 0:e.cachedContent)===null||t===void 0?void 0:t.name,contents:[]};const i=n.generateContentRequest!=null;if(n.contents){if(i)throw new Yl("CountTokensRequest must have one of contents or generateContentRequest, not both.");r.contents=n.contents}else if(i)r=Object.assign(Object.assign({},r),n.generateContentRequest);else{const a=wm(n);r.contents=[a]}return{generateContentRequest:r}}function nF(n){let e;return n.contents?e=n:e={contents:[wm(n)]},n.systemInstruction&&(e.systemInstruction=s8(n.systemInstruction)),e}function _de(n){return typeof n=="string"||Array.isArray(n)?{content:wm(n)}:n}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const rF=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],bde={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function wde(n){let e=!1;for(const t of n){const{role:r,parts:i}=t;if(!e&&r!=="user")throw new ai(`First content should be with role 'user', got ${r}`);if(!W2.includes(r))throw new ai(`Each item should include role field. Got ${r} but valid roles are: ${JSON.stringify(W2)}`);if(!Array.isArray(i))throw new ai("Content should have 'parts' property with an array of Parts");if(i.length===0)throw new ai("Each Content should have at least one part");const a={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const o of i)for(const u of rF)u in o&&(a[u]+=1);const s=bde[r];for(const o of rF)if(!s.includes(o)&&a[o]>0)throw new ai(`Content with role '${r}' can't contain '${o}' part`);e=!0}}function iF(n){var e;if(n.candidates===void 0||n.candidates.length===0)return!1;const t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;if(t===void 0||t.parts===void 0||t.parts.length===0)return!1;for(const r of t.parts)if(r===void 0||Object.keys(r).length===0||r.text!==void 0&&r.text==="")return!1;return!0}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aF="SILENT_ERROR";class Ede{constructor(e,t,r,i={}){this.model=t,this.params=r,this._requestOptions=i,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,r!=null&&r.history&&(wde(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var r,i,a,s,o,u;await this._sendPromise;const c=wm(e),d={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(s=this.params)===null||s===void 0?void 0:s.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,cachedContent:(u=this.params)===null||u===void 0?void 0:u.cachedContent,contents:[...this._history,c]},h=Object.assign(Object.assign({},this._requestOptions),t);let m;return this._sendPromise=this._sendPromise.then(()=>a8(this._apiKey,this.model,d,h)).then(g=>{var _;if(iF(g.response)){this._history.push(c);const w=Object.assign({parts:[],role:"model"},(_=g.response.candidates)===null||_===void 0?void 0:_[0].content);this._history.push(w)}else{const w=Fl(g.response);w&&console.warn(`sendMessage() was unsuccessful. ${w}. Inspect response object for details.`)}m=g}).catch(g=>{throw this._sendPromise=Promise.resolve(),g}),await this._sendPromise,m}async sendMessageStream(e,t={}){var r,i,a,s,o,u;await this._sendPromise;const c=wm(e),d={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(s=this.params)===null||s===void 0?void 0:s.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,cachedContent:(u=this.params)===null||u===void 0?void 0:u.cachedContent,contents:[...this._history,c]},h=Object.assign(Object.assign({},this._requestOptions),t),m=i8(this._apiKey,this.model,d,h);return this._sendPromise=this._sendPromise.then(()=>m).catch(g=>{throw new Error(aF)}).then(g=>g.response).then(g=>{if(iF(g)){this._history.push(c);const _=Object.assign({},g.candidates[0].content);_.role||(_.role="model"),this._history.push(_)}else{const _=Fl(g);_&&console.warn(`sendMessageStream() was unsuccessful. ${_}. Inspect response object for details.`)}}).catch(g=>{g.message!==aF&&console.error(g)}),m}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Sde(n,e,t,r){return(await lg(e,pc.COUNT_TOKENS,n,!1,JSON.stringify(t),r)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tde(n,e,t,r){return(await lg(e,pc.EMBED_CONTENT,n,!1,JSON.stringify(t),r)).json()}async function Ade(n,e,t,r){const i=t.requests.map(s=>Object.assign(Object.assign({},s),{model:e}));return(await lg(e,pc.BATCH_EMBED_CONTENTS,n,!1,JSON.stringify({requests:i}),r)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sF{constructor(e,t,r={}){this.apiKey=e,this._requestOptions=r,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=s8(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var r;const i=nF(e),a=Object.assign(Object.assign({},this._requestOptions),t);return a8(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},i),a)}async generateContentStream(e,t={}){var r;const i=nF(e),a=Object.assign(Object.assign({},this._requestOptions),t);return i8(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},i),a)}startChat(e){var t;return new Ede(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){const r=vde(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),i=Object.assign(Object.assign({},this._requestOptions),t);return Sde(this.apiKey,this.model,r,i)}async embedContent(e,t={}){const r=_de(e),i=Object.assign(Object.assign({},this._requestOptions),t);return Tde(this.apiKey,this.model,r,i)}async batchEmbedContents(e,t={}){const r=Object.assign(Object.assign({},this._requestOptions),t);return Ade(this.apiKey,this.model,e,r)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class oF{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new ai("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new sF(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,r){if(!e.name)throw new Yl("Cached content must contain a `name` field.");if(!e.model)throw new Yl("Cached content must contain a `model` field.");const i=["model","systemInstruction"];for(const s of i)if(t!=null&&t[s]&&e[s]&&(t==null?void 0:t[s])!==e[s]){if(s==="model"){const o=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,u=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(o===u)continue}throw new Yl(`Different value for "${s}" specified in modelParams (${t[s]}) and cachedContent (${e[s]})`)}const a=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new sF(this.apiKey,a,r)}}function mc(n){if(typeof n=="object"&&n!==null){const e={...n};"additionalProperties"in e&&delete e.additionalProperties,"$schema"in e&&delete e.$schema,"strict"in e&&delete e.strict;for(const t in e)t in e&&(Array.isArray(e[t])?e[t]=e[t].map(mc):typeof e[t]=="object"&&e[t]!==null&&(e[t]=mc(e[t])));return e}return n}function fR(n){const e=mc(Ui(n)?Tr(n):n),{$schema:t,...r}=e;return r}function Cde(n){const e=mc(n),{$schema:t,...r}=e;return r}const zr=[];for(let n=0;n<256;++n)zr.push((n+256).toString(16).slice(1));function xde(n,e=0){return(zr[n[e+0]]+zr[n[e+1]]+zr[n[e+2]]+zr[n[e+3]]+"-"+zr[n[e+4]]+zr[n[e+5]]+"-"+zr[n[e+6]]+zr[n[e+7]]+"-"+zr[n[e+8]]+zr[n[e+9]]+"-"+zr[n[e+10]]+zr[n[e+11]]+zr[n[e+12]]+zr[n[e+13]]+zr[n[e+14]]+zr[n[e+15]]).toLowerCase()}let lC;const Rde=new Uint8Array(16);function Ide(){if(!lC){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");lC=crypto.getRandomValues.bind(crypto)}return lC(Rde)}const Pde=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),lF={randomUUID:Pde};function o8(n,e,t){var i;if(lF.randomUUID&&!n)return lF.randomUUID();n=n||{};const r=n.random??((i=n.rng)==null?void 0:i.call(n))??Ide();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,xde(r)}function Ode(n){const e=n._getType();return Xa.isInstance(n)?n.role:e==="tool"?e:n.name??e}function kde(n){switch(n){case"supervisor":case"ai":case"model":return"model";case"system":return"system";case"human":return"user";case"tool":case"function":return"function";default:throw new Error(`Unknown / unsupported author: ${n}`)}}function Nde(n){if("mimeType"in n&&"data"in n)return{inlineData:{mimeType:n.mimeType,data:n.data}};if("mimeType"in n&&"fileUri"in n)return{fileData:{mimeType:n.mimeType,fileUri:n.fileUri}};throw new Error("Invalid media content")}function Mde(n,e){var t;return(t=e.map(r=>Ea(r)?r.tool_calls??[]:[]).flat().find(r=>r.id===n.tool_call_id))==null?void 0:t.name}function Dde(n){return{providerName:"Google Gemini",fromStandardTextBlock(t){return{text:t.text}},fromStandardImageBlock(t){if(!n)throw new Error("This model does not support images");if(t.source_type==="url"){const r=Kl({dataUrl:t.url});return r?{inlineData:{mimeType:r.mime_type,data:r.data}}:{fileData:{mimeType:t.mime_type??"",fileUri:t.url}}}if(t.source_type==="base64")return{inlineData:{mimeType:t.mime_type??"",data:t.data}};throw new Error(`Unsupported source type: ${t.source_type}`)},fromStandardAudioBlock(t){if(!n)throw new Error("This model does not support audio");if(t.source_type==="url"){const r=Kl({dataUrl:t.url});return r?{inlineData:{mimeType:r.mime_type,data:r.data}}:{fileData:{mimeType:t.mime_type??"",fileUri:t.url}}}if(t.source_type==="base64")return{inlineData:{mimeType:t.mime_type??"",data:t.data}};throw new Error(`Unsupported source type: ${t.source_type}`)},fromStandardFileBlock(t){if(!n)throw new Error("This model does not support files");if(t.source_type==="text")return{text:t.text};if(t.source_type==="url"){const r=Kl({dataUrl:t.url});return r?{inlineData:{mimeType:r.mime_type,data:r.data}}:{fileData:{mimeType:t.mime_type??"",fileUri:t.url}}}if(t.source_type==="base64")return{inlineData:{mimeType:t.mime_type??"",data:t.data}};throw new Error(`Unsupported source type: ${t.source_type}`)}}}function uF(n,e){var t;if(Ja(n))return jm(n,Dde(e));if(n.type==="text")return{text:n.text};if(n.type==="executableCode")return{executableCode:n.executableCode};if(n.type==="codeExecutionResult")return{codeExecutionResult:n.codeExecutionResult};if(n.type==="image_url"){if(!e)throw new Error("This model does not support images");let r;if(typeof n.image_url=="string")r=n.image_url;else if(typeof n.image_url=="object"&&"url"in n.image_url)r=n.image_url.url;else throw new Error("Please provide image as base64 encoded data URL");const[i,a]=r.split(",");if(!i.startsWith("data:"))throw new Error("Please provide image as base64 encoded data URL");const[s,o]=i.replace(/^data:/,"").split(";");if(o!=="base64")throw new Error("Please provide image as base64 encoded data URL");return{inlineData:{data:a,mimeType:s}}}else{if(n.type==="media")return Nde(n);if(n.type==="tool_use")return{functionCall:{name:n.name,args:n.input}};if((t=n.type)!=null&&t.includes("/")&&n.type.split("/").length===2&&"data"in n&&typeof n.data=="string")return{inlineData:{mimeType:n.type,data:n.data}};if("functionCall"in n)return;throw"type"in n?new Error(`Unknown content type ${n.type}`):new Error(`Unknown content ${JSON.stringify(n)}`)}}function $de(n,e,t){var a;if(um(n)){const s=n.name??Mde(n,t);if(s===void 0)throw new Error(`Google requires a tool name for each tool call response, and we could not infer a called tool name for ToolMessage "${n.id}" from your passed messages. Please populate a "name" field on that ToolMessage explicitly.`);const o=Array.isArray(n.content)?n.content.map(u=>uF(u,e)).filter(u=>u!==void 0):n.content;return n.status==="error"?[{functionResponse:{name:s,response:{error:{details:o}}}}]:[{functionResponse:{name:s,response:{result:o}}}]}let r=[];const i=[];return typeof n.content=="string"&&n.content&&i.push({text:n.content}),Array.isArray(n.content)&&i.push(...n.content.map(s=>uF(s,e)).filter(s=>s!==void 0)),Ea(n)&&((a=n.tool_calls)!=null&&a.length)&&(r=n.tool_calls.map(s=>({functionCall:{name:s.name,args:s.args}}))),[...i,...r]}function cF(n,e,t=!1){return n.reduce((r,i,a)=>{if(!Vn(i))throw new Error("Unsupported message input");const s=Ode(i);if(s==="system"&&a!==0)throw new Error("System message should be the first one");const o=kde(s),u=r.content[r.content.length];if(!r.mergeWithPreviousContent&&u&&u.role===o)throw new Error("Google Generative AI requires alternate messages between authors");const c=$de(i,e,n.slice(0,a));if(r.mergeWithPreviousContent){const m=r.content[r.content.length-1];if(!m)throw new Error("There was a problem parsing your system message. Please try a prompt without one.");return m.parts.push(...c),{mergeWithPreviousContent:!1,content:r.content}}let d=o;(d==="function"||d==="system"&&!t)&&(d="user");const h={role:d,parts:c};return{mergeWithPreviousContent:s==="system"&&!t,content:[...r.content,h]}},{content:[],mergeWithPreviousContent:!1}).content}function Lde(n,e){var c,d,h;if(!n.candidates||n.candidates.length===0||!n.candidates[0])return{generations:[],llmOutput:{filters:n.promptFeedback}};const t=n.functionCalls(),[r]=n.candidates,{content:i,...a}=r;let s;Array.isArray(i==null?void 0:i.parts)&&i.parts.length===1&&i.parts[0].text?s=i.parts[0].text:Array.isArray(i==null?void 0:i.parts)&&i.parts.length>0?s=i.parts.map(m=>"text"in m?{type:"text",text:m.text}:"executableCode"in m?{type:"executableCode",executableCode:m.executableCode}:"codeExecutionResult"in m?{type:"codeExecutionResult",codeExecutionResult:m.codeExecutionResult}:m):s=[];let o="";if(typeof s=="string")o=s;else if(Array.isArray(s)&&s.length>0){const m=s.find(g=>"text"in g);o=(m==null?void 0:m.text)??o}return{generations:[{text:o,message:new Tn({content:s??"",tool_calls:t==null?void 0:t.map(m=>({...m,type:"tool_call",id:"id"in m&&typeof m.id=="string"?m.id:o8()})),additional_kwargs:{...a},usage_metadata:e==null?void 0:e.usageMetadata}),generationInfo:a}],llmOutput:{tokenUsage:{promptTokens:(c=e==null?void 0:e.usageMetadata)==null?void 0:c.input_tokens,completionTokens:(d=e==null?void 0:e.usageMetadata)==null?void 0:d.output_tokens,totalTokens:(h=e==null?void 0:e.usageMetadata)==null?void 0:h.total_tokens}}}}function Ude(n,e){if(!n.candidates||n.candidates.length===0)return null;const t=n.functionCalls(),[r]=n.candidates,{content:i,...a}=r;let s;Array.isArray(i==null?void 0:i.parts)&&i.parts.every(c=>"text"in c)?s=i.parts.map(c=>c.text).join(""):Array.isArray(i==null?void 0:i.parts)?s=i.parts.map(c=>"text"in c?{type:"text",text:c.text}:"executableCode"in c?{type:"executableCode",executableCode:c.executableCode}:"codeExecutionResult"in c?{type:"codeExecutionResult",codeExecutionResult:c.codeExecutionResult}:c):s=[];let o="";if(s&&typeof s=="string")o=s;else if(Array.isArray(s)){const c=s.find(d=>"text"in d);o=(c==null?void 0:c.text)??""}const u=[];return t&&u.push(...t.map(c=>({...c,args:JSON.stringify(c.args),index:e.index,type:"tool_call_chunk",id:"id"in c&&typeof c.id=="string"?c.id:o8()}))),new Sa({text:o,message:new xn({content:s||"",name:i?i.role:void 0,tool_call_chunks:u,additional_kwargs:{},usage_metadata:e.usageMetadata}),generationInfo:a})}function jde(n){return n.every(e=>"functionDeclarations"in e&&Array.isArray(e.functionDeclarations))?n:[{functionDeclarations:n.map(e=>{if(Pc(e)){const t=fR(e.schema);return t.type==="object"&&"properties"in t&&Object.keys(t.properties).length===0?{name:e.name,description:e.description}:{name:e.name,description:e.description,parameters:t}}return Fd(e)?{name:e.function.name,description:e.function.description??"A function available to call.",parameters:Cde(e.function.parameters)}:e})}]}class fF extends ow{static lc_name(){return"GoogleGenerativeAIToolsOutputParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","google_genai","output_parsers"]}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;const t=await $b(this.zodSchema,e);if(t.success)return t.data;throw new Ga(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.issues)}`,JSON.stringify(e,null,2))}async parseResult(e){const t=e.flatMap(a=>{const{message:s}=a;return!("tool_calls"in s)||!Array.isArray(s.tool_calls)?[]:s.tool_calls});if(t[0]===void 0)throw new Error("No parseable tool calls provided to GoogleGenerativeAIToolsOutputParser.");const[r]=t;return await this._validateResult(r.args)}}function dF(n,e){const t=Fde(n),r=qde(t,e);return{tools:t,toolConfig:r}}function Fde(n){let e=[];const t=[];return n.forEach(i=>{if(Pc(i)){const[a]=jde([i]);a.functionDeclarations&&e.push(...a.functionDeclarations)}else if(Fd(i)){const{functionDeclarations:a}=Bde(i);if(a)e.push(...a);else throw new Error("Failed to convert OpenAI structured tool to GenerativeAI tool")}else t.push(i)}),t.find(i=>"functionDeclarations"in i)?t.map(i=>{if((e==null?void 0:e.length)>0&&"functionDeclarations"in i){const a={functionDeclarations:[...i.functionDeclarations||[],...e]};return e=[],a}return i}):[...t,...e.length>0?[{functionDeclarations:e}]:[]]}function Bde(n){return{functionDeclarations:[{name:n.function.name,description:n.function.description,parameters:mc(n.function.parameters)}]}}function qde(n,e){if(!n.length||!e)return;const{toolChoice:t,allowedFunctionNames:r}=e,i={any:Xf.ANY,auto:Xf.AUTO,none:Xf.NONE};if(t&&["any","auto","none"].includes(t))return{functionCallingConfig:{mode:i[t]??"MODE_UNSPECIFIED",allowedFunctionNames:r}};if(typeof t=="string"||r)return{functionCallingConfig:{mode:Xf.ANY,allowedFunctionNames:[...r??[],...t&&typeof t=="string"?[t]:[]]}}}class Vde extends yi{static lc_name(){return"ChatGoogleGenerativeAI"}get lc_secrets(){return{apiKey:"GOOGLE_API_KEY"}}get lc_aliases(){return{apiKey:"google_api_key"}}get _isMultimodalModel(){return this.model.includes("vision")||this.model.startsWith("gemini-1.5")||this.model.startsWith("gemini-2")}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models","google_genai"]}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxOutputTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"safetySettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"json",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"convertSystemMessageToHumanContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.model=e.model.replace(/^models\//,""),this.maxOutputTokens=e.maxOutputTokens??this.maxOutputTokens,this.maxOutputTokens&&this.maxOutputTokens<0)throw new Error("`maxOutputTokens` must be a positive integer");if(this.temperature=e.temperature??this.temperature,this.temperature&&(this.temperature<0||this.temperature>2))throw new Error("`temperature` must be in the range of [0.0,2.0]");if(this.topP=e.topP??this.topP,this.topP&&this.topP<0)throw new Error("`topP` must be a positive integer");if(this.topP&&this.topP>1)throw new Error("`topP` must be below 1.");if(this.topK=e.topK??this.topK,this.topK&&this.topK<0)throw new Error("`topK` must be a positive integer");if(this.stopSequences=e.stopSequences??this.stopSequences,this.apiKey=e.apiKey??zi("GOOGLE_API_KEY"),!this.apiKey)throw new Error("Please set an API key for Google GenerativeAI in the environment variable GOOGLE_API_KEY or in the `apiKey` field of the ChatGoogleGenerativeAI constructor");if(this.safetySettings=e.safetySettings??this.safetySettings,this.safetySettings&&this.safetySettings.length>0&&new Set(this.safetySettings.map(r=>r.category)).size!==this.safetySettings.length)throw new Error("The categories in `safetySettings` array must be unique");this.streaming=e.streaming??this.streaming,this.json=e.json,this.client=new oF(this.apiKey).getGenerativeModel({model:this.model,safetySettings:this.safetySettings,generationConfig:{stopSequences:this.stopSequences,maxOutputTokens:this.maxOutputTokens,temperature:this.temperature,topP:this.topP,topK:this.topK,...this.json?{responseMimeType:"application/json"}:{}}},{apiVersion:e.apiVersion,baseUrl:e.baseUrl}),this.streamUsage=e.streamUsage??this.streamUsage}useCachedContent(e,t,r){this.apiKey&&(this.client=new oF(this.apiKey).getGenerativeModelFromCachedContent(e,t,r))}get useSystemInstruction(){return typeof this.convertSystemMessageToHumanContent=="boolean"?!this.convertSystemMessageToHumanContent:this.computeUseSystemInstruction}get computeUseSystemInstruction(){return this.model==="gemini-1.0-pro-001"||this.model.startsWith("gemini-pro-vision")||this.model.startsWith("gemini-1.0-pro-vision")?!1:this.model!=="gemini-pro"}getLsParams(e){return{ls_provider:"google_genai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:this.client.generationConfig.temperature,ls_max_tokens:this.client.generationConfig.maxOutputTokens,ls_stop:e.stop}}_combineLLMOutput(){return[]}_llmType(){return"googlegenerativeai"}bindTools(e,t){var r;return this.withConfig({tools:(r=dF(e))==null?void 0:r.tools,...t})}invocationParams(e){var r;const t=(r=e==null?void 0:e.tools)!=null&&r.length?dF(e.tools,{toolChoice:e.tool_choice,allowedFunctionNames:e.allowedFunctionNames}):void 0;return e!=null&&e.responseSchema?(this.client.generationConfig.responseSchema=e.responseSchema,this.client.generationConfig.responseMimeType="application/json"):(this.client.generationConfig.responseSchema=void 0,this.client.generationConfig.responseMimeType=this.json?"application/json":void 0),{...t!=null&&t.tools?{tools:t.tools}:{},...t!=null&&t.toolConfig?{toolConfig:t.toolConfig}:{}}}async _generate(e,t,r){var d,h,m;const i=cF(e,this._isMultimodalModel,this.useSystemInstruction);let a=i;if(i[0].role==="system"){const[g]=i;this.client.systemInstruction=g,a=i.slice(1)}const s=this.invocationParams(t);if(this.streaming){const g={},_=this._streamResponseChunks(e,t,r),w={};for await(const E of _){const C=((d=E.generationInfo)==null?void 0:d.completion)??0;w[C]===void 0?w[C]=E:w[C]=w[C].concat(E)}return{generations:Object.entries(w).sort(([E],[C])=>parseInt(E,10)-parseInt(C,10)).map(([E,C])=>C),llmOutput:{estimatedTokenUsage:g}}}const o=await this.completionWithRetry({...s,contents:a});let u;if("usageMetadata"in o.response){const g=o.response.usageMetadata;u={input_tokens:g.promptTokenCount??0,output_tokens:g.candidatesTokenCount??0,total_tokens:g.totalTokenCount??0}}const c=Lde(o.response,{usageMetadata:u});return((h=c.generations)==null?void 0:h.length)>0&&await(r==null?void 0:r.handleLLMNewToken(((m=c.generations[0])==null?void 0:m.text)??"")),c}async*_streamResponseChunks(e,t,r){const i=cF(e,this._isMultimodalModel,this.useSystemInstruction);let a=i;if(i[0].role==="system"){const[h]=i;this.client.systemInstruction=h,a=i.slice(1)}const o={...this.invocationParams(t),contents:a},u=await this.caller.callWithOptions({signal:t==null?void 0:t.signal},async()=>{const{stream:h}=await this.client.generateContentStream(o);return h});let c,d=0;for await(const h of u){if("usageMetadata"in h&&this.streamUsage!==!1&&t.streamUsage!==!1){const g=h.usageMetadata;if(!c)c={input_tokens:g.promptTokenCount??0,output_tokens:g.candidatesTokenCount??0,total_tokens:g.totalTokenCount??0};else{const _=(g.candidatesTokenCount??0)-c.output_tokens;c={input_tokens:0,output_tokens:_,total_tokens:_}}}const m=Ude(h,{usageMetadata:c,index:d});d+=1,m&&(yield m,await(r==null?void 0:r.handleLLMNewToken(m.text??"")))}}async completionWithRetry(e,t){return this.caller.callWithOptions({signal:t==null?void 0:t.signal},async()=>{var r;try{return await this.client.generateContent(e)}catch(i){throw(r=i.message)!=null&&r.includes("400 Bad Request")&&(i.status=400),i}})}withStructuredOutput(e,t){const r=e,i=t==null?void 0:t.name,a=t==null?void 0:t.method,s=t==null?void 0:t.includeRaw;if(a==="jsonMode")throw new Error('ChatGoogleGenerativeAI only supports "jsonSchema" or "functionCalling" as a method.');let o,u;if(a==="functionCalling"){let m=i??"extract",g;if(Ui(r)){const _=fR(r);g=[{functionDeclarations:[{name:m,description:_.description??"A function available to call.",parameters:_}]}],u=new fF({returnSingle:!0,keyName:m,zodSchema:r})}else{let _;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(_=r,_.parameters=mc(r.parameters),m=r.name):_={name:m,description:r.description??"",parameters:mc(r)},g=[{functionDeclarations:[_]}],u=new fF({returnSingle:!0,keyName:m})}o=this.bindTools(g).withConfig({allowedFunctionNames:[m]})}else{const m=fR(r);o=this.withConfig({responseSchema:m}),u=new G_}if(!s)return o.pipe(u).withConfig({runName:"ChatGoogleGenerativeAIStructuredOutput"});const c=Ps.assign({parsed:(m,g)=>u.invoke(m.raw,g)}),d=Ps.assign({parsed:()=>null}),h=c.withFallbacks({fallbacks:[d]});return Ar.from([{raw:o},h]).withConfig({runName:"StructuredOutputRunnable"})}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let zde,Hde;function Gde(){return{geminiUrl:zde,vertexUrl:Hde}}function Wde(n,e,t){var r,i,a;if(!(!((r=n.httpOptions)===null||r===void 0)&&r.baseUrl)){const s=Gde();return n.vertexai?(i=s.vertexUrl)!==null&&i!==void 0?i:e:(a=s.geminiUrl)!==null&&a!==void 0?a:t}return n.httpOptions.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Hd{}function St(n,e){const t=/\{([^}]+)\}/g;return n.replace(t,(r,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){const a=e[i];return a!=null?String(a):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function b(n,e,t){for(let a=0;a<e.length-1;a++){const s=e[a];if(s.endsWith("[]")){const o=s.slice(0,-2);if(!(o in n))if(Array.isArray(t))n[o]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${s}`);if(Array.isArray(n[o])){const u=n[o];if(Array.isArray(t))for(let c=0;c<u.length;c++){const d=u[c];b(d,e.slice(a+1),t[c])}else for(const c of u)b(c,e.slice(a+1),t)}return}else if(s.endsWith("[0]")){const o=s.slice(0,-3);o in n||(n[o]=[{}]);const u=n[o];b(u[0],e.slice(a+1),t);return}(!n[s]||typeof n[s]!="object")&&(n[s]={}),n=n[s]}const r=e[e.length-1],i=n[r];if(i!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===i)return;if(typeof i=="object"&&typeof t=="object"&&i!==null&&t!==null)Object.assign(i,t);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else n[r]=t}function v(n,e){try{if(e.length===1&&e[0]==="_self")return n;for(let t=0;t<e.length;t++){if(typeof n!="object"||n===null)return;const r=e[t];if(r.endsWith("[]")){const i=r.slice(0,-2);if(i in n){const a=n[i];return Array.isArray(a)?a.map(s=>v(s,e.slice(t+1))):void 0}else return}else n=n[r]}return n}catch(t){if(t instanceof TypeError)return;throw t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var hF;(function(n){n.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",n.OUTCOME_OK="OUTCOME_OK",n.OUTCOME_FAILED="OUTCOME_FAILED",n.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(hF||(hF={}));var pF;(function(n){n.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",n.PYTHON="PYTHON"})(pF||(pF={}));var ro;(function(n){n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT",n.NULL="NULL"})(ro||(ro={}));var mF;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(mF||(mF={}));var gF;(function(n){n.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY"})(gF||(gF={}));var yF;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE",n.OFF="OFF"})(yF||(yF={}));var vF;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(vF||(vF={}));var _F;(function(n){n.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",n.NO_AUTH="NO_AUTH",n.API_KEY_AUTH="API_KEY_AUTH",n.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",n.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",n.OAUTH="OAUTH",n.OIDC_AUTH="OIDC_AUTH"})(_F||(_F={}));var bF;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.IMAGE_SAFETY="IMAGE_SAFETY",n.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL"})(bF||(bF={}));var wF;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(wF||(wF={}));var EF;(function(n){n.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",n.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",n.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",n.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",n.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(EF||(EF={}));var SF;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT"})(SF||(SF={}));var TF;(function(n){n.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",n.ON_DEMAND="ON_DEMAND",n.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(TF||(TF={}));var Q_;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO"})(Q_||(Q_={}));var AF;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(AF||(AF={}));var dR;(function(n){n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(dR||(dR={}));var CF;(function(n){n.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",n.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",n.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",n.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",n.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",n.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",n.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(CF||(CF={}));var xF;(function(n){n.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",n.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",n.BALANCED="BALANCED",n.PRIORITIZE_COST="PRIORITIZE_COST"})(xF||(xF={}));var RF;(function(n){n.UNSPECIFIED="UNSPECIFIED",n.BLOCKING="BLOCKING",n.NON_BLOCKING="NON_BLOCKING"})(RF||(RF={}));var IF;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(IF||(IF={}));var PF;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(PF||(PF={}));var OF;(function(n){n.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",n.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",n.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR"})(OF||(OF={}));var kF;(function(n){n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(kF||(kF={}));var NF;(function(n){n.DONT_ALLOW="DONT_ALLOW",n.ALLOW_ADULT="ALLOW_ADULT",n.ALLOW_ALL="ALLOW_ALL"})(NF||(NF={}));var MF;(function(n){n.auto="auto",n.en="en",n.ja="ja",n.ko="ko",n.hi="hi"})(MF||(MF={}));var DF;(function(n){n.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",n.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",n.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",n.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",n.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(DF||(DF={}));var $F;(function(n){n.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",n.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",n.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",n.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})($F||($F={}));var LF;(function(n){n.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",n.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",n.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",n.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(LF||(LF={}));var UF;(function(n){n.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",n.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",n.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",n.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",n.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",n.EDIT_MODE_STYLE="EDIT_MODE_STYLE",n.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",n.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(UF||(UF={}));var jF;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.PROCESSING="PROCESSING",n.ACTIVE="ACTIVE",n.FAILED="FAILED"})(jF||(jF={}));var FF;(function(n){n.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",n.UPLOADED="UPLOADED",n.GENERATED="GENERATED"})(FF||(FF={}));var BF;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.VIDEO="VIDEO",n.AUDIO="AUDIO",n.DOCUMENT="DOCUMENT"})(BF||(BF={}));var qF;(function(n){n.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",n.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",n.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(qF||(qF={}));var VF;(function(n){n.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",n.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",n.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(VF||(VF={}));var zF;(function(n){n.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",n.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",n.NO_INTERRUPTION="NO_INTERRUPTION"})(zF||(zF={}));var HF;(function(n){n.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",n.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",n.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(HF||(HF={}));var GF;(function(n){n.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",n.SILENT="SILENT",n.WHEN_IDLE="WHEN_IDLE",n.INTERRUPT="INTERRUPT"})(GF||(GF={}));var WF;(function(n){n.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",n.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",n.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",n.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",n.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",n.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",n.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",n.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",n.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",n.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",n.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",n.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",n.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(WF||(WF={}));var Qf;(function(n){n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT"})(Qf||(Qf={}));class hR{constructor(e){const t={};for(const r of e.headers.entries())t[r[0]]=r[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class dp{get text(){var e,t,r,i,a,s,o,u;if(((i=(r=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let c="",d=!1;const h=[];for(const m of(u=(o=(s=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||s===void 0?void 0:s.content)===null||o===void 0?void 0:o.parts)!==null&&u!==void 0?u:[]){for(const[g,_]of Object.entries(m))g!=="text"&&g!=="thought"&&(_!==null||_!==void 0)&&h.push(g);if(typeof m.text=="string"){if(typeof m.thought=="boolean"&&m.thought)continue;d=!0,c+=m.text}}return h.length>0&&console.warn(`there are non-text parts ${h} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),d?c:void 0}get data(){var e,t,r,i,a,s,o,u;if(((i=(r=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let c="";const d=[];for(const h of(u=(o=(s=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||s===void 0?void 0:s.content)===null||o===void 0?void 0:o.parts)!==null&&u!==void 0?u:[]){for(const[m,g]of Object.entries(h))m!=="inlineData"&&(g!==null||g!==void 0)&&d.push(m);h.inlineData&&typeof h.inlineData.data=="string"&&(c+=atob(h.inlineData.data))}return d.length>0&&console.warn(`there are non-data parts ${d} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),c.length>0?btoa(c):void 0}get functionCalls(){var e,t,r,i,a,s,o,u;if(((i=(r=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const c=(u=(o=(s=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||s===void 0?void 0:s.content)===null||o===void 0?void 0:o.parts)===null||u===void 0?void 0:u.filter(d=>d.functionCall).map(d=>d.functionCall).filter(d=>d!==void 0);if((c==null?void 0:c.length)!==0)return c}get executableCode(){var e,t,r,i,a,s,o,u,c;if(((i=(r=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const d=(u=(o=(s=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||s===void 0?void 0:s.content)===null||o===void 0?void 0:o.parts)===null||u===void 0?void 0:u.filter(h=>h.executableCode).map(h=>h.executableCode).filter(h=>h!==void 0);if((d==null?void 0:d.length)!==0)return(c=d==null?void 0:d[0])===null||c===void 0?void 0:c.code}get codeExecutionResult(){var e,t,r,i,a,s,o,u,c;if(((i=(r=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const d=(u=(o=(s=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||s===void 0?void 0:s.content)===null||o===void 0?void 0:o.parts)===null||u===void 0?void 0:u.filter(h=>h.codeExecutionResult).map(h=>h.codeExecutionResult).filter(h=>h!==void 0);if((d==null?void 0:d.length)!==0)return(c=d==null?void 0:d[0])===null||c===void 0?void 0:c.output}}class KF{}class JF{}class Kde{}class Jde{}class YF{}class ZF{}class XF{}class Yde{}class QF{}class eB{}class tB{}class Zde{}class Xde{}class Qde{}class ehe{get text(){var e,t,r;let i="",a=!1;const s=[];for(const o of(r=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&r!==void 0?r:[]){for(const[u,c]of Object.entries(o))u!=="text"&&u!=="thought"&&c!==null&&s.push(u);if(typeof o.text=="string"){if(typeof o.thought=="boolean"&&o.thought)continue;a=!0,i+=o.text}}return s.length>0&&console.warn(`there are non-text parts ${s} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),a?i:void 0}get data(){var e,t,r;let i="";const a=[];for(const s of(r=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&r!==void 0?r:[]){for(const[o,u]of Object.entries(s))o!=="inlineData"&&u!==null&&a.push(o);s.inlineData&&typeof s.inlineData.data=="string"&&(i+=atob(s.inlineData.data))}return a.length>0&&console.warn(`there are non-data parts ${a} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class the{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Nn(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function l8(n,e){const t=Nn(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function u8(n){return Array.isArray(n)?n.map(e=>eb(e)):[eb(n)]}function eb(n){if(typeof n=="object"&&n!==null)return n;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof n}`)}function nhe(n){const e=eb(n);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function rhe(n){const e=eb(n);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function nB(n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function c8(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(e=>nB(e)):[nB(n)]}function pR(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function rB(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function iB(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function vi(n){if(n==null)throw new Error("ContentUnion is required");return pR(n)?n:{role:"user",parts:c8(n)}}function f8(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const r=vi(t);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(n.isVertexAI()){const t=vi(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>vi(t)):[vi(e)]}function As(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n)){if(rB(n)||iB(n))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[vi(n)]}const e=[],t=[],r=pR(n[0]);for(const i of n){const a=pR(i);if(a!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(a)e.push(i);else{if(rB(i)||iB(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(i)}}return r||e.push({role:"user",parts:c8(t)}),e}const ihe=new Set(["type","format","title","description","default","items","minItems","maxItems","enum","properties","required","minProperties","maxProperties","minimum","maximum","minLength","maxLength","pattern","anyOf","propertyOrdering"]),aB=xs(["string","number","integer","object","array","boolean","null"]),ahe=In([aB,kt(aB)]);function she(n=!0){const e=LX(()=>{const t=rt({type:ahe.optional(),format:$e().optional(),title:$e().optional(),description:$e().optional(),default:dc().optional(),items:e.optional(),minItems:wf.string().optional(),maxItems:wf.string().optional(),enum:kt(dc()).optional(),properties:gs($e(),e).optional(),required:kt($e()).optional(),minProperties:wf.string().optional(),maxProperties:wf.string().optional(),propertyOrdering:kt($e()).optional(),minimum:Yn().optional(),maximum:Yn().optional(),minLength:wf.string().optional(),maxLength:wf.string().optional(),pattern:$e().optional(),anyOf:kt(e).optional(),additionalProperties:Jr().optional()});return n?t.strict():t});return e}function ohe(n,e){n.includes("null")&&(e.nullable=!0);const t=n.filter(r=>r!=="null");if(t.length===1)e.type=Object.values(ro).includes(t[0].toUpperCase())?t[0].toUpperCase():ro.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const r of t)e.anyOf.push({type:Object.values(ro).includes(r.toUpperCase())?r.toUpperCase():ro.TYPE_UNSPECIFIED})}}function hd(n){const e={},t=["items"],r=["anyOf"],i=["properties"];if(n.type&&n.anyOf)throw new Error("type and anyOf cannot be both populated.");const a=n.anyOf;a!=null&&a.length==2&&(a[0].type==="null"?(e.nullable=!0,n=a[1]):a[1].type==="null"&&(e.nullable=!0,n=a[0])),n.type instanceof Array&&ohe(n.type,e);for(const[s,o]of Object.entries(n))if(o!=null)if(s=="type"){if(o==="null")throw new Error("type: null can not be the only possible type for the field.");if(o instanceof Array)continue;e.type=Object.values(ro).includes(o.toUpperCase())?o.toUpperCase():ro.TYPE_UNSPECIFIED}else if(t.includes(s))e[s]=hd(o);else if(r.includes(s)){const u=[];for(const c of o){if(c.type=="null"){e.nullable=!0;continue}u.push(hd(c))}e[s]=u}else if(i.includes(s)){const u={};for(const[c,d]of Object.entries(o))u[c]=hd(d);e[s]=u}else{if(s==="additionalProperties")continue;e[s]=o}return e}function tb(n){if(Object.keys(n).includes("$schema")){delete n.$schema;const e=she().parse(n);return hd(e)}else return hd(n)}function d8(n){if(typeof n=="object")return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function LP(n){if("multiSpeakerVoiceConfig"in n)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return n}function ug(n){if(n.functionDeclarations)for(const e of n.functionDeclarations)e.parameters&&(e.parameters=tb(e.parameters)),e.response&&(e.response=tb(e.response));return n}function cg(n){if(n==null)throw new Error("tools is required");if(!Array.isArray(n))throw new Error("tools is required and must be an array of Tools");const e=[];for(const t of n)e.push(t);return e}function lhe(n,e,t,r=1){const i=!e.startsWith(`${t}/`)&&e.split("/").length===r;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:i?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:i?`${t}/${e}`:e}function uu(n,e){if(typeof e!="string")throw new Error("name must be a string");return lhe(n,e,"cachedContents")}function h8(n){switch(n){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return n}}function al(n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}function uhe(n){return n!=null&&typeof n=="object"&&"name"in n}function che(n){return n!=null&&typeof n=="object"&&"video"in n}function fhe(n){return n!=null&&typeof n=="object"&&"uri"in n}function p8(n){var e;let t;if(uhe(n)&&(t=n.name),!(fhe(n)&&(t=n.uri,t===void 0))&&!(che(n)&&(t=(e=n.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof n=="string"&&(t=n),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){const i=t.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${t}`);t=i[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function m8(n,e){let t;return n.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function g8(n){for(const e of["models","tunedModels","publisherModels"])if(dhe(n,e))return n[e];return[]}function dhe(n,e){return n!==null&&typeof n=="object"&&e in n}function hhe(n,e={}){const t=n,r={name:t.name,description:t.description,parameters:hd(dw(t.inputSchema))};return e.behavior&&(r.behavior=e.behavior),{functionDeclarations:[r]}}function phe(n,e={}){const t=[],r=new Set;for(const i of n){const a=i.name;if(r.has(a))throw new Error(`Duplicate function name ${a} found in MCP tools. Please ensure function names are unique.`);r.add(a);const s=hhe(i,e);s.functionDeclarations&&t.push(...s.functionDeclarations)}return{functionDeclarations:t}}function mhe(n){const e=[];for(const t of n)e.push(dw(t));return e}function ghe(n){const e={};for(const[t,r]of Object.entries(n)){const i=r;e[t]=dw(i)}return e}function dw(n){const e=new Set(["items"]),t=new Set(["anyOf"]),r=new Set(["properties"]),i={};for(const[a,s]of Object.entries(n))if(e.has(a))i[a]=dw(s);else if(t.has(a))i[a]=mhe(s);else if(r.has(a))i[a]=ghe(s);else if(a==="type"){const o=s.toUpperCase();i[a]=Object.values(ro).includes(o)?o:ro.TYPE_UNSPECIFIED}else ihe.has(a)&&(i[a]=s);return i}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function yhe(n){const e={},t=v(n,["fps"]);t!=null&&b(e,["fps"],t);const r=v(n,["endOffset"]);r!=null&&b(e,["endOffset"],r);const i=v(n,["startOffset"]);return i!=null&&b(e,["startOffset"],i),e}function vhe(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["data"]);t!=null&&b(e,["data"],t);const r=v(n,["mimeType"]);return r!=null&&b(e,["mimeType"],r),e}function _he(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["fileUri"]);t!=null&&b(e,["fileUri"],t);const r=v(n,["mimeType"]);return r!=null&&b(e,["mimeType"],r),e}function bhe(n){const e={},t=v(n,["videoMetadata"]);t!=null&&b(e,["videoMetadata"],yhe(t));const r=v(n,["thought"]);r!=null&&b(e,["thought"],r);const i=v(n,["inlineData"]);i!=null&&b(e,["inlineData"],vhe(i));const a=v(n,["fileData"]);a!=null&&b(e,["fileData"],_he(a));const s=v(n,["thoughtSignature"]);s!=null&&b(e,["thoughtSignature"],s);const o=v(n,["codeExecutionResult"]);o!=null&&b(e,["codeExecutionResult"],o);const u=v(n,["executableCode"]);u!=null&&b(e,["executableCode"],u);const c=v(n,["functionCall"]);c!=null&&b(e,["functionCall"],c);const d=v(n,["functionResponse"]);d!=null&&b(e,["functionResponse"],d);const h=v(n,["text"]);return h!=null&&b(e,["text"],h),e}function sB(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>bhe(a))),b(e,["parts"],i)}const r=v(n,["role"]);return r!=null&&b(e,["role"],r),e}function whe(n){const e={},t=v(n,["behavior"]);t!=null&&b(e,["behavior"],t);const r=v(n,["description"]);r!=null&&b(e,["description"],r);const i=v(n,["name"]);i!=null&&b(e,["name"],i);const a=v(n,["parameters"]);a!=null&&b(e,["parameters"],a);const s=v(n,["parametersJsonSchema"]);s!=null&&b(e,["parametersJsonSchema"],s);const o=v(n,["response"]);o!=null&&b(e,["response"],o);const u=v(n,["responseJsonSchema"]);return u!=null&&b(e,["responseJsonSchema"],u),e}function Ehe(n){const e={},t=v(n,["startTime"]);t!=null&&b(e,["startTime"],t);const r=v(n,["endTime"]);return r!=null&&b(e,["endTime"],r),e}function She(n){const e={},t=v(n,["timeRangeFilter"]);return t!=null&&b(e,["timeRangeFilter"],Ehe(t)),e}function The(n){const e={},t=v(n,["mode"]);t!=null&&b(e,["mode"],t);const r=v(n,["dynamicThreshold"]);return r!=null&&b(e,["dynamicThreshold"],r),e}function Ahe(n){const e={},t=v(n,["dynamicRetrievalConfig"]);return t!=null&&b(e,["dynamicRetrievalConfig"],The(t)),e}function Che(){return{}}function xhe(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(u=>whe(u))),b(e,["functionDeclarations"],o)}if(v(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=v(n,["googleSearch"]);r!=null&&b(e,["googleSearch"],She(r));const i=v(n,["googleSearchRetrieval"]);if(i!=null&&b(e,["googleSearchRetrieval"],Ahe(i)),v(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(v(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");v(n,["urlContext"])!=null&&b(e,["urlContext"],Che());const s=v(n,["codeExecution"]);return s!=null&&b(e,["codeExecution"],s),e}function Rhe(n){const e={},t=v(n,["mode"]);t!=null&&b(e,["mode"],t);const r=v(n,["allowedFunctionNames"]);return r!=null&&b(e,["allowedFunctionNames"],r),e}function Ihe(n){const e={},t=v(n,["latitude"]);t!=null&&b(e,["latitude"],t);const r=v(n,["longitude"]);return r!=null&&b(e,["longitude"],r),e}function Phe(n){const e={},t=v(n,["latLng"]);t!=null&&b(e,["latLng"],Ihe(t));const r=v(n,["languageCode"]);return r!=null&&b(e,["languageCode"],r),e}function Ohe(n){const e={},t=v(n,["functionCallingConfig"]);t!=null&&b(e,["functionCallingConfig"],Rhe(t));const r=v(n,["retrievalConfig"]);return r!=null&&b(e,["retrievalConfig"],Phe(r)),e}function khe(n,e){const t={},r=v(n,["ttl"]);e!==void 0&&r!=null&&b(e,["ttl"],r);const i=v(n,["expireTime"]);e!==void 0&&i!=null&&b(e,["expireTime"],i);const a=v(n,["displayName"]);e!==void 0&&a!=null&&b(e,["displayName"],a);const s=v(n,["contents"]);if(e!==void 0&&s!=null){let d=As(s);Array.isArray(d)&&(d=d.map(h=>sB(h))),b(e,["contents"],d)}const o=v(n,["systemInstruction"]);e!==void 0&&o!=null&&b(e,["systemInstruction"],sB(vi(o)));const u=v(n,["tools"]);if(e!==void 0&&u!=null){let d=u;Array.isArray(d)&&(d=d.map(h=>xhe(h))),b(e,["tools"],d)}const c=v(n,["toolConfig"]);if(e!==void 0&&c!=null&&b(e,["toolConfig"],Ohe(c)),v(n,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function Nhe(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["model"],l8(n,r));const i=v(e,["config"]);return i!=null&&b(t,["config"],khe(i,t)),t}function Mhe(n,e){const t={},r=v(e,["name"]);r!=null&&b(t,["_url","name"],uu(n,r));const i=v(e,["config"]);return i!=null&&b(t,["config"],i),t}function Dhe(n,e){const t={},r=v(e,["name"]);r!=null&&b(t,["_url","name"],uu(n,r));const i=v(e,["config"]);return i!=null&&b(t,["config"],i),t}function $he(n,e){const t={},r=v(n,["ttl"]);e!==void 0&&r!=null&&b(e,["ttl"],r);const i=v(n,["expireTime"]);return e!==void 0&&i!=null&&b(e,["expireTime"],i),t}function Lhe(n,e){const t={},r=v(e,["name"]);r!=null&&b(t,["_url","name"],uu(n,r));const i=v(e,["config"]);return i!=null&&b(t,["config"],$he(i,t)),t}function Uhe(n,e){const t={},r=v(n,["pageSize"]);e!==void 0&&r!=null&&b(e,["_query","pageSize"],r);const i=v(n,["pageToken"]);return e!==void 0&&i!=null&&b(e,["_query","pageToken"],i),t}function jhe(n){const e={},t=v(n,["config"]);return t!=null&&b(e,["config"],Uhe(t,e)),e}function Fhe(n){const e={},t=v(n,["fps"]);t!=null&&b(e,["fps"],t);const r=v(n,["endOffset"]);r!=null&&b(e,["endOffset"],r);const i=v(n,["startOffset"]);return i!=null&&b(e,["startOffset"],i),e}function Bhe(n){const e={},t=v(n,["displayName"]);t!=null&&b(e,["displayName"],t);const r=v(n,["data"]);r!=null&&b(e,["data"],r);const i=v(n,["mimeType"]);return i!=null&&b(e,["mimeType"],i),e}function qhe(n){const e={},t=v(n,["displayName"]);t!=null&&b(e,["displayName"],t);const r=v(n,["fileUri"]);r!=null&&b(e,["fileUri"],r);const i=v(n,["mimeType"]);return i!=null&&b(e,["mimeType"],i),e}function Vhe(n){const e={},t=v(n,["videoMetadata"]);t!=null&&b(e,["videoMetadata"],Fhe(t));const r=v(n,["thought"]);r!=null&&b(e,["thought"],r);const i=v(n,["inlineData"]);i!=null&&b(e,["inlineData"],Bhe(i));const a=v(n,["fileData"]);a!=null&&b(e,["fileData"],qhe(a));const s=v(n,["thoughtSignature"]);s!=null&&b(e,["thoughtSignature"],s);const o=v(n,["codeExecutionResult"]);o!=null&&b(e,["codeExecutionResult"],o);const u=v(n,["executableCode"]);u!=null&&b(e,["executableCode"],u);const c=v(n,["functionCall"]);c!=null&&b(e,["functionCall"],c);const d=v(n,["functionResponse"]);d!=null&&b(e,["functionResponse"],d);const h=v(n,["text"]);return h!=null&&b(e,["text"],h),e}function oB(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>Vhe(a))),b(e,["parts"],i)}const r=v(n,["role"]);return r!=null&&b(e,["role"],r),e}function zhe(n){const e={};if(v(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=v(n,["description"]);t!=null&&b(e,["description"],t);const r=v(n,["name"]);r!=null&&b(e,["name"],r);const i=v(n,["parameters"]);i!=null&&b(e,["parameters"],i);const a=v(n,["parametersJsonSchema"]);a!=null&&b(e,["parametersJsonSchema"],a);const s=v(n,["response"]);s!=null&&b(e,["response"],s);const o=v(n,["responseJsonSchema"]);return o!=null&&b(e,["responseJsonSchema"],o),e}function Hhe(n){const e={},t=v(n,["startTime"]);t!=null&&b(e,["startTime"],t);const r=v(n,["endTime"]);return r!=null&&b(e,["endTime"],r),e}function Ghe(n){const e={},t=v(n,["timeRangeFilter"]);return t!=null&&b(e,["timeRangeFilter"],Hhe(t)),e}function Whe(n){const e={},t=v(n,["mode"]);t!=null&&b(e,["mode"],t);const r=v(n,["dynamicThreshold"]);return r!=null&&b(e,["dynamicThreshold"],r),e}function Khe(n){const e={},t=v(n,["dynamicRetrievalConfig"]);return t!=null&&b(e,["dynamicRetrievalConfig"],Whe(t)),e}function Jhe(){return{}}function Yhe(n){const e={},t=v(n,["apiKeyString"]);return t!=null&&b(e,["apiKeyString"],t),e}function Zhe(n){const e={},t=v(n,["apiKeyConfig"]);t!=null&&b(e,["apiKeyConfig"],Yhe(t));const r=v(n,["authType"]);r!=null&&b(e,["authType"],r);const i=v(n,["googleServiceAccountConfig"]);i!=null&&b(e,["googleServiceAccountConfig"],i);const a=v(n,["httpBasicAuthConfig"]);a!=null&&b(e,["httpBasicAuthConfig"],a);const s=v(n,["oauthConfig"]);s!=null&&b(e,["oauthConfig"],s);const o=v(n,["oidcConfig"]);return o!=null&&b(e,["oidcConfig"],o),e}function Xhe(n){const e={},t=v(n,["authConfig"]);return t!=null&&b(e,["authConfig"],Zhe(t)),e}function Qhe(){return{}}function epe(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(h=>zhe(h))),b(e,["functionDeclarations"],d)}const r=v(n,["retrieval"]);r!=null&&b(e,["retrieval"],r);const i=v(n,["googleSearch"]);i!=null&&b(e,["googleSearch"],Ghe(i));const a=v(n,["googleSearchRetrieval"]);a!=null&&b(e,["googleSearchRetrieval"],Khe(a)),v(n,["enterpriseWebSearch"])!=null&&b(e,["enterpriseWebSearch"],Jhe());const o=v(n,["googleMaps"]);o!=null&&b(e,["googleMaps"],Xhe(o)),v(n,["urlContext"])!=null&&b(e,["urlContext"],Qhe());const c=v(n,["codeExecution"]);return c!=null&&b(e,["codeExecution"],c),e}function tpe(n){const e={},t=v(n,["mode"]);t!=null&&b(e,["mode"],t);const r=v(n,["allowedFunctionNames"]);return r!=null&&b(e,["allowedFunctionNames"],r),e}function npe(n){const e={},t=v(n,["latitude"]);t!=null&&b(e,["latitude"],t);const r=v(n,["longitude"]);return r!=null&&b(e,["longitude"],r),e}function rpe(n){const e={},t=v(n,["latLng"]);t!=null&&b(e,["latLng"],npe(t));const r=v(n,["languageCode"]);return r!=null&&b(e,["languageCode"],r),e}function ipe(n){const e={},t=v(n,["functionCallingConfig"]);t!=null&&b(e,["functionCallingConfig"],tpe(t));const r=v(n,["retrievalConfig"]);return r!=null&&b(e,["retrievalConfig"],rpe(r)),e}function ape(n,e){const t={},r=v(n,["ttl"]);e!==void 0&&r!=null&&b(e,["ttl"],r);const i=v(n,["expireTime"]);e!==void 0&&i!=null&&b(e,["expireTime"],i);const a=v(n,["displayName"]);e!==void 0&&a!=null&&b(e,["displayName"],a);const s=v(n,["contents"]);if(e!==void 0&&s!=null){let h=As(s);Array.isArray(h)&&(h=h.map(m=>oB(m))),b(e,["contents"],h)}const o=v(n,["systemInstruction"]);e!==void 0&&o!=null&&b(e,["systemInstruction"],oB(vi(o)));const u=v(n,["tools"]);if(e!==void 0&&u!=null){let h=u;Array.isArray(h)&&(h=h.map(m=>epe(m))),b(e,["tools"],h)}const c=v(n,["toolConfig"]);e!==void 0&&c!=null&&b(e,["toolConfig"],ipe(c));const d=v(n,["kmsKeyName"]);return e!==void 0&&d!=null&&b(e,["encryption_spec","kmsKeyName"],d),t}function spe(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["model"],l8(n,r));const i=v(e,["config"]);return i!=null&&b(t,["config"],ape(i,t)),t}function ope(n,e){const t={},r=v(e,["name"]);r!=null&&b(t,["_url","name"],uu(n,r));const i=v(e,["config"]);return i!=null&&b(t,["config"],i),t}function lpe(n,e){const t={},r=v(e,["name"]);r!=null&&b(t,["_url","name"],uu(n,r));const i=v(e,["config"]);return i!=null&&b(t,["config"],i),t}function upe(n,e){const t={},r=v(n,["ttl"]);e!==void 0&&r!=null&&b(e,["ttl"],r);const i=v(n,["expireTime"]);return e!==void 0&&i!=null&&b(e,["expireTime"],i),t}function cpe(n,e){const t={},r=v(e,["name"]);r!=null&&b(t,["_url","name"],uu(n,r));const i=v(e,["config"]);return i!=null&&b(t,["config"],upe(i,t)),t}function fpe(n,e){const t={},r=v(n,["pageSize"]);e!==void 0&&r!=null&&b(e,["_query","pageSize"],r);const i=v(n,["pageToken"]);return e!==void 0&&i!=null&&b(e,["_query","pageToken"],i),t}function dpe(n){const e={},t=v(n,["config"]);return t!=null&&b(e,["config"],fpe(t,e)),e}function Yv(n){const e={},t=v(n,["name"]);t!=null&&b(e,["name"],t);const r=v(n,["displayName"]);r!=null&&b(e,["displayName"],r);const i=v(n,["model"]);i!=null&&b(e,["model"],i);const a=v(n,["createTime"]);a!=null&&b(e,["createTime"],a);const s=v(n,["updateTime"]);s!=null&&b(e,["updateTime"],s);const o=v(n,["expireTime"]);o!=null&&b(e,["expireTime"],o);const u=v(n,["usageMetadata"]);return u!=null&&b(e,["usageMetadata"],u),e}function hpe(){return{}}function ppe(n){const e={},t=v(n,["nextPageToken"]);t!=null&&b(e,["nextPageToken"],t);const r=v(n,["cachedContents"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(a=>Yv(a))),b(e,["cachedContents"],i)}return e}function Zv(n){const e={},t=v(n,["name"]);t!=null&&b(e,["name"],t);const r=v(n,["displayName"]);r!=null&&b(e,["displayName"],r);const i=v(n,["model"]);i!=null&&b(e,["model"],i);const a=v(n,["createTime"]);a!=null&&b(e,["createTime"],a);const s=v(n,["updateTime"]);s!=null&&b(e,["updateTime"],s);const o=v(n,["expireTime"]);o!=null&&b(e,["expireTime"],o);const u=v(n,["usageMetadata"]);return u!=null&&b(e,["usageMetadata"],u),e}function mpe(){return{}}function gpe(n){const e={},t=v(n,["nextPageToken"]);t!=null&&b(e,["nextPageToken"],t);const r=v(n,["cachedContents"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(a=>Zv(a))),b(e,["cachedContents"],i)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var xd;(function(n){n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(xd||(xd={}));class hw{constructor(e,t,r,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,r,i)}init(e,t,r){var i,a;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.idxInternal=0;let s={config:{}};r?typeof r=="object"?s=Object.assign({},r):s=r:s={config:{}},s.config&&(s.config.pageToken=t.nextPageToken),this.paramsInternal=s,this.pageInternalSize=(a=(i=s.config)===null||i===void 0?void 0:i.pageSize)!==null&&a!==void 0?a:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ype extends Hd{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new hw(xd.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(t),t)}async create(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=spe(this.apiClient,e);return o=St("cachedContents",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>Zv(d))}else{const c=Nhe(this.apiClient,e);return o=St("cachedContents",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>Yv(d))}}async get(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=ope(this.apiClient,e);return o=St("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>Zv(d))}else{const c=Mhe(this.apiClient,e);return o=St("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>Yv(d))}}async delete(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=lpe(this.apiClient,e);return o=St("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(()=>{const d=mpe(),h=new eB;return Object.assign(h,d),h})}else{const c=Dhe(this.apiClient,e);return o=St("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(()=>{const d=hpe(),h=new eB;return Object.assign(h,d),h})}}async update(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=cpe(this.apiClient,e);return o=St("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>Zv(d))}else{const c=Lhe(this.apiClient,e);return o=St("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>Yv(d))}}async listInternal(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=dpe(e);return o=St("cachedContents",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>{const h=gpe(d),m=new tB;return Object.assign(m,h),m})}else{const c=jhe(e);return o=St("cachedContents",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>{const h=ppe(d),m=new tB;return Object.assign(m,h),m})}}}function lB(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Mn(n){return this instanceof Mn?(this.v=n,this):new Mn(n)}function pd(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,a=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",s),i[Symbol.asyncIterator]=function(){return this},i;function s(g){return function(_){return Promise.resolve(_).then(g,h)}}function o(g,_){r[g]&&(i[g]=function(w){return new Promise(function(S,E){a.push([g,w,S,E])>1||u(g,w)})},_&&(i[g]=_(i[g])))}function u(g,_){try{c(r[g](_))}catch(w){m(a[0][3],w)}}function c(g){g.value instanceof Mn?Promise.resolve(g.value.v).then(d,h):m(a[0][2],g)}function d(g){u("next",g)}function h(g){u("throw",g)}function m(g,_){g(_),a.shift(),a.length&&u(a[0][0],a[0][1])}}function Zp(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof lB=="function"?lB(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(a){t[a]=n[a]&&function(s){return new Promise(function(o,u){s=n[a](s),i(o,u,s.done,s.value)})}}function i(a,s,o,u){Promise.resolve(u).then(function(c){a({value:c,done:o})},s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function vpe(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;const t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:y8(t)}function y8(n){if(n.parts===void 0||n.parts.length===0)return!1;for(const e of n.parts)if(e===void 0||Object.keys(e).length===0||!e.thought&&e.text!==void 0&&e.text==="")return!1;return!0}function _pe(n){if(n.length!==0){for(const e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function uB(n){if(n===void 0||n.length===0)return[];const e=[],t=n.length;let r=0;for(;r<t;)if(n[r].role==="user")e.push(n[r]),r++;else{const i=[];let a=!0;for(;r<t&&n[r].role==="model";)i.push(n[r]),a&&!y8(n[r])&&(a=!1),r++;a?e.push(...i):e.pop()}return e}class bpe{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new wpe(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class wpe{constructor(e,t,r,i={},a=[]){this.apiClient=e,this.modelsModule=t,this.model=r,this.config=i,this.history=a,this.sendPromise=Promise.resolve(),_pe(a)}async sendMessage(e){var t;await this.sendPromise;const r=vi(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var a,s,o;const u=await i,c=(s=(a=u.candidates)===null||a===void 0?void 0:a[0])===null||s===void 0?void 0:s.content,d=u.automaticFunctionCallingHistory,h=this.getHistory(!0).length;let m=[];d!=null&&(m=(o=d.slice(h))!==null&&o!==void 0?o:[]);const g=c?[c]:[];this.recordHistory(r,g,m)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var t;await this.sendPromise;const r=vi(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const a=await i;return this.processStreamResponse(a,r)}getHistory(e=!1){const t=e?uB(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){var r,i;return pd(this,arguments,function*(){var s,o,u,c;const d=[];try{for(var h=!0,m=Zp(e),g;g=yield Mn(m.next()),s=g.done,!s;h=!0){c=g.value,h=!1;const _=c;if(vpe(_)){const w=(i=(r=_.candidates)===null||r===void 0?void 0:r[0])===null||i===void 0?void 0:i.content;w!==void 0&&d.push(w)}yield yield Mn(_)}}catch(_){o={error:_}}finally{try{!h&&!s&&(u=m.return)&&(yield Mn(u.call(m)))}finally{if(o)throw o.error}}this.recordHistory(t,d)})}recordHistory(e,t,r){let i=[];t.length>0&&t.every(a=>a.role!==void 0)?i=t:i.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...uB(r)):this.history.push(e),this.history.push(...i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class pw extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,pw.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Epe(n,e){const t={},r=v(n,["pageSize"]);e!==void 0&&r!=null&&b(e,["_query","pageSize"],r);const i=v(n,["pageToken"]);return e!==void 0&&i!=null&&b(e,["_query","pageToken"],i),t}function Spe(n){const e={},t=v(n,["config"]);return t!=null&&b(e,["config"],Epe(t,e)),e}function Tpe(n){const e={},t=v(n,["details"]);t!=null&&b(e,["details"],t);const r=v(n,["message"]);r!=null&&b(e,["message"],r);const i=v(n,["code"]);return i!=null&&b(e,["code"],i),e}function Ape(n){const e={},t=v(n,["name"]);t!=null&&b(e,["name"],t);const r=v(n,["displayName"]);r!=null&&b(e,["displayName"],r);const i=v(n,["mimeType"]);i!=null&&b(e,["mimeType"],i);const a=v(n,["sizeBytes"]);a!=null&&b(e,["sizeBytes"],a);const s=v(n,["createTime"]);s!=null&&b(e,["createTime"],s);const o=v(n,["expirationTime"]);o!=null&&b(e,["expirationTime"],o);const u=v(n,["updateTime"]);u!=null&&b(e,["updateTime"],u);const c=v(n,["sha256Hash"]);c!=null&&b(e,["sha256Hash"],c);const d=v(n,["uri"]);d!=null&&b(e,["uri"],d);const h=v(n,["downloadUri"]);h!=null&&b(e,["downloadUri"],h);const m=v(n,["state"]);m!=null&&b(e,["state"],m);const g=v(n,["source"]);g!=null&&b(e,["source"],g);const _=v(n,["videoMetadata"]);_!=null&&b(e,["videoMetadata"],_);const w=v(n,["error"]);return w!=null&&b(e,["error"],Tpe(w)),e}function Cpe(n){const e={},t=v(n,["file"]);t!=null&&b(e,["file"],Ape(t));const r=v(n,["config"]);return r!=null&&b(e,["config"],r),e}function xpe(n){const e={},t=v(n,["name"]);t!=null&&b(e,["_url","file"],p8(t));const r=v(n,["config"]);return r!=null&&b(e,["config"],r),e}function Rpe(n){const e={},t=v(n,["name"]);t!=null&&b(e,["_url","file"],p8(t));const r=v(n,["config"]);return r!=null&&b(e,["config"],r),e}function Ipe(n){const e={},t=v(n,["details"]);t!=null&&b(e,["details"],t);const r=v(n,["message"]);r!=null&&b(e,["message"],r);const i=v(n,["code"]);return i!=null&&b(e,["code"],i),e}function mR(n){const e={},t=v(n,["name"]);t!=null&&b(e,["name"],t);const r=v(n,["displayName"]);r!=null&&b(e,["displayName"],r);const i=v(n,["mimeType"]);i!=null&&b(e,["mimeType"],i);const a=v(n,["sizeBytes"]);a!=null&&b(e,["sizeBytes"],a);const s=v(n,["createTime"]);s!=null&&b(e,["createTime"],s);const o=v(n,["expirationTime"]);o!=null&&b(e,["expirationTime"],o);const u=v(n,["updateTime"]);u!=null&&b(e,["updateTime"],u);const c=v(n,["sha256Hash"]);c!=null&&b(e,["sha256Hash"],c);const d=v(n,["uri"]);d!=null&&b(e,["uri"],d);const h=v(n,["downloadUri"]);h!=null&&b(e,["downloadUri"],h);const m=v(n,["state"]);m!=null&&b(e,["state"],m);const g=v(n,["source"]);g!=null&&b(e,["source"],g);const _=v(n,["videoMetadata"]);_!=null&&b(e,["videoMetadata"],_);const w=v(n,["error"]);return w!=null&&b(e,["error"],Ipe(w)),e}function Ppe(n){const e={},t=v(n,["nextPageToken"]);t!=null&&b(e,["nextPageToken"],t);const r=v(n,["files"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(a=>mR(a))),b(e,["files"],i)}return e}function Ope(){return{}}function kpe(){return{}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Npe extends Hd{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new hw(xd.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>mR(t))}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,r;let i,a="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=Spe(e);return a=St("files",o._url),s=o._query,delete o.config,delete o._url,delete o._query,i=this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),i.then(u=>{const c=Ppe(u),d=new Zde;return Object.assign(d,c),d})}}async createInternal(e){var t,r;let i,a="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=Cpe(e);return a=St("upload/v1beta/files",o._url),s=o._query,delete o.config,delete o._url,delete o._query,i=this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),i.then(()=>{const u=Ope(),c=new Xde;return Object.assign(c,u),c})}}async get(e){var t,r;let i,a="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=xpe(e);return a=St("files/{file}",o._url),s=o._query,delete o.config,delete o._url,delete o._query,i=this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),i.then(u=>mR(u))}}async delete(e){var t,r;let i,a="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=Rpe(e);return a=St("files/{file}",o._url),s=o._query,delete o.config,delete o._url,delete o._query,i=this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),i.then(()=>{const u=kpe(),c=new Qde;return Object.assign(c,u),c})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Mpe(n){const e={},t=v(n,["voiceName"]);return t!=null&&b(e,["voiceName"],t),e}function Dpe(n){const e={},t=v(n,["voiceName"]);return t!=null&&b(e,["voiceName"],t),e}function v8(n){const e={},t=v(n,["prebuiltVoiceConfig"]);return t!=null&&b(e,["prebuiltVoiceConfig"],Mpe(t)),e}function $pe(n){const e={},t=v(n,["prebuiltVoiceConfig"]);return t!=null&&b(e,["prebuiltVoiceConfig"],Dpe(t)),e}function Lpe(n){const e={},t=v(n,["speaker"]);t!=null&&b(e,["speaker"],t);const r=v(n,["voiceConfig"]);return r!=null&&b(e,["voiceConfig"],v8(r)),e}function Upe(n){const e={},t=v(n,["speakerVoiceConfigs"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>Lpe(i))),b(e,["speakerVoiceConfigs"],r)}return e}function jpe(n){const e={},t=v(n,["voiceConfig"]);t!=null&&b(e,["voiceConfig"],v8(t));const r=v(n,["multiSpeakerVoiceConfig"]);r!=null&&b(e,["multiSpeakerVoiceConfig"],Upe(r));const i=v(n,["languageCode"]);return i!=null&&b(e,["languageCode"],i),e}function Fpe(n){const e={},t=v(n,["voiceConfig"]);if(t!=null&&b(e,["voiceConfig"],$pe(t)),v(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const r=v(n,["languageCode"]);return r!=null&&b(e,["languageCode"],r),e}function Bpe(n){const e={},t=v(n,["fps"]);t!=null&&b(e,["fps"],t);const r=v(n,["endOffset"]);r!=null&&b(e,["endOffset"],r);const i=v(n,["startOffset"]);return i!=null&&b(e,["startOffset"],i),e}function qpe(n){const e={},t=v(n,["fps"]);t!=null&&b(e,["fps"],t);const r=v(n,["endOffset"]);r!=null&&b(e,["endOffset"],r);const i=v(n,["startOffset"]);return i!=null&&b(e,["startOffset"],i),e}function Vpe(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["data"]);t!=null&&b(e,["data"],t);const r=v(n,["mimeType"]);return r!=null&&b(e,["mimeType"],r),e}function zpe(n){const e={},t=v(n,["displayName"]);t!=null&&b(e,["displayName"],t);const r=v(n,["data"]);r!=null&&b(e,["data"],r);const i=v(n,["mimeType"]);return i!=null&&b(e,["mimeType"],i),e}function Hpe(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["fileUri"]);t!=null&&b(e,["fileUri"],t);const r=v(n,["mimeType"]);return r!=null&&b(e,["mimeType"],r),e}function Gpe(n){const e={},t=v(n,["displayName"]);t!=null&&b(e,["displayName"],t);const r=v(n,["fileUri"]);r!=null&&b(e,["fileUri"],r);const i=v(n,["mimeType"]);return i!=null&&b(e,["mimeType"],i),e}function Wpe(n){const e={},t=v(n,["videoMetadata"]);t!=null&&b(e,["videoMetadata"],Bpe(t));const r=v(n,["thought"]);r!=null&&b(e,["thought"],r);const i=v(n,["inlineData"]);i!=null&&b(e,["inlineData"],Vpe(i));const a=v(n,["fileData"]);a!=null&&b(e,["fileData"],Hpe(a));const s=v(n,["thoughtSignature"]);s!=null&&b(e,["thoughtSignature"],s);const o=v(n,["codeExecutionResult"]);o!=null&&b(e,["codeExecutionResult"],o);const u=v(n,["executableCode"]);u!=null&&b(e,["executableCode"],u);const c=v(n,["functionCall"]);c!=null&&b(e,["functionCall"],c);const d=v(n,["functionResponse"]);d!=null&&b(e,["functionResponse"],d);const h=v(n,["text"]);return h!=null&&b(e,["text"],h),e}function Kpe(n){const e={},t=v(n,["videoMetadata"]);t!=null&&b(e,["videoMetadata"],qpe(t));const r=v(n,["thought"]);r!=null&&b(e,["thought"],r);const i=v(n,["inlineData"]);i!=null&&b(e,["inlineData"],zpe(i));const a=v(n,["fileData"]);a!=null&&b(e,["fileData"],Gpe(a));const s=v(n,["thoughtSignature"]);s!=null&&b(e,["thoughtSignature"],s);const o=v(n,["codeExecutionResult"]);o!=null&&b(e,["codeExecutionResult"],o);const u=v(n,["executableCode"]);u!=null&&b(e,["executableCode"],u);const c=v(n,["functionCall"]);c!=null&&b(e,["functionCall"],c);const d=v(n,["functionResponse"]);d!=null&&b(e,["functionResponse"],d);const h=v(n,["text"]);return h!=null&&b(e,["text"],h),e}function Jpe(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>Wpe(a))),b(e,["parts"],i)}const r=v(n,["role"]);return r!=null&&b(e,["role"],r),e}function Ype(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>Kpe(a))),b(e,["parts"],i)}const r=v(n,["role"]);return r!=null&&b(e,["role"],r),e}function Zpe(n){const e={},t=v(n,["behavior"]);t!=null&&b(e,["behavior"],t);const r=v(n,["description"]);r!=null&&b(e,["description"],r);const i=v(n,["name"]);i!=null&&b(e,["name"],i);const a=v(n,["parameters"]);a!=null&&b(e,["parameters"],a);const s=v(n,["parametersJsonSchema"]);s!=null&&b(e,["parametersJsonSchema"],s);const o=v(n,["response"]);o!=null&&b(e,["response"],o);const u=v(n,["responseJsonSchema"]);return u!=null&&b(e,["responseJsonSchema"],u),e}function Xpe(n){const e={};if(v(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=v(n,["description"]);t!=null&&b(e,["description"],t);const r=v(n,["name"]);r!=null&&b(e,["name"],r);const i=v(n,["parameters"]);i!=null&&b(e,["parameters"],i);const a=v(n,["parametersJsonSchema"]);a!=null&&b(e,["parametersJsonSchema"],a);const s=v(n,["response"]);s!=null&&b(e,["response"],s);const o=v(n,["responseJsonSchema"]);return o!=null&&b(e,["responseJsonSchema"],o),e}function Qpe(n){const e={},t=v(n,["startTime"]);t!=null&&b(e,["startTime"],t);const r=v(n,["endTime"]);return r!=null&&b(e,["endTime"],r),e}function eme(n){const e={},t=v(n,["startTime"]);t!=null&&b(e,["startTime"],t);const r=v(n,["endTime"]);return r!=null&&b(e,["endTime"],r),e}function tme(n){const e={},t=v(n,["timeRangeFilter"]);return t!=null&&b(e,["timeRangeFilter"],Qpe(t)),e}function nme(n){const e={},t=v(n,["timeRangeFilter"]);return t!=null&&b(e,["timeRangeFilter"],eme(t)),e}function rme(n){const e={},t=v(n,["mode"]);t!=null&&b(e,["mode"],t);const r=v(n,["dynamicThreshold"]);return r!=null&&b(e,["dynamicThreshold"],r),e}function ime(n){const e={},t=v(n,["mode"]);t!=null&&b(e,["mode"],t);const r=v(n,["dynamicThreshold"]);return r!=null&&b(e,["dynamicThreshold"],r),e}function ame(n){const e={},t=v(n,["dynamicRetrievalConfig"]);return t!=null&&b(e,["dynamicRetrievalConfig"],rme(t)),e}function sme(n){const e={},t=v(n,["dynamicRetrievalConfig"]);return t!=null&&b(e,["dynamicRetrievalConfig"],ime(t)),e}function ome(){return{}}function lme(n){const e={},t=v(n,["apiKeyString"]);return t!=null&&b(e,["apiKeyString"],t),e}function ume(n){const e={},t=v(n,["apiKeyConfig"]);t!=null&&b(e,["apiKeyConfig"],lme(t));const r=v(n,["authType"]);r!=null&&b(e,["authType"],r);const i=v(n,["googleServiceAccountConfig"]);i!=null&&b(e,["googleServiceAccountConfig"],i);const a=v(n,["httpBasicAuthConfig"]);a!=null&&b(e,["httpBasicAuthConfig"],a);const s=v(n,["oauthConfig"]);s!=null&&b(e,["oauthConfig"],s);const o=v(n,["oidcConfig"]);return o!=null&&b(e,["oidcConfig"],o),e}function cme(n){const e={},t=v(n,["authConfig"]);return t!=null&&b(e,["authConfig"],ume(t)),e}function fme(){return{}}function dme(){return{}}function hme(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(u=>Zpe(u))),b(e,["functionDeclarations"],o)}if(v(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=v(n,["googleSearch"]);r!=null&&b(e,["googleSearch"],tme(r));const i=v(n,["googleSearchRetrieval"]);if(i!=null&&b(e,["googleSearchRetrieval"],ame(i)),v(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(v(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");v(n,["urlContext"])!=null&&b(e,["urlContext"],fme());const s=v(n,["codeExecution"]);return s!=null&&b(e,["codeExecution"],s),e}function pme(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(h=>Xpe(h))),b(e,["functionDeclarations"],d)}const r=v(n,["retrieval"]);r!=null&&b(e,["retrieval"],r);const i=v(n,["googleSearch"]);i!=null&&b(e,["googleSearch"],nme(i));const a=v(n,["googleSearchRetrieval"]);a!=null&&b(e,["googleSearchRetrieval"],sme(a)),v(n,["enterpriseWebSearch"])!=null&&b(e,["enterpriseWebSearch"],ome());const o=v(n,["googleMaps"]);o!=null&&b(e,["googleMaps"],cme(o)),v(n,["urlContext"])!=null&&b(e,["urlContext"],dme());const c=v(n,["codeExecution"]);return c!=null&&b(e,["codeExecution"],c),e}function mme(n){const e={},t=v(n,["handle"]);if(t!=null&&b(e,["handle"],t),v(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function gme(n){const e={},t=v(n,["handle"]);t!=null&&b(e,["handle"],t);const r=v(n,["transparent"]);return r!=null&&b(e,["transparent"],r),e}function cB(){return{}}function fB(){return{}}function yme(n){const e={},t=v(n,["disabled"]);t!=null&&b(e,["disabled"],t);const r=v(n,["startOfSpeechSensitivity"]);r!=null&&b(e,["startOfSpeechSensitivity"],r);const i=v(n,["endOfSpeechSensitivity"]);i!=null&&b(e,["endOfSpeechSensitivity"],i);const a=v(n,["prefixPaddingMs"]);a!=null&&b(e,["prefixPaddingMs"],a);const s=v(n,["silenceDurationMs"]);return s!=null&&b(e,["silenceDurationMs"],s),e}function vme(n){const e={},t=v(n,["disabled"]);t!=null&&b(e,["disabled"],t);const r=v(n,["startOfSpeechSensitivity"]);r!=null&&b(e,["startOfSpeechSensitivity"],r);const i=v(n,["endOfSpeechSensitivity"]);i!=null&&b(e,["endOfSpeechSensitivity"],i);const a=v(n,["prefixPaddingMs"]);a!=null&&b(e,["prefixPaddingMs"],a);const s=v(n,["silenceDurationMs"]);return s!=null&&b(e,["silenceDurationMs"],s),e}function _me(n){const e={},t=v(n,["automaticActivityDetection"]);t!=null&&b(e,["automaticActivityDetection"],yme(t));const r=v(n,["activityHandling"]);r!=null&&b(e,["activityHandling"],r);const i=v(n,["turnCoverage"]);return i!=null&&b(e,["turnCoverage"],i),e}function bme(n){const e={},t=v(n,["automaticActivityDetection"]);t!=null&&b(e,["automaticActivityDetection"],vme(t));const r=v(n,["activityHandling"]);r!=null&&b(e,["activityHandling"],r);const i=v(n,["turnCoverage"]);return i!=null&&b(e,["turnCoverage"],i),e}function wme(n){const e={},t=v(n,["targetTokens"]);return t!=null&&b(e,["targetTokens"],t),e}function Eme(n){const e={},t=v(n,["targetTokens"]);return t!=null&&b(e,["targetTokens"],t),e}function Sme(n){const e={},t=v(n,["triggerTokens"]);t!=null&&b(e,["triggerTokens"],t);const r=v(n,["slidingWindow"]);return r!=null&&b(e,["slidingWindow"],wme(r)),e}function Tme(n){const e={},t=v(n,["triggerTokens"]);t!=null&&b(e,["triggerTokens"],t);const r=v(n,["slidingWindow"]);return r!=null&&b(e,["slidingWindow"],Eme(r)),e}function Ame(n){const e={},t=v(n,["proactiveAudio"]);return t!=null&&b(e,["proactiveAudio"],t),e}function Cme(n){const e={},t=v(n,["proactiveAudio"]);return t!=null&&b(e,["proactiveAudio"],t),e}function xme(n,e){const t={},r=v(n,["generationConfig"]);e!==void 0&&r!=null&&b(e,["setup","generationConfig"],r);const i=v(n,["responseModalities"]);e!==void 0&&i!=null&&b(e,["setup","generationConfig","responseModalities"],i);const a=v(n,["temperature"]);e!==void 0&&a!=null&&b(e,["setup","generationConfig","temperature"],a);const s=v(n,["topP"]);e!==void 0&&s!=null&&b(e,["setup","generationConfig","topP"],s);const o=v(n,["topK"]);e!==void 0&&o!=null&&b(e,["setup","generationConfig","topK"],o);const u=v(n,["maxOutputTokens"]);e!==void 0&&u!=null&&b(e,["setup","generationConfig","maxOutputTokens"],u);const c=v(n,["mediaResolution"]);e!==void 0&&c!=null&&b(e,["setup","generationConfig","mediaResolution"],c);const d=v(n,["seed"]);e!==void 0&&d!=null&&b(e,["setup","generationConfig","seed"],d);const h=v(n,["speechConfig"]);e!==void 0&&h!=null&&b(e,["setup","generationConfig","speechConfig"],jpe(LP(h)));const m=v(n,["enableAffectiveDialog"]);e!==void 0&&m!=null&&b(e,["setup","generationConfig","enableAffectiveDialog"],m);const g=v(n,["systemInstruction"]);e!==void 0&&g!=null&&b(e,["setup","systemInstruction"],Jpe(vi(g)));const _=v(n,["tools"]);if(e!==void 0&&_!=null){let P=cg(_);Array.isArray(P)&&(P=P.map(N=>hme(ug(N)))),b(e,["setup","tools"],P)}const w=v(n,["sessionResumption"]);e!==void 0&&w!=null&&b(e,["setup","sessionResumption"],mme(w));const S=v(n,["inputAudioTranscription"]);e!==void 0&&S!=null&&b(e,["setup","inputAudioTranscription"],cB());const E=v(n,["outputAudioTranscription"]);e!==void 0&&E!=null&&b(e,["setup","outputAudioTranscription"],cB());const C=v(n,["realtimeInputConfig"]);e!==void 0&&C!=null&&b(e,["setup","realtimeInputConfig"],_me(C));const A=v(n,["contextWindowCompression"]);e!==void 0&&A!=null&&b(e,["setup","contextWindowCompression"],Sme(A));const R=v(n,["proactivity"]);return e!==void 0&&R!=null&&b(e,["setup","proactivity"],Ame(R)),t}function Rme(n,e){const t={},r=v(n,["generationConfig"]);e!==void 0&&r!=null&&b(e,["setup","generationConfig"],r);const i=v(n,["responseModalities"]);e!==void 0&&i!=null&&b(e,["setup","generationConfig","responseModalities"],i);const a=v(n,["temperature"]);e!==void 0&&a!=null&&b(e,["setup","generationConfig","temperature"],a);const s=v(n,["topP"]);e!==void 0&&s!=null&&b(e,["setup","generationConfig","topP"],s);const o=v(n,["topK"]);e!==void 0&&o!=null&&b(e,["setup","generationConfig","topK"],o);const u=v(n,["maxOutputTokens"]);e!==void 0&&u!=null&&b(e,["setup","generationConfig","maxOutputTokens"],u);const c=v(n,["mediaResolution"]);e!==void 0&&c!=null&&b(e,["setup","generationConfig","mediaResolution"],c);const d=v(n,["seed"]);e!==void 0&&d!=null&&b(e,["setup","generationConfig","seed"],d);const h=v(n,["speechConfig"]);e!==void 0&&h!=null&&b(e,["setup","generationConfig","speechConfig"],Fpe(LP(h)));const m=v(n,["enableAffectiveDialog"]);e!==void 0&&m!=null&&b(e,["setup","generationConfig","enableAffectiveDialog"],m);const g=v(n,["systemInstruction"]);e!==void 0&&g!=null&&b(e,["setup","systemInstruction"],Ype(vi(g)));const _=v(n,["tools"]);if(e!==void 0&&_!=null){let P=cg(_);Array.isArray(P)&&(P=P.map(N=>pme(ug(N)))),b(e,["setup","tools"],P)}const w=v(n,["sessionResumption"]);e!==void 0&&w!=null&&b(e,["setup","sessionResumption"],gme(w));const S=v(n,["inputAudioTranscription"]);e!==void 0&&S!=null&&b(e,["setup","inputAudioTranscription"],fB());const E=v(n,["outputAudioTranscription"]);e!==void 0&&E!=null&&b(e,["setup","outputAudioTranscription"],fB());const C=v(n,["realtimeInputConfig"]);e!==void 0&&C!=null&&b(e,["setup","realtimeInputConfig"],bme(C));const A=v(n,["contextWindowCompression"]);e!==void 0&&A!=null&&b(e,["setup","contextWindowCompression"],Tme(A));const R=v(n,["proactivity"]);return e!==void 0&&R!=null&&b(e,["setup","proactivity"],Cme(R)),t}function Ime(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["setup","model"],Nn(n,r));const i=v(e,["config"]);return i!=null&&b(t,["config"],xme(i,t)),t}function Pme(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["setup","model"],Nn(n,r));const i=v(e,["config"]);return i!=null&&b(t,["config"],Rme(i,t)),t}function Ome(){return{}}function kme(){return{}}function Nme(){return{}}function Mme(){return{}}function Dme(n){const e={},t=v(n,["media"]);t!=null&&b(e,["mediaChunks"],u8(t));const r=v(n,["audio"]);r!=null&&b(e,["audio"],rhe(r));const i=v(n,["audioStreamEnd"]);i!=null&&b(e,["audioStreamEnd"],i);const a=v(n,["video"]);a!=null&&b(e,["video"],nhe(a));const s=v(n,["text"]);return s!=null&&b(e,["text"],s),v(n,["activityStart"])!=null&&b(e,["activityStart"],Ome()),v(n,["activityEnd"])!=null&&b(e,["activityEnd"],Nme()),e}function $me(n){const e={},t=v(n,["media"]);if(t!=null&&b(e,["mediaChunks"],u8(t)),v(n,["audio"])!==void 0)throw new Error("audio parameter is not supported in Vertex AI.");const r=v(n,["audioStreamEnd"]);if(r!=null&&b(e,["audioStreamEnd"],r),v(n,["video"])!==void 0)throw new Error("video parameter is not supported in Vertex AI.");if(v(n,["text"])!==void 0)throw new Error("text parameter is not supported in Vertex AI.");return v(n,["activityStart"])!=null&&b(e,["activityStart"],kme()),v(n,["activityEnd"])!=null&&b(e,["activityEnd"],Mme()),e}function _8(n){const e={},t=v(n,["text"]);t!=null&&b(e,["text"],t);const r=v(n,["weight"]);return r!=null&&b(e,["weight"],r),e}function Lme(n){const e={},t=v(n,["weightedPrompts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>_8(i))),b(e,["weightedPrompts"],r)}return e}function b8(n){const e={},t=v(n,["temperature"]);t!=null&&b(e,["temperature"],t);const r=v(n,["topK"]);r!=null&&b(e,["topK"],r);const i=v(n,["seed"]);i!=null&&b(e,["seed"],i);const a=v(n,["guidance"]);a!=null&&b(e,["guidance"],a);const s=v(n,["bpm"]);s!=null&&b(e,["bpm"],s);const o=v(n,["density"]);o!=null&&b(e,["density"],o);const u=v(n,["brightness"]);u!=null&&b(e,["brightness"],u);const c=v(n,["scale"]);c!=null&&b(e,["scale"],c);const d=v(n,["muteBass"]);d!=null&&b(e,["muteBass"],d);const h=v(n,["muteDrums"]);h!=null&&b(e,["muteDrums"],h);const m=v(n,["onlyBassAndDrums"]);return m!=null&&b(e,["onlyBassAndDrums"],m),e}function Ume(n){const e={},t=v(n,["musicGenerationConfig"]);return t!=null&&b(e,["musicGenerationConfig"],b8(t)),e}function w8(n){const e={},t=v(n,["model"]);return t!=null&&b(e,["model"],t),e}function E8(n){const e={},t=v(n,["weightedPrompts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>_8(i))),b(e,["weightedPrompts"],r)}return e}function gR(n){const e={},t=v(n,["setup"]);t!=null&&b(e,["setup"],w8(t));const r=v(n,["clientContent"]);r!=null&&b(e,["clientContent"],E8(r));const i=v(n,["musicGenerationConfig"]);i!=null&&b(e,["musicGenerationConfig"],b8(i));const a=v(n,["playbackControl"]);return a!=null&&b(e,["playbackControl"],a),e}function jme(){return{}}function Fme(){return{}}function Bme(n){const e={},t=v(n,["fps"]);t!=null&&b(e,["fps"],t);const r=v(n,["endOffset"]);r!=null&&b(e,["endOffset"],r);const i=v(n,["startOffset"]);return i!=null&&b(e,["startOffset"],i),e}function qme(n){const e={},t=v(n,["fps"]);t!=null&&b(e,["fps"],t);const r=v(n,["endOffset"]);r!=null&&b(e,["endOffset"],r);const i=v(n,["startOffset"]);return i!=null&&b(e,["startOffset"],i),e}function Vme(n){const e={},t=v(n,["data"]);t!=null&&b(e,["data"],t);const r=v(n,["mimeType"]);return r!=null&&b(e,["mimeType"],r),e}function zme(n){const e={},t=v(n,["displayName"]);t!=null&&b(e,["displayName"],t);const r=v(n,["data"]);r!=null&&b(e,["data"],r);const i=v(n,["mimeType"]);return i!=null&&b(e,["mimeType"],i),e}function Hme(n){const e={},t=v(n,["fileUri"]);t!=null&&b(e,["fileUri"],t);const r=v(n,["mimeType"]);return r!=null&&b(e,["mimeType"],r),e}function Gme(n){const e={},t=v(n,["displayName"]);t!=null&&b(e,["displayName"],t);const r=v(n,["fileUri"]);r!=null&&b(e,["fileUri"],r);const i=v(n,["mimeType"]);return i!=null&&b(e,["mimeType"],i),e}function Wme(n){const e={},t=v(n,["videoMetadata"]);t!=null&&b(e,["videoMetadata"],Bme(t));const r=v(n,["thought"]);r!=null&&b(e,["thought"],r);const i=v(n,["inlineData"]);i!=null&&b(e,["inlineData"],Vme(i));const a=v(n,["fileData"]);a!=null&&b(e,["fileData"],Hme(a));const s=v(n,["thoughtSignature"]);s!=null&&b(e,["thoughtSignature"],s);const o=v(n,["codeExecutionResult"]);o!=null&&b(e,["codeExecutionResult"],o);const u=v(n,["executableCode"]);u!=null&&b(e,["executableCode"],u);const c=v(n,["functionCall"]);c!=null&&b(e,["functionCall"],c);const d=v(n,["functionResponse"]);d!=null&&b(e,["functionResponse"],d);const h=v(n,["text"]);return h!=null&&b(e,["text"],h),e}function Kme(n){const e={},t=v(n,["videoMetadata"]);t!=null&&b(e,["videoMetadata"],qme(t));const r=v(n,["thought"]);r!=null&&b(e,["thought"],r);const i=v(n,["inlineData"]);i!=null&&b(e,["inlineData"],zme(i));const a=v(n,["fileData"]);a!=null&&b(e,["fileData"],Gme(a));const s=v(n,["thoughtSignature"]);s!=null&&b(e,["thoughtSignature"],s);const o=v(n,["codeExecutionResult"]);o!=null&&b(e,["codeExecutionResult"],o);const u=v(n,["executableCode"]);u!=null&&b(e,["executableCode"],u);const c=v(n,["functionCall"]);c!=null&&b(e,["functionCall"],c);const d=v(n,["functionResponse"]);d!=null&&b(e,["functionResponse"],d);const h=v(n,["text"]);return h!=null&&b(e,["text"],h),e}function Jme(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>Wme(a))),b(e,["parts"],i)}const r=v(n,["role"]);return r!=null&&b(e,["role"],r),e}function Yme(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>Kme(a))),b(e,["parts"],i)}const r=v(n,["role"]);return r!=null&&b(e,["role"],r),e}function dB(n){const e={},t=v(n,["text"]);t!=null&&b(e,["text"],t);const r=v(n,["finished"]);return r!=null&&b(e,["finished"],r),e}function hB(n){const e={},t=v(n,["text"]);t!=null&&b(e,["text"],t);const r=v(n,["finished"]);return r!=null&&b(e,["finished"],r),e}function Zme(n){const e={},t=v(n,["retrievedUrl"]);t!=null&&b(e,["retrievedUrl"],t);const r=v(n,["urlRetrievalStatus"]);return r!=null&&b(e,["urlRetrievalStatus"],r),e}function Xme(n){const e={},t=v(n,["urlMetadata"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>Zme(i))),b(e,["urlMetadata"],r)}return e}function Qme(n){const e={},t=v(n,["modelTurn"]);t!=null&&b(e,["modelTurn"],Jme(t));const r=v(n,["turnComplete"]);r!=null&&b(e,["turnComplete"],r);const i=v(n,["interrupted"]);i!=null&&b(e,["interrupted"],i);const a=v(n,["groundingMetadata"]);a!=null&&b(e,["groundingMetadata"],a);const s=v(n,["generationComplete"]);s!=null&&b(e,["generationComplete"],s);const o=v(n,["inputTranscription"]);o!=null&&b(e,["inputTranscription"],dB(o));const u=v(n,["outputTranscription"]);u!=null&&b(e,["outputTranscription"],dB(u));const c=v(n,["urlContextMetadata"]);return c!=null&&b(e,["urlContextMetadata"],Xme(c)),e}function ege(n){const e={},t=v(n,["modelTurn"]);t!=null&&b(e,["modelTurn"],Yme(t));const r=v(n,["turnComplete"]);r!=null&&b(e,["turnComplete"],r);const i=v(n,["interrupted"]);i!=null&&b(e,["interrupted"],i);const a=v(n,["groundingMetadata"]);a!=null&&b(e,["groundingMetadata"],a);const s=v(n,["generationComplete"]);s!=null&&b(e,["generationComplete"],s);const o=v(n,["inputTranscription"]);o!=null&&b(e,["inputTranscription"],hB(o));const u=v(n,["outputTranscription"]);return u!=null&&b(e,["outputTranscription"],hB(u)),e}function tge(n){const e={},t=v(n,["id"]);t!=null&&b(e,["id"],t);const r=v(n,["args"]);r!=null&&b(e,["args"],r);const i=v(n,["name"]);return i!=null&&b(e,["name"],i),e}function nge(n){const e={},t=v(n,["args"]);t!=null&&b(e,["args"],t);const r=v(n,["name"]);return r!=null&&b(e,["name"],r),e}function rge(n){const e={},t=v(n,["functionCalls"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>tge(i))),b(e,["functionCalls"],r)}return e}function ige(n){const e={},t=v(n,["functionCalls"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>nge(i))),b(e,["functionCalls"],r)}return e}function age(n){const e={},t=v(n,["ids"]);return t!=null&&b(e,["ids"],t),e}function sge(n){const e={},t=v(n,["ids"]);return t!=null&&b(e,["ids"],t),e}function _v(n){const e={},t=v(n,["modality"]);t!=null&&b(e,["modality"],t);const r=v(n,["tokenCount"]);return r!=null&&b(e,["tokenCount"],r),e}function bv(n){const e={},t=v(n,["modality"]);t!=null&&b(e,["modality"],t);const r=v(n,["tokenCount"]);return r!=null&&b(e,["tokenCount"],r),e}function oge(n){const e={},t=v(n,["promptTokenCount"]);t!=null&&b(e,["promptTokenCount"],t);const r=v(n,["cachedContentTokenCount"]);r!=null&&b(e,["cachedContentTokenCount"],r);const i=v(n,["responseTokenCount"]);i!=null&&b(e,["responseTokenCount"],i);const a=v(n,["toolUsePromptTokenCount"]);a!=null&&b(e,["toolUsePromptTokenCount"],a);const s=v(n,["thoughtsTokenCount"]);s!=null&&b(e,["thoughtsTokenCount"],s);const o=v(n,["totalTokenCount"]);o!=null&&b(e,["totalTokenCount"],o);const u=v(n,["promptTokensDetails"]);if(u!=null){let m=u;Array.isArray(m)&&(m=m.map(g=>_v(g))),b(e,["promptTokensDetails"],m)}const c=v(n,["cacheTokensDetails"]);if(c!=null){let m=c;Array.isArray(m)&&(m=m.map(g=>_v(g))),b(e,["cacheTokensDetails"],m)}const d=v(n,["responseTokensDetails"]);if(d!=null){let m=d;Array.isArray(m)&&(m=m.map(g=>_v(g))),b(e,["responseTokensDetails"],m)}const h=v(n,["toolUsePromptTokensDetails"]);if(h!=null){let m=h;Array.isArray(m)&&(m=m.map(g=>_v(g))),b(e,["toolUsePromptTokensDetails"],m)}return e}function lge(n){const e={},t=v(n,["promptTokenCount"]);t!=null&&b(e,["promptTokenCount"],t);const r=v(n,["cachedContentTokenCount"]);r!=null&&b(e,["cachedContentTokenCount"],r);const i=v(n,["candidatesTokenCount"]);i!=null&&b(e,["responseTokenCount"],i);const a=v(n,["toolUsePromptTokenCount"]);a!=null&&b(e,["toolUsePromptTokenCount"],a);const s=v(n,["thoughtsTokenCount"]);s!=null&&b(e,["thoughtsTokenCount"],s);const o=v(n,["totalTokenCount"]);o!=null&&b(e,["totalTokenCount"],o);const u=v(n,["promptTokensDetails"]);if(u!=null){let g=u;Array.isArray(g)&&(g=g.map(_=>bv(_))),b(e,["promptTokensDetails"],g)}const c=v(n,["cacheTokensDetails"]);if(c!=null){let g=c;Array.isArray(g)&&(g=g.map(_=>bv(_))),b(e,["cacheTokensDetails"],g)}const d=v(n,["candidatesTokensDetails"]);if(d!=null){let g=d;Array.isArray(g)&&(g=g.map(_=>bv(_))),b(e,["responseTokensDetails"],g)}const h=v(n,["toolUsePromptTokensDetails"]);if(h!=null){let g=h;Array.isArray(g)&&(g=g.map(_=>bv(_))),b(e,["toolUsePromptTokensDetails"],g)}const m=v(n,["trafficType"]);return m!=null&&b(e,["trafficType"],m),e}function uge(n){const e={},t=v(n,["timeLeft"]);return t!=null&&b(e,["timeLeft"],t),e}function cge(n){const e={},t=v(n,["timeLeft"]);return t!=null&&b(e,["timeLeft"],t),e}function fge(n){const e={},t=v(n,["newHandle"]);t!=null&&b(e,["newHandle"],t);const r=v(n,["resumable"]);r!=null&&b(e,["resumable"],r);const i=v(n,["lastConsumedClientMessageIndex"]);return i!=null&&b(e,["lastConsumedClientMessageIndex"],i),e}function dge(n){const e={},t=v(n,["newHandle"]);t!=null&&b(e,["newHandle"],t);const r=v(n,["resumable"]);r!=null&&b(e,["resumable"],r);const i=v(n,["lastConsumedClientMessageIndex"]);return i!=null&&b(e,["lastConsumedClientMessageIndex"],i),e}function hge(n){const e={};v(n,["setupComplete"])!=null&&b(e,["setupComplete"],jme());const r=v(n,["serverContent"]);r!=null&&b(e,["serverContent"],Qme(r));const i=v(n,["toolCall"]);i!=null&&b(e,["toolCall"],rge(i));const a=v(n,["toolCallCancellation"]);a!=null&&b(e,["toolCallCancellation"],age(a));const s=v(n,["usageMetadata"]);s!=null&&b(e,["usageMetadata"],oge(s));const o=v(n,["goAway"]);o!=null&&b(e,["goAway"],uge(o));const u=v(n,["sessionResumptionUpdate"]);return u!=null&&b(e,["sessionResumptionUpdate"],fge(u)),e}function pge(n){const e={};v(n,["setupComplete"])!=null&&b(e,["setupComplete"],Fme());const r=v(n,["serverContent"]);r!=null&&b(e,["serverContent"],ege(r));const i=v(n,["toolCall"]);i!=null&&b(e,["toolCall"],ige(i));const a=v(n,["toolCallCancellation"]);a!=null&&b(e,["toolCallCancellation"],sge(a));const s=v(n,["usageMetadata"]);s!=null&&b(e,["usageMetadata"],lge(s));const o=v(n,["goAway"]);o!=null&&b(e,["goAway"],cge(o));const u=v(n,["sessionResumptionUpdate"]);return u!=null&&b(e,["sessionResumptionUpdate"],dge(u)),e}function mge(){return{}}function gge(n){const e={},t=v(n,["text"]);t!=null&&b(e,["text"],t);const r=v(n,["weight"]);return r!=null&&b(e,["weight"],r),e}function yge(n){const e={},t=v(n,["weightedPrompts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>gge(i))),b(e,["weightedPrompts"],r)}return e}function vge(n){const e={},t=v(n,["temperature"]);t!=null&&b(e,["temperature"],t);const r=v(n,["topK"]);r!=null&&b(e,["topK"],r);const i=v(n,["seed"]);i!=null&&b(e,["seed"],i);const a=v(n,["guidance"]);a!=null&&b(e,["guidance"],a);const s=v(n,["bpm"]);s!=null&&b(e,["bpm"],s);const o=v(n,["density"]);o!=null&&b(e,["density"],o);const u=v(n,["brightness"]);u!=null&&b(e,["brightness"],u);const c=v(n,["scale"]);c!=null&&b(e,["scale"],c);const d=v(n,["muteBass"]);d!=null&&b(e,["muteBass"],d);const h=v(n,["muteDrums"]);h!=null&&b(e,["muteDrums"],h);const m=v(n,["onlyBassAndDrums"]);return m!=null&&b(e,["onlyBassAndDrums"],m),e}function _ge(n){const e={},t=v(n,["clientContent"]);t!=null&&b(e,["clientContent"],yge(t));const r=v(n,["musicGenerationConfig"]);return r!=null&&b(e,["musicGenerationConfig"],vge(r)),e}function bge(n){const e={},t=v(n,["data"]);t!=null&&b(e,["data"],t);const r=v(n,["mimeType"]);r!=null&&b(e,["mimeType"],r);const i=v(n,["sourceMetadata"]);return i!=null&&b(e,["sourceMetadata"],_ge(i)),e}function wge(n){const e={},t=v(n,["audioChunks"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>bge(i))),b(e,["audioChunks"],r)}return e}function Ege(n){const e={},t=v(n,["text"]);t!=null&&b(e,["text"],t);const r=v(n,["filteredReason"]);return r!=null&&b(e,["filteredReason"],r),e}function Sge(n){const e={};v(n,["setupComplete"])!=null&&b(e,["setupComplete"],mge());const r=v(n,["serverContent"]);r!=null&&b(e,["serverContent"],wge(r));const i=v(n,["filteredPrompt"]);return i!=null&&b(e,["filteredPrompt"],Ege(i)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Tge(n){const e={},t=v(n,["fps"]);t!=null&&b(e,["fps"],t);const r=v(n,["endOffset"]);r!=null&&b(e,["endOffset"],r);const i=v(n,["startOffset"]);return i!=null&&b(e,["startOffset"],i),e}function Age(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["data"]);t!=null&&b(e,["data"],t);const r=v(n,["mimeType"]);return r!=null&&b(e,["mimeType"],r),e}function Cge(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["fileUri"]);t!=null&&b(e,["fileUri"],t);const r=v(n,["mimeType"]);return r!=null&&b(e,["mimeType"],r),e}function xge(n){const e={},t=v(n,["videoMetadata"]);t!=null&&b(e,["videoMetadata"],Tge(t));const r=v(n,["thought"]);r!=null&&b(e,["thought"],r);const i=v(n,["inlineData"]);i!=null&&b(e,["inlineData"],Age(i));const a=v(n,["fileData"]);a!=null&&b(e,["fileData"],Cge(a));const s=v(n,["thoughtSignature"]);s!=null&&b(e,["thoughtSignature"],s);const o=v(n,["codeExecutionResult"]);o!=null&&b(e,["codeExecutionResult"],o);const u=v(n,["executableCode"]);u!=null&&b(e,["executableCode"],u);const c=v(n,["functionCall"]);c!=null&&b(e,["functionCall"],c);const d=v(n,["functionResponse"]);d!=null&&b(e,["functionResponse"],d);const h=v(n,["text"]);return h!=null&&b(e,["text"],h),e}function mw(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>xge(a))),b(e,["parts"],i)}const r=v(n,["role"]);return r!=null&&b(e,["role"],r),e}function Rge(n){const e={},t=v(n,["anyOf"]);t!=null&&b(e,["anyOf"],t);const r=v(n,["default"]);r!=null&&b(e,["default"],r);const i=v(n,["description"]);i!=null&&b(e,["description"],i);const a=v(n,["enum"]);a!=null&&b(e,["enum"],a);const s=v(n,["example"]);s!=null&&b(e,["example"],s);const o=v(n,["format"]);o!=null&&b(e,["format"],o);const u=v(n,["items"]);u!=null&&b(e,["items"],u);const c=v(n,["maxItems"]);c!=null&&b(e,["maxItems"],c);const d=v(n,["maxLength"]);d!=null&&b(e,["maxLength"],d);const h=v(n,["maxProperties"]);h!=null&&b(e,["maxProperties"],h);const m=v(n,["maximum"]);m!=null&&b(e,["maximum"],m);const g=v(n,["minItems"]);g!=null&&b(e,["minItems"],g);const _=v(n,["minLength"]);_!=null&&b(e,["minLength"],_);const w=v(n,["minProperties"]);w!=null&&b(e,["minProperties"],w);const S=v(n,["minimum"]);S!=null&&b(e,["minimum"],S);const E=v(n,["nullable"]);E!=null&&b(e,["nullable"],E);const C=v(n,["pattern"]);C!=null&&b(e,["pattern"],C);const A=v(n,["properties"]);A!=null&&b(e,["properties"],A);const R=v(n,["propertyOrdering"]);R!=null&&b(e,["propertyOrdering"],R);const P=v(n,["required"]);P!=null&&b(e,["required"],P);const N=v(n,["title"]);N!=null&&b(e,["title"],N);const U=v(n,["type"]);return U!=null&&b(e,["type"],U),e}function Ige(n){const e={};if(v(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const t=v(n,["category"]);t!=null&&b(e,["category"],t);const r=v(n,["threshold"]);return r!=null&&b(e,["threshold"],r),e}function Pge(n){const e={},t=v(n,["behavior"]);t!=null&&b(e,["behavior"],t);const r=v(n,["description"]);r!=null&&b(e,["description"],r);const i=v(n,["name"]);i!=null&&b(e,["name"],i);const a=v(n,["parameters"]);a!=null&&b(e,["parameters"],a);const s=v(n,["parametersJsonSchema"]);s!=null&&b(e,["parametersJsonSchema"],s);const o=v(n,["response"]);o!=null&&b(e,["response"],o);const u=v(n,["responseJsonSchema"]);return u!=null&&b(e,["responseJsonSchema"],u),e}function Oge(n){const e={},t=v(n,["startTime"]);t!=null&&b(e,["startTime"],t);const r=v(n,["endTime"]);return r!=null&&b(e,["endTime"],r),e}function kge(n){const e={},t=v(n,["timeRangeFilter"]);return t!=null&&b(e,["timeRangeFilter"],Oge(t)),e}function Nge(n){const e={},t=v(n,["mode"]);t!=null&&b(e,["mode"],t);const r=v(n,["dynamicThreshold"]);return r!=null&&b(e,["dynamicThreshold"],r),e}function Mge(n){const e={},t=v(n,["dynamicRetrievalConfig"]);return t!=null&&b(e,["dynamicRetrievalConfig"],Nge(t)),e}function Dge(){return{}}function $ge(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(u=>Pge(u))),b(e,["functionDeclarations"],o)}if(v(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=v(n,["googleSearch"]);r!=null&&b(e,["googleSearch"],kge(r));const i=v(n,["googleSearchRetrieval"]);if(i!=null&&b(e,["googleSearchRetrieval"],Mge(i)),v(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(v(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");v(n,["urlContext"])!=null&&b(e,["urlContext"],Dge());const s=v(n,["codeExecution"]);return s!=null&&b(e,["codeExecution"],s),e}function Lge(n){const e={},t=v(n,["mode"]);t!=null&&b(e,["mode"],t);const r=v(n,["allowedFunctionNames"]);return r!=null&&b(e,["allowedFunctionNames"],r),e}function Uge(n){const e={},t=v(n,["latitude"]);t!=null&&b(e,["latitude"],t);const r=v(n,["longitude"]);return r!=null&&b(e,["longitude"],r),e}function jge(n){const e={},t=v(n,["latLng"]);t!=null&&b(e,["latLng"],Uge(t));const r=v(n,["languageCode"]);return r!=null&&b(e,["languageCode"],r),e}function Fge(n){const e={},t=v(n,["functionCallingConfig"]);t!=null&&b(e,["functionCallingConfig"],Lge(t));const r=v(n,["retrievalConfig"]);return r!=null&&b(e,["retrievalConfig"],jge(r)),e}function Bge(n){const e={},t=v(n,["voiceName"]);return t!=null&&b(e,["voiceName"],t),e}function S8(n){const e={},t=v(n,["prebuiltVoiceConfig"]);return t!=null&&b(e,["prebuiltVoiceConfig"],Bge(t)),e}function qge(n){const e={},t=v(n,["speaker"]);t!=null&&b(e,["speaker"],t);const r=v(n,["voiceConfig"]);return r!=null&&b(e,["voiceConfig"],S8(r)),e}function Vge(n){const e={},t=v(n,["speakerVoiceConfigs"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>qge(i))),b(e,["speakerVoiceConfigs"],r)}return e}function zge(n){const e={},t=v(n,["voiceConfig"]);t!=null&&b(e,["voiceConfig"],S8(t));const r=v(n,["multiSpeakerVoiceConfig"]);r!=null&&b(e,["multiSpeakerVoiceConfig"],Vge(r));const i=v(n,["languageCode"]);return i!=null&&b(e,["languageCode"],i),e}function Hge(n){const e={},t=v(n,["includeThoughts"]);t!=null&&b(e,["includeThoughts"],t);const r=v(n,["thinkingBudget"]);return r!=null&&b(e,["thinkingBudget"],r),e}function Gge(n,e,t){const r={},i=v(e,["systemInstruction"]);t!==void 0&&i!=null&&b(t,["systemInstruction"],mw(vi(i)));const a=v(e,["temperature"]);a!=null&&b(r,["temperature"],a);const s=v(e,["topP"]);s!=null&&b(r,["topP"],s);const o=v(e,["topK"]);o!=null&&b(r,["topK"],o);const u=v(e,["candidateCount"]);u!=null&&b(r,["candidateCount"],u);const c=v(e,["maxOutputTokens"]);c!=null&&b(r,["maxOutputTokens"],c);const d=v(e,["stopSequences"]);d!=null&&b(r,["stopSequences"],d);const h=v(e,["responseLogprobs"]);h!=null&&b(r,["responseLogprobs"],h);const m=v(e,["logprobs"]);m!=null&&b(r,["logprobs"],m);const g=v(e,["presencePenalty"]);g!=null&&b(r,["presencePenalty"],g);const _=v(e,["frequencyPenalty"]);_!=null&&b(r,["frequencyPenalty"],_);const w=v(e,["seed"]);w!=null&&b(r,["seed"],w);const S=v(e,["responseMimeType"]);S!=null&&b(r,["responseMimeType"],S);const E=v(e,["responseSchema"]);if(E!=null&&b(r,["responseSchema"],Rge(tb(E))),v(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(v(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const C=v(e,["safetySettings"]);if(t!==void 0&&C!=null){let H=C;Array.isArray(H)&&(H=H.map(G=>Ige(G))),b(t,["safetySettings"],H)}const A=v(e,["tools"]);if(t!==void 0&&A!=null){let H=cg(A);Array.isArray(H)&&(H=H.map(G=>$ge(ug(G)))),b(t,["tools"],H)}const R=v(e,["toolConfig"]);if(t!==void 0&&R!=null&&b(t,["toolConfig"],Fge(R)),v(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const P=v(e,["cachedContent"]);t!==void 0&&P!=null&&b(t,["cachedContent"],uu(n,P));const N=v(e,["responseModalities"]);N!=null&&b(r,["responseModalities"],N);const U=v(e,["mediaResolution"]);U!=null&&b(r,["mediaResolution"],U);const k=v(e,["speechConfig"]);if(k!=null&&b(r,["speechConfig"],zge(d8(k))),v(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const B=v(e,["thinkingConfig"]);return B!=null&&b(r,["thinkingConfig"],Hge(B)),r}function pB(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["_url","model"],Nn(n,r));const i=v(e,["contents"]);if(i!=null){let s=As(i);Array.isArray(s)&&(s=s.map(o=>mw(o))),b(t,["contents"],s)}const a=v(e,["config"]);return a!=null&&b(t,["generationConfig"],Gge(n,a,t)),t}function Wge(n,e){const t={},r=v(n,["taskType"]);e!==void 0&&r!=null&&b(e,["requests[]","taskType"],r);const i=v(n,["title"]);e!==void 0&&i!=null&&b(e,["requests[]","title"],i);const a=v(n,["outputDimensionality"]);if(e!==void 0&&a!=null&&b(e,["requests[]","outputDimensionality"],a),v(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(v(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function Kge(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["_url","model"],Nn(n,r));const i=v(e,["contents"]);i!=null&&b(t,["requests[]","content"],f8(n,i));const a=v(e,["config"]);a!=null&&b(t,["config"],Wge(a,t));const s=v(e,["model"]);return s!==void 0&&b(t,["requests[]","model"],Nn(n,s)),t}function Jge(n,e){const t={};if(v(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(v(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const r=v(n,["numberOfImages"]);e!==void 0&&r!=null&&b(e,["parameters","sampleCount"],r);const i=v(n,["aspectRatio"]);e!==void 0&&i!=null&&b(e,["parameters","aspectRatio"],i);const a=v(n,["guidanceScale"]);if(e!==void 0&&a!=null&&b(e,["parameters","guidanceScale"],a),v(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const s=v(n,["safetyFilterLevel"]);e!==void 0&&s!=null&&b(e,["parameters","safetySetting"],s);const o=v(n,["personGeneration"]);e!==void 0&&o!=null&&b(e,["parameters","personGeneration"],o);const u=v(n,["includeSafetyAttributes"]);e!==void 0&&u!=null&&b(e,["parameters","includeSafetyAttributes"],u);const c=v(n,["includeRaiReason"]);e!==void 0&&c!=null&&b(e,["parameters","includeRaiReason"],c);const d=v(n,["language"]);e!==void 0&&d!=null&&b(e,["parameters","language"],d);const h=v(n,["outputMimeType"]);e!==void 0&&h!=null&&b(e,["parameters","outputOptions","mimeType"],h);const m=v(n,["outputCompressionQuality"]);if(e!==void 0&&m!=null&&b(e,["parameters","outputOptions","compressionQuality"],m),v(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(v(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function Yge(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["_url","model"],Nn(n,r));const i=v(e,["prompt"]);i!=null&&b(t,["instances[0]","prompt"],i);const a=v(e,["config"]);return a!=null&&b(t,["config"],Jge(a,t)),t}function Zge(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["_url","name"],Nn(n,r));const i=v(e,["config"]);return i!=null&&b(t,["config"],i),t}function Xge(n,e,t){const r={},i=v(e,["pageSize"]);t!==void 0&&i!=null&&b(t,["_query","pageSize"],i);const a=v(e,["pageToken"]);t!==void 0&&a!=null&&b(t,["_query","pageToken"],a);const s=v(e,["filter"]);t!==void 0&&s!=null&&b(t,["_query","filter"],s);const o=v(e,["queryBase"]);return t!==void 0&&o!=null&&b(t,["_url","models_url"],m8(n,o)),r}function Qge(n,e){const t={},r=v(e,["config"]);return r!=null&&b(t,["config"],Xge(n,r,t)),t}function eye(n,e){const t={},r=v(n,["displayName"]);e!==void 0&&r!=null&&b(e,["displayName"],r);const i=v(n,["description"]);e!==void 0&&i!=null&&b(e,["description"],i);const a=v(n,["defaultCheckpointId"]);return e!==void 0&&a!=null&&b(e,["defaultCheckpointId"],a),t}function tye(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["_url","name"],Nn(n,r));const i=v(e,["config"]);return i!=null&&b(t,["config"],eye(i,t)),t}function nye(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["_url","name"],Nn(n,r));const i=v(e,["config"]);return i!=null&&b(t,["config"],i),t}function rye(n){const e={};if(v(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(v(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(v(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function iye(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["_url","model"],Nn(n,r));const i=v(e,["contents"]);if(i!=null){let s=As(i);Array.isArray(s)&&(s=s.map(o=>mw(o))),b(t,["contents"],s)}const a=v(e,["config"]);return a!=null&&b(t,["config"],rye(a)),t}function aye(n){const e={};if(v(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const t=v(n,["imageBytes"]);t!=null&&b(e,["bytesBase64Encoded"],al(t));const r=v(n,["mimeType"]);return r!=null&&b(e,["mimeType"],r),e}function sye(n,e){const t={},r=v(n,["numberOfVideos"]);if(e!==void 0&&r!=null&&b(e,["parameters","sampleCount"],r),v(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(v(n,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const i=v(n,["durationSeconds"]);if(e!==void 0&&i!=null&&b(e,["parameters","durationSeconds"],i),v(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const a=v(n,["aspectRatio"]);if(e!==void 0&&a!=null&&b(e,["parameters","aspectRatio"],a),v(n,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");const s=v(n,["personGeneration"]);if(e!==void 0&&s!=null&&b(e,["parameters","personGeneration"],s),v(n,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const o=v(n,["negativePrompt"]);e!==void 0&&o!=null&&b(e,["parameters","negativePrompt"],o);const u=v(n,["enhancePrompt"]);if(e!==void 0&&u!=null&&b(e,["parameters","enhancePrompt"],u),v(n,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");if(v(n,["lastFrame"])!==void 0)throw new Error("lastFrame parameter is not supported in Gemini API.");return t}function oye(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["_url","model"],Nn(n,r));const i=v(e,["prompt"]);i!=null&&b(t,["instances[0]","prompt"],i);const a=v(e,["image"]);if(a!=null&&b(t,["instances[0]","image"],aye(a)),v(e,["video"])!==void 0)throw new Error("video parameter is not supported in Gemini API.");const s=v(e,["config"]);return s!=null&&b(t,["config"],sye(s,t)),t}function lye(n){const e={},t=v(n,["fps"]);t!=null&&b(e,["fps"],t);const r=v(n,["endOffset"]);r!=null&&b(e,["endOffset"],r);const i=v(n,["startOffset"]);return i!=null&&b(e,["startOffset"],i),e}function uye(n){const e={},t=v(n,["displayName"]);t!=null&&b(e,["displayName"],t);const r=v(n,["data"]);r!=null&&b(e,["data"],r);const i=v(n,["mimeType"]);return i!=null&&b(e,["mimeType"],i),e}function cye(n){const e={},t=v(n,["displayName"]);t!=null&&b(e,["displayName"],t);const r=v(n,["fileUri"]);r!=null&&b(e,["fileUri"],r);const i=v(n,["mimeType"]);return i!=null&&b(e,["mimeType"],i),e}function fye(n){const e={},t=v(n,["videoMetadata"]);t!=null&&b(e,["videoMetadata"],lye(t));const r=v(n,["thought"]);r!=null&&b(e,["thought"],r);const i=v(n,["inlineData"]);i!=null&&b(e,["inlineData"],uye(i));const a=v(n,["fileData"]);a!=null&&b(e,["fileData"],cye(a));const s=v(n,["thoughtSignature"]);s!=null&&b(e,["thoughtSignature"],s);const o=v(n,["codeExecutionResult"]);o!=null&&b(e,["codeExecutionResult"],o);const u=v(n,["executableCode"]);u!=null&&b(e,["executableCode"],u);const c=v(n,["functionCall"]);c!=null&&b(e,["functionCall"],c);const d=v(n,["functionResponse"]);d!=null&&b(e,["functionResponse"],d);const h=v(n,["text"]);return h!=null&&b(e,["text"],h),e}function Gd(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>fye(a))),b(e,["parts"],i)}const r=v(n,["role"]);return r!=null&&b(e,["role"],r),e}function dye(n){const e={},t=v(n,["anyOf"]);t!=null&&b(e,["anyOf"],t);const r=v(n,["default"]);r!=null&&b(e,["default"],r);const i=v(n,["description"]);i!=null&&b(e,["description"],i);const a=v(n,["enum"]);a!=null&&b(e,["enum"],a);const s=v(n,["example"]);s!=null&&b(e,["example"],s);const o=v(n,["format"]);o!=null&&b(e,["format"],o);const u=v(n,["items"]);u!=null&&b(e,["items"],u);const c=v(n,["maxItems"]);c!=null&&b(e,["maxItems"],c);const d=v(n,["maxLength"]);d!=null&&b(e,["maxLength"],d);const h=v(n,["maxProperties"]);h!=null&&b(e,["maxProperties"],h);const m=v(n,["maximum"]);m!=null&&b(e,["maximum"],m);const g=v(n,["minItems"]);g!=null&&b(e,["minItems"],g);const _=v(n,["minLength"]);_!=null&&b(e,["minLength"],_);const w=v(n,["minProperties"]);w!=null&&b(e,["minProperties"],w);const S=v(n,["minimum"]);S!=null&&b(e,["minimum"],S);const E=v(n,["nullable"]);E!=null&&b(e,["nullable"],E);const C=v(n,["pattern"]);C!=null&&b(e,["pattern"],C);const A=v(n,["properties"]);A!=null&&b(e,["properties"],A);const R=v(n,["propertyOrdering"]);R!=null&&b(e,["propertyOrdering"],R);const P=v(n,["required"]);P!=null&&b(e,["required"],P);const N=v(n,["title"]);N!=null&&b(e,["title"],N);const U=v(n,["type"]);return U!=null&&b(e,["type"],U),e}function hye(n){const e={},t=v(n,["featureSelectionPreference"]);return t!=null&&b(e,["featureSelectionPreference"],t),e}function pye(n){const e={},t=v(n,["method"]);t!=null&&b(e,["method"],t);const r=v(n,["category"]);r!=null&&b(e,["category"],r);const i=v(n,["threshold"]);return i!=null&&b(e,["threshold"],i),e}function mye(n){const e={};if(v(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=v(n,["description"]);t!=null&&b(e,["description"],t);const r=v(n,["name"]);r!=null&&b(e,["name"],r);const i=v(n,["parameters"]);i!=null&&b(e,["parameters"],i);const a=v(n,["parametersJsonSchema"]);a!=null&&b(e,["parametersJsonSchema"],a);const s=v(n,["response"]);s!=null&&b(e,["response"],s);const o=v(n,["responseJsonSchema"]);return o!=null&&b(e,["responseJsonSchema"],o),e}function gye(n){const e={},t=v(n,["startTime"]);t!=null&&b(e,["startTime"],t);const r=v(n,["endTime"]);return r!=null&&b(e,["endTime"],r),e}function yye(n){const e={},t=v(n,["timeRangeFilter"]);return t!=null&&b(e,["timeRangeFilter"],gye(t)),e}function vye(n){const e={},t=v(n,["mode"]);t!=null&&b(e,["mode"],t);const r=v(n,["dynamicThreshold"]);return r!=null&&b(e,["dynamicThreshold"],r),e}function _ye(n){const e={},t=v(n,["dynamicRetrievalConfig"]);return t!=null&&b(e,["dynamicRetrievalConfig"],vye(t)),e}function bye(){return{}}function wye(n){const e={},t=v(n,["apiKeyString"]);return t!=null&&b(e,["apiKeyString"],t),e}function Eye(n){const e={},t=v(n,["apiKeyConfig"]);t!=null&&b(e,["apiKeyConfig"],wye(t));const r=v(n,["authType"]);r!=null&&b(e,["authType"],r);const i=v(n,["googleServiceAccountConfig"]);i!=null&&b(e,["googleServiceAccountConfig"],i);const a=v(n,["httpBasicAuthConfig"]);a!=null&&b(e,["httpBasicAuthConfig"],a);const s=v(n,["oauthConfig"]);s!=null&&b(e,["oauthConfig"],s);const o=v(n,["oidcConfig"]);return o!=null&&b(e,["oidcConfig"],o),e}function Sye(n){const e={},t=v(n,["authConfig"]);return t!=null&&b(e,["authConfig"],Eye(t)),e}function Tye(){return{}}function T8(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(h=>mye(h))),b(e,["functionDeclarations"],d)}const r=v(n,["retrieval"]);r!=null&&b(e,["retrieval"],r);const i=v(n,["googleSearch"]);i!=null&&b(e,["googleSearch"],yye(i));const a=v(n,["googleSearchRetrieval"]);a!=null&&b(e,["googleSearchRetrieval"],_ye(a)),v(n,["enterpriseWebSearch"])!=null&&b(e,["enterpriseWebSearch"],bye());const o=v(n,["googleMaps"]);o!=null&&b(e,["googleMaps"],Sye(o)),v(n,["urlContext"])!=null&&b(e,["urlContext"],Tye());const c=v(n,["codeExecution"]);return c!=null&&b(e,["codeExecution"],c),e}function Aye(n){const e={},t=v(n,["mode"]);t!=null&&b(e,["mode"],t);const r=v(n,["allowedFunctionNames"]);return r!=null&&b(e,["allowedFunctionNames"],r),e}function Cye(n){const e={},t=v(n,["latitude"]);t!=null&&b(e,["latitude"],t);const r=v(n,["longitude"]);return r!=null&&b(e,["longitude"],r),e}function xye(n){const e={},t=v(n,["latLng"]);t!=null&&b(e,["latLng"],Cye(t));const r=v(n,["languageCode"]);return r!=null&&b(e,["languageCode"],r),e}function Rye(n){const e={},t=v(n,["functionCallingConfig"]);t!=null&&b(e,["functionCallingConfig"],Aye(t));const r=v(n,["retrievalConfig"]);return r!=null&&b(e,["retrievalConfig"],xye(r)),e}function Iye(n){const e={},t=v(n,["voiceName"]);return t!=null&&b(e,["voiceName"],t),e}function Pye(n){const e={},t=v(n,["prebuiltVoiceConfig"]);return t!=null&&b(e,["prebuiltVoiceConfig"],Iye(t)),e}function Oye(n){const e={},t=v(n,["voiceConfig"]);if(t!=null&&b(e,["voiceConfig"],Pye(t)),v(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const r=v(n,["languageCode"]);return r!=null&&b(e,["languageCode"],r),e}function kye(n){const e={},t=v(n,["includeThoughts"]);t!=null&&b(e,["includeThoughts"],t);const r=v(n,["thinkingBudget"]);return r!=null&&b(e,["thinkingBudget"],r),e}function Nye(n,e,t){const r={},i=v(e,["systemInstruction"]);t!==void 0&&i!=null&&b(t,["systemInstruction"],Gd(vi(i)));const a=v(e,["temperature"]);a!=null&&b(r,["temperature"],a);const s=v(e,["topP"]);s!=null&&b(r,["topP"],s);const o=v(e,["topK"]);o!=null&&b(r,["topK"],o);const u=v(e,["candidateCount"]);u!=null&&b(r,["candidateCount"],u);const c=v(e,["maxOutputTokens"]);c!=null&&b(r,["maxOutputTokens"],c);const d=v(e,["stopSequences"]);d!=null&&b(r,["stopSequences"],d);const h=v(e,["responseLogprobs"]);h!=null&&b(r,["responseLogprobs"],h);const m=v(e,["logprobs"]);m!=null&&b(r,["logprobs"],m);const g=v(e,["presencePenalty"]);g!=null&&b(r,["presencePenalty"],g);const _=v(e,["frequencyPenalty"]);_!=null&&b(r,["frequencyPenalty"],_);const w=v(e,["seed"]);w!=null&&b(r,["seed"],w);const S=v(e,["responseMimeType"]);S!=null&&b(r,["responseMimeType"],S);const E=v(e,["responseSchema"]);E!=null&&b(r,["responseSchema"],dye(tb(E)));const C=v(e,["routingConfig"]);C!=null&&b(r,["routingConfig"],C);const A=v(e,["modelSelectionConfig"]);A!=null&&b(r,["modelConfig"],hye(A));const R=v(e,["safetySettings"]);if(t!==void 0&&R!=null){let te=R;Array.isArray(te)&&(te=te.map(se=>pye(se))),b(t,["safetySettings"],te)}const P=v(e,["tools"]);if(t!==void 0&&P!=null){let te=cg(P);Array.isArray(te)&&(te=te.map(se=>T8(ug(se)))),b(t,["tools"],te)}const N=v(e,["toolConfig"]);t!==void 0&&N!=null&&b(t,["toolConfig"],Rye(N));const U=v(e,["labels"]);t!==void 0&&U!=null&&b(t,["labels"],U);const k=v(e,["cachedContent"]);t!==void 0&&k!=null&&b(t,["cachedContent"],uu(n,k));const B=v(e,["responseModalities"]);B!=null&&b(r,["responseModalities"],B);const H=v(e,["mediaResolution"]);H!=null&&b(r,["mediaResolution"],H);const G=v(e,["speechConfig"]);G!=null&&b(r,["speechConfig"],Oye(d8(G)));const z=v(e,["audioTimestamp"]);z!=null&&b(r,["audioTimestamp"],z);const oe=v(e,["thinkingConfig"]);return oe!=null&&b(r,["thinkingConfig"],kye(oe)),r}function mB(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["_url","model"],Nn(n,r));const i=v(e,["contents"]);if(i!=null){let s=As(i);Array.isArray(s)&&(s=s.map(o=>Gd(o))),b(t,["contents"],s)}const a=v(e,["config"]);return a!=null&&b(t,["generationConfig"],Nye(n,a,t)),t}function Mye(n,e){const t={},r=v(n,["taskType"]);e!==void 0&&r!=null&&b(e,["instances[]","task_type"],r);const i=v(n,["title"]);e!==void 0&&i!=null&&b(e,["instances[]","title"],i);const a=v(n,["outputDimensionality"]);e!==void 0&&a!=null&&b(e,["parameters","outputDimensionality"],a);const s=v(n,["mimeType"]);e!==void 0&&s!=null&&b(e,["instances[]","mimeType"],s);const o=v(n,["autoTruncate"]);return e!==void 0&&o!=null&&b(e,["parameters","autoTruncate"],o),t}function Dye(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["_url","model"],Nn(n,r));const i=v(e,["contents"]);i!=null&&b(t,["instances[]","content"],f8(n,i));const a=v(e,["config"]);return a!=null&&b(t,["config"],Mye(a,t)),t}function $ye(n,e){const t={},r=v(n,["outputGcsUri"]);e!==void 0&&r!=null&&b(e,["parameters","storageUri"],r);const i=v(n,["negativePrompt"]);e!==void 0&&i!=null&&b(e,["parameters","negativePrompt"],i);const a=v(n,["numberOfImages"]);e!==void 0&&a!=null&&b(e,["parameters","sampleCount"],a);const s=v(n,["aspectRatio"]);e!==void 0&&s!=null&&b(e,["parameters","aspectRatio"],s);const o=v(n,["guidanceScale"]);e!==void 0&&o!=null&&b(e,["parameters","guidanceScale"],o);const u=v(n,["seed"]);e!==void 0&&u!=null&&b(e,["parameters","seed"],u);const c=v(n,["safetyFilterLevel"]);e!==void 0&&c!=null&&b(e,["parameters","safetySetting"],c);const d=v(n,["personGeneration"]);e!==void 0&&d!=null&&b(e,["parameters","personGeneration"],d);const h=v(n,["includeSafetyAttributes"]);e!==void 0&&h!=null&&b(e,["parameters","includeSafetyAttributes"],h);const m=v(n,["includeRaiReason"]);e!==void 0&&m!=null&&b(e,["parameters","includeRaiReason"],m);const g=v(n,["language"]);e!==void 0&&g!=null&&b(e,["parameters","language"],g);const _=v(n,["outputMimeType"]);e!==void 0&&_!=null&&b(e,["parameters","outputOptions","mimeType"],_);const w=v(n,["outputCompressionQuality"]);e!==void 0&&w!=null&&b(e,["parameters","outputOptions","compressionQuality"],w);const S=v(n,["addWatermark"]);e!==void 0&&S!=null&&b(e,["parameters","addWatermark"],S);const E=v(n,["enhancePrompt"]);return e!==void 0&&E!=null&&b(e,["parameters","enhancePrompt"],E),t}function Lye(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["_url","model"],Nn(n,r));const i=v(e,["prompt"]);i!=null&&b(t,["instances[0]","prompt"],i);const a=v(e,["config"]);return a!=null&&b(t,["config"],$ye(a,t)),t}function gw(n){const e={},t=v(n,["gcsUri"]);t!=null&&b(e,["gcsUri"],t);const r=v(n,["imageBytes"]);r!=null&&b(e,["bytesBase64Encoded"],al(r));const i=v(n,["mimeType"]);return i!=null&&b(e,["mimeType"],i),e}function Uye(n){const e={},t=v(n,["maskMode"]);t!=null&&b(e,["maskMode"],t);const r=v(n,["segmentationClasses"]);r!=null&&b(e,["maskClasses"],r);const i=v(n,["maskDilation"]);return i!=null&&b(e,["dilation"],i),e}function jye(n){const e={},t=v(n,["controlType"]);t!=null&&b(e,["controlType"],t);const r=v(n,["enableControlImageComputation"]);return r!=null&&b(e,["computeControl"],r),e}function Fye(n){const e={},t=v(n,["styleDescription"]);return t!=null&&b(e,["styleDescription"],t),e}function Bye(n){const e={},t=v(n,["subjectType"]);t!=null&&b(e,["subjectType"],t);const r=v(n,["subjectDescription"]);return r!=null&&b(e,["subjectDescription"],r),e}function qye(n){const e={},t=v(n,["referenceImage"]);t!=null&&b(e,["referenceImage"],gw(t));const r=v(n,["referenceId"]);r!=null&&b(e,["referenceId"],r);const i=v(n,["referenceType"]);i!=null&&b(e,["referenceType"],i);const a=v(n,["maskImageConfig"]);a!=null&&b(e,["maskImageConfig"],Uye(a));const s=v(n,["controlImageConfig"]);s!=null&&b(e,["controlImageConfig"],jye(s));const o=v(n,["styleImageConfig"]);o!=null&&b(e,["styleImageConfig"],Fye(o));const u=v(n,["subjectImageConfig"]);return u!=null&&b(e,["subjectImageConfig"],Bye(u)),e}function Vye(n,e){const t={},r=v(n,["outputGcsUri"]);e!==void 0&&r!=null&&b(e,["parameters","storageUri"],r);const i=v(n,["negativePrompt"]);e!==void 0&&i!=null&&b(e,["parameters","negativePrompt"],i);const a=v(n,["numberOfImages"]);e!==void 0&&a!=null&&b(e,["parameters","sampleCount"],a);const s=v(n,["aspectRatio"]);e!==void 0&&s!=null&&b(e,["parameters","aspectRatio"],s);const o=v(n,["guidanceScale"]);e!==void 0&&o!=null&&b(e,["parameters","guidanceScale"],o);const u=v(n,["seed"]);e!==void 0&&u!=null&&b(e,["parameters","seed"],u);const c=v(n,["safetyFilterLevel"]);e!==void 0&&c!=null&&b(e,["parameters","safetySetting"],c);const d=v(n,["personGeneration"]);e!==void 0&&d!=null&&b(e,["parameters","personGeneration"],d);const h=v(n,["includeSafetyAttributes"]);e!==void 0&&h!=null&&b(e,["parameters","includeSafetyAttributes"],h);const m=v(n,["includeRaiReason"]);e!==void 0&&m!=null&&b(e,["parameters","includeRaiReason"],m);const g=v(n,["language"]);e!==void 0&&g!=null&&b(e,["parameters","language"],g);const _=v(n,["outputMimeType"]);e!==void 0&&_!=null&&b(e,["parameters","outputOptions","mimeType"],_);const w=v(n,["outputCompressionQuality"]);e!==void 0&&w!=null&&b(e,["parameters","outputOptions","compressionQuality"],w);const S=v(n,["editMode"]);e!==void 0&&S!=null&&b(e,["parameters","editMode"],S);const E=v(n,["baseSteps"]);return e!==void 0&&E!=null&&b(e,["parameters","editConfig","baseSteps"],E),t}function zye(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["_url","model"],Nn(n,r));const i=v(e,["prompt"]);i!=null&&b(t,["instances[0]","prompt"],i);const a=v(e,["referenceImages"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(u=>qye(u))),b(t,["instances[0]","referenceImages"],o)}const s=v(e,["config"]);return s!=null&&b(t,["config"],Vye(s,t)),t}function Hye(n,e){const t={},r=v(n,["includeRaiReason"]);e!==void 0&&r!=null&&b(e,["parameters","includeRaiReason"],r);const i=v(n,["outputMimeType"]);e!==void 0&&i!=null&&b(e,["parameters","outputOptions","mimeType"],i);const a=v(n,["outputCompressionQuality"]);e!==void 0&&a!=null&&b(e,["parameters","outputOptions","compressionQuality"],a);const s=v(n,["numberOfImages"]);e!==void 0&&s!=null&&b(e,["parameters","sampleCount"],s);const o=v(n,["mode"]);return e!==void 0&&o!=null&&b(e,["parameters","mode"],o),t}function Gye(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["_url","model"],Nn(n,r));const i=v(e,["image"]);i!=null&&b(t,["instances[0]","image"],gw(i));const a=v(e,["upscaleFactor"]);a!=null&&b(t,["parameters","upscaleConfig","upscaleFactor"],a);const s=v(e,["config"]);return s!=null&&b(t,["config"],Hye(s,t)),t}function Wye(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["_url","name"],Nn(n,r));const i=v(e,["config"]);return i!=null&&b(t,["config"],i),t}function Kye(n,e,t){const r={},i=v(e,["pageSize"]);t!==void 0&&i!=null&&b(t,["_query","pageSize"],i);const a=v(e,["pageToken"]);t!==void 0&&a!=null&&b(t,["_query","pageToken"],a);const s=v(e,["filter"]);t!==void 0&&s!=null&&b(t,["_query","filter"],s);const o=v(e,["queryBase"]);return t!==void 0&&o!=null&&b(t,["_url","models_url"],m8(n,o)),r}function Jye(n,e){const t={},r=v(e,["config"]);return r!=null&&b(t,["config"],Kye(n,r,t)),t}function Yye(n,e){const t={},r=v(n,["displayName"]);e!==void 0&&r!=null&&b(e,["displayName"],r);const i=v(n,["description"]);e!==void 0&&i!=null&&b(e,["description"],i);const a=v(n,["defaultCheckpointId"]);return e!==void 0&&a!=null&&b(e,["defaultCheckpointId"],a),t}function Zye(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["_url","model"],Nn(n,r));const i=v(e,["config"]);return i!=null&&b(t,["config"],Yye(i,t)),t}function Xye(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["_url","name"],Nn(n,r));const i=v(e,["config"]);return i!=null&&b(t,["config"],i),t}function Qye(n,e){const t={},r=v(n,["systemInstruction"]);e!==void 0&&r!=null&&b(e,["systemInstruction"],Gd(vi(r)));const i=v(n,["tools"]);if(e!==void 0&&i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>T8(o))),b(e,["tools"],s)}const a=v(n,["generationConfig"]);return e!==void 0&&a!=null&&b(e,["generationConfig"],a),t}function eve(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["_url","model"],Nn(n,r));const i=v(e,["contents"]);if(i!=null){let s=As(i);Array.isArray(s)&&(s=s.map(o=>Gd(o))),b(t,["contents"],s)}const a=v(e,["config"]);return a!=null&&b(t,["config"],Qye(a,t)),t}function tve(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["_url","model"],Nn(n,r));const i=v(e,["contents"]);if(i!=null){let s=As(i);Array.isArray(s)&&(s=s.map(o=>Gd(o))),b(t,["contents"],s)}const a=v(e,["config"]);return a!=null&&b(t,["config"],a),t}function nve(n){const e={},t=v(n,["uri"]);t!=null&&b(e,["gcsUri"],t);const r=v(n,["videoBytes"]);r!=null&&b(e,["bytesBase64Encoded"],al(r));const i=v(n,["mimeType"]);return i!=null&&b(e,["mimeType"],i),e}function rve(n,e){const t={},r=v(n,["numberOfVideos"]);e!==void 0&&r!=null&&b(e,["parameters","sampleCount"],r);const i=v(n,["outputGcsUri"]);e!==void 0&&i!=null&&b(e,["parameters","storageUri"],i);const a=v(n,["fps"]);e!==void 0&&a!=null&&b(e,["parameters","fps"],a);const s=v(n,["durationSeconds"]);e!==void 0&&s!=null&&b(e,["parameters","durationSeconds"],s);const o=v(n,["seed"]);e!==void 0&&o!=null&&b(e,["parameters","seed"],o);const u=v(n,["aspectRatio"]);e!==void 0&&u!=null&&b(e,["parameters","aspectRatio"],u);const c=v(n,["resolution"]);e!==void 0&&c!=null&&b(e,["parameters","resolution"],c);const d=v(n,["personGeneration"]);e!==void 0&&d!=null&&b(e,["parameters","personGeneration"],d);const h=v(n,["pubsubTopic"]);e!==void 0&&h!=null&&b(e,["parameters","pubsubTopic"],h);const m=v(n,["negativePrompt"]);e!==void 0&&m!=null&&b(e,["parameters","negativePrompt"],m);const g=v(n,["enhancePrompt"]);e!==void 0&&g!=null&&b(e,["parameters","enhancePrompt"],g);const _=v(n,["generateAudio"]);e!==void 0&&_!=null&&b(e,["parameters","generateAudio"],_);const w=v(n,["lastFrame"]);return e!==void 0&&w!=null&&b(e,["instances[0]","lastFrame"],gw(w)),t}function ive(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["_url","model"],Nn(n,r));const i=v(e,["prompt"]);i!=null&&b(t,["instances[0]","prompt"],i);const a=v(e,["image"]);a!=null&&b(t,["instances[0]","image"],gw(a));const s=v(e,["video"]);s!=null&&b(t,["instances[0]","video"],nve(s));const o=v(e,["config"]);return o!=null&&b(t,["config"],rve(o,t)),t}function ave(n){const e={},t=v(n,["fps"]);t!=null&&b(e,["fps"],t);const r=v(n,["endOffset"]);r!=null&&b(e,["endOffset"],r);const i=v(n,["startOffset"]);return i!=null&&b(e,["startOffset"],i),e}function sve(n){const e={},t=v(n,["data"]);t!=null&&b(e,["data"],t);const r=v(n,["mimeType"]);return r!=null&&b(e,["mimeType"],r),e}function ove(n){const e={},t=v(n,["fileUri"]);t!=null&&b(e,["fileUri"],t);const r=v(n,["mimeType"]);return r!=null&&b(e,["mimeType"],r),e}function lve(n){const e={},t=v(n,["videoMetadata"]);t!=null&&b(e,["videoMetadata"],ave(t));const r=v(n,["thought"]);r!=null&&b(e,["thought"],r);const i=v(n,["inlineData"]);i!=null&&b(e,["inlineData"],sve(i));const a=v(n,["fileData"]);a!=null&&b(e,["fileData"],ove(a));const s=v(n,["thoughtSignature"]);s!=null&&b(e,["thoughtSignature"],s);const o=v(n,["codeExecutionResult"]);o!=null&&b(e,["codeExecutionResult"],o);const u=v(n,["executableCode"]);u!=null&&b(e,["executableCode"],u);const c=v(n,["functionCall"]);c!=null&&b(e,["functionCall"],c);const d=v(n,["functionResponse"]);d!=null&&b(e,["functionResponse"],d);const h=v(n,["text"]);return h!=null&&b(e,["text"],h),e}function uve(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>lve(a))),b(e,["parts"],i)}const r=v(n,["role"]);return r!=null&&b(e,["role"],r),e}function cve(n){const e={},t=v(n,["citationSources"]);return t!=null&&b(e,["citations"],t),e}function fve(n){const e={},t=v(n,["retrievedUrl"]);t!=null&&b(e,["retrievedUrl"],t);const r=v(n,["urlRetrievalStatus"]);return r!=null&&b(e,["urlRetrievalStatus"],r),e}function dve(n){const e={},t=v(n,["urlMetadata"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>fve(i))),b(e,["urlMetadata"],r)}return e}function hve(n){const e={},t=v(n,["content"]);t!=null&&b(e,["content"],uve(t));const r=v(n,["citationMetadata"]);r!=null&&b(e,["citationMetadata"],cve(r));const i=v(n,["tokenCount"]);i!=null&&b(e,["tokenCount"],i);const a=v(n,["finishReason"]);a!=null&&b(e,["finishReason"],a);const s=v(n,["urlContextMetadata"]);s!=null&&b(e,["urlContextMetadata"],dve(s));const o=v(n,["avgLogprobs"]);o!=null&&b(e,["avgLogprobs"],o);const u=v(n,["groundingMetadata"]);u!=null&&b(e,["groundingMetadata"],u);const c=v(n,["index"]);c!=null&&b(e,["index"],c);const d=v(n,["logprobsResult"]);d!=null&&b(e,["logprobsResult"],d);const h=v(n,["safetyRatings"]);return h!=null&&b(e,["safetyRatings"],h),e}function gB(n){const e={},t=v(n,["candidates"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>hve(o))),b(e,["candidates"],s)}const r=v(n,["modelVersion"]);r!=null&&b(e,["modelVersion"],r);const i=v(n,["promptFeedback"]);i!=null&&b(e,["promptFeedback"],i);const a=v(n,["usageMetadata"]);return a!=null&&b(e,["usageMetadata"],a),e}function pve(n){const e={},t=v(n,["values"]);return t!=null&&b(e,["values"],t),e}function mve(){return{}}function gve(n){const e={},t=v(n,["embeddings"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>pve(a))),b(e,["embeddings"],i)}return v(n,["metadata"])!=null&&b(e,["metadata"],mve()),e}function yve(n){const e={},t=v(n,["bytesBase64Encoded"]);t!=null&&b(e,["imageBytes"],al(t));const r=v(n,["mimeType"]);return r!=null&&b(e,["mimeType"],r),e}function A8(n){const e={},t=v(n,["safetyAttributes","categories"]);t!=null&&b(e,["categories"],t);const r=v(n,["safetyAttributes","scores"]);r!=null&&b(e,["scores"],r);const i=v(n,["contentType"]);return i!=null&&b(e,["contentType"],i),e}function vve(n){const e={},t=v(n,["_self"]);t!=null&&b(e,["image"],yve(t));const r=v(n,["raiFilteredReason"]);r!=null&&b(e,["raiFilteredReason"],r);const i=v(n,["_self"]);return i!=null&&b(e,["safetyAttributes"],A8(i)),e}function _ve(n){const e={},t=v(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>vve(a))),b(e,["generatedImages"],i)}const r=v(n,["positivePromptSafetyAttributes"]);return r!=null&&b(e,["positivePromptSafetyAttributes"],A8(r)),e}function bve(n){const e={},t=v(n,["baseModel"]);t!=null&&b(e,["baseModel"],t);const r=v(n,["createTime"]);r!=null&&b(e,["createTime"],r);const i=v(n,["updateTime"]);return i!=null&&b(e,["updateTime"],i),e}function yR(n){const e={},t=v(n,["name"]);t!=null&&b(e,["name"],t);const r=v(n,["displayName"]);r!=null&&b(e,["displayName"],r);const i=v(n,["description"]);i!=null&&b(e,["description"],i);const a=v(n,["version"]);a!=null&&b(e,["version"],a);const s=v(n,["_self"]);s!=null&&b(e,["tunedModelInfo"],bve(s));const o=v(n,["inputTokenLimit"]);o!=null&&b(e,["inputTokenLimit"],o);const u=v(n,["outputTokenLimit"]);u!=null&&b(e,["outputTokenLimit"],u);const c=v(n,["supportedGenerationMethods"]);return c!=null&&b(e,["supportedActions"],c),e}function wve(n,e){const t={},r=v(e,["nextPageToken"]);r!=null&&b(t,["nextPageToken"],r);const i=v(e,["_self"]);if(i!=null){let a=g8(i);Array.isArray(a)&&(a=a.map(s=>yR(s))),b(t,["models"],a)}return t}function Eve(){return{}}function Sve(n){const e={},t=v(n,["totalTokens"]);t!=null&&b(e,["totalTokens"],t);const r=v(n,["cachedContentTokenCount"]);return r!=null&&b(e,["cachedContentTokenCount"],r),e}function Tve(n){const e={},t=v(n,["video","uri"]);t!=null&&b(e,["uri"],t);const r=v(n,["video","encodedVideo"]);r!=null&&b(e,["videoBytes"],al(r));const i=v(n,["encoding"]);return i!=null&&b(e,["mimeType"],i),e}function Ave(n){const e={},t=v(n,["_self"]);return t!=null&&b(e,["video"],Tve(t)),e}function Cve(n){const e={},t=v(n,["generatedSamples"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(s=>Ave(s))),b(e,["generatedVideos"],a)}const r=v(n,["raiMediaFilteredCount"]);r!=null&&b(e,["raiMediaFilteredCount"],r);const i=v(n,["raiMediaFilteredReasons"]);return i!=null&&b(e,["raiMediaFilteredReasons"],i),e}function xve(n){const e={},t=v(n,["name"]);t!=null&&b(e,["name"],t);const r=v(n,["metadata"]);r!=null&&b(e,["metadata"],r);const i=v(n,["done"]);i!=null&&b(e,["done"],i);const a=v(n,["error"]);a!=null&&b(e,["error"],a);const s=v(n,["response","generateVideoResponse"]);return s!=null&&b(e,["response"],Cve(s)),e}function Rve(n){const e={},t=v(n,["fps"]);t!=null&&b(e,["fps"],t);const r=v(n,["endOffset"]);r!=null&&b(e,["endOffset"],r);const i=v(n,["startOffset"]);return i!=null&&b(e,["startOffset"],i),e}function Ive(n){const e={},t=v(n,["displayName"]);t!=null&&b(e,["displayName"],t);const r=v(n,["data"]);r!=null&&b(e,["data"],r);const i=v(n,["mimeType"]);return i!=null&&b(e,["mimeType"],i),e}function Pve(n){const e={},t=v(n,["displayName"]);t!=null&&b(e,["displayName"],t);const r=v(n,["fileUri"]);r!=null&&b(e,["fileUri"],r);const i=v(n,["mimeType"]);return i!=null&&b(e,["mimeType"],i),e}function Ove(n){const e={},t=v(n,["videoMetadata"]);t!=null&&b(e,["videoMetadata"],Rve(t));const r=v(n,["thought"]);r!=null&&b(e,["thought"],r);const i=v(n,["inlineData"]);i!=null&&b(e,["inlineData"],Ive(i));const a=v(n,["fileData"]);a!=null&&b(e,["fileData"],Pve(a));const s=v(n,["thoughtSignature"]);s!=null&&b(e,["thoughtSignature"],s);const o=v(n,["codeExecutionResult"]);o!=null&&b(e,["codeExecutionResult"],o);const u=v(n,["executableCode"]);u!=null&&b(e,["executableCode"],u);const c=v(n,["functionCall"]);c!=null&&b(e,["functionCall"],c);const d=v(n,["functionResponse"]);d!=null&&b(e,["functionResponse"],d);const h=v(n,["text"]);return h!=null&&b(e,["text"],h),e}function kve(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>Ove(a))),b(e,["parts"],i)}const r=v(n,["role"]);return r!=null&&b(e,["role"],r),e}function Nve(n){const e={},t=v(n,["citations"]);return t!=null&&b(e,["citations"],t),e}function Mve(n){const e={},t=v(n,["retrievedUrl"]);t!=null&&b(e,["retrievedUrl"],t);const r=v(n,["urlRetrievalStatus"]);return r!=null&&b(e,["urlRetrievalStatus"],r),e}function Dve(n){const e={},t=v(n,["urlMetadata"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>Mve(i))),b(e,["urlMetadata"],r)}return e}function $ve(n){const e={},t=v(n,["content"]);t!=null&&b(e,["content"],kve(t));const r=v(n,["citationMetadata"]);r!=null&&b(e,["citationMetadata"],Nve(r));const i=v(n,["finishMessage"]);i!=null&&b(e,["finishMessage"],i);const a=v(n,["finishReason"]);a!=null&&b(e,["finishReason"],a);const s=v(n,["urlContextMetadata"]);s!=null&&b(e,["urlContextMetadata"],Dve(s));const o=v(n,["avgLogprobs"]);o!=null&&b(e,["avgLogprobs"],o);const u=v(n,["groundingMetadata"]);u!=null&&b(e,["groundingMetadata"],u);const c=v(n,["index"]);c!=null&&b(e,["index"],c);const d=v(n,["logprobsResult"]);d!=null&&b(e,["logprobsResult"],d);const h=v(n,["safetyRatings"]);return h!=null&&b(e,["safetyRatings"],h),e}function yB(n){const e={},t=v(n,["candidates"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(c=>$ve(c))),b(e,["candidates"],u)}const r=v(n,["createTime"]);r!=null&&b(e,["createTime"],r);const i=v(n,["responseId"]);i!=null&&b(e,["responseId"],i);const a=v(n,["modelVersion"]);a!=null&&b(e,["modelVersion"],a);const s=v(n,["promptFeedback"]);s!=null&&b(e,["promptFeedback"],s);const o=v(n,["usageMetadata"]);return o!=null&&b(e,["usageMetadata"],o),e}function Lve(n){const e={},t=v(n,["truncated"]);t!=null&&b(e,["truncated"],t);const r=v(n,["token_count"]);return r!=null&&b(e,["tokenCount"],r),e}function Uve(n){const e={},t=v(n,["values"]);t!=null&&b(e,["values"],t);const r=v(n,["statistics"]);return r!=null&&b(e,["statistics"],Lve(r)),e}function jve(n){const e={},t=v(n,["billableCharacterCount"]);return t!=null&&b(e,["billableCharacterCount"],t),e}function Fve(n){const e={},t=v(n,["predictions[]","embeddings"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>Uve(a))),b(e,["embeddings"],i)}const r=v(n,["metadata"]);return r!=null&&b(e,["metadata"],jve(r)),e}function Bve(n){const e={},t=v(n,["gcsUri"]);t!=null&&b(e,["gcsUri"],t);const r=v(n,["bytesBase64Encoded"]);r!=null&&b(e,["imageBytes"],al(r));const i=v(n,["mimeType"]);return i!=null&&b(e,["mimeType"],i),e}function C8(n){const e={},t=v(n,["safetyAttributes","categories"]);t!=null&&b(e,["categories"],t);const r=v(n,["safetyAttributes","scores"]);r!=null&&b(e,["scores"],r);const i=v(n,["contentType"]);return i!=null&&b(e,["contentType"],i),e}function UP(n){const e={},t=v(n,["_self"]);t!=null&&b(e,["image"],Bve(t));const r=v(n,["raiFilteredReason"]);r!=null&&b(e,["raiFilteredReason"],r);const i=v(n,["_self"]);i!=null&&b(e,["safetyAttributes"],C8(i));const a=v(n,["prompt"]);return a!=null&&b(e,["enhancedPrompt"],a),e}function qve(n){const e={},t=v(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>UP(a))),b(e,["generatedImages"],i)}const r=v(n,["positivePromptSafetyAttributes"]);return r!=null&&b(e,["positivePromptSafetyAttributes"],C8(r)),e}function Vve(n){const e={},t=v(n,["predictions"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>UP(i))),b(e,["generatedImages"],r)}return e}function zve(n){const e={},t=v(n,["predictions"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>UP(i))),b(e,["generatedImages"],r)}return e}function Hve(n){const e={},t=v(n,["endpoint"]);t!=null&&b(e,["name"],t);const r=v(n,["deployedModelId"]);return r!=null&&b(e,["deployedModelId"],r),e}function Gve(n){const e={},t=v(n,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&b(e,["baseModel"],t);const r=v(n,["createTime"]);r!=null&&b(e,["createTime"],r);const i=v(n,["updateTime"]);return i!=null&&b(e,["updateTime"],i),e}function Wve(n){const e={},t=v(n,["checkpointId"]);t!=null&&b(e,["checkpointId"],t);const r=v(n,["epoch"]);r!=null&&b(e,["epoch"],r);const i=v(n,["step"]);return i!=null&&b(e,["step"],i),e}function vR(n){const e={},t=v(n,["name"]);t!=null&&b(e,["name"],t);const r=v(n,["displayName"]);r!=null&&b(e,["displayName"],r);const i=v(n,["description"]);i!=null&&b(e,["description"],i);const a=v(n,["versionId"]);a!=null&&b(e,["version"],a);const s=v(n,["deployedModels"]);if(s!=null){let h=s;Array.isArray(h)&&(h=h.map(m=>Hve(m))),b(e,["endpoints"],h)}const o=v(n,["labels"]);o!=null&&b(e,["labels"],o);const u=v(n,["_self"]);u!=null&&b(e,["tunedModelInfo"],Gve(u));const c=v(n,["defaultCheckpointId"]);c!=null&&b(e,["defaultCheckpointId"],c);const d=v(n,["checkpoints"]);if(d!=null){let h=d;Array.isArray(h)&&(h=h.map(m=>Wve(m))),b(e,["checkpoints"],h)}return e}function Kve(n,e){const t={},r=v(e,["nextPageToken"]);r!=null&&b(t,["nextPageToken"],r);const i=v(e,["_self"]);if(i!=null){let a=g8(i);Array.isArray(a)&&(a=a.map(s=>vR(s))),b(t,["models"],a)}return t}function Jve(){return{}}function Yve(n){const e={},t=v(n,["totalTokens"]);return t!=null&&b(e,["totalTokens"],t),e}function Zve(n){const e={},t=v(n,["tokensInfo"]);return t!=null&&b(e,["tokensInfo"],t),e}function Xve(n){const e={},t=v(n,["gcsUri"]);t!=null&&b(e,["uri"],t);const r=v(n,["bytesBase64Encoded"]);r!=null&&b(e,["videoBytes"],al(r));const i=v(n,["mimeType"]);return i!=null&&b(e,["mimeType"],i),e}function Qve(n){const e={},t=v(n,["_self"]);return t!=null&&b(e,["video"],Xve(t)),e}function e_e(n){const e={},t=v(n,["videos"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(s=>Qve(s))),b(e,["generatedVideos"],a)}const r=v(n,["raiMediaFilteredCount"]);r!=null&&b(e,["raiMediaFilteredCount"],r);const i=v(n,["raiMediaFilteredReasons"]);return i!=null&&b(e,["raiMediaFilteredReasons"],i),e}function t_e(n){const e={},t=v(n,["name"]);t!=null&&b(e,["name"],t);const r=v(n,["metadata"]);r!=null&&b(e,["metadata"],r);const i=v(n,["done"]);i!=null&&b(e,["done"],i);const a=v(n,["error"]);a!=null&&b(e,["error"],a);const s=v(n,["response"]);return s!=null&&b(e,["response"],e_e(s)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const n_e="Content-Type",r_e="X-Server-Timeout",i_e="User-Agent",_R="x-goog-api-client",a_e="1.6.0",s_e=`google-genai-sdk/${a_e}`,o_e="v1beta1",l_e="v1beta",vB=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class u_e{constructor(e){var t,r;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:o_e,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:l_e,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const r=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&r.push(e.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,r){const i=[this.getRequestUrlInternal(t)];return r&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,r);if(e.queryParams)for(const[s,o]of Object.entries(e.queryParams))i.searchParams.append(s,String(o));let a={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else a.body=e.body;return a=await this.includeExtraHttpOptionsToRequestInit(a,t,e.abortSignal),this.unaryApiCall(i,a,e.httpMethod)}patchHttpOptions(e,t){const r=JSON.parse(JSON.stringify(e));for(const[i,a]of Object.entries(t))typeof a=="object"?r[i]=Object.assign(Object.assign({},r[i]),a):a!==void 0&&(r[i]=a);return r}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,r);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let a={};return a.body=e.body,a=await this.includeExtraHttpOptionsToRequestInit(a,t,e.abortSignal),this.streamApiCall(i,a,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,r){if(t&&t.timeout||r){const i=new AbortController,a=i.signal;t.timeout&&(t==null?void 0:t.timeout)>0&&setTimeout(()=>i.abort(),t.timeout),r&&r.addEventListener("abort",()=>{i.abort()}),e.signal=a}return t&&t.extraBody!==null&&c_e(e,t.extraBody),e.headers=await this.getHeadersInternal(t),e}async unaryApiCall(e,t,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:r})).then(async i=>(await _B(i),new hR(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,t,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:r})).then(async i=>(await _B(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){var t;return pd(this,arguments,function*(){const i=(t=e==null?void 0:e.body)===null||t===void 0?void 0:t.getReader(),a=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let s="";for(;;){const{done:o,value:u}=yield Mn(i.read());if(o){if(s.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const c=a.decode(u);try{const h=JSON.parse(c);if("error"in h){const m=JSON.parse(JSON.stringify(h.error)),g=m.status,_=m.code,w=`got status: ${g}. ${JSON.stringify(h)}`;if(_>=400&&_<600)throw new pw({message:w,status:_})}}catch(h){if(h.name==="ApiError")throw h}s+=c;let d=s.match(vB);for(;d;){const h=d[1];try{const m=new Response(h,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield Mn(new hR(m)),s=s.slice(d[0].length),d=s.match(vB)}catch(m){throw new Error(`exception parsing stream chunk ${h}. ${m}`)}}}}finally{i.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(r=>{throw new Error(`exception ${r} sending request`)})}getDefaultHeaders(){const e={},t=s_e+" "+this.clientOptions.userAgentExtra;return e[i_e]=t,e[_R]=t,e[n_e]="application/json",e}async getHeadersInternal(e){const t=new Headers;if(e&&e.headers){for(const[r,i]of Object.entries(e.headers))t.append(r,i);e.timeout&&e.timeout>0&&t.append(r_e,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(t),t}async uploadFile(e,t){var r;const i={};t!=null&&(i.mimeType=t.mimeType,i.name=t.name,i.displayName=t.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const a=this.clientOptions.uploader,s=await a.stat(e);i.sizeBytes=String(s.size);const o=(r=t==null?void 0:t.mimeType)!==null&&r!==void 0?r:s.type;if(o===void 0||o==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=o;const u=await this.fetchUploadUrl(i,t);return a.upload(e,u,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t){var r;let i={};t!=null&&t.httpOptions?i=t.httpOptions:i={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};const a={file:e},s=await this.request({path:St("upload/v1beta/files",a._url),body:JSON.stringify(a),httpMethod:"POST",httpOptions:i});if(!s||!(s!=null&&s.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const o=(r=s==null?void 0:s.headers)===null||r===void 0?void 0:r["x-goog-upload-url"];if(o===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return o}}async function _B(n){var e;if(n===void 0)throw new Error("response is undefined");if(!n.ok){const t=n.status;let r;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?r=await n.json():r={error:{message:await n.text(),code:n.status,status:n.statusText}};const i=JSON.stringify(r);throw t>=400&&t<600?new pw({message:i,status:t}):new Error(i)}}function c_e(n,e){if(!e||Object.keys(e).length===0)return;if(n.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof n.body=="string"&&n.body.length>0)try{const a=JSON.parse(n.body);if(typeof a=="object"&&a!==null&&!Array.isArray(a))t=a;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function r(a,s){const o=Object.assign({},a);for(const u in s)if(Object.prototype.hasOwnProperty.call(s,u)){const c=s[u],d=o[u];c&&typeof c=="object"&&!Array.isArray(c)&&d&&typeof d=="object"&&!Array.isArray(d)?o[u]=r(d,c):(d&&c&&typeof d!=typeof c&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${u}". Original type: ${typeof d}, New type: ${typeof c}. Overwriting.`),o[u]=c)}return o}const i=r(t,e);n.body=JSON.stringify(i)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const f_e="mcp_used/unknown";function x8(n){for(const e of n)if(jP(e)||typeof e=="object"&&"inputSchema"in e)return!0;return!1}function R8(n){var e;const t=(e=n[_R])!==null&&e!==void 0?e:"";n[_R]=(t+` ${f_e}`).trimStart()}function d_e(n){var e,t,r;return(r=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(i=>jP(i)))!==null&&r!==void 0?r:!1}function h_e(n){var e,t,r;return(r=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(i=>!jP(i)))!==null&&r!==void 0?r:!1}function jP(n){return n!==null&&typeof n=="object"&&n instanceof FP}function p_e(n,e=100){return pd(this,arguments,function*(){let r,i=0;for(;i<e;){const a=yield Mn(n.listTools({cursor:r}));for(const s of a.tools)yield yield Mn(s),i++;if(!a.nextCursor)break;r=a.nextCursor}})}class FP{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new FP(e,t)}async initialize(){var e,t,r,i;if(this.mcpTools.length>0)return;const a={},s=[];for(const d of this.mcpClients)try{for(var o=!0,u=(t=void 0,Zp(p_e(d))),c;c=await u.next(),e=c.done,!e;o=!0){i=c.value,o=!1;const h=i;s.push(h);const m=h.name;if(a[m])throw new Error(`Duplicate function name ${m} found in MCP tools. Please ensure function names are unique.`);a[m]=d}}catch(h){t={error:h}}finally{try{!o&&!e&&(r=u.return)&&await r.call(u)}finally{if(t)throw t.error}}this.mcpTools=s,this.functionNameToMcpClient=a}async tool(){return await this.initialize(),phe(this.mcpTools,this.config)}async callTool(e){await this.initialize();const t=[];for(const r of e)if(r.name in this.functionNameToMcpClient){const i=this.functionNameToMcpClient[r.name];let a;this.config.timeout&&(a={timeout:this.config.timeout});const s=await i.callTool({name:r.name,arguments:r.args},void 0,a);t.push({functionResponse:{name:r.name,response:s.isError?{error:s}:s}})}return t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function m_e(n,e,t){const r=new the;let i;t.data instanceof Blob?i=JSON.parse(await t.data.text()):i=JSON.parse(t.data);const a=Sge(i);Object.assign(r,a),e(r)}class g_e{constructor(e,t,r){this.apiClient=e,this.auth=t,this.webSocketFactory=r}async connect(e){var t,r;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const i=this.apiClient.getWebsocketBaseUrl(),a=this.apiClient.getApiVersion(),s=__e(this.apiClient.getDefaultHeaders()),o=this.apiClient.getApiKey(),u=`${i}/ws/google.ai.generativelanguage.${a}.GenerativeService.BidiGenerateMusic?key=${o}`;let c=()=>{};const d=new Promise(A=>{c=A}),h=e.callbacks,m=function(){c({})},g=this.apiClient,_={onopen:m,onmessage:A=>{m_e(g,h.onmessage,A)},onerror:(t=h==null?void 0:h.onerror)!==null&&t!==void 0?t:function(A){},onclose:(r=h==null?void 0:h.onclose)!==null&&r!==void 0?r:function(A){}},w=this.webSocketFactory.create(u,v_e(s),_);w.connect(),await d;const S=Nn(this.apiClient,e.model),E=w8({model:S}),C=gR({setup:E});return w.send(JSON.stringify(C)),new y_e(w,this.apiClient)}}class y_e{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=Lme(e),r=E8(t);this.conn.send(JSON.stringify({clientContent:r}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=Ume(e),r=gR(t);this.conn.send(JSON.stringify(r))}sendPlaybackControl(e){const t=gR({playbackControl:e});this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(Qf.PLAY)}pause(){this.sendPlaybackControl(Qf.PAUSE)}stop(){this.sendPlaybackControl(Qf.STOP)}resetContext(){this.sendPlaybackControl(Qf.RESET_CONTEXT)}close(){this.conn.close()}}function v_e(n){const e={};return n.forEach((t,r)=>{e[r]=t}),e}function __e(n){const e=new Headers;for(const[t,r]of Object.entries(n))e.append(t,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const b_e="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function w_e(n,e,t){const r=new ehe;let i;if(t.data instanceof Blob?i=JSON.parse(await t.data.text()):i=JSON.parse(t.data),n.isVertexAI()){const a=pge(i);Object.assign(r,a)}else{const a=hge(i);Object.assign(r,a)}e(r)}class E_e{constructor(e,t,r){this.apiClient=e,this.auth=t,this.webSocketFactory=r,this.music=new g_e(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,r,i,a,s,o;const u=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion();let d;const h=this.apiClient.getDefaultHeaders();e.config&&e.config.tools&&x8(e.config.tools)&&R8(h);const m=C_e(h);if(this.apiClient.isVertexAI())d=`${u}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(m);else{const B=this.apiClient.getApiKey();let H="BidiGenerateContent",G="key";B!=null&&B.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),H="BidiGenerateContentConstrained",G="access_token"),d=`${u}/ws/google.ai.generativelanguage.${c}.GenerativeService.${H}?${G}=${B}`}let g=()=>{};const _=new Promise(B=>{g=B}),w=e.callbacks,S=function(){var B;(B=w==null?void 0:w.onopen)===null||B===void 0||B.call(w),g({})},E=this.apiClient,C={onopen:S,onmessage:B=>{w_e(E,w.onmessage,B)},onerror:(t=w==null?void 0:w.onerror)!==null&&t!==void 0?t:function(B){},onclose:(r=w==null?void 0:w.onclose)!==null&&r!==void 0?r:function(B){}},A=this.webSocketFactory.create(d,A_e(m),C);A.connect(),await _;let R=Nn(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&R.startsWith("publishers/")){const B=this.apiClient.getProject(),H=this.apiClient.getLocation();R=`projects/${B}/locations/${H}/`+R}let P={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Q_.AUDIO]}:e.config.responseModalities=[Q_.AUDIO]),!((a=e.config)===null||a===void 0)&&a.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const N=(o=(s=e.config)===null||s===void 0?void 0:s.tools)!==null&&o!==void 0?o:[],U=[];for(const B of N)if(this.isCallableTool(B)){const H=B;U.push(await H.tool())}else U.push(B);U.length>0&&(e.config.tools=U);const k={model:R,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?P=Pme(this.apiClient,k):P=Ime(this.apiClient,k),delete P.config,A.send(JSON.stringify(P)),new T_e(A,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const S_e={turnComplete:!0};class T_e{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let r=[];try{r=As(t.turns),e.isVertexAI()?r=r.map(i=>Gd(i)):r=r.map(i=>mw(i))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:r,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let r=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?r=t.functionResponses:r=[t.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(const a of r){if(typeof a!="object"||a===null||!("name"in a)||!("response"in a))throw new Error(`Could not parse function response, type '${typeof a}'.`);if(!e.isVertexAI()&&!("id"in a))throw new Error(b_e)}return{toolResponse:{functionResponses:r}}}sendClientContent(e){e=Object.assign(Object.assign({},S_e),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:$me(e)}:t={realtimeInput:Dme(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function A_e(n){const e={};return n.forEach((t,r)=>{e[r]=t}),e}function C_e(n){const e=new Headers;for(const[t,r]of Object.entries(n))e.append(t,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const bB=10;function wB(n){var e,t,r;if(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(const s of(t=n==null?void 0:n.tools)!==null&&t!==void 0?t:[])if(Xv(s)){i=!0;break}if(!i)return!0;const a=(r=n==null?void 0:n.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls;return a&&(a<0||!Number.isInteger(a))||a==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",a),!0):!1}function Xv(n){return"callTool"in n&&typeof n.callTool=="function"}function EB(n){var e;return!(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class x_e extends Hd{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var r,i,a,s,o;const u=await this.processParamsForMcpUsage(t);if(!d_e(t)||wB(t.config))return await this.generateContentInternal(u);if(h_e(t))throw new Error("Automatic function calling with CallableTools and Tools is not yet supported.");let c,d;const h=As(u.contents),m=(a=(i=(r=u.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&a!==void 0?a:bB;let g=0;for(;g<m&&(c=await this.generateContentInternal(u),!(!c.functionCalls||c.functionCalls.length===0));){const _=c.candidates[0].content,w=[];for(const S of(o=(s=t.config)===null||s===void 0?void 0:s.tools)!==null&&o!==void 0?o:[])if(Xv(S)){const C=await S.callTool(c.functionCalls);w.push(...C)}g++,d={role:"user",parts:w},u.contents=As(u.contents),u.contents.push(_),u.contents.push(d),EB(u.config)&&(h.push(_),h.push(d))}return EB(u.config)&&(c.automaticFunctionCallingHistory=h),c},this.generateContentStream=async t=>{if(wB(t.config)){const r=await this.processParamsForMcpUsage(t);return await this.generateContentStreamInternal(r)}else return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(r=>{var i;let a;const s=[];if(r!=null&&r.generatedImages)for(const u of r.generatedImages)u&&(u!=null&&u.safetyAttributes)&&((i=u==null?void 0:u.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?a=u==null?void 0:u.safetyAttributes:s.push(u);let o;return a?o={generatedImages:s,positivePromptSafetyAttributes:a}:o={generatedImages:s},o}),this.list=async t=>{var r;const s={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!s.config.queryBase){if(!((r=s.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");s.config.filter="labels.tune-type:*"}return new hw(xd.PAGED_ITEM_MODELS,o=>this.listInternal(o),await this.listInternal(s),s)},this.editImage=async t=>{const r={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(r.referenceImages=t.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async t=>{let r={numberOfImages:1,mode:"upscale"};t.config&&(r=Object.assign(Object.assign({},r),t.config));const i={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:r};return await this.upscaleImageInternal(i)}}async processParamsForMcpUsage(e){var t,r,i;const a=(t=e.config)===null||t===void 0?void 0:t.tools;if(!a)return e;const s=await Promise.all(a.map(async u=>Xv(u)?await u.tool():u)),o={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:s})};if(o.config.tools=s,e.config&&e.config.tools&&x8(e.config.tools)){const u=(i=(r=e.config.httpOptions)===null||r===void 0?void 0:r.headers)!==null&&i!==void 0?i:{};let c=Object.assign({},u);Object.keys(c).length===0&&(c=this.apiClient.getDefaultHeaders()),R8(c),o.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:c})}return o}async initAfcToolsMap(e){var t,r,i;const a=new Map;for(const s of(r=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&r!==void 0?r:[])if(Xv(s)){const o=s,u=await o.tool();for(const c of(i=u.functionDeclarations)!==null&&i!==void 0?i:[]){if(!c.name)throw new Error("Function declaration name is required.");if(a.has(c.name))throw new Error(`Duplicate tool declaration name: ${c.name}`);a.set(c.name,o)}}return a}async processAfcStream(e){var t,r,i;const a=(i=(r=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&i!==void 0?i:bB;let s=!1,o=0;const u=await this.initAfcToolsMap(e);return function(c,d,h){var m,g;return pd(this,arguments,function*(){for(var _,w,S,E;o<a;){s&&(o++,s=!1);const P=yield Mn(c.processParamsForMcpUsage(h)),N=yield Mn(c.generateContentStreamInternal(P)),U=[],k=[];try{for(var C=!0,A=(w=void 0,Zp(N)),R;R=yield Mn(A.next()),_=R.done,!_;C=!0){E=R.value,C=!1;const B=E;if(yield yield Mn(B),B.candidates&&(!((m=B.candidates[0])===null||m===void 0)&&m.content)){k.push(B.candidates[0].content);for(const H of(g=B.candidates[0].content.parts)!==null&&g!==void 0?g:[])if(o<a&&H.functionCall){if(!H.functionCall.name)throw new Error("Function call name was not returned by the model.");if(d.has(H.functionCall.name)){const G=yield Mn(d.get(H.functionCall.name).callTool([H.functionCall]));U.push(...G)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${d.keys()}, mising tool: ${H.functionCall.name}`)}}}}catch(B){w={error:B}}finally{try{!C&&!_&&(S=A.return)&&(yield Mn(S.call(A)))}finally{if(w)throw w.error}}if(U.length>0){s=!0;const B=new dp;B.candidates=[{content:{role:"user",parts:U}}],yield yield Mn(B);const H=[];H.push(...k),H.push({role:"user",parts:U});const G=As(h.contents).concat(H);h.contents=G}else break}})}(this,u,e)}async generateContentInternal(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=mB(this.apiClient,e);return o=St("{model}:generateContent",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>{const h=yB(d),m=new dp;return Object.assign(m,h),m})}else{const c=pB(this.apiClient,e);return o=St("{model}:generateContent",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>{const h=gB(d),m=new dp;return Object.assign(m,h),m})}}async generateContentStreamInternal(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=mB(this.apiClient,e);return o=St("{model}:streamGenerateContent?alt=sse",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.requestStream({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),s.then(function(h){return pd(this,arguments,function*(){var m,g,_,w;try{for(var S=!0,E=Zp(h),C;C=yield Mn(E.next()),m=C.done,!m;S=!0){w=C.value,S=!1;const R=yB(yield Mn(w.json())),P=new dp;Object.assign(P,R),yield yield Mn(P)}}catch(A){g={error:A}}finally{try{!S&&!m&&(_=E.return)&&(yield Mn(_.call(E)))}finally{if(g)throw g.error}}})})}else{const c=pB(this.apiClient,e);return o=St("{model}:streamGenerateContent?alt=sse",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.requestStream({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}),s.then(function(h){return pd(this,arguments,function*(){var m,g,_,w;try{for(var S=!0,E=Zp(h),C;C=yield Mn(E.next()),m=C.done,!m;S=!0){w=C.value,S=!1;const R=gB(yield Mn(w.json())),P=new dp;Object.assign(P,R),yield yield Mn(P)}}catch(A){g={error:A}}finally{try{!S&&!m&&(_=E.return)&&(yield Mn(_.call(E)))}finally{if(g)throw g.error}}})})}}async embedContent(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=Dye(this.apiClient,e);return o=St("{model}:predict",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>{const h=Fve(d),m=new KF;return Object.assign(m,h),m})}else{const c=Kge(this.apiClient,e);return o=St("{model}:batchEmbedContents",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>{const h=gve(d),m=new KF;return Object.assign(m,h),m})}}async generateImagesInternal(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=Lye(this.apiClient,e);return o=St("{model}:predict",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>{const h=qve(d),m=new JF;return Object.assign(m,h),m})}else{const c=Yge(this.apiClient,e);return o=St("{model}:predict",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>{const h=_ve(d),m=new JF;return Object.assign(m,h),m})}}async editImageInternal(e){var t,r;let i,a="",s={};if(this.apiClient.isVertexAI()){const o=zye(this.apiClient,e);return a=St("{model}:predict",o._url),s=o._query,delete o.config,delete o._url,delete o._query,i=this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),i.then(u=>{const c=Vve(u),d=new Kde;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,r;let i,a="",s={};if(this.apiClient.isVertexAI()){const o=Gye(this.apiClient,e);return a=St("{model}:predict",o._url),s=o._query,delete o.config,delete o._url,delete o._query,i=this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),i.then(u=>{const c=zve(u),d=new Jde;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=Wye(this.apiClient,e);return o=St("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>vR(d))}else{const c=Zge(this.apiClient,e);return o=St("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>yR(d))}}async listInternal(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=Jye(this.apiClient,e);return o=St("{models_url}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>{const h=Kve(this.apiClient,d),m=new YF;return Object.assign(m,h),m})}else{const c=Qge(this.apiClient,e);return o=St("{models_url}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>{const h=wve(this.apiClient,d),m=new YF;return Object.assign(m,h),m})}}async update(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=Zye(this.apiClient,e);return o=St("{model}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>vR(d))}else{const c=tye(this.apiClient,e);return o=St("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>yR(d))}}async delete(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=Xye(this.apiClient,e);return o=St("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(()=>{const d=Jve(),h=new ZF;return Object.assign(h,d),h})}else{const c=nye(this.apiClient,e);return o=St("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(()=>{const d=Eve(),h=new ZF;return Object.assign(h,d),h})}}async countTokens(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=eve(this.apiClient,e);return o=St("{model}:countTokens",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>{const h=Yve(d),m=new XF;return Object.assign(m,h),m})}else{const c=iye(this.apiClient,e);return o=St("{model}:countTokens",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>{const h=Sve(d),m=new XF;return Object.assign(m,h),m})}}async computeTokens(e){var t,r;let i,a="",s={};if(this.apiClient.isVertexAI()){const o=tve(this.apiClient,e);return a=St("{model}:computeTokens",o._url),s=o._query,delete o.config,delete o._url,delete o._query,i=this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),i.then(u=>{const c=Zve(u),d=new Yde;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideos(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=ive(this.apiClient,e);return o=St("{model}:predictLongRunning",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>t_e(d))}else{const c=oye(this.apiClient,e);return o=St("{model}:predictLongRunning",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>xve(d))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function R_e(n){const e={},t=v(n,["operationName"]);t!=null&&b(e,["_url","operationName"],t);const r=v(n,["config"]);return r!=null&&b(e,["config"],r),e}function I_e(n){const e={},t=v(n,["operationName"]);t!=null&&b(e,["_url","operationName"],t);const r=v(n,["config"]);return r!=null&&b(e,["config"],r),e}function P_e(n){const e={},t=v(n,["operationName"]);t!=null&&b(e,["operationName"],t);const r=v(n,["resourceName"]);r!=null&&b(e,["_url","resourceName"],r);const i=v(n,["config"]);return i!=null&&b(e,["config"],i),e}function O_e(n){const e={},t=v(n,["video","uri"]);t!=null&&b(e,["uri"],t);const r=v(n,["video","encodedVideo"]);r!=null&&b(e,["videoBytes"],al(r));const i=v(n,["encoding"]);return i!=null&&b(e,["mimeType"],i),e}function k_e(n){const e={},t=v(n,["_self"]);return t!=null&&b(e,["video"],O_e(t)),e}function N_e(n){const e={},t=v(n,["generatedSamples"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(s=>k_e(s))),b(e,["generatedVideos"],a)}const r=v(n,["raiMediaFilteredCount"]);r!=null&&b(e,["raiMediaFilteredCount"],r);const i=v(n,["raiMediaFilteredReasons"]);return i!=null&&b(e,["raiMediaFilteredReasons"],i),e}function M_e(n){const e={},t=v(n,["name"]);t!=null&&b(e,["name"],t);const r=v(n,["metadata"]);r!=null&&b(e,["metadata"],r);const i=v(n,["done"]);i!=null&&b(e,["done"],i);const a=v(n,["error"]);a!=null&&b(e,["error"],a);const s=v(n,["response","generateVideoResponse"]);return s!=null&&b(e,["response"],N_e(s)),e}function D_e(n){const e={},t=v(n,["gcsUri"]);t!=null&&b(e,["uri"],t);const r=v(n,["bytesBase64Encoded"]);r!=null&&b(e,["videoBytes"],al(r));const i=v(n,["mimeType"]);return i!=null&&b(e,["mimeType"],i),e}function $_e(n){const e={},t=v(n,["_self"]);return t!=null&&b(e,["video"],D_e(t)),e}function L_e(n){const e={},t=v(n,["videos"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(s=>$_e(s))),b(e,["generatedVideos"],a)}const r=v(n,["raiMediaFilteredCount"]);r!=null&&b(e,["raiMediaFilteredCount"],r);const i=v(n,["raiMediaFilteredReasons"]);return i!=null&&b(e,["raiMediaFilteredReasons"],i),e}function SB(n){const e={},t=v(n,["name"]);t!=null&&b(e,["name"],t);const r=v(n,["metadata"]);r!=null&&b(e,["metadata"],r);const i=v(n,["done"]);i!=null&&b(e,["done"],i);const a=v(n,["error"]);a!=null&&b(e,["error"],a);const s=v(n,["response"]);return s!=null&&b(e,["response"],L_e(s)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class U_e extends Hd{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,r=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=t.name.split("/operations/")[0];let a;return r&&"httpOptions"in r&&(a=r.httpOptions),this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:a}})}else return this.getVideosOperationInternal({operationName:t.name,config:r})}async getVideosOperationInternal(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=I_e(e);return o=St("{operationName}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>SB(d))}else{const c=R_e(e);return o=St("{operationName}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>M_e(d))}}async fetchPredictVideosOperationInternal(e){var t,r;let i,a="",s={};if(this.apiClient.isVertexAI()){const o=P_e(e);return a=St("{resourceName}:fetchPredictOperation",o._url),s=o._query,delete o.config,delete o._url,delete o._query,i=this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),i.then(u=>SB(u))}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function j_e(n){const e={},t=v(n,["voiceName"]);return t!=null&&b(e,["voiceName"],t),e}function I8(n){const e={},t=v(n,["prebuiltVoiceConfig"]);return t!=null&&b(e,["prebuiltVoiceConfig"],j_e(t)),e}function F_e(n){const e={},t=v(n,["speaker"]);t!=null&&b(e,["speaker"],t);const r=v(n,["voiceConfig"]);return r!=null&&b(e,["voiceConfig"],I8(r)),e}function B_e(n){const e={},t=v(n,["speakerVoiceConfigs"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>F_e(i))),b(e,["speakerVoiceConfigs"],r)}return e}function q_e(n){const e={},t=v(n,["voiceConfig"]);t!=null&&b(e,["voiceConfig"],I8(t));const r=v(n,["multiSpeakerVoiceConfig"]);r!=null&&b(e,["multiSpeakerVoiceConfig"],B_e(r));const i=v(n,["languageCode"]);return i!=null&&b(e,["languageCode"],i),e}function V_e(n){const e={},t=v(n,["fps"]);t!=null&&b(e,["fps"],t);const r=v(n,["endOffset"]);r!=null&&b(e,["endOffset"],r);const i=v(n,["startOffset"]);return i!=null&&b(e,["startOffset"],i),e}function z_e(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["data"]);t!=null&&b(e,["data"],t);const r=v(n,["mimeType"]);return r!=null&&b(e,["mimeType"],r),e}function H_e(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["fileUri"]);t!=null&&b(e,["fileUri"],t);const r=v(n,["mimeType"]);return r!=null&&b(e,["mimeType"],r),e}function G_e(n){const e={},t=v(n,["videoMetadata"]);t!=null&&b(e,["videoMetadata"],V_e(t));const r=v(n,["thought"]);r!=null&&b(e,["thought"],r);const i=v(n,["inlineData"]);i!=null&&b(e,["inlineData"],z_e(i));const a=v(n,["fileData"]);a!=null&&b(e,["fileData"],H_e(a));const s=v(n,["thoughtSignature"]);s!=null&&b(e,["thoughtSignature"],s);const o=v(n,["codeExecutionResult"]);o!=null&&b(e,["codeExecutionResult"],o);const u=v(n,["executableCode"]);u!=null&&b(e,["executableCode"],u);const c=v(n,["functionCall"]);c!=null&&b(e,["functionCall"],c);const d=v(n,["functionResponse"]);d!=null&&b(e,["functionResponse"],d);const h=v(n,["text"]);return h!=null&&b(e,["text"],h),e}function W_e(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>G_e(a))),b(e,["parts"],i)}const r=v(n,["role"]);return r!=null&&b(e,["role"],r),e}function K_e(n){const e={},t=v(n,["behavior"]);t!=null&&b(e,["behavior"],t);const r=v(n,["description"]);r!=null&&b(e,["description"],r);const i=v(n,["name"]);i!=null&&b(e,["name"],i);const a=v(n,["parameters"]);a!=null&&b(e,["parameters"],a);const s=v(n,["parametersJsonSchema"]);s!=null&&b(e,["parametersJsonSchema"],s);const o=v(n,["response"]);o!=null&&b(e,["response"],o);const u=v(n,["responseJsonSchema"]);return u!=null&&b(e,["responseJsonSchema"],u),e}function J_e(n){const e={},t=v(n,["startTime"]);t!=null&&b(e,["startTime"],t);const r=v(n,["endTime"]);return r!=null&&b(e,["endTime"],r),e}function Y_e(n){const e={},t=v(n,["timeRangeFilter"]);return t!=null&&b(e,["timeRangeFilter"],J_e(t)),e}function Z_e(n){const e={},t=v(n,["mode"]);t!=null&&b(e,["mode"],t);const r=v(n,["dynamicThreshold"]);return r!=null&&b(e,["dynamicThreshold"],r),e}function X_e(n){const e={},t=v(n,["dynamicRetrievalConfig"]);return t!=null&&b(e,["dynamicRetrievalConfig"],Z_e(t)),e}function Q_e(){return{}}function ebe(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(u=>K_e(u))),b(e,["functionDeclarations"],o)}if(v(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=v(n,["googleSearch"]);r!=null&&b(e,["googleSearch"],Y_e(r));const i=v(n,["googleSearchRetrieval"]);if(i!=null&&b(e,["googleSearchRetrieval"],X_e(i)),v(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(v(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");v(n,["urlContext"])!=null&&b(e,["urlContext"],Q_e());const s=v(n,["codeExecution"]);return s!=null&&b(e,["codeExecution"],s),e}function tbe(n){const e={},t=v(n,["handle"]);if(t!=null&&b(e,["handle"],t),v(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function TB(){return{}}function nbe(n){const e={},t=v(n,["disabled"]);t!=null&&b(e,["disabled"],t);const r=v(n,["startOfSpeechSensitivity"]);r!=null&&b(e,["startOfSpeechSensitivity"],r);const i=v(n,["endOfSpeechSensitivity"]);i!=null&&b(e,["endOfSpeechSensitivity"],i);const a=v(n,["prefixPaddingMs"]);a!=null&&b(e,["prefixPaddingMs"],a);const s=v(n,["silenceDurationMs"]);return s!=null&&b(e,["silenceDurationMs"],s),e}function rbe(n){const e={},t=v(n,["automaticActivityDetection"]);t!=null&&b(e,["automaticActivityDetection"],nbe(t));const r=v(n,["activityHandling"]);r!=null&&b(e,["activityHandling"],r);const i=v(n,["turnCoverage"]);return i!=null&&b(e,["turnCoverage"],i),e}function ibe(n){const e={},t=v(n,["targetTokens"]);return t!=null&&b(e,["targetTokens"],t),e}function abe(n){const e={},t=v(n,["triggerTokens"]);t!=null&&b(e,["triggerTokens"],t);const r=v(n,["slidingWindow"]);return r!=null&&b(e,["slidingWindow"],ibe(r)),e}function sbe(n){const e={},t=v(n,["proactiveAudio"]);return t!=null&&b(e,["proactiveAudio"],t),e}function obe(n,e){const t={},r=v(n,["generationConfig"]);e!==void 0&&r!=null&&b(e,["setup","generationConfig"],r);const i=v(n,["responseModalities"]);e!==void 0&&i!=null&&b(e,["setup","generationConfig","responseModalities"],i);const a=v(n,["temperature"]);e!==void 0&&a!=null&&b(e,["setup","generationConfig","temperature"],a);const s=v(n,["topP"]);e!==void 0&&s!=null&&b(e,["setup","generationConfig","topP"],s);const o=v(n,["topK"]);e!==void 0&&o!=null&&b(e,["setup","generationConfig","topK"],o);const u=v(n,["maxOutputTokens"]);e!==void 0&&u!=null&&b(e,["setup","generationConfig","maxOutputTokens"],u);const c=v(n,["mediaResolution"]);e!==void 0&&c!=null&&b(e,["setup","generationConfig","mediaResolution"],c);const d=v(n,["seed"]);e!==void 0&&d!=null&&b(e,["setup","generationConfig","seed"],d);const h=v(n,["speechConfig"]);e!==void 0&&h!=null&&b(e,["setup","generationConfig","speechConfig"],q_e(LP(h)));const m=v(n,["enableAffectiveDialog"]);e!==void 0&&m!=null&&b(e,["setup","generationConfig","enableAffectiveDialog"],m);const g=v(n,["systemInstruction"]);e!==void 0&&g!=null&&b(e,["setup","systemInstruction"],W_e(vi(g)));const _=v(n,["tools"]);if(e!==void 0&&_!=null){let P=cg(_);Array.isArray(P)&&(P=P.map(N=>ebe(ug(N)))),b(e,["setup","tools"],P)}const w=v(n,["sessionResumption"]);e!==void 0&&w!=null&&b(e,["setup","sessionResumption"],tbe(w));const S=v(n,["inputAudioTranscription"]);e!==void 0&&S!=null&&b(e,["setup","inputAudioTranscription"],TB());const E=v(n,["outputAudioTranscription"]);e!==void 0&&E!=null&&b(e,["setup","outputAudioTranscription"],TB());const C=v(n,["realtimeInputConfig"]);e!==void 0&&C!=null&&b(e,["setup","realtimeInputConfig"],rbe(C));const A=v(n,["contextWindowCompression"]);e!==void 0&&A!=null&&b(e,["setup","contextWindowCompression"],abe(A));const R=v(n,["proactivity"]);return e!==void 0&&R!=null&&b(e,["setup","proactivity"],sbe(R)),t}function lbe(n,e){const t={},r=v(e,["model"]);r!=null&&b(t,["setup","model"],Nn(n,r));const i=v(e,["config"]);return i!=null&&b(t,["config"],obe(i,t)),t}function ube(n,e,t){const r={},i=v(e,["expireTime"]);t!==void 0&&i!=null&&b(t,["expireTime"],i);const a=v(e,["newSessionExpireTime"]);t!==void 0&&a!=null&&b(t,["newSessionExpireTime"],a);const s=v(e,["uses"]);t!==void 0&&s!=null&&b(t,["uses"],s);const o=v(e,["liveConnectConstraints"]);t!==void 0&&o!=null&&b(t,["bidiGenerateContentSetup"],lbe(n,o));const u=v(e,["lockAdditionalFields"]);return t!==void 0&&u!=null&&b(t,["fieldMask"],u),r}function cbe(n,e){const t={},r=v(e,["config"]);return r!=null&&b(t,["config"],ube(n,r,t)),t}function fbe(n){const e={},t=v(n,["name"]);return t!=null&&b(e,["name"],t),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function dbe(n){const e=[];for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const r=n[t];if(typeof r=="object"&&r!=null&&Object.keys(r).length>0){const i=Object.keys(r).map(a=>`${t}.${a}`);e.push(...i)}else e.push(t)}return e.join(",")}function hbe(n,e){let t=null;const r=n.bidiGenerateContentSetup;if(typeof r=="object"&&r!==null&&"setup"in r){const a=r.setup;typeof a=="object"&&a!==null?(n.bidiGenerateContentSetup=a,t=a):delete n.bidiGenerateContentSetup}else r!==void 0&&delete n.bidiGenerateContentSetup;const i=n.fieldMask;if(t){const a=dbe(t);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)a?n.fieldMask=a:delete n.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){const s=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let o=[];i.length>0&&(o=i.map(c=>s.includes(c)?`generationConfig.${c}`:c));const u=[];a&&u.push(a),o.length>0&&u.push(...o),u.length>0?n.fieldMask=u.join(","):delete n.fieldMask}else delete n.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?n.fieldMask=i.join(","):delete n.fieldMask;return n}class pbe extends Hd{constructor(e){super(),this.apiClient=e}async create(e){var t,r;let i,a="",s={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const o=cbe(this.apiClient,e);a=St("auth_tokens",o._url),s=o._query,delete o.config,delete o._url,delete o._query;const u=hbe(o,e.config);return i=this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),i.then(c=>fbe(c))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function mbe(n){const e={},t=v(n,["name"]);t!=null&&b(e,["_url","name"],t);const r=v(n,["config"]);return r!=null&&b(e,["config"],r),e}function gbe(n,e){const t={},r=v(n,["pageSize"]);e!==void 0&&r!=null&&b(e,["_query","pageSize"],r);const i=v(n,["pageToken"]);e!==void 0&&i!=null&&b(e,["_query","pageToken"],i);const a=v(n,["filter"]);return e!==void 0&&a!=null&&b(e,["_query","filter"],a),t}function ybe(n){const e={},t=v(n,["config"]);return t!=null&&b(e,["config"],gbe(t,e)),e}function vbe(n){const e={},t=v(n,["textInput"]);t!=null&&b(e,["textInput"],t);const r=v(n,["output"]);return r!=null&&b(e,["output"],r),e}function _be(n){const e={};if(v(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const t=v(n,["examples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>vbe(i))),b(e,["examples","examples"],r)}return e}function bbe(n,e){const t={};if(v(n,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const r=v(n,["tunedModelDisplayName"]);if(e!==void 0&&r!=null&&b(e,["displayName"],r),v(n,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const i=v(n,["epochCount"]);e!==void 0&&i!=null&&b(e,["tuningTask","hyperparameters","epochCount"],i);const a=v(n,["learningRateMultiplier"]);if(a!=null&&b(t,["tuningTask","hyperparameters","learningRateMultiplier"],a),v(n,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(v(n,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const s=v(n,["batchSize"]);e!==void 0&&s!=null&&b(e,["tuningTask","hyperparameters","batchSize"],s);const o=v(n,["learningRate"]);return e!==void 0&&o!=null&&b(e,["tuningTask","hyperparameters","learningRate"],o),t}function wbe(n){const e={},t=v(n,["baseModel"]);t!=null&&b(e,["baseModel"],t);const r=v(n,["trainingDataset"]);r!=null&&b(e,["tuningTask","trainingData"],_be(r));const i=v(n,["config"]);return i!=null&&b(e,["config"],bbe(i,e)),e}function Ebe(n){const e={},t=v(n,["name"]);t!=null&&b(e,["_url","name"],t);const r=v(n,["config"]);return r!=null&&b(e,["config"],r),e}function Sbe(n,e){const t={},r=v(n,["pageSize"]);e!==void 0&&r!=null&&b(e,["_query","pageSize"],r);const i=v(n,["pageToken"]);e!==void 0&&i!=null&&b(e,["_query","pageToken"],i);const a=v(n,["filter"]);return e!==void 0&&a!=null&&b(e,["_query","filter"],a),t}function Tbe(n){const e={},t=v(n,["config"]);return t!=null&&b(e,["config"],Sbe(t,e)),e}function Abe(n,e){const t={},r=v(n,["gcsUri"]);if(e!==void 0&&r!=null&&b(e,["supervisedTuningSpec","trainingDatasetUri"],r),v(n,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return t}function Cbe(n){const e={},t=v(n,["gcsUri"]);return t!=null&&b(e,["validationDatasetUri"],t),e}function xbe(n,e){const t={},r=v(n,["validationDataset"]);e!==void 0&&r!=null&&b(e,["supervisedTuningSpec"],Cbe(r));const i=v(n,["tunedModelDisplayName"]);e!==void 0&&i!=null&&b(e,["tunedModelDisplayName"],i);const a=v(n,["description"]);e!==void 0&&a!=null&&b(e,["description"],a);const s=v(n,["epochCount"]);e!==void 0&&s!=null&&b(e,["supervisedTuningSpec","hyperParameters","epochCount"],s);const o=v(n,["learningRateMultiplier"]);e!==void 0&&o!=null&&b(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],o);const u=v(n,["exportLastCheckpointOnly"]);e!==void 0&&u!=null&&b(e,["supervisedTuningSpec","exportLastCheckpointOnly"],u);const c=v(n,["adapterSize"]);if(e!==void 0&&c!=null&&b(e,["supervisedTuningSpec","hyperParameters","adapterSize"],c),v(n,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(v(n,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");return t}function Rbe(n){const e={},t=v(n,["baseModel"]);t!=null&&b(e,["baseModel"],t);const r=v(n,["trainingDataset"]);r!=null&&b(e,["supervisedTuningSpec","trainingDatasetUri"],Abe(r,e));const i=v(n,["config"]);return i!=null&&b(e,["config"],xbe(i,e)),e}function Ibe(n){const e={},t=v(n,["name"]);t!=null&&b(e,["model"],t);const r=v(n,["name"]);return r!=null&&b(e,["endpoint"],r),e}function P8(n){const e={},t=v(n,["name"]);t!=null&&b(e,["name"],t);const r=v(n,["state"]);r!=null&&b(e,["state"],h8(r));const i=v(n,["createTime"]);i!=null&&b(e,["createTime"],i);const a=v(n,["tuningTask","startTime"]);a!=null&&b(e,["startTime"],a);const s=v(n,["tuningTask","completeTime"]);s!=null&&b(e,["endTime"],s);const o=v(n,["updateTime"]);o!=null&&b(e,["updateTime"],o);const u=v(n,["description"]);u!=null&&b(e,["description"],u);const c=v(n,["baseModel"]);c!=null&&b(e,["baseModel"],c);const d=v(n,["_self"]);d!=null&&b(e,["tunedModel"],Ibe(d));const h=v(n,["distillationSpec"]);h!=null&&b(e,["distillationSpec"],h);const m=v(n,["experiment"]);m!=null&&b(e,["experiment"],m);const g=v(n,["labels"]);g!=null&&b(e,["labels"],g);const _=v(n,["pipelineJob"]);_!=null&&b(e,["pipelineJob"],_);const w=v(n,["serviceAccount"]);w!=null&&b(e,["serviceAccount"],w);const S=v(n,["tunedModelDisplayName"]);return S!=null&&b(e,["tunedModelDisplayName"],S),e}function Pbe(n){const e={},t=v(n,["nextPageToken"]);t!=null&&b(e,["nextPageToken"],t);const r=v(n,["tunedModels"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(a=>P8(a))),b(e,["tuningJobs"],i)}return e}function Obe(n){const e={},t=v(n,["name"]);t!=null&&b(e,["name"],t);const r=v(n,["metadata"]);r!=null&&b(e,["metadata"],r);const i=v(n,["done"]);i!=null&&b(e,["done"],i);const a=v(n,["error"]);return a!=null&&b(e,["error"],a),e}function kbe(n){const e={},t=v(n,["checkpointId"]);t!=null&&b(e,["checkpointId"],t);const r=v(n,["epoch"]);r!=null&&b(e,["epoch"],r);const i=v(n,["step"]);i!=null&&b(e,["step"],i);const a=v(n,["endpoint"]);return a!=null&&b(e,["endpoint"],a),e}function Nbe(n){const e={},t=v(n,["model"]);t!=null&&b(e,["model"],t);const r=v(n,["endpoint"]);r!=null&&b(e,["endpoint"],r);const i=v(n,["checkpoints"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(s=>kbe(s))),b(e,["checkpoints"],a)}return e}function bR(n){const e={},t=v(n,["name"]);t!=null&&b(e,["name"],t);const r=v(n,["state"]);r!=null&&b(e,["state"],h8(r));const i=v(n,["createTime"]);i!=null&&b(e,["createTime"],i);const a=v(n,["startTime"]);a!=null&&b(e,["startTime"],a);const s=v(n,["endTime"]);s!=null&&b(e,["endTime"],s);const o=v(n,["updateTime"]);o!=null&&b(e,["updateTime"],o);const u=v(n,["error"]);u!=null&&b(e,["error"],u);const c=v(n,["description"]);c!=null&&b(e,["description"],c);const d=v(n,["baseModel"]);d!=null&&b(e,["baseModel"],d);const h=v(n,["tunedModel"]);h!=null&&b(e,["tunedModel"],Nbe(h));const m=v(n,["supervisedTuningSpec"]);m!=null&&b(e,["supervisedTuningSpec"],m);const g=v(n,["tuningDataStats"]);g!=null&&b(e,["tuningDataStats"],g);const _=v(n,["encryptionSpec"]);_!=null&&b(e,["encryptionSpec"],_);const w=v(n,["partnerModelTuningSpec"]);w!=null&&b(e,["partnerModelTuningSpec"],w);const S=v(n,["distillationSpec"]);S!=null&&b(e,["distillationSpec"],S);const E=v(n,["experiment"]);E!=null&&b(e,["experiment"],E);const C=v(n,["labels"]);C!=null&&b(e,["labels"],C);const A=v(n,["pipelineJob"]);A!=null&&b(e,["pipelineJob"],A);const R=v(n,["serviceAccount"]);R!=null&&b(e,["serviceAccount"],R);const P=v(n,["tunedModelDisplayName"]);return P!=null&&b(e,["tunedModelDisplayName"],P),e}function Mbe(n){const e={},t=v(n,["nextPageToken"]);t!=null&&b(e,["nextPageToken"],t);const r=v(n,["tuningJobs"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(a=>bR(a))),b(e,["tuningJobs"],i)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Dbe extends Hd{constructor(e){super(),this.apiClient=e,this.get=async t=>await this.getInternal(t),this.list=async(t={})=>new hw(xd.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(t),t),this.tune=async t=>{if(this.apiClient.isVertexAI())return await this.tuneInternal(t);{const r=await this.tuneMldevInternal(t);let i="";return r.metadata!==void 0&&r.metadata.tunedModel!==void 0?i=r.metadata.tunedModel:r.name!==void 0&&r.name.includes("/operations/")&&(i=r.name.split("/operations/")[0]),{name:i,state:dR.JOB_STATE_QUEUED}}}}async getInternal(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=Ebe(e);return o=St("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>bR(d))}else{const c=mbe(e);return o=St("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>P8(d))}}async listInternal(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=Tbe(e);return o=St("tuningJobs",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>{const h=Mbe(d),m=new QF;return Object.assign(m,h),m})}else{const c=ybe(e);return o=St("tunedModels",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>{const h=Pbe(d),m=new QF;return Object.assign(m,h),m})}}async tuneInternal(e){var t,r;let i,a="",s={};if(this.apiClient.isVertexAI()){const o=Rbe(e);return a=St("tuningJobs",o._url),s=o._query,delete o.config,delete o._url,delete o._query,i=this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),i.then(u=>bR(u))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,r;let i,a="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=wbe(e);return a=St("tunedModels",o._url),s=o._query,delete o.config,delete o._url,delete o._query,i=this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),i.then(u=>Obe(u))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class $be{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const Lbe=1024*1024*8,Ube=3,jbe=1e3,Fbe=2,uC="x-goog-upload-status";async function Bbe(n,e,t){var r,i,a;let s=0,o=0,u=new hR(new Response),c="upload";for(s=n.size;o<s;){const h=Math.min(Lbe,s-o),m=n.slice(o,o+h);o+h>=s&&(c+=", finalize");let g=0,_=jbe;for(;g<Ube&&(u=await t.request({path:"",body:m,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(o),"Content-Length":String(h)}}}),!(!((r=u==null?void 0:u.headers)===null||r===void 0)&&r[uC]));)g++,await Vbe(_),_=_*Fbe;if(o+=h,((i=u==null?void 0:u.headers)===null||i===void 0?void 0:i[uC])!=="active")break;if(s<=o)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const d=await(u==null?void 0:u.json());if(((a=u==null?void 0:u.headers)===null||a===void 0?void 0:a[uC])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return d.file}async function qbe(n){return{size:n.size,type:n.type}}function Vbe(n){return new Promise(e=>setTimeout(e,n))}class zbe{async upload(e,t,r){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Bbe(e,t,r)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await qbe(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Hbe{create(e,t,r){return new Gbe(e,t,r)}}class Gbe{constructor(e,t,r){this.url=e,this.headers=t,this.callbacks=r}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const AB="x-goog-api-key";class Wbe{constructor(e){this.apiKey=e}async addAuthHeaders(e){if(e.get(AB)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(AB,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Kbe="gl-node/";class Jbe{constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const r=Wde(e,void 0,void 0);r&&(e.httpOptions?e.httpOptions.baseUrl=r:e.httpOptions={baseUrl:r}),this.apiVersion=e.apiVersion;const i=new Wbe(this.apiKey);this.apiClient=new u_e({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:Kbe+"web",uploader:new zbe,downloader:new $be}),this.models=new x_e(this.apiClient),this.live=new E_e(this.apiClient,i,new Hbe),this.chats=new bpe(this.models,this.apiClient),this.caches=new ype(this.apiClient),this.files=new Npe(this.apiClient),this.operations=new U_e(this.apiClient),this.authTokens=new pbe(this.apiClient),this.tunings=new Dbe(this.apiClient)}}const O8=n=>{if(!n||n.trim()==="")return null;try{return new Jbe({apiKey:n})}catch(e){return console.error("Failed to initialize GoogleGenAI with provided key:",e),null}},BP=n=>!!n&&n.trim()!=="",Ybe=async(n,e)=>{if(!BP(e))return"Gemini API is not available. Please ensure API Key is configured in API Key Management.";const t=O8(e);if(!t)return"Gemini API client could not be initialized. Check console for details (e.g., invalid API key format).";try{const r=[{role:"user",parts:[{text:n}]}];return(await t.models.generateContent({model:B3,contents:r})).text}catch(r){return console.error("Error generating text with Gemini:",r),r instanceof Error?r.message.includes("API key not valid")?"Error from Gemini: API key not valid. Please check your Gemini API key.":`Error from Gemini: ${r.message}`:"An unknown error occurred while contacting Gemini."}},Zbe=async(n,e,t,r,i)=>{if(!BP(e)){i("Gemini API is not available. Please ensure API Key is configured in API Key Management."),r();return}const a=O8(e);if(!a){i("Gemini API client could not be initialized. Check console for details (e.g., invalid API key format)."),r();return}try{const s=[{role:"user",parts:[{text:n}]}],o=await a.models.generateContentStream({model:B3,contents:s});for await(const u of o)t(u.text)}catch(s){console.error("Error generating streaming text with Gemini:",s),s instanceof Error?s.message.includes("API key not valid")?i("Error from Gemini: API key not valid. Please check your Gemini API key."):i(`Error from Gemini: ${s.message}`):i("An unknown error occurred while contacting Gemini.")}finally{r()}},wv={generateText:Ybe,generateTextStream:Zbe,isAvailable:BP},qP=n=>!!n&&n.trim()!=="",Xbe=async(n,e)=>qP(e)?(await new Promise(t=>setTimeout(t,1e3)),`(Stubbed OpenAI Response) You asked: "${n}". This feature is not fully implemented.`):"OpenAI API is not available. Please ensure API Key is configured.",Qbe=async(n,e,t,r,i)=>{if(!qP(e)){i("OpenAI API is not available. Please ensure API Key is configured."),r();return}t(`(Stubbed OpenAI Stream) You asked: "${n}". `),await new Promise(a=>setTimeout(a,500)),t("This feature is not fully implemented."),r()},CB={generateText:Xbe,generateTextStream:Qbe,isAvailable:qP},VP=n=>!!n&&n.trim()!=="",ewe=async(n,e)=>VP(e)?(await new Promise(t=>setTimeout(t,1e3)),`(Stubbed Claude Response) You said: "${n}". This function is a placeholder.`):"Claude API is not available. Please ensure API Key is configured.",twe=async(n,e,t,r,i)=>{if(!VP(e)){i("Claude API is not available. Please ensure API Key is configured."),r();return}t(`(Stubbed Claude Stream) You said: "${n}". `),await new Promise(a=>setTimeout(a,500)),t("This function is a placeholder."),r()},xB={generateText:ewe,generateTextStream:twe,isAvailable:VP},RB="mcpLlmClientMcpServers",nwe=({})=>{const[n,e]=wt.useState([]),[t,r]=wt.useState(!1),[i,a]=wt.useState(void 0),[s,o]=wt.useState(0),u=wt.useCallback(S=>{e(S)},[]);wt.useEffect(()=>{try{const S=localStorage.getItem(RB);if(S){const E=JSON.parse(S);Array.isArray(E)&&u(E.map(C=>({...C,status:"idle",statusMessage:"Not Connected",client:new kx({name:"MCP LLM Client",version:"1.0.0"},{capabilities:{tools:!0}}),transport:void 0})))}}catch(S){console.error("Error loading MCP servers from localStorage:",S)}finally{r(!0)}},[u]),wt.useEffect(()=>{if(t)try{const S=n.map(({client:E,transport:C,...A})=>A);localStorage.setItem(RB,JSON.stringify(S))}catch(S){console.error("Error saving MCP servers to localStorage:",S)}},[n,t]);const c=wt.useCallback((S,E,C)=>{const A=new kx({name:"MCP LLM Client",version:"1.0.0"},{capabilities:{tools:!0}}),R={id:`mcp-${Date.now()}`,name:S,url:E,bearerToken:(C==null?void 0:C.trim())||void 0,status:"idle",statusMessage:"Not Connected",client:A,transport:void 0};u(P=>[...P,R])},[u]),d=wt.useCallback(S=>{u(E=>{const C=E.find(A=>A.id===S);return C!=null&&C.transport&&C.transport.close(),E.filter(A=>A.id!==S)})},[u]),h=wt.useCallback((S,E,C)=>{u(A=>A.map(R=>R.id===S?{...R,status:E,statusMessage:C}:R))},[u]),m=wt.useCallback(async S=>{const E=n.find(C=>C.id===S);if(!(!E||!E.client)){E.transport&&(E.transport.close(),await new Promise(C=>setTimeout(C,50))),h(S,"connecting",`Connecting to ${E.name}...`);try{const C=new qx(new URL(E.url),{requestInit:{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json; text/event-stream",...E.bearerToken&&{Authorization:`Bearer ${E.bearerToken}`}}}});u(A=>A.map(R=>R.id===S?{...R,transport:C}:R)),await E.client.connect(C),h(S,"connected","Connected to MCP server.")}catch(C){console.error(`Error connecting to ${E.name} using MCP SDK:`,C),h(S,"error",`Failed to connect: ${C.message||"Unknown error"}.`)}}},[n,h,u]),g=wt.useMemo(()=>n.reduce((S,E)=>(S[E.name]={url:E.url,bearerToken:E.bearerToken},S),{}),[n]),_=wt.useMemo(()=>n.filter(S=>S.status==="connected").reduce((S,E)=>(S[E.name]={url:E.url,bearerToken:E.bearerToken},S),{}),[n]),w=wt.useRef(_);return wt.useEffect(()=>{const S=JSON.stringify(_),E=JSON.stringify(w.current);S!==E&&(o(C=>C+1),w.current=_)},[_]),wt.useEffect(()=>{t&&n.forEach(S=>{S.status==="idle"&&m(S.id)})},[t]),{mcpServers:n,serversLoadedFromStorage:t,handleAddServer:c,handleRemoveServer:d,handleConnectToServer:m,mcpCleanup:i,mcpServerConfig:g,connectedServersVersion:s,stableConnectedServerConfig:_}},rwe=()=>{};var IB={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k8=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},iwe=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const a=n[t++];e[r++]=String.fromCharCode((i&31)<<6|a&63)}else if(i>239&&i<365){const a=n[t++],s=n[t++],o=n[t++],u=((i&7)<<18|(a&63)<<12|(s&63)<<6|o&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const a=n[t++],s=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(a&63)<<6|s&63)}}return e.join("")},N8={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const a=n[i],s=i+1<n.length,o=s?n[i+1]:0,u=i+2<n.length,c=u?n[i+2]:0,d=a>>2,h=(a&3)<<4|o>>4;let m=(o&15)<<2|c>>6,g=c&63;u||(g=64,s||(m=64)),r.push(t[d],t[h],t[m],t[g])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(k8(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):iwe(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const a=t[n.charAt(i++)],o=i<n.length?t[n.charAt(i)]:0;++i;const c=i<n.length?t[n.charAt(i)]:64;++i;const h=i<n.length?t[n.charAt(i)]:64;if(++i,a==null||o==null||c==null||h==null)throw new awe;const m=a<<2|o>>4;if(r.push(m),c!==64){const g=o<<4&240|c>>2;if(r.push(g),h!==64){const _=c<<6&192|h;r.push(_)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class awe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const swe=function(n){const e=k8(n);return N8.encodeByteArray(e,!0)},M8=function(n){return swe(n).replace(/\./g,"")},zP=function(n){try{return N8.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function nb(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!owe(t)||(n[t]=nb(n[t],e[t]));return n}function owe(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D8(){if(typeof self<"u")return self;if(typeof window<"u"||typeof window<"u")return window;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lwe=()=>D8().__FIREBASE_DEFAULTS__,uwe=()=>{if(typeof ot>"u"||typeof IB>"u")return;const n=IB.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},cwe=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&zP(n[1]);return e&&JSON.parse(e)},HP=()=>{try{return rwe()||lwe()||uwe()||cwe()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},$8=()=>{var n;return(n=HP())===null||n===void 0?void 0:n.config},fwe=n=>{var e;return(e=HP())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dwe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yw(n){return n.endsWith(".cloudworkstations.dev")}async function hwe(n){return(await fetch(n,{credentials:"include"})).ok}const Xp={};function pwe(){const n={prod:[],emulator:[]};for(const e of Object.keys(Xp))Xp[e]?n.emulator.push(e):n.prod.push(e);return n}function mwe(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let PB=!1;function gwe(n,e){if(typeof window>"u"||typeof document>"u"||!yw(window.location.host)||Xp[n]===e||Xp[n]||PB)return;Xp[n]=e;function t(m){return`__firebase__banner__${m}`}const r="__firebase__banner",a=pwe().prod.length>0;function s(){const m=document.getElementById(r);m&&m.remove()}function o(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function u(m,g){m.setAttribute("width","24"),m.setAttribute("id",g),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function c(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{PB=!0,s()},m}function d(m,g){m.setAttribute("id",g),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function h(){const m=mwe(r),g=t("text"),_=document.getElementById(g)||document.createElement("span"),w=t("learnmore"),S=document.getElementById(w)||document.createElement("a"),E=t("preprendIcon"),C=document.getElementById(E)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const A=m.element;o(A),d(S,w);const R=c();u(C,E),A.append(C,_,S,R),document.body.appendChild(A)}a?(_.innerText="Preview backend disconnected.",C.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(C.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,_.innerText="Preview backend running in this workspace."),_.setAttribute("id",g)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",h):h()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rr(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function ywe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Rr())}function L8(){var n;const e=(n=HP())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(window.process)==="[object process]"}catch{return!1}}function vwe(){return typeof window<"u"||U8()}function U8(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function _we(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function j8(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function GP(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function F8(){const n=Rr();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function rb(){try{return typeof indexedDB=="object"}catch{return!1}}function bwe(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var a;e(((a=i.error)===null||a===void 0?void 0:a.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wwe="FirebaseError";class Wi extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=wwe,Object.setPrototypeOf(this,Wi.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Nc.prototype.create)}}class Nc{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,a=this.errors[e],s=a?Ewe(a,r):"Error",o=`${this.serviceName}: ${s} (${i}).`;return new Wi(i,o,r)}}function Ewe(n,e){return n.replace(Swe,(t,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const Swe=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function OB(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Twe(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Em(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const a=n[i],s=e[i];if(kB(a)&&kB(s)){if(!Em(a,s))return!1}else if(a!==s)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function kB(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wd(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function ed(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,a]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(a)}}),e}function Dp(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function B8(n,e){const t=new Awe(n,e);return t.subscribe.bind(t)}class Awe{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");Cwe(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=cC),i.error===void 0&&(i.error=cC),i.complete===void 0&&(i.complete=cC);const a=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),a}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Cwe(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function cC(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function an(n){return n&&n._delegate?n._delegate:n}class ru{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Lu="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xwe{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new dwe;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(a){if(i)return null;throw a}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(Iwe(e))try{this.getOrInitializeService({instanceIdentifier:Lu})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const a=this.getOrInitializeService({instanceIdentifier:i});r.resolve(a)}catch{}}}}clearInstance(e=Lu){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=Lu){return this.instances.has(e)}getOptions(e=Lu){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[a,s]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(a);r===o&&s.resolve(i)}return i}onInit(e,t){var r;const i=this.normalizeInstanceIdentifier(t),a=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;a.add(e),this.onInitCallbacks.set(i,a);const s=this.instances.get(i);return s&&e(s,i),()=>{a.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Rwe(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=Lu){return this.component?this.component.multipleInstances?e:Lu:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Rwe(n){return n===Lu?void 0:n}function Iwe(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class q8{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new xwe(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const WP=[];var Sn;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(Sn||(Sn={}));const V8={debug:Sn.DEBUG,verbose:Sn.VERBOSE,info:Sn.INFO,warn:Sn.WARN,error:Sn.ERROR,silent:Sn.SILENT},Pwe=Sn.INFO,Owe={[Sn.DEBUG]:"log",[Sn.VERBOSE]:"log",[Sn.INFO]:"info",[Sn.WARN]:"warn",[Sn.ERROR]:"error"},kwe=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=Owe[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class KP{constructor(e){this.name=e,this._logLevel=Pwe,this._logHandler=kwe,this._userLogHandler=null,WP.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Sn))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?V8[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Sn.DEBUG,...e),this._logHandler(this,Sn.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Sn.VERBOSE,...e),this._logHandler(this,Sn.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Sn.INFO,...e),this._logHandler(this,Sn.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Sn.WARN,...e),this._logHandler(this,Sn.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Sn.ERROR,...e),this._logHandler(this,Sn.ERROR,...e)}}function Nwe(n){WP.forEach(e=>{e.setLogLevel(n)})}function Mwe(n,e){for(const t of WP){let r=null;e&&e.level&&(r=V8[e.level]),n===null?t.userLogHandler=null:t.userLogHandler=(i,a,...s)=>{const o=s.map(u=>{if(u==null)return null;if(typeof u=="string")return u;if(typeof u=="number"||typeof u=="boolean")return u.toString();if(u instanceof Error)return u.message;try{return JSON.stringify(u)}catch{return null}}).filter(u=>u).join(" ");a>=(r??i.logLevel)&&n({level:Sn[a].toLowerCase(),message:o,args:s,type:i.name})}}}const Dwe=(n,e)=>e.some(t=>n instanceof t);let NB,MB;function $we(){return NB||(NB=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Lwe(){return MB||(MB=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const z8=new WeakMap,wR=new WeakMap,H8=new WeakMap,fC=new WeakMap,JP=new WeakMap;function Uwe(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",a),n.removeEventListener("error",s)},a=()=>{t(Zl(n.result)),i()},s=()=>{r(n.error),i()};n.addEventListener("success",a),n.addEventListener("error",s)});return e.then(t=>{t instanceof IDBCursor&&z8.set(t,n)}).catch(()=>{}),JP.set(e,n),e}function jwe(n){if(wR.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",a),n.removeEventListener("error",s),n.removeEventListener("abort",s)},a=()=>{t(),i()},s=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",a),n.addEventListener("error",s),n.addEventListener("abort",s)});wR.set(n,e)}let ER={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return wR.get(n);if(e==="objectStoreNames")return n.objectStoreNames||H8.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Zl(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Fwe(n){ER=n(ER)}function Bwe(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(dC(this),e,...t);return H8.set(r,e.sort?e.sort():[e]),Zl(r)}:Lwe().includes(n)?function(...e){return n.apply(dC(this),e),Zl(z8.get(this))}:function(...e){return Zl(n.apply(dC(this),e))}}function qwe(n){return typeof n=="function"?Bwe(n):(n instanceof IDBTransaction&&jwe(n),Dwe(n,$we())?new Proxy(n,ER):n)}function Zl(n){if(n instanceof IDBRequest)return Uwe(n);if(fC.has(n))return fC.get(n);const e=qwe(n);return e!==n&&(fC.set(n,e),JP.set(e,n)),e}const dC=n=>JP.get(n);function Vwe(n,e,{blocked:t,upgrade:r,blocking:i,terminated:a}={}){const s=indexedDB.open(n,e),o=Zl(s);return r&&s.addEventListener("upgradeneeded",u=>{r(Zl(s.result),u.oldVersion,u.newVersion,Zl(s.transaction),u)}),t&&s.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),o.then(u=>{a&&u.addEventListener("close",()=>a()),i&&u.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),o}const zwe=["get","getKey","getAll","getAllKeys","count"],Hwe=["put","add","delete","clear"],hC=new Map;function DB(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(hC.get(e))return hC.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=Hwe.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||zwe.includes(t)))return;const a=async function(s,...o){const u=this.transaction(s,i?"readwrite":"readonly");let c=u.store;return r&&(c=c.index(o.shift())),(await Promise.all([c[t](...o),i&&u.done]))[0]};return hC.set(e,a),a}Fwe(n=>({...n,get:(e,t,r)=>DB(e,t)||n.get(e,t,r),has:(e,t)=>!!DB(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Gwe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Wwe(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function Wwe(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const ib="@firebase/app",SR="0.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tl=new KP("@firebase/app"),Kwe="@firebase/app-compat",Jwe="@firebase/analytics-compat",Ywe="@firebase/analytics",Zwe="@firebase/app-check-compat",Xwe="@firebase/app-check",Qwe="@firebase/auth",e0e="@firebase/auth-compat",t0e="@firebase/database",n0e="@firebase/data-connect",r0e="@firebase/database-compat",i0e="@firebase/functions",a0e="@firebase/functions-compat",s0e="@firebase/installations",o0e="@firebase/installations-compat",l0e="@firebase/messaging",u0e="@firebase/messaging-compat",c0e="@firebase/performance",f0e="@firebase/performance-compat",d0e="@firebase/remote-config",h0e="@firebase/remote-config-compat",p0e="@firebase/storage",m0e="@firebase/storage-compat",g0e="@firebase/firestore",y0e="@firebase/ai",v0e="@firebase/firestore-compat",_0e="firebase",b0e="11.9.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iu="[DEFAULT]",w0e={[ib]:"fire-core",[Kwe]:"fire-core-compat",[Ywe]:"fire-analytics",[Jwe]:"fire-analytics-compat",[Xwe]:"fire-app-check",[Zwe]:"fire-app-check-compat",[Qwe]:"fire-auth",[e0e]:"fire-auth-compat",[t0e]:"fire-rtdb",[n0e]:"fire-data-connect",[r0e]:"fire-rtdb-compat",[i0e]:"fire-fn",[a0e]:"fire-fn-compat",[s0e]:"fire-iid",[o0e]:"fire-iid-compat",[l0e]:"fire-fcm",[u0e]:"fire-fcm-compat",[c0e]:"fire-perf",[f0e]:"fire-perf-compat",[d0e]:"fire-rc",[h0e]:"fire-rc-compat",[p0e]:"fire-gcs",[m0e]:"fire-gcs-compat",[g0e]:"fire-fst",[v0e]:"fire-fst-compat",[y0e]:"fire-vertex","fire-js":"fire-js",[_0e]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const au=new Map,Rd=new Map,Id=new Map;function Sm(n,e){try{n.container.addComponent(e)}catch(t){tl.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function G8(n,e){n.container.addOrOverwriteComponent(e)}function gc(n){const e=n.name;if(Id.has(e))return tl.debug(`There were multiple attempts to register component ${e}.`),!1;Id.set(e,n);for(const t of au.values())Sm(t,n);for(const t of Rd.values())Sm(t,n);return!0}function W8(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function E0e(n,e,t=iu){W8(n,e).clearInstance(t)}function K8(n){return n.options!==void 0}function zn(n){return n==null?!1:n.settings!==void 0}function S0e(){Id.clear()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const T0e={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Wa=new Nc("app","Firebase",T0e);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let J8=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new ru("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Wa.create("app-deleted",{appName:this._name})}};/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $B(n,e){const t=zP(n.split(".")[1]);if(t===null){console.error(`FirebaseServerApp ${e} is invalid: second part could not be parsed.`);return}if(JSON.parse(t).exp===void 0){console.error(`FirebaseServerApp ${e} is invalid: expiration claim could not be parsed`);return}const i=JSON.parse(t).exp*1e3,a=new Date().getTime();i-a<=0&&console.error(`FirebaseServerApp ${e} is invalid: the token has expired.`)}class A0e extends J8{constructor(e,t,r,i){const a=t.automaticDataCollectionEnabled!==void 0?t.automaticDataCollectionEnabled:!0,s={name:r,automaticDataCollectionEnabled:a};if(e.apiKey!==void 0)super(e,s,i);else{const o=e;super(o.options,s,i)}this._serverConfig=Object.assign({automaticDataCollectionEnabled:a},t),this._serverConfig.authIdToken&&$B(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&$B(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,typeof FinalizationRegistry<"u"&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,Ko(ib,SR,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,e!==void 0&&this._finalizationRegistry!==null&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){ZP(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw Wa.create("server-app-deleted")}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mc=b0e;function YP(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:iu,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw Wa.create("bad-app-name",{appName:String(i)});if(t||(t=$8()),!t)throw Wa.create("no-options");const a=au.get(i);if(a){if(Em(t,a.options)&&Em(r,a.config))return a;throw Wa.create("duplicate-app",{appName:i})}const s=new q8(i);for(const u of Id.values())s.addComponent(u);const o=new J8(t,r,s);return au.set(i,o),o}function C0e(n,e){if(vwe()&&!U8())throw Wa.create("invalid-server-app-environment");e.automaticDataCollectionEnabled===void 0&&(e.automaticDataCollectionEnabled=!0);let t;K8(n)?t=n.options:t=n;const r=Object.assign(Object.assign({},e),t);r.releaseOnDeref!==void 0&&delete r.releaseOnDeref;const i=c=>[...c].reduce((d,h)=>Math.imul(31,d)+h.charCodeAt(0)|0,0);if(e.releaseOnDeref!==void 0&&typeof FinalizationRegistry>"u")throw Wa.create("finalization-registry-not-supported",{});const a=""+i(JSON.stringify(r)),s=Rd.get(a);if(s)return s.incRefCount(e.releaseOnDeref),s;const o=new q8(a);for(const c of Id.values())o.addComponent(c);const u=new A0e(t,e,a,o);return Rd.set(a,u),u}function x0e(n=iu){const e=au.get(n);if(!e&&n===iu&&$8())return YP();if(!e)throw Wa.create("no-app",{appName:n});return e}function R0e(){return Array.from(au.values())}async function ZP(n){let e=!1;const t=n.name;au.has(t)?(e=!0,au.delete(t)):Rd.has(t)&&n.decRefCount()<=0&&(Rd.delete(t),e=!0),e&&(await Promise.all(n.container.getProviders().map(r=>r.delete())),n.isDeleted=!0)}function Ko(n,e,t){var r;let i=(r=w0e[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);const a=i.match(/\s|\//),s=e.match(/\s|\//);if(a||s){const o=[`Unable to register library "${i}" with version "${e}":`];a&&o.push(`library name "${i}" contains illegal characters (whitespace or "/")`),a&&s&&o.push("and"),s&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),tl.warn(o.join(" "));return}gc(new ru(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}function Y8(n,e){if(n!==null&&typeof n!="function")throw Wa.create("invalid-log-argument");Mwe(n,e)}function Z8(n){Nwe(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I0e="firebase-heartbeat-database",P0e=1,Tm="firebase-heartbeat-store";let pC=null;function X8(){return pC||(pC=Vwe(I0e,P0e,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(Tm)}catch(t){console.warn(t)}}}}).catch(n=>{throw Wa.create("idb-open",{originalErrorMessage:n.message})})),pC}async function O0e(n){try{const t=(await X8()).transaction(Tm),r=await t.objectStore(Tm).get(Q8(n));return await t.done,r}catch(e){if(e instanceof Wi)tl.warn(e.message);else{const t=Wa.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});tl.warn(t.message)}}}async function LB(n,e){try{const r=(await X8()).transaction(Tm,"readwrite");await r.objectStore(Tm).put(e,Q8(n)),await r.done}catch(t){if(t instanceof Wi)tl.warn(t.message);else{const r=Wa.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});tl.warn(r.message)}}}function Q8(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const k0e=1024,N0e=30;class M0e{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new $0e(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),a=UB();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===a||this._heartbeatsCache.heartbeats.some(s=>s.date===a))return;if(this._heartbeatsCache.heartbeats.push({date:a,agent:i}),this._heartbeatsCache.heartbeats.length>N0e){const s=L0e(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){tl.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=UB(),{heartbeatsToSend:r,unsentEntries:i}=D0e(this._heartbeatsCache.heartbeats),a=M8(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(t){return tl.warn(t),""}}}function UB(){return new Date().toISOString().substring(0,10)}function D0e(n,e=k0e){const t=[];let r=n.slice();for(const i of n){const a=t.find(s=>s.agent===i.agent);if(a){if(a.dates.push(i.date),jB(t)>e){a.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),jB(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class $0e{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return rb()?bwe().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await O0e(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return LB(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return LB(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function jB(n){return M8(JSON.stringify({version:2,heartbeats:n})).length}function L0e(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function U0e(n){gc(new ru("platform-logger",e=>new Gwe(e),"PRIVATE")),gc(new ru("heartbeat",e=>new M0e(e),"PRIVATE")),Ko(ib,SR,n),Ko(ib,SR,"esm2017"),Ko("fire-js","")}U0e("");const j0e=Object.freeze(Object.defineProperty({__proto__:null,FirebaseError:Wi,SDK_VERSION:Mc,_DEFAULT_ENTRY_NAME:iu,_addComponent:Sm,_addOrOverwriteComponent:G8,_apps:au,_clearComponents:S0e,_components:Id,_getProvider:W8,_isFirebaseApp:K8,_isFirebaseServerApp:zn,_registerComponent:gc,_removeServiceInstance:E0e,_serverApps:Rd,deleteApp:ZP,getApp:x0e,getApps:R0e,initializeApp:YP,initializeServerApp:C0e,onLog:Y8,registerVersion:Ko,setLogLevel:Z8},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class F0e{constructor(e,t){this._delegate=e,this.firebase=t,Sm(e,new ru("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),ZP(this._delegate)))}_getService(e,t=iu){var r;this._delegate.checkDestroyed();const i=this._delegate.container.getProvider(e);return!i.isInitialized()&&((r=i.getComponent())===null||r===void 0?void 0:r.instantiationMode)==="EXPLICIT"&&i.initialize(),i.getImmediate({identifier:t})}_removeServiceInstance(e,t=iu){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){Sm(this._delegate,e)}_addOrOverwriteComponent(e){G8(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const B0e={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."},FB=new Nc("app-compat","Firebase",B0e);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function q0e(n){const e={},t={__esModule:!0,initializeApp:a,app:i,registerVersion:Ko,setLogLevel:Z8,onLog:Y8,apps:null,SDK_VERSION:Mc,INTERNAL:{registerComponent:o,removeApp:r,useAsService:u,modularAPIs:j0e}};t.default=t,Object.defineProperty(t,"apps",{get:s});function r(c){delete e[c]}function i(c){if(c=c||iu,!OB(e,c))throw FB.create("no-app",{appName:c});return e[c]}i.App=n;function a(c,d={}){const h=YP(c,d);if(OB(e,h.name))return e[h.name];const m=new n(h,t);return e[h.name]=m,m}function s(){return Object.keys(e).map(c=>e[c])}function o(c){const d=c.name,h=d.replace("-compat","");if(gc(c)&&c.type==="PUBLIC"){const m=(g=i())=>{if(typeof g[h]!="function")throw FB.create("invalid-app-argument",{appName:d});return g[h]()};c.serviceProps!==void 0&&nb(m,c.serviceProps),t[h]=m,n.prototype[h]=function(...g){return this._getService.bind(this,d).apply(this,c.multipleInstances?g:[])}}return c.type==="PUBLIC"?t[h]:null}function u(c,d){return d==="serverAuth"?null:d}return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ez(){const n=q0e(F0e);n.INTERNAL=Object.assign(Object.assign({},n.INTERNAL),{createFirebaseNamespace:ez,extendNamespace:e,createSubscribe:B8,ErrorFactory:Nc,deepExtend:nb});function e(t){nb(n,t)}return n}const V0e=ez();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const BB=new KP("@firebase/app-compat"),z0e="@firebase/app-compat",H0e="0.4.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function G0e(n){Ko(z0e,H0e,n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */try{const n=D8();if(n.firebase!==void 0){BB.warn(`
      Warning: Firebase is already defined in the global scope. Please make sure
      Firebase library is only loaded once.
    `);const e=n.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&BB.warn(`
        Warning: You are trying to load Firebase while using Firebase Performance standalone script.
        You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
        `)}}catch{}const yc=V0e;G0e();var W0e="firebase",K0e="11.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */yc.registerVersion(W0e,K0e,"app-compat");function XP(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}const hp={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",TWITTER:"twitter.com"},Pf={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function J0e(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements.","invalid-hosting-link-domain":"The provided Hosting link domain is not configured in Firebase Hosting or is not owned by the current project. This cannot be a default Hosting domain (`web.app` or `firebaseapp.com`)."}}function tz(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Y0e=J0e,Z0e=tz,nz=new Nc("auth","Firebase",tz());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ab=new KP("@firebase/auth");function X0e(n,...e){ab.logLevel<=Sn.WARN&&ab.warn(`Auth (${Mc}): ${n}`,...e)}function Qv(n,...e){ab.logLevel<=Sn.ERROR&&ab.error(`Auth (${Mc}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xr(n,...e){throw eO(n,...e)}function xr(n,...e){return eO(n,...e)}function QP(n,e,t){const r=Object.assign(Object.assign({},Z0e()),{[e]:t});return new Nc("auth","Firebase",r).create(e,{appName:n.name})}function $r(n){return QP(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Kd(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Xr(n,"argument-error"),QP(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function eO(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return nz.create(n,...e)}function Je(n,e,...t){if(!n)throw eO(e,...t)}function io(n){const e="INTERNAL ASSERTION FAILED: "+n;throw Qv(e),new Error(e)}function Os(n,e){n||io(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Am(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function tO(){return qB()==="http:"||qB()==="https:"}function qB(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Q0e(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(tO()||j8()||"connection"in navigator)?navigator.onLine:!0}function eEe(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fg{constructor(e,t){this.shortDelay=e,this.longDelay=t,Os(t>e,"Short delay should be less than long delay!"),this.isMobile=ywe()||GP()}get(){return Q0e()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nO(n,e){Os(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rz{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;io("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;io("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;io("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tEe={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nEe=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],rEe=new fg(3e4,6e4);function Zn(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Xn(n,e,t,r,i={}){return iz(n,i,async()=>{let a={},s={};r&&(e==="GET"?s=r:a={body:JSON.stringify(r)});const o=Wd(Object.assign({key:n.config.apiKey},s)).slice(1),u=await n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:u},a);return _we()||(c.referrerPolicy="no-referrer"),n.emulatorConfig&&yw(n.emulatorConfig.host)&&(c.credentials="include"),rz.fetch()(await az(n,n.config.apiHost,t,o),c)})}async function iz(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},tEe),e);try{const i=new aEe(n),a=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const s=await a.json();if("needConfirmation"in s)throw $p(n,"account-exists-with-different-credential",s);if(a.ok&&!("errorMessage"in s))return s;{const o=a.ok?s.errorMessage:s.error.message,[u,c]=o.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw $p(n,"credential-already-in-use",s);if(u==="EMAIL_EXISTS")throw $p(n,"email-already-in-use",s);if(u==="USER_DISABLED")throw $p(n,"user-disabled",s);const d=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw QP(n,d,c);Xr(n,d)}}catch(i){if(i instanceof Wi)throw i;Xr(n,"network-request-failed",{message:String(i)})}}async function sl(n,e,t,r,i={}){const a=await Xn(n,e,t,r,i);return"mfaPendingCredential"in a&&Xr(n,"multi-factor-auth-required",{_serverResponse:a}),a}async function az(n,e,t,r){const i=`${e}${t}?${r}`,a=n,s=a.config.emulator?nO(n.config,i):`${n.config.apiScheme}://${i}`;return nEe.includes(t)&&(await a._persistenceManagerAvailable,a._getPersistenceType()==="COOKIE")?a._getPersistence()._getFinalTarget(s).toString():s}function iEe(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class aEe{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(xr(this.auth,"network-request-failed")),rEe.get())})}}function $p(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const i=xr(n,e,r);return i.customData._tokenResponse=t,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function VB(n){return n!==void 0&&n.getResponse!==void 0}function zB(n){return n!==void 0&&n.enterprise!==void 0}class sz{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return iEe(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sEe(n){return(await Xn(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function oz(n,e){return Xn(n,"GET","/v2/recaptchaConfig",Zn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oEe(n,e){return Xn(n,"POST","/v1/accounts:delete",e)}async function lEe(n,e){return Xn(n,"POST","/v1/accounts:update",e)}async function sb(n,e){return Xn(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qp(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function uEe(n,e=!1){const t=an(n),r=await t.getIdToken(e),i=vw(r);Je(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const a=typeof i.firebase=="object"?i.firebase:void 0,s=a==null?void 0:a.sign_in_provider;return{claims:i,token:r,authTime:Qp(mC(i.auth_time)),issuedAtTime:Qp(mC(i.iat)),expirationTime:Qp(mC(i.exp)),signInProvider:s||null,signInSecondFactor:(a==null?void 0:a.sign_in_second_factor)||null}}function mC(n){return Number(n)*1e3}function vw(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return Qv("JWT malformed, contained fewer than 3 sections"),null;try{const i=zP(t);return i?JSON.parse(i):(Qv("Failed to decode base64 JWT payload"),null)}catch(i){return Qv("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function HB(n){const e=vw(n);return Je(e,"internal-error"),Je(typeof e.exp<"u","internal-error"),Je(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nl(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Wi&&cEe(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function cEe({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class fEe{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class TR{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Qp(this.lastLoginAt),this.creationTime=Qp(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cm(n){var e;const t=n.auth,r=await n.getIdToken(),i=await nl(n,sb(t,{idToken:r}));Je(i==null?void 0:i.users.length,t,"internal-error");const a=i.users[0];n._notifyReloadListener(a);const s=!((e=a.providerUserInfo)===null||e===void 0)&&e.length?lz(a.providerUserInfo):[],o=hEe(n.providerData,s),u=n.isAnonymous,c=!(n.email&&a.passwordHash)&&!(o!=null&&o.length),d=u?c:!1,h={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:o,metadata:new TR(a.createdAt,a.lastLoginAt),isAnonymous:d};Object.assign(n,h)}async function dEe(n){const e=an(n);await Cm(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function hEe(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function lz(n){return n.map(e=>{var{providerId:t}=e,r=XP(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pEe(n,e){const t=await iz(n,{},async()=>{const r=Wd({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:a}=n.config,s=await az(n,i,"/v1/token",`key=${a}`),o=await n._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const u={method:"POST",headers:o,body:r};return n.emulatorConfig&&yw(n.emulatorConfig.host)&&(u.credentials="include"),rz.fetch()(s,u)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function mEe(n,e){return Xn(n,"POST","/v2/accounts:revokeToken",Zn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class md{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Je(e.idToken,"internal-error"),Je(typeof e.idToken<"u","internal-error"),Je(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):HB(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Je(e.length!==0,"internal-error");const t=HB(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Je(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:i,expiresIn:a}=await pEe(e,t);this.updateTokensAndExpiration(r,i,Number(a))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:i,expirationTime:a}=t,s=new md;return r&&(Je(typeof r=="string","internal-error",{appName:e}),s.refreshToken=r),i&&(Je(typeof i=="string","internal-error",{appName:e}),s.accessToken=i),a&&(Je(typeof a=="number","internal-error",{appName:e}),s.expirationTime=a),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new md,this.toJSON())}_performRefresh(){return io("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ll(n,e){Je(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class Es{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,a=XP(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new fEe(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new TR(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(e){const t=await nl(this,this.stsTokenManager.getToken(this.auth,e));return Je(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return uEe(this,e)}reload(){return dEe(this)}_assign(e){this!==e&&(Je(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Es(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Je(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Cm(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(zn(this.auth.app))return Promise.reject($r(this.auth));const e=await this.getIdToken();return await nl(this,oEe(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,a,s,o,u,c,d;const h=(r=t.displayName)!==null&&r!==void 0?r:void 0,m=(i=t.email)!==null&&i!==void 0?i:void 0,g=(a=t.phoneNumber)!==null&&a!==void 0?a:void 0,_=(s=t.photoURL)!==null&&s!==void 0?s:void 0,w=(o=t.tenantId)!==null&&o!==void 0?o:void 0,S=(u=t._redirectEventId)!==null&&u!==void 0?u:void 0,E=(c=t.createdAt)!==null&&c!==void 0?c:void 0,C=(d=t.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:A,emailVerified:R,isAnonymous:P,providerData:N,stsTokenManager:U}=t;Je(A&&U,e,"internal-error");const k=md.fromJSON(this.name,U);Je(typeof A=="string",e,"internal-error"),Ll(h,e.name),Ll(m,e.name),Je(typeof R=="boolean",e,"internal-error"),Je(typeof P=="boolean",e,"internal-error"),Ll(g,e.name),Ll(_,e.name),Ll(w,e.name),Ll(S,e.name),Ll(E,e.name),Ll(C,e.name);const B=new Es({uid:A,auth:e,email:m,emailVerified:R,displayName:h,isAnonymous:P,photoURL:_,phoneNumber:g,tenantId:w,stsTokenManager:k,createdAt:E,lastLoginAt:C});return N&&Array.isArray(N)&&(B.providerData=N.map(H=>Object.assign({},H))),S&&(B._redirectEventId=S),B}static async _fromIdTokenResponse(e,t,r=!1){const i=new md;i.updateFromServerResponse(t);const a=new Es({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await Cm(a),a}static async _fromGetAccountInfoResponse(e,t,r){const i=t.users[0];Je(i.localId!==void 0,"internal-error");const a=i.providerUserInfo!==void 0?lz(i.providerUserInfo):[],s=!(i.email&&i.passwordHash)&&!(a!=null&&a.length),o=new md;o.updateFromIdToken(r);const u=new Es({uid:i.localId,auth:e,stsTokenManager:o,isAnonymous:s}),c={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new TR(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(a!=null&&a.length)};return Object.assign(u,c),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const GB=new Map;function ba(n){Os(n instanceof Function,"Expected a class definition");let e=GB.get(n);return e?(Os(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,GB.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class uz{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}uz.type="NONE";const Pd=uz;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zu(n,e,t){return`firebase:${n}:${e}:${t}`}class gd{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:i,name:a}=this.auth;this.fullUserKey=Zu(this.userKey,i.apiKey,a),this.fullPersistenceKey=Zu("persistence",i.apiKey,a),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await sb(this.auth,{idToken:e}).catch(()=>{});return t?Es._fromGetAccountInfoResponse(this.auth,t,e):null}return Es._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new gd(ba(Pd),e,r);const i=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let a=i[0]||ba(Pd);const s=Zu(r,e.config.apiKey,e.name);let o=null;for(const c of t)try{const d=await c._get(s);if(d){let h;if(typeof d=="string"){const m=await sb(e,{idToken:d}).catch(()=>{});if(!m)break;h=await Es._fromGetAccountInfoResponse(e,m,d)}else h=Es._fromJSON(e,d);c!==a&&(o=h),a=c;break}}catch{}const u=i.filter(c=>c._shouldAllowMigration);return!a._shouldAllowMigration||!u.length?new gd(a,e,r):(a=u[0],o&&await a._set(s,o.toJSON()),await Promise.all(t.map(async c=>{if(c!==a)try{await c._remove(s)}catch{}})),new gd(a,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function WB(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(hz(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(cz(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(pz(e))return"Blackberry";if(mz(e))return"Webos";if(fz(e))return"Safari";if((e.includes("chrome/")||dz(e))&&!e.includes("edge/"))return"Chrome";if(dg(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function cz(n=Rr()){return/firefox\//i.test(n)}function fz(n=Rr()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function dz(n=Rr()){return/crios\//i.test(n)}function hz(n=Rr()){return/iemobile/i.test(n)}function dg(n=Rr()){return/android/i.test(n)}function pz(n=Rr()){return/blackberry/i.test(n)}function mz(n=Rr()){return/webos/i.test(n)}function hg(n=Rr()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function gEe(n=Rr()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(n)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(n)}function yEe(n=Rr()){var e;return hg(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function vEe(){return F8()&&document.documentMode===10}function gz(n=Rr()){return hg(n)||dg(n)||mz(n)||pz(n)||/windows phone/i.test(n)||hz(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yz(n,e=[]){let t;switch(n){case"Browser":t=WB(Rr());break;case"Worker":t=`${WB(Rr())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${Mc}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _Ee{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=a=>new Promise((s,o)=>{try{const u=e(a);s(u)}catch(u){o(u)}});r.onAbort=t,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bEe(n,e={}){return Xn(n,"GET","/v2/passwordPolicy",Zn(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const wEe=6;class EEe{constructor(e){var t,r,i,a;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=s.minPasswordLength)!==null&&t!==void 0?t:wEe,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),s.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),s.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),s.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),s.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(a=e.forceUpgradeOnSignin)!==null&&a!==void 0?a:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,a,s,o;const u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(t=u.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),u.isValid&&(u.isValid=(r=u.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),u.isValid&&(u.isValid=(i=u.containsLowercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(a=u.containsUppercaseLetter)!==null&&a!==void 0?a:!0),u.isValid&&(u.isValid=(s=u.containsNumericCharacter)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(o=u.containsNonAlphanumericCharacter)!==null&&o!==void 0?o:!0),u}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,a){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class SEe{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new KB(this),this.idTokenSubscription=new KB(this),this.beforeStateQueue=new _Ee(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=nz,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(a=>this._resolvePersistenceManagerAvailable=a)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=ba(t)),this._initializationPromise=this.queue(async()=>{var r,i,a;if(!this._deleted&&(this.persistenceManager=await gd.create(this,e),(r=this._resolvePersistenceManagerAvailable)===null||r===void 0||r.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((a=this.currentUser)===null||a===void 0?void 0:a.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await sb(this,{idToken:e}),r=await Es._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(zn(this.app)){const s=this.app.settings.authIdToken;return s?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(s).then(o,o))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let i=r,a=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const s=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,o=i==null?void 0:i._redirectEventId,u=await this.tryRedirectSignIn(e);(!s||s===o)&&(u!=null&&u.user)&&(i=u.user,a=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(i)}catch(s){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Je(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Cm(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=eEe()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(zn(this.app))return Promise.reject($r(this));const t=e?an(e):null;return t&&Je(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Je(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return zn(this.app)?Promise.reject($r(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return zn(this.app)?Promise.reject($r(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ba(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await bEe(this),t=new EEe(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new Nc("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await mEe(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&ba(e)||this._popupRedirectResolver;Je(t,this,"argument-error"),this.redirectPersistenceManager=await gd.create(this,[ba(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};const a=typeof t=="function"?t:t.next.bind(t);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Je(o,this,"internal-error"),o.then(()=>{s||a(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,r,i);return()=>{s=!0,u()}}else{const u=e.addObserver(t);return()=>{s=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Je(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=yz(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;if(zn(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&X0e(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function Hn(n){return an(n)}class KB{constructor(e){this.auth=e,this.observer=null,this.addObserver=B8(t=>this.observer=t)}get next(){return Je(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let pg={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function TEe(n){pg=n}function rO(n){return pg.loadJS(n)}function AEe(){return pg.recaptchaV2Script}function CEe(){return pg.recaptchaEnterpriseScript}function xEe(){return pg.gapiScript}function vz(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const REe=500,IEe=6e4,Ev=1e12;class PEe{constructor(e){this.auth=e,this.counter=Ev,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new NEe(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||Ev;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||Ev;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||Ev;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class OEe{constructor(){this.enterprise=new kEe}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class kEe{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class NEe{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const i=typeof e=="string"?document.getElementById(e):e;Je(i,"argument-error",{appName:t}),this.container=i,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=MEe(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},IEe)},REe))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function MEe(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}const DEe="recaptcha-enterprise",em="NO_RECAPTCHA";class _z{constructor(e){this.type=DEe,this.auth=Hn(e)}async verify(e="verify",t=!1){async function r(a){if(!t){if(a.tenantId==null&&a._agentRecaptchaConfig!=null)return a._agentRecaptchaConfig.siteKey;if(a.tenantId!=null&&a._tenantRecaptchaConfigs[a.tenantId]!==void 0)return a._tenantRecaptchaConfigs[a.tenantId].siteKey}return new Promise(async(s,o)=>{oz(a,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)o(new Error("recaptcha Enterprise site key undefined"));else{const c=new sz(u);return a.tenantId==null?a._agentRecaptchaConfig=c:a._tenantRecaptchaConfigs[a.tenantId]=c,s(c.siteKey)}}).catch(u=>{o(u)})})}function i(a,s,o){const u=window.grecaptcha;zB(u)?u.enterprise.ready(()=>{u.enterprise.execute(a,{action:e}).then(c=>{s(c)}).catch(()=>{s(em)})}):o(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new OEe().execute("siteKey",{action:"verify"}):new Promise((a,s)=>{r(this.auth).then(o=>{if(!t&&zB(window.grecaptcha))i(o,a,s);else{if(typeof window>"u"){s(new Error("RecaptchaVerifier is only supported in browser"));return}let u=CEe();u.length!==0&&(u+=o),rO(u).then(()=>{i(o,a,s)}).catch(c=>{s(c)})}}).catch(o=>{s(o)})})}}async function pp(n,e,t,r=!1,i=!1){const a=new _z(n);let s;if(i)s=em;else try{s=await a.verify(t)}catch{s=await a.verify(t,!0)}const o=Object.assign({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in o){const u=o.phoneEnrollmentInfo.phoneNumber,c=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:c,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const u=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Xl(n,e,t,r,i){var a,s;if(i==="EMAIL_PASSWORD_PROVIDER")if(!((a=n._getRecaptchaConfig())===null||a===void 0)&&a.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await pp(n,e,t,t==="getOobCode");return r(n,o)}else return r(n,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const u=await pp(n,e,t,t==="getOobCode");return r(n,u)}else return Promise.reject(o)});else if(i==="PHONE_PROVIDER")if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("PHONE_PROVIDER")){const o=await pp(n,e,t);return r(n,o).catch(async u=>{var c;if(((c=n._getRecaptchaConfig())===null||c===void 0?void 0:c.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(u.code==="auth/missing-recaptcha-token"||u.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);const d=await pp(n,e,t,!1,!0);return r(n,d)}return Promise.reject(u)})}else{const o=await pp(n,e,t,!1,!0);return r(n,o)}else return Promise.reject(i+" provider is not supported.")}async function $Ee(n){const e=Hn(n),t=await oz(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new sz(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isAnyProviderEnabled()&&new _z(e).verify()}function LEe(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(ba);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function UEe(n,e,t){const r=Hn(n);Je(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!!(t!=null&&t.disableWarnings),a=bz(e),{host:s,port:o}=jEe(e),u=o===null?"":`:${o}`,c={url:`${a}//${s}${u}/`},d=Object.freeze({host:s,port:o,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){Je(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Je(Em(c,r.config.emulator)&&Em(d,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=c,r.emulatorConfig=d,r.settings.appVerificationDisabledForTesting=!0,yw(s)?(hwe(`${a}//${s}${u}`),gwe("Auth",!0)):i||FEe()}function bz(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function jEe(n){const e=bz(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const a=i[1];return{host:a,port:JB(r.substr(a.length+1))}}else{const[a,s]=r.split(":");return{host:a,port:JB(s)}}}function JB(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function FEe(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jd{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return io("not implemented")}_getIdTokenResponse(e){return io("not implemented")}_linkToIdToken(e,t){return io("not implemented")}_getReauthenticationResolver(e){return io("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wz(n,e){return Xn(n,"POST","/v1/accounts:resetPassword",Zn(n,e))}async function BEe(n,e){return Xn(n,"POST","/v1/accounts:update",e)}async function qEe(n,e){return Xn(n,"POST","/v1/accounts:signUp",e)}async function VEe(n,e){return Xn(n,"POST","/v1/accounts:update",Zn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zEe(n,e){return sl(n,"POST","/v1/accounts:signInWithPassword",Zn(n,e))}async function _w(n,e){return Xn(n,"POST","/v1/accounts:sendOobCode",Zn(n,e))}async function HEe(n,e){return _w(n,e)}async function GEe(n,e){return _w(n,e)}async function WEe(n,e){return _w(n,e)}async function KEe(n,e){return _w(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function JEe(n,e){return sl(n,"POST","/v1/accounts:signInWithEmailLink",Zn(n,e))}async function YEe(n,e){return sl(n,"POST","/v1/accounts:signInWithEmailLink",Zn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xm extends Jd{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new xm(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new xm(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Xl(e,t,"signInWithPassword",zEe,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return JEe(e,{email:this._email,oobCode:this._password});default:Xr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Xl(e,r,"signUpPassword",qEe,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return YEe(e,{idToken:t,email:this._email,oobCode:this._password});default:Xr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jo(n,e){return sl(n,"POST","/v1/accounts:signInWithIdp",Zn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ZEe="http://localhost";class ho extends Jd{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new ho(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Xr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=t,a=XP(t,["providerId","signInMethod"]);if(!r||!i)return null;const s=new ho(r,i);return s.idToken=a.idToken||void 0,s.accessToken=a.accessToken||void 0,s.secret=a.secret,s.nonce=a.nonce,s.pendingToken=a.pendingToken||null,s}_getIdTokenResponse(e){const t=this.buildRequest();return Jo(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Jo(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Jo(e,t)}buildRequest(){const e={requestUri:ZEe,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=Wd(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function YB(n,e){return Xn(n,"POST","/v1/accounts:sendVerificationCode",Zn(n,e))}async function XEe(n,e){return sl(n,"POST","/v1/accounts:signInWithPhoneNumber",Zn(n,e))}async function QEe(n,e){const t=await sl(n,"POST","/v1/accounts:signInWithPhoneNumber",Zn(n,e));if(t.temporaryProof)throw $p(n,"account-exists-with-different-credential",t);return t}const eSe={USER_NOT_FOUND:"user-not-found"};async function tSe(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return sl(n,"POST","/v1/accounts:signInWithPhoneNumber",Zn(n,t),eSe)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xu extends Jd{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new Xu({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new Xu({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return XEe(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return QEe(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return tSe(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:a}=e;return!r&&!t&&!i&&!a?null:new Xu({verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nSe(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function rSe(n){const e=ed(Dp(n)).link,t=e?ed(Dp(e)).deep_link_id:null,r=ed(Dp(n)).deep_link_id;return(r?ed(Dp(r)).link:null)||r||t||e||n}class bw{constructor(e){var t,r,i,a,s,o;const u=ed(Dp(e)),c=(t=u.apiKey)!==null&&t!==void 0?t:null,d=(r=u.oobCode)!==null&&r!==void 0?r:null,h=nSe((i=u.mode)!==null&&i!==void 0?i:null);Je(c&&d&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=d,this.continueUrl=(a=u.continueUrl)!==null&&a!==void 0?a:null,this.languageCode=(s=u.lang)!==null&&s!==void 0?s:null,this.tenantId=(o=u.tenantId)!==null&&o!==void 0?o:null}static parseLink(e){const t=rSe(e);try{return new bw(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cu{constructor(){this.providerId=cu.PROVIDER_ID}static credential(e,t){return xm._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=bw.parseLink(t);return Je(r,"argument-error"),xm._fromEmailAndCode(e,r.code,r.tenantId)}}cu.PROVIDER_ID="password";cu.EMAIL_PASSWORD_SIGN_IN_METHOD="password";cu.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ol{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Yd extends ol{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class yd extends Yd{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return Je("providerId"in t&&"signInMethod"in t,"argument-error"),ho._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return Je(e.idToken||e.accessToken,"argument-error"),ho._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return yd.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return yd.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:i,pendingToken:a,nonce:s,providerId:o}=e;if(!r&&!i&&!t&&!a||!o)return null;try{return new yd(o)._credential({idToken:t,accessToken:r,nonce:s,pendingToken:a})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ys extends Yd{constructor(){super("facebook.com")}static credential(e){return ho._fromParams({providerId:Ys.PROVIDER_ID,signInMethod:Ys.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ys.credentialFromTaggedObject(e)}static credentialFromError(e){return Ys.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ys.credential(e.oauthAccessToken)}catch{return null}}}Ys.FACEBOOK_SIGN_IN_METHOD="facebook.com";Ys.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Zs extends Yd{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return ho._fromParams({providerId:Zs.PROVIDER_ID,signInMethod:Zs.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Zs.credentialFromTaggedObject(e)}static credentialFromError(e){return Zs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Zs.credential(t,r)}catch{return null}}}Zs.GOOGLE_SIGN_IN_METHOD="google.com";Zs.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xs extends Yd{constructor(){super("github.com")}static credential(e){return ho._fromParams({providerId:Xs.PROVIDER_ID,signInMethod:Xs.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Xs.credentialFromTaggedObject(e)}static credentialFromError(e){return Xs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Xs.credential(e.oauthAccessToken)}catch{return null}}}Xs.GITHUB_SIGN_IN_METHOD="github.com";Xs.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const iSe="http://localhost";class Od extends Jd{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return Jo(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,Jo(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Jo(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,pendingToken:a}=t;return!r||!i||!a||r!==i?null:new Od(r,a)}static _create(e,t){return new Od(e,t)}buildRequest(){return{requestUri:iSe,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aSe="saml.";class ob extends ol{constructor(e){Je(e.startsWith(aSe),"argument-error"),super(e)}static credentialFromResult(e){return ob.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return ob.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=Od.fromJSON(e);return Je(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return Od._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qs extends Yd{constructor(){super("twitter.com")}static credential(e,t){return ho._fromParams({providerId:Qs.PROVIDER_ID,signInMethod:Qs.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return Qs.credentialFromTaggedObject(e)}static credentialFromError(e){return Qs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return Qs.credential(t,r)}catch{return null}}}Qs.TWITTER_SIGN_IN_METHOD="twitter.com";Qs.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ez(n,e){return sl(n,"POST","/v1/accounts:signUp",Zn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ya{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,i=!1){const a=await Es._fromIdTokenResponse(e,r,i),s=ZB(r);return new Ya({user:a,providerId:s,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const i=ZB(r);return new Ya({user:e,providerId:i,_tokenResponse:r,operationType:t})}}function ZB(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sSe(n){var e;if(zn(n.app))return Promise.reject($r(n));const t=Hn(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new Ya({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await Ez(t,{returnSecureToken:!0}),i=await Ya._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(i.user),i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lb extends Wi{constructor(e,t,r,i){var a;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,lb.prototype),this.customData={appName:e.name,tenantId:(a=e.tenantId)!==null&&a!==void 0?a:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new lb(e,t,r,i)}}function Sz(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(a=>{throw a.code==="auth/multi-factor-auth-required"?lb._fromErrorAndOperation(n,a,e,r):a})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tz(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oSe(n,e){const t=an(n);await ww(!0,t,e);const{providerUserInfo:r}=await lEe(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),i=Tz(r||[]);return t.providerData=t.providerData.filter(a=>i.has(a.providerId)),i.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function iO(n,e,t=!1){const r=await nl(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return Ya._forOperation(n,"link",r)}async function ww(n,e,t){await Cm(e);const r=Tz(e.providerData),i=n===!1?"provider-already-linked":"no-such-provider";Je(r.has(t)===n,e.auth,i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Az(n,e,t=!1){const{auth:r}=n;if(zn(r.app))return Promise.reject($r(r));const i="reauthenticate";try{const a=await nl(n,Sz(r,i,e,n),t);Je(a.idToken,r,"internal-error");const s=vw(a.idToken);Je(s,r,"internal-error");const{sub:o}=s;return Je(n.uid===o,r,"user-mismatch"),Ya._forOperation(n,i,a)}catch(a){throw(a==null?void 0:a.code)==="auth/user-not-found"&&Xr(r,"user-mismatch"),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Cz(n,e,t=!1){if(zn(n.app))return Promise.reject($r(n));const r="signIn",i=await Sz(n,r,e),a=await Ya._fromIdTokenResponse(n,r,i);return t||await n._updateCurrentUser(a.user),a}async function Ew(n,e){return Cz(Hn(n),e)}async function xz(n,e){const t=an(n);return await ww(!1,t,e.providerId),iO(t,e)}async function Rz(n,e){return Az(an(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lSe(n,e){return sl(n,"POST","/v1/accounts:signInWithCustomToken",Zn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function uSe(n,e){if(zn(n.app))return Promise.reject($r(n));const t=Hn(n),r=await lSe(t,{token:e,returnSecureToken:!0}),i=await Ya._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(i.user),i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mg{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?aO._fromServerResponse(e,t):"totpInfo"in t?sO._fromServerResponse(e,t):Xr(e,"internal-error")}}class aO extends mg{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new aO(t)}}class sO extends mg{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new sO(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Sw(n,e,t){var r;Je(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),Je(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),Je(typeof t.linkDomain>"u"||t.linkDomain.length>0,n,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(Je(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(Je(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oO(n){const e=Hn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function cSe(n,e,t){const r=Hn(n),i={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Sw(r,i,t),await Xl(r,i,"getOobCode",GEe,"EMAIL_PASSWORD_PROVIDER")}async function fSe(n,e,t){await wz(an(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&oO(n),r})}async function dSe(n,e){await VEe(an(n),{oobCode:e})}async function Iz(n,e){const t=an(n),r=await wz(t,{oobCode:e}),i=r.requestType;switch(Je(i,t,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":Je(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":Je(r.mfaInfo,t,"internal-error");default:Je(r.email,t,"internal-error")}let a=null;return r.mfaInfo&&(a=mg._fromServerResponse(Hn(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:a},operation:i}}async function hSe(n,e){const{data:t}=await Iz(an(n),e);return t.email}async function pSe(n,e,t){if(zn(n.app))return Promise.reject($r(n));const r=Hn(n),s=await Xl(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Ez,"EMAIL_PASSWORD_PROVIDER").catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&oO(n),u}),o=await Ya._fromIdTokenResponse(r,"signIn",s);return await r._updateCurrentUser(o.user),o}function mSe(n,e,t){return zn(n.app)?Promise.reject($r(n)):Ew(an(n),cu.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&oO(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function gSe(n,e,t){const r=Hn(n),i={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function a(s,o){Je(o.handleCodeInApp,r,"argument-error"),o&&Sw(r,s,o)}a(i,t),await Xl(r,i,"getOobCode",WEe,"EMAIL_PASSWORD_PROVIDER")}function ySe(n,e){const t=bw.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function vSe(n,e,t){if(zn(n.app))return Promise.reject($r(n));const r=an(n),i=cu.credentialWithLink(e,t||Am());return Je(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Ew(r,i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _Se(n,e){return Xn(n,"POST","/v1/accounts:createAuthUri",Zn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function bSe(n,e){const t=tO()?Am():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:i}=await _Se(an(n),r);return i||[]}async function wSe(n,e){const t=an(n),i={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Sw(t.auth,i,e);const{email:a}=await HEe(t.auth,i);a!==n.email&&await n.reload()}async function ESe(n,e,t){const r=an(n),a={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Sw(r.auth,a,t);const{email:s}=await KEe(r.auth,a);s!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function SSe(n,e){return Xn(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function TSe(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=an(n),a={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},s=await nl(r,SSe(r.auth,a));r.displayName=s.displayName||null,r.photoURL=s.photoUrl||null;const o=r.providerData.find(({providerId:u})=>u==="password");o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),await r._updateTokensIfNecessary(s)}function ASe(n,e){const t=an(n);return zn(t.auth.app)?Promise.reject($r(t.auth)):Pz(t,e,null)}function CSe(n,e){return Pz(an(n),null,e)}async function Pz(n,e,t){const{auth:r}=n,a={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(a.email=e),t&&(a.password=t);const s=await nl(n,BEe(r,a));await n._updateTokensIfNecessary(s,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xSe(n){var e,t;if(!n)return null;const{providerId:r}=n,i=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},a=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const s=(t=(e=vw(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(s){const o=s!=="anonymous"&&s!=="custom"?s:null;return new vd(a,o)}}if(!r)return null;switch(r){case"facebook.com":return new RSe(a,i);case"github.com":return new ISe(a,i);case"google.com":return new PSe(a,i);case"twitter.com":return new OSe(a,i,n.screenName||null);case"custom":case"anonymous":return new vd(a,null);default:return new vd(a,r,i)}}class vd{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class Oz extends vd{constructor(e,t,r,i){super(e,t,r),this.username=i}}class RSe extends vd{constructor(e,t){super(e,"facebook.com",t)}}class ISe extends Oz{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class PSe extends vd{constructor(e,t){super(e,"google.com",t)}}class OSe extends Oz{constructor(e,t,r){super(e,"twitter.com",t,r)}}function kSe(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:xSe(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hu{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new Hu("enroll",e,t)}static _fromMfaPendingCredential(e){return new Hu("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return Hu._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return Hu._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class lO{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=Hn(e),i=t.customData._serverResponse,a=(i.mfaInfo||[]).map(o=>mg._fromServerResponse(r,o));Je(i.mfaPendingCredential,r,"internal-error");const s=Hu._fromMfaPendingCredential(i.mfaPendingCredential);return new lO(s,a,async o=>{const u=await o._process(r,s);delete i.mfaInfo,delete i.mfaPendingCredential;const c=Object.assign(Object.assign({},i),{idToken:u.idToken,refreshToken:u.refreshToken});switch(t.operationType){case"signIn":const d=await Ya._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(d.user),d;case"reauthenticate":return Je(t.user,r,"internal-error"),Ya._forOperation(t.user,t.operationType,c);default:Xr(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function NSe(n,e){var t;const r=an(n),i=e;return Je(e.customData.operationType,r,"argument-error"),Je((t=i.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),lO._fromError(r,i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function XB(n,e){return Xn(n,"POST","/v2/accounts/mfaEnrollment:start",Zn(n,e))}function MSe(n,e){return Xn(n,"POST","/v2/accounts/mfaEnrollment:finalize",Zn(n,e))}function DSe(n,e){return Xn(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Zn(n,e))}class uO{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>mg._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new uO(e)}async getSession(){return Hu._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,i=await this.getSession(),a=await nl(this.user,r._process(this.user.auth,i,t));return await this.user._updateTokensIfNecessary(a),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const i=await nl(this.user,DSe(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:a})=>a!==t),await this.user._updateTokensIfNecessary(i),await this.user.reload()}catch(i){throw i}}}const gC=new WeakMap;function $Se(n){const e=an(n);return gC.has(e)||gC.set(e,uO._fromUser(e)),gC.get(e)}const ub="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kz{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(ub,"1"),this.storage.removeItem(ub),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const LSe=1e3,USe=10;class Nz extends kz{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=gz(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),i=this.localCache[t];r!==i&&e(t,i,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((s,o,u)=>{this.notifyListeners(s,u)});return}const r=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const s=this.storage.getItem(r);!t&&this.localCache[r]===s||this.notifyListeners(r,s)},a=this.storage.getItem(r);vEe()&&a!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,USe):i()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},LSe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Nz.type="LOCAL";const cO=Nz;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Mz extends kz{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}Mz.type="SESSION";const vc=Mz;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jSe(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Tw{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const r=new Tw(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:i,data:a}=t.data,s=this.handlersMap[i];if(!(s!=null&&s.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const o=Array.from(s).map(async c=>c(t.origin,a)),u=await jSe(o);t.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Tw.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function gg(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class FSe{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let a,s;return new Promise((o,u)=>{const c=gg("",20);i.port1.start();const d=setTimeout(()=>{u(new Error("unsupported_event"))},r);s={messageChannel:i,onMessage(h){const m=h;if(m.data.eventId===c)switch(m.data.status){case"ack":clearTimeout(d),a=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(a),o(m.data.response);break;default:clearTimeout(d),clearTimeout(a),u(new Error("invalid_response"));break}}},this.handlers.add(s),i.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[i.port2])}).finally(()=>{s&&this.removeMessageHandler(s)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lr(){return window}function BSe(n){lr().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function fO(){return typeof lr().WorkerGlobalScope<"u"&&typeof lr().importScripts=="function"}async function qSe(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function VSe(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function zSe(){return fO()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Dz="firebaseLocalStorageDb",HSe=1,cb="firebaseLocalStorage",$z="fbase_key";class yg{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Aw(n,e){return n.transaction([cb],e?"readwrite":"readonly").objectStore(cb)}function GSe(){const n=indexedDB.deleteDatabase(Dz);return new yg(n).toPromise()}function AR(){const n=indexedDB.open(Dz,HSe);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(cb,{keyPath:$z})}catch(i){t(i)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(cb)?e(r):(r.close(),await GSe(),e(await AR()))})})}async function QB(n,e,t){const r=Aw(n,!0).put({[$z]:e,value:t});return new yg(r).toPromise()}async function WSe(n,e){const t=Aw(n,!1).get(e),r=await new yg(t).toPromise();return r===void 0?null:r.value}function e3(n,e){const t=Aw(n,!0).delete(e);return new yg(t).toPromise()}const KSe=800,JSe=3;class Lz{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await AR(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>JSe)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return fO()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Tw._getInstance(zSe()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await qSe(),!this.activeServiceWorker)return;this.sender=new FSe(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||VSe()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await AR();return await QB(e,ub,"1"),await e3(e,ub),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>QB(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>WSe(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>e3(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const a=Aw(i,!1).getAll();return new yg(a).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:a}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(a)&&(this.notifyListeners(i,a),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),KSe)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Lz.type="LOCAL";const Rm=Lz;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function t3(n,e){return Xn(n,"POST","/v2/accounts/mfaSignIn:start",Zn(n,e))}function YSe(n,e){return Xn(n,"POST","/v2/accounts/mfaSignIn:finalize",Zn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const yC=vz("rcb"),ZSe=new fg(3e4,6e4);class XSe{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=lr().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return Je(QSe(t),e,"argument-error"),this.shouldResolveImmediately(t)&&VB(lr().grecaptcha)?Promise.resolve(lr().grecaptcha):new Promise((r,i)=>{const a=lr().setTimeout(()=>{i(xr(e,"network-request-failed"))},ZSe.get());lr()[yC]=()=>{lr().clearTimeout(a),delete lr()[yC];const o=lr().grecaptcha;if(!o||!VB(o)){i(xr(e,"internal-error"));return}const u=o.render;o.render=(c,d)=>{const h=u(c,d);return this.counter++,h},this.hostLanguage=t,r(o)};const s=`${AEe()}?${Wd({onload:yC,render:"explicit",hl:t})}`;rO(s).catch(()=>{clearTimeout(a),i(xr(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=lr().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function QSe(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class eTe{async load(e){return new PEe(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tm="recaptcha",tTe={theme:"light",type:"image"};let nTe=class{constructor(e,t,r=Object.assign({},tTe)){this.parameters=r,this.type=tm,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=Hn(e),this.isInvisible=this.parameters.size==="invisible",Je(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const i=typeof t=="string"?document.getElementById(t):t;Je(i,this.auth,"argument-error"),this.container=i,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new eTe:new XSe,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(i=>{const a=s=>{s&&(this.tokenChangeListeners.delete(a),i(s))};this.tokenChangeListeners.add(a),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){Je(!this.parameters.sitekey,this.auth,"argument-error"),Je(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Je(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=lr()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){Je(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){Je(tO()&&!fO(),this.auth,"internal-error"),await rTe(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await sEe(this.auth);Je(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return Je(this.recaptcha,this.auth,"internal-error"),this.recaptcha}};function rTe(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class dO{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=Xu._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function iTe(n,e,t){if(zn(n.app))return Promise.reject($r(n));const r=Hn(n),i=await Cw(r,e,an(t));return new dO(i,a=>Ew(r,a))}async function aTe(n,e,t){const r=an(n);await ww(!1,r,"phone");const i=await Cw(r.auth,e,an(t));return new dO(i,a=>xz(r,a))}async function sTe(n,e,t){const r=an(n);if(zn(r.auth.app))return Promise.reject($r(r.auth));const i=await Cw(r.auth,e,an(t));return new dO(i,a=>Rz(r,a))}async function Cw(n,e,t){var r;if(!n._getRecaptchaConfig())try{await $Ee(n)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const a=i.session;if("phoneNumber"in i){Je(a.type==="enroll",n,"internal-error");const s={idToken:a.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await Xl(n,s,"mfaSmsEnrollment",async(d,h)=>{if(h.phoneEnrollmentInfo.captchaResponse===em){Je((t==null?void 0:t.type)===tm,d,"argument-error");const m=await vC(d,h,t);return XB(d,m)}return XB(d,h)},"PHONE_PROVIDER").catch(d=>Promise.reject(d))).phoneSessionInfo.sessionInfo}else{Je(a.type==="signin",n,"internal-error");const s=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;Je(s,n,"missing-multi-factor-info");const o={mfaPendingCredential:a.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await Xl(n,o,"mfaSmsSignIn",async(h,m)=>{if(m.phoneSignInInfo.captchaResponse===em){Je((t==null?void 0:t.type)===tm,h,"argument-error");const g=await vC(h,m,t);return t3(h,g)}return t3(h,m)},"PHONE_PROVIDER").catch(h=>Promise.reject(h))).phoneResponseInfo.sessionInfo}}else{const a={phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await Xl(n,a,"sendVerificationCode",async(c,d)=>{if(d.captchaResponse===em){Je((t==null?void 0:t.type)===tm,c,"argument-error");const h=await vC(c,d,t);return YB(c,h)}return YB(c,d)},"PHONE_PROVIDER").catch(c=>Promise.reject(c))).sessionInfo}}finally{t==null||t._reset()}}async function oTe(n,e){const t=an(n);if(zn(t.auth.app))return Promise.reject($r(t.auth));await iO(t,e)}async function vC(n,e,t){Je(t.type===tm,n,"argument-error");const r=await t.verify();Je(typeof r=="string",n,"argument-error");const i=Object.assign({},e);if("phoneEnrollmentInfo"in i){const a=i.phoneEnrollmentInfo.phoneNumber,s=i.phoneEnrollmentInfo.captchaResponse,o=i.phoneEnrollmentInfo.clientType,u=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:a,recaptchaToken:r,captchaResponse:s,clientType:o,recaptchaVersion:u}}),i}else if("phoneSignInInfo"in i){const a=i.phoneSignInInfo.captchaResponse,s=i.phoneSignInInfo.clientType,o=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:a,clientType:s,recaptchaVersion:o}}),i}else return Object.assign(i,{recaptchaToken:r}),i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let _c=class e_{constructor(e){this.providerId=e_.PROVIDER_ID,this.auth=Hn(e)}verifyPhoneNumber(e,t){return Cw(this.auth,e,an(t))}static credential(e,t){return Xu._fromVerification(e,t)}static credentialFromResult(e){const t=e;return e_.credentialFromTaggedObject(t)}static credentialFromError(e){return e_.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?Xu._fromTokenResponse(t,r):null}};_c.PROVIDER_ID="phone";_c.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dc(n,e){return e?ba(e):(Je(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hO extends Jd{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Jo(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Jo(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Jo(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function lTe(n){return Cz(n.auth,new hO(n),n.bypassAuthState)}function uTe(n){const{auth:e,user:t}=n;return Je(t,e,"internal-error"),Az(t,new hO(n),n.bypassAuthState)}async function cTe(n){const{auth:e,user:t}=n;return Je(t,e,"internal-error"),iO(t,new hO(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Uz{constructor(e,t,r,i,a=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=a,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:i,tenantId:a,error:s,type:o}=e;if(s){this.reject(s);return}const u={auth:this.auth,requestUri:t,sessionId:r,tenantId:a||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(u))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return lTe;case"linkViaPopup":case"linkViaRedirect":return cTe;case"reauthViaPopup":case"reauthViaRedirect":return uTe;default:Xr(this.auth,"internal-error")}}resolve(e){Os(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){Os(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fTe=new fg(2e3,1e4);async function dTe(n,e,t){if(zn(n.app))return Promise.reject(xr(n,"operation-not-supported-in-this-environment"));const r=Hn(n);Kd(n,e,ol);const i=Dc(r,t);return new Vo(r,"signInViaPopup",e,i).executeNotNull()}async function hTe(n,e,t){const r=an(n);if(zn(r.auth.app))return Promise.reject(xr(r.auth,"operation-not-supported-in-this-environment"));Kd(r.auth,e,ol);const i=Dc(r.auth,t);return new Vo(r.auth,"reauthViaPopup",e,i,r).executeNotNull()}async function pTe(n,e,t){const r=an(n);Kd(r.auth,e,ol);const i=Dc(r.auth,t);return new Vo(r.auth,"linkViaPopup",e,i,r).executeNotNull()}class Vo extends Uz{constructor(e,t,r,i,a){super(e,t,i,a),this.provider=r,this.authWindow=null,this.pollId=null,Vo.currentPopupAction&&Vo.currentPopupAction.cancel(),Vo.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Je(e,this.auth,"internal-error"),e}async onExecution(){Os(this.filter.length===1,"Popup operations only handle one event");const e=gg();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(xr(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(xr(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Vo.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(xr(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,fTe.get())};e()}}Vo.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mTe="pendingRedirect",nm=new Map;class gTe extends Uz{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=nm.get(this.auth._key());if(!e){try{const r=await yTe(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}nm.set(this.auth._key(),e)}return this.bypassAuthState||nm.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function yTe(n,e){const t=Fz(e),r=jz(n);if(!await r._isAvailable())return!1;const i=await r._get(t)==="true";return await r._remove(t),i}async function pO(n,e){return jz(n)._set(Fz(e),"true")}function vTe(){nm.clear()}function mO(n,e){nm.set(n._key(),e)}function jz(n){return ba(n._redirectPersistence)}function Fz(n){return Zu(mTe,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _Te(n,e,t){return bTe(n,e,t)}async function bTe(n,e,t){if(zn(n.app))return Promise.reject($r(n));const r=Hn(n);Kd(n,e,ol),await r._initializationPromise;const i=Dc(r,t);return await pO(i,r),i._openRedirect(r,e,"signInViaRedirect")}function wTe(n,e,t){return ETe(n,e,t)}async function ETe(n,e,t){const r=an(n);if(Kd(r.auth,e,ol),zn(r.auth.app))return Promise.reject($r(r.auth));await r.auth._initializationPromise;const i=Dc(r.auth,t);await pO(i,r.auth);const a=await Bz(r);return i._openRedirect(r.auth,e,"reauthViaRedirect",a)}function STe(n,e,t){return TTe(n,e,t)}async function TTe(n,e,t){const r=an(n);Kd(r.auth,e,ol),await r.auth._initializationPromise;const i=Dc(r.auth,t);await ww(!1,r,e.providerId),await pO(i,r.auth);const a=await Bz(r);return i._openRedirect(r.auth,e,"linkViaRedirect",a)}async function ATe(n,e){return await Hn(n)._initializationPromise,xw(n,e,!1)}async function xw(n,e,t=!1){if(zn(n.app))return Promise.reject($r(n));const r=Hn(n),i=Dc(r,e),s=await new gTe(r,i,t).execute();return s&&!t&&(delete s.user._redirectEventId,await r._persistUserIfCurrent(s.user),await r._setRedirectUser(null,e)),s}async function Bz(n){const e=gg(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const CTe=10*60*1e3;class qz{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!xTe(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!Vz(e)){const i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(xr(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=CTe&&this.cachedEventUids.clear(),this.cachedEventUids.has(n3(e))}saveEventToCache(e){this.cachedEventUids.add(n3(e)),this.lastProcessedEventTime=Date.now()}}function n3(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Vz({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function xTe(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Vz(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function zz(n,e={}){return Xn(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const RTe=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ITe=/^https?/;async function PTe(n){if(n.config.emulator)return;const{authorizedDomains:e}=await zz(n);for(const t of e)try{if(OTe(t))return}catch{}Xr(n,"unauthorized-domain")}function OTe(n){const e=Am(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const s=new URL(n);return s.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&s.hostname===r}if(!ITe.test(t))return!1;if(RTe.test(n))return r===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kTe=new fg(3e4,6e4);function r3(){const n=lr().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function NTe(n){return new Promise((e,t)=>{var r,i,a;function s(){r3(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{r3(),t(xr(n,"network-request-failed"))},timeout:kTe.get()})}if(!((i=(r=lr().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((a=lr().gapi)===null||a===void 0)&&a.load)s();else{const o=vz("iframefcb");return lr()[o]=()=>{gapi.load?s():t(xr(n,"network-request-failed"))},rO(`${xEe()}?onload=${o}`).catch(u=>t(u))}}).catch(e=>{throw t_=null,e})}let t_=null;function MTe(n){return t_=t_||NTe(n),t_}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const DTe=new fg(5e3,15e3),$Te="__/auth/iframe",LTe="emulator/auth/iframe",UTe={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},jTe=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function FTe(n){const e=n.config;Je(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?nO(e,LTe):`https://${n.config.authDomain}/${$Te}`,r={apiKey:e.apiKey,appName:n.name,v:Mc},i=jTe.get(n.config.apiHost);i&&(r.eid=i);const a=n._getFrameworks();return a.length&&(r.fw=a.join(",")),`${t}?${Wd(r).slice(1)}`}async function BTe(n){const e=await MTe(n),t=lr().gapi;return Je(t,n,"internal-error"),e.open({where:document.body,url:FTe(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:UTe,dontclear:!0},r=>new Promise(async(i,a)=>{await r.restyle({setHideOnLeave:!1});const s=xr(n,"network-request-failed"),o=lr().setTimeout(()=>{a(s)},DTe.get());function u(){lr().clearTimeout(o),i(r)}r.ping(u).then(u,()=>{a(s)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qTe={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},VTe=500,zTe=600,HTe="_blank",GTe="http://localhost";class i3{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function WTe(n,e,t,r=VTe,i=zTe){const a=Math.max((window.screen.availHeight-i)/2,0).toString(),s=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const u=Object.assign(Object.assign({},qTe),{width:r.toString(),height:i.toString(),top:a,left:s}),c=Rr().toLowerCase();t&&(o=dz(c)?HTe:t),cz(c)&&(e=e||GTe,u.scrollbars="yes");const d=Object.entries(u).reduce((m,[g,_])=>`${m}${g}=${_},`,"");if(yEe(c)&&o!=="_self")return KTe(e||"",o),new i3(null);const h=window.open(e||"",o,d);Je(h,n,"popup-blocked");try{h.focus()}catch{}return new i3(h)}function KTe(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const JTe="__/auth/handler",YTe="emulator/auth/handler",ZTe=encodeURIComponent("fac");async function CR(n,e,t,r,i,a){Je(n.config.authDomain,n,"auth-domain-config-required"),Je(n.config.apiKey,n,"invalid-api-key");const s={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:Mc,eventId:i};if(e instanceof ol){e.setDefaultLanguage(n.languageCode),s.providerId=e.providerId||"",Twe(e.getCustomParameters())||(s.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,h]of Object.entries(a||{}))s[d]=h}if(e instanceof Yd){const d=e.getScopes().filter(h=>h!=="");d.length>0&&(s.scopes=d.join(","))}n.tenantId&&(s.tid=n.tenantId);const o=s;for(const d of Object.keys(o))o[d]===void 0&&delete o[d];const u=await n._getAppCheckToken(),c=u?`#${ZTe}=${encodeURIComponent(u)}`:"";return`${XTe(n)}?${Wd(o).slice(1)}${c}`}function XTe({config:n}){return n.emulator?nO(n,YTe):`https://${n.authDomain}/${JTe}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _C="webStorageSupport";class QTe{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=vc,this._completeRedirectFn=xw,this._overrideRedirectResult=mO}async _openPopup(e,t,r,i){var a;Os((a=this.eventManagers[e._key()])===null||a===void 0?void 0:a.manager,"_initialize() not called before _openPopup()");const s=await CR(e,t,r,Am(),i);return WTe(e,s,gg())}async _openRedirect(e,t,r,i){await this._originValidation(e);const a=await CR(e,t,r,Am(),i);return BSe(a),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:a}=this.eventManagers[t];return i?Promise.resolve(i):(Os(a,"If manager is not set, promise should be"),a)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await BTe(e),r=new qz(e);return t.register("authEvent",i=>(Je(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(_C,{type:_C},i=>{var a;const s=(a=i==null?void 0:i[0])===null||a===void 0?void 0:a[_C];s!==void 0&&t(!!s),Xr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=PTe(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return gz()||fz()||hg()}}const e1e=QTe;class t1e{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return io("unexpected MultiFactorSessionType")}}}class gO extends t1e{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new gO(e)}_finalizeEnroll(e,t,r){return MSe(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return YSe(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class Hz{constructor(){}static assertion(e){return gO._fromCredential(e)}}Hz.FACTOR_ID="phone";var a3="@firebase/auth",s3="1.10.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class n1e{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Je(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r1e(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function i1e(n){gc(new ru("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),a=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=r.options;Je(s&&!s.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:s,authDomain:o,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:yz(n)},c=new SEe(r,i,a,u);return LEe(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),gc(new ru("auth-internal",e=>{const t=Hn(e.getProvider("auth").getImmediate());return(r=>new n1e(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ko(a3,s3,r1e(n)),Ko(a3,s3,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const a1e=5*60;fwe("authIdTokenMaxAge");function s1e(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}TEe({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{const a=xr("internal-error");a.customData=i,t(a)},r.type="text/javascript",r.charset="UTF-8",s1e().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});i1e("Browser");/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bc(){return window}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const o1e=2e3;async function l1e(n,e,t){var r;const{BuildInfo:i}=bc();Os(e.sessionId,"AuthEvent did not contain a session ID");const a=await h1e(e.sessionId),s={};return hg()?s.ibi=i.packageName:dg()?s.apn=i.packageName:Xr(n,"operation-not-supported-in-this-environment"),i.displayName&&(s.appDisplayName=i.displayName),s.sessionId=a,CR(n,t,e.type,void 0,(r=e.eventId)!==null&&r!==void 0?r:void 0,s)}async function u1e(n){const{BuildInfo:e}=bc(),t={};hg()?t.iosBundleId=e.packageName:dg()?t.androidPackageName=e.packageName:Xr(n,"operation-not-supported-in-this-environment"),await zz(n,t)}function c1e(n){const{cordova:e}=bc();return new Promise(t=>{e.plugins.browsertab.isAvailable(r=>{let i=null;r?e.plugins.browsertab.openUrl(n):i=e.InAppBrowser.open(n,gEe()?"_blank":"_system","location=yes"),t(i)})})}async function f1e(n,e,t){const{cordova:r}=bc();let i=()=>{};try{await new Promise((a,s)=>{let o=null;function u(){var h;a();const m=(h=r.plugins.browsertab)===null||h===void 0?void 0:h.close;typeof m=="function"&&m(),typeof(t==null?void 0:t.close)=="function"&&t.close()}function c(){o||(o=window.setTimeout(()=>{s(xr(n,"redirect-cancelled-by-user"))},o1e))}function d(){(document==null?void 0:document.visibilityState)==="visible"&&c()}e.addPassiveListener(u),document.addEventListener("resume",c,!1),dg()&&document.addEventListener("visibilitychange",d,!1),i=()=>{e.removePassiveListener(u),document.removeEventListener("resume",c,!1),document.removeEventListener("visibilitychange",d,!1),o&&window.clearTimeout(o)}})}finally{i()}}function d1e(n){var e,t,r,i,a,s,o,u,c,d;const h=bc();Je(typeof((e=h==null?void 0:h.universalLinks)===null||e===void 0?void 0:e.subscribe)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),Je(typeof((t=h==null?void 0:h.BuildInfo)===null||t===void 0?void 0:t.packageName)<"u",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),Je(typeof((a=(i=(r=h==null?void 0:h.cordova)===null||r===void 0?void 0:r.plugins)===null||i===void 0?void 0:i.browsertab)===null||a===void 0?void 0:a.openUrl)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),Je(typeof((u=(o=(s=h==null?void 0:h.cordova)===null||s===void 0?void 0:s.plugins)===null||o===void 0?void 0:o.browsertab)===null||u===void 0?void 0:u.isAvailable)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),Je(typeof((d=(c=h==null?void 0:h.cordova)===null||c===void 0?void 0:c.InAppBrowser)===null||d===void 0?void 0:d.open)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}async function h1e(n){const e=p1e(n),t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(i=>i.toString(16).padStart(2,"0")).join("")}function p1e(n){if(Os(/[0-9a-zA-Z]+/.test(n),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return new TextEncoder().encode(n);const e=new ArrayBuffer(n.length),t=new Uint8Array(e);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const m1e=20;class g1e extends qz{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInitialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInitialized(),this.passiveListeners.forEach(t=>t(e)),super.onEvent(e)}async initialized(){await this.initPromise}}function y1e(n,e,t=null){return{type:e,eventId:t,urlResponse:null,sessionId:b1e(),postBody:null,tenantId:n.tenantId,error:xr(n,"no-auth-event")}}function v1e(n,e){return xR()._set(RR(n),e)}async function o3(n){const e=await xR()._get(RR(n));return e&&await xR()._remove(RR(n)),e}function _1e(n,e){var t,r;const i=E1e(e);if(i.includes("/__/auth/callback")){const a=n_(i),s=a.firebaseError?w1e(decodeURIComponent(a.firebaseError)):null,o=(r=(t=s==null?void 0:s.code)===null||t===void 0?void 0:t.split("auth/"))===null||r===void 0?void 0:r[1],u=o?xr(o):null;return u?{type:n.type,eventId:n.eventId,tenantId:n.tenantId,error:u,urlResponse:null,sessionId:null,postBody:null}:{type:n.type,eventId:n.eventId,tenantId:n.tenantId,sessionId:n.sessionId,urlResponse:i,postBody:null}}return null}function b1e(){const n=[],e="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let t=0;t<m1e;t++){const r=Math.floor(Math.random()*e.length);n.push(e.charAt(r))}return n.join("")}function xR(){return ba(cO)}function RR(n){return Zu("authEvent",n.config.apiKey,n.name)}function w1e(n){try{return JSON.parse(n)}catch{return null}}function E1e(n){const e=n_(n),t=e.link?decodeURIComponent(e.link):void 0,r=n_(t).link,i=e.deep_link_id?decodeURIComponent(e.deep_link_id):void 0;return n_(i).link||i||r||t||n}function n_(n){if(!(n!=null&&n.includes("?")))return{};const[e,...t]=n.split("?");return ed(t.join("?"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const S1e=500;class T1e{constructor(){this._redirectPersistence=vc,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=xw,this._overrideRedirectResult=mO}async _initialize(e){const t=e._key();let r=this.eventManagers.get(t);return r||(r=new g1e(e),this.eventManagers.set(t,r),this.attachCallbackListeners(e,r)),r}_openPopup(e){Xr(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,r,i){d1e(e);const a=await this._initialize(e);await a.initialized(),a.resetRedirect(),vTe(),await this._originValidation(e);const s=y1e(e,r,i);await v1e(e,s);const o=await l1e(e,s,t),u=await c1e(o);return f1e(e,a,u)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=u1e(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:r,handleOpenURL:i,BuildInfo:a}=bc(),s=setTimeout(async()=>{await o3(e),t.onEvent(l3())},S1e),o=async d=>{clearTimeout(s);const h=await o3(e);let m=null;h&&(d!=null&&d.url)&&(m=_1e(h,d.url)),t.onEvent(m||l3())};typeof r<"u"&&typeof r.subscribe=="function"&&r.subscribe(null,o);const u=i,c=`${a.packageName.toLowerCase()}://`;bc().handleOpenURL=async d=>{if(d.toLowerCase().startsWith(c)&&o({url:d}),typeof u=="function")try{u(d)}catch(h){console.error(h)}}}}const A1e=T1e;function l3(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:xr("no-auth-event")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function C1e(n,e){Hn(n)._logFramework(e)}var x1e="@firebase/auth-compat",R1e="0.5.27";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const I1e=1e3;function rm(){var n;return((n=self==null?void 0:self.location)===null||n===void 0?void 0:n.protocol)||null}function P1e(){return rm()==="http:"||rm()==="https:"}function Gz(n=Rr()){return!!((rm()==="file:"||rm()==="ionic:"||rm()==="capacitor:")&&n.toLowerCase().match(/iphone|ipad|ipod|android/))}function O1e(){return GP()||L8()}function k1e(){return F8()&&(document==null?void 0:document.documentMode)===11}function N1e(n=Rr()){return/Edge\/\d+/.test(n)}function M1e(n=Rr()){return k1e()||N1e(n)}function Wz(){try{const n=self.localStorage,e=gg();if(n)return n.setItem(e,"1"),n.removeItem(e),M1e()?rb():!0}catch{return yO()&&rb()}return!1}function yO(){return typeof window<"u"&&"WorkerGlobalScope"in window&&"importScripts"in window}function bC(){return(P1e()||j8()||Gz())&&!O1e()&&Wz()&&!yO()}function Kz(){return Gz()&&typeof document<"u"}async function D1e(){return Kz()?new Promise(n=>{const e=setTimeout(()=>{n(!1)},I1e);document.addEventListener("deviceready",()=>{clearTimeout(e),n(!0)})}):!1}function $1e(){return typeof window<"u"?window:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ya={LOCAL:"local",NONE:"none",SESSION:"session"},mp=Je,Jz="persistence";function L1e(n,e){if(mp(Object.values(ya).includes(e),n,"invalid-persistence-type"),GP()){mp(e!==ya.SESSION,n,"unsupported-persistence-type");return}if(L8()){mp(e===ya.NONE,n,"unsupported-persistence-type");return}if(yO()){mp(e===ya.NONE||e===ya.LOCAL&&rb(),n,"unsupported-persistence-type");return}mp(e===ya.NONE||Wz(),n,"unsupported-persistence-type")}async function IR(n){await n._initializationPromise;const e=Yz(),t=Zu(Jz,n.config.apiKey,n.name);e&&e.setItem(t,n._getPersistenceType())}function U1e(n,e){const t=Yz();if(!t)return[];const r=Zu(Jz,n,e);switch(t.getItem(r)){case ya.NONE:return[Pd];case ya.LOCAL:return[Rm,vc];case ya.SESSION:return[vc];default:return[]}}function Yz(){var n;try{return((n=$1e())===null||n===void 0?void 0:n.sessionStorage)||null}catch{return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const j1e=Je;class Gl{constructor(){this.browserResolver=ba(e1e),this.cordovaResolver=ba(A1e),this.underlyingResolver=null,this._redirectPersistence=vc,this._completeRedirectFn=xw,this._overrideRedirectResult=mO}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,r,i){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,r,i)}async _openRedirect(e,t,r,i){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,r,i)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return Kz()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return j1e(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await D1e();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zz(n){return n.unwrap()}function F1e(n){return n.wrapped()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function B1e(n){return Xz(n)}function q1e(n,e){var t;const r=(t=e.customData)===null||t===void 0?void 0:t._tokenResponse;if((e==null?void 0:e.code)==="auth/multi-factor-auth-required"){const i=e;i.resolver=new V1e(n,NSe(n,e))}else if(r){const i=Xz(e),a=e;i&&(a.credential=i,a.tenantId=r.tenantId||void 0,a.email=r.email||void 0,a.phoneNumber=r.phoneNumber||void 0)}}function Xz(n){const{_tokenResponse:e}=n instanceof Wi?n.customData:n;if(!e)return null;if(!(n instanceof Wi)&&"temporaryProof"in e&&"phoneNumber"in e)return _c.credentialFromResult(n);const t=e.providerId;if(!t||t===hp.PASSWORD)return null;let r;switch(t){case hp.GOOGLE:r=Zs;break;case hp.FACEBOOK:r=Ys;break;case hp.GITHUB:r=Xs;break;case hp.TWITTER:r=Qs;break;default:const{oauthIdToken:i,oauthAccessToken:a,oauthTokenSecret:s,pendingToken:o,nonce:u}=e;return!a&&!s&&!i&&!o?null:o?t.startsWith("saml.")?Od._create(t,o):ho._fromParams({providerId:t,signInMethod:t,pendingToken:o,idToken:i,accessToken:a}):new yd(t).credential({idToken:i,accessToken:a,rawNonce:u})}return n instanceof Wi?r.credentialFromError(n):r.credentialFromResult(n)}function $i(n,e){return e.catch(t=>{throw t instanceof Wi&&q1e(n,t),t}).then(t=>{const r=t.operationType,i=t.user;return{operationType:r,credential:B1e(t),additionalUserInfo:kSe(t),user:zo.getOrCreate(i)}})}async function PR(n,e){const t=await e;return{verificationId:t.verificationId,confirm:r=>$i(n,t.confirm(r))}}class V1e{constructor(e,t){this.resolver=t,this.auth=F1e(e)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return $i(Zz(this.auth),this.resolver.resolveSignIn(e))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zo{constructor(e){this._delegate=e,this.multiFactor=$Se(e)}static getOrCreate(e){return zo.USER_MAP.has(e)||zo.USER_MAP.set(e,new zo(e)),zo.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return $i(this.auth,xz(this._delegate,e))}async linkWithPhoneNumber(e,t){return PR(this.auth,aTe(this._delegate,e,t))}async linkWithPopup(e){return $i(this.auth,pTe(this._delegate,e,Gl))}async linkWithRedirect(e){return await IR(Hn(this.auth)),STe(this._delegate,e,Gl)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return $i(this.auth,Rz(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return PR(this.auth,sTe(this._delegate,e,t))}reauthenticateWithPopup(e){return $i(this.auth,hTe(this._delegate,e,Gl))}async reauthenticateWithRedirect(e){return await IR(Hn(this.auth)),wTe(this._delegate,e,Gl)}sendEmailVerification(e){return wSe(this._delegate,e)}async unlink(e){return await oSe(this._delegate,e),this}updateEmail(e){return ASe(this._delegate,e)}updatePassword(e){return CSe(this._delegate,e)}updatePhoneNumber(e){return oTe(this._delegate,e)}updateProfile(e){return TSe(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return ESe(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}zo.USER_MAP=new WeakMap;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gp=Je;class OR{constructor(e,t){if(this.app=e,t.isInitialized()){this._delegate=t.getImmediate(),this.linkUnderlyingAuth();return}const{apiKey:r}=e.options;gp(r,"invalid-api-key",{appName:e.name}),gp(r,"invalid-api-key",{appName:e.name});const i=typeof window<"u"?Gl:void 0;this._delegate=t.initialize({options:{persistence:z1e(r,e.name),popupRedirectResolver:i}}),this._delegate._updateErrorMap(Y0e),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?zo.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){UEe(this._delegate,e,t)}applyActionCode(e){return dSe(this._delegate,e)}checkActionCode(e){return Iz(this._delegate,e)}confirmPasswordReset(e,t){return fSe(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return $i(this._delegate,pSe(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return bSe(this._delegate,e)}isSignInWithEmailLink(e){return ySe(this._delegate,e)}async getRedirectResult(){gp(bC(),this._delegate,"operation-not-supported-in-this-environment");const e=await ATe(this._delegate,Gl);return e?$i(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){C1e(this._delegate,e)}onAuthStateChanged(e,t,r){const{next:i,error:a,complete:s}=u3(e,t,r);return this._delegate.onAuthStateChanged(i,a,s)}onIdTokenChanged(e,t,r){const{next:i,error:a,complete:s}=u3(e,t,r);return this._delegate.onIdTokenChanged(i,a,s)}sendSignInLinkToEmail(e,t){return gSe(this._delegate,e,t)}sendPasswordResetEmail(e,t){return cSe(this._delegate,e,t||void 0)}async setPersistence(e){L1e(this._delegate,e);let t;switch(e){case ya.SESSION:t=vc;break;case ya.LOCAL:t=await ba(Rm)._isAvailable()?Rm:cO;break;case ya.NONE:t=Pd;break;default:return Xr("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return $i(this._delegate,sSe(this._delegate))}signInWithCredential(e){return $i(this._delegate,Ew(this._delegate,e))}signInWithCustomToken(e){return $i(this._delegate,uSe(this._delegate,e))}signInWithEmailAndPassword(e,t){return $i(this._delegate,mSe(this._delegate,e,t))}signInWithEmailLink(e,t){return $i(this._delegate,vSe(this._delegate,e,t))}signInWithPhoneNumber(e,t){return PR(this._delegate,iTe(this._delegate,e,t))}async signInWithPopup(e){return gp(bC(),this._delegate,"operation-not-supported-in-this-environment"),$i(this._delegate,dTe(this._delegate,e,Gl))}async signInWithRedirect(e){return gp(bC(),this._delegate,"operation-not-supported-in-this-environment"),await IR(this._delegate),_Te(this._delegate,e,Gl)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return hSe(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}OR.Persistence=ya;function u3(n,e,t){let r=n;typeof n!="function"&&({next:r,error:e,complete:t}=n);const i=r;return{next:s=>i(s&&zo.getOrCreate(s)),error:e,complete:t}}function z1e(n,e){const t=U1e(n,e);if(typeof self<"u"&&!t.includes(Rm)&&t.push(Rm),typeof window<"u")for(const r of[cO,vc])t.includes(r)||t.push(r);return t.includes(Pd)||t.push(Pd),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vO{static credential(e,t){return _c.credential(e,t)}constructor(){this.providerId="phone",this._delegate=new _c(Zz(yc.auth()))}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}vO.PHONE_SIGN_IN_METHOD=_c.PHONE_SIGN_IN_METHOD;vO.PROVIDER_ID=_c.PROVIDER_ID;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H1e=Je;class G1e{constructor(e,t,r=yc.app()){var i;H1e((i=r.options)===null||i===void 0?void 0:i.apiKey,"invalid-api-key",{appName:r.name}),this._delegate=new nTe(r.auth(),e,t),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W1e="auth-compat";function K1e(n){n.INTERNAL.registerComponent(new ru(W1e,e=>{const t=e.getProvider("app-compat").getImmediate(),r=e.getProvider("auth");return new OR(t,r)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:Pf.EMAIL_SIGNIN,PASSWORD_RESET:Pf.PASSWORD_RESET,RECOVER_EMAIL:Pf.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:Pf.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:Pf.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:Pf.VERIFY_EMAIL}},EmailAuthProvider:cu,FacebookAuthProvider:Ys,GithubAuthProvider:Xs,GoogleAuthProvider:Zs,OAuthProvider:yd,SAMLAuthProvider:ob,PhoneAuthProvider:vO,PhoneMultiFactorGenerator:Hz,RecaptchaVerifier:G1e,TwitterAuthProvider:Qs,Auth:OR,AuthCredential:Jd,Error:Wi}).setInstantiationMode("LAZY").setMultipleInstances(!1)),n.registerVersion(x1e,R1e)}K1e(yc);yc.apps.length||yc.initializeApp(iW);const c3=yc.auth(),J1e=()=>{const[n,e]=wt.useState(null),[t,r]=wt.useState(!0);return wt.useEffect(()=>{const a=c3.onAuthStateChanged(s=>{e(s||null),r(!1)});return()=>a()},[]),{user:n,loadingAuth:t,signOut:async()=>{try{await c3.signOut()}catch(a){console.error("Error signing out:",a)}}}},Y1e=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function Z1e(n){return typeof n=="string"&&Y1e.test(n)}function Qz(n){if(!Z1e(n))throw TypeError("Invalid UUID");var e,t=new Uint8Array(16);return t[0]=(e=parseInt(n.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(n.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(n.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(n.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var Hr=[];for(var wC=0;wC<256;++wC)Hr.push((wC+256).toString(16).slice(1));function Rw(n,e=0){return(Hr[n[e+0]]+Hr[n[e+1]]+Hr[n[e+2]]+Hr[n[e+3]]+"-"+Hr[n[e+4]]+Hr[n[e+5]]+"-"+Hr[n[e+6]]+Hr[n[e+7]]+"-"+Hr[n[e+8]]+Hr[n[e+9]]+"-"+Hr[n[e+10]]+Hr[n[e+11]]+Hr[n[e+12]]+Hr[n[e+13]]+Hr[n[e+14]]+Hr[n[e+15]]).toLowerCase()}var Sv,X1e=new Uint8Array(16);function Q1e(){if(!Sv&&(Sv=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Sv))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Sv(X1e)}var EC,Tv,SC=0,TC=0;function eAe(n,e,t){var r=0,i=e||new Array(16);n=n||{};var a=n.node,s=n.clockseq;if(n._v6||(a||(a=EC),s==null&&(s=Tv)),a==null||s==null){var o=n.random||(n.rng||Q1e)();a==null&&(a=[o[0],o[1],o[2],o[3],o[4],o[5]],!EC&&!n._v6&&(a[0]|=1,EC=a)),s==null&&(s=(o[6]<<8|o[7])&16383,Tv===void 0&&!n._v6&&(Tv=s))}var u=n.msecs!==void 0?n.msecs:Date.now(),c=n.nsecs!==void 0?n.nsecs:TC+1,d=u-SC+(c-TC)/1e4;if(d<0&&n.clockseq===void 0&&(s=s+1&16383),(d<0||u>SC)&&n.nsecs===void 0&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");SC=u,TC=c,Tv=s,u+=122192928e5;var h=((u&268435455)*1e4+c)%4294967296;i[r++]=h>>>24&255,i[r++]=h>>>16&255,i[r++]=h>>>8&255,i[r++]=h&255;var m=u/4294967296*1e4&268435455;i[r++]=m>>>8&255,i[r++]=m&255,i[r++]=m>>>24&15|16,i[r++]=m>>>16&255,i[r++]=s>>>8|128,i[r++]=s&255;for(var g=0;g<6;++g)i[r+g]=a[g];return e||Rw(i)}function tAe(n){var e=typeof n=="string"?Qz(n):n,t=nAe(e);return typeof n=="string"?Rw(t):t}function nAe(n,e=!1){return Uint8Array.of((n[6]&15)<<4|n[7]>>4&15,(n[7]&15)<<4|(n[4]&240)>>4,(n[4]&15)<<4|(n[5]&240)>>4,(n[5]&15)<<4|(n[0]&240)>>4,(n[0]&15)<<4|(n[1]&240)>>4,(n[1]&15)<<4|(n[2]&240)>>4,96|n[2]&15,n[3],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15])}function rAe(n){n=unescape(encodeURIComponent(n));for(var e=[],t=0;t<n.length;++t)e.push(n.charCodeAt(t));return e}var iAe="6ba7b810-9dad-11d1-80b4-00c04fd430c8",aAe="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function sAe(n,e,t){function r(i,a,s,o){var u;if(typeof i=="string"&&(i=rAe(i)),typeof a=="string"&&(a=Qz(a)),((u=a)===null||u===void 0?void 0:u.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var c=new Uint8Array(16+i.length);if(c.set(a),c.set(i,a.length),c=t(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,s){o=o||0;for(var d=0;d<16;++d)s[o+d]=c[d];return s}return Rw(c)}try{r.name=n}catch{}return r.DNS=iAe,r.URL=aAe,r}function oAe(n,e,t,r){switch(n){case 0:return e&t^~e&r;case 1:return e^t^r;case 2:return e&t^e&r^t&r;case 3:return e^t^r}}function AC(n,e){return n<<e|n>>>32-e}function lAe(n){var e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){var r=unescape(encodeURIComponent(n));n=[];for(var i=0;i<r.length;++i)n.push(r.charCodeAt(i))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);for(var a=n.length/4+2,s=Math.ceil(a/16),o=new Array(s),u=0;u<s;++u){for(var c=new Uint32Array(16),d=0;d<16;++d)c[d]=n[u*64+d*4]<<24|n[u*64+d*4+1]<<16|n[u*64+d*4+2]<<8|n[u*64+d*4+3];o[u]=c}o[s-1][14]=(n.length-1)*8/Math.pow(2,32),o[s-1][14]=Math.floor(o[s-1][14]),o[s-1][15]=(n.length-1)*8&4294967295;for(var h=0;h<s;++h){for(var m=new Uint32Array(80),g=0;g<16;++g)m[g]=o[h][g];for(var _=16;_<80;++_)m[_]=AC(m[_-3]^m[_-8]^m[_-14]^m[_-16],1);for(var w=t[0],S=t[1],E=t[2],C=t[3],A=t[4],R=0;R<80;++R){var P=Math.floor(R/20),N=AC(w,5)+oAe(P,S,E,C)+A+e[P]+m[R]>>>0;A=C,C=E,E=AC(S,30)>>>0,S=w,w=N}t[0]=t[0]+w>>>0,t[1]=t[1]+S>>>0,t[2]=t[2]+E>>>0,t[3]=t[3]+C>>>0,t[4]=t[4]+A>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var uAe=sAe("v5",80,lAe);function f3(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function d3(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?f3(Object(t),!0).forEach(function(r){cAe(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):f3(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function cAe(n,e,t){return(e=fAe(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function fAe(n){var e=dAe(n,"string");return typeof e=="symbol"?e:e+""}function dAe(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function hAe(n={},e,t=0){var r=eAe(d3(d3({},n),{},{_v6:!0}),new Uint8Array(16));return r=tAe(r),Rw(r)}function eH(n){return hAe({clockseq:n})}function td(n,e){const t=e.replace(/-/g,"").match(/.{2}/g).map(r=>parseInt(r,16));return uAe(n,new Uint8Array(t))}const pAe="__error__",r_="__scheduled__",mAe="__interrupt__",gAe="__resume__",yAe=[],vAe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class tH extends wa{async addMessages(e){for(const t of e)await this.addMessage(t)}}class _O extends wa{addUserMessage(e){return this.addMessage(new oi(e))}addAIChatMessage(e){return this.addMessage(new Tn(e))}addAIMessage(e){return this.addMessage(new Tn(e))}async addMessages(e){for(const t of e)await this.addMessage(t)}clear(){throw new Error("Not implemented.")}}class _Ae extends _O{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","stores","message","in_memory"]}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.messages=e??[]}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async clear(){this.messages=[]}}const bAe=Object.freeze(Object.defineProperty({__proto__:null,BaseChatMessageHistory:tH,BaseListChatMessageHistory:_O,InMemoryChatMessageHistory:_Ae},Symbol.toStringTag,{value:"Module"}));class Qu{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent!==void 0?e.pageContent.toString():"",this.metadata=e.metadata??{},this.id=e.id}}class nH extends Gt{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","documents","transformers"]})}invoke(e,t){return this.transformDocuments(e)}}class wAe extends nH{async transformDocuments(e){const t=[];for(const r of e){const i=await this._transformDocument(r);t.push(i)}return t}}const EAe=Object.freeze(Object.defineProperty({__proto__:null,BaseDocumentTransformer:nH,Document:Qu,MappingDocumentTransformer:wAe},Symbol.toStringTag,{value:"Module"}));class bO extends wa{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","example_selectors","base"]})}}class rH{async getPromptAsync(e,t){return this.getPrompt(e).partial((t==null?void 0:t.partialVariables)??{})}}class SAe extends rH{constructor(e,t=[]){super(),Object.defineProperty(this,"defaultPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"conditionals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.defaultPrompt=e,this.conditionals=t}getPrompt(e){for(const[t,r]of this.conditionals)if(t(e))return r;return this.defaultPrompt}}function TAe(n){return n._modelType()==="base_llm"}function AAe(n){return n._modelType()==="base_chat_model"}function h3(n){return n.split(/\n| /).length}class wO extends bO{constructor(e){super(e),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getTextLength",{enumerable:!0,configurable:!0,writable:!0,value:h3}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,writable:!0,value:2048}),Object.defineProperty(this,"exampleTextLengths",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.examplePrompt=e.examplePrompt,this.maxLength=e.maxLength??2048,this.getTextLength=e.getTextLength??h3}async addExample(e){this.examples.push(e);const t=await this.examplePrompt.format(e);this.exampleTextLengths.push(this.getTextLength(t))}async calculateExampleTextLengths(e,t){if(e.length>0)return e;const{examples:r,examplePrompt:i}=t;return(await Promise.all(r.map(s=>i.format(s)))).map(s=>this.getTextLength(s))}async selectExamples(e){const t=Object.values(e).join(" ");let r=this.maxLength-this.getTextLength(t),i=0;const a=[];for(;r>0&&i<this.examples.length;){const s=r-this.exampleTextLengths[i];if(s<0)break;a.push(this.examples[i]),r=s,i+=1}return a}static async fromExamples(e,t){const r=new wO(t);return await Promise.all(e.map(i=>r.addExample(i))),r}}function CC(n){return Object.keys(n).sort().map(e=>n[e])}class EO extends bO{constructor(e){if(super(e),Object.defineProperty(this,"vectorStoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleKeys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKeys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.exampleKeys=e.exampleKeys,this.inputKeys=e.inputKeys,e.vectorStore!==void 0)this.vectorStoreRetriever=e.vectorStore.asRetriever({k:e.k??4,filter:e.filter});else if(e.vectorStoreRetriever)this.vectorStoreRetriever=e.vectorStoreRetriever;else throw new Error('You must specify one of "vectorStore" and "vectorStoreRetriever".')}async addExample(e){const t=this.inputKeys??Object.keys(e),r=CC(t.reduce((i,a)=>({...i,[a]:e[a]}),{})).join(" ");await this.vectorStoreRetriever.addDocuments([new Qu({pageContent:r,metadata:e})])}async selectExamples(e){const t=this.inputKeys??Object.keys(e),r=CC(t.reduce((s,o)=>({...s,[o]:e[o]}),{})).join(" "),a=(await this.vectorStoreRetriever.invoke(r)).map(s=>s.metadata);return this.exampleKeys?a.map(s=>this.exampleKeys.reduce((o,u)=>({...o,[u]:s[u]}),{})):a}static async fromExamples(e,t,r,i={}){const a=i.inputKeys??null,s=e.map(u=>CC(a?a.reduce((c,d)=>({...c,[d]:u[d]}),{}):u).join(" ")),o=await r.fromTexts(s,e,t,i);return new EO({vectorStore:o,k:i.k??4,exampleKeys:i.exampleKeys,inputKeys:i.inputKeys})}}const CAe=Object.freeze(Object.defineProperty({__proto__:null,BaseExampleSelector:bO,BasePromptSelector:rH,ConditionalPromptSelector:SAe,LengthBasedExampleSelector:wO,SemanticSimilarityExampleSelector:EO,isChatModel:AAe,isLLM:TAe},Symbol.toStringTag,{value:"Module"}));class xAe{}const iH=(n,e)=>{if(e!==void 0)return n[e];const t=Object.keys(n);if(t.length===1)return n[t[0]]},RAe=(n,e)=>{const t=iH(n,e);if(!t){const r=Object.keys(n);throw new Error(`input values have ${r.length} keys, you must specify an input key or pass only 1 key as input`)}return t},IAe=(n,e)=>{const t=iH(n,e);if(!t&&t!==""){const r=Object.keys(n);throw new Error(`output values have ${r.length} keys, you must specify an output key or pass only 1 key as output`)}return t};function PAe(n,e){const t=Object.keys(n).filter(r=>!e.includes(r)&&r!=="stop");if(t.length!==1)throw new Error(`One input key expected, but got ${t.length}`);return t[0]}const OAe=Object.freeze(Object.defineProperty({__proto__:null,BaseMemory:xAe,getInputValue:RAe,getOutputValue:IAe,getPromptInputKey:PAe},Symbol.toStringTag,{value:"Module"})),kAe="modulepreload",NAe=function(n,e){return new URL(n,e).href},p3={},xC=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){let s=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};const o=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),c=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));i=s(t.map(d=>{if(d=NAe(d,r),d in p3)return;p3[d]=!0;const h=d.endsWith(".css"),m=h?'[rel="stylesheet"]':"";if(!!r)for(let w=o.length-1;w>=0;w--){const S=o[w];if(S.href===d&&(!h||S.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${m}`))return;const _=document.createElement("link");if(_.rel=h?"stylesheet":kAe,h||(_.as="script"),_.crossOrigin="",_.href=d,c&&_.setAttribute("nonce",c),document.head.appendChild(_),h)return new Promise((w,S)=>{_.addEventListener("load",w),_.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${d}`)))})}))}function a(s){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s}return i.then(s=>{for(const o of s||[])o.status==="rejected"&&a(o.reason);return e().catch(a)})};class vg extends Gt{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const t=this.partialVariables??{},r={};for(const[a,s]of Object.entries(t))typeof s=="string"?r[a]=s:r[a]=await s();return{...r,...e}}async invoke(e,t){const r={...this.metadata,...t==null?void 0:t.metadata},i=[...this.tags??[],...(t==null?void 0:t.tags)??[]];return this._callWithConfig(a=>this.formatPromptValue(a),e,{...t,tags:i,metadata:r,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:t}=await xC(async()=>{const{PromptTemplate:r}=await Promise.resolve().then(()=>y3);return{PromptTemplate:r}},void 0,import.meta.url);return t.deserialize(e)}case void 0:{const{PromptTemplate:t}=await xC(async()=>{const{PromptTemplate:r}=await Promise.resolve().then(()=>y3);return{PromptTemplate:r}},void 0,import.meta.url);return t.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:t}=await xC(async()=>{const{FewShotPromptTemplate:r}=await Promise.resolve().then(()=>nCe);return{FewShotPromptTemplate:r}},void 0,import.meta.url);return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class Im extends vg{async formatPromptValue(e){const t=await this.format(e);return new NI(t)}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var MAe=Object.prototype.toString,Zd=Array.isArray||function(e){return MAe.call(e)==="[object Array]"};function SO(n){return typeof n=="function"}function DAe(n){return Zd(n)?"array":typeof n}function RC(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function m3(n,e){return n!=null&&typeof n=="object"&&e in n}function $Ae(n,e){return n!=null&&typeof n!="object"&&n.hasOwnProperty&&n.hasOwnProperty(e)}var LAe=RegExp.prototype.test;function UAe(n,e){return LAe.call(n,e)}var jAe=/\S/;function FAe(n){return!UAe(jAe,n)}var BAe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function qAe(n){return String(n).replace(/[&<>"'`=\/]/g,function(t){return BAe[t]})}var VAe=/\s*/,zAe=/\s+/,g3=/\s*=/,HAe=/\s*\}/,GAe=/#|\^|\/|>|\{|&|=|!/;function WAe(n,e){if(!n)return[];var t=!1,r=[],i=[],a=[],s=!1,o=!1,u="",c=0;function d(){if(s&&!o)for(;a.length;)delete i[a.pop()];else a=[];s=!1,o=!1}var h,m,g;function _(k){if(typeof k=="string"&&(k=k.split(zAe,2)),!Zd(k)||k.length!==2)throw new Error("Invalid tags: "+k);h=new RegExp(RC(k[0])+"\\s*"),m=new RegExp("\\s*"+RC(k[1])),g=new RegExp("\\s*"+RC("}"+k[1]))}_(e||Ji.tags);for(var w=new _g(n),S,E,C,A,R,P;!w.eos();){if(S=w.pos,C=w.scanUntil(h),C)for(var N=0,U=C.length;N<U;++N)A=C.charAt(N),FAe(A)?(a.push(i.length),u+=A):(o=!0,t=!0,u+=" "),i.push(["text",A,S,S+1]),S+=1,A===`
`&&(d(),u="",c=0,t=!1);if(!w.scan(h))break;if(s=!0,E=w.scan(GAe)||"name",w.scan(VAe),E==="="?(C=w.scanUntil(g3),w.scan(g3),w.scanUntil(m)):E==="{"?(C=w.scanUntil(g),w.scan(HAe),w.scanUntil(m),E="&"):C=w.scanUntil(m),!w.scan(m))throw new Error("Unclosed tag at "+w.pos);if(E==">"?R=[E,C,S,w.pos,u,c,t]:R=[E,C,S,w.pos],c++,i.push(R),E==="#"||E==="^")r.push(R);else if(E==="/"){if(P=r.pop(),!P)throw new Error('Unopened section "'+C+'" at '+S);if(P[1]!==C)throw new Error('Unclosed section "'+P[1]+'" at '+S)}else E==="name"||E==="{"||E==="&"?o=!0:E==="="&&_(C)}if(d(),P=r.pop(),P)throw new Error('Unclosed section "'+P[1]+'" at '+w.pos);return JAe(KAe(i))}function KAe(n){for(var e=[],t,r,i=0,a=n.length;i<a;++i)t=n[i],t&&(t[0]==="text"&&r&&r[0]==="text"?(r[1]+=t[1],r[3]=t[3]):(e.push(t),r=t));return e}function JAe(n){for(var e=[],t=e,r=[],i,a,s=0,o=n.length;s<o;++s)switch(i=n[s],i[0]){case"#":case"^":t.push(i),r.push(i),t=i[4]=[];break;case"/":a=r.pop(),a[5]=i[2],t=r.length>0?r[r.length-1][4]:e;break;default:t.push(i)}return e}function _g(n){this.string=n,this.tail=n,this.pos=0}_g.prototype.eos=function(){return this.tail===""};_g.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r};_g.prototype.scanUntil=function(e){var t=this.tail.search(e),r;switch(t){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=r.length,r};function kd(n,e){this.view=n,this.cache={".":this.view},this.parent=e}kd.prototype.push=function(e){return new kd(e,this)};kd.prototype.lookup=function(e){var t=this.cache,r;if(t.hasOwnProperty(e))r=t[e];else{for(var i=this,a,s,o,u=!1;i;){if(e.indexOf(".")>0)for(a=i.view,s=e.split("."),o=0;a!=null&&o<s.length;)o===s.length-1&&(u=m3(a,s[o])||$Ae(a,s[o])),a=a[s[o++]];else a=i.view[e],u=m3(i.view,e);if(u){r=a;break}i=i.parent}t[e]=r}return SO(r)&&(r=r.call(this.view)),r};function Ti(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}Ti.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};Ti.prototype.parse=function(e,t){var r=this.templateCache,i=e+":"+(t||Ji.tags).join(":"),a=typeof r<"u",s=a?r.get(i):void 0;return s==null&&(s=WAe(e,t),a&&r.set(i,s)),s};Ti.prototype.render=function(e,t,r,i){var a=this.getConfigTags(i),s=this.parse(e,a),o=t instanceof kd?t:new kd(t,void 0);return this.renderTokens(s,o,r,e,i)};Ti.prototype.renderTokens=function(e,t,r,i,a){for(var s="",o,u,c,d=0,h=e.length;d<h;++d)c=void 0,o=e[d],u=o[0],u==="#"?c=this.renderSection(o,t,r,i,a):u==="^"?c=this.renderInverted(o,t,r,i,a):u===">"?c=this.renderPartial(o,t,r,a):u==="&"?c=this.unescapedValue(o,t):u==="name"?c=this.escapedValue(o,t,a):u==="text"&&(c=this.rawValue(o)),c!==void 0&&(s+=c);return s};Ti.prototype.renderSection=function(e,t,r,i,a){var s=this,o="",u=t.lookup(e[1]);function c(m){return s.render(m,t,r,a)}if(u){if(Zd(u))for(var d=0,h=u.length;d<h;++d)o+=this.renderTokens(e[4],t.push(u[d]),r,i,a);else if(typeof u=="object"||typeof u=="string"||typeof u=="number")o+=this.renderTokens(e[4],t.push(u),r,i,a);else if(SO(u)){if(typeof i!="string")throw new Error("Cannot use higher-order sections without the original template");u=u.call(t.view,i.slice(e[3],e[5]),c),u!=null&&(o+=u)}else o+=this.renderTokens(e[4],t,r,i,a);return o}};Ti.prototype.renderInverted=function(e,t,r,i,a){var s=t.lookup(e[1]);if(!s||Zd(s)&&s.length===0)return this.renderTokens(e[4],t,r,i,a)};Ti.prototype.indentPartial=function(e,t,r){for(var i=t.replace(/[^ \t]/g,""),a=e.split(`
`),s=0;s<a.length;s++)a[s].length&&(s>0||!r)&&(a[s]=i+a[s]);return a.join(`
`)};Ti.prototype.renderPartial=function(e,t,r,i){if(r){var a=this.getConfigTags(i),s=SO(r)?r(e[1]):r[e[1]];if(s!=null){var o=e[6],u=e[5],c=e[4],d=s;u==0&&c&&(d=this.indentPartial(s,c,o));var h=this.parse(d,a);return this.renderTokens(h,t,r,d,i)}}};Ti.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(r!=null)return r};Ti.prototype.escapedValue=function(e,t,r){var i=this.getConfigEscape(r)||Ji.escape,a=t.lookup(e[1]);if(a!=null)return typeof a=="number"&&i===Ji.escape?String(a):i(a)};Ti.prototype.rawValue=function(e){return e[1]};Ti.prototype.getConfigTags=function(e){return Zd(e)?e:e&&typeof e=="object"?e.tags:void 0};Ti.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!Zd(e))return e.escape};var Ji={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(n){Pm.templateCache=n},get templateCache(){return Pm.templateCache}},Pm=new Ti;Ji.clearCache=function(){return Pm.clearCache()};Ji.parse=function(e,t){return Pm.parse(e,t)};Ji.render=function(e,t,r,i){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+DAe(e)+'" was given as the first argument for mustache#render(template, view, partials)');return Pm.render(e,t,r,i)};Ji.escape=qAe;Ji.Scanner=_g;Ji.Context=kd;Ji.Writer=Ti;function aH(){Ji.escape=n=>n}const Om=n=>{const e=n.split(""),t=[],r=(a,s)=>{for(let o=s;o<e.length;o+=1)if(a.includes(e[o]))return o;return-1};let i=0;for(;i<e.length;)if(e[i]==="{"&&i+1<e.length&&e[i+1]==="{")t.push({type:"literal",text:"{"}),i+=2;else if(e[i]==="}"&&i+1<e.length&&e[i+1]==="}")t.push({type:"literal",text:"}"}),i+=2;else if(e[i]==="{"){const a=r("}",i);if(a<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(i+1,a).join("")}),i=a+1}else{if(e[i]==="}")throw new Error("Single '}' in template.");{const a=r("{}",i),s=(a<0?e.slice(i):e.slice(i,a)).join("");t.push({type:"literal",text:s}),i=a<0?e.length:a}}return t},YAe=n=>n.map(e=>e[0]==="name"?{type:"variable",name:e[1].includes(".")?e[1].split(".")[0]:e[1]}:["#","&","^",">"].includes(e[0])?{type:"variable",name:e[1]}:{type:"literal",text:e[1]}),fb=n=>{aH();const e=Ji.parse(n);return YAe(e)},sH=(n,e)=>Om(n).reduce((t,r)=>{if(r.type==="variable"){if(r.name in e){const i=typeof e[r.name]=="string"?e[r.name]:JSON.stringify(e[r.name]);return t+i}throw new Error(`(f-string) Missing value for input ${r.name}`)}return t+r.text},""),oH=(n,e)=>(aH(),Ji.render(n,e)),db={"f-string":sH,mustache:oH},lH={"f-string":Om,mustache:fb},Ss=(n,e,t)=>{try{return db[e](n,t)}catch(r){throw Cb(r,"INVALID_PROMPT_INPUT")}},hb=(n,e)=>lH[e](n),bg=(n,e,t)=>{if(!(e in db)){const r=Object.keys(db);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${r}`)}try{const r=t.reduce((i,a)=>(i[a]="foo",i),{});Array.isArray(n)?n.forEach(i=>{if(i.type==="text")Ss(i.text,e,r);else if(i.type==="image_url")if(typeof i.image_url=="string")Ss(i.image_url,e,r);else{const a=i.image_url.url;Ss(a,e,r)}else throw new Error(`Invalid message template received. ${JSON.stringify(i,null,2)}`)}):Ss(n,e,r)}catch(r){throw new Error(`Invalid prompt schema: ${r.message}`)}};class ji extends Im{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){if(this.templateFormat==="mustache")throw new Error("Mustache templates cannot be validated.");let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),bg(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}async format(e){const t=await this.mergePartialAndUserVariables(e);return Ss(this.template,this.templateFormat,t)}static fromExamples(e,t,r,i=`

`,a=""){const s=[a,...e,t].join(i);return new ji({inputVariables:r,template:s})}static fromTemplate(e,t){const{templateFormat:r="f-string",...i}=t??{},a=new Set;return hb(e,r).forEach(s=>{s.type==="variable"&&a.add(s.name)}),new ji({inputVariables:[...a],templateFormat:r,template:e,...i})}async partial(e){const t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},i={...this,inputVariables:t,partialVariables:r};return new ji(i)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new ji({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}const y3=Object.freeze(Object.defineProperty({__proto__:null,PromptTemplate:ji},Symbol.toStringTag,{value:"Module"}));class _d extends vg{static lc_name(){return"ImagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","image"]}),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.template=e.template,this.templateFormat=e.templateFormat??this.templateFormat,this.validateTemplate=e.validateTemplate??this.validateTemplate,this.additionalContentFields=e.additionalContentFields,this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),bg([{type:"image_url",image_url:this.template}],this.templateFormat,t)}}_getPromptType(){return"prompt"}async partial(e){const t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},i={...this,inputVariables:t,partialVariables:r};return new _d(i)}async format(e){const t={};for(const[s,o]of Object.entries(this.template))typeof o=="string"?t[s]=Ss(o,this.templateFormat,e):t[s]=o;const r=e.url||t.url,i=e.detail||t.detail;if(!r)throw new Error("Must provide either an image URL.");if(typeof r!="string")throw new Error("url must be a string.");const a={url:r};return i&&(a.detail=i),a}async formatPromptValue(e){const t=await this.format(e);return new B5(t)}}class kR extends Gt{static lc_name(){return"DictPromptTemplate"}constructor(e){const t=e.templateFormat??"f-string",r=NR(e.template,t);super({inputVariables:r,...e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","dict"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.template=e.template,this.templateFormat=t,this.inputVariables=r}async format(e){return MR(this.template,e,this.templateFormat)}async invoke(e){return await this._callWithConfig(this.format.bind(this),e,{runType:"prompt"})}}function NR(n,e){const t=[];for(const r of Object.values(n))if(typeof r=="string")hb(r,e).forEach(i=>{i.type==="variable"&&t.push(i.name)});else if(Array.isArray(r))for(const i of r)typeof i=="string"?hb(i,e).forEach(a=>{a.type==="variable"&&t.push(a.name)}):typeof i=="object"&&t.push(...NR(i,e));else typeof r=="object"&&r!==null&&t.push(...NR(r,e));return Array.from(new Set(t))}function MR(n,e,t){const r={};for(const[i,a]of Object.entries(n))if(typeof a=="string")r[i]=Ss(a,t,e);else if(Array.isArray(a)){const s=[];for(const o of a)typeof o=="string"?s.push(Ss(o,t,e)):typeof o=="object"&&s.push(MR(o,e,t));r[i]=s}else typeof a=="object"&&a!==null?r[i]=MR(a,e,t):r[i]=a;return r}class Iw extends Gt{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig(r=>this.formatMessages(r),e,{...t,runType:"prompt"})}}class DR extends Iw{static lc_name(){return"MessagesPlaceholder"}constructor(e){typeof e=="string"&&(e={variableName:e}),super(e),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"optional",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e.variableName,this.optional=e.optional??!1}get inputVariables(){return[this.variableName]}async formatMessages(e){const t=e[this.variableName];if(this.optional&&!t)return[];if(!t){const i=new Error(`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: undefined`);throw i.name="InputFormatError",i}let r;try{Array.isArray(t)?r=t.map(_s):r=[_s(t)]}catch(i){const a=typeof t=="string"?t:JSON.stringify(t,null,2),s=new Error([`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages or coerceable values as input.`,`Received value: ${a}`,`Additional message: ${i.message}`].join(`

`));throw s.name="InputFormatError",s.lc_error_code=i.lc_error_code,s}return r}}class uH extends Iw{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class TO extends vg{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){const t=await this.formatMessages(e);return new MI(t)}}class cH extends uH{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new Xa(await this.prompt.format(e),this.role)}static fromTemplate(e,t,r){return new this(ji.fromTemplate(e,{templateFormat:r==null?void 0:r.templateFormat}),t)}}function ZAe(n){return n===null||typeof n!="object"||Array.isArray(n)?!1:Object.keys(n).length===1&&"text"in n&&typeof n.text=="string"}function XAe(n){return n===null||typeof n!="object"||Array.isArray(n)?!1:"image_url"in n&&(typeof n.image_url=="string"||typeof n.image_url=="object"&&n.image_url!==null&&"url"in n.image_url&&typeof n.image_url.url=="string")}class AO extends Iw{static _messageClass(){throw new Error("Can not invoke _messageClass from inside _StringImageMessagePromptTemplate")}constructor(e,t){if("prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"additionalOptions",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatMessageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,Array.isArray(this.prompt)){let r=[];this.prompt.forEach(i=>{"inputVariables"in i&&(r=r.concat(i.inputVariables))}),this.inputVariables=r}else this.inputVariables=this.prompt.inputVariables;this.additionalOptions=t??this.additionalOptions}createMessage(e){const t=this.constructor;if(t._messageClass()){const r=t._messageClass();return new r({content:e})}else if(t.chatMessageClass){const r=t.chatMessageClass();return new r({content:e,role:this.getRoleFromMessageClass(r.lc_name())})}else throw new Error("No message class defined")}getRoleFromMessageClass(e){switch(e){case"HumanMessage":return"human";case"AIMessage":return"ai";case"SystemMessage":return"system";case"ChatMessage":return"chat";default:throw new Error("Invalid message class name")}}static fromTemplate(e,t){if(typeof e=="string")return new this(ji.fromTemplate(e,t));const r=[];for(const i of e)if(typeof i=="string")r.push(ji.fromTemplate(i,t));else if(i!==null)if(ZAe(i)){let a="";typeof i.text=="string"&&(a=i.text??"");const s={...t,additionalContentFields:i};r.push(ji.fromTemplate(a,s))}else if(XAe(i)){let a=i.image_url??"",s,o=[];if(typeof a=="string"){let u;(t==null?void 0:t.templateFormat)==="mustache"?u=fb(a):u=Om(a);const c=u.flatMap(d=>d.type==="variable"?[d.name]:[]);if(((c==null?void 0:c.length)??0)>0){if(c.length>1)throw new Error(`Only one format variable allowed per image template.
Got: ${c}
From: ${a}`);o=[c[0]]}else o=[];a={url:a},s=new _d({template:a,inputVariables:o,templateFormat:t==null?void 0:t.templateFormat,additionalContentFields:i})}else if(typeof a=="object"){if("url"in a){let u;(t==null?void 0:t.templateFormat)==="mustache"?u=fb(a.url):u=Om(a.url),o=u.flatMap(c=>c.type==="variable"?[c.name]:[])}else o=[];s=new _d({template:a,inputVariables:o,templateFormat:t==null?void 0:t.templateFormat,additionalContentFields:i})}else throw new Error("Invalid image template");r.push(s)}else typeof i=="object"&&r.push(new kR({template:i,templateFormat:t==null?void 0:t.templateFormat}));return new this({prompt:r,additionalOptions:t})}async format(e){if(this.prompt instanceof Im){const t=await this.prompt.format(e);return this.createMessage(t)}else{const t=[];for(const r of this.prompt){let i={};if(!("inputVariables"in r))throw new Error(`Prompt ${r} does not have inputVariables defined.`);for(const a of r.inputVariables)i||(i={[a]:e[a]}),i={...i,[a]:e[a]};if(r instanceof Im){const a=await r.format(i);let s;"additionalContentFields"in r&&(s=r.additionalContentFields),t.push({...s,type:"text",text:a})}else if(r instanceof _d){const a=await r.format(i);let s;"additionalContentFields"in r&&(s=r.additionalContentFields),t.push({...s,type:"image_url",image_url:a})}else if(r instanceof kR){const a=await r.format(i);let s;"additionalContentFields"in r&&(s=r.additionalContentFields),t.push({...s,...a})}}return this.createMessage(t)}}async formatMessages(e){return[await this.format(e)]}}class CO extends AO{static _messageClass(){return oi}static lc_name(){return"HumanMessagePromptTemplate"}}class fH extends AO{static _messageClass(){return Tn}static lc_name(){return"AIMessagePromptTemplate"}}class dH extends AO{static _messageClass(){return Cs}static lc_name(){return"SystemMessagePromptTemplate"}}function QAe(n){return typeof n.formatMessages=="function"}function eCe(n,e){if(QAe(n)||Vn(n))return n;if(Array.isArray(n)&&n[0]==="placeholder"){const i=n[1];if((e==null?void 0:e.templateFormat)==="mustache"&&typeof i=="string"&&i.slice(0,2)==="{{"&&i.slice(-2)==="}}"){const a=i.slice(2,-2);return new DR({variableName:a,optional:!0})}else if(typeof i=="string"&&i[0]==="{"&&i[i.length-1]==="}"){const a=i.slice(1,-1);return new DR({variableName:a,optional:!0})}throw new Error(`Invalid placeholder template for format ${(e==null?void 0:e.templateFormat)??'"f-string"'}: "${n[1]}". Expected a variable name surrounded by ${(e==null?void 0:e.templateFormat)==="mustache"?"double":"single"} curly braces.`)}const t=_s(n);let r;if(typeof t.content=="string"?r=t.content:r=t.content.map(i=>"text"in i?{...i,text:i.text}:"image_url"in i?{...i,image_url:i.image_url}:i),t._getType()==="human")return CO.fromTemplate(r,e);if(t._getType()==="ai")return fH.fromTemplate(r,e);if(t._getType()==="system")return dH.fromTemplate(r,e);if(Xa.isInstance(t))return cH.fromTemplate(t.content,t.role,e);throw new Error(`Could not coerce message prompt template from input. Received message type: "${t._getType()}".`)}function tCe(n){return n.constructor.lc_name()==="MessagesPlaceholder"}class ec extends TO{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){const t=new Set;for(const o of this.promptMessages)if(!(o instanceof Ha))for(const u of o.inputVariables)t.add(u);const r=this.inputVariables,i=new Set(this.partialVariables?r.concat(Object.keys(this.partialVariables)):r),a=new Set([...i].filter(o=>!t.has(o)));if(a.size>0)throw new Error(`Input variables \`${[...a]}\` are not used in any of the prompt messages.`);const s=new Set([...t].filter(o=>!i.has(o)));if(s.size>0)throw new Error(`Input variables \`${[...s]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(e,t){if(typeof e.content=="string")return e;const r=await Promise.all(e.content.map(async i=>{if(i.type!=="image_url")return i;let a="";typeof i.image_url=="string"?a=i.image_url:a=i.image_url.url;const o=await ji.fromTemplate(a,{templateFormat:this.templateFormat}).format(t);return typeof i.image_url!="string"&&"url"in i.image_url?i.image_url.url=o:i.image_url=o,i}));return e.content=r,e}async formatMessages(e){const t=await this.mergePartialAndUserVariables(e);let r=[];for(const i of this.promptMessages)if(i instanceof Ha)r.push(await this._parseImagePrompts(i,t));else{const a=i.inputVariables.reduce((o,u)=>{if(!(u in t)&&!(tCe(i)&&i.optional))throw Cb(new Error(`Missing value for input variable \`${u.toString()}\``),"INVALID_PROMPT_INPUT");return o[u]=t[u],o},{}),s=await i.formatMessages(a);r=r.concat(s)}return r}async partial(e){const t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},i={...this,inputVariables:t,partialVariables:r};return new ec(i)}static fromTemplate(e,t){const r=ji.fromTemplate(e,t),i=new CO({prompt:r});return this.fromMessages([i])}static fromMessages(e,t){const r=e.reduce((s,o)=>s.concat(o instanceof ec?o.promptMessages:[eCe(o,t)]),[]),i=e.reduce((s,o)=>o instanceof ec?Object.assign(s,o.partialVariables):s,Object.create(null)),a=new Set;for(const s of r)if(!(s instanceof Ha))for(const o of s.inputVariables)o in i||a.add(o);return new this({...t,inputVariables:[...a],promptMessages:r,partialVariables:i,templateFormat:t==null?void 0:t.templateFormat})}static fromPromptMessages(e){return this.fromMessages(e)}}class km extends Im{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),bg(this.prefix+this.suffix,this.templateFormat,t)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(e){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){const t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},i={...this,inputVariables:t,partialVariables:r};return new km(i)}async format(e){const t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),i=await Promise.all(r.map(s=>this.examplePrompt.format(s))),a=[this.prefix,...i,this.suffix].join(this.exampleSeparator);return Ss(a,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(this.outputParser!==void 0)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){const{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");const r=await ji.deserialize(t);let i;if(Array.isArray(e.examples))i=e.examples;else throw new Error("Invalid examples format. Only list or string are supported.");return new km({inputVariables:e.input_variables,examplePrompt:r,examples:i,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}class Pw extends TO{_getPromptType(){return"few_shot_chat"}static lc_name(){return"FewShotChatMessagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.examples=e.examples,this.examplePrompt=e.examplePrompt,this.exampleSeparator=e.exampleSeparator??`

`,this.exampleSelector=e.exampleSelector,this.prefix=e.prefix??"",this.suffix=e.suffix??"",this.templateFormat=e.templateFormat??"f-string",this.validateTemplate=e.validateTemplate??!0,this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),bg(this.prefix+this.suffix,this.templateFormat,t)}}async getExamples(e){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async formatMessages(e){const t=await this.mergePartialAndUserVariables(e);let r=await this.getExamples(t);r=r.map(a=>{const s={};return this.examplePrompt.inputVariables.forEach(o=>{s[o]=a[o]}),s});const i=[];for(const a of r){const s=await this.examplePrompt.formatMessages(a);i.push(...s)}return i}async format(e){const t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),a=(await Promise.all(r.map(o=>this.examplePrompt.formatMessages(o)))).flat().map(o=>o.content),s=[this.prefix,...a,this.suffix].join(this.exampleSeparator);return Ss(s,this.templateFormat,t)}async partial(e){const t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},i={...this,inputVariables:t,partialVariables:r};return new Pw(i)}}const nCe=Object.freeze(Object.defineProperty({__proto__:null,FewShotChatMessagePromptTemplate:Pw,FewShotPromptTemplate:km},Symbol.toStringTag,{value:"Module"}));class im extends vg{static lc_name(){return"PipelinePromptTemplate"}constructor(e){super({...e,inputVariables:[]}),Object.defineProperty(this,"pipelinePrompts",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"finalPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pipelinePrompts=e.pipelinePrompts,this.finalPrompt=e.finalPrompt,this.inputVariables=this.computeInputValues()}computeInputValues(){const e=this.pipelinePrompts.map(r=>r.name),t=this.pipelinePrompts.map(r=>r.prompt.inputVariables.filter(i=>!e.includes(i))).flat();return[...new Set(t)]}static extractRequiredInputValues(e,t){return t.reduce((r,i)=>(r[i]=e[i],r),{})}async formatPipelinePrompts(e){const t=await this.mergePartialAndUserVariables(e);for(const{name:r,prompt:i}of this.pipelinePrompts){const a=im.extractRequiredInputValues(t,i.inputVariables);i instanceof ec?t[r]=await i.formatMessages(a):t[r]=await i.format(a)}return im.extractRequiredInputValues(t,this.finalPrompt.inputVariables)}async formatPromptValue(e){return this.finalPrompt.formatPromptValue(await this.formatPipelinePrompts(e))}async format(e){return this.finalPrompt.format(await this.formatPipelinePrompts(e))}async partial(e){const t={...this};return t.inputVariables=this.inputVariables.filter(r=>!(r in e)),t.partialVariables={...this.partialVariables??{},...e},new im(t)}serialize(){throw new Error("Not implemented.")}_getPromptType(){return"pipeline"}}function v3(n){return typeof n=="object"&&n!=null&&"withStructuredOutput"in n&&typeof n.withStructuredOutput=="function"}function rCe(n){return typeof n=="object"&&n!=null&&"lc_id"in n&&Array.isArray(n.lc_id)&&n.lc_id.join("/")==="langchain_core/runnables/RunnableBinding"}class xO extends ec{get lc_aliases(){return{...super.lc_aliases,schema:"schema_"}}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"method",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","structured"]}),this.schema=e.schema,this.method=e.method}pipe(e){if(v3(e))return super.pipe(e.withStructuredOutput(this.schema));if(rCe(e)&&v3(e.bound))return super.pipe(new bi({bound:e.bound.withStructuredOutput(this.schema,...this.method?[{method:this.method}]:[]),kwargs:e.kwargs??{},config:e.config,configFactories:e.configFactories}));throw new Error('Structured prompts need to be piped to a language model that supports the "withStructuredOutput()" method.')}static fromMessagesAndSchema(e,t,r){return xO.fromMessages(e,{schema:t,method:r})}}const iCe=Object.freeze(Object.defineProperty({__proto__:null,AIMessagePromptTemplate:fH,BaseChatPromptTemplate:TO,BaseMessagePromptTemplate:Iw,BaseMessageStringPromptTemplate:uH,BasePromptTemplate:vg,BaseStringPromptTemplate:Im,ChatMessagePromptTemplate:cH,ChatPromptTemplate:ec,DEFAULT_FORMATTER_MAPPING:db,DEFAULT_PARSER_MAPPING:lH,DictPromptTemplate:kR,FewShotChatMessagePromptTemplate:Pw,FewShotPromptTemplate:km,HumanMessagePromptTemplate:CO,ImagePromptTemplate:_d,MessagesPlaceholder:DR,PipelinePromptTemplate:im,PromptTemplate:ji,StructuredPrompt:xO,SystemMessagePromptTemplate:dH,checkValidTemplate:bg,interpolateFString:sH,interpolateMustache:oH,parseFString:Om,parseMustache:fb,parseTemplate:hb,renderTemplate:Ss},Symbol.toStringTag,{value:"Module"}));class RO extends Gt{constructor(e){super(e),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callbacks=e==null?void 0:e.callbacks,this.tags=(e==null?void 0:e.tags)??[],this.metadata=(e==null?void 0:e.metadata)??{},this.verbose=(e==null?void 0:e.verbose)??!1}_getRelevantDocuments(e,t){throw new Error("Not implemented!")}async invoke(e,t){return this.getRelevantDocuments(e,Qt(t))}async getRelevantDocuments(e,t){const r=Qt(Vm(t)),i=await tr.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),a=await(i==null?void 0:i.handleRetrieverStart(this.toJSON(),e,r.runId,void 0,void 0,void 0,r.runName));try{const s=await this._getRelevantDocuments(e,a);return await(a==null?void 0:a.handleRetrieverEnd(s)),s}catch(s){throw await(a==null?void 0:a.handleRetrieverError(s)),s}}}const aCe=Object.freeze(Object.defineProperty({__proto__:null,BaseRetriever:RO},Symbol.toStringTag,{value:"Module"}));let hH=class extends wa{};class sCe extends hH{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","storage"]}),Object.defineProperty(this,"store",{enumerable:!0,configurable:!0,writable:!0,value:{}})}async mget(e){return e.map(t=>this.store[t])}async mset(e){for(const[t,r]of e)this.store[t]=r}async mdelete(e){for(const t of e)delete this.store[t]}async*yieldKeys(e){const t=Object.keys(this.store);for(const r of t)(e===void 0||r.startsWith(e))&&(yield r)}}const oCe=Object.freeze(Object.defineProperty({__proto__:null,BaseStore:hH,InMemoryStore:sCe},Symbol.toStringTag,{value:"Module"}));class pH extends po{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:zi("LANGCHAIN_ENDPOINT")||"http://localhost:1984"}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{"Content-Type":"application/json"}}),Object.defineProperty(this,"session",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const e=zi("LANGCHAIN_API_KEY");e&&(this.headers["x-api-key"]=e)}async newSession(e){const t={start_time:Date.now(),name:e},r=await this.persistSession(t);return this.session=r,r}async loadSession(e){const t=`${this.endpoint}/sessions?name=${e}`;return this._handleSessionResponse(t)}async loadDefaultSession(){const e=`${this.endpoint}/sessions?name=default`;return this._handleSessionResponse(e)}async convertV2RunToRun(e){var a;const t=this.session??await this.loadDefaultSession(),r=e.serialized;let i;if(e.run_type==="llm"){const s=e.inputs.prompts?e.inputs.prompts:e.inputs.messages.map(u=>Bm(u));i={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,prompts:s,response:e.outputs}}else if(e.run_type==="chain"){const s=await Promise.all(e.child_runs.map(u=>this.convertV2RunToRun(u)));i={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,inputs:e.inputs,outputs:e.outputs,child_llm_runs:s.filter(u=>u.type==="llm"),child_chain_runs:s.filter(u=>u.type==="chain"),child_tool_runs:s.filter(u=>u.type==="tool")}}else if(e.run_type==="tool"){const s=await Promise.all(e.child_runs.map(u=>this.convertV2RunToRun(u)));i={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,tool_input:e.inputs.input,output:(a=e.outputs)==null?void 0:a.output,action:JSON.stringify(r),child_llm_runs:s.filter(u=>u.type==="llm"),child_chain_runs:s.filter(u=>u.type==="chain"),child_tool_runs:s.filter(u=>u.type==="tool")}}else throw new Error(`Unknown run type: ${e.run_type}`);return i}async persistRun(e){let t,r;e.run_type!==void 0?r=await this.convertV2RunToRun(e):r=e,r.type==="llm"?t=`${this.endpoint}/llm-runs`:r.type==="chain"?t=`${this.endpoint}/chain-runs`:t=`${this.endpoint}/tool-runs`;const i=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(r)});i.ok||console.error(`Failed to persist run: ${i.status} ${i.statusText}`)}async persistSession(e){const t=`${this.endpoint}/sessions`,r=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(e)});return r.ok?{id:(await r.json()).id,...e}:(console.error(`Failed to persist session: ${r.status} ${r.statusText}, using default session.`),{id:1,...e})}async _handleSessionResponse(e){const t=await fetch(e,{method:"GET",headers:this.headers});let r;if(!t.ok)return console.error(`Failed to load session: ${t.status} ${t.statusText}`),r={id:1,start_time:Date.now()},this.session=r,r;const i=await t.json();return i.length===0?(r={id:1,start_time:Date.now()},this.session=r,r):([r]=i,this.session=r,r)}}const lCe=Object.freeze(Object.defineProperty({__proto__:null,LangChainTracerV1:pH},Symbol.toStringTag,{value:"Module"}));async function uCe(n){const e=new pH;return n?await e.loadSession(n):await e.loadDefaultSession(),e}async function cCe(){return new Jl}const fCe=Object.freeze(Object.defineProperty({__proto__:null,getTracingCallbackHandler:uCe,getTracingV2CallbackHandler:cCe},Symbol.toStringTag,{value:"Module"}));class dCe extends po{constructor({exampleId:e}={}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"run_collector"}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracedRuns",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.exampleId=e,this.tracedRuns=[]}async persistRun(e){const t={...e};t.reference_example_id=this.exampleId,this.tracedRuns.push(t)}}const hCe=Object.freeze(Object.defineProperty({__proto__:null,RunCollectorCallbackHandler:dCe},Symbol.toStringTag,{value:"Module"}));function mH(n,e){let t=0,r=0,i=0;for(let a=0;a<n.length;a++)t+=n[a]*e[a],r+=n[a]*n[a],i+=e[a]*e[a];return t/(Math.sqrt(r)*Math.sqrt(i))}function pCe(n,e){let t=0;for(let r=0;r<n.length;r++)t+=n[r]*e[r];return t}function mCe(n,e){let t=0;for(let r=0;r<n.length;r++)t+=(n[r]-e[r])*(n[r]-e[r]);return t}function gCe(n,e){return Math.sqrt(mCe(n,e))}function Ow(n,e,t){if(n.length===0||n[0].length===0||e.length===0||e[0].length===0)return[[]];if(n[0].length!==e[0].length)throw new Error(`Number of columns in X and Y must be the same. X has shape ${[n.length,n[0].length]} and Y has shape ${[e.length,e[0].length]}.`);return n.map(r=>e.map(i=>t(r,i)).map(i=>Number.isNaN(i)?0:i))}function yCe(n,e=!1){const t=wCe(n);return n.map(r=>r.map(i=>e?1-i/t:i/t))}function $R(n,e){return Ow(n,e,mH)}function vCe(n,e){return Ow(n,e,pCe)}function _Ce(n,e){return Ow(n,e,gCe)}function bCe(n,e,t=.5,r=4){if(Math.min(r,e.length)<=0)return[];const i=Array.isArray(n[0])?n:[n],a=$R(i,e)[0],s=gH(a).maxIndex,o=[e[s]],u=[s];for(;u.length<Math.min(r,e.length);){let c=-1/0,d=-1;const h=$R(e,o);a.forEach((m,g)=>{if(u.includes(g))return;const _=Math.max(...h[g]),w=t*m-(1-t)*_;w>c&&(c=w,d=g)}),o.push(e[d]),u.push(d)}return u}function gH(n){if(n.length===0)return{maxIndex:-1,maxValue:NaN};let e=n[0],t=0;for(let r=1;r<n.length;r+=1)n[r]>e&&(t=r,e=n[r]);return{maxIndex:t,maxValue:e}}function wCe(n){return n.reduce((e,t)=>Math.max(e,gH(t).maxValue),0)}const ECe=Object.freeze(Object.defineProperty({__proto__:null,cosineSimilarity:$R,euclideanDistance:_Ce,innerProduct:vCe,matrixFunc:Ow,maximalMarginalRelevance:bCe,normalize:yCe},Symbol.toStringTag,{value:"Module"}));class i_ extends RO{static lc_name(){return"VectorStoreRetriever"}get lc_namespace(){return["langchain_core","vectorstores"]}_vectorstoreType(){return this.vectorStore._vectorstoreType()}constructor(e){super(e),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"searchType",{enumerable:!0,configurable:!0,writable:!0,value:"similarity"}),Object.defineProperty(this,"searchKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.searchType=e.searchType??this.searchType,this.filter=e.filter,e.searchType==="mmr"&&(this.searchKwargs=e.searchKwargs)}async _getRelevantDocuments(e,t){if(this.searchType==="mmr"){if(typeof this.vectorStore.maxMarginalRelevanceSearch!="function")throw new Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);return this.vectorStore.maxMarginalRelevanceSearch(e,{k:this.k,filter:this.filter,...this.searchKwargs},t==null?void 0:t.getChild("vectorstore"))}return this.vectorStore.similaritySearch(e,this.k,this.filter,t==null?void 0:t.getChild("vectorstore"))}async addDocuments(e,t){return this.vectorStore.addDocuments(e,t)}}class IO extends wa{constructor(e,t){super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","vectorstores",this._vectorstoreType()]}),Object.defineProperty(this,"embeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.embeddings=e}async delete(e){throw new Error("Not implemented.")}async similaritySearch(e,t=4,r=void 0,i=void 0){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)).map(s=>s[0])}async similaritySearchWithScore(e,t=4,r=void 0,i=void 0){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)}static fromTexts(e,t,r,i){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,t,r){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,t,r,i,a,s){if(typeof e=="number")return new i_({vectorStore:this,k:e,filter:t,tags:[...i??[],this._vectorstoreType()],metadata:a,verbose:s,callbacks:r});{const o={vectorStore:this,k:e==null?void 0:e.k,filter:e==null?void 0:e.filter,tags:[...(e==null?void 0:e.tags)??[],this._vectorstoreType()],metadata:e==null?void 0:e.metadata,verbose:e==null?void 0:e.verbose,callbacks:e==null?void 0:e.callbacks,searchType:e==null?void 0:e.searchType};return(e==null?void 0:e.searchType)==="mmr"?new i_({...o,searchKwargs:e.searchKwargs}):new i_({...o})}}}class SCe extends IO{static load(e,t){throw new Error("Not implemented")}}const TCe=Object.freeze(Object.defineProperty({__proto__:null,SaveableVectorStore:SCe,VectorStore:IO,VectorStoreRetriever:i_},Symbol.toStringTag,{value:"Module"}));class ACe extends ng{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["tests","fake"]})}getFormatInstructions(){return""}async parse(e){return e.split(",").map(t=>t.trim())}}class CCe extends Gt{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["tests","fake"]}),Object.defineProperty(this,"returnOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.returnOptions=e.returnOptions}async invoke(e,t){return this.returnOptions?t??{}:{input:e}}}class xCe extends PP{constructor(e){super(e),Object.defineProperty(this,"response",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"thrownErrorString",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.response=e.response,this.thrownErrorString=e.thrownErrorString}_llmType(){return"fake"}async _call(e,t,r){if(this.thrownErrorString)throw new Error(this.thrownErrorString);const i=this.response??e;return await(r==null?void 0:r.handleLLMNewToken(i)),i}}class RCe extends PP{constructor(e){super(e),Object.defineProperty(this,"sleep",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"responses",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"thrownErrorString",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.sleep=e.sleep??this.sleep,this.responses=e.responses,this.thrownErrorString=e.thrownErrorString}_llmType(){return"fake"}async _call(e){var r,i;if(this.thrownErrorString)throw new Error(this.thrownErrorString);const t=(r=this.responses)==null?void 0:r[0];return this.responses=(i=this.responses)==null?void 0:i.slice(1),t??e}async*_streamResponseChunks(e,t,r){var a,s;if(this.thrownErrorString)throw new Error(this.thrownErrorString);const i=(a=this.responses)==null?void 0:a[0];this.responses=(s=this.responses)==null?void 0:s.slice(1);for(const o of i??e)await new Promise(u=>setTimeout(u,this.sleep)),yield{text:o,generationInfo:{}},await(r==null?void 0:r.handleLLMNewToken(o))}}class ICe extends yi{_combineLLMOutput(){return[]}_llmType(){return"fake"}async _generate(e,t,r){var a;if((a=t==null?void 0:t.stop)!=null&&a.length)return{generations:[{message:new Tn(t.stop[0]),text:t.stop[0]}]};const i=e.map(s=>typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2)).join(`
`);return await(r==null?void 0:r.handleLLMNewToken(i)),{generations:[{message:new Tn(i),text:i}],llmOutput:{}}}}class PO extends yi{constructor({sleep:e=50,responses:t=[],chunks:r=[],toolStyle:i="openai",thrownErrorString:a,...s}){super(s),Object.defineProperty(this,"sleep",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"responses",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"toolStyle",{enumerable:!0,configurable:!0,writable:!0,value:"openai"}),Object.defineProperty(this,"thrownErrorString",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.sleep=e,this.responses=t,this.chunks=r,this.toolStyle=i,this.thrownErrorString=a}_llmType(){return"fake"}bindTools(e){const t=[...this.tools,...e],r=t.map(s=>{switch(this.toolStyle){case"openai":return{type:"function",function:{name:s.name,description:s.description,parameters:Tr(s.schema)}};case"anthropic":return{name:s.name,description:s.description,input_schema:Tr(s.schema)};case"bedrock":return{toolSpec:{name:s.name,description:s.description,inputSchema:Tr(s.schema)}};case"google":return{name:s.name,description:s.description,parameters:Tr(s.schema)};default:throw new Error(`Unsupported tool style: ${this.toolStyle}`)}}),i=this.toolStyle==="google"?[{functionDeclarations:r}]:r,a=new PO({sleep:this.sleep,responses:this.responses,chunks:this.chunks,toolStyle:this.toolStyle,thrownErrorString:this.thrownErrorString});return a.tools=t,a.withConfig({tools:i})}async _generate(e,t,r){var s,o,u,c;if(this.thrownErrorString)throw new Error(this.thrownErrorString);const i=((o=(s=this.responses)==null?void 0:s[0])==null?void 0:o.content)??e[0].content??"";return{generations:[{text:"",message:new Tn({content:i,tool_calls:(c=(u=this.chunks)==null?void 0:u[0])==null?void 0:c.tool_calls})}]}}async*_streamResponseChunks(e,t,r){var s,o,u;if(this.thrownErrorString)throw new Error(this.thrownErrorString);if((s=this.chunks)!=null&&s.length){for(const c of this.chunks){const d=new Sa({message:new xn({content:c.content,tool_calls:c.tool_calls,additional_kwargs:c.additional_kwargs??{}}),text:((o=c.content)==null?void 0:o.toString())??""});yield d,await(r==null?void 0:r.handleLLMNewToken(c.content,void 0,void 0,void 0,void 0,{chunk:d}))}return}const i=((u=this.responses)==null?void 0:u[0])??new Tn(typeof e[0].content=="string"?e[0].content:""),a=typeof i.content=="string"?i.content:"";for(const c of a){await new Promise(h=>setTimeout(h,this.sleep));const d=new Sa({message:new xn({content:c}),text:c});yield d,await(r==null?void 0:r.handleLLMNewToken(c,void 0,void 0,void 0,void 0,{chunk:d}))}}}class PCe extends RO{constructor(e){super(),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["test","fake"]}),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:[new Qu({pageContent:"foo"}),new Qu({pageContent:"bar"})]}),this.output=(e==null?void 0:e.output)??this.output}async _getRelevantDocuments(e){return this.output}}class OCe extends yi{static lc_name(){return"FakeListChatModel"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"responses",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"i",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"sleep",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"emitCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1});const{responses:t,sleep:r,emitCustomEvent:i}=e;this.responses=t,this.sleep=r,this.emitCustomEvent=i??this.emitCustomEvent}_combineLLMOutput(){return[]}_llmType(){return"fake-list"}async _generate(e,t,r){var i;if(await this._sleepIfRequested(),t!=null&&t.thrownErrorString)throw new Error(t.thrownErrorString);if(this.emitCustomEvent&&await(r==null?void 0:r.handleCustomEvent("some_test_event",{someval:!0})),(i=t==null?void 0:t.stop)!=null&&i.length)return{generations:[this._formatGeneration(t.stop[0])]};{const a=this._currentResponse();return this._incrementResponse(),{generations:[this._formatGeneration(a)],llmOutput:{}}}}_formatGeneration(e){return{message:new Tn(e),text:e}}async*_streamResponseChunks(e,t,r){const i=this._currentResponse();this._incrementResponse(),this.emitCustomEvent&&await(r==null?void 0:r.handleCustomEvent("some_test_event",{someval:!0}));for await(const a of i){if(await this._sleepIfRequested(),t!=null&&t.thrownErrorString)throw new Error(t.thrownErrorString);yield this._createResponseChunk(a),r==null||r.handleLLMNewToken(a)}}async _sleepIfRequested(){this.sleep!==void 0&&await this._sleep()}async _sleep(){return new Promise(e=>{setTimeout(()=>e(),this.sleep)})}_createResponseChunk(e){return new Sa({message:new xn({content:e}),text:e})}_currentResponse(){return this.responses[this.i]}_incrementResponse(){this.i<this.responses.length-1?this.i+=1:this.i=0}withStructuredOutput(e,t){return Cr.from(async r=>{var a,s;const i=await this.invoke(r);if((s=(a=i.tool_calls)==null?void 0:a[0])!=null&&s.args)return i.tool_calls[0].args;if(typeof i.content=="string")return JSON.parse(i.content);throw new Error("No structured output found")})}}class kCe extends tH{constructor(){super(),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","message","fake"]}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:[]})}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async addUserMessage(e){this.messages.push(new oi(e))}async addAIChatMessage(e){this.messages.push(new Tn(e))}async clear(){this.messages=[]}}class NCe extends _O{constructor(){super(),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","message","fake"]}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:[]})}async addMessage(e){this.messages.push(e)}async getMessages(){return this.messages}}class MCe extends po{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"fake_tracer"}),Object.defineProperty(this,"runs",{enumerable:!0,configurable:!0,writable:!0,value:[]})}persistRun(e){return this.runs.push(e),Promise.resolve()}}class DCe extends qb{constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}async _call(e,t){return JSON.stringify(e)}}class $Ce extends OP{constructor(e){super(e??{})}embedDocuments(e){return Promise.resolve(e.map(()=>[.1,.2,.3,.4]))}embedQuery(e){return Promise.resolve([.1,.2,.3,.4])}}class LCe extends OP{constructor(e){super(e??{}),Object.defineProperty(this,"vectorSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorSize=(e==null?void 0:e.vectorSize)??4}async embedDocuments(e){return Promise.all(e.map(t=>this.embedQuery(t)))}async embedQuery(e){let t=e;t=t.toLowerCase().replaceAll(/[^a-z ]/g,"");const r=t.length%this.vectorSize,i=r===0?0:this.vectorSize-r,a=t.length+i;t=t.padEnd(a," ");const s=t.length/this.vectorSize,o=[];for(let c=0;c<t.length;c+=s)o.push(t.slice(c,c+s));return o.map(c=>{let d=0;for(let m=0;m<c.length;m+=1)d+=c===" "?0:c.charCodeAt(m);return d%26/26})}}class UCe extends po{constructor(){super(),Object.defineProperty(this,"runPromiseResolver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"single_run_extractor"}),this.runPromise=new Promise(e=>{this.runPromiseResolver=e})}async persistRun(e){this.runPromiseResolver(e)}async extract(){return this.runPromise}}class OO extends IO{_vectorstoreType(){return"memory"}constructor(e,{similarity:t,...r}={}){super(e,r),Object.defineProperty(this,"memoryVectors",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"similarity",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.similarity=t??mH}async addDocuments(e){const t=e.map(({pageContent:r})=>r);return this.addVectors(await this.embeddings.embedDocuments(t),e)}async addVectors(e,t){const r=e.map((i,a)=>({content:t[a].pageContent,embedding:i,metadata:t[a].metadata}));this.memoryVectors=this.memoryVectors.concat(r)}async similaritySearchVectorWithScore(e,t,r){const i=u=>{if(!r)return!0;const c=new Qu({metadata:u.metadata,pageContent:u.content});return r(c)},a=this.memoryVectors.filter(i);return a.map((u,c)=>({similarity:this.similarity(e,u.embedding),index:c})).sort((u,c)=>u.similarity>c.similarity?-1:0).slice(0,t).map(u=>[new Qu({metadata:a[u.index].metadata,pageContent:a[u.index].content}),u.similarity])}static async fromTexts(e,t,r,i){const a=[];for(let s=0;s<e.length;s+=1){const o=Array.isArray(t)?t[s]:t,u=new Qu({pageContent:e[s],metadata:o});a.push(u)}return OO.fromDocuments(a,r,i)}static async fromDocuments(e,t,r){const i=new this(t,r);return await i.addDocuments(e),i}static async fromExistingIndex(e,t){return new this(e,t)}}const jCe=Object.freeze(Object.defineProperty({__proto__:null,FakeChatMessageHistory:kCe,FakeChatModel:ICe,FakeEmbeddings:$Ce,FakeLLM:xCe,FakeListChatMessageHistory:NCe,FakeListChatModel:OCe,FakeRetriever:PCe,FakeRunnable:CCe,FakeSplitIntoListParser:ACe,FakeStreamingChatModel:PO,FakeStreamingLLM:RCe,FakeTool:DCe,FakeTracer:MCe,FakeVectorStore:OO,SingleRunExtractor:UCe,SyntheticEmbeddings:LCe},Symbol.toStringTag,{value:"Module"})),FCe=Object.freeze(Object.defineProperty({__proto__:null,agents:vAe,caches:Are,callbacks__base:Cee,callbacks__manager:Hee,callbacks__promises:jee,chat_history:bAe,documents:EAe,embeddings:Xce,example_selectors:CAe,language_models__base:qre,language_models__chat_models:Cue,language_models__llms:Jce,load__serializable:qZ,memory:OAe,messages:pre,output_parsers:Vue,outputs:Qee,prompt_values:Cre,prompts:iCe,retrievers:aCe,runnables:Pue,stores:oCe,tools:Wre,tracers__base:Pee,tracers__console:Nee,tracers__initialize:fCe,tracers__log_stream:Xee,tracers__run_collector:hCe,tracers__tracer_langchain:Mee,tracers__tracer_langchain_v1:lCe,utils__async_caller:ite,utils__chunk_array:Zce,utils__env:Tee,utils__function_calling:$ce,utils__hash:wre,utils__json_patch:Uue,utils__json_schema:tre,utils__math:ECe,utils__stream:Yee,utils__testing:jCe,utils__tiktoken:Ure,utils__types:Mce,vectorstores:TCe},Symbol.toStringTag,{value:"Module"}));function BCe(n){const e={};for(let t=n;t&&t.prototype;t=Object.getPrototypeOf(t))Object.assign(e,Reflect.get(t.prototype,"lc_aliases"));return Object.entries(e).reduce((t,[r,i])=>(t[i]=r,t),{})}async function a_(n){const{optionalImportsMap:e={},optionalImportEntrypoints:t=[],importMap:r={},secretsMap:i={},path:a=["$"]}=this,s=a.join(".");if(typeof n=="object"&&n!==null&&!Array.isArray(n)&&"lc"in n&&"type"in n&&"id"in n&&n.lc===1&&n.type==="secret"){const o=n,[u]=o.id;if(u in i)return i[u];{const c=zi(u);if(c)return c;throw new Error(`Missing key "${u}" for ${s} in load(secretsMap={})`)}}else if(typeof n=="object"&&n!==null&&!Array.isArray(n)&&"lc"in n&&"type"in n&&"id"in n&&n.lc===1&&n.type==="not_implemented"){const u=JSON.stringify(n);throw new Error(`Trying to load an object that doesn't implement serialization: ${s} -> ${u}`)}else if(typeof n=="object"&&n!==null&&!Array.isArray(n)&&"lc"in n&&"type"in n&&"id"in n&&"kwargs"in n&&n.lc===1){const o=n,u=JSON.stringify(o),[c,...d]=o.id.slice().reverse(),h=d.reverse(),m={langchain_core:FCe,langchain:r};let g=null;const _=[h.join("/")];h[0]==="langchain_community"&&_.push(["langchain",...h.slice(1)].join("/"));const w=_.find(C=>C in e);if(yAe.concat(t).includes(h.join("/"))||w)if(w!==void 0)g=await e[w];else throw new Error(`Missing key "${h.join("/")}" for ${s} in load(optionalImportsMap={})`);else{let C;if(h[0]==="langchain"||h[0]==="langchain_core")C=m[h[0]],h.shift();else throw new Error(`Invalid namespace: ${s} -> ${u}`);if(h.length===0)throw new Error(`Invalid namespace: ${s} -> ${u}`);let A;do{if(A=h.join("__"),A in C)break;h.pop()}while(h.length>0);A in C&&(g=C[A])}if(typeof g!="object"||g===null)throw new Error(`Invalid namespace: ${s} -> ${u}`);const S=g[c]??Object.values(g).find(C=>typeof C=="function"&&Tb(C)===c);if(typeof S!="function")throw new Error(`Invalid identifer: ${s} -> ${u}`);const E=await a_.call({...this,path:[...a,"kwargs"]},o.kwargs);if(o.type==="constructor"){const C=new S(R6(E,FZ,BCe(S)));return Object.defineProperty(C.constructor,"name",{value:c}),C}else throw new Error(`Invalid type: ${s} -> ${u}`)}else if(typeof n=="object"&&n!==null)return Array.isArray(n)?Promise.all(n.map((o,u)=>a_.call({...this,path:[...a,`${u}`]},o))):Object.fromEntries(await Promise.all(Object.entries(n).map(async([o,u])=>[o,await a_.call({...this,path:[...a,o]},u)])));return n}async function qCe(n,e){const t=JSON.parse(n);return a_.call({...e},t)}var _3="[...]",VCe="[Circular]",pb=[],nd=[];function zCe(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function HCe(n,e,t,r){typeof r>"u"&&(r=zCe()),LR(n,"",0,[],void 0,0,r);var i;try{nd.length===0?i=JSON.stringify(n,e,t):i=JSON.stringify(n,GCe(e),t)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;pb.length!==0;){var a=pb.pop();a.length===4?Object.defineProperty(a[0],a[1],a[3]):a[0][a[1]]=a[2]}}return i}function IC(n,e,t,r){var i=Object.getOwnPropertyDescriptor(r,t);i.get!==void 0?i.configurable?(Object.defineProperty(r,t,{value:n}),pb.push([r,t,e,i])):nd.push([e,t,n]):(r[t]=n,pb.push([r,t,e]))}function LR(n,e,t,r,i,a,s){a+=1;var o;if(typeof n=="object"&&n!==null){for(o=0;o<r.length;o++)if(r[o]===n){IC(VCe,n,e,i);return}if(typeof s.depthLimit<"u"&&a>s.depthLimit){IC(_3,n,e,i);return}if(typeof s.edgesLimit<"u"&&t+1>s.edgesLimit){IC(_3,n,e,i);return}if(r.push(n),Array.isArray(n))for(o=0;o<n.length;o++)LR(n[o],o,o,r,n,a,s);else{var u=Object.keys(n);for(o=0;o<u.length;o++){var c=u[o];LR(n[c],c,o,r,n,a,s)}}r.pop()}}function GCe(n){return n=typeof n<"u"?n:function(e,t){return t},function(e,t){if(nd.length>0)for(var r=0;r<nd.length;r++){var i=nd[r];if(i[1]===e&&i[0]===t){t=i[2],nd.splice(r,1);break}}return n.call(this,e,t)}}function WCe(n){return n!==null&&n.lc===1&&n.type==="constructor"&&Array.isArray(n.id)}async function UR(n){if(n&&typeof n=="object"){if(Array.isArray(n))return await Promise.all(n.map(t=>UR(t)));{const e={};for(const[t,r]of Object.entries(n))e[t]=await UR(r);if(e.lc===2&&e.type==="undefined")return;if(e.lc===2&&e.type==="constructor"&&Array.isArray(e.id))try{const t=e.id[e.id.length-1];let r;switch(t){case"Set":r=Set;break;case"Map":r=Map;break;case"RegExp":r=RegExp;break;case"Error":r=Error;break;default:return e}return e.method?r[e.method](...e.args||[]):new r(...e.args||[])}catch{return e}else if(WCe(e))return qCe(JSON.stringify(e));return e}}return n}function PC(n,e,t,r){return{lc:2,type:"constructor",id:[n.name],method:e??null,args:t??[],kwargs:r??{}}}function KCe(n){return n===void 0?{lc:2,type:"undefined"}:n instanceof Set||n instanceof Map?PC(n.constructor,void 0,[Array.from(n)]):n instanceof RegExp?PC(RegExp,void 0,[n.source,n.flags]):n instanceof Error?PC(n.constructor,void 0,[n.message]):(n==null?void 0:n.lg_name)==="Send"?{node:n.node,args:n.args}:n}class JCe{_dumps(e){return new TextEncoder().encode(HCe(e,(r,i)=>KCe(i)))}dumpsTyped(e){return e instanceof Uint8Array?["bytes",e]:["json",this._dumps(e)]}async _loads(e){const t=JSON.parse(e);return UR(t)}async loadsTyped(e,t){if(e==="bytes")return typeof t=="string"?new TextEncoder().encode(t):t;if(e==="json")return this._loads(typeof t=="string"?t:new TextDecoder().decode(t));throw new Error(`Unknown serialization type: ${e}`)}}function kO(n){if(typeof n!="object"||n===null)return n;const e=Array.isArray(n)?[]:{};for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=kO(n[t]));return e}function yH(){return{v:1,id:eH(-2),ts:new Date().toISOString(),channel_values:{},channel_versions:{},versions_seen:{},pending_sends:[]}}function mb(n){return{v:n.v,id:n.id,ts:n.ts,channel_values:{...n.channel_values},channel_versions:{...n.channel_versions},versions_seen:kO(n.versions_seen),pending_sends:[...n.pending_sends]}}function vH(n,e){return typeof n=="number"&&typeof e=="number"?Math.sign(n-e):String(n).localeCompare(String(e))}function b3(...n){return n.reduce((e,t,r)=>r===0?t:vH(e,t)>=0?e:t)}const w3={[pAe]:-1,[r_]:-2,[mAe]:-3,[gAe]:-4};class yp extends Error{constructor(e){super(e),this.name="InvalidNamespaceError"}}function YCe(n){if(n.length===0)throw new yp("Namespace cannot be empty.");for(const e of n){if(typeof e!="string")throw new yp(`Invalid namespace label '${e}' found in ${n}. Namespace labels must be strings, but got ${typeof e}.`);if(e.includes("."))throw new yp(`Invalid namespace label '${e}' found in ${n}. Namespace labels cannot contain periods ('.').`);if(e==="")throw new yp(`Namespace labels cannot be empty strings. Got ${e} in ${n}`)}if(n[0]==="langgraph")throw new yp(`Root label for namespace cannot be "langgraph". Got: ${n}`)}class ZCe{async get(e,t){return(await this.batch([{namespace:e,key:t}]))[0]}async search(e,t={}){const{filter:r,limit:i=10,offset:a=0,query:s}=t;return(await this.batch([{namespacePrefix:e,filter:r,limit:i,offset:a,query:s}]))[0]}async put(e,t,r,i){YCe(e),await this.batch([{namespace:e,key:t,value:r,index:i}])}async delete(e,t){await this.batch([{namespace:e,key:t,value:null}])}async listNamespaces(e={}){const{prefix:t,suffix:r,maxDepth:i,limit:a=100,offset:s=0}=e,o=[];return t&&o.push({matchType:"prefix",path:t}),r&&o.push({matchType:"suffix",path:r}),(await this.batch([{matchConditions:o.length?o:void 0,maxDepth:i,limit:a,offset:s}]))[0]}start(){}stop(){}}const XCe=n=>"lg_name"in n&&n.lg_name==="AsyncBatchedStore"?n.store:n;class QCe extends ZCe{constructor(e){super(),Object.defineProperty(this,"lg_name",{enumerable:!0,configurable:!0,writable:!0,value:"AsyncBatchedStore"}),Object.defineProperty(this,"store",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"nextKey",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"running",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"processingTask",{enumerable:!0,configurable:!0,writable:!0,value:null}),this.store=XCe(e)}get isRunning(){return this.running}async batch(e){throw new Error("The `batch` method is not implemented on `AsyncBatchedStore`.\n Instead, it calls the `batch` method on the wrapped store.\n If you are seeing this error, something is wrong.")}async get(e,t){return this.enqueueOperation({namespace:e,key:t})}async search(e,t){const{filter:r,limit:i=10,offset:a=0,query:s}=t||{};return this.enqueueOperation({namespacePrefix:e,filter:r,limit:i,offset:a,query:s})}async put(e,t,r){return this.enqueueOperation({namespace:e,key:t,value:r})}async delete(e,t){return this.enqueueOperation({namespace:e,key:t,value:null})}start(){this.running||(this.running=!0,this.processingTask=this.processBatchQueue())}async stop(){this.running=!1,this.processingTask&&await this.processingTask}enqueueOperation(e){return new Promise((t,r)=>{const i=this.nextKey;this.nextKey+=1,this.queue.set(i,{operation:e,resolve:t,reject:r})})}async processBatchQueue(){for(;this.running;){if(await new Promise(t=>{setTimeout(t,0)}),this.queue.size===0)continue;const e=new Map(this.queue);this.queue.clear();try{const t=Array.from(e.values()).map(({operation:i})=>i),r=await this.store.batch(t);e.forEach(({resolve:i},a)=>{const s=Array.from(e.keys()).indexOf(a);i(r[s])})}catch(t){e.forEach(({reject:r})=>{r(t)})}}}toJSON(){return{queue:this.queue,nextKey:this.nextKey,running:this.running,store:"[LangGraphStore]"}}}class exe{constructor(e){Object.defineProperty(this,"serde",{enumerable:!0,configurable:!0,writable:!0,value:new JCe}),this.serde=e||this.serde}}class $c extends Error{constructor(e,t){let r=e??"";t!=null&&t.lc_error_code&&(r=`${r}

Troubleshooting URL: https://langchain-ai.github.io/langgraphjs/troubleshooting/errors/${t.lc_error_code}/
`),super(r),Object.defineProperty(this,"lc_error_code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_error_code=t==null?void 0:t.lc_error_code}}class _H extends $c{get is_bubble_up(){return!0}}class txe extends $c{constructor(e,t){super(e,t),this.name="GraphRecursionError"}static get unminifiable_name(){return"GraphRecursionError"}}class E3 extends $c{constructor(e,t){super(e,t),this.name="GraphValueError"}static get unminifiable_name(){return"GraphValueError"}}class am extends _H{constructor(e,t){super(JSON.stringify(e,null,2),t),Object.defineProperty(this,"interrupts",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="GraphInterrupt",this.interrupts=e??[]}static get unminifiable_name(){return"GraphInterrupt"}}class bH extends am{constructor(e,t){super([{value:e,when:"during"}],t),this.name="NodeInterrupt"}static get unminifiable_name(){return"NodeInterrupt"}}class wH extends _H{constructor(e){super(),Object.defineProperty(this,"command",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="ParentCommand",this.command=e}static get unminifiable_name(){return"ParentCommand"}}function nxe(n){return n!==void 0&&n.name===wH.unminifiable_name}function s_(n){return n!==void 0&&n.is_bubble_up===!0}function rd(n){return n!==void 0&&[am.unminifiable_name,bH.unminifiable_name].includes(n.name)}class S3 extends $c{constructor(e,t){super(e,t),this.name="EmptyInputError"}static get unminifiable_name(){return"EmptyInputError"}}class Zr extends $c{constructor(e,t){super(e,t),this.name="EmptyChannelError"}static get unminifiable_name(){return"EmptyChannelError"}}class qn extends $c{constructor(e,t){super(e,t),this.name="InvalidUpdateError"}static get unminifiable_name(){return"InvalidUpdateError"}}class rxe extends $c{constructor(e,t){super(e,t),this.name="UnreachableNodeError"}static get unminifiable_name(){return"UnreachableNodeError"}}function kw(n){return n!=null&&n.lg_is_channel===!0}class Xd{constructor(){Object.defineProperty(this,"ValueType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"UpdateType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lg_is_channel",{enumerable:!0,configurable:!0,writable:!0,value:!0})}consume(){return!1}finish(){return!1}isAvailable(){try{return this.get(),!0}catch(e){if(e.name===Zr.unminifiable_name)return!1;throw e}}}function gb(n,e){const t=Object.fromEntries(Object.entries(n).filter(([,i])=>kw(i))),r={};for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){const a=e.channel_values[i];r[i]=t[i].fromCheckpoint(a)}return r}function Fu(n,e,t){let r;if(e===void 0)r=n.channel_values;else{r={};for(const i of Object.keys(e))try{r[i]=e[i].checkpoint()}catch(a){if(a.name!==Zr.unminifiable_name)throw a}}return{v:1,id:eH(t),ts:new Date().toISOString(),channel_values:r,channel_versions:{...n.channel_versions},versions_seen:kO(n.versions_seen),pending_sends:n.pending_sends??[]}}const ixe=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function jR(n){return typeof n=="string"&&ixe.test(n)}var Gr=[];for(var OC=0;OC<256;++OC)Gr.push((OC+256).toString(16).slice(1));function axe(n,e=0){return(Gr[n[e+0]]+Gr[n[e+1]]+Gr[n[e+2]]+Gr[n[e+3]]+"-"+Gr[n[e+4]]+Gr[n[e+5]]+"-"+Gr[n[e+6]]+Gr[n[e+7]]+"-"+Gr[n[e+8]]+Gr[n[e+9]]+"-"+Gr[n[e+10]]+Gr[n[e+11]]+Gr[n[e+12]]+Gr[n[e+13]]+Gr[n[e+14]]+Gr[n[e+15]]).toLowerCase()}var Av,sxe=new Uint8Array(16);function oxe(){if(!Av&&(Av=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Av))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Av(sxe)}var lxe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const T3={randomUUID:lxe};function A3(n,e,t){if(T3.randomUUID&&!n)return T3.randomUUID();n=n||{};var r=n.random||(n.rng||oxe)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,axe(r)}const jn="__start__",Dt="__end__",Bo="__input__",uxe="__copy__",Fi="__error__",kC="__pregel_ns_writes",bd="__pregel_send",NO="__pregel_call",tc="__pregel_read",Er="__pregel_checkpointer",Bl="__pregel_resuming",sm="__pregel_task_id",yb="__pregel_stream",cxe="__pregel_resume_value",nc="__pregel_scratchpad",o_="__pregel_previous",fxe="checkpoint_id",FR="checkpoint_ns",dxe="__pregel_node_finished",Fa="checkpoint_map",C3="__pregel_abort_signals",Rn="__interrupt__",Ka="__resume__",MO="__no_writes__",Nd="__return__",NC="__previous__",Of="__pregel_runtime_placeholder__",cr="langsmith:hidden",hxe="langsmith:nostream",x3="__self__",Md="__pregel_tasks",Ba="__pregel_push",l_="__pregel_pull",qa="00000000-0000-0000-0000-000000000000",pxe=[cr,Bo,Rn,Ka,Fi,MO,Md,bd,tc,Er,yb,Bl,sm,NO,cxe,nc,o_,Fa,FR,fxe],Bi="|",rc=":";function BR(n){const e=n;return e!=null&&typeof e.node=="string"&&e.args!==void 0}class vb{constructor(e,t){Object.defineProperty(this,"lg_name",{enumerable:!0,configurable:!0,writable:!0,value:"Send"}),Object.defineProperty(this,"node",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"args",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.node=e,this.args=Nm(t)}toJSON(){return{lg_name:this.lg_name,node:this.node,args:this.args}}}function Yi(n){return n instanceof vb}function mxe(n){return!n||typeof n!="object"||!(Rn in n)?!1:Array.isArray(n[Rn])}class qi{constructor(e){Object.defineProperty(this,"lg_name",{enumerable:!0,configurable:!0,writable:!0,value:"Command"}),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"graph",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"update",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"resume",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"goto",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.resume=e.resume,this.graph=e.graph,this.update=e.update,e.goto&&(this.goto=Array.isArray(e.goto)?Nm(e.goto):[Nm(e.goto)])}_updateAsTuples(){return this.update&&typeof this.update=="object"&&!Array.isArray(this.update)?Object.entries(this.update):Array.isArray(this.update)&&this.update.every(e=>Array.isArray(e)&&e.length===2&&typeof e[0]=="string")?this.update:[["__root__",this.update]]}toJSON(){var t;let e;return typeof this.goto=="string"?e=this.goto:Yi(this.goto)?e=this.goto.toJSON():e=(t=this.goto)==null?void 0:t.map(r=>typeof r=="string"?r:r.toJSON()),{lg_name:this.lg_name,update:this.update,resume:this.resume,goto:e}}}Object.defineProperty(qi,"PARENT",{enumerable:!0,configurable:!0,writable:!0,value:"__parent__"});function Kr(n){return typeof n!="object"||n==null?!1:"lg_name"in n&&n.lg_name==="Command"}function Nm(n,e=new Map){if(n!=null&&typeof n=="object"){if(e.has(n))return e.get(n);let t;if(Array.isArray(n))t=[],e.set(n,t),n.forEach((r,i)=>{t[i]=Nm(r,e)});else if(Kr(n)&&!(n instanceof qi))t=new qi(n),e.set(n,t);else if(BR(n)&&!(n instanceof vb))t=new vb(n.node,n.args),e.set(n,t);else if(Kr(n)||Yi(n))t=n,e.set(n,t);else if("lc_serializable"in n&&n.lc_serializable)t=n,e.set(n,t);else{t={},e.set(n,t);for(const[r,i]of Object.entries(n))t[r]=Nm(i,e)}return t}return n}const gxe=["tags","metadata","callbacks","configurable"],yxe=["tags","metadata","callbacks","runName","maxConcurrency","recursionLimit","configurable","runId","outputKeys","streamMode","store","writer","interruptBefore","interruptAfter","signal"],vxe=25;function EH(...n){const e={tags:[],metadata:{},callbacks:void 0,recursionLimit:vxe,configurable:{}},t=Hi.getRunnableConfig();if(t!==void 0){for(const[r,i]of Object.entries(t))if(i!==void 0)if(gxe.includes(r)){let a;Array.isArray(i)?a=[...i]:typeof i=="object"?r==="callbacks"&&"copy"in i&&typeof i.copy=="function"?a=i.copy():a={...i}:a=i,e[r]=a}else e[r]=i}for(const r of n)if(r!==void 0)for(const[i,a]of Object.entries(r))a!==void 0&&yxe.includes(i)&&(e[i]=a);for(const[r,i]of Object.entries(e.configurable))e.metadata=e.metadata??{},!r.startsWith("__")&&(typeof i=="string"||typeof i=="number"||typeof i=="boolean")&&!(r in e.metadata)&&(e.metadata[r]=i);return e}function MC(n){return n.split(Bi).filter(e=>!e.match(/^\d+$/)).map(e=>e.split(rc)[0]).join(Bi)}function _xe(n){const e=n.split(Bi);for(;e.length>1&&e[e.length-1].match(/^\d+$/);)e.pop();return e.slice(0,-1).join(Bi)}class fu extends Gt{constructor(e){super(),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langgraph"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"recurse",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.name=e.name??e.func.name,this.func=e.func,this.config=e.tags?{tags:e.tags}:void 0,this.trace=e.trace??this.trace,this.recurse=e.recurse??this.recurse}async _tracedInvoke(e,t,r){return new Promise((i,a)=>{const s=fn(t,{callbacks:r==null?void 0:r.getChild()});Hi.runWithConfig(s,async()=>{try{const o=await this.func(e,s);i(o)}catch(o){a(o)}})})}async invoke(e,t){let r;const i=EH(t),a=bs(this.config,i);return this.trace?r=await this._callWithConfig(this._tracedInvoke,e,a):r=await Hi.runWithConfig(a,async()=>this.func(e,a)),Gt.isRunnable(r)&&this.recurse?await Hi.runWithConfig(a,async()=>r.invoke(e,a)):r}}function*Ul(n,e){if(e===void 0)yield*n;else for(const t of n)yield[e,t]}async function Vl(n){const e=[];for await(const t of await n)e.push(t);return e}function Lp(n){const e=[];for(const t of n)e.push(t);return e}function vp(n,e){return n?"configurable"in n?{...n,configurable:{...n.configurable,...e}}:{...n,configurable:e}:{configurable:e}}function bxe(n){return typeof n=="object"&&(n==null?void 0:n[Symbol.for("LG_SKIP_WRITE")])!==void 0}const ic={[Symbol.for("LG_PASSTHROUGH")]:!0};function Cv(n){return typeof n=="object"&&(n==null?void 0:n[Symbol.for("LG_PASSTHROUGH")])!==void 0}const DC=Symbol("IS_WRITER");class Dr extends fu{constructor(e,t){const r=`ChannelWrite<${e.map(i=>Yi(i)?i.node:"channel"in i?i.channel:"...").join(",")}>`;super({writes:e,name:r,tags:t,func:async(i,a)=>this._write(i,a??{})}),Object.defineProperty(this,"writes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.writes=e}async _write(e,t){const r=this.writes.map(i=>$C(i)&&Cv(i.value)?{mapper:i.mapper,value:e}:u_(i)&&Cv(i.value)?{channel:i.channel,value:e,skipNone:i.skipNone,mapper:i.mapper}:i);return await Dr.doWrite(t,r),e}static async doWrite(e,t){var a;for(const s of t){if(u_(s)){if(s.channel===Md)throw new qn("Cannot write to the reserved channel TASKS");if(Cv(s.value))throw new qn("PASSTHROUGH value must be replaced")}if($C(s)&&Cv(s.value))throw new qn("PASSTHROUGH value must be replaced")}const r=[];for(const s of t)if(Yi(s))r.push([Md,s]);else if($C(s)){const o=await s.mapper.invoke(s.value,e);o!=null&&o.length>0&&r.push(...o)}else if(u_(s)){const o=s.mapper!==void 0?await s.mapper.invoke(s.value,e):s.value;if(bxe(o)||s.skipNone&&o===void 0)continue;r.push([s.channel,o])}else throw new Error(`Invalid write entry: ${JSON.stringify(s)}`);((a=e.configurable)==null?void 0:a[bd])(r)}static isWriter(e){return e instanceof Dr||DC in e&&!!e[DC]}static registerWriter(e){return Object.defineProperty(e,DC,{value:!0})}}function u_(n){return n!==void 0&&typeof n.channel=="string"}function $C(n){return n!==void 0&&!u_(n)&&Gt.isRunnable(n.mapper)}class DO extends fu{constructor(e,t,r=!1){super({func:(i,a)=>DO.doRead(a,this.channel,this.fresh,this.mapper)}),Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"ChannelRead"}),Object.defineProperty(this,"channel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fresh",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.fresh=r,this.mapper=t,this.channel=e,this.name=Array.isArray(e)?`ChannelRead<${e.join(",")}>`:`ChannelRead<${e}>`}static doRead(e,t,r,i){var s;const a=(s=e.configurable)==null?void 0:s[tc];if(!a)throw new Error("Runnable is not configured with a read function. Make sure to call in the context of a Pregel process");return i?i(a(t,r)):a(t,r)}}const kf=new Ps;class ao extends bi{constructor(e){var w;const{channels:t,triggers:r,mapper:i,writers:a,bound:s,kwargs:o,metadata:u,retryPolicy:c,cachePolicy:d,tags:h,subgraphs:m,ends:g}=e,_=[...(w=e.config)!=null&&w.tags?e.config.tags:[],...h??[]];super({...e,bound:e.bound??kf,config:{...e.config?e.config:{},tags:_}}),Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"PregelNode"}),Object.defineProperty(this,"channels",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"triggers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:kf}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"retryPolicy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cachePolicy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"subgraphs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ends",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.channels=t,this.triggers=r,this.mapper=i,this.writers=a??this.writers,this.bound=s??this.bound,this.kwargs=o??this.kwargs,this.metadata=u??this.metadata,this.tags=_,this.retryPolicy=c,this.cachePolicy=d,this.subgraphs=m,this.ends=g}getWriters(){var t;const e=[...this.writers];for(;e.length>1&&e[e.length-1]instanceof Dr&&e[e.length-2]instanceof Dr;){const r=e.slice(-2),i=r[0].writes.concat(r[1].writes);e[e.length-2]=new Dr(i,(t=r[0].config)==null?void 0:t.tags),e.pop()}return e}getNode(){const e=this.getWriters();if(!(this.bound===kf&&e.length===0))return this.bound===kf&&e.length===1?e[0]:this.bound===kf?new Ar({first:e[0],middle:e.slice(1,e.length-1),last:e[e.length-1],omitSequenceTags:!0}):e.length>0?new Ar({first:this.bound,middle:e.slice(0,e.length-1),last:e[e.length-1],omitSequenceTags:!0}):this.bound}join(e){if(!Array.isArray(e))throw new Error("channels must be a list");if(typeof this.channels!="object")throw new Error("all channels must be named when using .join()");return new ao({channels:{...this.channels,...Object.fromEntries(e.map(t=>[t,t]))},triggers:this.triggers,mapper:this.mapper,writers:this.writers,bound:this.bound,kwargs:this.kwargs,config:this.config,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy})}pipe(e){return Dr.isWriter(e)?new ao({channels:this.channels,triggers:this.triggers,mapper:this.mapper,writers:[...this.writers,e],bound:this.bound,config:this.config,kwargs:this.kwargs,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy}):this.bound===kf?new ao({channels:this.channels,triggers:this.triggers,mapper:this.mapper,writers:this.writers,bound:Yr(e),config:this.config,kwargs:this.kwargs,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy}):new ao({channels:this.channels,triggers:this.triggers,mapper:this.mapper,writers:this.writers,bound:this.bound.pipe(e),config:this.config,kwargs:this.kwargs,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy})}}class wxe{constructor(e,t){Object.defineProperty(this,"runtime",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_promises",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"lg_is_managed_value",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.config=e}static async initialize(e,t){throw new Error("Not implemented")}async promises(){return Promise.all(this._promises)}addPromise(e){this._promises.push(e)}}const Exe="__channel_key_placeholder__";class Sxe extends Map{constructor(e){super(e?Array.from(e):void 0)}replaceRuntimeValues(e,t){if(!(this.size===0||!t)&&!Array.from(this.values()).every(r=>!r.runtime)){if(typeof t=="object"&&!Array.isArray(t))for(const[r,i]of Object.entries(t))for(const[a,s]of this.entries())s.runtime&&s.call(e)===i&&(t[r]={[Of]:a});else if(typeof t=="object"&&"constructor"in t)for(const r of Object.getOwnPropertyNames(Object.getPrototypeOf(t)))try{const i=t[r];for(const[a,s]of this.entries())s.runtime&&s.call(e)===i&&(t[r]={[Of]:a})}catch(i){if(i.name!==TypeError.name)throw i}}}replaceRuntimePlaceholders(e,t){var r;if(!(this.size===0||!t)&&!Array.from(this.values()).every(i=>!i.runtime)){if(typeof t=="object"&&!Array.isArray(t)){for(const[i,a]of Object.entries(t))if(typeof a=="object"&&a!==null&&Of in a){const s=a[Of];typeof s=="string"&&(t[i]=(r=this.get(s))==null?void 0:r.call(e))}}else if(typeof t=="object"&&"constructor"in t)for(const i of Object.getOwnPropertyNames(Object.getPrototypeOf(t)))try{const a=t[i];if(typeof a=="object"&&a!==null&&Of in a){const s=this.get(a[Of]);s&&(t[i]=s.call(e))}}catch(a){if(a.name!==TypeError.name)throw a}}}}function Nw(n){return!!(typeof n=="object"&&n&&"cls"in n&&"params"in n)}class $O extends wxe{call(){}static async initialize(e,t){return Promise.resolve(new $O(e))}}function ac(n,e,t=!0,r=!1){try{return n[e].get()}catch(i){if(i.name===Zr.unminifiable_name){if(r)return i;if(t)return null}throw i}}function wc(n,e,t=!0){if(Array.isArray(e)){const r={};for(const i of e)try{r[i]=ac(n,i,!t)}catch(a){if(a.name===Zr.unminifiable_name)continue}return r}else return ac(n,e)}function*Txe(n,e){if(n.graph===qi.PARENT)throw new qn("There is no parent graph.");if(n.goto){let t;Array.isArray(n.goto)?t=n.goto:t=[n.goto];for(const r of t)if(Yi(r))yield[qa,Md,r];else if(typeof r=="string")yield[qa,`branch:to:${r}`,"__start__"];else throw new Error(`In Command.send, expected Send or string, got ${typeof r}`)}if(n.resume)if(typeof n.resume=="object"&&Object.keys(n.resume).length&&Object.keys(n.resume).every(jR))for(const[t,r]of Object.entries(n.resume)){const i=e.filter(a=>a[0]===t&&a[1]===Ka).map(a=>a[2]).slice(0,1)??[];i.push(r),yield[t,Ka,i]}else yield[qa,Ka,n.resume];if(n.update){if(typeof n.update!="object"||!n.update)throw new Error("Expected cmd.update to be a dict mapping channel names to update values");if(Array.isArray(n.update))for(const[t,r]of n.update)yield[qa,t,r];else for(const[t,r]of Object.entries(n.update))yield[qa,t,r]}}function*SH(n,e){if(e!=null)if(Array.isArray(n)&&typeof e=="object"&&!Array.isArray(e))for(const t in e)n.includes(t)&&(yield[t,e[t]]);else{if(Array.isArray(n))throw new Error('Input chunk must be an object when "inputChannels" is an array');yield[n,e]}}function*LC(n,e,t){Array.isArray(n)?(e===!0||e.find(([r,i])=>n.includes(r)))&&(yield wc(t,n)):(e===!0||e.some(([r,i])=>r===n))&&(yield ac(t,n))}function*R3(n,e,t){const r=e.filter(([o,u])=>{var c;return(o.config===void 0||!((c=o.config.tags)!=null&&c.includes(cr)))&&u[0][0]!==Fi&&u[0][0]!==Rn});if(!r.length)return;let i;r.some(([o])=>o.writes.some(([u,c])=>u===Nd))?i=r.flatMap(([o])=>o.writes.filter(([u,c])=>u===Nd).map(([u,c])=>[o.name,c])):Array.isArray(n)?i=r.flatMap(([o])=>{const{writes:u}=o,c={};for(const[d]of u)n.includes(d)&&(c[d]=(c[d]||0)+1);return Object.values(c).some(d=>d>1)?u.filter(([d])=>n.includes(d)).map(([d,h])=>[o.name,{[d]:h}]):[[o.name,Object.fromEntries(u.filter(([d])=>n.includes(d)))]]}):i=r.flatMap(([o])=>o.writes.filter(([u,c])=>u===n).map(([u,c])=>[o.name,c]));const a={};for(const[o,u]of i)o in a||(a[o]=[]),a[o].push(u);const s={};for(const o in a)if(a[o].length===1){const[u]=a[o];s[o]=u}else s[o]=a[o];t&&(s.__metadata__={cached:t}),yield s}class Axe{constructor({func:e,name:t,input:r,retry:i,cache:a,callbacks:s}){Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"input",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"retry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__lg_type",{enumerable:!0,configurable:!0,writable:!0,value:"call"}),this.func=e,this.name=t,this.input=r,this.retry=i,this.cache=a,this.callbacks=s}}function Cxe(n){return typeof n=="object"&&n!==null&&"__lg_type"in n&&n.__lg_type==="call"}function TH(n){const e=Object.values(n),t=e.length>0?typeof e[0]:void 0;let r;return t==="number"?r=0:t==="string"&&(r=""),r}function qR(n,e){if(Object.keys(n).length>0){const t=TH(e);return Object.fromEntries(Object.entries(e).filter(([r,i])=>i>(n[r]??t)))}else return e}function xxe(n,e){return n&&!Array.isArray(n)&&!(n instanceof Date)&&typeof n=="object"?n:{[e]:n}}function Wl(n,e){return n===null?{configurable:e}:(n==null?void 0:n.configurable)===void 0?{...n,configurable:e}:{...n,configurable:{...n.configurable,...e}}}function Nf(n,e){var r,i;const t=(e==null?void 0:e.parents)??{};return Object.keys(t).length>0?Wl(n,{[Fa]:{...t,[((r=n.configurable)==null?void 0:r.checkpoint_ns)??""]:(i=n.configurable)==null?void 0:i.checkpoint_id}}):n}function id(...n){if(n.length===1)return n[0];const e=new AbortController,t=()=>{e.abort(),n.forEach(r=>r.removeEventListener("abort",t))};return n.forEach(r=>r.addEventListener("abort",t)),n.some(r=>r.aborted)&&e.abort(),e.signal}const Rxe=(n,e)=>{if(!(!n&&!e))return n?e?Array.isArray(n)&&Array.isArray(e)?[...n,...e]:Array.isArray(n)?[...n,e]:Array.isArray(e)?[n,...e]:[n,e]:n:e};function Ixe(n,e){const t=new fu({func:r=>e(...r),name:n,trace:!1,recurse:!1});return new Ar({name:n,first:t,last:new Dr([{channel:Nd,value:ic}],[cr])})}const Pxe=n=>n!==void 0?n+1:1;function xv(n,e,t){const r=Object.values(n.channel_versions),i=r.length>0?typeof r[0]:void 0;let a;i==="number"?a=0:i==="string"&&(a="");const s=n.versions_seen[Rn]??{},o=Object.entries(n.channel_versions).some(([c,d])=>d>(s[c]??a)),u=t.some(c=>{var d,h;return e==="*"?!((h=(d=c.config)==null?void 0:d.tags)!=null&&h.includes(cr)):e.includes(c.name)});return o&&u}function c_(n,e,t,r,i,a,s=!1){let o=[],u=new Set;if(Array.isArray(a))o=a.filter(d=>r.get(d)),a=a.filter(d=>!r.get(d)),u=new Set(a.filter(d=>i.writes.some(([h,m])=>h===d)));else{for(const[d]of i.writes)if(d===a){u=new Set([d]);break}u=u||new Set}let c;if(s&&u.size>0){const d=Object.fromEntries(Object.entries(t).filter(([g,_])=>u.has(g))),h=Fu(e,d,-1),m=gb(d,h);ga(mb(h),m,[i],void 0,void 0),c=wc({...t,...m},a)}else c=wc(t,a);if(o.length>0)for(const d of o){const h=r.get(d);if(h){const m=h.call(n);c[d]=m}}return c}function UC(n,e,t,r,i){for(const[a,s]of i)if([Ba,Md].includes(a)&&s!=null){if(!Yi(s))throw new qn(`Invalid packet type, expected SendProtocol, got ${JSON.stringify(s)}`);if(!(s.node in t))throw new qn(`Invalid node name "${s.node}" in Send packet`);r.replaceRuntimeValues(n,s.args)}e(i)}const Oxe=new Set([MO,Ba,Ka,Rn,Nd,Fi]);function ga(n,e,t,r,i){var m,g,_;t.sort((w,S)=>{var A,R;const E=((A=w.path)==null?void 0:A.slice(0,3))||[],C=((R=S.path)==null?void 0:R.slice(0,3))||[];for(let P=0;P<Math.min(E.length,C.length);P+=1){if(E[P]<C[P])return-1;if(E[P]>C[P])return 1}return E.length-C.length});const a=t.some(w=>w.triggers.length>0),s=Object.fromEntries(Object.entries(e).filter(([w,S])=>kw(S)));for(const w of t){(m=n.versions_seen)[g=w.name]??(m[g]={});for(const S of w.triggers)S in n.channel_versions&&(n.versions_seen[w.name][S]=n.channel_versions[S])}let o;Object.keys(n.channel_versions).length>0&&(o=b3(...Object.values(n.channel_versions)));const u=new Set(t.flatMap(w=>w.triggers).filter(w=>!pxe.includes(w)));for(const w of u)w in s&&s[w].consume()&&r!==void 0&&(n.channel_versions[w]=r(o,s[w]));(_=n.pending_sends)!=null&&_.length&&a&&(n.pending_sends=[]);const c={},d={};for(const w of t)for(const[S,E]of w.writes)Oxe.has(S)||(S===Md?n.pending_sends.push({node:E.node,args:E.args}):S in s?(c[S]??(c[S]=[]),c[S].push(E)):(d[S]??(d[S]=[]),d[S].push(E)));o=void 0,Object.keys(n.channel_versions).length>0&&(o=b3(...Object.values(n.channel_versions)));const h=new Set;for(const[w,S]of Object.entries(c))if(w in s){let E;try{E=s[w].update(S)}catch(C){if(C.name===qn.unminifiable_name){const A=new qn(`Invalid update for channel "${w}" with values ${JSON.stringify(S)}: ${C.message}`);throw A.lc_error_code=C.lc_error_code,A}else throw C}E&&r!==void 0&&(n.channel_versions[w]=r(o,s[w]),s[w].isAvailable()&&h.add(w))}if(a)for(const w of Object.keys(s))s[w].isAvailable()&&!h.has(w)&&s[w].update([])&&r!==void 0&&(n.channel_versions[w]=r(o,s[w]),s[w].isAvailable()&&h.add(w));if(a&&n.pending_sends.length===0&&!Object.keys(i??{}).some(w=>h.has(w)))for(const w of Object.keys(s))s[w].finish()&&r!==void 0&&(n.channel_versions[w]=r(o,s[w]),s[w].isAvailable()&&h.add(w));return d}function om(n,e,t,r,i,a,s,o){const u={};for(let c=0;c<n.pending_sends.length;c+=1){const d=VR([Ba,c],n,e,t,r,i,a,s,o);d!==void 0&&(u[d.id]=d)}for(const c of Object.keys(t)){const d=VR([l_,c],n,e,t,r,i,a,s,o);d!==void 0&&(u[d.id]=d)}return u}function VR(n,e,t,r,i,a,s,o,u){const{step:c,checkpointer:d,manager:h}=u,m=s.configurable??{},g=m.checkpoint_ns??"";if(n[0]===Ba&&Cxe(n[n.length-1])){const _=n[n.length-1],w=Ixe(_.name,_.func),S=[Ba],E=g===""?_.name:`${g}${Bi}${_.name}`,C=td(JSON.stringify([E,c.toString(),_.name,Ba,n[1],n[2]]),e.id),A=`${E}${rc}${C}`,R={langgraph_step:c,langgraph_node:_.name,langgraph_triggers:S,langgraph_path:n.slice(0,3),langgraph_checkpoint_ns:A};{const P=[];return{name:_.name,input:_.input,proc:w,writes:P,config:fn(bs(s,{metadata:R,store:u.store??s.store}),{runName:_.name,callbacks:h==null?void 0:h.getChild(`graph:step:${c}`),configurable:{[sm]:C,[bd]:U=>UC(c,k=>P.push(...k),r,a,U),[tc]:(U,k=!1)=>c_(c,e,i,a,{name:_.name,writes:P,triggers:S,path:n.slice(0,3)},U,k),[Er]:d??m[Er],[Fa]:{...m[Fa],[g]:e.id},[nc]:jC({pendingWrites:t??[],taskId:C,currentTaskInput:_.input}),[o_]:e.channel_values[NC],checkpoint_id:void 0,checkpoint_ns:A}}),triggers:S,retry_policy:_.retry,cache_key:_.cache?{key:(_.cache.keyFunc??JSON.stringify)([_.input]),ns:[kC,_.name??"__dynamic__"],ttl:_.cache.ttl}:void 0,id:C,path:n.slice(0,3),writers:[]}}}else if(n[0]===Ba){const _=typeof n[1]=="number"?n[1]:parseInt(n[1],10);if(_>=e.pending_sends.length)return;const w=BR(e.pending_sends[_])&&!Yi(e.pending_sends[_])?new vb(e.pending_sends[_].node,e.pending_sends[_].args):e.pending_sends[_];if(!BR(w)){console.warn(`Ignoring invalid packet ${JSON.stringify(w)} in pending sends.`);return}if(!(w.node in r)){console.warn(`Ignoring unknown node name ${w.node} in pending sends.`);return}const S=[Ba],E=g===""?w.node:`${g}${Bi}${w.node}`,C=td(JSON.stringify([E,c.toString(),w.node,Ba,_.toString()]),e.id),A=`${E}${rc}${C}`;let R={langgraph_step:c,langgraph_node:w.node,langgraph_triggers:S,langgraph_path:n.slice(0,3),langgraph_checkpoint_ns:A};{const P=r[w.node],N=P.getNode();if(N!==void 0){a.replaceRuntimePlaceholders(c,w.args),P.metadata!==void 0&&(R={...R,...P.metadata});const U=[];return{name:w.node,input:w.args,proc:N,subgraphs:P.subgraphs,writes:U,config:fn(bs(s,{metadata:R,tags:P.tags,store:u.store??s.store}),{runName:w.node,callbacks:h==null?void 0:h.getChild(`graph:step:${c}`),configurable:{[sm]:C,[bd]:k=>UC(c,B=>U.push(...B),r,a,k),[tc]:(k,B=!1)=>c_(c,e,i,a,{name:w.node,writes:U,triggers:S,path:n},k,B),[Er]:d??m[Er],[Fa]:{...m[Fa],[g]:e.id},[nc]:jC({pendingWrites:t??[],taskId:C,currentTaskInput:w.args}),[o_]:e.channel_values[NC],checkpoint_id:void 0,checkpoint_ns:A}}),triggers:S,retry_policy:P.retryPolicy,cache_key:P.cachePolicy?{key:(P.cachePolicy.keyFunc??JSON.stringify)([w.args]),ns:[kC,P.name??"__dynamic__",w.node],ttl:P.cachePolicy.ttl}:void 0,id:C,path:n,writers:P.getWriters()}}}}else if(n[0]===l_){const _=n[1].toString(),w=r[_];if(w===void 0)return;if(t!=null&&t.length){const A=g===""?_:`${g}${Bi}${_}`,R=td(JSON.stringify([A,c.toString(),_,l_,_]),e.id);if(t.some(N=>N[0]===R&&N[1]!==Fi))return}const S=TH(e.channel_versions);if(S===void 0)return;const E=e.versions_seen[_]??{},C=w.triggers.filter(A=>{const R=ac(i,A,!1,!0);return!(R instanceof Error&&R.name===Zr.unminifiable_name)&&(e.channel_versions[A]??S)>(E[A]??S)}).sort();if(C.length>0){const A=kxe(c,w,a,i);if(A===void 0)return;const R=g===""?_:`${g}${Bi}${_}`,P=td(JSON.stringify([R,c.toString(),_,l_,C]),e.id),N=`${R}${rc}${P}`;let U={langgraph_step:c,langgraph_node:_,langgraph_triggers:C,langgraph_path:n,langgraph_checkpoint_ns:N};{const k=w.getNode();if(k!==void 0){w.metadata!==void 0&&(U={...U,...w.metadata});const B=[];return{name:_,input:A,proc:k,subgraphs:w.subgraphs,writes:B,config:fn(bs(s,{metadata:U,tags:w.tags,store:u.store??s.store}),{runName:_,callbacks:h==null?void 0:h.getChild(`graph:step:${c}`),configurable:{[sm]:P,[bd]:H=>UC(c,G=>{B.push(...G)},r,a,H),[tc]:(H,G=!1)=>c_(c,e,i,a,{name:_,writes:B,triggers:C,path:n},H,G),[Er]:d??m[Er],[Fa]:{...m[Fa],[g]:e.id},[nc]:jC({pendingWrites:t??[],taskId:P,currentTaskInput:A}),[o_]:e.channel_values[NC],checkpoint_id:void 0,checkpoint_ns:N}}),triggers:C,retry_policy:w.retryPolicy,cache_key:w.cachePolicy?{key:(w.cachePolicy.keyFunc??JSON.stringify)([A]),ns:[kC,w.name??"__dynamic__",_],ttl:w.cachePolicy.ttl}:void 0,id:P,path:n,writers:w.getWriters()}}}}}}function kxe(n,e,t,r,i){var s;let a;if(typeof e.channels=="object"&&!Array.isArray(e.channels)){a={};for(const[o,u]of Object.entries(e.channels))if(e.triggers.includes(u))try{a[o]=ac(r,u,!1)}catch(c){if(c.name===Zr.unminifiable_name)return;throw c}else if(u in r)try{a[o]=ac(r,u,!1)}catch(c){if(c.name===Zr.unminifiable_name)continue;throw c}else a[o]=(s=t.get(o))==null?void 0:s.call(n)}else if(Array.isArray(e.channels)){let o=!1;for(const u of e.channels)try{a=ac(r,u,!1),o=!0;break}catch(c){if(c.name===Zr.unminifiable_name)continue;throw c}if(!o)return}else throw new Error(`Invalid channels type, expected list or dict, got ${e.channels}`);return e.mapper!==void 0&&(a=e.mapper(a)),a}function jC({pendingWrites:n,taskId:e,currentTaskInput:t}){var a;const r=(a=n.find(([s,o])=>s===qa&&o===Ka))==null?void 0:a[2],i={callCounter:0,interruptCounter:-1,resume:n.filter(([s,o])=>s===e&&o===Ka).flatMap(([s,o,u])=>u),nullResume:r,subgraphCounter:0,currentTaskInput:t,consumeNullResume:()=>{if(i.nullResume)return delete i.nullResume,n.splice(n.findIndex(([s,o])=>s===qa&&o===Ka),1),r}};return i}function Nxe(n){return"steps"in n&&Array.isArray(n.steps)}function LO(n){return"lg_is_pregel"in n&&n.lg_is_pregel===!0}function AH(n){const e=[n];for(const t of e){if(LO(t))return t;Nxe(t)&&e.push(...t.steps)}}const Mm={blue:{start:"\x1B[34m",end:"\x1B[0m"},green:{start:"\x1B[32m",end:"\x1B[0m"},yellow:{start:"\x1B[33;1m",end:"\x1B[0m"}},Dm=(n,e)=>`${n.start}${e}${n.end}`;function*I3(n,e){var r;const t=new Date().toISOString();for(const{id:i,name:a,input:s,config:o,triggers:u,writes:c}of e){if((r=o==null?void 0:o.tags)!=null&&r.includes(cr))continue;const d=c.filter(([h,m])=>h===i&&m===Rn).map(([,h])=>h);yield{type:"task",timestamp:t,step:n,payload:{id:i,name:a,input:s,triggers:u,interrupts:d}}}}function*Mxe(n,e,t){var i;const r=new Date().toISOString();for(const[{id:a,name:s,config:o},u]of e)(i=o==null?void 0:o.tags)!=null&&i.includes(cr)||(yield{type:"task_result",timestamp:r,step:n,payload:{id:a,name:s,result:u.filter(([c])=>Array.isArray(t)?t.includes(c):c===t),interrupts:u.filter(c=>c[0]===Rn).map(c=>c[1])}})}function*Dxe(n,e,t,r,i,a,s,o,u){var g,_,w;function c(S){const E={};return S.callbacks!=null&&(E.callbacks=S.callbacks),S.configurable!=null&&(E.configurable=S.configurable),S.maxConcurrency!=null&&(E.max_concurrency=S.maxConcurrency),S.metadata!=null&&(E.metadata=S.metadata),S.recursionLimit!=null&&(E.recursion_limit=S.recursionLimit),S.runId!=null&&(E.run_id=S.runId),S.runName!=null&&(E.run_name=S.runName),S.tags!=null&&(E.tags=S.tags),E}const d=(g=e.configurable)==null?void 0:g.checkpoint_ns,h={};for(const S of a){if(!((_=S.subgraphs)!=null&&_.length?S.subgraphs:[S.proc]).find(AH))continue;let C=`${S.name}:${S.id}`;d&&(C=`${d}|${C}`),h[S.id]={configurable:{thread_id:(w=e.configurable)==null?void 0:w.thread_id,checkpoint_ns:C}}}yield{type:"checkpoint",timestamp:new Date().toISOString(),step:n,payload:{config:c(e),values:wc(t,r),metadata:i,next:a.map(S=>S.name),tasks:CH(a,s,h,u),parentConfig:o?c(o):void 0}}}function CH(n,e,t,r){return n.map(i=>{var c;const a=(c=e.find(([d,h])=>d===i.id&&h===Fi))==null?void 0:c[2],s=e.filter(([d,h])=>d===i.id&&h===Rn).map(([,,d])=>d),o=(()=>{var h;if(a||s.length||!e.length)return;const d=e.findIndex(([m,g])=>m===i.id&&g===Nd);if(d>=0)return e[d][2];if(typeof r=="string")return(h=e.find(([m,g])=>m===i.id&&g===r))==null?void 0:h[2];if(Array.isArray(r)){const m=e.filter(([g,_])=>g===i.id&&r.includes(_)).map(([,g,_])=>[g,_]);return m.length?Object.fromEntries(m):void 0}})();if(a)return{id:i.id,name:i.name,path:i.path,error:a,interrupts:s,result:o};const u=t==null?void 0:t[i.id];return{id:i.id,name:i.name,path:i.path,interrupts:s,...u!==void 0?{state:u}:{},result:o}})}function $xe(n,e,t){console.log([`${Dm(Mm.blue,`[${n}:checkpoint]`)}`,`\x1B[1m State at the end of step ${n}:\x1B[0m
`,JSON.stringify(wc(e,t),null,2)].join(""))}function xH(n,e){const t=e.length;console.log([`${Dm(Mm.blue,`[${n}:tasks]`)}`,`\x1B[1m Starting step ${n} with ${t} task${t===1?"":"s"}:\x1B[0m
`,e.map(r=>`- ${Dm(Mm.green,String(r.name))} -> ${JSON.stringify(r.input,null,2)}`).join(`
`)].join(""))}function Lxe(n,e,t){const r={};for(const[i,a]of e)t.includes(i)&&(r[i]||(r[i]=[]),r[i].push(a));console.log([`${Dm(Mm.blue,`[${n}:writes]`)}`,`\x1B[1m Finished step ${n} with writes to ${Object.keys(r).length} channel${Object.keys(r).length!==1?"s":""}:\x1B[0m
`,Object.entries(r).map(([i,a])=>`- ${Dm(Mm.yellow,i)} -> ${a.map(s=>JSON.stringify(s)).join(", ")}`).join(`
`)].join(""))}class P3 extends li{constructor(e,t){const r=e.getReader(),i=t??new AbortController;super({start(a){return s();function s(){return r.read().then(({done:o,value:u})=>{if(o){a.close();return}return a.enqueue(u),s()})}}}),Object.defineProperty(this,"_abortController",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._abortController=i,this._reader=r}async cancel(e){this._abortController.abort(e),this._reader.releaseLock()}get signal(){return this._abortController.signal}}class RH extends li{get closed(){return this._closed}constructor(e){let t;const r=new Promise(i=>{t=i});super({start:i=>{t(i)}}),Object.defineProperty(this,"modes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"controller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"passthroughFn",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),r.then(i=>{this.controller=i}),this.passthroughFn=e.passthroughFn,this.modes=e.modes}push(e){var t;(t=this.passthroughFn)==null||t.call(this,e),this.controller.enqueue(e)}close(){try{this.controller.close()}catch{}finally{this._closed=!0}}error(e){this.controller.error(e)}}const Rv=Symbol.for("INPUT_DONE"),FC=Symbol.for("INPUT_RESUMING"),Uxe=25;function jxe(...n){return new RH({passthroughFn:e=>{for(const t of n)t.modes.has(e[1])&&t.push(e)},modes:new Set(n.flatMap(e=>Array.from(e.modes)))})}class Fxe extends exe{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:Promise.resolve()}),this.cache=e}async get(e){return this.enqueueOperation("get",e)}async set(e){return this.enqueueOperation("set",e)}async clear(e){return this.enqueueOperation("clear",e)}async stop(){await this.queue}enqueueOperation(e,...t){const r=this.queue.then(()=>this.cache[e](...t));return this.queue=r.then(()=>{},()=>{}),r}}class UO{get isResuming(){var o,u;const e=Object.keys(this.checkpoint.channel_versions).length!==0,r=((o=this.config.configurable)==null?void 0:o[Bl])!==void 0&&((u=this.config.configurable)==null?void 0:u[Bl]),i=this.input===null||this.input===void 0,a=Kr(this.input)&&this.input.resume!=null,s=this.input===FC;return e&&(r||i||a||s)}constructor(e){Object.defineProperty(this,"input",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkpointer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkpointerGetNextVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channels",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"managed",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkpoint",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkpointConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkpointMetadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkpointNamespace",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkpointPendingWrites",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"checkpointPreviousVersions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"step",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKeys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamKeys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"skipDoneTasks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"prevCheckpointConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:"pending"}),Object.defineProperty(this,"tasks",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"stream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkpointerPromises",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"isNested",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_checkpointerChainedPromise",{enumerable:!0,configurable:!0,writable:!0,value:Promise.resolve()}),Object.defineProperty(this,"store",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"interruptAfter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"interruptBefore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"toInterrupt",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"triggerToNodes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.input=e.input,this.checkpointer=e.checkpointer,this.checkpointer!==void 0?this.checkpointerGetNextVersion=this.checkpointer.getNextVersion.bind(this.checkpointer):this.checkpointerGetNextVersion=Pxe,this.checkpoint=e.checkpoint,this.checkpointMetadata=e.checkpointMetadata,this.checkpointPreviousVersions=e.checkpointPreviousVersions,this.channels=e.channels,this.managed=e.managed,this.checkpointPendingWrites=e.checkpointPendingWrites,this.step=e.step,this.stop=e.stop,this.config=e.config,this.checkpointConfig=e.checkpointConfig,this.isNested=e.isNested,this.manager=e.manager,this.outputKeys=e.outputKeys,this.streamKeys=e.streamKeys,this.nodes=e.nodes,this.skipDoneTasks=e.skipDoneTasks,this.store=e.store,this.cache=e.cache?new Fxe(e.cache):void 0,this.stream=e.stream,this.checkpointNamespace=e.checkpointNamespace,this.prevCheckpointConfig=e.prevCheckpointConfig,this.interruptAfter=e.interruptAfter,this.interruptBefore=e.interruptBefore,this.debug=e.debug,this.triggerToNodes=e.triggerToNodes}static async initialize(e){var A,R,P,N,U,k,B,H,G,z,oe,te;let{config:t,stream:r}=e;r!==void 0&&((A=t.configurable)==null?void 0:A[yb])!==void 0&&(r=jxe(r,t.configurable[yb]));const i=t.configurable?!("checkpoint_id"in t.configurable):!0,a=(R=t.configurable)==null?void 0:R[nc];t.configurable&&a&&(a.subgraphCounter>0&&(t=Wl(t,{[FR]:[t.configurable[FR],a.subgraphCounter.toString()].join(Bi)})),a.subgraphCounter+=1);const s=tc in(t.configurable??{});!s&&((P=t.configurable)==null?void 0:P.checkpoint_ns)!==void 0&&((N=t.configurable)==null?void 0:N.checkpoint_ns)!==""&&(t=Wl(t,{checkpoint_ns:"",checkpoint_id:void 0}));let o=t;((U=t.configurable)==null?void 0:U[Fa])!==void 0&&((H=(k=t.configurable)==null?void 0:k[Fa])!=null&&H[(B=t.configurable)==null?void 0:B.checkpoint_ns])&&(o=Wl(t,{checkpoint_id:t.configurable[Fa][(G=t.configurable)==null?void 0:G.checkpoint_ns]}));const u=((oe=(z=t.configurable)==null?void 0:z.checkpoint_ns)==null?void 0:oe.split(Bi))??[],c=await((te=e.checkpointer)==null?void 0:te.getTuple(o))??{config:t,checkpoint:yH(),metadata:{source:"input",step:-2,writes:null,parents:{}},pendingWrites:[]};o={...t,...c.config,configurable:{checkpoint_ns:"",...t.configurable,...c.config.configurable}};const d=c.parentConfig,h=mb(c.checkpoint),m={...c.metadata},g=c.pendingWrites??[],_=gb(e.channelSpecs,h),w=(m.step??0)+1,S=w+(t.recursionLimit??Uxe)+1,E={...h.channel_versions},C=e.store?new QCe(e.store):void 0;return C&&C.start(),new UO({input:e.input,config:t,checkpointer:e.checkpointer,checkpoint:h,checkpointMetadata:m,checkpointConfig:o,prevCheckpointConfig:d,checkpointNamespace:u,channels:_,managed:e.managed,isNested:s,manager:e.manager,skipDoneTasks:i,step:w,stop:S,checkpointPreviousVersions:E,checkpointPendingWrites:g,outputKeys:e.outputKeys??[],streamKeys:e.streamKeys??[],nodes:e.nodes,stream:r,store:C,cache:e.cache,interruptAfter:e.interruptAfter,interruptBefore:e.interruptBefore,debug:e.debug,triggerToNodes:e.triggerToNodes})}_checkpointerPutAfterPrevious(e){this._checkpointerChainedPromise=this._checkpointerChainedPromise.then(()=>{var t;return(t=this.checkpointer)==null?void 0:t.put(e.config,e.checkpoint,e.metadata,e.newVersions)}),this.checkpointerPromises.push(this._checkpointerChainedPromise)}async updateManagedValues(e,t){const r=this.managed.get(e);r&&"update"in r&&typeof r.update=="function"&&await r.update(t)}putWrites(e,t){var s,o;let r=t;if(r.length===0)return;r.every(([u])=>u in w3)&&(r=Array.from(new Map(r.map(u=>[u[0],u])).values()));for(const[u,c]of r){const d=this.checkpointPendingWrites.findIndex(h=>h[0]===e&&h[1]===u);u in w3&&d!==-1?this.checkpointPendingWrites[d]=[e,u,c]:this.checkpointPendingWrites.push([e,u,c])}const i=(o=this.checkpointer)==null?void 0:o.putWrites({...this.checkpointConfig,configurable:{...this.checkpointConfig.configurable,checkpoint_ns:((s=this.config.configurable)==null?void 0:s.checkpoint_ns)??"",checkpoint_id:this.checkpoint.id}},r,e);if(i!==void 0&&this.checkpointerPromises.push(i),this.tasks&&this._outputWrites(e,r),!t.length||!this.cache||!this.tasks)return;const a=this.tasks[e];a==null||a.cache_key==null||t[0][0]===Fi||t[0][0]===Rn||this.cache.set([{key:[a.cache_key.ns,a.cache_key.key],value:a.writes,ttl:a.cache_key.ttl}])}_outputWrites(e,t,r=!1){const i=this.tasks[e];if(i!==void 0){if(i.config!==void 0&&(i.config.tags??[]).includes(cr))return;t.length>0&&t[0][0]!==Fi&&t[0][0]!==Rn&&this._emit(Lp(Ul(R3(this.outputKeys,[[i,t]],r),"updates"))),r||this._emit(Lp(Ul(Mxe(this.step,[[i,t]],this.streamKeys),"debug")))}}async _matchCachedWrites(){if(!this.cache)return[];const e=[],t=([s,o])=>`ns:${s.join(",")}|key:${o}`,r=[],i={};for(const s of Object.values(this.tasks))s.cache_key!=null&&!s.writes.length&&(r.push([s.cache_key.ns,s.cache_key.key]),i[t([s.cache_key.ns,s.cache_key.key])]=s);if(r.length===0)return[];const a=await this.cache.get(r);for(const{key:s,value:o}of a){const u=i[t(s)];u!=null&&(u.writes.push(...o),e.push({task:u,result:o}))}return e}async tick(e){var a,s,o;this.store&&!this.store.isRunning&&((a=this.store)==null||a.start());const{inputKeys:t=[]}=e;if(this.status!=="pending")throw new Error(`Cannot tick when status is no longer "pending". Current status: "${this.status}"`);if(![Rv,FC].includes(this.input))await this._first(t);else{if(this.toInterrupt.length>0)throw this.status="interrupt_before",new am;if(Object.values(this.tasks).every(u=>u.writes.length>0)){const u=Object.values(this.tasks).flatMap(h=>h.writes),c=ga(this.checkpoint,this.channels,Object.values(this.tasks),this.checkpointerGetNextVersion,this.triggerToNodes);for(const[h,m]of Object.entries(c))await this.updateManagedValues(h,m);const d=await Vl(Ul(LC(this.outputKeys,u,this.channels),"values"));if(this._emit(d),this.checkpointPendingWrites=[],await this._putCheckpoint({source:"loop",writes:R3(this.outputKeys,Object.values(this.tasks).map(h=>[h,h.writes])).next().value??null}),xv(this.checkpoint,this.interruptAfter,Object.values(this.tasks)))throw this.status="interrupt_after",new am;((s=this.config.configurable)==null?void 0:s[Bl])!==void 0&&((o=this.config.configurable)==null||delete o[Bl])}else return!1}if(this.step>this.stop)return this.status="out_of_steps",!1;const r=om(this.checkpoint,this.checkpointPendingWrites,this.nodes,this.channels,this.managed,this.config,!0,{step:this.step,checkpointer:this.checkpointer,isResuming:this.isResuming,manager:this.manager,store:this.store,stream:this.stream});if(this.tasks=r,this.checkpointer&&this._emit(await Vl(Ul(Dxe(this.step-1,this.checkpointConfig,this.channels,this.streamKeys,this.checkpointMetadata,Object.values(this.tasks),this.checkpointPendingWrites,this.prevCheckpointConfig,this.outputKeys),"debug"))),Object.values(this.tasks).length===0)return this.status="done",!1;if(this.skipDoneTasks&&this.checkpointPendingWrites.length>0){for(const[u,c,d]of this.checkpointPendingWrites){if(c===Fi||c===Rn||c===Ka)continue;const h=Object.values(this.tasks).find(m=>m.id===u);h&&h.writes.push([c,d])}for(const u of Object.values(this.tasks))u.writes.length>0&&this._outputWrites(u.id,u.writes,!0)}if(Object.values(this.tasks).every(u=>u.writes.length>0))return this.tick({inputKeys:t});if(xv(this.checkpoint,this.interruptBefore,Object.values(this.tasks)))throw this.status="interrupt_before",new am;const i=await Vl(Ul(I3(this.step,Object.values(this.tasks)),"debug"));return this._emit(i),!0}async finishAndHandleError(e){const t=this._suppressInterrupt(e);if((t||e===void 0)&&(this.output=wc(this.channels,this.outputKeys)),t){if(this.tasks!==void 0&&this.checkpointPendingWrites.length>0&&Object.values(this.tasks).some(i=>i.writes.length>0)){const i=ga(this.checkpoint,this.channels,Object.values(this.tasks),this.checkpointerGetNextVersion,this.triggerToNodes);for(const[a,s]of Object.entries(i))await this.updateManagedValues(a,s);this._emit(Lp(Ul(LC(this.outputKeys,Object.values(this.tasks).flatMap(a=>a.writes),this.channels),"values")))}const r={[Rn]:e.interrupts};this._emit([["updates",r],["values",r]])}return t}async acceptPush(e,t,r){var s,o;if(((s=this.interruptAfter)==null?void 0:s.length)>0&&xv(this.checkpoint,this.interruptAfter,[e])){this.toInterrupt.push(e);return}const i=VR([Ba,e.path??[],t,e.id,r],this.checkpoint,this.checkpointPendingWrites,this.nodes,this.channels,this.managed,e.config??{},!0,{step:this.step,checkpointer:this.checkpointer,manager:this.manager,store:this.store,stream:this.stream});if(!i)return;if(((o=this.interruptBefore)==null?void 0:o.length)>0&&xv(this.checkpoint,this.interruptBefore,[i])){this.toInterrupt.push(i);return}this._emit(Lp(Ul(I3(this.step,[i]),"debug"))),this.debug&&xH(this.step,[i]),this.tasks[i.id]=i,this.skipDoneTasks&&this._matchWrites({[i.id]:i});const a=await this._matchCachedWrites();for(const{task:u}of a)this._outputWrites(u.id,u.writes,!0);return i}_suppressInterrupt(e){return rd(e)&&!this.isNested}async _first(e){const{configurable:t}=this.config,r=t==null?void 0:t[nc];if(r&&r.nullResume!==void 0&&this.putWrites(qa,[[Ka,r.nullResume]]),Kr(this.input)){if(this.input.resume!=null&&this.checkpointer==null)throw new Error("Cannot use Command(resume=...) without checkpointer");const o={};for(const[u,c,d]of Txe(this.input,this.checkpointPendingWrites))o[u]===void 0&&(o[u]=[]),o[u].push([c,d]);if(Object.keys(o).length===0)throw new S3("Received empty Command input");for(const[u,c]of Object.entries(o))this.putWrites(u,c)}const i=(this.checkpointPendingWrites??[]).filter(s=>s[0]===qa).map(s=>s.slice(1));i.length>0&&ga(this.checkpoint,this.channels,[{name:Bo,writes:i,triggers:[]}],this.checkpointerGetNextVersion,this.triggerToNodes);const a=Kr(this.input)&&i.length>0;if(this.isResuming||a){for(const o of Object.keys(this.channels))if(this.checkpoint.channel_versions[o]!==void 0){const u=this.checkpoint.channel_versions[o];this.checkpoint.versions_seen[Rn]={...this.checkpoint.versions_seen[Rn],[o]:u}}const s=await Vl(Ul(LC(this.outputKeys,!0,this.channels),"values"));this._emit(s)}if(this.isResuming)this.input=FC;else if(a)await this._putCheckpoint({source:"input",writes:{}}),this.input=Rv;else{const s=await Vl(SH(e,this.input));if(s.length>0){const o=om(this.checkpoint,this.checkpointPendingWrites,this.nodes,this.channels,this.managed,this.config,!0,{step:this.step});ga(this.checkpoint,this.channels,Object.values(o).concat([{name:Bo,writes:s,triggers:[]}]),this.checkpointerGetNextVersion,this.triggerToNodes),await this._putCheckpoint({source:"input",writes:Object.fromEntries(s)}),this.input=Rv}else if(Bl in(this.config.configurable??{}))this.input=Rv;else throw new S3(`Received no input writes for ${JSON.stringify(e,null,2)}`)}this.isNested||(this.config=Wl(this.config,{[Bl]:this.isResuming}))}_emit(e){for(const t of e)this.stream.modes.has(t[0])&&this.stream.push([this.checkpointNamespace,...t])}async _putCheckpoint(e){var r,i,a,s;const t={...e,step:this.step,parents:((r=this.config.configurable)==null?void 0:r[Fa])??{}};if(this.checkpointer!==void 0){this.prevCheckpointConfig=(a=(i=this.checkpointConfig)==null?void 0:i.configurable)!=null&&a.checkpoint_id?this.checkpointConfig:void 0,this.checkpointMetadata=t,this.checkpoint=Fu(this.checkpoint,this.channels,this.step),this.checkpointConfig={...this.checkpointConfig,configurable:{...this.checkpointConfig.configurable,checkpoint_ns:((s=this.config.configurable)==null?void 0:s.checkpoint_ns)??""}};const o={...this.checkpoint.channel_versions},u=qR(this.checkpointPreviousVersions,o);this.checkpointPreviousVersions=o,this._checkpointerPutAfterPrevious({config:{...this.checkpointConfig},checkpoint:mb(this.checkpoint),metadata:{...this.checkpointMetadata},newVersions:u}),this.checkpointConfig={...this.checkpointConfig,configurable:{...this.checkpointConfig.configurable,checkpoint_id:this.checkpoint.id}}}this.step+=1}_matchWrites(e){for(const[t,r,i]of this.checkpointPendingWrites){if(r===Fi||r===Rn||r===Ka)continue;const a=Object.values(e).find(s=>s.id===t);a&&a.writes.push([r,i])}for(const t of Object.values(e))t.writes.length>0&&this._outputWrites(t.id,t.writes,!0)}}function Bxe(n){return Vn(n==null?void 0:n.message)}class qxe extends Rc{constructor(e){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"StreamMessagesHandler"}),Object.defineProperty(this,"streamFn",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadatas",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"seen",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"emittedChatModelRunIds",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"stableMessageIdMap",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.streamFn=e}_emit(e,t,r,i=!1){var s;if(i&&t.id!==void 0&&this.seen[t.id]!==void 0)return;let a=t.id;r!=null&&(um(t)?a??(a=`run-${r}-tool-${t.tool_call_id}`):((a==null||a===`run-${r}`)&&(a=this.stableMessageIdMap[r]??a??`run-${r}`),(s=this.stableMessageIdMap)[r]??(s[r]=a))),a!==t.id&&(t.id=a,t.lc_kwargs.id=a),t.id!=null&&(this.seen[t.id]=t),this.streamFn([e[0],"messages",[t,e[1]]])}handleChatModelStart(e,t,r,i,a,s,o,u){o&&(!s||!s.includes(hxe)&&!s.includes("nostream"))&&(this.metadatas[r]=[o.langgraph_checkpoint_ns.split("|"),{tags:s,name:u,...o}])}handleLLMNewToken(e,t,r,i,a,s){const o=s==null?void 0:s.chunk;this.emittedChatModelRunIds[r]=!0,this.metadatas[r]!==void 0&&(Bxe(o)?this._emit(this.metadatas[r],o.message,r):this._emit(this.metadatas[r],new xn({content:e}),r))}handleLLMEnd(e,t){var r,i;if(!this.emittedChatModelRunIds[t]){const a=(i=(r=e.generations)==null?void 0:r[0])==null?void 0:i[0];Vn(a==null?void 0:a.message)&&this._emit(this.metadatas[t],a==null?void 0:a.message,t,!0),delete this.emittedChatModelRunIds[t]}delete this.metadatas[t],delete this.stableMessageIdMap[t]}handleLLMError(e,t){delete this.metadatas[t]}handleChainStart(e,t,r,i,a,s,o,u){if(s!==void 0&&u===s.langgraph_node&&(a===void 0||!a.includes(cr))&&(this.metadatas[r]=[s.langgraph_checkpoint_ns.split("|"),{tags:a,name:u,...s}],typeof t=="object")){for(const c of Object.values(t))if((Vn(c)||wd(c))&&c.id!==void 0)this.seen[c.id]=c;else if(Array.isArray(c))for(const d of c)(Vn(d)||wd(d))&&d.id!==void 0&&(this.seen[d.id]=d)}}handleChainEnd(e,t){const r=this.metadatas[t];if(delete this.metadatas[t],r!==void 0){if(Vn(e))this._emit(r,e,t,!0);else if(Array.isArray(e))for(const i of e)Vn(i)&&this._emit(r,i,t,!0);else if(e!=null&&typeof e=="object"){for(const i of Object.values(e))if(Vn(i))this._emit(r,i,t,!0);else if(Array.isArray(i))for(const a of i)Vn(a)&&this._emit(r,a,t,!0)}}}handleChainError(e,t){delete this.metadatas[t]}}const Vxe=500,zxe=2,Hxe=128e3,Gxe=3,Wxe=[400,401,402,403,404,405,406,407,409],Kxe=n=>{var t,r;if(n.message.startsWith("Cancel")||n.message.startsWith("AbortError")||n.name==="AbortError"||(n==null?void 0:n.code)==="ECONNABORTED")return!1;const e=((t=n==null?void 0:n.response)==null?void 0:t.status)??(n==null?void 0:n.status);return!(e&&Wxe.includes(+e)||((r=n==null?void 0:n.error)==null?void 0:r.code)==="insufficient_quota")};async function IH(n,e,t,r){var d;const i=n.retry_policy??e;let a=i!==void 0?i.initialInterval??Vxe:0,s=0,o,u,{config:c}=n;for(t&&(c=Wl(c,t)),c={...c,signal:r};!(r!=null&&r.aborted);){n.writes.splice(0,n.writes.length),o=void 0;try{u=await n.proc.invoke(n.input,c);break}catch(h){if(o=h,o.pregelTaskId=n.id,nxe(o)){const w=(d=c==null?void 0:c.configurable)==null?void 0:d.checkpoint_ns,S=o.command;if(S.graph===w){for(const E of n.writers)await E.invoke(S,c);o=void 0;break}else if(S.graph===qi.PARENT){const E=_xe(w);o.command=new qi({...o.command,graph:E})}}if(s_(o)||i===void 0||(s+=1,s>=(i.maxAttempts??Gxe))||!(i.retryOn??Kxe)(o))break;a=Math.min(i.maxInterval??Hxe,a*(i.backoffFactor??zxe));const g=i.jitter?Math.floor(a+Math.random()*1e3):a;await new Promise(w=>setTimeout(w,g));const _=o.name??o.constructor.unminifiable_name??o.constructor.name;((i==null?void 0:i.logWarning)??!0)&&console.log(`Retrying task "${String(n.name)}" after ${a.toFixed(2)}ms (attempt ${s}) after ${_}: ${o}`),c=Wl(c,{[Bl]:!0})}}return{task:n,result:u,error:o,signalAborted:r==null?void 0:r.aborted}}const zR=Symbol.for("promiseAdded");function Jxe(){const n={next:()=>{},wait:Promise.resolve(zR)};function e(t){n.next=()=>{n.wait=new Promise(e),t(zR)}}return n.wait=new Promise(e),n}class Yxe{constructor({loop:e,nodeFinished:t}){Object.defineProperty(this,"nodeFinished",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.loop=e,this.nodeFinished=t}async tick(e={}){const{timeout:t,retryPolicy:r,onStepWrite:i,maxConcurrency:a}=e,s=new Set;let o;const u=new AbortController,c=Object.values(this.loop.tasks).filter(m=>m.writes.length===0),d=this._initializeAbortSignals({exceptionSignalController:u,timeout:t,signal:e.signal}),h=this._executeTasksWithRetry(c,{signals:d,retryPolicy:r,maxConcurrency:a});for await(const{task:m,error:g,signalAborted:_}of h)this._commit(m,g),rd(g)||s_(g)&&!rd(o)?o=g:g&&(s.size===0||!_)&&(u.abort(),s.add(g));if(i==null||i(this.loop.step,Object.values(this.loop.tasks).map(m=>m.writes).flat()),s.size===1)throw Array.from(s)[0];if(s.size>1)throw new AggregateError(Array.from(s),`Multiple errors occurred during superstep ${this.loop.step}. See the "errors" field of this exception for more details.`);if(rd(o)||s_(o)&&this.loop.isNested)throw o}_initializeAbortSignals({exceptionSignalController:e,timeout:t,signal:r}){var h;const i=((h=this.loop.config.configurable)==null?void 0:h[C3])??{},s=r&&i.composedAbortSignal&&r!==i.composedAbortSignal?id(i.externalAbortSignal,r):i.externalAbortSignal??r,o=i.errorAbortSignal?id(i.errorAbortSignal,e.signal):e.signal,u=t?AbortSignal.timeout(t):void 0,c=id(...s?[s]:[],...u?[u]:[],o),d={externalAbortSignal:s,errorAbortSignal:o,timeoutAbortSignal:u,composedAbortSignal:c};return this.loop.config=Wl(this.loop.config,{[C3]:d}),d}async*_executeTasksWithRetry(e,t){var g;const{retryPolicy:r,maxConcurrency:i,signals:a}=t??{},s=Jxe(),o={},u={executingTasksMap:o,barrier:s,retryPolicy:r,scheduleTask:async(_,w,S)=>this.loop.acceptPush(_,w,S)};if((g=a==null?void 0:a.composedAbortSignal)!=null&&g.aborted)throw new Error("Abort");let c=0,d;const h=a!=null&&a.externalAbortSignal||a!=null&&a.timeoutAbortSignal?id(...a.externalAbortSignal?[a.externalAbortSignal]:[],...a.timeoutAbortSignal?[a.timeoutAbortSignal]:[]):void 0,m=h?new Promise((_,w)=>{d=()=>w(new Error("Abort")),h.addEventListener("abort",d,{once:!0})}):void 0;for(;(c===0||Object.keys(o).length>0)&&e.length;){for(;Object.values(o).length<(i??e.length)&&c<e.length;c+=1){const w=e[c];o[w.id]=IH(w,r,{[NO]:f_==null?void 0:f_.bind(u,this,w)},a==null?void 0:a.composedAbortSignal).catch(S=>{var E;return{task:w,error:S,signalAborted:(E=a==null?void 0:a.composedAbortSignal)==null?void 0:E.aborted}})}const _=await Promise.race([...Object.values(o),...m?[m]:[],s.wait]);_!==zR&&(yield _,delete o[_.task.id])}}_commit(e,t){var r;if(t!==void 0)if(rd(t)){if(t.interrupts.length){const i=t.interrupts.map(s=>[Rn,s]),a=e.writes.filter(s=>s[0]===Ka);a.length&&i.push(...a),this.loop.putWrites(e.id,i)}}else s_(t)&&e.writes.length?this.loop.putWrites(e.id,e.writes):this.loop.putWrites(e.id,[[Fi,{message:t.message,name:t.name}]]);else this.nodeFinished&&(((r=e.config)==null?void 0:r.tags)==null||!e.config.tags.includes(cr))&&this.nodeFinished(String(e.name)),e.writes.length===0&&e.writes.push([MO,null]),this.loop.putWrites(e.id,e.writes)}}async function f_(n,e,t,r,i,a={}){var h,m;const s=(m=(h=e.config)==null?void 0:h.configurable)==null?void 0:m[nc];if(!s)throw new Error(`BUG: No scratchpad found on task ${e.name}__${e.id}`);const o=s.callCounter;s.callCounter+=1;const u=new Axe({func:t,name:r,input:i,cache:a.cache,retry:a.retry,callbacks:a.callbacks}),c=await this.scheduleTask(e,o,u);if(!c)return;const d=this.executingTasksMap[c.id];if(d!==void 0)return d;if(c.writes.length>0){const g=c.writes.filter(([w])=>w===Nd),_=c.writes.filter(([w])=>w===Fi);if(g.length>0){if(g.length===1)return Promise.resolve(g[0][1]);throw new Error(`BUG: multiple returns found for task ${c.name}__${c.id}`)}if(_.length>0){if(_.length===1){const w=_[0][1],S=w instanceof Error?w:new Error(String(w));return Promise.reject(S)}throw new Error(`BUG: multiple errors found for task ${c.name}__${c.id}`)}return}else{const g=IH(c,a.retry,{[NO]:f_.bind(this,n,c)});return this.executingTasksMap[c.id]=g,this.barrier.next(),g.then(({result:_,error:w})=>w?Promise.reject(w):_)}}class Do extends Error{constructor(e){super(e),this.name="GraphValidationError"}}function Zxe({nodes:n,channels:e,inputChannels:t,outputChannels:r,streamChannels:i,interruptAfterNodes:a,interruptBeforeNodes:s}){if(!e)throw new Do("Channels not provided");const o=new Set,u=new Set;for(const[c,d]of Object.entries(n)){if(c===Rn)throw new Do(`"Node name ${Rn} is reserved"`);if(d.constructor===ao)d.triggers.forEach(h=>o.add(h));else throw new Do(`Invalid node type ${typeof d}, expected PregelNode`)}for(const c of o)if(!(c in e))throw new Do(`Subcribed channel '${String(c)}' not in channels`);if(Array.isArray(t)){if(t.every(c=>!o.has(c)))throw new Do(`None of the input channels ${t} are subscribed to by any node`)}else if(!o.has(t))throw new Do(`Input channel ${String(t)} is not subscribed to by any node`);Array.isArray(r)?r.forEach(c=>u.add(c)):u.add(r),i&&!Array.isArray(i)?u.add(i):Array.isArray(i)&&i.forEach(c=>u.add(c));for(const c of u)if(!(c in e))throw new Do(`Output channel '${String(c)}' not in channels`);if(a&&a!=="*"){for(const c of a)if(!(c in n))throw new Do(`Node ${String(c)} not in nodes`)}if(s&&s!=="*"){for(const c of s)if(!(c in n))throw new Do(`Node ${String(c)} not in nodes`)}}function O3(n,e){if(Array.isArray(n)){for(const t of n)if(!(t in e))throw new Error(`Key ${String(t)} not found in channels`)}else if(!(n in e))throw new Error(`Key ${String(n)} not found in channels`)}class Xxe{static subscribeTo(e,t){const{key:r,tags:i}={key:void 0,tags:void 0,...t??{}};if(Array.isArray(e)&&r!==void 0)throw new Error("Can't specify a key when subscribing to multiple channels");let a;typeof e=="string"?r?a={[r]:e}:a=[e]:a=Object.fromEntries(e.map(o=>[o,o]));const s=Array.isArray(e)?e:[e];return new ao({channels:a,triggers:s,tags:i})}static writeTo(e,t){const r=[];for(const i of e)r.push({channel:i,value:ic,skipNone:!1});for(const[i,a]of Object.entries(t??{}))Gt.isRunnable(a)||typeof a=="function"?r.push({channel:i,value:ic,skipNone:!0,mapper:Yr(a)}):r.push({channel:i,value:a,skipNone:!1});return new Dr(r)}}class Qxe extends Gt{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langgraph","pregel"]})}invoke(e,t){throw new Error("Not implemented")}withConfig(e){return super.withConfig(e)}stream(e,t){return super.stream(e,t)}}class eRe extends Qxe{static lc_name(){return"LangGraph"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langgraph","pregel"]}),Object.defineProperty(this,"lg_is_pregel",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channels",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputChannels",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputChannels",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoValidate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"streamMode",{enumerable:!0,configurable:!0,writable:!0,value:["values"]}),Object.defineProperty(this,"streamChannels",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"interruptAfter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"interruptBefore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stepTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"checkpointer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"retryPolicy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"store",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"triggerToNodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{streamMode:t}=e;t!=null&&!Array.isArray(t)&&(t=[t]),this.nodes=e.nodes,this.channels=e.channels,this.autoValidate=e.autoValidate??this.autoValidate,this.streamMode=t??this.streamMode,this.inputChannels=e.inputChannels,this.outputChannels=e.outputChannels,this.streamChannels=e.streamChannels??this.streamChannels,this.interruptAfter=e.interruptAfter,this.interruptBefore=e.interruptBefore,this.stepTimeout=e.stepTimeout??this.stepTimeout,this.debug=e.debug??this.debug,this.checkpointer=e.checkpointer,this.retryPolicy=e.retryPolicy,this.config=e.config,this.store=e.store,this.cache=e.cache,this.name=e.name,this.autoValidate&&this.validate()}withConfig(e){const t=bs(this.config,e);return new this.constructor({...this,config:t})}validate(){var e;Zxe({nodes:this.nodes,channels:this.channels,outputChannels:this.outputChannels,inputChannels:this.inputChannels,streamChannels:this.streamChannels,interruptAfterNodes:this.interruptAfter,interruptBeforeNodes:this.interruptBefore});for(const[t,r]of Object.entries(this.nodes))for(const i of r.triggers)(e=this.triggerToNodes)[i]??(e[i]=[]),this.triggerToNodes[i].push(t);return this}get streamChannelsList(){return Array.isArray(this.streamChannels)?this.streamChannels:this.streamChannels?[this.streamChannels]:Object.keys(this.channels)}get streamChannelsAsIs(){return this.streamChannels?this.streamChannels:Object.keys(this.channels)}async getGraphAsync(e){return this.getGraph(e)}*getSubgraphs(e,t){var r;for(const[i,a]of Object.entries(this.nodes)){if(e!==void 0&&!e.startsWith(i))continue;const s=(r=a.subgraphs)!=null&&r.length?a.subgraphs:[a.bound];for(const o of s){const u=AH(o);if(u!==void 0){if(i===e){yield[i,u];return}if(e===void 0&&(yield[i,u]),t){let c=e;e!==void 0&&(c=e.slice(i.length+1));for(const[d,h]of u.getSubgraphs(c,t))yield[`${i}${Bi}${d}`,h]}}}}}async*getSubgraphsAsync(e,t){yield*this.getSubgraphs(e,t)}async _prepareStateSnapshot({config:e,saved:t,subgraphCheckpointer:r,applyPendingWrites:i=!1}){var g,_,w,S,E,C,A,R;if(t===void 0)return{values:{},next:[],config:e,tasks:[]};const{managed:a}=await this.prepareSpecs(e,{skipManaged:!0}),s=gb(this.channels,t.checkpoint);if((g=t.pendingWrites)!=null&&g.length){const P=t.pendingWrites.filter(([N,U])=>N===qa).map(([N,U,k])=>[String(U),k]);P.length>0&&ga(t.checkpoint,s,[{name:Bo,writes:P,triggers:[]}],void 0,this.triggerToNodes)}const o=Object.values(om(t.checkpoint,t.pendingWrites,this.nodes,s,a,t.config,!0,{step:(((_=t.metadata)==null?void 0:_.step)??-1)+1,store:this.store})),u=await Vl(this.getSubgraphsAsync()),c=((w=t.config.configurable)==null?void 0:w.checkpoint_ns)??"",d={};for(const P of o){const N=u.find(([k])=>k===P.name);if(!N)continue;let U=`${String(P.name)}${rc}${P.id}`;if(c&&(U=`${c}${Bi}${U}`),r===void 0){const k={configurable:{thread_id:(S=t.config.configurable)==null?void 0:S.thread_id,checkpoint_ns:U}};d[P.id]=k}else{const k={configurable:{[Er]:r,thread_id:(E=t.config.configurable)==null?void 0:E.thread_id,checkpoint_ns:U}},B=N[1];d[P.id]=await B.getState(k,{subgraphs:!0})}}if(i&&((C=t.pendingWrites)!=null&&C.length)){const P=Object.fromEntries(o.map(U=>[U.id,U]));for(const[U,k,B]of t.pendingWrites)[Fi,Rn,r_].includes(k)||U in P&&P[U].writes.push([String(k),B]);const N=o.filter(U=>U.writes.length>0);N.length>0&&ga(t.checkpoint,s,N,void 0,this.triggerToNodes)}let h=t==null?void 0:t.metadata;h&&((R=(A=t==null?void 0:t.config)==null?void 0:A.configurable)!=null&&R.thread_id)&&(h={...h,thread_id:t.config.configurable.thread_id});const m=o.filter(P=>P.writes.length===0).map(P=>P.name);return{values:wc(s,this.streamChannelsAsIs),next:m,tasks:CH(o,(t==null?void 0:t.pendingWrites)??[],d,this.streamChannelsAsIs),metadata:h,config:Nf(t.config,t.metadata),createdAt:t.checkpoint.ts,parentConfig:t.parentConfig}}async getState(e,t){var u,c,d,h;const r=((u=e.configurable)==null?void 0:u[Er])??this.checkpointer;if(!r)throw new E3("No checkpointer set");const i=((c=e.configurable)==null?void 0:c.checkpoint_ns)??"";if(i!==""&&((d=e.configurable)==null?void 0:d[Er])===void 0){const m=MC(i);for await(const[g,_]of this.getSubgraphsAsync(m,!0))if(g===m)return await _.getState(vp(e,{[Er]:r}),{subgraphs:t==null?void 0:t.subgraphs});throw new Error(`Subgraph with namespace "${m}" not found.`)}const a=bs(this.config,e),s=await r.getTuple(e);return await this._prepareStateSnapshot({config:a,saved:s,subgraphCheckpointer:t!=null&&t.subgraphs?r:void 0,applyPendingWrites:!((h=e.configurable)!=null&&h.checkpoint_id)})}async*getStateHistory(e,t){var s,o,u;const r=((s=e.configurable)==null?void 0:s[Er])??this.checkpointer;if(!r)throw new Error("No checkpointer set");const i=((o=e.configurable)==null?void 0:o.checkpoint_ns)??"";if(i!==""&&((u=e.configurable)==null?void 0:u[Er])===void 0){const c=MC(i);for await(const[d,h]of this.getSubgraphsAsync(c,!0))if(d===c){yield*h.getStateHistory(vp(e,{[Er]:r}),t);return}throw new Error(`Subgraph with namespace "${c}" not found.`)}const a=bs(this.config,e,{configurable:{checkpoint_ns:i}});for await(const c of r.list(a,t))yield this._prepareStateSnapshot({config:c.config,saved:c})}async bulkUpdateState(e,t){var o,u,c;const r=((o=e.configurable)==null?void 0:o[Er])??this.checkpointer;if(!r)throw new E3("No checkpointer set");if(t.length===0)throw new Error("No supersteps provided");if(t.some(d=>d.updates.length===0))throw new Error("No updates provided");const i=((u=e.configurable)==null?void 0:u.checkpoint_ns)??"";if(i!==""&&((c=e.configurable)==null?void 0:c[Er])===void 0){const d=MC(i);for await(const[,h]of this.getSubgraphsAsync(d,!0))return await h.bulkUpdateState(vp(e,{[Er]:r}),t);throw new Error(`Subgraph "${d}" not found`)}const a=async(d,h)=>{var z,oe,te,se,ee,le,pe,we,$,ve,Te;const m=this.config?bs(this.config,d):d,g=await r.getTuple(m),_=g!==void 0?mb(g.checkpoint):yH(),w={...g==null?void 0:g.checkpoint.channel_versions},S=((z=g==null?void 0:g.metadata)==null?void 0:z.step)??-1;let E=vp(m,{checkpoint_ns:((oe=m.configurable)==null?void 0:oe.checkpoint_ns)??""}),C=m.metadata??{};g!=null&&g.config.configurable&&(E=vp(m,g.config.configurable),C={...g.metadata,...C});const{values:A,asNode:R}=h[0];if(A==null&&R===void 0){if(h.length>1)throw new qn("Cannot create empty checkpoint with multiple updates");const F=await r.put(E,Fu(_,void 0,S),{source:"update",step:S+1,writes:{},parents:((te=g==null?void 0:g.metadata)==null?void 0:te.parents)??{}},{});return Nf(F,g?g.metadata:void 0)}const P=gb(this.channels,_),{managed:N}=await this.prepareSpecs(m,{skipManaged:!0});if(A===null&&R===Dt){if(h.length>1)throw new qn("Cannot apply multiple updates when clearing state");if(g){const ae=om(_,g.pendingWrites||[],this.nodes,P,N,g.config,!0,{step:(((se=g.metadata)==null?void 0:se.step)??-1)+1,checkpointer:this.checkpointer||void 0,store:this.store}),fe=(g.pendingWrites||[]).filter(I=>I[0]===qa).map(I=>I.slice(1));fe.length>0&&ga(g.checkpoint,P,[{name:Bo,writes:fe,triggers:[]}],void 0,this.triggerToNodes);for(const[I,O,J]of g.pendingWrites||[])[Fi,Rn,r_].includes(O)||I in ae&&ae[I].writes.push([O,J]);ga(_,P,Object.values(ae),void 0,this.triggerToNodes)}const F=await r.put(E,Fu(_,void 0,S),{...C,source:"update",step:S+1,writes:{},parents:((ee=g==null?void 0:g.metadata)==null?void 0:ee.parents)??{}},{});return Nf(F,g?g.metadata:void 0)}if(A==null&&R===uxe){if(h.length>1)throw new qn("Cannot copy checkpoint with multiple updates");const F=await r.put((g==null?void 0:g.parentConfig)??E,Fu(_,void 0,S),{source:"fork",step:S+1,writes:{},parents:((le=g==null?void 0:g.metadata)==null?void 0:le.parents)??{}},{});return Nf(F,g?g.metadata:void 0)}if(R===Bo){if(h.length>1)throw new qn("Cannot apply multiple updates when updating as input");const F=await Vl(SH(this.inputChannels,A));if(F.length===0)throw new qn(`Received no input writes for ${JSON.stringify(this.inputChannels,null,2)}`);ga(_,P,[{name:Bo,writes:F,triggers:[]}],r.getNextVersion.bind(this.checkpointer),this.triggerToNodes);const ae=((pe=g==null?void 0:g.metadata)==null?void 0:pe.step)!=null?g.metadata.step+1:-1,fe=await r.put(E,Fu(_,P,ae),{source:"input",step:ae,writes:Object.fromEntries(F),parents:((we=g==null?void 0:g.metadata)==null?void 0:we.parents)??{}},qR(w,_.channel_versions));return await r.putWrites(fe,F,td(Bo,_.id)),Nf(fe,g?g.metadata:void 0)}if((($=m.configurable)==null?void 0:$.checkpoint_id)===void 0&&(g==null?void 0:g.pendingWrites)!==void 0&&g.pendingWrites.length>0){const F=om(_,g.pendingWrites,this.nodes,P,N,g.config,!0,{store:this.store,checkpointer:this.checkpointer,step:(((ve=g.metadata)==null?void 0:ve.step)??-1)+1}),ae=(g.pendingWrites??[]).filter(I=>I[0]===qa).map(I=>I.slice(1));ae.length>0&&ga(g.checkpoint,P,[{name:Bo,writes:ae,triggers:[]}],void 0,this.triggerToNodes);for(const[I,O,J]of g.pendingWrites)[Fi,Rn,r_].includes(O)||F[I]===void 0||F[I].writes.push([O,J]);const fe=Object.values(F).filter(I=>I.writes.length>0);fe.length>0&&ga(_,P,fe,void 0,this.triggerToNodes)}const U=Object.values(_.versions_seen).map(F=>Object.values(F)).flat().find(F=>!!F),k=[];if(h.length===1){let{values:F,asNode:ae}=h[0];if(ae===void 0&&Object.keys(this.nodes).length===1)[ae]=Object.keys(this.nodes);else if(ae===void 0&&U===void 0)typeof this.inputChannels=="string"&&this.nodes[this.inputChannels]!==void 0&&(ae=this.inputChannels);else if(ae===void 0){const fe=Object.entries(_.versions_seen).map(([I,O])=>Object.values(O).map(J=>[J,I])).flat().sort(([I],[O])=>vH(I,O));fe&&(fe.length===1?ae=fe[0][1]:fe[fe.length-1][0]!==fe[fe.length-2][0]&&(ae=fe[fe.length-1][1]))}if(ae===void 0)throw new qn('Ambiguous update, specify "asNode"');k.push({values:F,asNode:ae})}else for(const{asNode:F,values:ae}of h){if(F==null)throw new qn('"asNode" is required when applying multiple updates');k.push({values:ae,asNode:F})}const B=[];for(const{asNode:F,values:ae}of k){if(this.nodes[F]===void 0)throw new qn(`Node "${F.toString()}" does not exist`);const fe=this.nodes[F].getWriters();if(!fe.length)throw new qn(`No writers found for node "${F.toString()}"`);B.push({name:F,input:ae,proc:fe.length>1?Ar.from(fe,{omitSequenceTags:!0}):fe[0],writes:[],triggers:[Rn],id:td(Rn,_.id),writers:[]})}for(const F of B)await F.proc.invoke(F.input,fn({...m,store:(m==null?void 0:m.store)??this.store},{runName:m.runName??`${this.getName()}UpdateState`,configurable:{[bd]:ae=>F.writes.push(...ae),[tc]:(ae,fe=!1)=>c_(S,_,P,N,F,ae,fe)}}));for(const F of B){const ae=F.writes.filter(fe=>fe[0]!==Ba);g!==void 0&&ae.length>0&&await r.putWrites(E,ae,F.id)}ga(_,P,B,r.getNextVersion.bind(this.checkpointer),this.triggerToNodes);const H=qR(w,_.channel_versions),G=await r.put(E,Fu(_,P,S+1),{source:"update",step:S+1,writes:Object.fromEntries(k.map(F=>[F.asNode,F.values])),parents:((Te=g==null?void 0:g.metadata)==null?void 0:Te.parents)??{}},H);for(const F of B){const ae=F.writes.filter(fe=>fe[0]===Ba);ae.length>0&&await r.putWrites(G,ae,F.id)}return Nf(G,g?g.metadata:void 0)};let s=e;for(const{updates:d}of t)s=await a(s,d);return s}async updateState(e,t,r){return this.bulkUpdateState(e,[{updates:[{values:t,asNode:r}]}])}_defaults(e){var A,R;const{debug:t,streamMode:r,inputKeys:i,outputKeys:a,interruptAfter:s,interruptBefore:o,...u}=e;let c=!0;const d=t!==void 0?t:this.debug;let h=a;h===void 0?h=this.streamChannelsAsIs:O3(h,this.channels);let m=i;m===void 0?m=this.inputChannels:O3(m,this.channels);const g=o??this.interruptBefore??[],_=s??this.interruptAfter??[];let w;r!==void 0?(w=Array.isArray(r)?r:[r],c=typeof r=="string"):(w=this.streamMode,c=!0),((A=e.configurable)==null?void 0:A[sm])!==void 0&&(w=["values"]);let S;this.checkpointer===!1?S=void 0:e!==void 0&&((R=e.configurable)==null?void 0:R[Er])!==void 0?S=e.configurable[Er]:S=this.checkpointer;const E=e.store??this.store,C=e.cache??this.cache;return[d,w,m,h,u,g,_,S,E,c,C]}async stream(e,t){var a;const r=new AbortController,i={recursionLimit:(a=this.config)==null?void 0:a.recursionLimit,...t,signal:t!=null&&t.signal?id(t.signal,r.signal):r.signal};return new P3(await super.stream(e,i),r)}streamEvents(e,t,r){var s,o;const i=new AbortController,a={recursionLimit:(s=this.config)==null?void 0:s.recursionLimit,...t,callbacks:Rxe((o=this.config)==null?void 0:o.callbacks,t==null?void 0:t.callbacks),signal:t!=null&&t.signal?id(t.signal,i.signal):i.signal};return new P3(super.streamEvents(e,a,r),i)}async prepareSpecs(e,t){const r={...e,store:this.store},i={},a={};for(const[o,u]of Object.entries(this.channels))kw(u)?i[o]=u:t!=null&&t.skipManaged?a[o]={cls:$O,params:{config:{}}}:a[o]=u;const s=new Sxe(await Object.entries(a).reduce(async(o,[u,c])=>{const d=await o;let h;return Nw(c)?("key"in c.params&&c.params.key===Exe&&(c.params.key=u),h=await c.cls.initialize(r,c.params)):h=await c.initialize(r),h!==void 0&&d.push([u,h]),d},Promise.resolve([])));return{channelSpecs:i,managed:s}}async _validateInput(e){return e}async _validateConfigurable(e){return e}async*_streamIterator(e,t){const r=t==null?void 0:t.subgraphs,i=EH(this.config,t);if(i.recursionLimit===void 0||i.recursionLimit<1)throw new Error('Passed "recursionLimit" must be at least 1.');if(this.checkpointer!==void 0&&this.checkpointer!==!1&&i.configurable===void 0)throw new Error('Checkpointer requires one or more of the following "configurable" keys: "thread_id", "checkpoint_ns", "checkpoint_id"');const a=await this._validateInput(e),{runId:s,...o}=i,[u,c,,d,h,m,g,_,w,S,E]=this._defaults(o);h.configurable=await this._validateConfigurable(h.configurable);const C=new RH({modes:new Set(c)});if(c.includes("messages")){const G=new qxe(oe=>C.push(oe)),{callbacks:z}=h;if(z===void 0)h.callbacks=[G];else if(Array.isArray(z))h.callbacks=z.concat(G);else{const oe=z.copy();oe.addHandler(G,!0),h.callbacks=oe}}c.includes("custom")&&(h.writer=G=>C.push([[],"custom",G]));const A=await Gi(h),R=await(A==null?void 0:A.handleChainStart(this.toJSON(),xxe(e,"input"),s,void 0,void 0,void 0,(h==null?void 0:h.runName)??this.getName())),{channelSpecs:P,managed:N}=await this.prepareSpecs(h);let U,k;const H=(async()=>{var G,z,oe;try{U=await UO.initialize({input:a,config:h,checkpointer:_,nodes:this.nodes,channelSpecs:P,managed:N,outputKeys:d,streamKeys:this.streamChannelsAsIs,store:w,cache:E,stream:C,interruptAfter:g,interruptBefore:m,manager:R,debug:this.debug,triggerToNodes:this.triggerToNodes});const te=new Yxe({loop:U,nodeFinished:(G=h.configurable)==null?void 0:G[dxe]});t!=null&&t.subgraphs&&(U.config.configurable={...U.config.configurable,[yb]:U.stream}),await this._runLoop({loop:U,runner:te,debug:u,config:h})}catch(te){k=te}finally{try{U&&(await((z=U.store)==null?void 0:z.stop()),await((oe=U.cache)==null?void 0:oe.stop())),await Promise.all([...(U==null?void 0:U.checkpointerPromises)??[],...Array.from(N.values()).map(te=>te.promises())])}catch(te){k=k??te}k?C.error(k):C.close()}})();try{for await(const G of C){if(G===void 0)throw new Error("Data structure error.");const[z,oe,te]=G;c.includes(oe)&&(r&&!S?yield[z,oe,te]:S?r?yield[z,te]:yield te:yield[oe,te])}}catch(G){throw await(R==null?void 0:R.handleChainError(k)),G}finally{await H}await(R==null?void 0:R.handleChainEnd((U==null?void 0:U.output)??{},s,void 0,void 0,void 0))}async invoke(e,t){const r=(t==null?void 0:t.streamMode)??"values",i={...t,outputKeys:(t==null?void 0:t.outputKeys)??this.outputChannels,streamMode:r},a=[],s=await this.stream(e,i),o=[];let u;for await(const c of s)r==="values"?mxe(c)?o.push(c[Rn]):u=c:a.push(c);if(r==="values"){if(o.length>0){const c=o.flat(1);if(u==null)return{[Rn]:c};if(typeof u=="object")return{...u,[Rn]:c}}return u}return a}async _runLoop(e){const{loop:t,runner:r,debug:i,config:a}=e;let s;try{for(;await t.tick({inputKeys:this.inputChannels});){for(const{task:o}of await t._matchCachedWrites())t._outputWrites(o.id,o.writes,!0);i&&$xe(t.checkpointMetadata.step,t.channels,this.streamChannelsList),i&&xH(t.step,Object.values(t.tasks)),await r.tick({timeout:this.stepTimeout,retryPolicy:this.retryPolicy,onStepWrite:(o,u)=>{i&&Lxe(o,u,this.streamChannelsList)},maxConcurrency:a.maxConcurrency,signal:a.signal})}if(t.status==="out_of_steps")throw new txe([`Recursion limit of ${a.recursionLimit} reached`,"without hitting a stop condition. You can increase the",'limit by setting the "recursionLimit" config key.'].join(" "),{lc_error_code:"GRAPH_RECURSION_LIMIT"})}catch(o){if(s=o,!await t.finishAndHandleError(s))throw o}finally{s===void 0&&await t.finishAndHandleError()}}async clearCache(){var e;await((e=this.cache)==null?void 0:e.clear([]))}}class $m extends Xd{constructor(e,t){super(),Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"BinaryOperatorAggregate"}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"operator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"initialValueFactory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.operator=e,this.initialValueFactory=t,this.value=t==null?void 0:t()}fromCheckpoint(e){const t=new $m(this.operator,this.initialValueFactory);return typeof e<"u"&&(t.value=e),t}update(e){let t=e;if(!t.length)return!1;this.value===void 0&&([this.value]=t,t=t.slice(1));for(const r of t)this.value!==void 0&&(this.value=this.operator(this.value,r));return!0}get(){if(this.value===void 0)throw new Zr;return this.value}checkpoint(){if(this.value===void 0)throw new Zr;return this.value}isAvailable(){return this.value!==void 0}}class su extends Xd{constructor(e=!0){super(),Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"EphemeralValue"}),Object.defineProperty(this,"guard",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.guard=e}fromCheckpoint(e){const t=new su(this.guard);return typeof e<"u"&&(t.value=[e]),t}update(e){if(e.length===0){const t=this.value.length>0;return this.value=[],t}if(e.length!==1&&this.guard)throw new qn("EphemeralValue can only receive one value per step.");return this.value=[e[e.length-1]],!0}get(){if(this.value.length===0)throw new Zr;return this.value[0]}checkpoint(){if(this.value.length===0)throw new Zr;return this.value[0]}isAvailable(){return this.value.length!==0}}class PH{constructor(e){Object.defineProperty(this,"path",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ends",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Gt.isRunnable(e.path)?this.path=e.path:this.path=Yr(e.path).withConfig({runName:"Branch"}),this.ends=Array.isArray(e.pathMap)?e.pathMap.reduce((t,r)=>(t[r]=r,t),{}):e.pathMap}run(e,t){return Dr.registerWriter(new fu({name:"<branch_run>",trace:!1,func:async(r,i)=>{try{return await this._route(r,i,e,t)}catch(a){throw a.name===bH.unminifiable_name&&console.warn(`[WARN]: 'NodeInterrupt' thrown in conditional edge. This is likely a bug in your graph implementation.
NodeInterrupt should only be thrown inside a node, not in edge conditions.`),a}}}))}async _route(e,t,r,i){let a=await this.path.invoke(i?i(t):e,t);Array.isArray(a)||(a=[a]);let s;if(this.ends?s=a.map(u=>Yi(u)?u:this.ends[u]):s=a,s.some(u=>!u))throw new Error("Branch condition returned unknown or null destination");if(s.filter(Yi).some(u=>u.node===Dt))throw new qn("Cannot send a packet to the END node");return await r(s,t)??e}}class tRe{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"branches",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"entryPoint",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"compiled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.nodes={},this.edges=new Set,this.branches={}}warnIfCompiled(e){this.compiled&&console.warn(e)}get allEdges(){return this.edges}addNode(...e){function t(i){return i.length>=1&&typeof i[0]!="string"}const r=t(e)?Array.isArray(e[0])?e[0]:Object.entries(e[0]):[[e[0],e[1],e[2]]];if(r.length===0)throw new Error("No nodes provided in `addNode`");for(const[i,a,s]of r){for(const u of[Bi,rc])if(i.includes(u))throw new Error(`"${u}" is a reserved character and is not allowed in node names.`);if(this.warnIfCompiled("Adding a node to a graph that has already been compiled. This will not be reflected in the compiled graph."),i in this.nodes)throw new Error(`Node \`${i}\` already present.`);if(i===Dt)throw new Error(`Node \`${i}\` is reserved.`);const o=Yr(a);this.nodes[i]={runnable:o,metadata:s==null?void 0:s.metadata,subgraphs:LO(o)?[o]:s==null?void 0:s.subgraphs,ends:s==null?void 0:s.ends}}return this}addEdge(e,t){if(this.warnIfCompiled("Adding an edge to a graph that has already been compiled. This will not be reflected in the compiled graph."),e===Dt)throw new Error("END cannot be a start node");if(t===jn)throw new Error("START cannot be an end node");if(Array.from(this.edges).some(([r])=>r===e)&&!("channels"in this))throw new Error(`Already found path for ${e}. For multiple edges, use StateGraph.`);return this.edges.add([e,t]),this}addConditionalEdges(e,t,r){var s,o;const i=typeof e=="object"?e:{source:e,path:t,pathMap:r};if(this.warnIfCompiled("Adding an edge to a graph that has already been compiled. This will not be reflected in the compiled graph."),!Gt.isRunnable(i.path)){const u=Array.isArray(i.pathMap)?i.pathMap.join(","):Object.keys(i.pathMap??{}).join(",");i.path=Yr(i.path).withConfig({runName:`Branch<${i.source}${u!==""?`,${u}`:""}>`.slice(0,63)})}const a=i.path.getName()==="RunnableLambda"?"condition":i.path.getName();if(this.branches[i.source]&&this.branches[i.source][a])throw new Error(`Condition \`${a}\` already present for node \`${e}\``);return(s=this.branches)[o=i.source]??(s[o]={}),this.branches[i.source][a]=new PH(i),this}setEntryPoint(e){return this.warnIfCompiled("Setting the entry point of a graph that has already been compiled. This will not be reflected in the compiled graph."),this.addEdge(jn,e)}setFinishPoint(e){return this.warnIfCompiled("Setting a finish point of a graph that has already been compiled. This will not be reflected in the compiled graph."),this.addEdge(e,Dt)}compile({checkpointer:e,interruptBefore:t,interruptAfter:r,name:i}={}){this.validate([...Array.isArray(t)?t:[],...Array.isArray(r)?r:[]]);const a=new OH({builder:this,checkpointer:e,interruptAfter:r,interruptBefore:t,autoValidate:!1,nodes:{},channels:{[jn]:new su,[Dt]:new su},inputChannels:jn,outputChannels:Dt,streamChannels:[],streamMode:"values",name:i});for(const[s,o]of Object.entries(this.nodes))a.attachNode(s,o);for(const[s,o]of this.edges)a.attachEdge(s,o);for(const[s,o]of Object.entries(this.branches))for(const[u,c]of Object.entries(o))a.attachBranch(s,u,c);return a.validate()}validate(e){const t=new Set([...this.allEdges].map(([i,a])=>i));for(const[i]of Object.entries(this.branches))t.add(i);for(const i of t)if(i!==jn&&!(i in this.nodes))throw new Error(`Found edge starting at unknown node \`${i}\``);const r=new Set([...this.allEdges].map(([i,a])=>a));for(const[i,a]of Object.entries(this.branches))for(const s of Object.values(a))if(s.ends!=null)for(const o of Object.values(s.ends))r.add(o);else{r.add(Dt);for(const o of Object.keys(this.nodes))o!==i&&r.add(o)}for(const i of Object.values(this.nodes))for(const a of i.ends??[])r.add(a);for(const i of Object.keys(this.nodes))if(!r.has(i))throw new rxe([`Node \`${i}\` is not reachable.`,"","If you are returning Command objects from your node,",'make sure you are passing names of potential destination nodes as an "ends" array','into ".addNode(..., { ends: ["node1", "node2"] })".'].join(`
`),{lc_error_code:"UNREACHABLE_NODE"});for(const i of r)if(i!==Dt&&!(i in this.nodes))throw new Error(`Found edge ending at unknown node \`${i}\``);if(e){for(const i of e)if(!(i in this.nodes))throw new Error(`Interrupt node \`${i}\` is not present`)}this.compiled=!0}}class OH extends eRe{constructor({builder:e,...t}){super(t),Object.defineProperty(this,"builder",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.builder=e}attachNode(e,t){this.channels[e]=new su,this.nodes[e]=new ao({channels:[],triggers:[],metadata:t.metadata,subgraphs:t.subgraphs,ends:t.ends}).pipe(t.runnable).pipe(new Dr([{channel:e,value:ic}],[cr])),this.streamChannels.push(e)}attachEdge(e,t){if(t===Dt){if(e===jn)throw new Error("Cannot have an edge from START to END");this.nodes[e].writers.push(new Dr([{channel:Dt,value:ic}],[cr]))}else this.nodes[t].triggers.push(e),this.nodes[t].channels.push(e)}attachBranch(e,t,r){e===jn&&!this.nodes[jn]&&(this.nodes[jn]=Xxe.subscribeTo(jn,{tags:[cr]})),this.nodes[e].pipe(r.run(a=>{const s=a.map(o=>Yi(o)?o:{channel:o===Dt?Dt:`branch:${e}:${t}:${o}`,value:ic});return new Dr(s,[cr])}));const i=r.ends?Object.values(r.ends):Object.keys(this.nodes);for(const a of i)if(a!==Dt){const s=`branch:${e}:${t}:${a}`;this.channels[s]=new su,this.nodes[a].triggers.push(s),this.nodes[a].channels.push(s)}}async getGraphAsync(e){var c,d,h,m;const t=e==null?void 0:e.xray,r=new D_,i={[jn]:r.addNode({schema:Va()},jn)},a={};let s={};t&&(s=Object.fromEntries((await Vl(this.getSubgraphsAsync())).filter(g=>k3(g[1]))));function o(g,_,w,S=!1){if(_===Dt&&a[Dt]===void 0&&(a[Dt]=r.addNode({schema:Va()},Dt)),i[g]!==void 0){if(a[_]===void 0)throw new Error(`End node ${_} not found!`);return r.addEdge(i[g],a[_],w!==_?w:void 0,S)}}for(const[g,_]of Object.entries(this.builder.nodes)){const w=ri(g),S=_.runnable,E=_.metadata??{};if((c=this.interruptBefore)!=null&&c.includes(g)&&((d=this.interruptAfter)!=null&&d.includes(g))?E.__interrupt="before,after":(h=this.interruptBefore)!=null&&h.includes(g)?E.__interrupt="before":(m=this.interruptAfter)!=null&&m.includes(g)&&(E.__interrupt="after"),t){const C=typeof t=="number"?t-1:t,A=s[g]!==void 0?await s[g].getGraphAsync({...e,xray:C}):S.getGraph(e);if(A.trimFirstNode(),A.trimLastNode(),Object.keys(A.nodes).length>1){let N=function(k){return k?k.lc_runnable:!1},U=function(k,B){if(k!==void 0&&!jR(k))return k;if(N(B))try{let H=B.getName();return H=H.startsWith("Runnable")?H.slice(8):H,H}catch{return B.getName()}else return B.name??"UnknownSchema"};const[R,P]=r.extend(A,w);if(R===void 0)throw new Error(`Could not extend subgraph "${g}" due to missing entrypoint.`);P!==void 0&&(i[w]={name:U(P.id,P.data),...P}),a[w]={name:U(R.id,R.data),...R}}else{const R=r.addNode(S,w,E);i[w]=R,a[w]=R}}else{const C=r.addNode(S,w,E);i[w]=C,a[w]=C}}const u=[...this.builder.allEdges].sort(([g],[_])=>g<_?-1:_>g?1:0);for(const[g,_]of u)o(ri(g),ri(_));for(const[g,_]of Object.entries(this.builder.branches)){const w={...Object.fromEntries(Object.keys(this.builder.nodes).filter(S=>S!==g).map(S=>[ri(S),ri(S)])),[Dt]:Dt};for(const S of Object.values(_)){let E;S.ends!==void 0?E=S.ends:E=w;for(const[C,A]of Object.entries(E))o(ri(g),ri(A),C,!0)}}for(const[g,_]of Object.entries(this.builder.nodes))if(_.ends!==void 0)for(const w of _.ends)o(ri(g),ri(w),void 0,!0);return r}getGraph(e){var c,d,h,m;const t=e==null?void 0:e.xray,r=new D_,i={[jn]:r.addNode({schema:Va()},jn)},a={};let s={};t&&(s=Object.fromEntries(Lp(this.getSubgraphs()).filter(g=>k3(g[1]))));function o(g,_,w,S=!1){return _===Dt&&a[Dt]===void 0&&(a[Dt]=r.addNode({schema:Va()},Dt)),r.addEdge(i[g],a[_],w!==_?w:void 0,S)}for(const[g,_]of Object.entries(this.builder.nodes)){const w=ri(g),S=_.runnable,E=_.metadata??{};if((c=this.interruptBefore)!=null&&c.includes(g)&&((d=this.interruptAfter)!=null&&d.includes(g))?E.__interrupt="before,after":(h=this.interruptBefore)!=null&&h.includes(g)?E.__interrupt="before":(m=this.interruptAfter)!=null&&m.includes(g)&&(E.__interrupt="after"),t){const C=typeof t=="number"?t-1:t,A=s[g]!==void 0?s[g].getGraph({...e,xray:C}):S.getGraph(e);if(A.trimFirstNode(),A.trimLastNode(),Object.keys(A.nodes).length>1){let N=function(k){return k?k.lc_runnable:!1},U=function(k,B){if(k!==void 0&&!jR(k))return k;if(N(B))try{let H=B.getName();return H=H.startsWith("Runnable")?H.slice(8):H,H}catch{return B.getName()}else return B.name??"UnknownSchema"};const[R,P]=r.extend(A,w);if(R===void 0)throw new Error(`Could not extend subgraph "${g}" due to missing entrypoint.`);P!==void 0&&(i[w]={name:U(P.id,P.data),...P}),a[w]={name:U(R.id,R.data),...R}}else{const R=r.addNode(S,w,E);i[w]=R,a[w]=R}}else{const C=r.addNode(S,w,E);i[w]=C,a[w]=C}}const u=[...this.builder.allEdges].sort(([g],[_])=>g<_?-1:_>g?1:0);for(const[g,_]of u)o(ri(g),ri(_));for(const[g,_]of Object.entries(this.builder.branches)){const w={...Object.fromEntries(Object.keys(this.builder.nodes).filter(S=>S!==g).map(S=>[ri(S),ri(S)])),[Dt]:Dt};for(const S of Object.values(_)){let E;S.ends!==void 0?E=S.ends:E=w;for(const[C,A]of Object.entries(E))o(ri(g),ri(A),C,!0)}}return r}}function k3(n){return typeof n.attachNode=="function"&&typeof n.attachEdge=="function"}function ri(n){return n==="subgraph"?`"${n}"`:n}const Gu=(n,e)=>n.size===e.size&&[...n].every(t=>e.has(t));class jO extends Xd{constructor(e){super(),Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"NamedBarrierValue"}),Object.defineProperty(this,"names",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"seen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.names=e,this.seen=new Set}fromCheckpoint(e){const t=new jO(this.names);return typeof e<"u"&&(t.seen=new Set(e)),t}update(e){let t=!1;for(const r of e)if(this.names.has(r))this.seen.has(r)||(this.seen.add(r),t=!0);else throw new qn(`Value ${JSON.stringify(r)} not in names ${JSON.stringify(this.names)}`);return t}get(){if(!Gu(this.names,this.seen))throw new Zr}checkpoint(){return[...this.seen]}consume(){return this.seen&&this.names&&Gu(this.seen,this.names)?(this.seen=new Set,!0):!1}isAvailable(){return!!this.names&&Gu(this.names,this.seen)}}class FO extends Xd{constructor(e){super(),Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"NamedBarrierValueAfterFinish"}),Object.defineProperty(this,"names",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"seen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"finished",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.names=e,this.seen=new Set,this.finished=!1}fromCheckpoint(e){const t=new FO(this.names);if(typeof e<"u"){const[r,i]=e;t.seen=new Set(r),t.finished=i}return t}update(e){let t=!1;for(const r of e)if(this.names.has(r)&&!this.seen.has(r))this.seen.add(r),t=!0;else if(!this.names.has(r))throw new qn(`Value ${JSON.stringify(r)} not in names ${JSON.stringify(this.names)}`);return t}get(){if(!this.finished||!Gu(this.names,this.seen))throw new Zr}checkpoint(){return[[...this.seen],this.finished]}consume(){return this.finished&&this.seen&&this.names&&Gu(this.seen,this.names)?(this.seen=new Set,this.finished=!1,!0):!1}finish(){return!this.finished&&this.names&&Gu(this.names,this.seen)?(this.finished=!0,!0):!1}isAvailable(){return this.finished&&!!this.names&&Gu(this.names,this.seen)}}class wg extends Xd{constructor(){super(...arguments),Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"LastValue"}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:[]})}fromCheckpoint(e){const t=new wg;return typeof e<"u"&&(t.value=[e]),t}update(e){if(e.length===0)return!1;if(e.length!==1)throw new qn("LastValue can only receive one value per step.",{lc_error_code:"INVALID_CONCURRENT_GRAPH_UPDATE"});return this.value=[e[e.length-1]],!0}get(){if(this.value.length===0)throw new Zr;return this.value[0]}checkpoint(){if(this.value.length===0)throw new Zr;return this.value[0]}isAvailable(){return this.value.length!==0}}class BO extends Xd{constructor(){super(...arguments),Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"LastValueAfterFinish"}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"finished",{enumerable:!0,configurable:!0,writable:!0,value:!1})}fromCheckpoint(e){const t=new BO;if(typeof e<"u"){const[r,i]=e;t.value=[r],t.finished=i}return t}update(e){return e.length===0?!1:(this.finished=!1,this.value=[e[e.length-1]],!0)}get(){if(this.value.length===0||!this.finished)throw new Zr;return this.value[0]}checkpoint(){if(this.value.length!==0)return[this.value[0],this.finished]}consume(){return this.finished?(this.finished=!1,this.value=[],!0):!1}finish(){return!this.finished&&this.value.length>0?(this.finished=!0,!0):!1}isAvailable(){return this.value.length!==0&&this.finished}}class nRe{constructor(e){Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"AnnotationRoot"}),Object.defineProperty(this,"spec",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.spec=e}}const sc=function(n){return Nw(n)?n:n?HR(n):new wg};sc.Root=n=>new nRe(n);function HR(n){return typeof n=="object"&&n&&"reducer"in n&&n.reducer?new $m(n.reducer,n.default):typeof n=="object"&&n&&"value"in n&&n.value?new $m(n.value,n.default):new wg}const rRe="lg:";class iRe{constructor(){Object.defineProperty(this,"_map",{enumerable:!0,configurable:!0,writable:!0,value:new WeakMap}),Object.defineProperty(this,"_extensionCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}get(e){return this._map.get(e)}extend(e,t){const r=this.get(e);this._map.set(e,t(r))}remove(e){return this._map.delete(e),this}has(e){return this._map.has(e)}getChannelsForSchema(e){const t={},r=Tx(e);for(const[i,a]of Object.entries(r)){const s=this.get(a);s!=null&&s.reducer?t[i]=new $m(s.reducer.fn,s.default):t[i]=new wg}return t}getExtendedChannelSchemas(e,t){if(Object.keys(t).length===0)return e;const r=Object.entries(t).filter(([,s])=>s===!0).sort(([s],[o])=>s.localeCompare(o)).map(([s,o])=>`${s}:${o}`).join("|"),i=this._extensionCache.get(r)??new WeakMap;if(i.has(e))return i.get(e);let a=e;if(t.withReducerSchema||t.withJsonSchemaExtrasAsDescription){const s=Object.entries(Tx(e)).map(([o,u])=>{var h;const c=this.get(u);let d=t.withReducerSchema?((h=c==null?void 0:c.reducer)==null?void 0:h.schema)??u:u;if(t.withJsonSchemaExtrasAsDescription&&(c!=null&&c.jsonSchemaExtra)){const m=Ad(d)??Ad(u),g=JSON.stringify({...c.jsonSchemaExtra,description:m});d=d.describe(`${rRe}${g}`)}return[o,d]});a=k5(e,Object.fromEntries(s)),hr(a)&&(a._def.unknownKeys="strip")}return t.asPartial&&(a=RI(a)),i.set(e,a),this._extensionCache.set(r,i),a}}const kH=new iRe,Ho="__root__",GR=Symbol.for("langgraph.state.partial");class aRe extends tRe{constructor(e,t){var r,i;if(super(),Object.defineProperty(this,"channels",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"waitingEdges",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"_schemaDefinition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaRuntimeDefinition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_inputDefinition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_inputRuntimeDefinition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_outputDefinition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_outputRuntimeDefinition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaDefinitions",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"_metaRegistry",{enumerable:!0,configurable:!0,writable:!0,value:kH}),Object.defineProperty(this,"_configSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_configRuntimeSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),dRe(e)){const a=this._metaRegistry.getChannelsForSchema(e.state),s=e.input!=null?this._metaRegistry.getChannelsForSchema(e.input):a,o=e.output!=null?this._metaRegistry.getChannelsForSchema(e.output):a;this._schemaDefinition=a,this._schemaRuntimeDefinition=e.state,this._inputDefinition=s,this._inputRuntimeDefinition=e.input??GR,this._outputDefinition=o,this._outputRuntimeDefinition=e.output??e.state}else if(Wo(e)){const a=this._metaRegistry.getChannelsForSchema(e);this._schemaDefinition=a,this._schemaRuntimeDefinition=e,this._inputDefinition=a,this._inputRuntimeDefinition=GR,this._outputDefinition=a,this._outputRuntimeDefinition=e}else if(fRe(e))this._schemaDefinition=e.input.spec,this._inputDefinition=e.input.spec,this._outputDefinition=e.output.spec;else if(cRe(e))this._schemaDefinition=e.stateSchema.spec,this._inputDefinition=((r=e.input)==null?void 0:r.spec)??this._schemaDefinition,this._outputDefinition=((i=e.output)==null?void 0:i.spec)??this._schemaDefinition;else if(lRe(e)||N3(e)){const a=N3(e)?e.spec:e;this._schemaDefinition=a}else if(uRe(e)){const a=sRe(e.channels);this._schemaDefinition=a}else throw new Error("Invalid StateGraph input. Make sure to pass a valid Annotation.Root or Zod schema.");this._inputDefinition??(this._inputDefinition=this._schemaDefinition),this._outputDefinition??(this._outputDefinition=this._schemaDefinition),this._addSchema(this._schemaDefinition),this._addSchema(this._inputDefinition),this._addSchema(this._outputDefinition),Wo(t)&&(this._configRuntimeSchema=t)}get allEdges(){return new Set([...this.edges,...Array.from(this.waitingEdges).flatMap(([e,t])=>e.map(r=>[r,t]))])}_addSchema(e){if(!this._schemaDefinitions.has(e)){this._schemaDefinitions.set(e,e);for(const[t,r]of Object.entries(e)){let i;if(typeof r=="function"?i=r():i=r,this.channels[t]!==void 0){if(this.channels[t]!==i&&!Nw(i)&&i.lc_graph_name!=="LastValue")throw new Error(`Channel "${t}" already exists with a different type.`)}else this.channels[t]=i}}}addNode(...e){function t(i){return i.length>=1&&typeof i[0]!="string"}const r=t(e)?Array.isArray(e[0])?e[0]:Object.entries(e[0]).map(([i,a])=>[i,a,a[Symbol.for("langgraph.state.node")]??void 0]):[[e[0],e[1],e[2]]];if(r.length===0)throw new Error("No nodes provided in `addNode`");for(const[i,a,s]of r){if(i in this.channels)throw new Error(`${i} is already being used as a state attribute (a.k.a. a channel), cannot also be used as a node name.`);for(const h of[Bi,rc])if(i.includes(h))throw new Error(`"${h}" is a reserved character and is not allowed in node names.`);if(this.warnIfCompiled("Adding a node to a graph that has already been compiled. This will not be reflected in the compiled graph."),i in this.nodes)throw new Error(`Node \`${i}\` already present.`);if(i===Dt||i===jn)throw new Error(`Node \`${i}\` is reserved.`);let o=this._schemaDefinition;(s==null?void 0:s.input)!==void 0&&(Wo(s.input)?o=this._metaRegistry.getChannelsForSchema(s.input):s.input.spec!==void 0&&(o=s.input.spec)),o!==void 0&&this._addSchema(o);let u;Gt.isRunnable(a)?u=a:typeof a=="function"?u=new fu({func:a,name:i,trace:!1}):u=Yr(a);let c=s==null?void 0:s.cachePolicy;typeof c=="boolean"&&(c=c?{}:void 0);const d={runnable:u,retryPolicy:s==null?void 0:s.retryPolicy,cachePolicy:c,metadata:s==null?void 0:s.metadata,input:o??this._schemaDefinition,subgraphs:LO(u)?[u]:s==null?void 0:s.subgraphs,ends:s==null?void 0:s.ends,defer:s==null?void 0:s.defer};this.nodes[i]=d}return this}addEdge(e,t){if(typeof e=="string")return super.addEdge(e,t);this.compiled&&console.warn("Adding an edge to a graph that has already been compiled. This will not be reflected in the compiled graph.");for(const r of e){if(r===Dt)throw new Error("END cannot be a start node");if(!Object.keys(this.nodes).some(i=>i===r))throw new Error(`Need to add a node named "${r}" first`)}if(t===Dt)throw new Error("END cannot be an end node");if(!Object.keys(this.nodes).some(r=>r===t))throw new Error(`Need to add a node named "${t}" first`);return this.waitingEdges.add([e,t]),this}addSequence(e){const t=Array.isArray(e)?e:Object.entries(e).map(([i,a])=>[i,a,a[Symbol.for("langgraph.state.node")]??void 0]);if(t.length===0)throw new Error("Sequence requires at least one node.");let r;for(const[i,a,s]of t){if(i in this.nodes)throw new Error(`Node names must be unique: node with the name "${i}" already exists.`);const o=i;this.addNode(o,a,s),r!=null&&this.addEdge(r,o),r=o}return this}compile({checkpointer:e,store:t,cache:r,interruptBefore:i,interruptAfter:a,name:s}={}){this.validate([...Array.isArray(i)?i:[],...Array.isArray(a)?a:[]]);const o=Object.keys(this._schemaDefinitions.get(this._outputDefinition)),u=o.length===1&&o[0]===Ho?Ho:o,c=Object.keys(this.channels),d=c.length===1&&c[0]===Ho?Ho:c,h=new oRe({builder:this,checkpointer:e,interruptAfter:a,interruptBefore:i,autoValidate:!1,nodes:{},channels:{...this.channels,[jn]:new su},inputChannels:jn,outputChannels:u,streamChannels:d,streamMode:"updates",store:t,cache:r,name:s});h.attachNode(jn);for(const[m,g]of Object.entries(this.nodes))h.attachNode(m,g);h.attachBranch(jn,x3,M3(),{withReader:!1});for(const[m]of Object.entries(this.nodes))h.attachBranch(m,x3,M3(),{withReader:!1});for(const[m,g]of this.edges)h.attachEdge(m,g);for(const[m,g]of this.waitingEdges)h.attachEdge(m,g);for(const[m,g]of Object.entries(this.branches))for(const[_,w]of Object.entries(g))h.attachBranch(m,_,w);return h.validate()}}function sRe(n){const e={};for(const[t,r]of Object.entries(n))e[t]=HR(r);return e}class oRe extends OH{constructor(){super(...arguments),Object.defineProperty(this,"_metaRegistry",{enumerable:!0,configurable:!0,writable:!0,value:kH})}attachNode(e,t){let r;e===jn?r=Object.entries(this.builder._schemaDefinitions.get(this.builder._inputDefinition)).filter(([u,c])=>!Nw(c)).map(([u])=>u):r=Object.keys(this.builder.channels);function i(u){if(Kr(u))return u.graph===qi.PARENT?null:u._updateAsTuples();if(Array.isArray(u)&&u.length>0&&u.some(c=>Kr(c))){const c=[];for(const d of u)if(Kr(d)){if(d.graph===qi.PARENT)continue;c.push(...d._updateAsTuples())}else c.push([Ho,d]);return c}else if(u!=null)return[[Ho,u]];return null}const a=e;function s(u){if(u){if(Kr(u))return u.graph===qi.PARENT?null:u._updateAsTuples().filter(([c])=>r.includes(c));if(Array.isArray(u)&&u.length>0&&u.some(Kr)){const c=[];for(const d of u)if(Kr(d)){if(d.graph===qi.PARENT)continue;c.push(...d._updateAsTuples().filter(([h])=>r.includes(h)))}else{const h=s(d);h&&c.push(...h??[])}return c}else{if(typeof u=="object"&&!Array.isArray(u))return Object.entries(u).filter(([c])=>r.includes(c));{const c=Array.isArray(u)?"array":typeof u;throw new qn(`Expected node "${a.toString()}" to return an object or an array containing at least one Command object, received ${c}`,{lc_error_code:"INVALID_GRAPH_NODE_RETURN_VALUE"})}}}else return null}const o=[{value:ic,mapper:new fu({func:r.length&&r[0]===Ho?i:s,trace:!1,recurse:!1})}];if(e===jn)this.nodes[e]=new ao({tags:[cr],triggers:[jn],channels:[jn],writers:[new Dr(o,[cr])]});else{const u=(t==null?void 0:t.input)??this.builder._schemaDefinition,c=Object.fromEntries(Object.keys(this.builder._schemaDefinitions.get(u)).map(m=>[m,m])),d=Object.keys(c).length===1&&Ho in c,h=`branch:to:${e}`;this.channels[h]=t!=null&&t.defer?new BO:new su(!1),this.nodes[e]=new ao({triggers:[h],channels:d?Object.keys(c):c,writers:[new Dr(o,[cr])],mapper:d?void 0:m=>Object.fromEntries(Object.entries(m).filter(([g])=>g in c)),bound:t==null?void 0:t.runnable,metadata:t==null?void 0:t.metadata,retryPolicy:t==null?void 0:t.retryPolicy,cachePolicy:t==null?void 0:t.cachePolicy,subgraphs:t==null?void 0:t.subgraphs,ends:t==null?void 0:t.ends})}}attachEdge(e,t){if(t!==Dt){if(typeof e=="string")this.nodes[e].writers.push(new Dr([{channel:`branch:to:${t}`,value:null}],[cr]));else if(Array.isArray(e)){const r=`join:${e.join("+")}:${t}`;this.channels[r]=this.builder.nodes[t].defer?new FO(new Set(e)):new jO(new Set(e)),this.nodes[t].triggers.push(r);for(const i of e)this.nodes[i].writers.push(new Dr([{channel:r,value:i}],[cr]))}}}attachBranch(e,t,r,i={withReader:!0}){const a=async(s,o)=>{const u=s.filter(d=>d!==Dt);if(!u.length)return;const c=u.map(d=>Yi(d)?d:{channel:d===Dt?d:`branch:to:${d}`,value:e});await Dr.doWrite({...o,tags:(o.tags??[]).concat([cr])},c)};this.nodes[e].writers.push(r.run(a,i.withReader?s=>DO.doRead(s,this.streamChannels??this.outputChannels,!0):void 0))}async _validateInput(e){if(e==null)return e;const t=(()=>{const r=this.builder._inputRuntimeDefinition,i=this.builder._schemaRuntimeDefinition,a=s=>{if(s!=null)return this._metaRegistry.getExtendedChannelSchemas(s,{withReducerSchema:!0})};if(Wo(r))return a(r);if(r===GR)return RI(a(i))})();if(Kr(e)){const r=e;return e.update&&t!=null&&(r.update=Dv(t,e.update)),r}return t!=null?Dv(t,e):e}async _validateConfigurable(e){const t=this.builder._configRuntimeSchema;return Wo(t)&&Dv(t,e),e}}function lRe(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&Object.keys(n).length>0&&Object.values(n).every(e=>typeof e=="function"||kw(e))}function N3(n){return typeof n=="object"&&n!==null&&"lc_graph_name"in n&&n.lc_graph_name==="AnnotationRoot"}function uRe(n){return typeof n=="object"&&n!==null&&n.channels!==void 0}function cRe(n){return typeof n=="object"&&n!==null&&n.stateSchema!==void 0}function fRe(n){return typeof n=="object"&&n!==null&&n.stateSchema===void 0&&n.input!==void 0&&n.output!==void 0}function dRe(n){return!(typeof n!="object"||n==null||!("state"in n)||!Wo(n.state)||"input"in n&&!Wo(n.input)||"output"in n&&!Wo(n.output))}function hRe(n){if(Yi(n))return[n];const e=[];Kr(n)?e.push(n):Array.isArray(n)&&e.push(...n.filter(Kr));const t=[];for(const r of e){if(r.graph===qi.PARENT)throw new wH(r);Yi(r.goto)||typeof r.goto=="string"?t.push(r.goto):Array.isArray(r.goto)&&t.push(...r.goto)}return t}function M3(){const n=new fu({func:hRe,tags:[cr],trace:!1,recurse:!1,name:"<control_branch>"});return new PH({path:n})}const pRe="__remove_all__";function NH(n,e){const t=Array.isArray(n)?n:[n],r=Array.isArray(e)?e:[e],i=t.map(_s),a=r.map(_s);for(const d of i)(d.id===null||d.id===void 0)&&(d.id=A3(),d.lc_kwargs.id=d.id);let s;for(let d=0;d<a.length;d+=1){const h=a[d];(h.id===null||h.id===void 0)&&(h.id=A3(),h.lc_kwargs.id=h.id),h.getType()==="remove"&&h.id===pRe&&(s=d)}if(s!=null)return a.slice(s+1);const o=[...i],u=new Map(o.map((d,h)=>[d.id,h])),c=new Set;for(const d of a){const h=u.get(d.id);if(h!==void 0)d.getType()==="remove"?c.add(d.id):(c.delete(d.id),o[h]=d);else{if(d.getType()==="remove")throw new Error(`Attempting to delete a message with an ID that doesn't exist ('${d.id}')`);u.set(d.id,o.length),o.push(d)}}return o.filter(d=>!c.has(d.id))}class mRe extends fu{constructor(e,t){const{name:r,tags:i,handleToolErrors:a}=t??{};super({name:r,tags:i,func:(s,o)=>this.run(s,o)}),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"handleToolErrors",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"trace",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.tools=e,this.handleToolErrors=a??this.handleToolErrors}async run(e,t){var o;const r=Array.isArray(e)?e[e.length-1]:e.messages[e.messages.length-1];if((r==null?void 0:r._getType())!=="ai")throw new Error("ToolNode only accepts AIMessages as input.");const i=await Promise.all(((o=r.tool_calls)==null?void 0:o.map(async u=>{const c=this.tools.find(d=>d.name===u.name);try{if(c===void 0)throw new Error(`Tool "${u.name}" not found.`);const d=await c.invoke({...u,type:"tool_call"},t);return Vn(d)&&d._getType()==="tool"||Kr(d)?d:new Yo({name:c.name,content:typeof d=="string"?d:JSON.stringify(d),tool_call_id:u.id})}catch(d){if(!this.handleToolErrors||rd(d))throw d;return new Yo({content:`Error: ${d.message}
 Please fix your mistakes.`,name:u.name,tool_call_id:u.id??""})}}))??[]);if(!i.some(Kr))return Array.isArray(e)?i:{messages:i};const a=[];let s=null;for(const u of i)Kr(u)?u.graph===qi.PARENT&&Array.isArray(u.goto)&&u.goto.every(c=>Yi(c))?s?s.goto.push(...u.goto):s=new qi({graph:qi.PARENT,goto:u.goto}):a.push(u):a.push(Array.isArray(e)?[u]:{messages:[u]});return s&&a.push(s),a}}const BC=/<name>(.*?)<\/name>/s,qC=/<content>(.*?)<\/content>/s;function gRe(n){if(!(Vn(n)&&(Ea(n)||wd(n)&&p_(n)))||!n.name)return n;const{name:t}=n;if(typeof n.content=="string")return new Tn({...Object.keys(n.lc_kwargs??{}).length>0?n.lc_kwargs:n,content:`<name>${t}</name><content>${n.content}</content>`,name:void 0});const r=[];let i=0;for(const a of n.content)typeof a=="string"?(i+=1,r.push(`<name>${t}</name><content>${a}</content>`)):typeof a=="object"&&"type"in a&&a.type==="text"?(i+=1,r.push({...a,text:`<name>${t}</name><content>${a.text}</content>`})):r.push(a);return i||r.unshift({type:"text",text:`<name>${t}</name><content></content>`}),new Tn({...n.lc_kwargs,content:r,name:void 0})}function yRe(n){if(!Ea(n)||!n.content)return n;let e=[],t;if(Array.isArray(n.content))e=n.content.filter(r=>{if(r.type==="text"){const i=r.text.match(BC),a=r.text.match(qC);return i&&(!a||a[1]==="")?(t=i[1],!1):!0}return!0}).map(r=>{if(r.type==="text"){const i=r.text.match(BC),a=r.text.match(qC);return!i||!a?r:(t=i[1],{...r,text:a[1]})}return r});else{const r=n.content,i=r.match(BC),a=r.match(qC);if(!i||!a)return n;t=i[1],e=a[1]}return new Tn({...Object.keys(n.lc_kwargs??{}).length>0?n.lc_kwargs:n,content:e,name:t})}function vRe(n,e){let t,r;if(e==="inline")t=gRe,r=yRe;else throw new Error(`Invalid agent name mode: ${e}. Needs to be one of: "inline"`);function i(a){return a.map(t)}return Ar.from([Cr.from(i),n,Cr.from(r)])}function _Re(n){if(typeof n=="string"||Vn(n)&&n._getType()==="system")return n;if(typeof n=="function")return async e=>n(e.messages);if(Gt.isRunnable(n))return Cr.from(e=>e.messages).pipe(n);throw new Error(`Unexpected type for messageModifier: ${typeof n}`)}const Iv="prompt";function bRe(n){let e;if(n==null)e=Cr.from(t=>t.messages).withConfig({runName:Iv});else if(typeof n=="string"){const t=new Cs(n);e=Cr.from(r=>[t,...r.messages??[]]).withConfig({runName:Iv})}else if(Vn(n)&&n._getType()==="system")e=Cr.from(t=>[n,...t.messages]).withConfig({runName:Iv});else if(typeof n=="function")e=Cr.from(n).withConfig({runName:Iv});else if(Gt.isRunnable(n))e=n;else throw new Error(`Got unexpected type for 'prompt': ${typeof n}`);return e}function WR(n){return Gt.isRunnable(n)}function wRe(n,e,t){if([n,e,t].filter(a=>a!=null).length>1)throw new Error("Expected only one of prompt, stateModifier, or messageModifier, got multiple values");let i=n;return e!=null?i=e:t!=null&&(i=_Re(t)),bRe(i)}function KR(n){return"invoke"in n&&typeof n.invoke=="function"&&"_modelType"in n}function _b(n){return"_queuedMethodOperations"in n&&"_model"in n&&typeof n._model=="function"}async function ERe(n,e){let t=n;if(Ar.isRunnableSequence(t)&&(t=t.steps.find(o=>bi.isRunnableBinding(o)||KR(o)||_b(o))||t),_b(t)&&(t=await t._model()),!bi.isRunnableBinding(t)||!t.kwargs||typeof t.kwargs!="object"||!("tools"in t.kwargs))return!0;let r=t.kwargs.tools;if(r.length===1&&"functionDeclarations"in r[0]&&(r=r[0].functionDeclarations),e.length!==r.length)throw new Error("Number of tools in the model.bindTools() and tools passed to createReactAgent must match");const i=new Set(e.flatMap(o=>WR(o)?o.name:[])),a=new Set;for(const o of r){let u;if("type"in o&&o.type==="function")u=o.function.name;else if("name"in o)u=o.name;else if("toolSpec"in o&&"name"in o.toolSpec)u=o.toolSpec.name;else continue;u&&a.add(u)}const s=[...i].filter(o=>!a.has(o));if(s.length>0)throw new Error(`Missing tools '${s}' in the model.bindTools().Tools in the model.bindTools() must match the tools passed to createReactAgent.`);return!1}async function D3(n){let e=n;if(Ar.isRunnableSequence(e)&&(e=e.steps.find(t=>bi.isRunnableBinding(t)||KR(t)||_b(t))||e),_b(e)&&(e=await e._model()),bi.isRunnableBinding(e)&&(e=e.bound),!KR(e))throw new Error(`Expected \`llm\` to be a ChatModel or RunnableBinding (e.g. llm.bind_tools(...)) with invoke() and generate() methods, got ${e.constructor.name}`);return e}const SRe=()=>sc.Root({messages:sc({reducer:NH,default:()=>[]}),structuredResponse:sc}),TRe=sc.Root({llmInputMessages:sc({reducer:NH,default:()=>[]})});function ARe(n){const{llm:e,tools:t,messageModifier:r,stateModifier:i,prompt:a,stateSchema:s,checkpointSaver:o,checkpointer:u,interruptBefore:c,interruptAfter:d,store:h,responseFormat:m,preModelHook:g,postModelHook:_,name:w,includeAgentName:S}=n;let E,C;Array.isArray(t)?(E=t,C=new mRe(E.filter(WR))):(E=t.tools,C=t);let A=null;const R=async se=>{if(A)return A;let ee;if(await ERe(se,E)){if(!("bindTools"in se)||typeof se.bindTools!="function")throw new Error(`llm ${se} must define bindTools method.`);ee=se.bindTools(E)}else ee=se;const le=wRe(a,i,r),pe=S==="inline"?le.pipe(vRe(ee,S)):le.pipe(ee);return A=pe,pe},P=new Set(E.filter(WR).filter(se=>"returnDirect"in se&&se.returnDirect).map(se=>se.name));function N(se){const{messages:ee,llmInputMessages:le,...pe}=se;return le!=null&&le.length>0?{messages:le,...pe}:{messages:ee,...pe}}const U=async(se,ee)=>{if(m==null)throw new Error("Attempted to generate structured output with no passed response schema. Please contact us for help.");const le=[...se.messages];let pe;if(typeof m=="object"&&"prompt"in m&&"schema"in m){const{prompt:$,schema:ve}=m;pe=(await D3(e)).withStructuredOutput(ve),le.unshift(new Cs({content:$}))}else pe=(await D3(e)).withStructuredOutput(m);return{structuredResponse:await pe.invoke(le,ee)}},k=async(se,ee)=>{const pe=await(await R(e)).invoke(N(se),ee);return pe.name=w,pe.lc_kwargs.name=w,{messages:[pe]}},B=s??SRe(),H=new aRe(B).addNode("tools",C),G=H,z=se=>Object.fromEntries(Object.entries(se).filter(([ee,le])=>le!=null));let oe="agent",te;return g!=null?(G.addNode("pre_model_hook",g).addEdge("pre_model_hook","agent"),oe="pre_model_hook",te=sc.Root({...B.spec,...TRe.spec})):oe="agent",G.addNode("agent",k,{input:te}).addEdge(jn,oe),_!=null&&G.addNode("post_model_hook",_).addEdge("agent","post_model_hook").addConditionalEdges("post_model_hook",se=>{var pe;const{messages:ee}=se,le=ee[ee.length-1];return Ea(le)&&((pe=le.tool_calls)!=null&&pe.length)?"tools":um(le)?oe:m!=null?"generate_structured_response":Dt},z({tools:"tools",[oe]:oe,generate_structured_response:m!=null?"generate_structured_response":null,[Dt]:m!=null?null:Dt})),m!==void 0&&H.addNode("generate_structured_response",U).addEdge("generate_structured_response",Dt),_==null&&G.addConditionalEdges("agent",se=>{var pe;const{messages:ee}=se,le=ee[ee.length-1];return!Ea(le)||!((pe=le.tool_calls)!=null&&pe.length)?m!=null?"generate_structured_response":Dt:"tools"},z({tools:"tools",generate_structured_response:m!=null?"generate_structured_response":null,[Dt]:m!=null?null:Dt})),P.size>0?G.addConditionalEdges("tools",se=>{for(let ee=se.messages.length-1;ee>=0;ee-=1){const le=se.messages[ee];if(!um(le))break;if(le.name!==void 0&&P.has(le.name))return Dt}return oe},z({[oe]:oe,[Dt]:Dt})):G.addEdge("tools",oe),G.compile({checkpointer:u??o,interruptBefore:c,interruptAfter:d,store:h,name:w})}const $3="mcpLlmClientApiKeys",CRe=()=>{const{user:n,loadingAuth:e,signOut:t}=J1e(),[r,i]=wt.useState({openai:"",claude:"",gemini:""}),[a,s]=wt.useState("gemini"),[o,u]=wt.useState(wv),[c,d]=wt.useState(!1),{mcpServers:h,serversLoadedFromStorage:m,handleAddServer:g,handleRemoveServer:_,handleConnectToServer:w,mcpCleanup:S,stableConnectedServerConfig:E}=nwe({}),[C,A]=wt.useState(null),[R,P]=wt.useState(void 0),N=wt.useMemo(()=>JSON.stringify({provider:a,apiKeys:r,connectedServers:E}),[a,r,E]);wt.useEffect(()=>{if(!m||!c||!o){A(null),P(void 0);return}const B=JSON.parse(N);if(Object.keys(B.connectedServers).length===0){A(null),P(void 0);return}let H=!1;return(async()=>{try{let z=null;switch(B.provider){case"openai":B.apiKeys.openai&&(z=new Hce({apiKey:B.apiKeys.openai}));break;case"claude":B.apiKeys.claude&&(z=new Yfe({apiKey:B.apiKeys.claude}));break;case"gemini":B.apiKeys.gemini&&(z=new Vde({apiKey:B.apiKeys.gemini,model:"gemini-2.5-flash-preview-04-17"}));break}if(!z){A(null),P(void 0);return}const oe=await cle(B.connectedServers,{logLevel:"info"});if(H){oe.cleanup&&oe.cleanup(),P(void 0);return}const te=oe.tools;Array.isArray(te)?console.log("Langchain tools disponibles:",te.map(se=>se.name||se)):console.log("Langchain tools disponibles:",te),P(()=>oe.cleanup),A(()=>ARe({llm:z,tools:te}))}catch(z){console.error("Error during agent initialization:",z),A(null),P(void 0)}})(),()=>{H=!0,R&&R(),A(null),P(void 0)}},[N,m,c,o]),wt.useEffect(()=>()=>{R&&R(),S&&S()},[R,S]),wt.useEffect(()=>{try{const B=localStorage.getItem($3);if(B){const H=JSON.parse(B);if(i(H),H&&typeof H=="object"){let G="gemini";switch(H.openai&&(G="openai"),H.claude&&(G="claude"),H.gemini&&(G="gemini"),s(G),G){case"openai":u(CB);break;case"claude":u(xB);break;case"gemini":u(wv);break;default:u(wv)}}}}catch(B){console.error("Error loading API keys from localStorage:",B)}finally{d(!0)}},[]),wt.useEffect(()=>{if(c)try{const B=JSON.stringify(r);localStorage.setItem($3,B)}catch(B){console.error("Error saving API keys to localStorage:",B)}},[r,c]);const U=B=>{var H,G,z,oe;i(B),(H=B[a])!=null&&H.trim()||((G=B.gemini)!=null&&G.trim()?s("gemini"):(z=B.openai)!=null&&z.trim()?s("openai"):(oe=B.claude)!=null&&oe.trim()&&s("claude"))},k=B=>{switch(s(B),B){case"openai":u(CB);break;case"claude":u(xB);break;case"gemini":u(wv);break;default:u(null)}};return e?Ae.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-900 text-gray-300",children:[Ae.jsx(sd,{className:"w-12 h-12 text-sky-400"}),Ae.jsx("p",{className:"ml-4 text-xl mt-4",children:"Loading Application..."})]}):Ae.jsxs("div",{className:"flex flex-col min-h-screen bg-gray-900 text-gray-100",children:[Ae.jsx(uW,{user:n,signOut:t}),Ae.jsx("main",{className:"flex-grow container mx-auto p-4 md:p-6 lg:p-8",children:Ae.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8",children:[Ae.jsx("div",{className:"lg:col-span-3 space-y-6 md:space-y-8",children:Ae.jsxs("div",{className:"bg-gray-800 p-6 rounded-xl shadow-xl",children:[Ae.jsx("h2",{className:"text-xl font-semibold text-sky-400 mb-2",children:"Welcome to MCP LLM Client!"}),Ae.jsx("p",{className:"text-gray-400",children:"Manage your LLM API keys, select your preferred provider, configure MCP server connections, and chat with AI."})]})}),Ae.jsxs("div",{className:"lg:col-span-1 space-y-6 md:space-y-8",children:[Ae.jsx(fW,{apiKeys:r,onApiKeysChange:U,activeLLMProvider:a,onLLMProviderChange:k,keysLoadedFromStorage:c}),Ae.jsx(dW,{servers:h,onAddServer:g,onRemoveServer:_,onConnectToServer:w,serversLoadedFromStorage:m})]}),Ae.jsx("div",{className:"lg:col-span-2 space-y-6 md:space-y-8",children:c&&m&&Ae.jsx(gre,{apiKeys:r,activeProvider:a,mcpServers:h,keysLoadedFromStorage:c,langchainAgent:C,activeLLMService:o})})]})}),Ae.jsx(cW,{})]})},MH=document.getElementById("root");if(!MH)throw new Error("Could not find root element to mount to");const xRe=rW.createRoot(MH);xRe.render(Ae.jsx(J7.StrictMode,{children:Ae.jsx(CRe,{})}));
