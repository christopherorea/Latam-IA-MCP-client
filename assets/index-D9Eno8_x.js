var Gz=Object.defineProperty;var Wz=(n,e,t)=>e in n?Gz(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var Kr=(n,e,t)=>Wz(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();function Js(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function Kz(n){if(Object.prototype.hasOwnProperty.call(n,"__esModule"))return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var Gw={exports:{}},wh={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vk;function Jz(){if(Vk)return wh;Vk=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(r,i,a){var s=null;if(a!==void 0&&(s=""+a),i.key!==void 0&&(s=""+i.key),"key"in i){a={};for(var o in i)o!=="key"&&(a[o]=i[o])}else a=i;return i=a.ref,{$$typeof:n,type:r,key:s,ref:i!==void 0?i:null,props:a}}return wh.Fragment=e,wh.jsx=t,wh.jsxs=t,wh}var zk;function Yz(){return zk||(zk=1,Gw.exports=Jz()),Gw.exports}var Ae=Yz(),Ww={exports:{}};function Zz(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var AF={exports:{}},Yn=AF.exports={},Rs,Is;function jC(){throw new Error("setTimeout has not been defined")}function FC(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?Rs=setTimeout:Rs=jC}catch{Rs=jC}try{typeof clearTimeout=="function"?Is=clearTimeout:Is=FC}catch{Is=FC}})();function CF(n){if(Rs===setTimeout)return setTimeout(n,0);if((Rs===jC||!Rs)&&setTimeout)return Rs=setTimeout,setTimeout(n,0);try{return Rs(n,0)}catch{try{return Rs.call(null,n,0)}catch{return Rs.call(this,n,0)}}}function Xz(n){if(Is===clearTimeout)return clearTimeout(n);if((Is===FC||!Is)&&clearTimeout)return Is=clearTimeout,clearTimeout(n);try{return Is(n)}catch{try{return Is.call(null,n)}catch{return Is.call(this,n)}}}var Ao=[],Lf=!1,Eu,Hy=-1;function Qz(){!Lf||!Eu||(Lf=!1,Eu.length?Ao=Eu.concat(Ao):Hy=-1,Ao.length&&RF())}function RF(){if(!Lf){var n=CF(Qz);Lf=!0;for(var e=Ao.length;e;){for(Eu=Ao,Ao=[];++Hy<e;)Eu&&Eu[Hy].run();Hy=-1,e=Ao.length}Eu=null,Lf=!1,Xz(n)}}Yn.nextTick=function(n){var e=new Array(arguments.length-1);if(arguments.length>1)for(var t=1;t<arguments.length;t++)e[t-1]=arguments[t];Ao.push(new IF(n,e)),Ao.length===1&&!Lf&&CF(RF)};function IF(n,e){this.fun=n,this.array=e}IF.prototype.run=function(){this.fun.apply(null,this.array)};Yn.title="browser";Yn.browser=!0;Yn.env={};Yn.argv=[];Yn.version="";Yn.versions={};function Fo(){}Yn.on=Fo;Yn.addListener=Fo;Yn.once=Fo;Yn.off=Fo;Yn.removeListener=Fo;Yn.removeAllListeners=Fo;Yn.emit=Fo;Yn.prependListener=Fo;Yn.prependOnceListener=Fo;Yn.listeners=function(n){return[]};Yn.binding=function(n){throw new Error("process.binding is not supported")};Yn.cwd=function(){return"/"};Yn.chdir=function(n){throw new Error("process.chdir is not supported")};Yn.umask=function(){return 0};var eH=AF.exports;const at=Zz(eH);var Dt={},Hk;function tH(){if(Hk)return Dt;Hk=1;var n=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),s=Symbol.for("react.context"),o=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),d=Symbol.for("react.lazy"),p=Symbol.iterator;function m(Y){return Y===null||typeof Y!="object"?null:(Y=p&&Y[p]||Y["@@iterator"],typeof Y=="function"?Y:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b=Object.assign,w={};function S(Y,ve,Re){this.props=Y,this.context=ve,this.refs=w,this.updater=Re||y}S.prototype.isReactComponent={},S.prototype.setState=function(Y,ve){if(typeof Y!="object"&&typeof Y!="function"&&Y!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Y,ve,"setState")},S.prototype.forceUpdate=function(Y){this.updater.enqueueForceUpdate(this,Y,"forceUpdate")};function T(){}T.prototype=S.prototype;function C(Y,ve,Re){this.props=Y,this.context=ve,this.refs=w,this.updater=Re||y}var A=C.prototype=new T;A.constructor=C,b(A,S.prototype),A.isPureReactComponent=!0;var I=Array.isArray,x={H:null,A:null,T:null,S:null,V:null},L=Object.prototype.hasOwnProperty;function U(Y,ve,Re,Q,ie,ce){return Re=ce.ref,{$$typeof:n,type:Y,key:ve,ref:Re!==void 0?Re:null,props:ce}}function N(Y,ve){return U(Y.type,ve,void 0,void 0,void 0,Y.props)}function B(Y){return typeof Y=="object"&&Y!==null&&Y.$$typeof===n}function q(Y){var ve={"=":"=0",":":"=2"};return"$"+Y.replace(/[=:]/g,function(Re){return ve[Re]})}var J=/\/+/g;function V(Y,ve){return typeof Y=="object"&&Y!==null&&Y.key!=null?q(""+Y.key):ve.toString(36)}function de(){}function ae(Y){switch(Y.status){case"fulfilled":return Y.value;case"rejected":throw Y.reason;default:switch(typeof Y.status=="string"?Y.then(de,de):(Y.status="pending",Y.then(function(ve){Y.status==="pending"&&(Y.status="fulfilled",Y.value=ve)},function(ve){Y.status==="pending"&&(Y.status="rejected",Y.reason=ve)})),Y.status){case"fulfilled":return Y.value;case"rejected":throw Y.reason}}throw Y}function ue(Y,ve,Re,Q,ie){var ce=typeof Y;(ce==="undefined"||ce==="boolean")&&(Y=null);var P=!1;if(Y===null)P=!0;else switch(ce){case"bigint":case"string":case"number":P=!0;break;case"object":switch(Y.$$typeof){case n:case e:P=!0;break;case d:return P=Y._init,ue(P(Y._payload),ve,Re,Q,ie)}}if(P)return ie=ie(Y),P=Q===""?"."+V(Y,0):Q,I(ie)?(Re="",P!=null&&(Re=P.replace(J,"$&/")+"/"),ue(ie,ve,Re,"",function(X){return X})):ie!=null&&(B(ie)&&(ie=N(ie,Re+(ie.key==null||Y&&Y.key===ie.key?"":(""+ie.key).replace(J,"$&/")+"/")+P)),ve.push(ie)),1;P=0;var O=Q===""?".":Q+":";if(I(Y))for(var K=0;K<Y.length;K++)Q=Y[K],ce=O+V(Q,K),P+=ue(Q,ve,Re,ce,ie);else if(K=m(Y),typeof K=="function")for(Y=K.call(Y),K=0;!(Q=Y.next()).done;)Q=Q.value,ce=O+V(Q,K++),P+=ue(Q,ve,Re,ce,ie);else if(ce==="object"){if(typeof Y.then=="function")return ue(ae(Y),ve,Re,Q,ie);throw ve=String(Y),Error("Objects are not valid as a React child (found: "+(ve==="[object Object]"?"object with keys {"+Object.keys(Y).join(", ")+"}":ve)+"). If you meant to render a collection of children, use an array instead.")}return P}function te(Y,ve,Re){if(Y==null)return Y;var Q=[],ie=0;return ue(Y,Q,"","",function(ce){return ve.call(Re,ce,ie++)}),Q}function oe(Y){if(Y._status===-1){var ve=Y._result;ve=ve(),ve.then(function(Re){(Y._status===0||Y._status===-1)&&(Y._status=1,Y._result=Re)},function(Re){(Y._status===0||Y._status===-1)&&(Y._status=2,Y._result=Re)}),Y._status===-1&&(Y._status=0,Y._result=ve)}if(Y._status===1)return Y._result.default;throw Y._result}var ge=typeof reportError=="function"?reportError:function(Y){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var ve=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof Y=="object"&&Y!==null&&typeof Y.message=="string"?String(Y.message):String(Y),error:Y});if(!window.dispatchEvent(ve))return}else if(typeof at=="object"&&typeof at.emit=="function"){at.emit("uncaughtException",Y);return}console.error(Y)};function Ee(){}return Dt.Children={map:te,forEach:function(Y,ve,Re){te(Y,function(){ve.apply(this,arguments)},Re)},count:function(Y){var ve=0;return te(Y,function(){ve++}),ve},toArray:function(Y){return te(Y,function(ve){return ve})||[]},only:function(Y){if(!B(Y))throw Error("React.Children.only expected to receive a single React element child.");return Y}},Dt.Component=S,Dt.Fragment=t,Dt.Profiler=i,Dt.PureComponent=C,Dt.StrictMode=r,Dt.Suspense=u,Dt.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=x,Dt.__COMPILER_RUNTIME={__proto__:null,c:function(Y){return x.H.useMemoCache(Y)}},Dt.cache=function(Y){return function(){return Y.apply(null,arguments)}},Dt.cloneElement=function(Y,ve,Re){if(Y==null)throw Error("The argument must be a React element, but you passed "+Y+".");var Q=b({},Y.props),ie=Y.key,ce=void 0;if(ve!=null)for(P in ve.ref!==void 0&&(ce=void 0),ve.key!==void 0&&(ie=""+ve.key),ve)!L.call(ve,P)||P==="key"||P==="__self"||P==="__source"||P==="ref"&&ve.ref===void 0||(Q[P]=ve[P]);var P=arguments.length-2;if(P===1)Q.children=Re;else if(1<P){for(var O=Array(P),K=0;K<P;K++)O[K]=arguments[K+2];Q.children=O}return U(Y.type,ie,void 0,void 0,ce,Q)},Dt.createContext=function(Y){return Y={$$typeof:s,_currentValue:Y,_currentValue2:Y,_threadCount:0,Provider:null,Consumer:null},Y.Provider=Y,Y.Consumer={$$typeof:a,_context:Y},Y},Dt.createElement=function(Y,ve,Re){var Q,ie={},ce=null;if(ve!=null)for(Q in ve.key!==void 0&&(ce=""+ve.key),ve)L.call(ve,Q)&&Q!=="key"&&Q!=="__self"&&Q!=="__source"&&(ie[Q]=ve[Q]);var P=arguments.length-2;if(P===1)ie.children=Re;else if(1<P){for(var O=Array(P),K=0;K<P;K++)O[K]=arguments[K+2];ie.children=O}if(Y&&Y.defaultProps)for(Q in P=Y.defaultProps,P)ie[Q]===void 0&&(ie[Q]=P[Q]);return U(Y,ce,void 0,void 0,null,ie)},Dt.createRef=function(){return{current:null}},Dt.forwardRef=function(Y){return{$$typeof:o,render:Y}},Dt.isValidElement=B,Dt.lazy=function(Y){return{$$typeof:d,_payload:{_status:-1,_result:Y},_init:oe}},Dt.memo=function(Y,ve){return{$$typeof:c,type:Y,compare:ve===void 0?null:ve}},Dt.startTransition=function(Y){var ve=x.T,Re={};x.T=Re;try{var Q=Y(),ie=x.S;ie!==null&&ie(Re,Q),typeof Q=="object"&&Q!==null&&typeof Q.then=="function"&&Q.then(Ee,ge)}catch(ce){ge(ce)}finally{x.T=ve}},Dt.unstable_useCacheRefresh=function(){return x.H.useCacheRefresh()},Dt.use=function(Y){return x.H.use(Y)},Dt.useActionState=function(Y,ve,Re){return x.H.useActionState(Y,ve,Re)},Dt.useCallback=function(Y,ve){return x.H.useCallback(Y,ve)},Dt.useContext=function(Y){return x.H.useContext(Y)},Dt.useDebugValue=function(){},Dt.useDeferredValue=function(Y,ve){return x.H.useDeferredValue(Y,ve)},Dt.useEffect=function(Y,ve,Re){var Q=x.H;if(typeof Re=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Q.useEffect(Y,ve)},Dt.useId=function(){return x.H.useId()},Dt.useImperativeHandle=function(Y,ve,Re){return x.H.useImperativeHandle(Y,ve,Re)},Dt.useInsertionEffect=function(Y,ve){return x.H.useInsertionEffect(Y,ve)},Dt.useLayoutEffect=function(Y,ve){return x.H.useLayoutEffect(Y,ve)},Dt.useMemo=function(Y,ve){return x.H.useMemo(Y,ve)},Dt.useOptimistic=function(Y,ve){return x.H.useOptimistic(Y,ve)},Dt.useReducer=function(Y,ve,Re){return x.H.useReducer(Y,ve,Re)},Dt.useRef=function(Y){return x.H.useRef(Y)},Dt.useState=function(Y){return x.H.useState(Y)},Dt.useSyncExternalStore=function(Y,ve,Re){return x.H.useSyncExternalStore(Y,ve,Re)},Dt.useTransition=function(){return x.H.useTransition()},Dt.version="19.1.0",Dt}var Gk;function DR(){return Gk||(Gk=1,Ww.exports=tH()),Ww.exports}var _t=DR();const nH=Js(_t);var Kw={exports:{}},Eh={},Jw={exports:{}},Yw={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Wk;function rH(){return Wk||(Wk=1,function(n){function e(te,oe){var ge=te.length;te.push(oe);e:for(;0<ge;){var Ee=ge-1>>>1,Y=te[Ee];if(0<i(Y,oe))te[Ee]=oe,te[ge]=Y,ge=Ee;else break e}}function t(te){return te.length===0?null:te[0]}function r(te){if(te.length===0)return null;var oe=te[0],ge=te.pop();if(ge!==oe){te[0]=ge;e:for(var Ee=0,Y=te.length,ve=Y>>>1;Ee<ve;){var Re=2*(Ee+1)-1,Q=te[Re],ie=Re+1,ce=te[ie];if(0>i(Q,ge))ie<Y&&0>i(ce,Q)?(te[Ee]=ce,te[ie]=ge,Ee=ie):(te[Ee]=Q,te[Re]=ge,Ee=Re);else if(ie<Y&&0>i(ce,ge))te[Ee]=ce,te[ie]=ge,Ee=ie;else break e}}return oe}function i(te,oe){var ge=te.sortIndex-oe.sortIndex;return ge!==0?ge:te.id-oe.id}if(n.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var a=performance;n.unstable_now=function(){return a.now()}}else{var s=Date,o=s.now();n.unstable_now=function(){return s.now()-o}}var u=[],c=[],d=1,p=null,m=3,y=!1,b=!1,w=!1,S=!1,T=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,A=typeof setImmediate<"u"?setImmediate:null;function I(te){for(var oe=t(c);oe!==null;){if(oe.callback===null)r(c);else if(oe.startTime<=te)r(c),oe.sortIndex=oe.expirationTime,e(u,oe);else break;oe=t(c)}}function x(te){if(w=!1,I(te),!b)if(t(u)!==null)b=!0,L||(L=!0,V());else{var oe=t(c);oe!==null&&ue(x,oe.startTime-te)}}var L=!1,U=-1,N=5,B=-1;function q(){return S?!0:!(n.unstable_now()-B<N)}function J(){if(S=!1,L){var te=n.unstable_now();B=te;var oe=!0;try{e:{b=!1,w&&(w=!1,C(U),U=-1),y=!0;var ge=m;try{t:{for(I(te),p=t(u);p!==null&&!(p.expirationTime>te&&q());){var Ee=p.callback;if(typeof Ee=="function"){p.callback=null,m=p.priorityLevel;var Y=Ee(p.expirationTime<=te);if(te=n.unstable_now(),typeof Y=="function"){p.callback=Y,I(te),oe=!0;break t}p===t(u)&&r(u),I(te)}else r(u);p=t(u)}if(p!==null)oe=!0;else{var ve=t(c);ve!==null&&ue(x,ve.startTime-te),oe=!1}}break e}finally{p=null,m=ge,y=!1}oe=void 0}}finally{oe?V():L=!1}}}var V;if(typeof A=="function")V=function(){A(J)};else if(typeof MessageChannel<"u"){var de=new MessageChannel,ae=de.port2;de.port1.onmessage=J,V=function(){ae.postMessage(null)}}else V=function(){T(J,0)};function ue(te,oe){U=T(function(){te(n.unstable_now())},oe)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(te){te.callback=null},n.unstable_forceFrameRate=function(te){0>te||125<te?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):N=0<te?Math.floor(1e3/te):5},n.unstable_getCurrentPriorityLevel=function(){return m},n.unstable_next=function(te){switch(m){case 1:case 2:case 3:var oe=3;break;default:oe=m}var ge=m;m=oe;try{return te()}finally{m=ge}},n.unstable_requestPaint=function(){S=!0},n.unstable_runWithPriority=function(te,oe){switch(te){case 1:case 2:case 3:case 4:case 5:break;default:te=3}var ge=m;m=te;try{return oe()}finally{m=ge}},n.unstable_scheduleCallback=function(te,oe,ge){var Ee=n.unstable_now();switch(typeof ge=="object"&&ge!==null?(ge=ge.delay,ge=typeof ge=="number"&&0<ge?Ee+ge:Ee):ge=Ee,te){case 1:var Y=-1;break;case 2:Y=250;break;case 5:Y=1073741823;break;case 4:Y=1e4;break;default:Y=5e3}return Y=ge+Y,te={id:d++,callback:oe,priorityLevel:te,startTime:ge,expirationTime:Y,sortIndex:-1},ge>Ee?(te.sortIndex=ge,e(c,te),t(u)===null&&te===t(c)&&(w?(C(U),U=-1):w=!0,ue(x,ge-Ee))):(te.sortIndex=Y,e(u,te),b||y||(b=!0,L||(L=!0,V()))),te},n.unstable_shouldYield=q,n.unstable_wrapCallback=function(te){var oe=m;return function(){var ge=m;m=oe;try{return te.apply(this,arguments)}finally{m=ge}}}}(Yw)),Yw}var Kk;function iH(){return Kk||(Kk=1,Jw.exports=rH()),Jw.exports}var Zw={exports:{}},Jr={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jk;function aH(){if(Jk)return Jr;Jk=1;var n=DR();function e(u){var c="https://react.dev/errors/"+u;if(1<arguments.length){c+="?args[]="+encodeURIComponent(arguments[1]);for(var d=2;d<arguments.length;d++)c+="&args[]="+encodeURIComponent(arguments[d])}return"Minified React error #"+u+"; visit "+c+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var r={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function a(u,c,d){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:p==null?null:""+p,children:u,containerInfo:c,implementation:d}}var s=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function o(u,c){if(u==="font")return"";if(typeof c=="string")return c==="use-credentials"?c:""}return Jr.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=r,Jr.createPortal=function(u,c){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!c||c.nodeType!==1&&c.nodeType!==9&&c.nodeType!==11)throw Error(e(299));return a(u,c,null,d)},Jr.flushSync=function(u){var c=s.T,d=r.p;try{if(s.T=null,r.p=2,u)return u()}finally{s.T=c,r.p=d,r.d.f()}},Jr.preconnect=function(u,c){typeof u=="string"&&(c?(c=c.crossOrigin,c=typeof c=="string"?c==="use-credentials"?c:"":void 0):c=null,r.d.C(u,c))},Jr.prefetchDNS=function(u){typeof u=="string"&&r.d.D(u)},Jr.preinit=function(u,c){if(typeof u=="string"&&c&&typeof c.as=="string"){var d=c.as,p=o(d,c.crossOrigin),m=typeof c.integrity=="string"?c.integrity:void 0,y=typeof c.fetchPriority=="string"?c.fetchPriority:void 0;d==="style"?r.d.S(u,typeof c.precedence=="string"?c.precedence:void 0,{crossOrigin:p,integrity:m,fetchPriority:y}):d==="script"&&r.d.X(u,{crossOrigin:p,integrity:m,fetchPriority:y,nonce:typeof c.nonce=="string"?c.nonce:void 0})}},Jr.preinitModule=function(u,c){if(typeof u=="string")if(typeof c=="object"&&c!==null){if(c.as==null||c.as==="script"){var d=o(c.as,c.crossOrigin);r.d.M(u,{crossOrigin:d,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0})}}else c==null&&r.d.M(u)},Jr.preload=function(u,c){if(typeof u=="string"&&typeof c=="object"&&c!==null&&typeof c.as=="string"){var d=c.as,p=o(d,c.crossOrigin);r.d.L(u,d,{crossOrigin:p,integrity:typeof c.integrity=="string"?c.integrity:void 0,nonce:typeof c.nonce=="string"?c.nonce:void 0,type:typeof c.type=="string"?c.type:void 0,fetchPriority:typeof c.fetchPriority=="string"?c.fetchPriority:void 0,referrerPolicy:typeof c.referrerPolicy=="string"?c.referrerPolicy:void 0,imageSrcSet:typeof c.imageSrcSet=="string"?c.imageSrcSet:void 0,imageSizes:typeof c.imageSizes=="string"?c.imageSizes:void 0,media:typeof c.media=="string"?c.media:void 0})}},Jr.preloadModule=function(u,c){if(typeof u=="string")if(c){var d=o(c.as,c.crossOrigin);r.d.m(u,{as:typeof c.as=="string"&&c.as!=="script"?c.as:void 0,crossOrigin:d,integrity:typeof c.integrity=="string"?c.integrity:void 0})}else r.d.m(u)},Jr.requestFormReset=function(u){r.d.r(u)},Jr.unstable_batchedUpdates=function(u,c){return u(c)},Jr.useFormState=function(u,c,d){return s.H.useFormState(u,c,d)},Jr.useFormStatus=function(){return s.H.useHostTransitionStatus()},Jr.version="19.1.0",Jr}var Yk;function sH(){if(Yk)return Zw.exports;Yk=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Zw.exports=aH(),Zw.exports}var Zk;function oH(){if(Zk)return Eh;Zk=1;/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var n=iH(),e=DR(),t=sH();function r(l){var f="https://react.dev/errors/"+l;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)f+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+l+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}function a(l){var f=l,h=l;if(l.alternate)for(;f.return;)f=f.return;else{l=f;do f=l,(f.flags&4098)!==0&&(h=f.return),l=f.return;while(l)}return f.tag===3?h:null}function s(l){if(l.tag===13){var f=l.memoizedState;if(f===null&&(l=l.alternate,l!==null&&(f=l.memoizedState)),f!==null)return f.dehydrated}return null}function o(l){if(a(l)!==l)throw Error(r(188))}function u(l){var f=l.alternate;if(!f){if(f=a(l),f===null)throw Error(r(188));return f!==l?null:l}for(var h=l,g=f;;){var E=h.return;if(E===null)break;var R=E.alternate;if(R===null){if(g=E.return,g!==null){h=g;continue}break}if(E.child===R.child){for(R=E.child;R;){if(R===h)return o(E),l;if(R===g)return o(E),f;R=R.sibling}throw Error(r(188))}if(h.return!==g.return)h=E,g=R;else{for(var j=!1,W=E.child;W;){if(W===h){j=!0,h=E,g=R;break}if(W===g){j=!0,g=E,h=R;break}W=W.sibling}if(!j){for(W=R.child;W;){if(W===h){j=!0,h=R,g=E;break}if(W===g){j=!0,g=R,h=E;break}W=W.sibling}if(!j)throw Error(r(189))}}if(h.alternate!==g)throw Error(r(190))}if(h.tag!==3)throw Error(r(188));return h.stateNode.current===h?l:f}function c(l){var f=l.tag;if(f===5||f===26||f===27||f===6)return l;for(l=l.child;l!==null;){if(f=c(l),f!==null)return f;l=l.sibling}return null}var d=Object.assign,p=Symbol.for("react.element"),m=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),b=Symbol.for("react.fragment"),w=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),C=Symbol.for("react.consumer"),A=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),x=Symbol.for("react.suspense"),L=Symbol.for("react.suspense_list"),U=Symbol.for("react.memo"),N=Symbol.for("react.lazy"),B=Symbol.for("react.activity"),q=Symbol.for("react.memo_cache_sentinel"),J=Symbol.iterator;function V(l){return l===null||typeof l!="object"?null:(l=J&&l[J]||l["@@iterator"],typeof l=="function"?l:null)}var de=Symbol.for("react.client.reference");function ae(l){if(l==null)return null;if(typeof l=="function")return l.$$typeof===de?null:l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case b:return"Fragment";case S:return"Profiler";case w:return"StrictMode";case x:return"Suspense";case L:return"SuspenseList";case B:return"Activity"}if(typeof l=="object")switch(l.$$typeof){case y:return"Portal";case A:return(l.displayName||"Context")+".Provider";case C:return(l._context.displayName||"Context")+".Consumer";case I:var f=l.render;return l=l.displayName,l||(l=f.displayName||f.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case U:return f=l.displayName||null,f!==null?f:ae(l.type)||"Memo";case N:f=l._payload,l=l._init;try{return ae(l(f))}catch{}}return null}var ue=Array.isArray,te=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,oe=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,ge={pending:!1,data:null,method:null,action:null},Ee=[],Y=-1;function ve(l){return{current:l}}function Re(l){0>Y||(l.current=Ee[Y],Ee[Y]=null,Y--)}function Q(l,f){Y++,Ee[Y]=l.current,l.current=f}var ie=ve(null),ce=ve(null),P=ve(null),O=ve(null);function K(l,f){switch(Q(P,f),Q(ce,l),Q(ie,null),f.nodeType){case 9:case 11:l=(l=f.documentElement)&&(l=l.namespaceURI)?yk(l):0;break;default:if(l=f.tagName,f=f.namespaceURI)f=yk(f),l=vk(f,l);else switch(l){case"svg":l=1;break;case"math":l=2;break;default:l=0}}Re(ie),Q(ie,l)}function X(){Re(ie),Re(ce),Re(P)}function se(l){l.memoizedState!==null&&Q(O,l);var f=ie.current,h=vk(f,l.type);f!==h&&(Q(ce,l),Q(ie,h))}function F(l){ce.current===l&&(Re(ie),Re(ce)),O.current===l&&(Re(O),gh._currentValue=ge)}var z=Object.prototype.hasOwnProperty,ye=n.unstable_scheduleCallback,ke=n.unstable_cancelCallback,Qe=n.unstable_shouldYield,$e=n.unstable_requestPaint,ze=n.unstable_now,xt=n.unstable_getCurrentPriorityLevel,Oe=n.unstable_ImmediatePriority,qe=n.unstable_UserBlockingPriority,It=n.unstable_NormalPriority,Ve=n.unstable_LowPriority,Be=n.unstable_IdlePriority,et=n.log,Ye=n.unstable_setDisableYieldValue,We=null,rt=null;function tt(l){if(typeof et=="function"&&Ye(l),rt&&typeof rt.setStrictMode=="function")try{rt.setStrictMode(We,l)}catch{}}var St=Math.clz32?Math.clz32:$,H=Math.log,k=Math.LN2;function $(l){return l>>>=0,l===0?32:31-(H(l)/k|0)|0}var re=256,pe=4194304;function Ce(l){var f=l&42;if(f!==0)return f;switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return l&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return l}}function Le(l,f,h){var g=l.pendingLanes;if(g===0)return 0;var E=0,R=l.suspendedLanes,j=l.pingedLanes;l=l.warmLanes;var W=g&134217727;return W!==0?(g=W&~R,g!==0?E=Ce(g):(j&=W,j!==0?E=Ce(j):h||(h=W&~l,h!==0&&(E=Ce(h))))):(W=g&~R,W!==0?E=Ce(W):j!==0?E=Ce(j):h||(h=g&~l,h!==0&&(E=Ce(h)))),E===0?0:f!==0&&f!==E&&(f&R)===0&&(R=E&-E,h=f&-f,R>=h||R===32&&(h&4194048)!==0)?f:E}function ht(l,f){return(l.pendingLanes&~(l.suspendedLanes&~l.pingedLanes)&f)===0}function sn(l,f){switch(l){case 1:case 2:case 4:case 8:case 64:return f+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function tn(){var l=re;return re<<=1,(re&4194048)===0&&(re=256),l}function un(){var l=pe;return pe<<=1,(pe&62914560)===0&&(pe=4194304),l}function Kt(l){for(var f=[],h=0;31>h;h++)f.push(l);return f}function da(l,f){l.pendingLanes|=f,f!==268435456&&(l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0)}function yi(l,f,h,g,E,R){var j=l.pendingLanes;l.pendingLanes=h,l.suspendedLanes=0,l.pingedLanes=0,l.warmLanes=0,l.expiredLanes&=h,l.entangledLanes&=h,l.errorRecoveryDisabledLanes&=h,l.shellSuspendCounter=0;var W=l.entanglements,le=l.expirationTimes,Te=l.hiddenUpdates;for(h=j&~h;0<h;){var Ue=31-St(h),Fe=1<<Ue;W[Ue]=0,le[Ue]=-1;var Pe=Te[Ue];if(Pe!==null)for(Te[Ue]=null,Ue=0;Ue<Pe.length;Ue++){var Ne=Pe[Ue];Ne!==null&&(Ne.lane&=-536870913)}h&=~Fe}g!==0&&qi(l,g,0),R!==0&&E===0&&l.tag!==0&&(l.suspendedLanes|=R&~(j&~f))}function qi(l,f,h){l.pendingLanes|=f,l.suspendedLanes&=~f;var g=31-St(f);l.entangledLanes|=f,l.entanglements[g]=l.entanglements[g]|1073741824|h&4194090}function yc(l,f){var h=l.entangledLanes|=f;for(l=l.entanglements;h;){var g=31-St(h),E=1<<g;E&f|l[g]&f&&(l[g]|=f),h&=~E}}function ri(l){switch(l){case 2:l=1;break;case 8:l=4;break;case 32:l=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:l=128;break;case 268435456:l=134217728;break;default:l=0}return l}function Wl(l){return l&=-l,2<l?8<l?(l&134217727)!==0?32:268435456:8:2}function G(){var l=oe.p;return l!==0?l:(l=window.event,l===void 0?32:Lk(l.type))}function M(l,f){var h=oe.p;try{return oe.p=l,f()}finally{oe.p=h}}var D=Math.random().toString(36).slice(2),ne="__reactFiber$"+D,he="__reactProps$"+D,Ie="__reactContainer$"+D,Z="__reactEvents$"+D,ee="__reactListeners$"+D,fe="__reactHandles$"+D,we="__reactResources$"+D,be="__reactMarker$"+D;function Ze(l){delete l[ne],delete l[he],delete l[Z],delete l[ee],delete l[fe]}function ut(l){var f=l[ne];if(f)return f;for(var h=l.parentNode;h;){if(f=h[Ie]||h[ne]){if(h=f.alternate,f.child!==null||h!==null&&h.child!==null)for(l=Ek(l);l!==null;){if(h=l[ne])return h;l=Ek(l)}return f}l=h,h=l.parentNode}return null}function Mt(l){if(l=l[ne]||l[Ie]){var f=l.tag;if(f===5||f===6||f===13||f===26||f===27||f===3)return l}return null}function nn(l){var f=l.tag;if(f===5||f===26||f===27||f===6)return l.stateNode;throw Error(r(33))}function mn(l){var f=l[we];return f||(f=l[we]={hoistableStyles:new Map,hoistableScripts:new Map}),f}function pt(l){l[be]=!0}var cn=new Set,Pn={};function gt(l,f){rn(l,f),rn(l+"Capture",f)}function rn(l,f){for(Pn[l]=f,l=0;l<f.length;l++)cn.add(f[l])}var Fn=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),wn={},Ba={};function ha(l){return z.call(Ba,l)?!0:z.call(wn,l)?!1:Fn.test(l)?Ba[l]=!0:(wn[l]=!0,!1)}function ii(l,f,h){if(ha(f))if(h===null)l.removeAttribute(f);else{switch(typeof h){case"undefined":case"function":case"symbol":l.removeAttribute(f);return;case"boolean":var g=f.toLowerCase().slice(0,5);if(g!=="data-"&&g!=="aria-"){l.removeAttribute(f);return}}l.setAttribute(f,""+h)}}function qa(l,f,h){if(h===null)l.removeAttribute(f);else{switch(typeof h){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(f);return}l.setAttribute(f,""+h)}}function xr(l,f,h,g){if(g===null)l.removeAttribute(h);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":l.removeAttribute(h);return}l.setAttributeNS(f,h,""+g)}}var Gr,Vi;function vi(l){if(Gr===void 0)try{throw Error()}catch(h){var f=h.stack.trim().match(/\n( *(at )?)/);Gr=f&&f[1]||"",Vi=-1<h.stack.indexOf(`
    at`)?" (<anonymous>)":-1<h.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Gr+l+Vi}var zi=!1;function Xs(l,f){if(!l||zi)return"";zi=!0;var h=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var g={DetermineComponentFrameRoot:function(){try{if(f){var Fe=function(){throw Error()};if(Object.defineProperty(Fe.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Fe,[])}catch(Ne){var Pe=Ne}Reflect.construct(l,[],Fe)}else{try{Fe.call()}catch(Ne){Pe=Ne}l.call(Fe.prototype)}}else{try{throw Error()}catch(Ne){Pe=Ne}(Fe=l())&&typeof Fe.catch=="function"&&Fe.catch(function(){})}}catch(Ne){if(Ne&&Pe&&typeof Ne.stack=="string")return[Ne.stack,Pe.stack]}return[null,null]}};g.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var E=Object.getOwnPropertyDescriptor(g.DetermineComponentFrameRoot,"name");E&&E.configurable&&Object.defineProperty(g.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var R=g.DetermineComponentFrameRoot(),j=R[0],W=R[1];if(j&&W){var le=j.split(`
`),Te=W.split(`
`);for(E=g=0;g<le.length&&!le[g].includes("DetermineComponentFrameRoot");)g++;for(;E<Te.length&&!Te[E].includes("DetermineComponentFrameRoot");)E++;if(g===le.length||E===Te.length)for(g=le.length-1,E=Te.length-1;1<=g&&0<=E&&le[g]!==Te[E];)E--;for(;1<=g&&0<=E;g--,E--)if(le[g]!==Te[E]){if(g!==1||E!==1)do if(g--,E--,0>E||le[g]!==Te[E]){var Ue=`
`+le[g].replace(" at new "," at ");return l.displayName&&Ue.includes("<anonymous>")&&(Ue=Ue.replace("<anonymous>",l.displayName)),Ue}while(1<=g&&0<=E);break}}}finally{zi=!1,Error.prepareStackTrace=h}return(h=l?l.displayName||l.name:"")?vi(h):""}function Fm(l){switch(l.tag){case 26:case 27:case 5:return vi(l.type);case 16:return vi("Lazy");case 13:return vi("Suspense");case 19:return vi("SuspenseList");case 0:case 15:return Xs(l.type,!1);case 11:return Xs(l.type.render,!1);case 1:return Xs(l.type,!0);case 31:return vi("Activity");default:return""}}function Rd(l){try{var f="";do f+=Fm(l),l=l.return;while(l);return f}catch(h){return`
Error generating stack: `+h.message+`
`+h.stack}}function Or(l){switch(typeof l){case"bigint":case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function Kl(l){var f=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(f==="checkbox"||f==="radio")}function vc(l){var f=Kl(l)?"checked":"value",h=Object.getOwnPropertyDescriptor(l.constructor.prototype,f),g=""+l[f];if(!l.hasOwnProperty(f)&&typeof h<"u"&&typeof h.get=="function"&&typeof h.set=="function"){var E=h.get,R=h.set;return Object.defineProperty(l,f,{configurable:!0,get:function(){return E.call(this)},set:function(j){g=""+j,R.call(this,j)}}),Object.defineProperty(l,f,{enumerable:h.enumerable}),{getValue:function(){return g},setValue:function(j){g=""+j},stopTracking:function(){l._valueTracker=null,delete l[f]}}}}function Jl(l){l._valueTracker||(l._valueTracker=vc(l))}function Id(l){if(!l)return!1;var f=l._valueTracker;if(!f)return!0;var h=f.getValue(),g="";return l&&(g=Kl(l)?l.checked?"true":"false":l.value),l=g,l!==h?(f.setValue(l),!0):!1}function _s(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}var q8=/[\n"\\]/g;function pa(l){return l.replace(q8,function(f){return"\\"+f.charCodeAt(0).toString(16)+" "})}function Vb(l,f,h,g,E,R,j,W){l.name="",j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"?l.type=j:l.removeAttribute("type"),f!=null?j==="number"?(f===0&&l.value===""||l.value!=f)&&(l.value=""+Or(f)):l.value!==""+Or(f)&&(l.value=""+Or(f)):j!=="submit"&&j!=="reset"||l.removeAttribute("value"),f!=null?zb(l,j,Or(f)):h!=null?zb(l,j,Or(h)):g!=null&&l.removeAttribute("value"),E==null&&R!=null&&(l.defaultChecked=!!R),E!=null&&(l.checked=E&&typeof E!="function"&&typeof E!="symbol"),W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"?l.name=""+Or(W):l.removeAttribute("name")}function px(l,f,h,g,E,R,j,W){if(R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(l.type=R),f!=null||h!=null){if(!(R!=="submit"&&R!=="reset"||f!=null))return;h=h!=null?""+Or(h):"",f=f!=null?""+Or(f):h,W||f===l.value||(l.value=f),l.defaultValue=f}g=g??E,g=typeof g!="function"&&typeof g!="symbol"&&!!g,l.checked=W?l.checked:!!g,l.defaultChecked=!!g,j!=null&&typeof j!="function"&&typeof j!="symbol"&&typeof j!="boolean"&&(l.name=j)}function zb(l,f,h){f==="number"&&_s(l.ownerDocument)===l||l.defaultValue===""+h||(l.defaultValue=""+h)}function _c(l,f,h,g){if(l=l.options,f){f={};for(var E=0;E<h.length;E++)f["$"+h[E]]=!0;for(h=0;h<l.length;h++)E=f.hasOwnProperty("$"+l[h].value),l[h].selected!==E&&(l[h].selected=E),E&&g&&(l[h].defaultSelected=!0)}else{for(h=""+Or(h),f=null,E=0;E<l.length;E++){if(l[E].value===h){l[E].selected=!0,g&&(l[E].defaultSelected=!0);return}f!==null||l[E].disabled||(f=l[E])}f!==null&&(f.selected=!0)}}function mx(l,f,h){if(f!=null&&(f=""+Or(f),f!==l.value&&(l.value=f),h==null)){l.defaultValue!==f&&(l.defaultValue=f);return}l.defaultValue=h!=null?""+Or(h):""}function gx(l,f,h,g){if(f==null){if(g!=null){if(h!=null)throw Error(r(92));if(ue(g)){if(1<g.length)throw Error(r(93));g=g[0]}h=g}h==null&&(h=""),f=h}h=Or(f),l.defaultValue=h,g=l.textContent,g===h&&g!==""&&g!==null&&(l.value=g)}function bc(l,f){if(f){var h=l.firstChild;if(h&&h===l.lastChild&&h.nodeType===3){h.nodeValue=f;return}}l.textContent=f}var V8=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function yx(l,f,h){var g=f.indexOf("--")===0;h==null||typeof h=="boolean"||h===""?g?l.setProperty(f,""):f==="float"?l.cssFloat="":l[f]="":g?l.setProperty(f,h):typeof h!="number"||h===0||V8.has(f)?f==="float"?l.cssFloat=h:l[f]=(""+h).trim():l[f]=h+"px"}function vx(l,f,h){if(f!=null&&typeof f!="object")throw Error(r(62));if(l=l.style,h!=null){for(var g in h)!h.hasOwnProperty(g)||f!=null&&f.hasOwnProperty(g)||(g.indexOf("--")===0?l.setProperty(g,""):g==="float"?l.cssFloat="":l[g]="");for(var E in f)g=f[E],f.hasOwnProperty(E)&&h[E]!==g&&yx(l,E,g)}else for(var R in f)f.hasOwnProperty(R)&&yx(l,R,f[R])}function Hb(l){if(l.indexOf("-")===-1)return!1;switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var z8=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),H8=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Bm(l){return H8.test(""+l)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":l}var Gb=null;function Wb(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var wc=null,Ec=null;function _x(l){var f=Mt(l);if(f&&(l=f.stateNode)){var h=l[he]||null;e:switch(l=f.stateNode,f.type){case"input":if(Vb(l,h.value,h.defaultValue,h.defaultValue,h.checked,h.defaultChecked,h.type,h.name),f=h.name,h.type==="radio"&&f!=null){for(h=l;h.parentNode;)h=h.parentNode;for(h=h.querySelectorAll('input[name="'+pa(""+f)+'"][type="radio"]'),f=0;f<h.length;f++){var g=h[f];if(g!==l&&g.form===l.form){var E=g[he]||null;if(!E)throw Error(r(90));Vb(g,E.value,E.defaultValue,E.defaultValue,E.checked,E.defaultChecked,E.type,E.name)}}for(f=0;f<h.length;f++)g=h[f],g.form===l.form&&Id(g)}break e;case"textarea":mx(l,h.value,h.defaultValue);break e;case"select":f=h.value,f!=null&&_c(l,!!h.multiple,f,!1)}}}var Kb=!1;function bx(l,f,h){if(Kb)return l(f,h);Kb=!0;try{var g=l(f);return g}finally{if(Kb=!1,(wc!==null||Ec!==null)&&(Cg(),wc&&(f=wc,l=Ec,Ec=wc=null,_x(f),l)))for(f=0;f<l.length;f++)_x(l[f])}}function Pd(l,f){var h=l.stateNode;if(h===null)return null;var g=h[he]||null;if(g===null)return null;h=g[f];e:switch(f){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(l=l.type,g=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!g;break e;default:l=!1}if(l)return null;if(h&&typeof h!="function")throw Error(r(231,f,typeof h));return h}var Qs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Jb=!1;if(Qs)try{var xd={};Object.defineProperty(xd,"passive",{get:function(){Jb=!0}}),window.addEventListener("test",xd,xd),window.removeEventListener("test",xd,xd)}catch{Jb=!1}var Ho=null,Yb=null,qm=null;function wx(){if(qm)return qm;var l,f=Yb,h=f.length,g,E="value"in Ho?Ho.value:Ho.textContent,R=E.length;for(l=0;l<h&&f[l]===E[l];l++);var j=h-l;for(g=1;g<=j&&f[h-g]===E[R-g];g++);return qm=E.slice(l,1<g?1-g:void 0)}function Vm(l){var f=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&f===13&&(l=13)):l=f,l===10&&(l=13),32<=l||l===13?l:0}function zm(){return!0}function Ex(){return!1}function _i(l){function f(h,g,E,R,j){this._reactName=h,this._targetInst=E,this.type=g,this.nativeEvent=R,this.target=j,this.currentTarget=null;for(var W in l)l.hasOwnProperty(W)&&(h=l[W],this[W]=h?h(R):R[W]);return this.isDefaultPrevented=(R.defaultPrevented!=null?R.defaultPrevented:R.returnValue===!1)?zm:Ex,this.isPropagationStopped=Ex,this}return d(f.prototype,{preventDefault:function(){this.defaultPrevented=!0;var h=this.nativeEvent;h&&(h.preventDefault?h.preventDefault():typeof h.returnValue!="unknown"&&(h.returnValue=!1),this.isDefaultPrevented=zm)},stopPropagation:function(){var h=this.nativeEvent;h&&(h.stopPropagation?h.stopPropagation():typeof h.cancelBubble!="unknown"&&(h.cancelBubble=!0),this.isPropagationStopped=zm)},persist:function(){},isPersistent:zm}),f}var Yl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Hm=_i(Yl),Od=d({},Yl,{view:0,detail:0}),G8=_i(Od),Zb,Xb,Nd,Gm=d({},Od,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:e0,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==Nd&&(Nd&&l.type==="mousemove"?(Zb=l.screenX-Nd.screenX,Xb=l.screenY-Nd.screenY):Xb=Zb=0,Nd=l),Zb)},movementY:function(l){return"movementY"in l?l.movementY:Xb}}),Sx=_i(Gm),W8=d({},Gm,{dataTransfer:0}),K8=_i(W8),J8=d({},Od,{relatedTarget:0}),Qb=_i(J8),Y8=d({},Yl,{animationName:0,elapsedTime:0,pseudoElement:0}),Z8=_i(Y8),X8=d({},Yl,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),Q8=_i(X8),eV=d({},Yl,{data:0}),Tx=_i(eV),tV={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},nV={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},rV={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function iV(l){var f=this.nativeEvent;return f.getModifierState?f.getModifierState(l):(l=rV[l])?!!f[l]:!1}function e0(){return iV}var aV=d({},Od,{key:function(l){if(l.key){var f=tV[l.key]||l.key;if(f!=="Unidentified")return f}return l.type==="keypress"?(l=Vm(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?nV[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:e0,charCode:function(l){return l.type==="keypress"?Vm(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?Vm(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),sV=_i(aV),oV=d({},Gm,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ax=_i(oV),lV=d({},Od,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:e0}),uV=_i(lV),cV=d({},Yl,{propertyName:0,elapsedTime:0,pseudoElement:0}),fV=_i(cV),dV=d({},Gm,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),hV=_i(dV),pV=d({},Yl,{newState:0,oldState:0}),mV=_i(pV),gV=[9,13,27,32],t0=Qs&&"CompositionEvent"in window,kd=null;Qs&&"documentMode"in document&&(kd=document.documentMode);var yV=Qs&&"TextEvent"in window&&!kd,Cx=Qs&&(!t0||kd&&8<kd&&11>=kd),Rx=" ",Ix=!1;function Px(l,f){switch(l){case"keyup":return gV.indexOf(f.keyCode)!==-1;case"keydown":return f.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xx(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var Sc=!1;function vV(l,f){switch(l){case"compositionend":return xx(f);case"keypress":return f.which!==32?null:(Ix=!0,Rx);case"textInput":return l=f.data,l===Rx&&Ix?null:l;default:return null}}function _V(l,f){if(Sc)return l==="compositionend"||!t0&&Px(l,f)?(l=wx(),qm=Yb=Ho=null,Sc=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(f.ctrlKey||f.altKey||f.metaKey)||f.ctrlKey&&f.altKey){if(f.char&&1<f.char.length)return f.char;if(f.which)return String.fromCharCode(f.which)}return null;case"compositionend":return Cx&&f.locale!=="ko"?null:f.data;default:return null}}var bV={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ox(l){var f=l&&l.nodeName&&l.nodeName.toLowerCase();return f==="input"?!!bV[l.type]:f==="textarea"}function Nx(l,f,h,g){wc?Ec?Ec.push(g):Ec=[g]:wc=g,f=Ng(f,"onChange"),0<f.length&&(h=new Hm("onChange","change",null,h,g),l.push({event:h,listeners:f}))}var Md=null,Dd=null;function wV(l){dk(l,0)}function Wm(l){var f=nn(l);if(Id(f))return l}function kx(l,f){if(l==="change")return f}var Mx=!1;if(Qs){var n0;if(Qs){var r0="oninput"in document;if(!r0){var Dx=document.createElement("div");Dx.setAttribute("oninput","return;"),r0=typeof Dx.oninput=="function"}n0=r0}else n0=!1;Mx=n0&&(!document.documentMode||9<document.documentMode)}function $x(){Md&&(Md.detachEvent("onpropertychange",Lx),Dd=Md=null)}function Lx(l){if(l.propertyName==="value"&&Wm(Dd)){var f=[];Nx(f,Dd,l,Wb(l)),bx(wV,f)}}function EV(l,f,h){l==="focusin"?($x(),Md=f,Dd=h,Md.attachEvent("onpropertychange",Lx)):l==="focusout"&&$x()}function SV(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return Wm(Dd)}function TV(l,f){if(l==="click")return Wm(f)}function AV(l,f){if(l==="input"||l==="change")return Wm(f)}function CV(l,f){return l===f&&(l!==0||1/l===1/f)||l!==l&&f!==f}var Hi=typeof Object.is=="function"?Object.is:CV;function $d(l,f){if(Hi(l,f))return!0;if(typeof l!="object"||l===null||typeof f!="object"||f===null)return!1;var h=Object.keys(l),g=Object.keys(f);if(h.length!==g.length)return!1;for(g=0;g<h.length;g++){var E=h[g];if(!z.call(f,E)||!Hi(l[E],f[E]))return!1}return!0}function Ux(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function jx(l,f){var h=Ux(l);l=0;for(var g;h;){if(h.nodeType===3){if(g=l+h.textContent.length,l<=f&&g>=f)return{node:h,offset:f-l};l=g}e:{for(;h;){if(h.nextSibling){h=h.nextSibling;break e}h=h.parentNode}h=void 0}h=Ux(h)}}function Fx(l,f){return l&&f?l===f?!0:l&&l.nodeType===3?!1:f&&f.nodeType===3?Fx(l,f.parentNode):"contains"in l?l.contains(f):l.compareDocumentPosition?!!(l.compareDocumentPosition(f)&16):!1:!1}function Bx(l){l=l!=null&&l.ownerDocument!=null&&l.ownerDocument.defaultView!=null?l.ownerDocument.defaultView:window;for(var f=_s(l.document);f instanceof l.HTMLIFrameElement;){try{var h=typeof f.contentWindow.location.href=="string"}catch{h=!1}if(h)l=f.contentWindow;else break;f=_s(l.document)}return f}function i0(l){var f=l&&l.nodeName&&l.nodeName.toLowerCase();return f&&(f==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||f==="textarea"||l.contentEditable==="true")}var RV=Qs&&"documentMode"in document&&11>=document.documentMode,Tc=null,a0=null,Ld=null,s0=!1;function qx(l,f,h){var g=h.window===h?h.document:h.nodeType===9?h:h.ownerDocument;s0||Tc==null||Tc!==_s(g)||(g=Tc,"selectionStart"in g&&i0(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),Ld&&$d(Ld,g)||(Ld=g,g=Ng(a0,"onSelect"),0<g.length&&(f=new Hm("onSelect","select",null,f,h),l.push({event:f,listeners:g}),f.target=Tc)))}function Zl(l,f){var h={};return h[l.toLowerCase()]=f.toLowerCase(),h["Webkit"+l]="webkit"+f,h["Moz"+l]="moz"+f,h}var Ac={animationend:Zl("Animation","AnimationEnd"),animationiteration:Zl("Animation","AnimationIteration"),animationstart:Zl("Animation","AnimationStart"),transitionrun:Zl("Transition","TransitionRun"),transitionstart:Zl("Transition","TransitionStart"),transitioncancel:Zl("Transition","TransitionCancel"),transitionend:Zl("Transition","TransitionEnd")},o0={},Vx={};Qs&&(Vx=document.createElement("div").style,"AnimationEvent"in window||(delete Ac.animationend.animation,delete Ac.animationiteration.animation,delete Ac.animationstart.animation),"TransitionEvent"in window||delete Ac.transitionend.transition);function Xl(l){if(o0[l])return o0[l];if(!Ac[l])return l;var f=Ac[l],h;for(h in f)if(f.hasOwnProperty(h)&&h in Vx)return o0[l]=f[h];return l}var zx=Xl("animationend"),Hx=Xl("animationiteration"),Gx=Xl("animationstart"),IV=Xl("transitionrun"),PV=Xl("transitionstart"),xV=Xl("transitioncancel"),Wx=Xl("transitionend"),Kx=new Map,l0="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");l0.push("scrollEnd");function Va(l,f){Kx.set(l,f),gt(f,[l])}var Jx=new WeakMap;function ma(l,f){if(typeof l=="object"&&l!==null){var h=Jx.get(l);return h!==void 0?h:(f={value:l,source:f,stack:Rd(f)},Jx.set(l,f),f)}return{value:l,source:f,stack:Rd(f)}}var ga=[],Cc=0,u0=0;function Km(){for(var l=Cc,f=u0=Cc=0;f<l;){var h=ga[f];ga[f++]=null;var g=ga[f];ga[f++]=null;var E=ga[f];ga[f++]=null;var R=ga[f];if(ga[f++]=null,g!==null&&E!==null){var j=g.pending;j===null?E.next=E:(E.next=j.next,j.next=E),g.pending=E}R!==0&&Yx(h,E,R)}}function Jm(l,f,h,g){ga[Cc++]=l,ga[Cc++]=f,ga[Cc++]=h,ga[Cc++]=g,u0|=g,l.lanes|=g,l=l.alternate,l!==null&&(l.lanes|=g)}function c0(l,f,h,g){return Jm(l,f,h,g),Ym(l)}function Rc(l,f){return Jm(l,null,null,f),Ym(l)}function Yx(l,f,h){l.lanes|=h;var g=l.alternate;g!==null&&(g.lanes|=h);for(var E=!1,R=l.return;R!==null;)R.childLanes|=h,g=R.alternate,g!==null&&(g.childLanes|=h),R.tag===22&&(l=R.stateNode,l===null||l._visibility&1||(E=!0)),l=R,R=R.return;return l.tag===3?(R=l.stateNode,E&&f!==null&&(E=31-St(h),l=R.hiddenUpdates,g=l[E],g===null?l[E]=[f]:g.push(f),f.lane=h|536870912),R):null}function Ym(l){if(50<lh)throw lh=0,gw=null,Error(r(185));for(var f=l.return;f!==null;)l=f,f=l.return;return l.tag===3?l.stateNode:null}var Ic={};function OV(l,f,h,g){this.tag=l,this.key=h,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=f,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Gi(l,f,h,g){return new OV(l,f,h,g)}function f0(l){return l=l.prototype,!(!l||!l.isReactComponent)}function eo(l,f){var h=l.alternate;return h===null?(h=Gi(l.tag,f,l.key,l.mode),h.elementType=l.elementType,h.type=l.type,h.stateNode=l.stateNode,h.alternate=l,l.alternate=h):(h.pendingProps=f,h.type=l.type,h.flags=0,h.subtreeFlags=0,h.deletions=null),h.flags=l.flags&65011712,h.childLanes=l.childLanes,h.lanes=l.lanes,h.child=l.child,h.memoizedProps=l.memoizedProps,h.memoizedState=l.memoizedState,h.updateQueue=l.updateQueue,f=l.dependencies,h.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext},h.sibling=l.sibling,h.index=l.index,h.ref=l.ref,h.refCleanup=l.refCleanup,h}function Zx(l,f){l.flags&=65011714;var h=l.alternate;return h===null?(l.childLanes=0,l.lanes=f,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=h.childLanes,l.lanes=h.lanes,l.child=h.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=h.memoizedProps,l.memoizedState=h.memoizedState,l.updateQueue=h.updateQueue,l.type=h.type,f=h.dependencies,l.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),l}function Zm(l,f,h,g,E,R){var j=0;if(g=l,typeof l=="function")f0(l)&&(j=1);else if(typeof l=="string")j=kz(l,h,ie.current)?26:l==="html"||l==="head"||l==="body"?27:5;else e:switch(l){case B:return l=Gi(31,h,f,E),l.elementType=B,l.lanes=R,l;case b:return Ql(h.children,E,R,f);case w:j=8,E|=24;break;case S:return l=Gi(12,h,f,E|2),l.elementType=S,l.lanes=R,l;case x:return l=Gi(13,h,f,E),l.elementType=x,l.lanes=R,l;case L:return l=Gi(19,h,f,E),l.elementType=L,l.lanes=R,l;default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case T:case A:j=10;break e;case C:j=9;break e;case I:j=11;break e;case U:j=14;break e;case N:j=16,g=null;break e}j=29,h=Error(r(130,l===null?"null":typeof l,"")),g=null}return f=Gi(j,h,f,E),f.elementType=l,f.type=g,f.lanes=R,f}function Ql(l,f,h,g){return l=Gi(7,l,g,f),l.lanes=h,l}function d0(l,f,h){return l=Gi(6,l,null,f),l.lanes=h,l}function h0(l,f,h){return f=Gi(4,l.children!==null?l.children:[],l.key,f),f.lanes=h,f.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},f}var Pc=[],xc=0,Xm=null,Qm=0,ya=[],va=0,eu=null,to=1,no="";function tu(l,f){Pc[xc++]=Qm,Pc[xc++]=Xm,Xm=l,Qm=f}function Xx(l,f,h){ya[va++]=to,ya[va++]=no,ya[va++]=eu,eu=l;var g=to;l=no;var E=32-St(g)-1;g&=~(1<<E),h+=1;var R=32-St(f)+E;if(30<R){var j=E-E%5;R=(g&(1<<j)-1).toString(32),g>>=j,E-=j,to=1<<32-St(f)+E|h<<E|g,no=R+l}else to=1<<R|h<<E|g,no=l}function p0(l){l.return!==null&&(tu(l,1),Xx(l,1,0))}function m0(l){for(;l===Xm;)Xm=Pc[--xc],Pc[xc]=null,Qm=Pc[--xc],Pc[xc]=null;for(;l===eu;)eu=ya[--va],ya[va]=null,no=ya[--va],ya[va]=null,to=ya[--va],ya[va]=null}var ai=null,Bn=null,an=!1,nu=null,bs=!1,g0=Error(r(519));function ru(l){var f=Error(r(418,""));throw Fd(ma(f,l)),g0}function Qx(l){var f=l.stateNode,h=l.type,g=l.memoizedProps;switch(f[ne]=l,f[he]=g,h){case"dialog":zt("cancel",f),zt("close",f);break;case"iframe":case"object":case"embed":zt("load",f);break;case"video":case"audio":for(h=0;h<ch.length;h++)zt(ch[h],f);break;case"source":zt("error",f);break;case"img":case"image":case"link":zt("error",f),zt("load",f);break;case"details":zt("toggle",f);break;case"input":zt("invalid",f),px(f,g.value,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name,!0),Jl(f);break;case"select":zt("invalid",f);break;case"textarea":zt("invalid",f),gx(f,g.value,g.defaultValue,g.children),Jl(f)}h=g.children,typeof h!="string"&&typeof h!="number"&&typeof h!="bigint"||f.textContent===""+h||g.suppressHydrationWarning===!0||gk(f.textContent,h)?(g.popover!=null&&(zt("beforetoggle",f),zt("toggle",f)),g.onScroll!=null&&zt("scroll",f),g.onScrollEnd!=null&&zt("scrollend",f),g.onClick!=null&&(f.onclick=kg),f=!0):f=!1,f||ru(l)}function eO(l){for(ai=l.return;ai;)switch(ai.tag){case 5:case 13:bs=!1;return;case 27:case 3:bs=!0;return;default:ai=ai.return}}function Ud(l){if(l!==ai)return!1;if(!an)return eO(l),an=!0,!1;var f=l.tag,h;if((h=f!==3&&f!==27)&&((h=f===5)&&(h=l.type,h=!(h!=="form"&&h!=="button")||Nw(l.type,l.memoizedProps)),h=!h),h&&Bn&&ru(l),eO(l),f===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(r(317));e:{for(l=l.nextSibling,f=0;l;){if(l.nodeType===8)if(h=l.data,h==="/$"){if(f===0){Bn=Ha(l.nextSibling);break e}f--}else h!=="$"&&h!=="$!"&&h!=="$?"||f++;l=l.nextSibling}Bn=null}}else f===27?(f=Bn,ol(l.type)?(l=$w,$w=null,Bn=l):Bn=f):Bn=ai?Ha(l.stateNode.nextSibling):null;return!0}function jd(){Bn=ai=null,an=!1}function tO(){var l=nu;return l!==null&&(Ei===null?Ei=l:Ei.push.apply(Ei,l),nu=null),l}function Fd(l){nu===null?nu=[l]:nu.push(l)}var y0=ve(null),iu=null,ro=null;function Go(l,f,h){Q(y0,f._currentValue),f._currentValue=h}function io(l){l._currentValue=y0.current,Re(y0)}function v0(l,f,h){for(;l!==null;){var g=l.alternate;if((l.childLanes&f)!==f?(l.childLanes|=f,g!==null&&(g.childLanes|=f)):g!==null&&(g.childLanes&f)!==f&&(g.childLanes|=f),l===h)break;l=l.return}}function _0(l,f,h,g){var E=l.child;for(E!==null&&(E.return=l);E!==null;){var R=E.dependencies;if(R!==null){var j=E.child;R=R.firstContext;e:for(;R!==null;){var W=R;R=E;for(var le=0;le<f.length;le++)if(W.context===f[le]){R.lanes|=h,W=R.alternate,W!==null&&(W.lanes|=h),v0(R.return,h,l),g||(j=null);break e}R=W.next}}else if(E.tag===18){if(j=E.return,j===null)throw Error(r(341));j.lanes|=h,R=j.alternate,R!==null&&(R.lanes|=h),v0(j,h,l),j=null}else j=E.child;if(j!==null)j.return=E;else for(j=E;j!==null;){if(j===l){j=null;break}if(E=j.sibling,E!==null){E.return=j.return,j=E;break}j=j.return}E=j}}function Bd(l,f,h,g){l=null;for(var E=f,R=!1;E!==null;){if(!R){if((E.flags&524288)!==0)R=!0;else if((E.flags&262144)!==0)break}if(E.tag===10){var j=E.alternate;if(j===null)throw Error(r(387));if(j=j.memoizedProps,j!==null){var W=E.type;Hi(E.pendingProps.value,j.value)||(l!==null?l.push(W):l=[W])}}else if(E===O.current){if(j=E.alternate,j===null)throw Error(r(387));j.memoizedState.memoizedState!==E.memoizedState.memoizedState&&(l!==null?l.push(gh):l=[gh])}E=E.return}l!==null&&_0(f,l,h,g),f.flags|=262144}function eg(l){for(l=l.firstContext;l!==null;){if(!Hi(l.context._currentValue,l.memoizedValue))return!0;l=l.next}return!1}function au(l){iu=l,ro=null,l=l.dependencies,l!==null&&(l.firstContext=null)}function Wr(l){return nO(iu,l)}function tg(l,f){return iu===null&&au(l),nO(l,f)}function nO(l,f){var h=f._currentValue;if(f={context:f,memoizedValue:h,next:null},ro===null){if(l===null)throw Error(r(308));ro=f,l.dependencies={lanes:0,firstContext:f},l.flags|=524288}else ro=ro.next=f;return h}var NV=typeof AbortController<"u"?AbortController:function(){var l=[],f=this.signal={aborted:!1,addEventListener:function(h,g){l.push(g)}};this.abort=function(){f.aborted=!0,l.forEach(function(h){return h()})}},kV=n.unstable_scheduleCallback,MV=n.unstable_NormalPriority,lr={$$typeof:A,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function b0(){return{controller:new NV,data:new Map,refCount:0}}function qd(l){l.refCount--,l.refCount===0&&kV(MV,function(){l.controller.abort()})}var Vd=null,w0=0,Oc=0,Nc=null;function DV(l,f){if(Vd===null){var h=Vd=[];w0=0,Oc=Sw(),Nc={status:"pending",value:void 0,then:function(g){h.push(g)}}}return w0++,f.then(rO,rO),f}function rO(){if(--w0===0&&Vd!==null){Nc!==null&&(Nc.status="fulfilled");var l=Vd;Vd=null,Oc=0,Nc=null;for(var f=0;f<l.length;f++)(0,l[f])()}}function $V(l,f){var h=[],g={status:"pending",value:null,reason:null,then:function(E){h.push(E)}};return l.then(function(){g.status="fulfilled",g.value=f;for(var E=0;E<h.length;E++)(0,h[E])(f)},function(E){for(g.status="rejected",g.reason=E,E=0;E<h.length;E++)(0,h[E])(void 0)}),g}var iO=te.S;te.S=function(l,f){typeof f=="object"&&f!==null&&typeof f.then=="function"&&DV(l,f),iO!==null&&iO(l,f)};var su=ve(null);function E0(){var l=su.current;return l!==null?l:Cn.pooledCache}function ng(l,f){f===null?Q(su,su.current):Q(su,f.pool)}function aO(){var l=E0();return l===null?null:{parent:lr._currentValue,pool:l}}var zd=Error(r(460)),sO=Error(r(474)),rg=Error(r(542)),S0={then:function(){}};function oO(l){return l=l.status,l==="fulfilled"||l==="rejected"}function ig(){}function lO(l,f,h){switch(h=l[h],h===void 0?l.push(f):h!==f&&(f.then(ig,ig),f=h),f.status){case"fulfilled":return f.value;case"rejected":throw l=f.reason,cO(l),l;default:if(typeof f.status=="string")f.then(ig,ig);else{if(l=Cn,l!==null&&100<l.shellSuspendCounter)throw Error(r(482));l=f,l.status="pending",l.then(function(g){if(f.status==="pending"){var E=f;E.status="fulfilled",E.value=g}},function(g){if(f.status==="pending"){var E=f;E.status="rejected",E.reason=g}})}switch(f.status){case"fulfilled":return f.value;case"rejected":throw l=f.reason,cO(l),l}throw Hd=f,zd}}var Hd=null;function uO(){if(Hd===null)throw Error(r(459));var l=Hd;return Hd=null,l}function cO(l){if(l===zd||l===rg)throw Error(r(483))}var Wo=!1;function T0(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function A0(l,f){l=l.updateQueue,f.updateQueue===l&&(f.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,callbacks:null})}function Ko(l){return{lane:l,tag:0,payload:null,callback:null,next:null}}function Jo(l,f,h){var g=l.updateQueue;if(g===null)return null;if(g=g.shared,(fn&2)!==0){var E=g.pending;return E===null?f.next=f:(f.next=E.next,E.next=f),g.pending=f,f=Ym(l),Yx(l,null,h),f}return Jm(l,g,f,h),Ym(l)}function Gd(l,f,h){if(f=f.updateQueue,f!==null&&(f=f.shared,(h&4194048)!==0)){var g=f.lanes;g&=l.pendingLanes,h|=g,f.lanes=h,yc(l,h)}}function C0(l,f){var h=l.updateQueue,g=l.alternate;if(g!==null&&(g=g.updateQueue,h===g)){var E=null,R=null;if(h=h.firstBaseUpdate,h!==null){do{var j={lane:h.lane,tag:h.tag,payload:h.payload,callback:null,next:null};R===null?E=R=j:R=R.next=j,h=h.next}while(h!==null);R===null?E=R=f:R=R.next=f}else E=R=f;h={baseState:g.baseState,firstBaseUpdate:E,lastBaseUpdate:R,shared:g.shared,callbacks:g.callbacks},l.updateQueue=h;return}l=h.lastBaseUpdate,l===null?h.firstBaseUpdate=f:l.next=f,h.lastBaseUpdate=f}var R0=!1;function Wd(){if(R0){var l=Nc;if(l!==null)throw l}}function Kd(l,f,h,g){R0=!1;var E=l.updateQueue;Wo=!1;var R=E.firstBaseUpdate,j=E.lastBaseUpdate,W=E.shared.pending;if(W!==null){E.shared.pending=null;var le=W,Te=le.next;le.next=null,j===null?R=Te:j.next=Te,j=le;var Ue=l.alternate;Ue!==null&&(Ue=Ue.updateQueue,W=Ue.lastBaseUpdate,W!==j&&(W===null?Ue.firstBaseUpdate=Te:W.next=Te,Ue.lastBaseUpdate=le))}if(R!==null){var Fe=E.baseState;j=0,Ue=Te=le=null,W=R;do{var Pe=W.lane&-536870913,Ne=Pe!==W.lane;if(Ne?(Yt&Pe)===Pe:(g&Pe)===Pe){Pe!==0&&Pe===Oc&&(R0=!0),Ue!==null&&(Ue=Ue.next={lane:0,tag:W.tag,payload:W.payload,callback:null,next:null});e:{var bt=l,yt=W;Pe=f;var vn=h;switch(yt.tag){case 1:if(bt=yt.payload,typeof bt=="function"){Fe=bt.call(vn,Fe,Pe);break e}Fe=bt;break e;case 3:bt.flags=bt.flags&-65537|128;case 0:if(bt=yt.payload,Pe=typeof bt=="function"?bt.call(vn,Fe,Pe):bt,Pe==null)break e;Fe=d({},Fe,Pe);break e;case 2:Wo=!0}}Pe=W.callback,Pe!==null&&(l.flags|=64,Ne&&(l.flags|=8192),Ne=E.callbacks,Ne===null?E.callbacks=[Pe]:Ne.push(Pe))}else Ne={lane:Pe,tag:W.tag,payload:W.payload,callback:W.callback,next:null},Ue===null?(Te=Ue=Ne,le=Fe):Ue=Ue.next=Ne,j|=Pe;if(W=W.next,W===null){if(W=E.shared.pending,W===null)break;Ne=W,W=Ne.next,Ne.next=null,E.lastBaseUpdate=Ne,E.shared.pending=null}}while(!0);Ue===null&&(le=Fe),E.baseState=le,E.firstBaseUpdate=Te,E.lastBaseUpdate=Ue,R===null&&(E.shared.lanes=0),rl|=j,l.lanes=j,l.memoizedState=Fe}}function fO(l,f){if(typeof l!="function")throw Error(r(191,l));l.call(f)}function dO(l,f){var h=l.callbacks;if(h!==null)for(l.callbacks=null,l=0;l<h.length;l++)fO(h[l],f)}var kc=ve(null),ag=ve(0);function hO(l,f){l=fo,Q(ag,l),Q(kc,f),fo=l|f.baseLanes}function I0(){Q(ag,fo),Q(kc,kc.current)}function P0(){fo=ag.current,Re(kc),Re(ag)}var Yo=0,jt=null,gn=null,Zn=null,sg=!1,Mc=!1,ou=!1,og=0,Jd=0,Dc=null,LV=0;function Wn(){throw Error(r(321))}function x0(l,f){if(f===null)return!1;for(var h=0;h<f.length&&h<l.length;h++)if(!Hi(l[h],f[h]))return!1;return!0}function O0(l,f,h,g,E,R){return Yo=R,jt=f,f.memoizedState=null,f.updateQueue=null,f.lanes=0,te.H=l===null||l.memoizedState===null?YO:ZO,ou=!1,R=h(g,E),ou=!1,Mc&&(R=mO(f,h,g,E)),pO(l),R}function pO(l){te.H=hg;var f=gn!==null&&gn.next!==null;if(Yo=0,Zn=gn=jt=null,sg=!1,Jd=0,Dc=null,f)throw Error(r(300));l===null||Er||(l=l.dependencies,l!==null&&eg(l)&&(Er=!0))}function mO(l,f,h,g){jt=l;var E=0;do{if(Mc&&(Dc=null),Jd=0,Mc=!1,25<=E)throw Error(r(301));if(E+=1,Zn=gn=null,l.updateQueue!=null){var R=l.updateQueue;R.lastEffect=null,R.events=null,R.stores=null,R.memoCache!=null&&(R.memoCache.index=0)}te.H=zV,R=f(h,g)}while(Mc);return R}function UV(){var l=te.H,f=l.useState()[0];return f=typeof f.then=="function"?Yd(f):f,l=l.useState()[0],(gn!==null?gn.memoizedState:null)!==l&&(jt.flags|=1024),f}function N0(){var l=og!==0;return og=0,l}function k0(l,f,h){f.updateQueue=l.updateQueue,f.flags&=-2053,l.lanes&=~h}function M0(l){if(sg){for(l=l.memoizedState;l!==null;){var f=l.queue;f!==null&&(f.pending=null),l=l.next}sg=!1}Yo=0,Zn=gn=jt=null,Mc=!1,Jd=og=0,Dc=null}function bi(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Zn===null?jt.memoizedState=Zn=l:Zn=Zn.next=l,Zn}function Xn(){if(gn===null){var l=jt.alternate;l=l!==null?l.memoizedState:null}else l=gn.next;var f=Zn===null?jt.memoizedState:Zn.next;if(f!==null)Zn=f,gn=l;else{if(l===null)throw jt.alternate===null?Error(r(467)):Error(r(310));gn=l,l={memoizedState:gn.memoizedState,baseState:gn.baseState,baseQueue:gn.baseQueue,queue:gn.queue,next:null},Zn===null?jt.memoizedState=Zn=l:Zn=Zn.next=l}return Zn}function D0(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Yd(l){var f=Jd;return Jd+=1,Dc===null&&(Dc=[]),l=lO(Dc,l,f),f=jt,(Zn===null?f.memoizedState:Zn.next)===null&&(f=f.alternate,te.H=f===null||f.memoizedState===null?YO:ZO),l}function lg(l){if(l!==null&&typeof l=="object"){if(typeof l.then=="function")return Yd(l);if(l.$$typeof===A)return Wr(l)}throw Error(r(438,String(l)))}function $0(l){var f=null,h=jt.updateQueue;if(h!==null&&(f=h.memoCache),f==null){var g=jt.alternate;g!==null&&(g=g.updateQueue,g!==null&&(g=g.memoCache,g!=null&&(f={data:g.data.map(function(E){return E.slice()}),index:0})))}if(f==null&&(f={data:[],index:0}),h===null&&(h=D0(),jt.updateQueue=h),h.memoCache=f,h=f.data[f.index],h===void 0)for(h=f.data[f.index]=Array(l),g=0;g<l;g++)h[g]=q;return f.index++,h}function ao(l,f){return typeof f=="function"?f(l):f}function ug(l){var f=Xn();return L0(f,gn,l)}function L0(l,f,h){var g=l.queue;if(g===null)throw Error(r(311));g.lastRenderedReducer=h;var E=l.baseQueue,R=g.pending;if(R!==null){if(E!==null){var j=E.next;E.next=R.next,R.next=j}f.baseQueue=E=R,g.pending=null}if(R=l.baseState,E===null)l.memoizedState=R;else{f=E.next;var W=j=null,le=null,Te=f,Ue=!1;do{var Fe=Te.lane&-536870913;if(Fe!==Te.lane?(Yt&Fe)===Fe:(Yo&Fe)===Fe){var Pe=Te.revertLane;if(Pe===0)le!==null&&(le=le.next={lane:0,revertLane:0,action:Te.action,hasEagerState:Te.hasEagerState,eagerState:Te.eagerState,next:null}),Fe===Oc&&(Ue=!0);else if((Yo&Pe)===Pe){Te=Te.next,Pe===Oc&&(Ue=!0);continue}else Fe={lane:0,revertLane:Te.revertLane,action:Te.action,hasEagerState:Te.hasEagerState,eagerState:Te.eagerState,next:null},le===null?(W=le=Fe,j=R):le=le.next=Fe,jt.lanes|=Pe,rl|=Pe;Fe=Te.action,ou&&h(R,Fe),R=Te.hasEagerState?Te.eagerState:h(R,Fe)}else Pe={lane:Fe,revertLane:Te.revertLane,action:Te.action,hasEagerState:Te.hasEagerState,eagerState:Te.eagerState,next:null},le===null?(W=le=Pe,j=R):le=le.next=Pe,jt.lanes|=Fe,rl|=Fe;Te=Te.next}while(Te!==null&&Te!==f);if(le===null?j=R:le.next=W,!Hi(R,l.memoizedState)&&(Er=!0,Ue&&(h=Nc,h!==null)))throw h;l.memoizedState=R,l.baseState=j,l.baseQueue=le,g.lastRenderedState=R}return E===null&&(g.lanes=0),[l.memoizedState,g.dispatch]}function U0(l){var f=Xn(),h=f.queue;if(h===null)throw Error(r(311));h.lastRenderedReducer=l;var g=h.dispatch,E=h.pending,R=f.memoizedState;if(E!==null){h.pending=null;var j=E=E.next;do R=l(R,j.action),j=j.next;while(j!==E);Hi(R,f.memoizedState)||(Er=!0),f.memoizedState=R,f.baseQueue===null&&(f.baseState=R),h.lastRenderedState=R}return[R,g]}function gO(l,f,h){var g=jt,E=Xn(),R=an;if(R){if(h===void 0)throw Error(r(407));h=h()}else h=f();var j=!Hi((gn||E).memoizedState,h);j&&(E.memoizedState=h,Er=!0),E=E.queue;var W=_O.bind(null,g,E,l);if(Zd(2048,8,W,[l]),E.getSnapshot!==f||j||Zn!==null&&Zn.memoizedState.tag&1){if(g.flags|=2048,$c(9,cg(),vO.bind(null,g,E,h,f),null),Cn===null)throw Error(r(349));R||(Yo&124)!==0||yO(g,f,h)}return h}function yO(l,f,h){l.flags|=16384,l={getSnapshot:f,value:h},f=jt.updateQueue,f===null?(f=D0(),jt.updateQueue=f,f.stores=[l]):(h=f.stores,h===null?f.stores=[l]:h.push(l))}function vO(l,f,h,g){f.value=h,f.getSnapshot=g,bO(f)&&wO(l)}function _O(l,f,h){return h(function(){bO(f)&&wO(l)})}function bO(l){var f=l.getSnapshot;l=l.value;try{var h=f();return!Hi(l,h)}catch{return!0}}function wO(l){var f=Rc(l,2);f!==null&&Zi(f,l,2)}function j0(l){var f=bi();if(typeof l=="function"){var h=l;if(l=h(),ou){tt(!0);try{h()}finally{tt(!1)}}}return f.memoizedState=f.baseState=l,f.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ao,lastRenderedState:l},f}function EO(l,f,h,g){return l.baseState=h,L0(l,gn,typeof g=="function"?g:ao)}function jV(l,f,h,g,E){if(dg(l))throw Error(r(485));if(l=f.action,l!==null){var R={payload:E,action:l,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(j){R.listeners.push(j)}};te.T!==null?h(!0):R.isTransition=!1,g(R),h=f.pending,h===null?(R.next=f.pending=R,SO(f,R)):(R.next=h.next,f.pending=h.next=R)}}function SO(l,f){var h=f.action,g=f.payload,E=l.state;if(f.isTransition){var R=te.T,j={};te.T=j;try{var W=h(E,g),le=te.S;le!==null&&le(j,W),TO(l,f,W)}catch(Te){F0(l,f,Te)}finally{te.T=R}}else try{R=h(E,g),TO(l,f,R)}catch(Te){F0(l,f,Te)}}function TO(l,f,h){h!==null&&typeof h=="object"&&typeof h.then=="function"?h.then(function(g){AO(l,f,g)},function(g){return F0(l,f,g)}):AO(l,f,h)}function AO(l,f,h){f.status="fulfilled",f.value=h,CO(f),l.state=h,f=l.pending,f!==null&&(h=f.next,h===f?l.pending=null:(h=h.next,f.next=h,SO(l,h)))}function F0(l,f,h){var g=l.pending;if(l.pending=null,g!==null){g=g.next;do f.status="rejected",f.reason=h,CO(f),f=f.next;while(f!==g)}l.action=null}function CO(l){l=l.listeners;for(var f=0;f<l.length;f++)(0,l[f])()}function RO(l,f){return f}function IO(l,f){if(an){var h=Cn.formState;if(h!==null){e:{var g=jt;if(an){if(Bn){t:{for(var E=Bn,R=bs;E.nodeType!==8;){if(!R){E=null;break t}if(E=Ha(E.nextSibling),E===null){E=null;break t}}R=E.data,E=R==="F!"||R==="F"?E:null}if(E){Bn=Ha(E.nextSibling),g=E.data==="F!";break e}}ru(g)}g=!1}g&&(f=h[0])}}return h=bi(),h.memoizedState=h.baseState=f,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:RO,lastRenderedState:f},h.queue=g,h=WO.bind(null,jt,g),g.dispatch=h,g=j0(!1),R=H0.bind(null,jt,!1,g.queue),g=bi(),E={state:f,dispatch:null,action:l,pending:null},g.queue=E,h=jV.bind(null,jt,E,R,h),E.dispatch=h,g.memoizedState=l,[f,h,!1]}function PO(l){var f=Xn();return xO(f,gn,l)}function xO(l,f,h){if(f=L0(l,f,RO)[0],l=ug(ao)[0],typeof f=="object"&&f!==null&&typeof f.then=="function")try{var g=Yd(f)}catch(j){throw j===zd?rg:j}else g=f;f=Xn();var E=f.queue,R=E.dispatch;return h!==f.memoizedState&&(jt.flags|=2048,$c(9,cg(),FV.bind(null,E,h),null)),[g,R,l]}function FV(l,f){l.action=f}function OO(l){var f=Xn(),h=gn;if(h!==null)return xO(f,h,l);Xn(),f=f.memoizedState,h=Xn();var g=h.queue.dispatch;return h.memoizedState=l,[f,g,!1]}function $c(l,f,h,g){return l={tag:l,create:h,deps:g,inst:f,next:null},f=jt.updateQueue,f===null&&(f=D0(),jt.updateQueue=f),h=f.lastEffect,h===null?f.lastEffect=l.next=l:(g=h.next,h.next=l,l.next=g,f.lastEffect=l),l}function cg(){return{destroy:void 0,resource:void 0}}function NO(){return Xn().memoizedState}function fg(l,f,h,g){var E=bi();g=g===void 0?null:g,jt.flags|=l,E.memoizedState=$c(1|f,cg(),h,g)}function Zd(l,f,h,g){var E=Xn();g=g===void 0?null:g;var R=E.memoizedState.inst;gn!==null&&g!==null&&x0(g,gn.memoizedState.deps)?E.memoizedState=$c(f,R,h,g):(jt.flags|=l,E.memoizedState=$c(1|f,R,h,g))}function kO(l,f){fg(8390656,8,l,f)}function MO(l,f){Zd(2048,8,l,f)}function DO(l,f){return Zd(4,2,l,f)}function $O(l,f){return Zd(4,4,l,f)}function LO(l,f){if(typeof f=="function"){l=l();var h=f(l);return function(){typeof h=="function"?h():f(null)}}if(f!=null)return l=l(),f.current=l,function(){f.current=null}}function UO(l,f,h){h=h!=null?h.concat([l]):null,Zd(4,4,LO.bind(null,f,l),h)}function B0(){}function jO(l,f){var h=Xn();f=f===void 0?null:f;var g=h.memoizedState;return f!==null&&x0(f,g[1])?g[0]:(h.memoizedState=[l,f],l)}function FO(l,f){var h=Xn();f=f===void 0?null:f;var g=h.memoizedState;if(f!==null&&x0(f,g[1]))return g[0];if(g=l(),ou){tt(!0);try{l()}finally{tt(!1)}}return h.memoizedState=[g,f],g}function q0(l,f,h){return h===void 0||(Yo&1073741824)!==0?l.memoizedState=f:(l.memoizedState=h,l=VN(),jt.lanes|=l,rl|=l,h)}function BO(l,f,h,g){return Hi(h,f)?h:kc.current!==null?(l=q0(l,h,g),Hi(l,f)||(Er=!0),l):(Yo&42)===0?(Er=!0,l.memoizedState=h):(l=VN(),jt.lanes|=l,rl|=l,f)}function qO(l,f,h,g,E){var R=oe.p;oe.p=R!==0&&8>R?R:8;var j=te.T,W={};te.T=W,H0(l,!1,f,h);try{var le=E(),Te=te.S;if(Te!==null&&Te(W,le),le!==null&&typeof le=="object"&&typeof le.then=="function"){var Ue=$V(le,g);Xd(l,f,Ue,Yi(l))}else Xd(l,f,g,Yi(l))}catch(Fe){Xd(l,f,{then:function(){},status:"rejected",reason:Fe},Yi())}finally{oe.p=R,te.T=j}}function BV(){}function V0(l,f,h,g){if(l.tag!==5)throw Error(r(476));var E=VO(l).queue;qO(l,E,f,ge,h===null?BV:function(){return zO(l),h(g)})}function VO(l){var f=l.memoizedState;if(f!==null)return f;f={memoizedState:ge,baseState:ge,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ao,lastRenderedState:ge},next:null};var h={};return f.next={memoizedState:h,baseState:h,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ao,lastRenderedState:h},next:null},l.memoizedState=f,l=l.alternate,l!==null&&(l.memoizedState=f),f}function zO(l){var f=VO(l).next.queue;Xd(l,f,{},Yi())}function z0(){return Wr(gh)}function HO(){return Xn().memoizedState}function GO(){return Xn().memoizedState}function qV(l){for(var f=l.return;f!==null;){switch(f.tag){case 24:case 3:var h=Yi();l=Ko(h);var g=Jo(f,l,h);g!==null&&(Zi(g,f,h),Gd(g,f,h)),f={cache:b0()},l.payload=f;return}f=f.return}}function VV(l,f,h){var g=Yi();h={lane:g,revertLane:0,action:h,hasEagerState:!1,eagerState:null,next:null},dg(l)?KO(f,h):(h=c0(l,f,h,g),h!==null&&(Zi(h,l,g),JO(h,f,g)))}function WO(l,f,h){var g=Yi();Xd(l,f,h,g)}function Xd(l,f,h,g){var E={lane:g,revertLane:0,action:h,hasEagerState:!1,eagerState:null,next:null};if(dg(l))KO(f,E);else{var R=l.alternate;if(l.lanes===0&&(R===null||R.lanes===0)&&(R=f.lastRenderedReducer,R!==null))try{var j=f.lastRenderedState,W=R(j,h);if(E.hasEagerState=!0,E.eagerState=W,Hi(W,j))return Jm(l,f,E,0),Cn===null&&Km(),!1}catch{}finally{}if(h=c0(l,f,E,g),h!==null)return Zi(h,l,g),JO(h,f,g),!0}return!1}function H0(l,f,h,g){if(g={lane:2,revertLane:Sw(),action:g,hasEagerState:!1,eagerState:null,next:null},dg(l)){if(f)throw Error(r(479))}else f=c0(l,h,g,2),f!==null&&Zi(f,l,2)}function dg(l){var f=l.alternate;return l===jt||f!==null&&f===jt}function KO(l,f){Mc=sg=!0;var h=l.pending;h===null?f.next=f:(f.next=h.next,h.next=f),l.pending=f}function JO(l,f,h){if((h&4194048)!==0){var g=f.lanes;g&=l.pendingLanes,h|=g,f.lanes=h,yc(l,h)}}var hg={readContext:Wr,use:lg,useCallback:Wn,useContext:Wn,useEffect:Wn,useImperativeHandle:Wn,useLayoutEffect:Wn,useInsertionEffect:Wn,useMemo:Wn,useReducer:Wn,useRef:Wn,useState:Wn,useDebugValue:Wn,useDeferredValue:Wn,useTransition:Wn,useSyncExternalStore:Wn,useId:Wn,useHostTransitionStatus:Wn,useFormState:Wn,useActionState:Wn,useOptimistic:Wn,useMemoCache:Wn,useCacheRefresh:Wn},YO={readContext:Wr,use:lg,useCallback:function(l,f){return bi().memoizedState=[l,f===void 0?null:f],l},useContext:Wr,useEffect:kO,useImperativeHandle:function(l,f,h){h=h!=null?h.concat([l]):null,fg(4194308,4,LO.bind(null,f,l),h)},useLayoutEffect:function(l,f){return fg(4194308,4,l,f)},useInsertionEffect:function(l,f){fg(4,2,l,f)},useMemo:function(l,f){var h=bi();f=f===void 0?null:f;var g=l();if(ou){tt(!0);try{l()}finally{tt(!1)}}return h.memoizedState=[g,f],g},useReducer:function(l,f,h){var g=bi();if(h!==void 0){var E=h(f);if(ou){tt(!0);try{h(f)}finally{tt(!1)}}}else E=f;return g.memoizedState=g.baseState=E,l={pending:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:E},g.queue=l,l=l.dispatch=VV.bind(null,jt,l),[g.memoizedState,l]},useRef:function(l){var f=bi();return l={current:l},f.memoizedState=l},useState:function(l){l=j0(l);var f=l.queue,h=WO.bind(null,jt,f);return f.dispatch=h,[l.memoizedState,h]},useDebugValue:B0,useDeferredValue:function(l,f){var h=bi();return q0(h,l,f)},useTransition:function(){var l=j0(!1);return l=qO.bind(null,jt,l.queue,!0,!1),bi().memoizedState=l,[!1,l]},useSyncExternalStore:function(l,f,h){var g=jt,E=bi();if(an){if(h===void 0)throw Error(r(407));h=h()}else{if(h=f(),Cn===null)throw Error(r(349));(Yt&124)!==0||yO(g,f,h)}E.memoizedState=h;var R={value:h,getSnapshot:f};return E.queue=R,kO(_O.bind(null,g,R,l),[l]),g.flags|=2048,$c(9,cg(),vO.bind(null,g,R,h,f),null),h},useId:function(){var l=bi(),f=Cn.identifierPrefix;if(an){var h=no,g=to;h=(g&~(1<<32-St(g)-1)).toString(32)+h,f="«"+f+"R"+h,h=og++,0<h&&(f+="H"+h.toString(32)),f+="»"}else h=LV++,f="«"+f+"r"+h.toString(32)+"»";return l.memoizedState=f},useHostTransitionStatus:z0,useFormState:IO,useActionState:IO,useOptimistic:function(l){var f=bi();f.memoizedState=f.baseState=l;var h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return f.queue=h,f=H0.bind(null,jt,!0,h),h.dispatch=f,[l,f]},useMemoCache:$0,useCacheRefresh:function(){return bi().memoizedState=qV.bind(null,jt)}},ZO={readContext:Wr,use:lg,useCallback:jO,useContext:Wr,useEffect:MO,useImperativeHandle:UO,useInsertionEffect:DO,useLayoutEffect:$O,useMemo:FO,useReducer:ug,useRef:NO,useState:function(){return ug(ao)},useDebugValue:B0,useDeferredValue:function(l,f){var h=Xn();return BO(h,gn.memoizedState,l,f)},useTransition:function(){var l=ug(ao)[0],f=Xn().memoizedState;return[typeof l=="boolean"?l:Yd(l),f]},useSyncExternalStore:gO,useId:HO,useHostTransitionStatus:z0,useFormState:PO,useActionState:PO,useOptimistic:function(l,f){var h=Xn();return EO(h,gn,l,f)},useMemoCache:$0,useCacheRefresh:GO},zV={readContext:Wr,use:lg,useCallback:jO,useContext:Wr,useEffect:MO,useImperativeHandle:UO,useInsertionEffect:DO,useLayoutEffect:$O,useMemo:FO,useReducer:U0,useRef:NO,useState:function(){return U0(ao)},useDebugValue:B0,useDeferredValue:function(l,f){var h=Xn();return gn===null?q0(h,l,f):BO(h,gn.memoizedState,l,f)},useTransition:function(){var l=U0(ao)[0],f=Xn().memoizedState;return[typeof l=="boolean"?l:Yd(l),f]},useSyncExternalStore:gO,useId:HO,useHostTransitionStatus:z0,useFormState:OO,useActionState:OO,useOptimistic:function(l,f){var h=Xn();return gn!==null?EO(h,gn,l,f):(h.baseState=l,[l,h.queue.dispatch])},useMemoCache:$0,useCacheRefresh:GO},Lc=null,Qd=0;function pg(l){var f=Qd;return Qd+=1,Lc===null&&(Lc=[]),lO(Lc,l,f)}function eh(l,f){f=f.props.ref,l.ref=f!==void 0?f:null}function mg(l,f){throw f.$$typeof===p?Error(r(525)):(l=Object.prototype.toString.call(f),Error(r(31,l==="[object Object]"?"object with keys {"+Object.keys(f).join(", ")+"}":l)))}function XO(l){var f=l._init;return f(l._payload)}function QO(l){function f(_e,me){if(l){var Se=_e.deletions;Se===null?(_e.deletions=[me],_e.flags|=16):Se.push(me)}}function h(_e,me){if(!l)return null;for(;me!==null;)f(_e,me),me=me.sibling;return null}function g(_e){for(var me=new Map;_e!==null;)_e.key!==null?me.set(_e.key,_e):me.set(_e.index,_e),_e=_e.sibling;return me}function E(_e,me){return _e=eo(_e,me),_e.index=0,_e.sibling=null,_e}function R(_e,me,Se){return _e.index=Se,l?(Se=_e.alternate,Se!==null?(Se=Se.index,Se<me?(_e.flags|=67108866,me):Se):(_e.flags|=67108866,me)):(_e.flags|=1048576,me)}function j(_e){return l&&_e.alternate===null&&(_e.flags|=67108866),_e}function W(_e,me,Se,je){return me===null||me.tag!==6?(me=d0(Se,_e.mode,je),me.return=_e,me):(me=E(me,Se),me.return=_e,me)}function le(_e,me,Se,je){var ot=Se.type;return ot===b?Ue(_e,me,Se.props.children,je,Se.key):me!==null&&(me.elementType===ot||typeof ot=="object"&&ot!==null&&ot.$$typeof===N&&XO(ot)===me.type)?(me=E(me,Se.props),eh(me,Se),me.return=_e,me):(me=Zm(Se.type,Se.key,Se.props,null,_e.mode,je),eh(me,Se),me.return=_e,me)}function Te(_e,me,Se,je){return me===null||me.tag!==4||me.stateNode.containerInfo!==Se.containerInfo||me.stateNode.implementation!==Se.implementation?(me=h0(Se,_e.mode,je),me.return=_e,me):(me=E(me,Se.children||[]),me.return=_e,me)}function Ue(_e,me,Se,je,ot){return me===null||me.tag!==7?(me=Ql(Se,_e.mode,je,ot),me.return=_e,me):(me=E(me,Se),me.return=_e,me)}function Fe(_e,me,Se){if(typeof me=="string"&&me!==""||typeof me=="number"||typeof me=="bigint")return me=d0(""+me,_e.mode,Se),me.return=_e,me;if(typeof me=="object"&&me!==null){switch(me.$$typeof){case m:return Se=Zm(me.type,me.key,me.props,null,_e.mode,Se),eh(Se,me),Se.return=_e,Se;case y:return me=h0(me,_e.mode,Se),me.return=_e,me;case N:var je=me._init;return me=je(me._payload),Fe(_e,me,Se)}if(ue(me)||V(me))return me=Ql(me,_e.mode,Se,null),me.return=_e,me;if(typeof me.then=="function")return Fe(_e,pg(me),Se);if(me.$$typeof===A)return Fe(_e,tg(_e,me),Se);mg(_e,me)}return null}function Pe(_e,me,Se,je){var ot=me!==null?me.key:null;if(typeof Se=="string"&&Se!==""||typeof Se=="number"||typeof Se=="bigint")return ot!==null?null:W(_e,me,""+Se,je);if(typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case m:return Se.key===ot?le(_e,me,Se,je):null;case y:return Se.key===ot?Te(_e,me,Se,je):null;case N:return ot=Se._init,Se=ot(Se._payload),Pe(_e,me,Se,je)}if(ue(Se)||V(Se))return ot!==null?null:Ue(_e,me,Se,je,null);if(typeof Se.then=="function")return Pe(_e,me,pg(Se),je);if(Se.$$typeof===A)return Pe(_e,me,tg(_e,Se),je);mg(_e,Se)}return null}function Ne(_e,me,Se,je,ot){if(typeof je=="string"&&je!==""||typeof je=="number"||typeof je=="bigint")return _e=_e.get(Se)||null,W(me,_e,""+je,ot);if(typeof je=="object"&&je!==null){switch(je.$$typeof){case m:return _e=_e.get(je.key===null?Se:je.key)||null,le(me,_e,je,ot);case y:return _e=_e.get(je.key===null?Se:je.key)||null,Te(me,_e,je,ot);case N:var Ft=je._init;return je=Ft(je._payload),Ne(_e,me,Se,je,ot)}if(ue(je)||V(je))return _e=_e.get(Se)||null,Ue(me,_e,je,ot,null);if(typeof je.then=="function")return Ne(_e,me,Se,pg(je),ot);if(je.$$typeof===A)return Ne(_e,me,Se,tg(me,je),ot);mg(me,je)}return null}function bt(_e,me,Se,je){for(var ot=null,Ft=null,ft=me,vt=me=0,Tr=null;ft!==null&&vt<Se.length;vt++){ft.index>vt?(Tr=ft,ft=null):Tr=ft.sibling;var Xt=Pe(_e,ft,Se[vt],je);if(Xt===null){ft===null&&(ft=Tr);break}l&&ft&&Xt.alternate===null&&f(_e,ft),me=R(Xt,me,vt),Ft===null?ot=Xt:Ft.sibling=Xt,Ft=Xt,ft=Tr}if(vt===Se.length)return h(_e,ft),an&&tu(_e,vt),ot;if(ft===null){for(;vt<Se.length;vt++)ft=Fe(_e,Se[vt],je),ft!==null&&(me=R(ft,me,vt),Ft===null?ot=ft:Ft.sibling=ft,Ft=ft);return an&&tu(_e,vt),ot}for(ft=g(ft);vt<Se.length;vt++)Tr=Ne(ft,_e,vt,Se[vt],je),Tr!==null&&(l&&Tr.alternate!==null&&ft.delete(Tr.key===null?vt:Tr.key),me=R(Tr,me,vt),Ft===null?ot=Tr:Ft.sibling=Tr,Ft=Tr);return l&&ft.forEach(function(dl){return f(_e,dl)}),an&&tu(_e,vt),ot}function yt(_e,me,Se,je){if(Se==null)throw Error(r(151));for(var ot=null,Ft=null,ft=me,vt=me=0,Tr=null,Xt=Se.next();ft!==null&&!Xt.done;vt++,Xt=Se.next()){ft.index>vt?(Tr=ft,ft=null):Tr=ft.sibling;var dl=Pe(_e,ft,Xt.value,je);if(dl===null){ft===null&&(ft=Tr);break}l&&ft&&dl.alternate===null&&f(_e,ft),me=R(dl,me,vt),Ft===null?ot=dl:Ft.sibling=dl,Ft=dl,ft=Tr}if(Xt.done)return h(_e,ft),an&&tu(_e,vt),ot;if(ft===null){for(;!Xt.done;vt++,Xt=Se.next())Xt=Fe(_e,Xt.value,je),Xt!==null&&(me=R(Xt,me,vt),Ft===null?ot=Xt:Ft.sibling=Xt,Ft=Xt);return an&&tu(_e,vt),ot}for(ft=g(ft);!Xt.done;vt++,Xt=Se.next())Xt=Ne(ft,_e,vt,Xt.value,je),Xt!==null&&(l&&Xt.alternate!==null&&ft.delete(Xt.key===null?vt:Xt.key),me=R(Xt,me,vt),Ft===null?ot=Xt:Ft.sibling=Xt,Ft=Xt);return l&&ft.forEach(function(Hz){return f(_e,Hz)}),an&&tu(_e,vt),ot}function vn(_e,me,Se,je){if(typeof Se=="object"&&Se!==null&&Se.type===b&&Se.key===null&&(Se=Se.props.children),typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case m:e:{for(var ot=Se.key;me!==null;){if(me.key===ot){if(ot=Se.type,ot===b){if(me.tag===7){h(_e,me.sibling),je=E(me,Se.props.children),je.return=_e,_e=je;break e}}else if(me.elementType===ot||typeof ot=="object"&&ot!==null&&ot.$$typeof===N&&XO(ot)===me.type){h(_e,me.sibling),je=E(me,Se.props),eh(je,Se),je.return=_e,_e=je;break e}h(_e,me);break}else f(_e,me);me=me.sibling}Se.type===b?(je=Ql(Se.props.children,_e.mode,je,Se.key),je.return=_e,_e=je):(je=Zm(Se.type,Se.key,Se.props,null,_e.mode,je),eh(je,Se),je.return=_e,_e=je)}return j(_e);case y:e:{for(ot=Se.key;me!==null;){if(me.key===ot)if(me.tag===4&&me.stateNode.containerInfo===Se.containerInfo&&me.stateNode.implementation===Se.implementation){h(_e,me.sibling),je=E(me,Se.children||[]),je.return=_e,_e=je;break e}else{h(_e,me);break}else f(_e,me);me=me.sibling}je=h0(Se,_e.mode,je),je.return=_e,_e=je}return j(_e);case N:return ot=Se._init,Se=ot(Se._payload),vn(_e,me,Se,je)}if(ue(Se))return bt(_e,me,Se,je);if(V(Se)){if(ot=V(Se),typeof ot!="function")throw Error(r(150));return Se=ot.call(Se),yt(_e,me,Se,je)}if(typeof Se.then=="function")return vn(_e,me,pg(Se),je);if(Se.$$typeof===A)return vn(_e,me,tg(_e,Se),je);mg(_e,Se)}return typeof Se=="string"&&Se!==""||typeof Se=="number"||typeof Se=="bigint"?(Se=""+Se,me!==null&&me.tag===6?(h(_e,me.sibling),je=E(me,Se),je.return=_e,_e=je):(h(_e,me),je=d0(Se,_e.mode,je),je.return=_e,_e=je),j(_e)):h(_e,me)}return function(_e,me,Se,je){try{Qd=0;var ot=vn(_e,me,Se,je);return Lc=null,ot}catch(ft){if(ft===zd||ft===rg)throw ft;var Ft=Gi(29,ft,null,_e.mode);return Ft.lanes=je,Ft.return=_e,Ft}finally{}}}var Uc=QO(!0),eN=QO(!1),_a=ve(null),ws=null;function Zo(l){var f=l.alternate;Q(ur,ur.current&1),Q(_a,l),ws===null&&(f===null||kc.current!==null||f.memoizedState!==null)&&(ws=l)}function tN(l){if(l.tag===22){if(Q(ur,ur.current),Q(_a,l),ws===null){var f=l.alternate;f!==null&&f.memoizedState!==null&&(ws=l)}}else Xo()}function Xo(){Q(ur,ur.current),Q(_a,_a.current)}function so(l){Re(_a),ws===l&&(ws=null),Re(ur)}var ur=ve(0);function gg(l){for(var f=l;f!==null;){if(f.tag===13){var h=f.memoizedState;if(h!==null&&(h=h.dehydrated,h===null||h.data==="$?"||Dw(h)))return f}else if(f.tag===19&&f.memoizedProps.revealOrder!==void 0){if((f.flags&128)!==0)return f}else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===l)break;for(;f.sibling===null;){if(f.return===null||f.return===l)return null;f=f.return}f.sibling.return=f.return,f=f.sibling}return null}function G0(l,f,h,g){f=l.memoizedState,h=h(g,f),h=h==null?f:d({},f,h),l.memoizedState=h,l.lanes===0&&(l.updateQueue.baseState=h)}var W0={enqueueSetState:function(l,f,h){l=l._reactInternals;var g=Yi(),E=Ko(g);E.payload=f,h!=null&&(E.callback=h),f=Jo(l,E,g),f!==null&&(Zi(f,l,g),Gd(f,l,g))},enqueueReplaceState:function(l,f,h){l=l._reactInternals;var g=Yi(),E=Ko(g);E.tag=1,E.payload=f,h!=null&&(E.callback=h),f=Jo(l,E,g),f!==null&&(Zi(f,l,g),Gd(f,l,g))},enqueueForceUpdate:function(l,f){l=l._reactInternals;var h=Yi(),g=Ko(h);g.tag=2,f!=null&&(g.callback=f),f=Jo(l,g,h),f!==null&&(Zi(f,l,h),Gd(f,l,h))}};function nN(l,f,h,g,E,R,j){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(g,R,j):f.prototype&&f.prototype.isPureReactComponent?!$d(h,g)||!$d(E,R):!0}function rN(l,f,h,g){l=f.state,typeof f.componentWillReceiveProps=="function"&&f.componentWillReceiveProps(h,g),typeof f.UNSAFE_componentWillReceiveProps=="function"&&f.UNSAFE_componentWillReceiveProps(h,g),f.state!==l&&W0.enqueueReplaceState(f,f.state,null)}function lu(l,f){var h=f;if("ref"in f){h={};for(var g in f)g!=="ref"&&(h[g]=f[g])}if(l=l.defaultProps){h===f&&(h=d({},h));for(var E in l)h[E]===void 0&&(h[E]=l[E])}return h}var yg=typeof reportError=="function"?reportError:function(l){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var f=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof l=="object"&&l!==null&&typeof l.message=="string"?String(l.message):String(l),error:l});if(!window.dispatchEvent(f))return}else if(typeof at=="object"&&typeof at.emit=="function"){at.emit("uncaughtException",l);return}console.error(l)};function iN(l){yg(l)}function aN(l){console.error(l)}function sN(l){yg(l)}function vg(l,f){try{var h=l.onUncaughtError;h(f.value,{componentStack:f.stack})}catch(g){setTimeout(function(){throw g})}}function oN(l,f,h){try{var g=l.onCaughtError;g(h.value,{componentStack:h.stack,errorBoundary:f.tag===1?f.stateNode:null})}catch(E){setTimeout(function(){throw E})}}function K0(l,f,h){return h=Ko(h),h.tag=3,h.payload={element:null},h.callback=function(){vg(l,f)},h}function lN(l){return l=Ko(l),l.tag=3,l}function uN(l,f,h,g){var E=h.type.getDerivedStateFromError;if(typeof E=="function"){var R=g.value;l.payload=function(){return E(R)},l.callback=function(){oN(f,h,g)}}var j=h.stateNode;j!==null&&typeof j.componentDidCatch=="function"&&(l.callback=function(){oN(f,h,g),typeof E!="function"&&(il===null?il=new Set([this]):il.add(this));var W=g.stack;this.componentDidCatch(g.value,{componentStack:W!==null?W:""})})}function HV(l,f,h,g,E){if(h.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){if(f=h.alternate,f!==null&&Bd(f,h,E,!0),h=_a.current,h!==null){switch(h.tag){case 13:return ws===null?vw():h.alternate===null&&qn===0&&(qn=3),h.flags&=-257,h.flags|=65536,h.lanes=E,g===S0?h.flags|=16384:(f=h.updateQueue,f===null?h.updateQueue=new Set([g]):f.add(g),bw(l,g,E)),!1;case 22:return h.flags|=65536,g===S0?h.flags|=16384:(f=h.updateQueue,f===null?(f={transitions:null,markerInstances:null,retryQueue:new Set([g])},h.updateQueue=f):(h=f.retryQueue,h===null?f.retryQueue=new Set([g]):h.add(g)),bw(l,g,E)),!1}throw Error(r(435,h.tag))}return bw(l,g,E),vw(),!1}if(an)return f=_a.current,f!==null?((f.flags&65536)===0&&(f.flags|=256),f.flags|=65536,f.lanes=E,g!==g0&&(l=Error(r(422),{cause:g}),Fd(ma(l,h)))):(g!==g0&&(f=Error(r(423),{cause:g}),Fd(ma(f,h))),l=l.current.alternate,l.flags|=65536,E&=-E,l.lanes|=E,g=ma(g,h),E=K0(l.stateNode,g,E),C0(l,E),qn!==4&&(qn=2)),!1;var R=Error(r(520),{cause:g});if(R=ma(R,h),oh===null?oh=[R]:oh.push(R),qn!==4&&(qn=2),f===null)return!0;g=ma(g,h),h=f;do{switch(h.tag){case 3:return h.flags|=65536,l=E&-E,h.lanes|=l,l=K0(h.stateNode,g,l),C0(h,l),!1;case 1:if(f=h.type,R=h.stateNode,(h.flags&128)===0&&(typeof f.getDerivedStateFromError=="function"||R!==null&&typeof R.componentDidCatch=="function"&&(il===null||!il.has(R))))return h.flags|=65536,E&=-E,h.lanes|=E,E=lN(E),uN(E,l,h,g),C0(h,E),!1}h=h.return}while(h!==null);return!1}var cN=Error(r(461)),Er=!1;function Nr(l,f,h,g){f.child=l===null?eN(f,null,h,g):Uc(f,l.child,h,g)}function fN(l,f,h,g,E){h=h.render;var R=f.ref;if("ref"in g){var j={};for(var W in g)W!=="ref"&&(j[W]=g[W])}else j=g;return au(f),g=O0(l,f,h,j,R,E),W=N0(),l!==null&&!Er?(k0(l,f,E),oo(l,f,E)):(an&&W&&p0(f),f.flags|=1,Nr(l,f,g,E),f.child)}function dN(l,f,h,g,E){if(l===null){var R=h.type;return typeof R=="function"&&!f0(R)&&R.defaultProps===void 0&&h.compare===null?(f.tag=15,f.type=R,hN(l,f,R,g,E)):(l=Zm(h.type,null,g,f,f.mode,E),l.ref=f.ref,l.return=f,f.child=l)}if(R=l.child,!nw(l,E)){var j=R.memoizedProps;if(h=h.compare,h=h!==null?h:$d,h(j,g)&&l.ref===f.ref)return oo(l,f,E)}return f.flags|=1,l=eo(R,g),l.ref=f.ref,l.return=f,f.child=l}function hN(l,f,h,g,E){if(l!==null){var R=l.memoizedProps;if($d(R,g)&&l.ref===f.ref)if(Er=!1,f.pendingProps=g=R,nw(l,E))(l.flags&131072)!==0&&(Er=!0);else return f.lanes=l.lanes,oo(l,f,E)}return J0(l,f,h,g,E)}function pN(l,f,h){var g=f.pendingProps,E=g.children,R=l!==null?l.memoizedState:null;if(g.mode==="hidden"){if((f.flags&128)!==0){if(g=R!==null?R.baseLanes|h:h,l!==null){for(E=f.child=l.child,R=0;E!==null;)R=R|E.lanes|E.childLanes,E=E.sibling;f.childLanes=R&~g}else f.childLanes=0,f.child=null;return mN(l,f,g,h)}if((h&536870912)!==0)f.memoizedState={baseLanes:0,cachePool:null},l!==null&&ng(f,R!==null?R.cachePool:null),R!==null?hO(f,R):I0(),tN(f);else return f.lanes=f.childLanes=536870912,mN(l,f,R!==null?R.baseLanes|h:h,h)}else R!==null?(ng(f,R.cachePool),hO(f,R),Xo(),f.memoizedState=null):(l!==null&&ng(f,null),I0(),Xo());return Nr(l,f,E,h),f.child}function mN(l,f,h,g){var E=E0();return E=E===null?null:{parent:lr._currentValue,pool:E},f.memoizedState={baseLanes:h,cachePool:E},l!==null&&ng(f,null),I0(),tN(f),l!==null&&Bd(l,f,g,!0),null}function _g(l,f){var h=f.ref;if(h===null)l!==null&&l.ref!==null&&(f.flags|=4194816);else{if(typeof h!="function"&&typeof h!="object")throw Error(r(284));(l===null||l.ref!==h)&&(f.flags|=4194816)}}function J0(l,f,h,g,E){return au(f),h=O0(l,f,h,g,void 0,E),g=N0(),l!==null&&!Er?(k0(l,f,E),oo(l,f,E)):(an&&g&&p0(f),f.flags|=1,Nr(l,f,h,E),f.child)}function gN(l,f,h,g,E,R){return au(f),f.updateQueue=null,h=mO(f,g,h,E),pO(l),g=N0(),l!==null&&!Er?(k0(l,f,R),oo(l,f,R)):(an&&g&&p0(f),f.flags|=1,Nr(l,f,h,R),f.child)}function yN(l,f,h,g,E){if(au(f),f.stateNode===null){var R=Ic,j=h.contextType;typeof j=="object"&&j!==null&&(R=Wr(j)),R=new h(g,R),f.memoizedState=R.state!==null&&R.state!==void 0?R.state:null,R.updater=W0,f.stateNode=R,R._reactInternals=f,R=f.stateNode,R.props=g,R.state=f.memoizedState,R.refs={},T0(f),j=h.contextType,R.context=typeof j=="object"&&j!==null?Wr(j):Ic,R.state=f.memoizedState,j=h.getDerivedStateFromProps,typeof j=="function"&&(G0(f,h,j,g),R.state=f.memoizedState),typeof h.getDerivedStateFromProps=="function"||typeof R.getSnapshotBeforeUpdate=="function"||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(j=R.state,typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount(),j!==R.state&&W0.enqueueReplaceState(R,R.state,null),Kd(f,g,R,E),Wd(),R.state=f.memoizedState),typeof R.componentDidMount=="function"&&(f.flags|=4194308),g=!0}else if(l===null){R=f.stateNode;var W=f.memoizedProps,le=lu(h,W);R.props=le;var Te=R.context,Ue=h.contextType;j=Ic,typeof Ue=="object"&&Ue!==null&&(j=Wr(Ue));var Fe=h.getDerivedStateFromProps;Ue=typeof Fe=="function"||typeof R.getSnapshotBeforeUpdate=="function",W=f.pendingProps!==W,Ue||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(W||Te!==j)&&rN(f,R,g,j),Wo=!1;var Pe=f.memoizedState;R.state=Pe,Kd(f,g,R,E),Wd(),Te=f.memoizedState,W||Pe!==Te||Wo?(typeof Fe=="function"&&(G0(f,h,Fe,g),Te=f.memoizedState),(le=Wo||nN(f,h,le,g,Pe,Te,j))?(Ue||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(f.flags|=4194308)):(typeof R.componentDidMount=="function"&&(f.flags|=4194308),f.memoizedProps=g,f.memoizedState=Te),R.props=g,R.state=Te,R.context=j,g=le):(typeof R.componentDidMount=="function"&&(f.flags|=4194308),g=!1)}else{R=f.stateNode,A0(l,f),j=f.memoizedProps,Ue=lu(h,j),R.props=Ue,Fe=f.pendingProps,Pe=R.context,Te=h.contextType,le=Ic,typeof Te=="object"&&Te!==null&&(le=Wr(Te)),W=h.getDerivedStateFromProps,(Te=typeof W=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(j!==Fe||Pe!==le)&&rN(f,R,g,le),Wo=!1,Pe=f.memoizedState,R.state=Pe,Kd(f,g,R,E),Wd();var Ne=f.memoizedState;j!==Fe||Pe!==Ne||Wo||l!==null&&l.dependencies!==null&&eg(l.dependencies)?(typeof W=="function"&&(G0(f,h,W,g),Ne=f.memoizedState),(Ue=Wo||nN(f,h,Ue,g,Pe,Ne,le)||l!==null&&l.dependencies!==null&&eg(l.dependencies))?(Te||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(g,Ne,le),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(g,Ne,le)),typeof R.componentDidUpdate=="function"&&(f.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(f.flags|=1024)):(typeof R.componentDidUpdate!="function"||j===l.memoizedProps&&Pe===l.memoizedState||(f.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||j===l.memoizedProps&&Pe===l.memoizedState||(f.flags|=1024),f.memoizedProps=g,f.memoizedState=Ne),R.props=g,R.state=Ne,R.context=le,g=Ue):(typeof R.componentDidUpdate!="function"||j===l.memoizedProps&&Pe===l.memoizedState||(f.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||j===l.memoizedProps&&Pe===l.memoizedState||(f.flags|=1024),g=!1)}return R=g,_g(l,f),g=(f.flags&128)!==0,R||g?(R=f.stateNode,h=g&&typeof h.getDerivedStateFromError!="function"?null:R.render(),f.flags|=1,l!==null&&g?(f.child=Uc(f,l.child,null,E),f.child=Uc(f,null,h,E)):Nr(l,f,h,E),f.memoizedState=R.state,l=f.child):l=oo(l,f,E),l}function vN(l,f,h,g){return jd(),f.flags|=256,Nr(l,f,h,g),f.child}var Y0={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Z0(l){return{baseLanes:l,cachePool:aO()}}function X0(l,f,h){return l=l!==null?l.childLanes&~h:0,f&&(l|=ba),l}function _N(l,f,h){var g=f.pendingProps,E=!1,R=(f.flags&128)!==0,j;if((j=R)||(j=l!==null&&l.memoizedState===null?!1:(ur.current&2)!==0),j&&(E=!0,f.flags&=-129),j=(f.flags&32)!==0,f.flags&=-33,l===null){if(an){if(E?Zo(f):Xo(),an){var W=Bn,le;if(le=W){e:{for(le=W,W=bs;le.nodeType!==8;){if(!W){W=null;break e}if(le=Ha(le.nextSibling),le===null){W=null;break e}}W=le}W!==null?(f.memoizedState={dehydrated:W,treeContext:eu!==null?{id:to,overflow:no}:null,retryLane:536870912,hydrationErrors:null},le=Gi(18,null,null,0),le.stateNode=W,le.return=f,f.child=le,ai=f,Bn=null,le=!0):le=!1}le||ru(f)}if(W=f.memoizedState,W!==null&&(W=W.dehydrated,W!==null))return Dw(W)?f.lanes=32:f.lanes=536870912,null;so(f)}return W=g.children,g=g.fallback,E?(Xo(),E=f.mode,W=bg({mode:"hidden",children:W},E),g=Ql(g,E,h,null),W.return=f,g.return=f,W.sibling=g,f.child=W,E=f.child,E.memoizedState=Z0(h),E.childLanes=X0(l,j,h),f.memoizedState=Y0,g):(Zo(f),Q0(f,W))}if(le=l.memoizedState,le!==null&&(W=le.dehydrated,W!==null)){if(R)f.flags&256?(Zo(f),f.flags&=-257,f=ew(l,f,h)):f.memoizedState!==null?(Xo(),f.child=l.child,f.flags|=128,f=null):(Xo(),E=g.fallback,W=f.mode,g=bg({mode:"visible",children:g.children},W),E=Ql(E,W,h,null),E.flags|=2,g.return=f,E.return=f,g.sibling=E,f.child=g,Uc(f,l.child,null,h),g=f.child,g.memoizedState=Z0(h),g.childLanes=X0(l,j,h),f.memoizedState=Y0,f=E);else if(Zo(f),Dw(W)){if(j=W.nextSibling&&W.nextSibling.dataset,j)var Te=j.dgst;j=Te,g=Error(r(419)),g.stack="",g.digest=j,Fd({value:g,source:null,stack:null}),f=ew(l,f,h)}else if(Er||Bd(l,f,h,!1),j=(h&l.childLanes)!==0,Er||j){if(j=Cn,j!==null&&(g=h&-h,g=(g&42)!==0?1:ri(g),g=(g&(j.suspendedLanes|h))!==0?0:g,g!==0&&g!==le.retryLane))throw le.retryLane=g,Rc(l,g),Zi(j,l,g),cN;W.data==="$?"||vw(),f=ew(l,f,h)}else W.data==="$?"?(f.flags|=192,f.child=l.child,f=null):(l=le.treeContext,Bn=Ha(W.nextSibling),ai=f,an=!0,nu=null,bs=!1,l!==null&&(ya[va++]=to,ya[va++]=no,ya[va++]=eu,to=l.id,no=l.overflow,eu=f),f=Q0(f,g.children),f.flags|=4096);return f}return E?(Xo(),E=g.fallback,W=f.mode,le=l.child,Te=le.sibling,g=eo(le,{mode:"hidden",children:g.children}),g.subtreeFlags=le.subtreeFlags&65011712,Te!==null?E=eo(Te,E):(E=Ql(E,W,h,null),E.flags|=2),E.return=f,g.return=f,g.sibling=E,f.child=g,g=E,E=f.child,W=l.child.memoizedState,W===null?W=Z0(h):(le=W.cachePool,le!==null?(Te=lr._currentValue,le=le.parent!==Te?{parent:Te,pool:Te}:le):le=aO(),W={baseLanes:W.baseLanes|h,cachePool:le}),E.memoizedState=W,E.childLanes=X0(l,j,h),f.memoizedState=Y0,g):(Zo(f),h=l.child,l=h.sibling,h=eo(h,{mode:"visible",children:g.children}),h.return=f,h.sibling=null,l!==null&&(j=f.deletions,j===null?(f.deletions=[l],f.flags|=16):j.push(l)),f.child=h,f.memoizedState=null,h)}function Q0(l,f){return f=bg({mode:"visible",children:f},l.mode),f.return=l,l.child=f}function bg(l,f){return l=Gi(22,l,null,f),l.lanes=0,l.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},l}function ew(l,f,h){return Uc(f,l.child,null,h),l=Q0(f,f.pendingProps.children),l.flags|=2,f.memoizedState=null,l}function bN(l,f,h){l.lanes|=f;var g=l.alternate;g!==null&&(g.lanes|=f),v0(l.return,f,h)}function tw(l,f,h,g,E){var R=l.memoizedState;R===null?l.memoizedState={isBackwards:f,rendering:null,renderingStartTime:0,last:g,tail:h,tailMode:E}:(R.isBackwards=f,R.rendering=null,R.renderingStartTime=0,R.last=g,R.tail=h,R.tailMode=E)}function wN(l,f,h){var g=f.pendingProps,E=g.revealOrder,R=g.tail;if(Nr(l,f,g.children,h),g=ur.current,(g&2)!==0)g=g&1|2,f.flags|=128;else{if(l!==null&&(l.flags&128)!==0)e:for(l=f.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&bN(l,h,f);else if(l.tag===19)bN(l,h,f);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===f)break e;for(;l.sibling===null;){if(l.return===null||l.return===f)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}g&=1}switch(Q(ur,g),E){case"forwards":for(h=f.child,E=null;h!==null;)l=h.alternate,l!==null&&gg(l)===null&&(E=h),h=h.sibling;h=E,h===null?(E=f.child,f.child=null):(E=h.sibling,h.sibling=null),tw(f,!1,E,h,R);break;case"backwards":for(h=null,E=f.child,f.child=null;E!==null;){if(l=E.alternate,l!==null&&gg(l)===null){f.child=E;break}l=E.sibling,E.sibling=h,h=E,E=l}tw(f,!0,h,null,R);break;case"together":tw(f,!1,null,null,void 0);break;default:f.memoizedState=null}return f.child}function oo(l,f,h){if(l!==null&&(f.dependencies=l.dependencies),rl|=f.lanes,(h&f.childLanes)===0)if(l!==null){if(Bd(l,f,h,!1),(h&f.childLanes)===0)return null}else return null;if(l!==null&&f.child!==l.child)throw Error(r(153));if(f.child!==null){for(l=f.child,h=eo(l,l.pendingProps),f.child=h,h.return=f;l.sibling!==null;)l=l.sibling,h=h.sibling=eo(l,l.pendingProps),h.return=f;h.sibling=null}return f.child}function nw(l,f){return(l.lanes&f)!==0?!0:(l=l.dependencies,!!(l!==null&&eg(l)))}function GV(l,f,h){switch(f.tag){case 3:K(f,f.stateNode.containerInfo),Go(f,lr,l.memoizedState.cache),jd();break;case 27:case 5:se(f);break;case 4:K(f,f.stateNode.containerInfo);break;case 10:Go(f,f.type,f.memoizedProps.value);break;case 13:var g=f.memoizedState;if(g!==null)return g.dehydrated!==null?(Zo(f),f.flags|=128,null):(h&f.child.childLanes)!==0?_N(l,f,h):(Zo(f),l=oo(l,f,h),l!==null?l.sibling:null);Zo(f);break;case 19:var E=(l.flags&128)!==0;if(g=(h&f.childLanes)!==0,g||(Bd(l,f,h,!1),g=(h&f.childLanes)!==0),E){if(g)return wN(l,f,h);f.flags|=128}if(E=f.memoizedState,E!==null&&(E.rendering=null,E.tail=null,E.lastEffect=null),Q(ur,ur.current),g)break;return null;case 22:case 23:return f.lanes=0,pN(l,f,h);case 24:Go(f,lr,l.memoizedState.cache)}return oo(l,f,h)}function EN(l,f,h){if(l!==null)if(l.memoizedProps!==f.pendingProps)Er=!0;else{if(!nw(l,h)&&(f.flags&128)===0)return Er=!1,GV(l,f,h);Er=(l.flags&131072)!==0}else Er=!1,an&&(f.flags&1048576)!==0&&Xx(f,Qm,f.index);switch(f.lanes=0,f.tag){case 16:e:{l=f.pendingProps;var g=f.elementType,E=g._init;if(g=E(g._payload),f.type=g,typeof g=="function")f0(g)?(l=lu(g,l),f.tag=1,f=yN(null,f,g,l,h)):(f.tag=0,f=J0(null,f,g,l,h));else{if(g!=null){if(E=g.$$typeof,E===I){f.tag=11,f=fN(null,f,g,l,h);break e}else if(E===U){f.tag=14,f=dN(null,f,g,l,h);break e}}throw f=ae(g)||g,Error(r(306,f,""))}}return f;case 0:return J0(l,f,f.type,f.pendingProps,h);case 1:return g=f.type,E=lu(g,f.pendingProps),yN(l,f,g,E,h);case 3:e:{if(K(f,f.stateNode.containerInfo),l===null)throw Error(r(387));g=f.pendingProps;var R=f.memoizedState;E=R.element,A0(l,f),Kd(f,g,null,h);var j=f.memoizedState;if(g=j.cache,Go(f,lr,g),g!==R.cache&&_0(f,[lr],h,!0),Wd(),g=j.element,R.isDehydrated)if(R={element:g,isDehydrated:!1,cache:j.cache},f.updateQueue.baseState=R,f.memoizedState=R,f.flags&256){f=vN(l,f,g,h);break e}else if(g!==E){E=ma(Error(r(424)),f),Fd(E),f=vN(l,f,g,h);break e}else{switch(l=f.stateNode.containerInfo,l.nodeType){case 9:l=l.body;break;default:l=l.nodeName==="HTML"?l.ownerDocument.body:l}for(Bn=Ha(l.firstChild),ai=f,an=!0,nu=null,bs=!0,h=eN(f,null,g,h),f.child=h;h;)h.flags=h.flags&-3|4096,h=h.sibling}else{if(jd(),g===E){f=oo(l,f,h);break e}Nr(l,f,g,h)}f=f.child}return f;case 26:return _g(l,f),l===null?(h=Ck(f.type,null,f.pendingProps,null))?f.memoizedState=h:an||(h=f.type,l=f.pendingProps,g=Mg(P.current).createElement(h),g[ne]=f,g[he]=l,Mr(g,h,l),pt(g),f.stateNode=g):f.memoizedState=Ck(f.type,l.memoizedProps,f.pendingProps,l.memoizedState),null;case 27:return se(f),l===null&&an&&(g=f.stateNode=Sk(f.type,f.pendingProps,P.current),ai=f,bs=!0,E=Bn,ol(f.type)?($w=E,Bn=Ha(g.firstChild)):Bn=E),Nr(l,f,f.pendingProps.children,h),_g(l,f),l===null&&(f.flags|=4194304),f.child;case 5:return l===null&&an&&((E=g=Bn)&&(g=bz(g,f.type,f.pendingProps,bs),g!==null?(f.stateNode=g,ai=f,Bn=Ha(g.firstChild),bs=!1,E=!0):E=!1),E||ru(f)),se(f),E=f.type,R=f.pendingProps,j=l!==null?l.memoizedProps:null,g=R.children,Nw(E,R)?g=null:j!==null&&Nw(E,j)&&(f.flags|=32),f.memoizedState!==null&&(E=O0(l,f,UV,null,null,h),gh._currentValue=E),_g(l,f),Nr(l,f,g,h),f.child;case 6:return l===null&&an&&((l=h=Bn)&&(h=wz(h,f.pendingProps,bs),h!==null?(f.stateNode=h,ai=f,Bn=null,l=!0):l=!1),l||ru(f)),null;case 13:return _N(l,f,h);case 4:return K(f,f.stateNode.containerInfo),g=f.pendingProps,l===null?f.child=Uc(f,null,g,h):Nr(l,f,g,h),f.child;case 11:return fN(l,f,f.type,f.pendingProps,h);case 7:return Nr(l,f,f.pendingProps,h),f.child;case 8:return Nr(l,f,f.pendingProps.children,h),f.child;case 12:return Nr(l,f,f.pendingProps.children,h),f.child;case 10:return g=f.pendingProps,Go(f,f.type,g.value),Nr(l,f,g.children,h),f.child;case 9:return E=f.type._context,g=f.pendingProps.children,au(f),E=Wr(E),g=g(E),f.flags|=1,Nr(l,f,g,h),f.child;case 14:return dN(l,f,f.type,f.pendingProps,h);case 15:return hN(l,f,f.type,f.pendingProps,h);case 19:return wN(l,f,h);case 31:return g=f.pendingProps,h=f.mode,g={mode:g.mode,children:g.children},l===null?(h=bg(g,h),h.ref=f.ref,f.child=h,h.return=f,f=h):(h=eo(l.child,g),h.ref=f.ref,f.child=h,h.return=f,f=h),f;case 22:return pN(l,f,h);case 24:return au(f),g=Wr(lr),l===null?(E=E0(),E===null&&(E=Cn,R=b0(),E.pooledCache=R,R.refCount++,R!==null&&(E.pooledCacheLanes|=h),E=R),f.memoizedState={parent:g,cache:E},T0(f),Go(f,lr,E)):((l.lanes&h)!==0&&(A0(l,f),Kd(f,null,null,h),Wd()),E=l.memoizedState,R=f.memoizedState,E.parent!==g?(E={parent:g,cache:g},f.memoizedState=E,f.lanes===0&&(f.memoizedState=f.updateQueue.baseState=E),Go(f,lr,g)):(g=R.cache,Go(f,lr,g),g!==E.cache&&_0(f,[lr],h,!0))),Nr(l,f,f.pendingProps.children,h),f.child;case 29:throw f.pendingProps}throw Error(r(156,f.tag))}function lo(l){l.flags|=4}function SN(l,f){if(f.type!=="stylesheet"||(f.state.loading&4)!==0)l.flags&=-16777217;else if(l.flags|=16777216,!Ok(f)){if(f=_a.current,f!==null&&((Yt&4194048)===Yt?ws!==null:(Yt&62914560)!==Yt&&(Yt&536870912)===0||f!==ws))throw Hd=S0,sO;l.flags|=8192}}function wg(l,f){f!==null&&(l.flags|=4),l.flags&16384&&(f=l.tag!==22?un():536870912,l.lanes|=f,qc|=f)}function th(l,f){if(!an)switch(l.tailMode){case"hidden":f=l.tail;for(var h=null;f!==null;)f.alternate!==null&&(h=f),f=f.sibling;h===null?l.tail=null:h.sibling=null;break;case"collapsed":h=l.tail;for(var g=null;h!==null;)h.alternate!==null&&(g=h),h=h.sibling;g===null?f||l.tail===null?l.tail=null:l.tail.sibling=null:g.sibling=null}}function Dn(l){var f=l.alternate!==null&&l.alternate.child===l.child,h=0,g=0;if(f)for(var E=l.child;E!==null;)h|=E.lanes|E.childLanes,g|=E.subtreeFlags&65011712,g|=E.flags&65011712,E.return=l,E=E.sibling;else for(E=l.child;E!==null;)h|=E.lanes|E.childLanes,g|=E.subtreeFlags,g|=E.flags,E.return=l,E=E.sibling;return l.subtreeFlags|=g,l.childLanes=h,f}function WV(l,f,h){var g=f.pendingProps;switch(m0(f),f.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Dn(f),null;case 1:return Dn(f),null;case 3:return h=f.stateNode,g=null,l!==null&&(g=l.memoizedState.cache),f.memoizedState.cache!==g&&(f.flags|=2048),io(lr),X(),h.pendingContext&&(h.context=h.pendingContext,h.pendingContext=null),(l===null||l.child===null)&&(Ud(f)?lo(f):l===null||l.memoizedState.isDehydrated&&(f.flags&256)===0||(f.flags|=1024,tO())),Dn(f),null;case 26:return h=f.memoizedState,l===null?(lo(f),h!==null?(Dn(f),SN(f,h)):(Dn(f),f.flags&=-16777217)):h?h!==l.memoizedState?(lo(f),Dn(f),SN(f,h)):(Dn(f),f.flags&=-16777217):(l.memoizedProps!==g&&lo(f),Dn(f),f.flags&=-16777217),null;case 27:F(f),h=P.current;var E=f.type;if(l!==null&&f.stateNode!=null)l.memoizedProps!==g&&lo(f);else{if(!g){if(f.stateNode===null)throw Error(r(166));return Dn(f),null}l=ie.current,Ud(f)?Qx(f):(l=Sk(E,g,h),f.stateNode=l,lo(f))}return Dn(f),null;case 5:if(F(f),h=f.type,l!==null&&f.stateNode!=null)l.memoizedProps!==g&&lo(f);else{if(!g){if(f.stateNode===null)throw Error(r(166));return Dn(f),null}if(l=ie.current,Ud(f))Qx(f);else{switch(E=Mg(P.current),l){case 1:l=E.createElementNS("http://www.w3.org/2000/svg",h);break;case 2:l=E.createElementNS("http://www.w3.org/1998/Math/MathML",h);break;default:switch(h){case"svg":l=E.createElementNS("http://www.w3.org/2000/svg",h);break;case"math":l=E.createElementNS("http://www.w3.org/1998/Math/MathML",h);break;case"script":l=E.createElement("div"),l.innerHTML="<script><\/script>",l=l.removeChild(l.firstChild);break;case"select":l=typeof g.is=="string"?E.createElement("select",{is:g.is}):E.createElement("select"),g.multiple?l.multiple=!0:g.size&&(l.size=g.size);break;default:l=typeof g.is=="string"?E.createElement(h,{is:g.is}):E.createElement(h)}}l[ne]=f,l[he]=g;e:for(E=f.child;E!==null;){if(E.tag===5||E.tag===6)l.appendChild(E.stateNode);else if(E.tag!==4&&E.tag!==27&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===f)break e;for(;E.sibling===null;){if(E.return===null||E.return===f)break e;E=E.return}E.sibling.return=E.return,E=E.sibling}f.stateNode=l;e:switch(Mr(l,h,g),h){case"button":case"input":case"select":case"textarea":l=!!g.autoFocus;break e;case"img":l=!0;break e;default:l=!1}l&&lo(f)}}return Dn(f),f.flags&=-16777217,null;case 6:if(l&&f.stateNode!=null)l.memoizedProps!==g&&lo(f);else{if(typeof g!="string"&&f.stateNode===null)throw Error(r(166));if(l=P.current,Ud(f)){if(l=f.stateNode,h=f.memoizedProps,g=null,E=ai,E!==null)switch(E.tag){case 27:case 5:g=E.memoizedProps}l[ne]=f,l=!!(l.nodeValue===h||g!==null&&g.suppressHydrationWarning===!0||gk(l.nodeValue,h)),l||ru(f)}else l=Mg(l).createTextNode(g),l[ne]=f,f.stateNode=l}return Dn(f),null;case 13:if(g=f.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(E=Ud(f),g!==null&&g.dehydrated!==null){if(l===null){if(!E)throw Error(r(318));if(E=f.memoizedState,E=E!==null?E.dehydrated:null,!E)throw Error(r(317));E[ne]=f}else jd(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;Dn(f),E=!1}else E=tO(),l!==null&&l.memoizedState!==null&&(l.memoizedState.hydrationErrors=E),E=!0;if(!E)return f.flags&256?(so(f),f):(so(f),null)}if(so(f),(f.flags&128)!==0)return f.lanes=h,f;if(h=g!==null,l=l!==null&&l.memoizedState!==null,h){g=f.child,E=null,g.alternate!==null&&g.alternate.memoizedState!==null&&g.alternate.memoizedState.cachePool!==null&&(E=g.alternate.memoizedState.cachePool.pool);var R=null;g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(R=g.memoizedState.cachePool.pool),R!==E&&(g.flags|=2048)}return h!==l&&h&&(f.child.flags|=8192),wg(f,f.updateQueue),Dn(f),null;case 4:return X(),l===null&&Rw(f.stateNode.containerInfo),Dn(f),null;case 10:return io(f.type),Dn(f),null;case 19:if(Re(ur),E=f.memoizedState,E===null)return Dn(f),null;if(g=(f.flags&128)!==0,R=E.rendering,R===null)if(g)th(E,!1);else{if(qn!==0||l!==null&&(l.flags&128)!==0)for(l=f.child;l!==null;){if(R=gg(l),R!==null){for(f.flags|=128,th(E,!1),l=R.updateQueue,f.updateQueue=l,wg(f,l),f.subtreeFlags=0,l=h,h=f.child;h!==null;)Zx(h,l),h=h.sibling;return Q(ur,ur.current&1|2),f.child}l=l.sibling}E.tail!==null&&ze()>Tg&&(f.flags|=128,g=!0,th(E,!1),f.lanes=4194304)}else{if(!g)if(l=gg(R),l!==null){if(f.flags|=128,g=!0,l=l.updateQueue,f.updateQueue=l,wg(f,l),th(E,!0),E.tail===null&&E.tailMode==="hidden"&&!R.alternate&&!an)return Dn(f),null}else 2*ze()-E.renderingStartTime>Tg&&h!==536870912&&(f.flags|=128,g=!0,th(E,!1),f.lanes=4194304);E.isBackwards?(R.sibling=f.child,f.child=R):(l=E.last,l!==null?l.sibling=R:f.child=R,E.last=R)}return E.tail!==null?(f=E.tail,E.rendering=f,E.tail=f.sibling,E.renderingStartTime=ze(),f.sibling=null,l=ur.current,Q(ur,g?l&1|2:l&1),f):(Dn(f),null);case 22:case 23:return so(f),P0(),g=f.memoizedState!==null,l!==null?l.memoizedState!==null!==g&&(f.flags|=8192):g&&(f.flags|=8192),g?(h&536870912)!==0&&(f.flags&128)===0&&(Dn(f),f.subtreeFlags&6&&(f.flags|=8192)):Dn(f),h=f.updateQueue,h!==null&&wg(f,h.retryQueue),h=null,l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(h=l.memoizedState.cachePool.pool),g=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(g=f.memoizedState.cachePool.pool),g!==h&&(f.flags|=2048),l!==null&&Re(su),null;case 24:return h=null,l!==null&&(h=l.memoizedState.cache),f.memoizedState.cache!==h&&(f.flags|=2048),io(lr),Dn(f),null;case 25:return null;case 30:return null}throw Error(r(156,f.tag))}function KV(l,f){switch(m0(f),f.tag){case 1:return l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 3:return io(lr),X(),l=f.flags,(l&65536)!==0&&(l&128)===0?(f.flags=l&-65537|128,f):null;case 26:case 27:case 5:return F(f),null;case 13:if(so(f),l=f.memoizedState,l!==null&&l.dehydrated!==null){if(f.alternate===null)throw Error(r(340));jd()}return l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 19:return Re(ur),null;case 4:return X(),null;case 10:return io(f.type),null;case 22:case 23:return so(f),P0(),l!==null&&Re(su),l=f.flags,l&65536?(f.flags=l&-65537|128,f):null;case 24:return io(lr),null;case 25:return null;default:return null}}function TN(l,f){switch(m0(f),f.tag){case 3:io(lr),X();break;case 26:case 27:case 5:F(f);break;case 4:X();break;case 13:so(f);break;case 19:Re(ur);break;case 10:io(f.type);break;case 22:case 23:so(f),P0(),l!==null&&Re(su);break;case 24:io(lr)}}function nh(l,f){try{var h=f.updateQueue,g=h!==null?h.lastEffect:null;if(g!==null){var E=g.next;h=E;do{if((h.tag&l)===l){g=void 0;var R=h.create,j=h.inst;g=R(),j.destroy=g}h=h.next}while(h!==E)}}catch(W){En(f,f.return,W)}}function Qo(l,f,h){try{var g=f.updateQueue,E=g!==null?g.lastEffect:null;if(E!==null){var R=E.next;g=R;do{if((g.tag&l)===l){var j=g.inst,W=j.destroy;if(W!==void 0){j.destroy=void 0,E=f;var le=h,Te=W;try{Te()}catch(Ue){En(E,le,Ue)}}}g=g.next}while(g!==R)}}catch(Ue){En(f,f.return,Ue)}}function AN(l){var f=l.updateQueue;if(f!==null){var h=l.stateNode;try{dO(f,h)}catch(g){En(l,l.return,g)}}}function CN(l,f,h){h.props=lu(l.type,l.memoizedProps),h.state=l.memoizedState;try{h.componentWillUnmount()}catch(g){En(l,f,g)}}function rh(l,f){try{var h=l.ref;if(h!==null){switch(l.tag){case 26:case 27:case 5:var g=l.stateNode;break;case 30:g=l.stateNode;break;default:g=l.stateNode}typeof h=="function"?l.refCleanup=h(g):h.current=g}}catch(E){En(l,f,E)}}function Es(l,f){var h=l.ref,g=l.refCleanup;if(h!==null)if(typeof g=="function")try{g()}catch(E){En(l,f,E)}finally{l.refCleanup=null,l=l.alternate,l!=null&&(l.refCleanup=null)}else if(typeof h=="function")try{h(null)}catch(E){En(l,f,E)}else h.current=null}function RN(l){var f=l.type,h=l.memoizedProps,g=l.stateNode;try{e:switch(f){case"button":case"input":case"select":case"textarea":h.autoFocus&&g.focus();break e;case"img":h.src?g.src=h.src:h.srcSet&&(g.srcset=h.srcSet)}}catch(E){En(l,l.return,E)}}function rw(l,f,h){try{var g=l.stateNode;mz(g,l.type,h,f),g[he]=f}catch(E){En(l,l.return,E)}}function IN(l){return l.tag===5||l.tag===3||l.tag===26||l.tag===27&&ol(l.type)||l.tag===4}function iw(l){e:for(;;){for(;l.sibling===null;){if(l.return===null||IN(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==18;){if(l.tag===27&&ol(l.type)||l.flags&2||l.child===null||l.tag===4)continue e;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function aw(l,f,h){var g=l.tag;if(g===5||g===6)l=l.stateNode,f?(h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h).insertBefore(l,f):(f=h.nodeType===9?h.body:h.nodeName==="HTML"?h.ownerDocument.body:h,f.appendChild(l),h=h._reactRootContainer,h!=null||f.onclick!==null||(f.onclick=kg));else if(g!==4&&(g===27&&ol(l.type)&&(h=l.stateNode,f=null),l=l.child,l!==null))for(aw(l,f,h),l=l.sibling;l!==null;)aw(l,f,h),l=l.sibling}function Eg(l,f,h){var g=l.tag;if(g===5||g===6)l=l.stateNode,f?h.insertBefore(l,f):h.appendChild(l);else if(g!==4&&(g===27&&ol(l.type)&&(h=l.stateNode),l=l.child,l!==null))for(Eg(l,f,h),l=l.sibling;l!==null;)Eg(l,f,h),l=l.sibling}function PN(l){var f=l.stateNode,h=l.memoizedProps;try{for(var g=l.type,E=f.attributes;E.length;)f.removeAttributeNode(E[0]);Mr(f,g,h),f[ne]=l,f[he]=h}catch(R){En(l,l.return,R)}}var uo=!1,Kn=!1,sw=!1,xN=typeof WeakSet=="function"?WeakSet:Set,Sr=null;function JV(l,f){if(l=l.containerInfo,xw=Fg,l=Bx(l),i0(l)){if("selectionStart"in l)var h={start:l.selectionStart,end:l.selectionEnd};else e:{h=(h=l.ownerDocument)&&h.defaultView||window;var g=h.getSelection&&h.getSelection();if(g&&g.rangeCount!==0){h=g.anchorNode;var E=g.anchorOffset,R=g.focusNode;g=g.focusOffset;try{h.nodeType,R.nodeType}catch{h=null;break e}var j=0,W=-1,le=-1,Te=0,Ue=0,Fe=l,Pe=null;t:for(;;){for(var Ne;Fe!==h||E!==0&&Fe.nodeType!==3||(W=j+E),Fe!==R||g!==0&&Fe.nodeType!==3||(le=j+g),Fe.nodeType===3&&(j+=Fe.nodeValue.length),(Ne=Fe.firstChild)!==null;)Pe=Fe,Fe=Ne;for(;;){if(Fe===l)break t;if(Pe===h&&++Te===E&&(W=j),Pe===R&&++Ue===g&&(le=j),(Ne=Fe.nextSibling)!==null)break;Fe=Pe,Pe=Fe.parentNode}Fe=Ne}h=W===-1||le===-1?null:{start:W,end:le}}else h=null}h=h||{start:0,end:0}}else h=null;for(Ow={focusedElem:l,selectionRange:h},Fg=!1,Sr=f;Sr!==null;)if(f=Sr,l=f.child,(f.subtreeFlags&1024)!==0&&l!==null)l.return=f,Sr=l;else for(;Sr!==null;){switch(f=Sr,R=f.alternate,l=f.flags,f.tag){case 0:break;case 11:case 15:break;case 1:if((l&1024)!==0&&R!==null){l=void 0,h=f,E=R.memoizedProps,R=R.memoizedState,g=h.stateNode;try{var bt=lu(h.type,E,h.elementType===h.type);l=g.getSnapshotBeforeUpdate(bt,R),g.__reactInternalSnapshotBeforeUpdate=l}catch(yt){En(h,h.return,yt)}}break;case 3:if((l&1024)!==0){if(l=f.stateNode.containerInfo,h=l.nodeType,h===9)Mw(l);else if(h===1)switch(l.nodeName){case"HEAD":case"HTML":case"BODY":Mw(l);break;default:l.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((l&1024)!==0)throw Error(r(163))}if(l=f.sibling,l!==null){l.return=f.return,Sr=l;break}Sr=f.return}}function ON(l,f,h){var g=h.flags;switch(h.tag){case 0:case 11:case 15:el(l,h),g&4&&nh(5,h);break;case 1:if(el(l,h),g&4)if(l=h.stateNode,f===null)try{l.componentDidMount()}catch(j){En(h,h.return,j)}else{var E=lu(h.type,f.memoizedProps);f=f.memoizedState;try{l.componentDidUpdate(E,f,l.__reactInternalSnapshotBeforeUpdate)}catch(j){En(h,h.return,j)}}g&64&&AN(h),g&512&&rh(h,h.return);break;case 3:if(el(l,h),g&64&&(l=h.updateQueue,l!==null)){if(f=null,h.child!==null)switch(h.child.tag){case 27:case 5:f=h.child.stateNode;break;case 1:f=h.child.stateNode}try{dO(l,f)}catch(j){En(h,h.return,j)}}break;case 27:f===null&&g&4&&PN(h);case 26:case 5:el(l,h),f===null&&g&4&&RN(h),g&512&&rh(h,h.return);break;case 12:el(l,h);break;case 13:el(l,h),g&4&&MN(l,h),g&64&&(l=h.memoizedState,l!==null&&(l=l.dehydrated,l!==null&&(h=iz.bind(null,h),Ez(l,h))));break;case 22:if(g=h.memoizedState!==null||uo,!g){f=f!==null&&f.memoizedState!==null||Kn,E=uo;var R=Kn;uo=g,(Kn=f)&&!R?tl(l,h,(h.subtreeFlags&8772)!==0):el(l,h),uo=E,Kn=R}break;case 30:break;default:el(l,h)}}function NN(l){var f=l.alternate;f!==null&&(l.alternate=null,NN(f)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(f=l.stateNode,f!==null&&Ze(f)),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}var xn=null,wi=!1;function co(l,f,h){for(h=h.child;h!==null;)kN(l,f,h),h=h.sibling}function kN(l,f,h){if(rt&&typeof rt.onCommitFiberUnmount=="function")try{rt.onCommitFiberUnmount(We,h)}catch{}switch(h.tag){case 26:Kn||Es(h,f),co(l,f,h),h.memoizedState?h.memoizedState.count--:h.stateNode&&(h=h.stateNode,h.parentNode.removeChild(h));break;case 27:Kn||Es(h,f);var g=xn,E=wi;ol(h.type)&&(xn=h.stateNode,wi=!1),co(l,f,h),dh(h.stateNode),xn=g,wi=E;break;case 5:Kn||Es(h,f);case 6:if(g=xn,E=wi,xn=null,co(l,f,h),xn=g,wi=E,xn!==null)if(wi)try{(xn.nodeType===9?xn.body:xn.nodeName==="HTML"?xn.ownerDocument.body:xn).removeChild(h.stateNode)}catch(R){En(h,f,R)}else try{xn.removeChild(h.stateNode)}catch(R){En(h,f,R)}break;case 18:xn!==null&&(wi?(l=xn,wk(l.nodeType===9?l.body:l.nodeName==="HTML"?l.ownerDocument.body:l,h.stateNode),bh(l)):wk(xn,h.stateNode));break;case 4:g=xn,E=wi,xn=h.stateNode.containerInfo,wi=!0,co(l,f,h),xn=g,wi=E;break;case 0:case 11:case 14:case 15:Kn||Qo(2,h,f),Kn||Qo(4,h,f),co(l,f,h);break;case 1:Kn||(Es(h,f),g=h.stateNode,typeof g.componentWillUnmount=="function"&&CN(h,f,g)),co(l,f,h);break;case 21:co(l,f,h);break;case 22:Kn=(g=Kn)||h.memoizedState!==null,co(l,f,h),Kn=g;break;default:co(l,f,h)}}function MN(l,f){if(f.memoizedState===null&&(l=f.alternate,l!==null&&(l=l.memoizedState,l!==null&&(l=l.dehydrated,l!==null))))try{bh(l)}catch(h){En(f,f.return,h)}}function YV(l){switch(l.tag){case 13:case 19:var f=l.stateNode;return f===null&&(f=l.stateNode=new xN),f;case 22:return l=l.stateNode,f=l._retryCache,f===null&&(f=l._retryCache=new xN),f;default:throw Error(r(435,l.tag))}}function ow(l,f){var h=YV(l);f.forEach(function(g){var E=az.bind(null,l,g);h.has(g)||(h.add(g),g.then(E,E))})}function Wi(l,f){var h=f.deletions;if(h!==null)for(var g=0;g<h.length;g++){var E=h[g],R=l,j=f,W=j;e:for(;W!==null;){switch(W.tag){case 27:if(ol(W.type)){xn=W.stateNode,wi=!1;break e}break;case 5:xn=W.stateNode,wi=!1;break e;case 3:case 4:xn=W.stateNode.containerInfo,wi=!0;break e}W=W.return}if(xn===null)throw Error(r(160));kN(R,j,E),xn=null,wi=!1,R=E.alternate,R!==null&&(R.return=null),E.return=null}if(f.subtreeFlags&13878)for(f=f.child;f!==null;)DN(f,l),f=f.sibling}var za=null;function DN(l,f){var h=l.alternate,g=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:Wi(f,l),Ki(l),g&4&&(Qo(3,l,l.return),nh(3,l),Qo(5,l,l.return));break;case 1:Wi(f,l),Ki(l),g&512&&(Kn||h===null||Es(h,h.return)),g&64&&uo&&(l=l.updateQueue,l!==null&&(g=l.callbacks,g!==null&&(h=l.shared.hiddenCallbacks,l.shared.hiddenCallbacks=h===null?g:h.concat(g))));break;case 26:var E=za;if(Wi(f,l),Ki(l),g&512&&(Kn||h===null||Es(h,h.return)),g&4){var R=h!==null?h.memoizedState:null;if(g=l.memoizedState,h===null)if(g===null)if(l.stateNode===null){e:{g=l.type,h=l.memoizedProps,E=E.ownerDocument||E;t:switch(g){case"title":R=E.getElementsByTagName("title")[0],(!R||R[be]||R[ne]||R.namespaceURI==="http://www.w3.org/2000/svg"||R.hasAttribute("itemprop"))&&(R=E.createElement(g),E.head.insertBefore(R,E.querySelector("head > title"))),Mr(R,g,h),R[ne]=l,pt(R),g=R;break e;case"link":var j=Pk("link","href",E).get(g+(h.href||""));if(j){for(var W=0;W<j.length;W++)if(R=j[W],R.getAttribute("href")===(h.href==null||h.href===""?null:h.href)&&R.getAttribute("rel")===(h.rel==null?null:h.rel)&&R.getAttribute("title")===(h.title==null?null:h.title)&&R.getAttribute("crossorigin")===(h.crossOrigin==null?null:h.crossOrigin)){j.splice(W,1);break t}}R=E.createElement(g),Mr(R,g,h),E.head.appendChild(R);break;case"meta":if(j=Pk("meta","content",E).get(g+(h.content||""))){for(W=0;W<j.length;W++)if(R=j[W],R.getAttribute("content")===(h.content==null?null:""+h.content)&&R.getAttribute("name")===(h.name==null?null:h.name)&&R.getAttribute("property")===(h.property==null?null:h.property)&&R.getAttribute("http-equiv")===(h.httpEquiv==null?null:h.httpEquiv)&&R.getAttribute("charset")===(h.charSet==null?null:h.charSet)){j.splice(W,1);break t}}R=E.createElement(g),Mr(R,g,h),E.head.appendChild(R);break;default:throw Error(r(468,g))}R[ne]=l,pt(R),g=R}l.stateNode=g}else xk(E,l.type,l.stateNode);else l.stateNode=Ik(E,g,l.memoizedProps);else R!==g?(R===null?h.stateNode!==null&&(h=h.stateNode,h.parentNode.removeChild(h)):R.count--,g===null?xk(E,l.type,l.stateNode):Ik(E,g,l.memoizedProps)):g===null&&l.stateNode!==null&&rw(l,l.memoizedProps,h.memoizedProps)}break;case 27:Wi(f,l),Ki(l),g&512&&(Kn||h===null||Es(h,h.return)),h!==null&&g&4&&rw(l,l.memoizedProps,h.memoizedProps);break;case 5:if(Wi(f,l),Ki(l),g&512&&(Kn||h===null||Es(h,h.return)),l.flags&32){E=l.stateNode;try{bc(E,"")}catch(Ne){En(l,l.return,Ne)}}g&4&&l.stateNode!=null&&(E=l.memoizedProps,rw(l,E,h!==null?h.memoizedProps:E)),g&1024&&(sw=!0);break;case 6:if(Wi(f,l),Ki(l),g&4){if(l.stateNode===null)throw Error(r(162));g=l.memoizedProps,h=l.stateNode;try{h.nodeValue=g}catch(Ne){En(l,l.return,Ne)}}break;case 3:if(Lg=null,E=za,za=Dg(f.containerInfo),Wi(f,l),za=E,Ki(l),g&4&&h!==null&&h.memoizedState.isDehydrated)try{bh(f.containerInfo)}catch(Ne){En(l,l.return,Ne)}sw&&(sw=!1,$N(l));break;case 4:g=za,za=Dg(l.stateNode.containerInfo),Wi(f,l),Ki(l),za=g;break;case 12:Wi(f,l),Ki(l);break;case 13:Wi(f,l),Ki(l),l.child.flags&8192&&l.memoizedState!==null!=(h!==null&&h.memoizedState!==null)&&(hw=ze()),g&4&&(g=l.updateQueue,g!==null&&(l.updateQueue=null,ow(l,g)));break;case 22:E=l.memoizedState!==null;var le=h!==null&&h.memoizedState!==null,Te=uo,Ue=Kn;if(uo=Te||E,Kn=Ue||le,Wi(f,l),Kn=Ue,uo=Te,Ki(l),g&8192)e:for(f=l.stateNode,f._visibility=E?f._visibility&-2:f._visibility|1,E&&(h===null||le||uo||Kn||uu(l)),h=null,f=l;;){if(f.tag===5||f.tag===26){if(h===null){le=h=f;try{if(R=le.stateNode,E)j=R.style,typeof j.setProperty=="function"?j.setProperty("display","none","important"):j.display="none";else{W=le.stateNode;var Fe=le.memoizedProps.style,Pe=Fe!=null&&Fe.hasOwnProperty("display")?Fe.display:null;W.style.display=Pe==null||typeof Pe=="boolean"?"":(""+Pe).trim()}}catch(Ne){En(le,le.return,Ne)}}}else if(f.tag===6){if(h===null){le=f;try{le.stateNode.nodeValue=E?"":le.memoizedProps}catch(Ne){En(le,le.return,Ne)}}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===l)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===l)break e;for(;f.sibling===null;){if(f.return===null||f.return===l)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}g&4&&(g=l.updateQueue,g!==null&&(h=g.retryQueue,h!==null&&(g.retryQueue=null,ow(l,h))));break;case 19:Wi(f,l),Ki(l),g&4&&(g=l.updateQueue,g!==null&&(l.updateQueue=null,ow(l,g)));break;case 30:break;case 21:break;default:Wi(f,l),Ki(l)}}function Ki(l){var f=l.flags;if(f&2){try{for(var h,g=l.return;g!==null;){if(IN(g)){h=g;break}g=g.return}if(h==null)throw Error(r(160));switch(h.tag){case 27:var E=h.stateNode,R=iw(l);Eg(l,R,E);break;case 5:var j=h.stateNode;h.flags&32&&(bc(j,""),h.flags&=-33);var W=iw(l);Eg(l,W,j);break;case 3:case 4:var le=h.stateNode.containerInfo,Te=iw(l);aw(l,Te,le);break;default:throw Error(r(161))}}catch(Ue){En(l,l.return,Ue)}l.flags&=-3}f&4096&&(l.flags&=-4097)}function $N(l){if(l.subtreeFlags&1024)for(l=l.child;l!==null;){var f=l;$N(f),f.tag===5&&f.flags&1024&&f.stateNode.reset(),l=l.sibling}}function el(l,f){if(f.subtreeFlags&8772)for(f=f.child;f!==null;)ON(l,f.alternate,f),f=f.sibling}function uu(l){for(l=l.child;l!==null;){var f=l;switch(f.tag){case 0:case 11:case 14:case 15:Qo(4,f,f.return),uu(f);break;case 1:Es(f,f.return);var h=f.stateNode;typeof h.componentWillUnmount=="function"&&CN(f,f.return,h),uu(f);break;case 27:dh(f.stateNode);case 26:case 5:Es(f,f.return),uu(f);break;case 22:f.memoizedState===null&&uu(f);break;case 30:uu(f);break;default:uu(f)}l=l.sibling}}function tl(l,f,h){for(h=h&&(f.subtreeFlags&8772)!==0,f=f.child;f!==null;){var g=f.alternate,E=l,R=f,j=R.flags;switch(R.tag){case 0:case 11:case 15:tl(E,R,h),nh(4,R);break;case 1:if(tl(E,R,h),g=R,E=g.stateNode,typeof E.componentDidMount=="function")try{E.componentDidMount()}catch(Te){En(g,g.return,Te)}if(g=R,E=g.updateQueue,E!==null){var W=g.stateNode;try{var le=E.shared.hiddenCallbacks;if(le!==null)for(E.shared.hiddenCallbacks=null,E=0;E<le.length;E++)fO(le[E],W)}catch(Te){En(g,g.return,Te)}}h&&j&64&&AN(R),rh(R,R.return);break;case 27:PN(R);case 26:case 5:tl(E,R,h),h&&g===null&&j&4&&RN(R),rh(R,R.return);break;case 12:tl(E,R,h);break;case 13:tl(E,R,h),h&&j&4&&MN(E,R);break;case 22:R.memoizedState===null&&tl(E,R,h),rh(R,R.return);break;case 30:break;default:tl(E,R,h)}f=f.sibling}}function lw(l,f){var h=null;l!==null&&l.memoizedState!==null&&l.memoizedState.cachePool!==null&&(h=l.memoizedState.cachePool.pool),l=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(l=f.memoizedState.cachePool.pool),l!==h&&(l!=null&&l.refCount++,h!=null&&qd(h))}function uw(l,f){l=null,f.alternate!==null&&(l=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==l&&(f.refCount++,l!=null&&qd(l))}function Ss(l,f,h,g){if(f.subtreeFlags&10256)for(f=f.child;f!==null;)LN(l,f,h,g),f=f.sibling}function LN(l,f,h,g){var E=f.flags;switch(f.tag){case 0:case 11:case 15:Ss(l,f,h,g),E&2048&&nh(9,f);break;case 1:Ss(l,f,h,g);break;case 3:Ss(l,f,h,g),E&2048&&(l=null,f.alternate!==null&&(l=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==l&&(f.refCount++,l!=null&&qd(l)));break;case 12:if(E&2048){Ss(l,f,h,g),l=f.stateNode;try{var R=f.memoizedProps,j=R.id,W=R.onPostCommit;typeof W=="function"&&W(j,f.alternate===null?"mount":"update",l.passiveEffectDuration,-0)}catch(le){En(f,f.return,le)}}else Ss(l,f,h,g);break;case 13:Ss(l,f,h,g);break;case 23:break;case 22:R=f.stateNode,j=f.alternate,f.memoizedState!==null?R._visibility&2?Ss(l,f,h,g):ih(l,f):R._visibility&2?Ss(l,f,h,g):(R._visibility|=2,jc(l,f,h,g,(f.subtreeFlags&10256)!==0)),E&2048&&lw(j,f);break;case 24:Ss(l,f,h,g),E&2048&&uw(f.alternate,f);break;default:Ss(l,f,h,g)}}function jc(l,f,h,g,E){for(E=E&&(f.subtreeFlags&10256)!==0,f=f.child;f!==null;){var R=l,j=f,W=h,le=g,Te=j.flags;switch(j.tag){case 0:case 11:case 15:jc(R,j,W,le,E),nh(8,j);break;case 23:break;case 22:var Ue=j.stateNode;j.memoizedState!==null?Ue._visibility&2?jc(R,j,W,le,E):ih(R,j):(Ue._visibility|=2,jc(R,j,W,le,E)),E&&Te&2048&&lw(j.alternate,j);break;case 24:jc(R,j,W,le,E),E&&Te&2048&&uw(j.alternate,j);break;default:jc(R,j,W,le,E)}f=f.sibling}}function ih(l,f){if(f.subtreeFlags&10256)for(f=f.child;f!==null;){var h=l,g=f,E=g.flags;switch(g.tag){case 22:ih(h,g),E&2048&&lw(g.alternate,g);break;case 24:ih(h,g),E&2048&&uw(g.alternate,g);break;default:ih(h,g)}f=f.sibling}}var ah=8192;function Fc(l){if(l.subtreeFlags&ah)for(l=l.child;l!==null;)UN(l),l=l.sibling}function UN(l){switch(l.tag){case 26:Fc(l),l.flags&ah&&l.memoizedState!==null&&Dz(za,l.memoizedState,l.memoizedProps);break;case 5:Fc(l);break;case 3:case 4:var f=za;za=Dg(l.stateNode.containerInfo),Fc(l),za=f;break;case 22:l.memoizedState===null&&(f=l.alternate,f!==null&&f.memoizedState!==null?(f=ah,ah=16777216,Fc(l),ah=f):Fc(l));break;default:Fc(l)}}function jN(l){var f=l.alternate;if(f!==null&&(l=f.child,l!==null)){f.child=null;do f=l.sibling,l.sibling=null,l=f;while(l!==null)}}function sh(l){var f=l.deletions;if((l.flags&16)!==0){if(f!==null)for(var h=0;h<f.length;h++){var g=f[h];Sr=g,BN(g,l)}jN(l)}if(l.subtreeFlags&10256)for(l=l.child;l!==null;)FN(l),l=l.sibling}function FN(l){switch(l.tag){case 0:case 11:case 15:sh(l),l.flags&2048&&Qo(9,l,l.return);break;case 3:sh(l);break;case 12:sh(l);break;case 22:var f=l.stateNode;l.memoizedState!==null&&f._visibility&2&&(l.return===null||l.return.tag!==13)?(f._visibility&=-3,Sg(l)):sh(l);break;default:sh(l)}}function Sg(l){var f=l.deletions;if((l.flags&16)!==0){if(f!==null)for(var h=0;h<f.length;h++){var g=f[h];Sr=g,BN(g,l)}jN(l)}for(l=l.child;l!==null;){switch(f=l,f.tag){case 0:case 11:case 15:Qo(8,f,f.return),Sg(f);break;case 22:h=f.stateNode,h._visibility&2&&(h._visibility&=-3,Sg(f));break;default:Sg(f)}l=l.sibling}}function BN(l,f){for(;Sr!==null;){var h=Sr;switch(h.tag){case 0:case 11:case 15:Qo(8,h,f);break;case 23:case 22:if(h.memoizedState!==null&&h.memoizedState.cachePool!==null){var g=h.memoizedState.cachePool.pool;g!=null&&g.refCount++}break;case 24:qd(h.memoizedState.cache)}if(g=h.child,g!==null)g.return=h,Sr=g;else e:for(h=l;Sr!==null;){g=Sr;var E=g.sibling,R=g.return;if(NN(g),g===h){Sr=null;break e}if(E!==null){E.return=R,Sr=E;break e}Sr=R}}}var ZV={getCacheForType:function(l){var f=Wr(lr),h=f.data.get(l);return h===void 0&&(h=l(),f.data.set(l,h)),h}},XV=typeof WeakMap=="function"?WeakMap:Map,fn=0,Cn=null,Vt=null,Yt=0,dn=0,Ji=null,nl=!1,Bc=!1,cw=!1,fo=0,qn=0,rl=0,cu=0,fw=0,ba=0,qc=0,oh=null,Ei=null,dw=!1,hw=0,Tg=1/0,Ag=null,il=null,kr=0,al=null,Vc=null,zc=0,pw=0,mw=null,qN=null,lh=0,gw=null;function Yi(){if((fn&2)!==0&&Yt!==0)return Yt&-Yt;if(te.T!==null){var l=Oc;return l!==0?l:Sw()}return G()}function VN(){ba===0&&(ba=(Yt&536870912)===0||an?tn():536870912);var l=_a.current;return l!==null&&(l.flags|=32),ba}function Zi(l,f,h){(l===Cn&&(dn===2||dn===9)||l.cancelPendingCommit!==null)&&(Hc(l,0),sl(l,Yt,ba,!1)),da(l,h),((fn&2)===0||l!==Cn)&&(l===Cn&&((fn&2)===0&&(cu|=h),qn===4&&sl(l,Yt,ba,!1)),Ts(l))}function zN(l,f,h){if((fn&6)!==0)throw Error(r(327));var g=!h&&(f&124)===0&&(f&l.expiredLanes)===0||ht(l,f),E=g?tz(l,f):_w(l,f,!0),R=g;do{if(E===0){Bc&&!g&&sl(l,f,0,!1);break}else{if(h=l.current.alternate,R&&!QV(h)){E=_w(l,f,!1),R=!1;continue}if(E===2){if(R=f,l.errorRecoveryDisabledLanes&R)var j=0;else j=l.pendingLanes&-536870913,j=j!==0?j:j&536870912?536870912:0;if(j!==0){f=j;e:{var W=l;E=oh;var le=W.current.memoizedState.isDehydrated;if(le&&(Hc(W,j).flags|=256),j=_w(W,j,!1),j!==2){if(cw&&!le){W.errorRecoveryDisabledLanes|=R,cu|=R,E=4;break e}R=Ei,Ei=E,R!==null&&(Ei===null?Ei=R:Ei.push.apply(Ei,R))}E=j}if(R=!1,E!==2)continue}}if(E===1){Hc(l,0),sl(l,f,0,!0);break}e:{switch(g=l,R=E,R){case 0:case 1:throw Error(r(345));case 4:if((f&4194048)!==f)break;case 6:sl(g,f,ba,!nl);break e;case 2:Ei=null;break;case 3:case 5:break;default:throw Error(r(329))}if((f&62914560)===f&&(E=hw+300-ze(),10<E)){if(sl(g,f,ba,!nl),Le(g,0,!0)!==0)break e;g.timeoutHandle=_k(HN.bind(null,g,h,Ei,Ag,dw,f,ba,cu,qc,nl,R,2,-0,0),E);break e}HN(g,h,Ei,Ag,dw,f,ba,cu,qc,nl,R,0,-0,0)}}break}while(!0);Ts(l)}function HN(l,f,h,g,E,R,j,W,le,Te,Ue,Fe,Pe,Ne){if(l.timeoutHandle=-1,Fe=f.subtreeFlags,(Fe&8192||(Fe&16785408)===16785408)&&(mh={stylesheets:null,count:0,unsuspend:Mz},UN(f),Fe=$z(),Fe!==null)){l.cancelPendingCommit=Fe(XN.bind(null,l,f,R,h,g,E,j,W,le,Ue,1,Pe,Ne)),sl(l,R,j,!Te);return}XN(l,f,R,h,g,E,j,W,le)}function QV(l){for(var f=l;;){var h=f.tag;if((h===0||h===11||h===15)&&f.flags&16384&&(h=f.updateQueue,h!==null&&(h=h.stores,h!==null)))for(var g=0;g<h.length;g++){var E=h[g],R=E.getSnapshot;E=E.value;try{if(!Hi(R(),E))return!1}catch{return!1}}if(h=f.child,f.subtreeFlags&16384&&h!==null)h.return=f,f=h;else{if(f===l)break;for(;f.sibling===null;){if(f.return===null||f.return===l)return!0;f=f.return}f.sibling.return=f.return,f=f.sibling}}return!0}function sl(l,f,h,g){f&=~fw,f&=~cu,l.suspendedLanes|=f,l.pingedLanes&=~f,g&&(l.warmLanes|=f),g=l.expirationTimes;for(var E=f;0<E;){var R=31-St(E),j=1<<R;g[R]=-1,E&=~j}h!==0&&qi(l,h,f)}function Cg(){return(fn&6)===0?(uh(0),!1):!0}function yw(){if(Vt!==null){if(dn===0)var l=Vt.return;else l=Vt,ro=iu=null,M0(l),Lc=null,Qd=0,l=Vt;for(;l!==null;)TN(l.alternate,l),l=l.return;Vt=null}}function Hc(l,f){var h=l.timeoutHandle;h!==-1&&(l.timeoutHandle=-1,yz(h)),h=l.cancelPendingCommit,h!==null&&(l.cancelPendingCommit=null,h()),yw(),Cn=l,Vt=h=eo(l.current,null),Yt=f,dn=0,Ji=null,nl=!1,Bc=ht(l,f),cw=!1,qc=ba=fw=cu=rl=qn=0,Ei=oh=null,dw=!1,(f&8)!==0&&(f|=f&32);var g=l.entangledLanes;if(g!==0)for(l=l.entanglements,g&=f;0<g;){var E=31-St(g),R=1<<E;f|=l[E],g&=~R}return fo=f,Km(),h}function GN(l,f){jt=null,te.H=hg,f===zd||f===rg?(f=uO(),dn=3):f===sO?(f=uO(),dn=4):dn=f===cN?8:f!==null&&typeof f=="object"&&typeof f.then=="function"?6:1,Ji=f,Vt===null&&(qn=1,vg(l,ma(f,l.current)))}function WN(){var l=te.H;return te.H=hg,l===null?hg:l}function KN(){var l=te.A;return te.A=ZV,l}function vw(){qn=4,nl||(Yt&4194048)!==Yt&&_a.current!==null||(Bc=!0),(rl&134217727)===0&&(cu&134217727)===0||Cn===null||sl(Cn,Yt,ba,!1)}function _w(l,f,h){var g=fn;fn|=2;var E=WN(),R=KN();(Cn!==l||Yt!==f)&&(Ag=null,Hc(l,f)),f=!1;var j=qn;e:do try{if(dn!==0&&Vt!==null){var W=Vt,le=Ji;switch(dn){case 8:yw(),j=6;break e;case 3:case 2:case 9:case 6:_a.current===null&&(f=!0);var Te=dn;if(dn=0,Ji=null,Gc(l,W,le,Te),h&&Bc){j=0;break e}break;default:Te=dn,dn=0,Ji=null,Gc(l,W,le,Te)}}ez(),j=qn;break}catch(Ue){GN(l,Ue)}while(!0);return f&&l.shellSuspendCounter++,ro=iu=null,fn=g,te.H=E,te.A=R,Vt===null&&(Cn=null,Yt=0,Km()),j}function ez(){for(;Vt!==null;)JN(Vt)}function tz(l,f){var h=fn;fn|=2;var g=WN(),E=KN();Cn!==l||Yt!==f?(Ag=null,Tg=ze()+500,Hc(l,f)):Bc=ht(l,f);e:do try{if(dn!==0&&Vt!==null){f=Vt;var R=Ji;t:switch(dn){case 1:dn=0,Ji=null,Gc(l,f,R,1);break;case 2:case 9:if(oO(R)){dn=0,Ji=null,YN(f);break}f=function(){dn!==2&&dn!==9||Cn!==l||(dn=7),Ts(l)},R.then(f,f);break e;case 3:dn=7;break e;case 4:dn=5;break e;case 7:oO(R)?(dn=0,Ji=null,YN(f)):(dn=0,Ji=null,Gc(l,f,R,7));break;case 5:var j=null;switch(Vt.tag){case 26:j=Vt.memoizedState;case 5:case 27:var W=Vt;if(!j||Ok(j)){dn=0,Ji=null;var le=W.sibling;if(le!==null)Vt=le;else{var Te=W.return;Te!==null?(Vt=Te,Rg(Te)):Vt=null}break t}}dn=0,Ji=null,Gc(l,f,R,5);break;case 6:dn=0,Ji=null,Gc(l,f,R,6);break;case 8:yw(),qn=6;break e;default:throw Error(r(462))}}nz();break}catch(Ue){GN(l,Ue)}while(!0);return ro=iu=null,te.H=g,te.A=E,fn=h,Vt!==null?0:(Cn=null,Yt=0,Km(),qn)}function nz(){for(;Vt!==null&&!Qe();)JN(Vt)}function JN(l){var f=EN(l.alternate,l,fo);l.memoizedProps=l.pendingProps,f===null?Rg(l):Vt=f}function YN(l){var f=l,h=f.alternate;switch(f.tag){case 15:case 0:f=gN(h,f,f.pendingProps,f.type,void 0,Yt);break;case 11:f=gN(h,f,f.pendingProps,f.type.render,f.ref,Yt);break;case 5:M0(f);default:TN(h,f),f=Vt=Zx(f,fo),f=EN(h,f,fo)}l.memoizedProps=l.pendingProps,f===null?Rg(l):Vt=f}function Gc(l,f,h,g){ro=iu=null,M0(f),Lc=null,Qd=0;var E=f.return;try{if(HV(l,E,f,h,Yt)){qn=1,vg(l,ma(h,l.current)),Vt=null;return}}catch(R){if(E!==null)throw Vt=E,R;qn=1,vg(l,ma(h,l.current)),Vt=null;return}f.flags&32768?(an||g===1?l=!0:Bc||(Yt&536870912)!==0?l=!1:(nl=l=!0,(g===2||g===9||g===3||g===6)&&(g=_a.current,g!==null&&g.tag===13&&(g.flags|=16384))),ZN(f,l)):Rg(f)}function Rg(l){var f=l;do{if((f.flags&32768)!==0){ZN(f,nl);return}l=f.return;var h=WV(f.alternate,f,fo);if(h!==null){Vt=h;return}if(f=f.sibling,f!==null){Vt=f;return}Vt=f=l}while(f!==null);qn===0&&(qn=5)}function ZN(l,f){do{var h=KV(l.alternate,l);if(h!==null){h.flags&=32767,Vt=h;return}if(h=l.return,h!==null&&(h.flags|=32768,h.subtreeFlags=0,h.deletions=null),!f&&(l=l.sibling,l!==null)){Vt=l;return}Vt=l=h}while(l!==null);qn=6,Vt=null}function XN(l,f,h,g,E,R,j,W,le){l.cancelPendingCommit=null;do Ig();while(kr!==0);if((fn&6)!==0)throw Error(r(327));if(f!==null){if(f===l.current)throw Error(r(177));if(R=f.lanes|f.childLanes,R|=u0,yi(l,h,R,j,W,le),l===Cn&&(Vt=Cn=null,Yt=0),Vc=f,al=l,zc=h,pw=R,mw=E,qN=g,(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?(l.callbackNode=null,l.callbackPriority=0,sz(It,function(){return rk(),null})):(l.callbackNode=null,l.callbackPriority=0),g=(f.flags&13878)!==0,(f.subtreeFlags&13878)!==0||g){g=te.T,te.T=null,E=oe.p,oe.p=2,j=fn,fn|=4;try{JV(l,f,h)}finally{fn=j,oe.p=E,te.T=g}}kr=1,QN(),ek(),tk()}}function QN(){if(kr===1){kr=0;var l=al,f=Vc,h=(f.flags&13878)!==0;if((f.subtreeFlags&13878)!==0||h){h=te.T,te.T=null;var g=oe.p;oe.p=2;var E=fn;fn|=4;try{DN(f,l);var R=Ow,j=Bx(l.containerInfo),W=R.focusedElem,le=R.selectionRange;if(j!==W&&W&&W.ownerDocument&&Fx(W.ownerDocument.documentElement,W)){if(le!==null&&i0(W)){var Te=le.start,Ue=le.end;if(Ue===void 0&&(Ue=Te),"selectionStart"in W)W.selectionStart=Te,W.selectionEnd=Math.min(Ue,W.value.length);else{var Fe=W.ownerDocument||document,Pe=Fe&&Fe.defaultView||window;if(Pe.getSelection){var Ne=Pe.getSelection(),bt=W.textContent.length,yt=Math.min(le.start,bt),vn=le.end===void 0?yt:Math.min(le.end,bt);!Ne.extend&&yt>vn&&(j=vn,vn=yt,yt=j);var _e=jx(W,yt),me=jx(W,vn);if(_e&&me&&(Ne.rangeCount!==1||Ne.anchorNode!==_e.node||Ne.anchorOffset!==_e.offset||Ne.focusNode!==me.node||Ne.focusOffset!==me.offset)){var Se=Fe.createRange();Se.setStart(_e.node,_e.offset),Ne.removeAllRanges(),yt>vn?(Ne.addRange(Se),Ne.extend(me.node,me.offset)):(Se.setEnd(me.node,me.offset),Ne.addRange(Se))}}}}for(Fe=[],Ne=W;Ne=Ne.parentNode;)Ne.nodeType===1&&Fe.push({element:Ne,left:Ne.scrollLeft,top:Ne.scrollTop});for(typeof W.focus=="function"&&W.focus(),W=0;W<Fe.length;W++){var je=Fe[W];je.element.scrollLeft=je.left,je.element.scrollTop=je.top}}Fg=!!xw,Ow=xw=null}finally{fn=E,oe.p=g,te.T=h}}l.current=f,kr=2}}function ek(){if(kr===2){kr=0;var l=al,f=Vc,h=(f.flags&8772)!==0;if((f.subtreeFlags&8772)!==0||h){h=te.T,te.T=null;var g=oe.p;oe.p=2;var E=fn;fn|=4;try{ON(l,f.alternate,f)}finally{fn=E,oe.p=g,te.T=h}}kr=3}}function tk(){if(kr===4||kr===3){kr=0,$e();var l=al,f=Vc,h=zc,g=qN;(f.subtreeFlags&10256)!==0||(f.flags&10256)!==0?kr=5:(kr=0,Vc=al=null,nk(l,l.pendingLanes));var E=l.pendingLanes;if(E===0&&(il=null),Wl(h),f=f.stateNode,rt&&typeof rt.onCommitFiberRoot=="function")try{rt.onCommitFiberRoot(We,f,void 0,(f.current.flags&128)===128)}catch{}if(g!==null){f=te.T,E=oe.p,oe.p=2,te.T=null;try{for(var R=l.onRecoverableError,j=0;j<g.length;j++){var W=g[j];R(W.value,{componentStack:W.stack})}}finally{te.T=f,oe.p=E}}(zc&3)!==0&&Ig(),Ts(l),E=l.pendingLanes,(h&4194090)!==0&&(E&42)!==0?l===gw?lh++:(lh=0,gw=l):lh=0,uh(0)}}function nk(l,f){(l.pooledCacheLanes&=f)===0&&(f=l.pooledCache,f!=null&&(l.pooledCache=null,qd(f)))}function Ig(l){return QN(),ek(),tk(),rk()}function rk(){if(kr!==5)return!1;var l=al,f=pw;pw=0;var h=Wl(zc),g=te.T,E=oe.p;try{oe.p=32>h?32:h,te.T=null,h=mw,mw=null;var R=al,j=zc;if(kr=0,Vc=al=null,zc=0,(fn&6)!==0)throw Error(r(331));var W=fn;if(fn|=4,FN(R.current),LN(R,R.current,j,h),fn=W,uh(0,!1),rt&&typeof rt.onPostCommitFiberRoot=="function")try{rt.onPostCommitFiberRoot(We,R)}catch{}return!0}finally{oe.p=E,te.T=g,nk(l,f)}}function ik(l,f,h){f=ma(h,f),f=K0(l.stateNode,f,2),l=Jo(l,f,2),l!==null&&(da(l,2),Ts(l))}function En(l,f,h){if(l.tag===3)ik(l,l,h);else for(;f!==null;){if(f.tag===3){ik(f,l,h);break}else if(f.tag===1){var g=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(il===null||!il.has(g))){l=ma(h,l),h=lN(2),g=Jo(f,h,2),g!==null&&(uN(h,g,f,l),da(g,2),Ts(g));break}}f=f.return}}function bw(l,f,h){var g=l.pingCache;if(g===null){g=l.pingCache=new XV;var E=new Set;g.set(f,E)}else E=g.get(f),E===void 0&&(E=new Set,g.set(f,E));E.has(h)||(cw=!0,E.add(h),l=rz.bind(null,l,f,h),f.then(l,l))}function rz(l,f,h){var g=l.pingCache;g!==null&&g.delete(f),l.pingedLanes|=l.suspendedLanes&h,l.warmLanes&=~h,Cn===l&&(Yt&h)===h&&(qn===4||qn===3&&(Yt&62914560)===Yt&&300>ze()-hw?(fn&2)===0&&Hc(l,0):fw|=h,qc===Yt&&(qc=0)),Ts(l)}function ak(l,f){f===0&&(f=un()),l=Rc(l,f),l!==null&&(da(l,f),Ts(l))}function iz(l){var f=l.memoizedState,h=0;f!==null&&(h=f.retryLane),ak(l,h)}function az(l,f){var h=0;switch(l.tag){case 13:var g=l.stateNode,E=l.memoizedState;E!==null&&(h=E.retryLane);break;case 19:g=l.stateNode;break;case 22:g=l.stateNode._retryCache;break;default:throw Error(r(314))}g!==null&&g.delete(f),ak(l,h)}function sz(l,f){return ye(l,f)}var Pg=null,Wc=null,ww=!1,xg=!1,Ew=!1,fu=0;function Ts(l){l!==Wc&&l.next===null&&(Wc===null?Pg=Wc=l:Wc=Wc.next=l),xg=!0,ww||(ww=!0,lz())}function uh(l,f){if(!Ew&&xg){Ew=!0;do for(var h=!1,g=Pg;g!==null;){if(l!==0){var E=g.pendingLanes;if(E===0)var R=0;else{var j=g.suspendedLanes,W=g.pingedLanes;R=(1<<31-St(42|l)+1)-1,R&=E&~(j&~W),R=R&201326741?R&201326741|1:R?R|2:0}R!==0&&(h=!0,uk(g,R))}else R=Yt,R=Le(g,g===Cn?R:0,g.cancelPendingCommit!==null||g.timeoutHandle!==-1),(R&3)===0||ht(g,R)||(h=!0,uk(g,R));g=g.next}while(h);Ew=!1}}function oz(){sk()}function sk(){xg=ww=!1;var l=0;fu!==0&&(gz()&&(l=fu),fu=0);for(var f=ze(),h=null,g=Pg;g!==null;){var E=g.next,R=ok(g,f);R===0?(g.next=null,h===null?Pg=E:h.next=E,E===null&&(Wc=h)):(h=g,(l!==0||(R&3)!==0)&&(xg=!0)),g=E}uh(l)}function ok(l,f){for(var h=l.suspendedLanes,g=l.pingedLanes,E=l.expirationTimes,R=l.pendingLanes&-62914561;0<R;){var j=31-St(R),W=1<<j,le=E[j];le===-1?((W&h)===0||(W&g)!==0)&&(E[j]=sn(W,f)):le<=f&&(l.expiredLanes|=W),R&=~W}if(f=Cn,h=Yt,h=Le(l,l===f?h:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),g=l.callbackNode,h===0||l===f&&(dn===2||dn===9)||l.cancelPendingCommit!==null)return g!==null&&g!==null&&ke(g),l.callbackNode=null,l.callbackPriority=0;if((h&3)===0||ht(l,h)){if(f=h&-h,f===l.callbackPriority)return f;switch(g!==null&&ke(g),Wl(h)){case 2:case 8:h=qe;break;case 32:h=It;break;case 268435456:h=Be;break;default:h=It}return g=lk.bind(null,l),h=ye(h,g),l.callbackPriority=f,l.callbackNode=h,f}return g!==null&&g!==null&&ke(g),l.callbackPriority=2,l.callbackNode=null,2}function lk(l,f){if(kr!==0&&kr!==5)return l.callbackNode=null,l.callbackPriority=0,null;var h=l.callbackNode;if(Ig()&&l.callbackNode!==h)return null;var g=Yt;return g=Le(l,l===Cn?g:0,l.cancelPendingCommit!==null||l.timeoutHandle!==-1),g===0?null:(zN(l,g,f),ok(l,ze()),l.callbackNode!=null&&l.callbackNode===h?lk.bind(null,l):null)}function uk(l,f){if(Ig())return null;zN(l,f,!0)}function lz(){vz(function(){(fn&6)!==0?ye(Oe,oz):sk()})}function Sw(){return fu===0&&(fu=tn()),fu}function ck(l){return l==null||typeof l=="symbol"||typeof l=="boolean"?null:typeof l=="function"?l:Bm(""+l)}function fk(l,f){var h=f.ownerDocument.createElement("input");return h.name=f.name,h.value=f.value,l.id&&h.setAttribute("form",l.id),f.parentNode.insertBefore(h,f),l=new FormData(l),h.parentNode.removeChild(h),l}function uz(l,f,h,g,E){if(f==="submit"&&h&&h.stateNode===E){var R=ck((E[he]||null).action),j=g.submitter;j&&(f=(f=j[he]||null)?ck(f.formAction):j.getAttribute("formAction"),f!==null&&(R=f,j=null));var W=new Hm("action","action",null,g,E);l.push({event:W,listeners:[{instance:null,listener:function(){if(g.defaultPrevented){if(fu!==0){var le=j?fk(E,j):new FormData(E);V0(h,{pending:!0,data:le,method:E.method,action:R},null,le)}}else typeof R=="function"&&(W.preventDefault(),le=j?fk(E,j):new FormData(E),V0(h,{pending:!0,data:le,method:E.method,action:R},R,le))},currentTarget:E}]})}}for(var Tw=0;Tw<l0.length;Tw++){var Aw=l0[Tw],cz=Aw.toLowerCase(),fz=Aw[0].toUpperCase()+Aw.slice(1);Va(cz,"on"+fz)}Va(zx,"onAnimationEnd"),Va(Hx,"onAnimationIteration"),Va(Gx,"onAnimationStart"),Va("dblclick","onDoubleClick"),Va("focusin","onFocus"),Va("focusout","onBlur"),Va(IV,"onTransitionRun"),Va(PV,"onTransitionStart"),Va(xV,"onTransitionCancel"),Va(Wx,"onTransitionEnd"),rn("onMouseEnter",["mouseout","mouseover"]),rn("onMouseLeave",["mouseout","mouseover"]),rn("onPointerEnter",["pointerout","pointerover"]),rn("onPointerLeave",["pointerout","pointerover"]),gt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),gt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),gt("onBeforeInput",["compositionend","keypress","textInput","paste"]),gt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),gt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),gt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ch="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),dz=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(ch));function dk(l,f){f=(f&4)!==0;for(var h=0;h<l.length;h++){var g=l[h],E=g.event;g=g.listeners;e:{var R=void 0;if(f)for(var j=g.length-1;0<=j;j--){var W=g[j],le=W.instance,Te=W.currentTarget;if(W=W.listener,le!==R&&E.isPropagationStopped())break e;R=W,E.currentTarget=Te;try{R(E)}catch(Ue){yg(Ue)}E.currentTarget=null,R=le}else for(j=0;j<g.length;j++){if(W=g[j],le=W.instance,Te=W.currentTarget,W=W.listener,le!==R&&E.isPropagationStopped())break e;R=W,E.currentTarget=Te;try{R(E)}catch(Ue){yg(Ue)}E.currentTarget=null,R=le}}}}function zt(l,f){var h=f[Z];h===void 0&&(h=f[Z]=new Set);var g=l+"__bubble";h.has(g)||(hk(f,l,2,!1),h.add(g))}function Cw(l,f,h){var g=0;f&&(g|=4),hk(h,l,g,f)}var Og="_reactListening"+Math.random().toString(36).slice(2);function Rw(l){if(!l[Og]){l[Og]=!0,cn.forEach(function(h){h!=="selectionchange"&&(dz.has(h)||Cw(h,!1,l),Cw(h,!0,l))});var f=l.nodeType===9?l:l.ownerDocument;f===null||f[Og]||(f[Og]=!0,Cw("selectionchange",!1,f))}}function hk(l,f,h,g){switch(Lk(f)){case 2:var E=jz;break;case 8:E=Fz;break;default:E=Bw}h=E.bind(null,f,h,l),E=void 0,!Jb||f!=="touchstart"&&f!=="touchmove"&&f!=="wheel"||(E=!0),g?E!==void 0?l.addEventListener(f,h,{capture:!0,passive:E}):l.addEventListener(f,h,!0):E!==void 0?l.addEventListener(f,h,{passive:E}):l.addEventListener(f,h,!1)}function Iw(l,f,h,g,E){var R=g;if((f&1)===0&&(f&2)===0&&g!==null)e:for(;;){if(g===null)return;var j=g.tag;if(j===3||j===4){var W=g.stateNode.containerInfo;if(W===E)break;if(j===4)for(j=g.return;j!==null;){var le=j.tag;if((le===3||le===4)&&j.stateNode.containerInfo===E)return;j=j.return}for(;W!==null;){if(j=ut(W),j===null)return;if(le=j.tag,le===5||le===6||le===26||le===27){g=R=j;continue e}W=W.parentNode}}g=g.return}bx(function(){var Te=R,Ue=Wb(h),Fe=[];e:{var Pe=Kx.get(l);if(Pe!==void 0){var Ne=Hm,bt=l;switch(l){case"keypress":if(Vm(h)===0)break e;case"keydown":case"keyup":Ne=sV;break;case"focusin":bt="focus",Ne=Qb;break;case"focusout":bt="blur",Ne=Qb;break;case"beforeblur":case"afterblur":Ne=Qb;break;case"click":if(h.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ne=Sx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ne=K8;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ne=uV;break;case zx:case Hx:case Gx:Ne=Z8;break;case Wx:Ne=fV;break;case"scroll":case"scrollend":Ne=G8;break;case"wheel":Ne=hV;break;case"copy":case"cut":case"paste":Ne=Q8;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ne=Ax;break;case"toggle":case"beforetoggle":Ne=mV}var yt=(f&4)!==0,vn=!yt&&(l==="scroll"||l==="scrollend"),_e=yt?Pe!==null?Pe+"Capture":null:Pe;yt=[];for(var me=Te,Se;me!==null;){var je=me;if(Se=je.stateNode,je=je.tag,je!==5&&je!==26&&je!==27||Se===null||_e===null||(je=Pd(me,_e),je!=null&&yt.push(fh(me,je,Se))),vn)break;me=me.return}0<yt.length&&(Pe=new Ne(Pe,bt,null,h,Ue),Fe.push({event:Pe,listeners:yt}))}}if((f&7)===0){e:{if(Pe=l==="mouseover"||l==="pointerover",Ne=l==="mouseout"||l==="pointerout",Pe&&h!==Gb&&(bt=h.relatedTarget||h.fromElement)&&(ut(bt)||bt[Ie]))break e;if((Ne||Pe)&&(Pe=Ue.window===Ue?Ue:(Pe=Ue.ownerDocument)?Pe.defaultView||Pe.parentWindow:window,Ne?(bt=h.relatedTarget||h.toElement,Ne=Te,bt=bt?ut(bt):null,bt!==null&&(vn=a(bt),yt=bt.tag,bt!==vn||yt!==5&&yt!==27&&yt!==6)&&(bt=null)):(Ne=null,bt=Te),Ne!==bt)){if(yt=Sx,je="onMouseLeave",_e="onMouseEnter",me="mouse",(l==="pointerout"||l==="pointerover")&&(yt=Ax,je="onPointerLeave",_e="onPointerEnter",me="pointer"),vn=Ne==null?Pe:nn(Ne),Se=bt==null?Pe:nn(bt),Pe=new yt(je,me+"leave",Ne,h,Ue),Pe.target=vn,Pe.relatedTarget=Se,je=null,ut(Ue)===Te&&(yt=new yt(_e,me+"enter",bt,h,Ue),yt.target=Se,yt.relatedTarget=vn,je=yt),vn=je,Ne&&bt)t:{for(yt=Ne,_e=bt,me=0,Se=yt;Se;Se=Kc(Se))me++;for(Se=0,je=_e;je;je=Kc(je))Se++;for(;0<me-Se;)yt=Kc(yt),me--;for(;0<Se-me;)_e=Kc(_e),Se--;for(;me--;){if(yt===_e||_e!==null&&yt===_e.alternate)break t;yt=Kc(yt),_e=Kc(_e)}yt=null}else yt=null;Ne!==null&&pk(Fe,Pe,Ne,yt,!1),bt!==null&&vn!==null&&pk(Fe,vn,bt,yt,!0)}}e:{if(Pe=Te?nn(Te):window,Ne=Pe.nodeName&&Pe.nodeName.toLowerCase(),Ne==="select"||Ne==="input"&&Pe.type==="file")var ot=kx;else if(Ox(Pe))if(Mx)ot=AV;else{ot=SV;var Ft=EV}else Ne=Pe.nodeName,!Ne||Ne.toLowerCase()!=="input"||Pe.type!=="checkbox"&&Pe.type!=="radio"?Te&&Hb(Te.elementType)&&(ot=kx):ot=TV;if(ot&&(ot=ot(l,Te))){Nx(Fe,ot,h,Ue);break e}Ft&&Ft(l,Pe,Te),l==="focusout"&&Te&&Pe.type==="number"&&Te.memoizedProps.value!=null&&zb(Pe,"number",Pe.value)}switch(Ft=Te?nn(Te):window,l){case"focusin":(Ox(Ft)||Ft.contentEditable==="true")&&(Tc=Ft,a0=Te,Ld=null);break;case"focusout":Ld=a0=Tc=null;break;case"mousedown":s0=!0;break;case"contextmenu":case"mouseup":case"dragend":s0=!1,qx(Fe,h,Ue);break;case"selectionchange":if(RV)break;case"keydown":case"keyup":qx(Fe,h,Ue)}var ft;if(t0)e:{switch(l){case"compositionstart":var vt="onCompositionStart";break e;case"compositionend":vt="onCompositionEnd";break e;case"compositionupdate":vt="onCompositionUpdate";break e}vt=void 0}else Sc?Px(l,h)&&(vt="onCompositionEnd"):l==="keydown"&&h.keyCode===229&&(vt="onCompositionStart");vt&&(Cx&&h.locale!=="ko"&&(Sc||vt!=="onCompositionStart"?vt==="onCompositionEnd"&&Sc&&(ft=wx()):(Ho=Ue,Yb="value"in Ho?Ho.value:Ho.textContent,Sc=!0)),Ft=Ng(Te,vt),0<Ft.length&&(vt=new Tx(vt,l,null,h,Ue),Fe.push({event:vt,listeners:Ft}),ft?vt.data=ft:(ft=xx(h),ft!==null&&(vt.data=ft)))),(ft=yV?vV(l,h):_V(l,h))&&(vt=Ng(Te,"onBeforeInput"),0<vt.length&&(Ft=new Tx("onBeforeInput","beforeinput",null,h,Ue),Fe.push({event:Ft,listeners:vt}),Ft.data=ft)),uz(Fe,l,Te,h,Ue)}dk(Fe,f)})}function fh(l,f,h){return{instance:l,listener:f,currentTarget:h}}function Ng(l,f){for(var h=f+"Capture",g=[];l!==null;){var E=l,R=E.stateNode;if(E=E.tag,E!==5&&E!==26&&E!==27||R===null||(E=Pd(l,h),E!=null&&g.unshift(fh(l,E,R)),E=Pd(l,f),E!=null&&g.push(fh(l,E,R))),l.tag===3)return g;l=l.return}return[]}function Kc(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5&&l.tag!==27);return l||null}function pk(l,f,h,g,E){for(var R=f._reactName,j=[];h!==null&&h!==g;){var W=h,le=W.alternate,Te=W.stateNode;if(W=W.tag,le!==null&&le===g)break;W!==5&&W!==26&&W!==27||Te===null||(le=Te,E?(Te=Pd(h,R),Te!=null&&j.unshift(fh(h,Te,le))):E||(Te=Pd(h,R),Te!=null&&j.push(fh(h,Te,le)))),h=h.return}j.length!==0&&l.push({event:f,listeners:j})}var hz=/\r\n?/g,pz=/\u0000|\uFFFD/g;function mk(l){return(typeof l=="string"?l:""+l).replace(hz,`
`).replace(pz,"")}function gk(l,f){return f=mk(f),mk(l)===f}function kg(){}function yn(l,f,h,g,E,R){switch(h){case"children":typeof g=="string"?f==="body"||f==="textarea"&&g===""||bc(l,g):(typeof g=="number"||typeof g=="bigint")&&f!=="body"&&bc(l,""+g);break;case"className":qa(l,"class",g);break;case"tabIndex":qa(l,"tabindex",g);break;case"dir":case"role":case"viewBox":case"width":case"height":qa(l,h,g);break;case"style":vx(l,g,R);break;case"data":if(f!=="object"){qa(l,"data",g);break}case"src":case"href":if(g===""&&(f!=="a"||h!=="href")){l.removeAttribute(h);break}if(g==null||typeof g=="function"||typeof g=="symbol"||typeof g=="boolean"){l.removeAttribute(h);break}g=Bm(""+g),l.setAttribute(h,g);break;case"action":case"formAction":if(typeof g=="function"){l.setAttribute(h,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof R=="function"&&(h==="formAction"?(f!=="input"&&yn(l,f,"name",E.name,E,null),yn(l,f,"formEncType",E.formEncType,E,null),yn(l,f,"formMethod",E.formMethod,E,null),yn(l,f,"formTarget",E.formTarget,E,null)):(yn(l,f,"encType",E.encType,E,null),yn(l,f,"method",E.method,E,null),yn(l,f,"target",E.target,E,null)));if(g==null||typeof g=="symbol"||typeof g=="boolean"){l.removeAttribute(h);break}g=Bm(""+g),l.setAttribute(h,g);break;case"onClick":g!=null&&(l.onclick=kg);break;case"onScroll":g!=null&&zt("scroll",l);break;case"onScrollEnd":g!=null&&zt("scrollend",l);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(r(61));if(h=g.__html,h!=null){if(E.children!=null)throw Error(r(60));l.innerHTML=h}}break;case"multiple":l.multiple=g&&typeof g!="function"&&typeof g!="symbol";break;case"muted":l.muted=g&&typeof g!="function"&&typeof g!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(g==null||typeof g=="function"||typeof g=="boolean"||typeof g=="symbol"){l.removeAttribute("xlink:href");break}h=Bm(""+g),l.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",h);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":g!=null&&typeof g!="function"&&typeof g!="symbol"?l.setAttribute(h,""+g):l.removeAttribute(h);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":g&&typeof g!="function"&&typeof g!="symbol"?l.setAttribute(h,""):l.removeAttribute(h);break;case"capture":case"download":g===!0?l.setAttribute(h,""):g!==!1&&g!=null&&typeof g!="function"&&typeof g!="symbol"?l.setAttribute(h,g):l.removeAttribute(h);break;case"cols":case"rows":case"size":case"span":g!=null&&typeof g!="function"&&typeof g!="symbol"&&!isNaN(g)&&1<=g?l.setAttribute(h,g):l.removeAttribute(h);break;case"rowSpan":case"start":g==null||typeof g=="function"||typeof g=="symbol"||isNaN(g)?l.removeAttribute(h):l.setAttribute(h,g);break;case"popover":zt("beforetoggle",l),zt("toggle",l),ii(l,"popover",g);break;case"xlinkActuate":xr(l,"http://www.w3.org/1999/xlink","xlink:actuate",g);break;case"xlinkArcrole":xr(l,"http://www.w3.org/1999/xlink","xlink:arcrole",g);break;case"xlinkRole":xr(l,"http://www.w3.org/1999/xlink","xlink:role",g);break;case"xlinkShow":xr(l,"http://www.w3.org/1999/xlink","xlink:show",g);break;case"xlinkTitle":xr(l,"http://www.w3.org/1999/xlink","xlink:title",g);break;case"xlinkType":xr(l,"http://www.w3.org/1999/xlink","xlink:type",g);break;case"xmlBase":xr(l,"http://www.w3.org/XML/1998/namespace","xml:base",g);break;case"xmlLang":xr(l,"http://www.w3.org/XML/1998/namespace","xml:lang",g);break;case"xmlSpace":xr(l,"http://www.w3.org/XML/1998/namespace","xml:space",g);break;case"is":ii(l,"is",g);break;case"innerText":case"textContent":break;default:(!(2<h.length)||h[0]!=="o"&&h[0]!=="O"||h[1]!=="n"&&h[1]!=="N")&&(h=z8.get(h)||h,ii(l,h,g))}}function Pw(l,f,h,g,E,R){switch(h){case"style":vx(l,g,R);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(r(61));if(h=g.__html,h!=null){if(E.children!=null)throw Error(r(60));l.innerHTML=h}}break;case"children":typeof g=="string"?bc(l,g):(typeof g=="number"||typeof g=="bigint")&&bc(l,""+g);break;case"onScroll":g!=null&&zt("scroll",l);break;case"onScrollEnd":g!=null&&zt("scrollend",l);break;case"onClick":g!=null&&(l.onclick=kg);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Pn.hasOwnProperty(h))e:{if(h[0]==="o"&&h[1]==="n"&&(E=h.endsWith("Capture"),f=h.slice(2,E?h.length-7:void 0),R=l[he]||null,R=R!=null?R[h]:null,typeof R=="function"&&l.removeEventListener(f,R,E),typeof g=="function")){typeof R!="function"&&R!==null&&(h in l?l[h]=null:l.hasAttribute(h)&&l.removeAttribute(h)),l.addEventListener(f,g,E);break e}h in l?l[h]=g:g===!0?l.setAttribute(h,""):ii(l,h,g)}}}function Mr(l,f,h){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":zt("error",l),zt("load",l);var g=!1,E=!1,R;for(R in h)if(h.hasOwnProperty(R)){var j=h[R];if(j!=null)switch(R){case"src":g=!0;break;case"srcSet":E=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(r(137,f));default:yn(l,f,R,j,h,null)}}E&&yn(l,f,"srcSet",h.srcSet,h,null),g&&yn(l,f,"src",h.src,h,null);return;case"input":zt("invalid",l);var W=R=j=E=null,le=null,Te=null;for(g in h)if(h.hasOwnProperty(g)){var Ue=h[g];if(Ue!=null)switch(g){case"name":E=Ue;break;case"type":j=Ue;break;case"checked":le=Ue;break;case"defaultChecked":Te=Ue;break;case"value":R=Ue;break;case"defaultValue":W=Ue;break;case"children":case"dangerouslySetInnerHTML":if(Ue!=null)throw Error(r(137,f));break;default:yn(l,f,g,Ue,h,null)}}px(l,R,W,le,Te,j,E,!1),Jl(l);return;case"select":zt("invalid",l),g=j=R=null;for(E in h)if(h.hasOwnProperty(E)&&(W=h[E],W!=null))switch(E){case"value":R=W;break;case"defaultValue":j=W;break;case"multiple":g=W;default:yn(l,f,E,W,h,null)}f=R,h=j,l.multiple=!!g,f!=null?_c(l,!!g,f,!1):h!=null&&_c(l,!!g,h,!0);return;case"textarea":zt("invalid",l),R=E=g=null;for(j in h)if(h.hasOwnProperty(j)&&(W=h[j],W!=null))switch(j){case"value":g=W;break;case"defaultValue":E=W;break;case"children":R=W;break;case"dangerouslySetInnerHTML":if(W!=null)throw Error(r(91));break;default:yn(l,f,j,W,h,null)}gx(l,g,E,R),Jl(l);return;case"option":for(le in h)if(h.hasOwnProperty(le)&&(g=h[le],g!=null))switch(le){case"selected":l.selected=g&&typeof g!="function"&&typeof g!="symbol";break;default:yn(l,f,le,g,h,null)}return;case"dialog":zt("beforetoggle",l),zt("toggle",l),zt("cancel",l),zt("close",l);break;case"iframe":case"object":zt("load",l);break;case"video":case"audio":for(g=0;g<ch.length;g++)zt(ch[g],l);break;case"image":zt("error",l),zt("load",l);break;case"details":zt("toggle",l);break;case"embed":case"source":case"link":zt("error",l),zt("load",l);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Te in h)if(h.hasOwnProperty(Te)&&(g=h[Te],g!=null))switch(Te){case"children":case"dangerouslySetInnerHTML":throw Error(r(137,f));default:yn(l,f,Te,g,h,null)}return;default:if(Hb(f)){for(Ue in h)h.hasOwnProperty(Ue)&&(g=h[Ue],g!==void 0&&Pw(l,f,Ue,g,h,void 0));return}}for(W in h)h.hasOwnProperty(W)&&(g=h[W],g!=null&&yn(l,f,W,g,h,null))}function mz(l,f,h,g){switch(f){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var E=null,R=null,j=null,W=null,le=null,Te=null,Ue=null;for(Ne in h){var Fe=h[Ne];if(h.hasOwnProperty(Ne)&&Fe!=null)switch(Ne){case"checked":break;case"value":break;case"defaultValue":le=Fe;default:g.hasOwnProperty(Ne)||yn(l,f,Ne,null,g,Fe)}}for(var Pe in g){var Ne=g[Pe];if(Fe=h[Pe],g.hasOwnProperty(Pe)&&(Ne!=null||Fe!=null))switch(Pe){case"type":R=Ne;break;case"name":E=Ne;break;case"checked":Te=Ne;break;case"defaultChecked":Ue=Ne;break;case"value":j=Ne;break;case"defaultValue":W=Ne;break;case"children":case"dangerouslySetInnerHTML":if(Ne!=null)throw Error(r(137,f));break;default:Ne!==Fe&&yn(l,f,Pe,Ne,g,Fe)}}Vb(l,j,W,le,Te,Ue,R,E);return;case"select":Ne=j=W=Pe=null;for(R in h)if(le=h[R],h.hasOwnProperty(R)&&le!=null)switch(R){case"value":break;case"multiple":Ne=le;default:g.hasOwnProperty(R)||yn(l,f,R,null,g,le)}for(E in g)if(R=g[E],le=h[E],g.hasOwnProperty(E)&&(R!=null||le!=null))switch(E){case"value":Pe=R;break;case"defaultValue":W=R;break;case"multiple":j=R;default:R!==le&&yn(l,f,E,R,g,le)}f=W,h=j,g=Ne,Pe!=null?_c(l,!!h,Pe,!1):!!g!=!!h&&(f!=null?_c(l,!!h,f,!0):_c(l,!!h,h?[]:"",!1));return;case"textarea":Ne=Pe=null;for(W in h)if(E=h[W],h.hasOwnProperty(W)&&E!=null&&!g.hasOwnProperty(W))switch(W){case"value":break;case"children":break;default:yn(l,f,W,null,g,E)}for(j in g)if(E=g[j],R=h[j],g.hasOwnProperty(j)&&(E!=null||R!=null))switch(j){case"value":Pe=E;break;case"defaultValue":Ne=E;break;case"children":break;case"dangerouslySetInnerHTML":if(E!=null)throw Error(r(91));break;default:E!==R&&yn(l,f,j,E,g,R)}mx(l,Pe,Ne);return;case"option":for(var bt in h)if(Pe=h[bt],h.hasOwnProperty(bt)&&Pe!=null&&!g.hasOwnProperty(bt))switch(bt){case"selected":l.selected=!1;break;default:yn(l,f,bt,null,g,Pe)}for(le in g)if(Pe=g[le],Ne=h[le],g.hasOwnProperty(le)&&Pe!==Ne&&(Pe!=null||Ne!=null))switch(le){case"selected":l.selected=Pe&&typeof Pe!="function"&&typeof Pe!="symbol";break;default:yn(l,f,le,Pe,g,Ne)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var yt in h)Pe=h[yt],h.hasOwnProperty(yt)&&Pe!=null&&!g.hasOwnProperty(yt)&&yn(l,f,yt,null,g,Pe);for(Te in g)if(Pe=g[Te],Ne=h[Te],g.hasOwnProperty(Te)&&Pe!==Ne&&(Pe!=null||Ne!=null))switch(Te){case"children":case"dangerouslySetInnerHTML":if(Pe!=null)throw Error(r(137,f));break;default:yn(l,f,Te,Pe,g,Ne)}return;default:if(Hb(f)){for(var vn in h)Pe=h[vn],h.hasOwnProperty(vn)&&Pe!==void 0&&!g.hasOwnProperty(vn)&&Pw(l,f,vn,void 0,g,Pe);for(Ue in g)Pe=g[Ue],Ne=h[Ue],!g.hasOwnProperty(Ue)||Pe===Ne||Pe===void 0&&Ne===void 0||Pw(l,f,Ue,Pe,g,Ne);return}}for(var _e in h)Pe=h[_e],h.hasOwnProperty(_e)&&Pe!=null&&!g.hasOwnProperty(_e)&&yn(l,f,_e,null,g,Pe);for(Fe in g)Pe=g[Fe],Ne=h[Fe],!g.hasOwnProperty(Fe)||Pe===Ne||Pe==null&&Ne==null||yn(l,f,Fe,Pe,g,Ne)}var xw=null,Ow=null;function Mg(l){return l.nodeType===9?l:l.ownerDocument}function yk(l){switch(l){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function vk(l,f){if(l===0)switch(f){case"svg":return 1;case"math":return 2;default:return 0}return l===1&&f==="foreignObject"?0:l}function Nw(l,f){return l==="textarea"||l==="noscript"||typeof f.children=="string"||typeof f.children=="number"||typeof f.children=="bigint"||typeof f.dangerouslySetInnerHTML=="object"&&f.dangerouslySetInnerHTML!==null&&f.dangerouslySetInnerHTML.__html!=null}var kw=null;function gz(){var l=window.event;return l&&l.type==="popstate"?l===kw?!1:(kw=l,!0):(kw=null,!1)}var _k=typeof setTimeout=="function"?setTimeout:void 0,yz=typeof clearTimeout=="function"?clearTimeout:void 0,bk=typeof Promise=="function"?Promise:void 0,vz=typeof queueMicrotask=="function"?queueMicrotask:typeof bk<"u"?function(l){return bk.resolve(null).then(l).catch(_z)}:_k;function _z(l){setTimeout(function(){throw l})}function ol(l){return l==="head"}function wk(l,f){var h=f,g=0,E=0;do{var R=h.nextSibling;if(l.removeChild(h),R&&R.nodeType===8)if(h=R.data,h==="/$"){if(0<g&&8>g){h=g;var j=l.ownerDocument;if(h&1&&dh(j.documentElement),h&2&&dh(j.body),h&4)for(h=j.head,dh(h),j=h.firstChild;j;){var W=j.nextSibling,le=j.nodeName;j[be]||le==="SCRIPT"||le==="STYLE"||le==="LINK"&&j.rel.toLowerCase()==="stylesheet"||h.removeChild(j),j=W}}if(E===0){l.removeChild(R),bh(f);return}E--}else h==="$"||h==="$?"||h==="$!"?E++:g=h.charCodeAt(0)-48;else g=0;h=R}while(h);bh(f)}function Mw(l){var f=l.firstChild;for(f&&f.nodeType===10&&(f=f.nextSibling);f;){var h=f;switch(f=f.nextSibling,h.nodeName){case"HTML":case"HEAD":case"BODY":Mw(h),Ze(h);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(h.rel.toLowerCase()==="stylesheet")continue}l.removeChild(h)}}function bz(l,f,h,g){for(;l.nodeType===1;){var E=h;if(l.nodeName.toLowerCase()!==f.toLowerCase()){if(!g&&(l.nodeName!=="INPUT"||l.type!=="hidden"))break}else if(g){if(!l[be])switch(f){case"meta":if(!l.hasAttribute("itemprop"))break;return l;case"link":if(R=l.getAttribute("rel"),R==="stylesheet"&&l.hasAttribute("data-precedence"))break;if(R!==E.rel||l.getAttribute("href")!==(E.href==null||E.href===""?null:E.href)||l.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin)||l.getAttribute("title")!==(E.title==null?null:E.title))break;return l;case"style":if(l.hasAttribute("data-precedence"))break;return l;case"script":if(R=l.getAttribute("src"),(R!==(E.src==null?null:E.src)||l.getAttribute("type")!==(E.type==null?null:E.type)||l.getAttribute("crossorigin")!==(E.crossOrigin==null?null:E.crossOrigin))&&R&&l.hasAttribute("async")&&!l.hasAttribute("itemprop"))break;return l;default:return l}}else if(f==="input"&&l.type==="hidden"){var R=E.name==null?null:""+E.name;if(E.type==="hidden"&&l.getAttribute("name")===R)return l}else return l;if(l=Ha(l.nextSibling),l===null)break}return null}function wz(l,f,h){if(f==="")return null;for(;l.nodeType!==3;)if((l.nodeType!==1||l.nodeName!=="INPUT"||l.type!=="hidden")&&!h||(l=Ha(l.nextSibling),l===null))return null;return l}function Dw(l){return l.data==="$!"||l.data==="$?"&&l.ownerDocument.readyState==="complete"}function Ez(l,f){var h=l.ownerDocument;if(l.data!=="$?"||h.readyState==="complete")f();else{var g=function(){f(),h.removeEventListener("DOMContentLoaded",g)};h.addEventListener("DOMContentLoaded",g),l._reactRetry=g}}function Ha(l){for(;l!=null;l=l.nextSibling){var f=l.nodeType;if(f===1||f===3)break;if(f===8){if(f=l.data,f==="$"||f==="$!"||f==="$?"||f==="F!"||f==="F")break;if(f==="/$")return null}}return l}var $w=null;function Ek(l){l=l.previousSibling;for(var f=0;l;){if(l.nodeType===8){var h=l.data;if(h==="$"||h==="$!"||h==="$?"){if(f===0)return l;f--}else h==="/$"&&f++}l=l.previousSibling}return null}function Sk(l,f,h){switch(f=Mg(h),l){case"html":if(l=f.documentElement,!l)throw Error(r(452));return l;case"head":if(l=f.head,!l)throw Error(r(453));return l;case"body":if(l=f.body,!l)throw Error(r(454));return l;default:throw Error(r(451))}}function dh(l){for(var f=l.attributes;f.length;)l.removeAttributeNode(f[0]);Ze(l)}var wa=new Map,Tk=new Set;function Dg(l){return typeof l.getRootNode=="function"?l.getRootNode():l.nodeType===9?l:l.ownerDocument}var ho=oe.d;oe.d={f:Sz,r:Tz,D:Az,C:Cz,L:Rz,m:Iz,X:xz,S:Pz,M:Oz};function Sz(){var l=ho.f(),f=Cg();return l||f}function Tz(l){var f=Mt(l);f!==null&&f.tag===5&&f.type==="form"?zO(f):ho.r(l)}var Jc=typeof document>"u"?null:document;function Ak(l,f,h){var g=Jc;if(g&&typeof f=="string"&&f){var E=pa(f);E='link[rel="'+l+'"][href="'+E+'"]',typeof h=="string"&&(E+='[crossorigin="'+h+'"]'),Tk.has(E)||(Tk.add(E),l={rel:l,crossOrigin:h,href:f},g.querySelector(E)===null&&(f=g.createElement("link"),Mr(f,"link",l),pt(f),g.head.appendChild(f)))}}function Az(l){ho.D(l),Ak("dns-prefetch",l,null)}function Cz(l,f){ho.C(l,f),Ak("preconnect",l,f)}function Rz(l,f,h){ho.L(l,f,h);var g=Jc;if(g&&l&&f){var E='link[rel="preload"][as="'+pa(f)+'"]';f==="image"&&h&&h.imageSrcSet?(E+='[imagesrcset="'+pa(h.imageSrcSet)+'"]',typeof h.imageSizes=="string"&&(E+='[imagesizes="'+pa(h.imageSizes)+'"]')):E+='[href="'+pa(l)+'"]';var R=E;switch(f){case"style":R=Yc(l);break;case"script":R=Zc(l)}wa.has(R)||(l=d({rel:"preload",href:f==="image"&&h&&h.imageSrcSet?void 0:l,as:f},h),wa.set(R,l),g.querySelector(E)!==null||f==="style"&&g.querySelector(hh(R))||f==="script"&&g.querySelector(ph(R))||(f=g.createElement("link"),Mr(f,"link",l),pt(f),g.head.appendChild(f)))}}function Iz(l,f){ho.m(l,f);var h=Jc;if(h&&l){var g=f&&typeof f.as=="string"?f.as:"script",E='link[rel="modulepreload"][as="'+pa(g)+'"][href="'+pa(l)+'"]',R=E;switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":R=Zc(l)}if(!wa.has(R)&&(l=d({rel:"modulepreload",href:l},f),wa.set(R,l),h.querySelector(E)===null)){switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(h.querySelector(ph(R)))return}g=h.createElement("link"),Mr(g,"link",l),pt(g),h.head.appendChild(g)}}}function Pz(l,f,h){ho.S(l,f,h);var g=Jc;if(g&&l){var E=mn(g).hoistableStyles,R=Yc(l);f=f||"default";var j=E.get(R);if(!j){var W={loading:0,preload:null};if(j=g.querySelector(hh(R)))W.loading=5;else{l=d({rel:"stylesheet",href:l,"data-precedence":f},h),(h=wa.get(R))&&Lw(l,h);var le=j=g.createElement("link");pt(le),Mr(le,"link",l),le._p=new Promise(function(Te,Ue){le.onload=Te,le.onerror=Ue}),le.addEventListener("load",function(){W.loading|=1}),le.addEventListener("error",function(){W.loading|=2}),W.loading|=4,$g(j,f,g)}j={type:"stylesheet",instance:j,count:1,state:W},E.set(R,j)}}}function xz(l,f){ho.X(l,f);var h=Jc;if(h&&l){var g=mn(h).hoistableScripts,E=Zc(l),R=g.get(E);R||(R=h.querySelector(ph(E)),R||(l=d({src:l,async:!0},f),(f=wa.get(E))&&Uw(l,f),R=h.createElement("script"),pt(R),Mr(R,"link",l),h.head.appendChild(R)),R={type:"script",instance:R,count:1,state:null},g.set(E,R))}}function Oz(l,f){ho.M(l,f);var h=Jc;if(h&&l){var g=mn(h).hoistableScripts,E=Zc(l),R=g.get(E);R||(R=h.querySelector(ph(E)),R||(l=d({src:l,async:!0,type:"module"},f),(f=wa.get(E))&&Uw(l,f),R=h.createElement("script"),pt(R),Mr(R,"link",l),h.head.appendChild(R)),R={type:"script",instance:R,count:1,state:null},g.set(E,R))}}function Ck(l,f,h,g){var E=(E=P.current)?Dg(E):null;if(!E)throw Error(r(446));switch(l){case"meta":case"title":return null;case"style":return typeof h.precedence=="string"&&typeof h.href=="string"?(f=Yc(h.href),h=mn(E).hoistableStyles,g=h.get(f),g||(g={type:"style",instance:null,count:0,state:null},h.set(f,g)),g):{type:"void",instance:null,count:0,state:null};case"link":if(h.rel==="stylesheet"&&typeof h.href=="string"&&typeof h.precedence=="string"){l=Yc(h.href);var R=mn(E).hoistableStyles,j=R.get(l);if(j||(E=E.ownerDocument||E,j={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},R.set(l,j),(R=E.querySelector(hh(l)))&&!R._p&&(j.instance=R,j.state.loading=5),wa.has(l)||(h={rel:"preload",as:"style",href:h.href,crossOrigin:h.crossOrigin,integrity:h.integrity,media:h.media,hrefLang:h.hrefLang,referrerPolicy:h.referrerPolicy},wa.set(l,h),R||Nz(E,l,h,j.state))),f&&g===null)throw Error(r(528,""));return j}if(f&&g!==null)throw Error(r(529,""));return null;case"script":return f=h.async,h=h.src,typeof h=="string"&&f&&typeof f!="function"&&typeof f!="symbol"?(f=Zc(h),h=mn(E).hoistableScripts,g=h.get(f),g||(g={type:"script",instance:null,count:0,state:null},h.set(f,g)),g):{type:"void",instance:null,count:0,state:null};default:throw Error(r(444,l))}}function Yc(l){return'href="'+pa(l)+'"'}function hh(l){return'link[rel="stylesheet"]['+l+"]"}function Rk(l){return d({},l,{"data-precedence":l.precedence,precedence:null})}function Nz(l,f,h,g){l.querySelector('link[rel="preload"][as="style"]['+f+"]")?g.loading=1:(f=l.createElement("link"),g.preload=f,f.addEventListener("load",function(){return g.loading|=1}),f.addEventListener("error",function(){return g.loading|=2}),Mr(f,"link",h),pt(f),l.head.appendChild(f))}function Zc(l){return'[src="'+pa(l)+'"]'}function ph(l){return"script[async]"+l}function Ik(l,f,h){if(f.count++,f.instance===null)switch(f.type){case"style":var g=l.querySelector('style[data-href~="'+pa(h.href)+'"]');if(g)return f.instance=g,pt(g),g;var E=d({},h,{"data-href":h.href,"data-precedence":h.precedence,href:null,precedence:null});return g=(l.ownerDocument||l).createElement("style"),pt(g),Mr(g,"style",E),$g(g,h.precedence,l),f.instance=g;case"stylesheet":E=Yc(h.href);var R=l.querySelector(hh(E));if(R)return f.state.loading|=4,f.instance=R,pt(R),R;g=Rk(h),(E=wa.get(E))&&Lw(g,E),R=(l.ownerDocument||l).createElement("link"),pt(R);var j=R;return j._p=new Promise(function(W,le){j.onload=W,j.onerror=le}),Mr(R,"link",g),f.state.loading|=4,$g(R,h.precedence,l),f.instance=R;case"script":return R=Zc(h.src),(E=l.querySelector(ph(R)))?(f.instance=E,pt(E),E):(g=h,(E=wa.get(R))&&(g=d({},h),Uw(g,E)),l=l.ownerDocument||l,E=l.createElement("script"),pt(E),Mr(E,"link",g),l.head.appendChild(E),f.instance=E);case"void":return null;default:throw Error(r(443,f.type))}else f.type==="stylesheet"&&(f.state.loading&4)===0&&(g=f.instance,f.state.loading|=4,$g(g,h.precedence,l));return f.instance}function $g(l,f,h){for(var g=h.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),E=g.length?g[g.length-1]:null,R=E,j=0;j<g.length;j++){var W=g[j];if(W.dataset.precedence===f)R=W;else if(R!==E)break}R?R.parentNode.insertBefore(l,R.nextSibling):(f=h.nodeType===9?h.head:h,f.insertBefore(l,f.firstChild))}function Lw(l,f){l.crossOrigin==null&&(l.crossOrigin=f.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=f.referrerPolicy),l.title==null&&(l.title=f.title)}function Uw(l,f){l.crossOrigin==null&&(l.crossOrigin=f.crossOrigin),l.referrerPolicy==null&&(l.referrerPolicy=f.referrerPolicy),l.integrity==null&&(l.integrity=f.integrity)}var Lg=null;function Pk(l,f,h){if(Lg===null){var g=new Map,E=Lg=new Map;E.set(h,g)}else E=Lg,g=E.get(h),g||(g=new Map,E.set(h,g));if(g.has(l))return g;for(g.set(l,null),h=h.getElementsByTagName(l),E=0;E<h.length;E++){var R=h[E];if(!(R[be]||R[ne]||l==="link"&&R.getAttribute("rel")==="stylesheet")&&R.namespaceURI!=="http://www.w3.org/2000/svg"){var j=R.getAttribute(f)||"";j=l+j;var W=g.get(j);W?W.push(R):g.set(j,[R])}}return g}function xk(l,f,h){l=l.ownerDocument||l,l.head.insertBefore(h,f==="title"?l.querySelector("head > title"):null)}function kz(l,f,h){if(h===1||f.itemProp!=null)return!1;switch(l){case"meta":case"title":return!0;case"style":if(typeof f.precedence!="string"||typeof f.href!="string"||f.href==="")break;return!0;case"link":if(typeof f.rel!="string"||typeof f.href!="string"||f.href===""||f.onLoad||f.onError)break;switch(f.rel){case"stylesheet":return l=f.disabled,typeof f.precedence=="string"&&l==null;default:return!0}case"script":if(f.async&&typeof f.async!="function"&&typeof f.async!="symbol"&&!f.onLoad&&!f.onError&&f.src&&typeof f.src=="string")return!0}return!1}function Ok(l){return!(l.type==="stylesheet"&&(l.state.loading&3)===0)}var mh=null;function Mz(){}function Dz(l,f,h){if(mh===null)throw Error(r(475));var g=mh;if(f.type==="stylesheet"&&(typeof h.media!="string"||matchMedia(h.media).matches!==!1)&&(f.state.loading&4)===0){if(f.instance===null){var E=Yc(h.href),R=l.querySelector(hh(E));if(R){l=R._p,l!==null&&typeof l=="object"&&typeof l.then=="function"&&(g.count++,g=Ug.bind(g),l.then(g,g)),f.state.loading|=4,f.instance=R,pt(R);return}R=l.ownerDocument||l,h=Rk(h),(E=wa.get(E))&&Lw(h,E),R=R.createElement("link"),pt(R);var j=R;j._p=new Promise(function(W,le){j.onload=W,j.onerror=le}),Mr(R,"link",h),f.instance=R}g.stylesheets===null&&(g.stylesheets=new Map),g.stylesheets.set(f,l),(l=f.state.preload)&&(f.state.loading&3)===0&&(g.count++,f=Ug.bind(g),l.addEventListener("load",f),l.addEventListener("error",f))}}function $z(){if(mh===null)throw Error(r(475));var l=mh;return l.stylesheets&&l.count===0&&jw(l,l.stylesheets),0<l.count?function(f){var h=setTimeout(function(){if(l.stylesheets&&jw(l,l.stylesheets),l.unsuspend){var g=l.unsuspend;l.unsuspend=null,g()}},6e4);return l.unsuspend=f,function(){l.unsuspend=null,clearTimeout(h)}}:null}function Ug(){if(this.count--,this.count===0){if(this.stylesheets)jw(this,this.stylesheets);else if(this.unsuspend){var l=this.unsuspend;this.unsuspend=null,l()}}}var jg=null;function jw(l,f){l.stylesheets=null,l.unsuspend!==null&&(l.count++,jg=new Map,f.forEach(Lz,l),jg=null,Ug.call(l))}function Lz(l,f){if(!(f.state.loading&4)){var h=jg.get(l);if(h)var g=h.get(null);else{h=new Map,jg.set(l,h);for(var E=l.querySelectorAll("link[data-precedence],style[data-precedence]"),R=0;R<E.length;R++){var j=E[R];(j.nodeName==="LINK"||j.getAttribute("media")!=="not all")&&(h.set(j.dataset.precedence,j),g=j)}g&&h.set(null,g)}E=f.instance,j=E.getAttribute("data-precedence"),R=h.get(j)||g,R===g&&h.set(null,E),h.set(j,E),this.count++,g=Ug.bind(this),E.addEventListener("load",g),E.addEventListener("error",g),R?R.parentNode.insertBefore(E,R.nextSibling):(l=l.nodeType===9?l.head:l,l.insertBefore(E,l.firstChild)),f.state.loading|=4}}var gh={$$typeof:A,Provider:null,Consumer:null,_currentValue:ge,_currentValue2:ge,_threadCount:0};function Uz(l,f,h,g,E,R,j,W){this.tag=1,this.containerInfo=l,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Kt(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Kt(0),this.hiddenUpdates=Kt(null),this.identifierPrefix=g,this.onUncaughtError=E,this.onCaughtError=R,this.onRecoverableError=j,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=W,this.incompleteTransitions=new Map}function Nk(l,f,h,g,E,R,j,W,le,Te,Ue,Fe){return l=new Uz(l,f,h,j,W,le,Te,Fe),f=1,R===!0&&(f|=24),R=Gi(3,null,null,f),l.current=R,R.stateNode=l,f=b0(),f.refCount++,l.pooledCache=f,f.refCount++,R.memoizedState={element:g,isDehydrated:h,cache:f},T0(R),l}function kk(l){return l?(l=Ic,l):Ic}function Mk(l,f,h,g,E,R){E=kk(E),g.context===null?g.context=E:g.pendingContext=E,g=Ko(f),g.payload={element:h},R=R===void 0?null:R,R!==null&&(g.callback=R),h=Jo(l,g,f),h!==null&&(Zi(h,l,f),Gd(h,l,f))}function Dk(l,f){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var h=l.retryLane;l.retryLane=h!==0&&h<f?h:f}}function Fw(l,f){Dk(l,f),(l=l.alternate)&&Dk(l,f)}function $k(l){if(l.tag===13){var f=Rc(l,67108864);f!==null&&Zi(f,l,67108864),Fw(l,67108864)}}var Fg=!0;function jz(l,f,h,g){var E=te.T;te.T=null;var R=oe.p;try{oe.p=2,Bw(l,f,h,g)}finally{oe.p=R,te.T=E}}function Fz(l,f,h,g){var E=te.T;te.T=null;var R=oe.p;try{oe.p=8,Bw(l,f,h,g)}finally{oe.p=R,te.T=E}}function Bw(l,f,h,g){if(Fg){var E=qw(g);if(E===null)Iw(l,f,g,Bg,h),Uk(l,g);else if(qz(E,l,f,h,g))g.stopPropagation();else if(Uk(l,g),f&4&&-1<Bz.indexOf(l)){for(;E!==null;){var R=Mt(E);if(R!==null)switch(R.tag){case 3:if(R=R.stateNode,R.current.memoizedState.isDehydrated){var j=Ce(R.pendingLanes);if(j!==0){var W=R;for(W.pendingLanes|=2,W.entangledLanes|=2;j;){var le=1<<31-St(j);W.entanglements[1]|=le,j&=~le}Ts(R),(fn&6)===0&&(Tg=ze()+500,uh(0))}}break;case 13:W=Rc(R,2),W!==null&&Zi(W,R,2),Cg(),Fw(R,2)}if(R=qw(g),R===null&&Iw(l,f,g,Bg,h),R===E)break;E=R}E!==null&&g.stopPropagation()}else Iw(l,f,g,null,h)}}function qw(l){return l=Wb(l),Vw(l)}var Bg=null;function Vw(l){if(Bg=null,l=ut(l),l!==null){var f=a(l);if(f===null)l=null;else{var h=f.tag;if(h===13){if(l=s(f),l!==null)return l;l=null}else if(h===3){if(f.stateNode.current.memoizedState.isDehydrated)return f.tag===3?f.stateNode.containerInfo:null;l=null}else f!==l&&(l=null)}}return Bg=l,null}function Lk(l){switch(l){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(xt()){case Oe:return 2;case qe:return 8;case It:case Ve:return 32;case Be:return 268435456;default:return 32}default:return 32}}var zw=!1,ll=null,ul=null,cl=null,yh=new Map,vh=new Map,fl=[],Bz="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Uk(l,f){switch(l){case"focusin":case"focusout":ll=null;break;case"dragenter":case"dragleave":ul=null;break;case"mouseover":case"mouseout":cl=null;break;case"pointerover":case"pointerout":yh.delete(f.pointerId);break;case"gotpointercapture":case"lostpointercapture":vh.delete(f.pointerId)}}function _h(l,f,h,g,E,R){return l===null||l.nativeEvent!==R?(l={blockedOn:f,domEventName:h,eventSystemFlags:g,nativeEvent:R,targetContainers:[E]},f!==null&&(f=Mt(f),f!==null&&$k(f)),l):(l.eventSystemFlags|=g,f=l.targetContainers,E!==null&&f.indexOf(E)===-1&&f.push(E),l)}function qz(l,f,h,g,E){switch(f){case"focusin":return ll=_h(ll,l,f,h,g,E),!0;case"dragenter":return ul=_h(ul,l,f,h,g,E),!0;case"mouseover":return cl=_h(cl,l,f,h,g,E),!0;case"pointerover":var R=E.pointerId;return yh.set(R,_h(yh.get(R)||null,l,f,h,g,E)),!0;case"gotpointercapture":return R=E.pointerId,vh.set(R,_h(vh.get(R)||null,l,f,h,g,E)),!0}return!1}function jk(l){var f=ut(l.target);if(f!==null){var h=a(f);if(h!==null){if(f=h.tag,f===13){if(f=s(h),f!==null){l.blockedOn=f,M(l.priority,function(){if(h.tag===13){var g=Yi();g=ri(g);var E=Rc(h,g);E!==null&&Zi(E,h,g),Fw(h,g)}});return}}else if(f===3&&h.stateNode.current.memoizedState.isDehydrated){l.blockedOn=h.tag===3?h.stateNode.containerInfo:null;return}}}l.blockedOn=null}function qg(l){if(l.blockedOn!==null)return!1;for(var f=l.targetContainers;0<f.length;){var h=qw(l.nativeEvent);if(h===null){h=l.nativeEvent;var g=new h.constructor(h.type,h);Gb=g,h.target.dispatchEvent(g),Gb=null}else return f=Mt(h),f!==null&&$k(f),l.blockedOn=h,!1;f.shift()}return!0}function Fk(l,f,h){qg(l)&&h.delete(f)}function Vz(){zw=!1,ll!==null&&qg(ll)&&(ll=null),ul!==null&&qg(ul)&&(ul=null),cl!==null&&qg(cl)&&(cl=null),yh.forEach(Fk),vh.forEach(Fk)}function Vg(l,f){l.blockedOn===f&&(l.blockedOn=null,zw||(zw=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,Vz)))}var zg=null;function Bk(l){zg!==l&&(zg=l,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){zg===l&&(zg=null);for(var f=0;f<l.length;f+=3){var h=l[f],g=l[f+1],E=l[f+2];if(typeof g!="function"){if(Vw(g||h)===null)continue;break}var R=Mt(h);R!==null&&(l.splice(f,3),f-=3,V0(R,{pending:!0,data:E,method:h.method,action:g},g,E))}}))}function bh(l){function f(le){return Vg(le,l)}ll!==null&&Vg(ll,l),ul!==null&&Vg(ul,l),cl!==null&&Vg(cl,l),yh.forEach(f),vh.forEach(f);for(var h=0;h<fl.length;h++){var g=fl[h];g.blockedOn===l&&(g.blockedOn=null)}for(;0<fl.length&&(h=fl[0],h.blockedOn===null);)jk(h),h.blockedOn===null&&fl.shift();if(h=(l.ownerDocument||l).$$reactFormReplay,h!=null)for(g=0;g<h.length;g+=3){var E=h[g],R=h[g+1],j=E[he]||null;if(typeof R=="function")j||Bk(h);else if(j){var W=null;if(R&&R.hasAttribute("formAction")){if(E=R,j=R[he]||null)W=j.formAction;else if(Vw(E)!==null)continue}else W=j.action;typeof W=="function"?h[g+1]=W:(h.splice(g,3),g-=3),Bk(h)}}}function Hw(l){this._internalRoot=l}Hg.prototype.render=Hw.prototype.render=function(l){var f=this._internalRoot;if(f===null)throw Error(r(409));var h=f.current,g=Yi();Mk(h,g,l,f,null,null)},Hg.prototype.unmount=Hw.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var f=l.containerInfo;Mk(l.current,2,null,l,null,null),Cg(),f[Ie]=null}};function Hg(l){this._internalRoot=l}Hg.prototype.unstable_scheduleHydration=function(l){if(l){var f=G();l={blockedOn:null,target:l,priority:f};for(var h=0;h<fl.length&&f!==0&&f<fl[h].priority;h++);fl.splice(h,0,l),h===0&&jk(l)}};var qk=e.version;if(qk!=="19.1.0")throw Error(r(527,qk,"19.1.0"));oe.findDOMNode=function(l){var f=l._reactInternals;if(f===void 0)throw typeof l.render=="function"?Error(r(188)):(l=Object.keys(l).join(","),Error(r(268,l)));return l=u(f),l=l!==null?c(l):null,l=l===null?null:l.stateNode,l};var zz={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:te,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Gg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Gg.isDisabled&&Gg.supportsFiber)try{We=Gg.inject(zz),rt=Gg}catch{}}return Eh.createRoot=function(l,f){if(!i(l))throw Error(r(299));var h=!1,g="",E=iN,R=aN,j=sN,W=null;return f!=null&&(f.unstable_strictMode===!0&&(h=!0),f.identifierPrefix!==void 0&&(g=f.identifierPrefix),f.onUncaughtError!==void 0&&(E=f.onUncaughtError),f.onCaughtError!==void 0&&(R=f.onCaughtError),f.onRecoverableError!==void 0&&(j=f.onRecoverableError),f.unstable_transitionCallbacks!==void 0&&(W=f.unstable_transitionCallbacks)),f=Nk(l,1,!1,null,null,h,g,E,R,j,W,null),l[Ie]=f.current,Rw(l),new Hw(f)},Eh.hydrateRoot=function(l,f,h){if(!i(l))throw Error(r(299));var g=!1,E="",R=iN,j=aN,W=sN,le=null,Te=null;return h!=null&&(h.unstable_strictMode===!0&&(g=!0),h.identifierPrefix!==void 0&&(E=h.identifierPrefix),h.onUncaughtError!==void 0&&(R=h.onUncaughtError),h.onCaughtError!==void 0&&(j=h.onCaughtError),h.onRecoverableError!==void 0&&(W=h.onRecoverableError),h.unstable_transitionCallbacks!==void 0&&(le=h.unstable_transitionCallbacks),h.formState!==void 0&&(Te=h.formState)),f=Nk(l,1,!0,f,h??null,g,E,R,j,W,le,Te),f.context=kk(null),h=f.current,g=Yi(),g=ri(g),E=Ko(g),E.callback=null,Jo(h,E,g),h=g,f.current.lanes=h,da(f,h),Ts(f),l[Ie]=f.current,Rw(l),new Hg(f)},Eh.version="19.1.0",Eh}var Xk;function lH(){if(Xk)return Kw.exports;Xk=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),Kw.exports=oH(),Kw.exports}var uH=lH();const cH=Js(uH),fH={apiKey:"YOUR_FIREBASE_API_KEY",authDomain:"YOUR_FIREBASE_AUTH_DOMAIN",projectId:"YOUR_FIREBASE_PROJECT_ID",storageBucket:"YOUR_FIREBASE_STORAGE_BUCKET",messagingSenderId:"YOUR_FIREBASE_MESSAGING_SENDER_ID",appId:"YOUR_FIREBASE_APP_ID"},PF="gemini-2.5-flash-preview-04-17",Uf=({className:n})=>Ae.jsxs("svg",{className:`animate-spin -ml-1 mr-3 h-5 w-5 ${n||"text-white"}`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[Ae.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),Ae.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),xF=({className:n})=>Ae.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-6 h-6 ${n}`,children:Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 5.25a3 3 0 013 3m3 0a6 6 0 01-7.029 5.912c-.563-.097-1.159.026-1.563.43L10.5 17.25H8.25v2.25H6v2.25H2.25v-2.818c0-.597.237-1.17.659-1.591l6.499-6.499c.404-.404.527-1 .43-1.563A6 6 0 1121.75 8.25z"})}),Qk=({className:n})=>Ae.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-6 h-6 ${n}`,children:Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 17.25v-.228a4.5 4.5 0 00-.12-1.03l-2.268-9.64a3.375 3.375 0 00-3.285-2.602H7.923a3.375 3.375 0 00-3.285 2.602l-2.268 9.64a4.5 4.5 0 00-.12 1.03v.228m19.5 0a3 3 0 01-3 3H5.25a3 3 0 01-3-3m19.5 0a3 3 0 00-3-3H5.25a3 3 0 00-3 3m16.5 0h.008v.008h-.008v-.008zm-3 0h.008v.008h-.008v-.008zm-3 0h.008v.008h-.008v-.008zm-3 0h.008v.008h-.008v-.008z"})}),dH=({className:n})=>Ae.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-6 h-6 ${n}`,children:Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15m3 0l3-3m0 0l-3-3m3 3H9"})}),OF=({className:n})=>Ae.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-5 h-5 ${n}`,children:Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),hH=({className:n})=>Ae.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-5 h-5 ${n}`,children:Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.75 9.75l4.5 4.5m0-4.5l-4.5 4.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),pH=({className:n})=>Ae.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-5 h-5 ${n}`,children:Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12.56 0c1.153 0 2.24.032 3.22.094M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),mH=({className:n})=>Ae.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-6 h-6 ${n}`,children:Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m3-3H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"})}),NF=({className:n})=>Ae.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-5 h-5 ${n}`,children:[Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 21v-1.5M12 3v1.5m0 15v1.5m3.75-18v1.5M19.5 8.25h-1.5m-2.25 3.75h-1.5m-3.75 0h-1.5m1.5-3.75H12m2.25 0h1.5M12 12v1.5m0 3.75v1.5M15.75 3v1.5m0 15v1.5"}),Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.75A5.25 5.25 0 006.75 12a5.25 5.25 0 005.25 5.25a5.25 5.25 0 005.25-5.25A5.25 5.25 0 0012 6.75z"})]}),kF=({className:n})=>Ae.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-5 h-5 ${n}`,children:Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"})}),MF=({className:n})=>Ae.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-5 h-5 ${n}`,children:Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L1.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.25 12L17 14.188l-1.25-2.188a2.25 2.25 0 00-1.546-1.546L12 9.25l2.188-1.25a2.25 2.25 0 001.546-1.546L17 4.25l1.25 2.188a2.25 2.25 0 001.546 1.546L21.75 9.25l-2.188 1.25a2.25 2.25 0 00-1.546 1.546z"})}),BC=({className:n})=>Ae.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:`w-5 h-5 ${n}`,children:[Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 21v-1.5M12 3v1.5m0 15v1.5m3.75-18v1.5M19.5 8.25h-1.5m-2.25 3.75h-1.5m-3.75 0h-1.5m1.5-3.75H12m2.25 0h1.5M12 12v1.5m0 3.75v1.5M15.75 3v1.5m0 15v1.5"}),Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6.75A5.25 5.25 0 006.75 12a5.25 5.25 0 005.25 5.25a5.25 5.25 0 005.25-5.25A5.25 5.25 0 0012 6.75z"})]}),gH=({user:n,signOut:e})=>Ae.jsx("header",{className:"bg-gray-800 shadow-lg p-4 sticky top-0 z-50",children:Ae.jsxs("div",{className:"container mx-auto flex justify-between items-center",children:[Ae.jsx("h1",{className:"text-2xl font-bold text-sky-400",children:"MCP LLM Client"}),n&&Ae.jsxs("div",{className:"flex items-center space-x-4",children:[Ae.jsx("span",{className:"text-gray-300 text-sm hidden sm:block",children:n.email||n.displayName||"Authenticated User"}),Ae.jsxs("button",{onClick:e,className:"flex items-center bg-red-500 hover:bg-red-600 text-white font-semibold py-2 px-4 rounded-lg transition duration-150 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-red-400 focus:ring-opacity-75","aria-label":"Logout",children:[Ae.jsx(dH,{className:"mr-2"}),"Logout"]})]})]})}),yH=()=>{const n=new Date().getFullYear();return Ae.jsxs("footer",{className:"bg-gray-800 text-gray-400 text-center p-6 mt-auto shadow-inner",children:[Ae.jsxs("p",{children:["© ",n," MCP LLM Client. All rights reserved."]}),Ae.jsx("p",{className:"text-xs mt-1",children:"This is a demonstration application. Handle API keys with care."})]})},vH=({apiKeys:n,onApiKeysChange:e,activeLLMProvider:t,onLLMProviderChange:r,keysLoadedFromStorage:i})=>{var S;const[a,s]=_t.useState(!1),[o,u]=_t.useState(!1),[c,d]=_t.useState(!1),[p,m]=_t.useState(i);_t.useEffect(()=>{m(i)},[i]);const y=T=>{const{name:C,value:A}=T.target;e({...n,[C]:A})},b=({id:T,label:C,show:A,setShow:I})=>Ae.jsxs("div",{className:"mb-6",children:[Ae.jsx("label",{htmlFor:T,className:"block text-sm font-medium text-gray-300 mb-1",children:C}),Ae.jsxs("div",{className:"relative",children:[Ae.jsx("input",{type:A?"text":"password",id:T,name:T,value:n[T]||"",onChange:y,className:"w-full px-4 py-2.5 bg-gray-700 border border-gray-600 rounded-lg text-gray-200 focus:ring-2 focus:ring-sky-500 focus:border-sky-500 transition-colors",placeholder:`Enter your ${C}`,autoComplete:A?"off":"current-password"}),Ae.jsx("button",{type:"button",onClick:()=>I(!A),className:"absolute inset-y-0 right-0 px-3 flex items-center text-gray-400 hover:text-sky-400","aria-label":A?"Hide key":"Show key",children:A?Ae.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.242 4.242L9.88 9.88"})}):Ae.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:[Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z"}),Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]})})]})]}),w=[{id:"gemini",label:"Gemini",Icon:MF},{id:"openai",label:"OpenAI",Icon:NF},{id:"claude",label:"Claude",Icon:kF}];return Ae.jsxs("div",{className:"p-6 bg-gray-800 rounded-xl shadow-xl",children:[Ae.jsxs("h2",{className:"text-2xl font-semibold text-sky-400 mb-6 flex items-center",children:[Ae.jsx(xF,{className:"mr-3 text-sky-400"})," API Key Management"]}),p&&Ae.jsxs("div",{className:"mb-4 p-3 bg-green-800/50 border border-green-700 rounded-lg text-green-300 text-sm flex justify-between items-center",role:"alert",children:[Ae.jsxs("div",{className:"flex items-center",children:[Ae.jsx(OF,{className:"w-5 h-5 mr-2 text-green-400"}),"Previously saved API keys have been loaded from your browser."]}),Ae.jsx("button",{onClick:()=>m(!1),className:"text-green-300 hover:text-green-100","aria-label":"Dismiss message",children:Ae.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-4 h-4",children:Ae.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18L18 6M6 6l12 12"})})})]}),Ae.jsxs("div",{className:"space-y-4 mb-8",children:[Ae.jsx(b,{id:"openai",label:"OpenAI API Key",show:a,setShow:s}),Ae.jsx(b,{id:"claude",label:"Claude API Key",show:o,setShow:u}),Ae.jsx(b,{id:"gemini",label:"Gemini API Key (User-provided)",show:c,setShow:d})]}),Ae.jsxs("div",{className:"mb-6",children:[Ae.jsxs("h3",{className:"text-xl font-semibold text-gray-200 mb-3 flex items-center",children:[Ae.jsx(BC,{className:"mr-2 text-sky-400"})," Select Chat Provider"]}),Ae.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-3",children:w.map(T=>{var I;const C=!!((I=n[T.id])!=null&&I.trim()),A=t===T.id;return Ae.jsxs("button",{onClick:()=>r(T.id),disabled:!C,className:`flex items-center justify-center p-3 rounded-lg border-2 transition-all duration-150 ease-in-out
                            ${A?"bg-sky-500 border-sky-400 text-white shadow-lg scale-105":C?"bg-gray-700 border-gray-600 hover:bg-gray-600 hover:border-sky-500 text-gray-200":"bg-gray-700/50 border-gray-600 text-gray-500 cursor-not-allowed"}`,"aria-pressed":A,"aria-label":`Select ${T.label} as chat provider ${C?"":"(API key not set)"}`,children:[Ae.jsx(T.Icon,{className:`mr-2 h-5 w-5 ${A?"":C?"text-sky-300":"text-gray-500"}`}),Ae.jsx("span",{className:"font-medium text-sm",children:T.label})]},T.id)})}),!((S=n[t])!=null&&S.trim())&&Ae.jsxs("p",{className:"text-xs text-yellow-400 mt-2 text-center",children:["The selected provider (",t,") has no API key. Chat will be disabled."]})]}),Ae.jsxs("p",{className:"text-xs text-gray-500 mt-4 text-center",children:[Ae.jsx("span",{className:"font-semibold",children:"Security Note:"})," API keys are stored in your browser's local storage. Avoid using shared or public computers."]}),Ae.jsx("p",{className:"text-xs text-gray-500 mt-1 text-center",children:'The "Gemini API Key" field is for a user-provided key. If you have `process.env.API_KEY` configured for Gemini, it may be used by the SDK directly if this field is empty, depending on service logic.'})]})},_H=({servers:n,onAddServer:e,onRemoveServer:t,onConnectToServer:r,serversLoadedFromStorage:i})=>{const[a,s]=_t.useState(""),[o,u]=_t.useState(""),[c,d]=_t.useState(""),[p,m]=_t.useState(""),y=T=>{if(T.preventDefault(),!a.trim()||!o.trim()){m("Server name and URL cannot be empty.");return}try{new URL(o)}catch{m("Invalid server URL format. Please include /mcp");return}m(""),e(a,o,c),s(""),u(""),d("")},b=T=>{switch(T){case"connected":return"text-green-300 bg-green-800/60 border-green-700";case"connecting":return"text-yellow-300 bg-yellow-800/60 border-yellow-700";case"error":return"text-red-300 bg-red-800/60 border-red-700";default:return"text-gray-300 bg-gray-700/70 border-gray-600"}},w=T=>{switch(T){case"connected":return Ae.jsx(OF,{className:"text-green-400"});case"connecting":return Ae.jsx(Uf,{className:"text-yellow-400 !w-4 !h-4 !mr-0"});case"error":return Ae.jsx(hH,{className:"text-red-400"});default:return Ae.jsx(Qk,{className:"text-gray-400 !w-4 !h-4"})}},S=T=>{switch(T){case"connected":return"Reconnect";case"connecting":return"Connecting...";case"error":return"Retry Connect";default:return"Connect"}};return i?Ae.jsxs("div",{className:"p-6 bg-gray-800 rounded-xl shadow-xl",children:[Ae.jsxs("h2",{className:"text-2xl font-semibold text-sky-400 mb-6 flex items-center",children:[Ae.jsx(Qk,{className:"mr-3 text-sky-400"})," MCP Server Management"]}),Ae.jsxs("form",{onSubmit:y,className:"mb-8 p-4 border border-gray-700 rounded-lg bg-gray-700/30",children:[Ae.jsx("h3",{className:"text-lg font-medium text-gray-200 mb-3",children:"Add New MCP Server"}),Ae.jsxs("div",{className:"mb-4",children:[Ae.jsx("label",{htmlFor:"newServerName",className:"block text-sm font-medium text-gray-300 mb-1",children:"Server Name/Alias"}),Ae.jsx("input",{type:"text",id:"newServerName",value:a,onChange:T=>s(T.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-200 focus:ring-1 focus:ring-sky-500 focus:border-sky-500",placeholder:"e.g., Primary MCP"})]}),Ae.jsxs("div",{className:"mb-4",children:[Ae.jsx("label",{htmlFor:"newServerUrl",className:"block text-sm font-medium text-gray-300 mb-1",children:"Server URL"}),Ae.jsx("input",{type:"url",id:"newServerUrl",value:o,onChange:T=>u(T.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-200 focus:ring-1 focus:ring-sky-500 focus:border-sky-500",placeholder:"https://mcp.example.com"})]}),Ae.jsxs("div",{className:"mb-4",children:[Ae.jsx("label",{htmlFor:"newServerBearerToken",className:"block text-sm font-medium text-gray-300 mb-1",children:"Bearer Token (Optional)"}),Ae.jsx("input",{type:"password",id:"newServerBearerToken",value:c,onChange:T=>d(T.target.value),className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-gray-200 focus:ring-1 focus:ring-sky-500 focus:border-sky-500",placeholder:"Enter optional bearer token",autoComplete:"off"})]}),p&&Ae.jsx("p",{className:"text-red-400 text-xs mb-3",children:p}),Ae.jsxs("button",{type:"submit",className:"w-full bg-sky-600 hover:bg-sky-700 text-white font-semibold py-2.5 px-4 rounded-lg transition duration-150 ease-in-out transform hover:scale-102 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-opacity-75 flex items-center justify-center",children:[Ae.jsx(mH,{className:"mr-2"})," Add Server"]})]}),Ae.jsxs("div",{children:[Ae.jsx("h3",{className:"text-xl font-semibold text-gray-200 mb-4",children:"Configured Servers"}),n.length===0?Ae.jsx("p",{className:"text-gray-400 text-center py-4",children:"No MCP servers configured yet. Add one above."}):Ae.jsx("div",{className:"space-y-4",children:n.map(T=>Ae.jsxs("div",{className:"p-4 bg-gray-700/50 rounded-lg border border-gray-600 shadow-md",children:[Ae.jsxs("div",{className:"flex justify-between items-start mb-2",children:[Ae.jsxs("div",{children:[Ae.jsx("h4",{className:"text-lg font-semibold text-sky-300",children:T.name}),Ae.jsx("p",{className:"text-xs text-gray-400 break-all",children:T.url}),T.bearerToken&&Ae.jsxs("p",{className:"text-xs text-gray-500 mt-1 flex items-center",children:[Ae.jsx(xF,{className:"w-3 h-3 mr-1 text-yellow-400"})," Bearer Token: Present"]})]}),Ae.jsx("button",{onClick:()=>t(T.id),className:"text-gray-400 hover:text-red-400 p-1 rounded-md transition-colors","aria-label":`Remove ${T.name}`,children:Ae.jsx(pH,{className:"w-5 h-5"})})]}),Ae.jsxs("div",{className:`text-xs p-2 rounded-md border flex items-center gap-2 mb-3 ${b(T.status)}`,children:[w(T.status)," ",Ae.jsxs("strong",{children:[T.status.charAt(0).toUpperCase()+T.status.slice(1),":"]})," ",T.statusMessage]}),Ae.jsxs("button",{onClick:()=>r(T.id),disabled:T.status==="connecting",className:"w-full bg-teal-600 hover:bg-teal-700 text-white font-semibold py-2 px-3 rounded-md transition duration-150 ease-in-out transform hover:scale-102 focus:outline-none focus:ring-1 focus:ring-teal-400 disabled:opacity-60 disabled:cursor-not-allowed flex items-center justify-center text-sm",children:[T.status==="connecting"&&Ae.jsx(Uf,{className:"mr-2 text-white !w-4 !h-4"}),S(T.status)]})]},T.id))})]}),Ae.jsxs("div",{className:"text-sm text-yellow-200 bg-yellow-800/40 p-3 rounded-md mt-6 text-center border border-yellow-700/50 shadow",children:[Ae.jsx("p",{className:"font-semibold",children:"Important Note:"}),Ae.jsxs("p",{className:"text-xs ",children:["MCP server connections now attempt ",Ae.jsx("strong",{className:"font-medium",children:"real network requests"})," to the URLs provided. Ensure URLs are correct (including http/https) and accessible. If a server is on a different domain, it must be configured for CORS to allow requests from this application. Failures might be due to network issues, incorrect URLs, server errors, or CORS misconfiguration. Check the browser's console for more details on network errors."]})]})]}):Ae.jsxs("div",{className:"bg-gray-800 p-6 rounded-xl shadow-xl flex items-center justify-center h-40",children:[Ae.jsx(Uf,{className:"w-6 h-6 text-sky-400 mr-2"}),Ae.jsx("span",{className:"text-gray-300",children:"Cargando servidores guardados..."})]})};function qC(n,e=N_){n=n.trim();const t=n.indexOf("```");if(t===-1)return e(n);let r=n.substring(t+3);r.startsWith(`json
`)?r=r.substring(5):r.startsWith("json")?r=r.substring(4):r.startsWith(`
`)&&(r=r.substring(1));const i=r.indexOf("```");let a=r;return i!==-1&&(a=r.substring(0,i)),e(a.trim())}function N_(n){if(typeof n>"u")return null;try{return JSON.parse(n)}catch{}let e="";const t=[];let r=!1,i=!1;for(let a of n){if(r)a==='"'&&!i?r=!1:a===`
`&&!i?a="\\n":a==="\\"?i=!i:i=!1;else if(a==='"')r=!0,i=!1;else if(a==="{")t.push("}");else if(a==="[")t.push("]");else if(a==="}"||a==="]")if(t&&t[t.length-1]===a)t.pop();else return null;e+=a}r&&(e+='"');for(let a=t.length-1;a>=0;a-=1)e+=t[a];try{return JSON.parse(e)}catch{return null}}var Xw,eM;function bH(){return eM||(eM=1,Xw=function(n,e){if(typeof n!="string")throw new TypeError("Expected a string");return e=typeof e>"u"?"_":e,n.replace(/([a-z\d])([A-Z])/g,"$1"+e+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+e+"$2").toLowerCase()}),Xw}var wH=bH();const EH=Js(wH);var Wg={exports:{}},tM;function SH(){if(tM)return Wg.exports;tM=1;const n=/[\p{Lu}]/u,e=/[\p{Ll}]/u,t=/^[\p{Lu}](?![\p{Lu}])/gu,r=/([\p{Alpha}\p{N}_]|$)/u,i=/[_.\- ]+/,a=new RegExp("^"+i.source),s=new RegExp(i.source+r.source,"gu"),o=new RegExp("\\d+"+r.source,"gu"),u=(m,y,b)=>{let w=!1,S=!1,T=!1;for(let C=0;C<m.length;C++){const A=m[C];w&&n.test(A)?(m=m.slice(0,C)+"-"+m.slice(C),w=!1,T=S,S=!0,C++):S&&T&&e.test(A)?(m=m.slice(0,C-1)+"-"+m.slice(C-1),T=S,S=!1,w=!0):(w=y(A)===A&&b(A)!==A,T=S,S=b(A)===A&&y(A)!==A)}return m},c=(m,y)=>(t.lastIndex=0,m.replace(t,b=>y(b))),d=(m,y)=>(s.lastIndex=0,o.lastIndex=0,m.replace(s,(b,w)=>y(w)).replace(o,b=>y(b))),p=(m,y)=>{if(!(typeof m=="string"||Array.isArray(m)))throw new TypeError("Expected the input to be `string | string[]`");if(y={pascalCase:!1,preserveConsecutiveUppercase:!1,...y},Array.isArray(m)?m=m.map(T=>T.trim()).filter(T=>T.length).join("-"):m=m.trim(),m.length===0)return"";const b=y.locale===!1?T=>T.toLowerCase():T=>T.toLocaleLowerCase(y.locale),w=y.locale===!1?T=>T.toUpperCase():T=>T.toLocaleUpperCase(y.locale);return m.length===1?y.pascalCase?w(m):b(m):(m!==b(m)&&(m=u(m,b,w)),m=m.replace(a,""),y.preserveConsecutiveUppercase?m=c(m,b):m=b(m),y.pascalCase&&(m=w(m.charAt(0))+m.slice(1)),d(m,w))};return Wg.exports=p,Wg.exports.default=p,Wg.exports}var TH=SH();const AH=Js(TH);function CH(n,e){return(e==null?void 0:e[n])||EH(n)}function RH(n,e){return(e==null?void 0:e[n])||AH(n)}function DF(n,e,t){const r={};for(const i in n)Object.hasOwn(n,i)&&(r[e(i,t)]=n[i]);return r}function nM(n){return Array.isArray(n)?[...n]:{...n}}function IH(n,e){const t=nM(n);for(const[r,i]of Object.entries(e)){const[a,...s]=r.split(".").reverse();let o=t;for(const u of s.reverse()){if(o[u]===void 0)break;o[u]=nM(o[u]),o=o[u]}o[a]!==void 0&&(o[a]={lc:1,type:"secret",id:[i]})}return t}function k_(n){const e=Object.getPrototypeOf(n);return typeof n.lc_name=="function"&&(typeof e.lc_name!="function"||n.lc_name()!==e.lc_name())?n.lc_name():n.name}class la{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,k_(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_serializable_keys!==void 0?this.lc_kwargs=Object.fromEntries(Object.entries(e||{}).filter(([r])=>{var i;return(i=this.lc_serializable_keys)==null?void 0:i.includes(r)})):this.lc_kwargs=e??{}}toJSON(){if(!this.lc_serializable)return this.toJSONNotImplemented();if(this.lc_kwargs instanceof la||typeof this.lc_kwargs!="object"||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();const e={},t={},r=Object.keys(this.lc_kwargs).reduce((i,a)=>(i[a]=a in this?this[a]:this.lc_kwargs[a],i),{});for(let i=Object.getPrototypeOf(this);i;i=Object.getPrototypeOf(i))Object.assign(e,Reflect.get(i,"lc_aliases",this)),Object.assign(t,Reflect.get(i,"lc_secrets",this)),Object.assign(r,Reflect.get(i,"lc_attributes",this));return Object.keys(t).forEach(i=>{let a=this,s=r;const[o,...u]=i.split(".").reverse();for(const c of u.reverse()){if(!(c in a)||a[c]===void 0)return;(!(c in s)||s[c]===void 0)&&(typeof a[c]=="object"&&a[c]!=null?s[c]={}:Array.isArray(a[c])&&(s[c]=[])),a=a[c],s=s[c]}o in a&&a[o]!==void 0&&(s[o]=s[o]||a[o])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:DF(Object.keys(t).length?IH(r,t):r,CH,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}const PH=Object.freeze(Object.defineProperty({__proto__:null,Serializable:la,get_lc_unique_name:k_},Symbol.toStringTag,{value:"Module"}));function Da(n){return typeof n=="object"&&n!==null&&"type"in n&&typeof n.type=="string"&&"source_type"in n&&(n.source_type==="url"||n.source_type==="base64"||n.source_type==="text"||n.source_type==="id")}function $F(n){return Da(n)&&n.source_type==="url"&&"url"in n&&typeof n.url=="string"}function LF(n){return Da(n)&&n.source_type==="base64"&&"data"in n&&typeof n.data=="string"}function xH(n){return Da(n)&&n.source_type==="text"&&"text"in n&&typeof n.text=="string"}function OH(n){return Da(n)&&n.source_type==="id"&&"id"in n&&typeof n.id=="string"}function UF(n){if(Da(n)){if(n.source_type==="url")return{type:"image_url",image_url:{url:n.url}};if(n.source_type==="base64"){if(!n.mime_type)throw new Error("mime_type key is required for base64 data.");return{type:"image_url",image_url:{url:`data:${n.mime_type};base64,${n.data}`}}}}throw new Error("Unsupported source type. Only 'url' and 'base64' are supported.")}function VC(n){const e=n.split(";")[0].split("/");if(e.length!==2)throw new Error(`Invalid mime type: "${n}" - does not match type/subtype format.`);const t=e[0].trim(),r=e[1].trim();if(t===""||r==="")throw new Error(`Invalid mime type: "${n}" - type or subtype is empty.`);const i={};for(const a of n.split(";").slice(1)){const s=a.split("=");if(s.length!==2)throw new Error(`Invalid parameter syntax in mime type: "${n}".`);const o=s[0].trim(),u=s[1].trim();if(o==="")throw new Error(`Invalid parameter syntax in mime type: "${n}".`);i[o]=u}return{type:t,subtype:r,parameters:i}}function xl({dataUrl:n,asTypedArray:e=!1}){const t=n.match(/^data:(\w+\/\w+);base64,([A-Za-z0-9+/]+=*)$/);let r;if(t){r=t[1].toLowerCase();const i=e?Uint8Array.from(atob(t[2]),a=>a.charCodeAt(0)):t[2];return{mime_type:r,data:i}}}function rm(n,e){if(n.type==="text"){if(!e.fromStandardTextBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardTextBlock\` method.`);return e.fromStandardTextBlock(n)}if(n.type==="image"){if(!e.fromStandardImageBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardImageBlock\` method.`);return e.fromStandardImageBlock(n)}if(n.type==="audio"){if(!e.fromStandardAudioBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardAudioBlock\` method.`);return e.fromStandardAudioBlock(n)}if(n.type==="file"){if(!e.fromStandardFileBlock)throw new Error(`Converter for ${e.providerName} does not implement \`fromStandardFileBlock\` method.`);return e.fromStandardFileBlock(n)}throw new Error(`Unable to convert content block type '${n.type}' to provider-specific format: not recognized.`)}function rc(n,e){return typeof n=="string"?n===""?e:typeof e=="string"?n+e:Array.isArray(e)&&e.some(t=>Da(t))?[{type:"text",source_type:"text",text:n},...e]:[{type:"text",text:n},...e]:Array.isArray(e)?im(n,e)??[...n,...e]:e===""?n:Array.isArray(n)&&n.some(t=>Da(t))?[...n,{type:"file",source_type:"text",text:e}]:[...n,{type:"text",text:e}]}function jF(n,e){return n==="error"||e==="error"?"error":"success"}function NH(n,e){function t(r,i){if(typeof r!="object"||r===null||r===void 0)return r;if(i>=e)return Array.isArray(r)?"[Array]":"[Object]";if(Array.isArray(r))return r.map(s=>t(s,i+1));const a={};for(const s of Object.keys(r))a[s]=t(r[s],i+1);return a}return JSON.stringify(t(n,0),null,2)}class Oa extends la{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return typeof this.content=="string"?this.content:Array.isArray(this.content)?this.content.map(e=>typeof e=="string"?e:e.type==="text"?e.text:"").join(""):""}getType(){return this._getType()}constructor(e,t){typeof e=="string"&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata,this.id=e.id}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}static lc_name(){return"BaseMessage"}get _printableFields(){return{id:this.id,content:this.content,name:this.name,additional_kwargs:this.additional_kwargs,response_metadata:this.response_metadata}}_updateId(e){this.id=e,this.lc_kwargs.id=e}get[Symbol.toStringTag](){return this.constructor.lc_name()}[Symbol.for("nodejs.util.inspect.custom")](e){if(e===null)return this;const t=NH(this._printableFields,Math.max(4,e));return`${this.constructor.lc_name()} ${t}`}}function kH(n){return Array.isArray(n)&&n.every(e=>typeof e.index=="number")}function Qr(n,e){const t={...n};for(const[r,i]of Object.entries(e))if(t[r]==null)t[r]=i;else{if(i==null)continue;if(typeof t[r]!=typeof i||Array.isArray(t[r])!==Array.isArray(i))throw new Error(`field[${r}] already exists in the message chunk, but with a different type.`);if(typeof t[r]=="string"){if(r==="type")continue;t[r]+=i}else if(typeof t[r]=="object"&&!Array.isArray(t[r]))t[r]=Qr(t[r],i);else if(Array.isArray(t[r]))t[r]=im(t[r],i);else{if(t[r]===i)continue;console.warn(`field[${r}] already exists in this message chunk and value has unsupported type.`)}}return t}function im(n,e){if(!(n===void 0&&e===void 0)){if(n===void 0||e===void 0)return n||e;{const t=[...n];for(const r of e)if(typeof r=="object"&&"index"in r&&typeof r.index=="number"){const i=t.findIndex(a=>a.index===r.index);i!==-1?t[i]=Qr(t[i],r):t.push(r)}else{if(typeof r=="object"&&"text"in r&&r.text==="")continue;t.push(r)}return t}}}function FF(n,e){if(!n&&!e)throw new Error("Cannot merge two undefined objects.");if(!n||!e)return n||e;if(typeof n!=typeof e)throw new Error(`Cannot merge objects of different types.
Left ${typeof n}
Right ${typeof e}`);if(typeof n=="string"&&typeof e=="string")return n+e;if(Array.isArray(n)&&Array.isArray(e))return im(n,e);if(typeof n=="object"&&typeof e=="object")return Qr(n,e);if(n===e)return n;throw new Error(`Can not merge objects of different types.
Left ${n}
Right ${e}`)}class ic extends Oa{}function BF(n){return typeof n.role=="string"}function Ln(n){return typeof(n==null?void 0:n._getType)=="function"}function Zf(n){return Ln(n)&&typeof n.concat=="function"}function MH(n){return n!=null&&typeof n=="object"&&"lc_direct_tool_output"in n&&n.lc_direct_tool_output===!0}class ko extends Oa{static lc_name(){return"ToolMessage"}get lc_aliases(){return{tool_call_id:"tool_call_id"}}constructor(e,t,r){typeof e=="string"&&(e={content:e,name:r,tool_call_id:t}),super(e),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}_getType(){return"tool"}static isInstance(e){return e._getType()==="tool"}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}class fd extends ic{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"artifact",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id,this.artifact=e.artifact,this.status=e.status}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new fd({content:rc(this.content,e.content),additional_kwargs:Qr(this.additional_kwargs,e.additional_kwargs),response_metadata:Qr(this.response_metadata,e.response_metadata),artifact:FF(this.artifact,e.artifact),tool_call_id:this.tool_call_id,id:this.id??e.id,status:jF(this.status,e.status)})}get _printableFields(){return{...super._printableFields,tool_call_id:this.tool_call_id,artifact:this.artifact}}}function DH(n){const e=[],t=[];for(const r of n)if(r.function){const i=r.function.name;try{const a=JSON.parse(r.function.arguments),s={name:i||"",args:a||{},id:r.id};e.push(s)}catch{t.push({name:i,args:r.function.arguments,id:r.id,error:"Malformed args."})}}else continue;return[e,t]}function Pp(n){return n._getType()==="tool"}function $H(n){return n._getType()==="tool"}class bn extends Oa{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){var i;let r;if(typeof e=="string")r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{r=e;const a=(i=r.additional_kwargs)==null?void 0:i.tool_calls,s=r.tool_calls;a!=null&&a.length>0&&(s===void 0||s.length===0)&&console.warn(["New LangChain packages are available that more efficiently handle",`tool calling.

Please upgrade your packages to versions that set`,"message tool calls. e.g., `yarn add @langchain/anthropic`,","yarn add @langchain/openai`, etc."].join(" "));try{if(a!=null&&s===void 0){const[o,u]=DH(a);r.tool_calls=o??[],r.invalid_tool_calls=u??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch{r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof r!="string"&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls),this.usage_metadata=r.usage_metadata}static lc_name(){return"AIMessage"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}}function ua(n){return n._getType()==="ai"}function Cv(n){return n._getType()==="ai"}class Sn extends ic{constructor(e){let t;if(typeof e=="string")t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(e.tool_call_chunks===void 0)t={...e,tool_calls:e.tool_calls??[],invalid_tool_calls:[],tool_call_chunks:[],usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0};else{const r=[],i=[];for(const a of e.tool_call_chunks){let s={};try{if(s=N_(a.args||"{}"),s===null||typeof s!="object"||Array.isArray(s))throw new Error("Malformed tool call chunk args.");r.push({name:a.name??"",args:s,id:a.id,type:"tool_call"})}catch{i.push({name:a.name,args:a.args,id:a.id,error:"Malformed args.",type:"invalid_tool_call"})}}t={...e,tool_calls:r,invalid_tool_calls:i,usage_metadata:e.usage_metadata!==void 0?e.usage_metadata:void 0}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"usage_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_chunks=t.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t.tool_calls??this.tool_calls,this.invalid_tool_calls=t.invalid_tool_calls??this.invalid_tool_calls,this.usage_metadata=t.usage_metadata}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}get _printableFields(){return{...super._printableFields,tool_calls:this.tool_calls,tool_call_chunks:this.tool_call_chunks,invalid_tool_calls:this.invalid_tool_calls,usage_metadata:this.usage_metadata}}concat(e){var r,i,a,s,o,u,c,d,p,m,y,b,w,S,T,C,A,I,x,L,U,N,B,q,J,V,de,ae,ue,te,oe,ge,Ee,Y,ve,Re,Q,ie,ce,P;const t={content:rc(this.content,e.content),additional_kwargs:Qr(this.additional_kwargs,e.additional_kwargs),response_metadata:Qr(this.response_metadata,e.response_metadata),tool_call_chunks:[],id:this.id??e.id};if(this.tool_call_chunks!==void 0||e.tool_call_chunks!==void 0){const O=im(this.tool_call_chunks,e.tool_call_chunks);O!==void 0&&O.length>0&&(t.tool_call_chunks=O)}if(this.usage_metadata!==void 0||e.usage_metadata!==void 0){const O={...(((i=(r=this.usage_metadata)==null?void 0:r.input_token_details)==null?void 0:i.audio)!==void 0||((s=(a=e.usage_metadata)==null?void 0:a.input_token_details)==null?void 0:s.audio)!==void 0)&&{audio:(((u=(o=this.usage_metadata)==null?void 0:o.input_token_details)==null?void 0:u.audio)??0)+(((d=(c=e.usage_metadata)==null?void 0:c.input_token_details)==null?void 0:d.audio)??0)},...(((m=(p=this.usage_metadata)==null?void 0:p.input_token_details)==null?void 0:m.cache_read)!==void 0||((b=(y=e.usage_metadata)==null?void 0:y.input_token_details)==null?void 0:b.cache_read)!==void 0)&&{cache_read:(((S=(w=this.usage_metadata)==null?void 0:w.input_token_details)==null?void 0:S.cache_read)??0)+(((C=(T=e.usage_metadata)==null?void 0:T.input_token_details)==null?void 0:C.cache_read)??0)},...(((I=(A=this.usage_metadata)==null?void 0:A.input_token_details)==null?void 0:I.cache_creation)!==void 0||((L=(x=e.usage_metadata)==null?void 0:x.input_token_details)==null?void 0:L.cache_creation)!==void 0)&&{cache_creation:(((N=(U=this.usage_metadata)==null?void 0:U.input_token_details)==null?void 0:N.cache_creation)??0)+(((q=(B=e.usage_metadata)==null?void 0:B.input_token_details)==null?void 0:q.cache_creation)??0)}},K={...(((V=(J=this.usage_metadata)==null?void 0:J.output_token_details)==null?void 0:V.audio)!==void 0||((ae=(de=e.usage_metadata)==null?void 0:de.output_token_details)==null?void 0:ae.audio)!==void 0)&&{audio:(((te=(ue=this.usage_metadata)==null?void 0:ue.output_token_details)==null?void 0:te.audio)??0)+(((ge=(oe=e.usage_metadata)==null?void 0:oe.output_token_details)==null?void 0:ge.audio)??0)},...(((Y=(Ee=this.usage_metadata)==null?void 0:Ee.output_token_details)==null?void 0:Y.reasoning)!==void 0||((Re=(ve=e.usage_metadata)==null?void 0:ve.output_token_details)==null?void 0:Re.reasoning)!==void 0)&&{reasoning:(((ie=(Q=this.usage_metadata)==null?void 0:Q.output_token_details)==null?void 0:ie.reasoning)??0)+(((P=(ce=e.usage_metadata)==null?void 0:ce.output_token_details)==null?void 0:P.reasoning)??0)}},X=this.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},se=e.usage_metadata??{input_tokens:0,output_tokens:0,total_tokens:0},F={input_tokens:X.input_tokens+se.input_tokens,output_tokens:X.output_tokens+se.output_tokens,total_tokens:X.total_tokens+se.total_tokens,...Object.keys(O).length>0&&{input_token_details:O},...Object.keys(K).length>0&&{output_token_details:K}};t.usage_metadata=F}return new Sn(t)}}class La extends Oa{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return La}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return e._getType()==="generic"}get _printableFields(){return{...super._printableFields,role:this.role}}}class ac extends ic{static lc_name(){return"ChatMessageChunk"}constructor(e,t){typeof e=="string"&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new ac({content:rc(this.content,e.content),additional_kwargs:Qr(this.additional_kwargs,e.additional_kwargs),response_metadata:Qr(this.response_metadata,e.response_metadata),role:this.role,id:this.id??e.id})}get _printableFields(){return{...super._printableFields,role:this.role}}}function LH(n){return n._getType()==="generic"}function UH(n){return n._getType()==="generic"}class M_ extends Oa{static lc_name(){return"FunctionMessage"}constructor(e,t){typeof e=="string"&&(e={content:e,name:t}),super(e)}_getType(){return"function"}}class sc extends ic{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new sc({content:rc(this.content,e.content),additional_kwargs:Qr(this.additional_kwargs,e.additional_kwargs),response_metadata:Qr(this.response_metadata,e.response_metadata),name:this.name??"",id:this.id??e.id})}}function jH(n){return n._getType()==="function"}function FH(n){return n._getType()==="function"}class ei extends Oa{static lc_name(){return"HumanMessage"}_getType(){return"human"}constructor(e,t){super(e,t)}}class oc extends ic{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}constructor(e,t){super(e,t)}concat(e){return new oc({content:rc(this.content,e.content),additional_kwargs:Qr(this.additional_kwargs,e.additional_kwargs),response_metadata:Qr(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function BH(n){return n.getType()==="human"}function qH(n){return n.getType()==="human"}class fs extends Oa{static lc_name(){return"SystemMessage"}_getType(){return"system"}constructor(e,t){super(e,t)}}class Gs extends ic{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}constructor(e,t){super(e,t)}concat(e){return new Gs({content:rc(this.content,e.content),additional_kwargs:Qr(this.additional_kwargs,e.additional_kwargs),response_metadata:Qr(this.response_metadata,e.response_metadata),id:this.id??e.id})}}function VH(n){return n._getType()==="system"}function zH(n){return n._getType()==="system"}function D_(n,e){return n.lc_error_code=e,n.message=`${n.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,n}function lp(n){return!!(n&&typeof n=="object"&&"type"in n&&n.type==="tool_call")}function HH(n){return!!(n&&typeof n=="object"&&"toolCall"in n&&n.toolCall!=null&&typeof n.toolCall=="object"&&"id"in n.toolCall&&typeof n.toolCall.id=="string")}class Rv extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}}function GH(n){return lp(n)?n:typeof n.id=="string"&&n.type==="function"&&typeof n.function=="object"&&n.function!==null&&"arguments"in n.function&&typeof n.function.arguments=="string"&&"name"in n.function&&typeof n.function.name=="string"?{id:n.id,args:JSON.parse(n.function.arguments),name:n.function.name,type:"tool_call"}:n}function WH(n){return typeof n=="object"&&n!=null&&n.lc===1&&Array.isArray(n.id)&&n.kwargs!=null&&typeof n.kwargs=="object"}function Qw(n){let e,t;if(WH(n)){const r=n.id.at(-1);r==="HumanMessage"||r==="HumanMessageChunk"?e="user":r==="AIMessage"||r==="AIMessageChunk"?e="assistant":r==="SystemMessage"||r==="SystemMessageChunk"?e="system":r==="FunctionMessage"||r==="FunctionMessageChunk"?e="function":r==="ToolMessage"||r==="ToolMessageChunk"?e="tool":e="unknown",t=n.kwargs}else{const{type:r,...i}=n;e=r,t=i}if(e==="human"||e==="user")return new ei(t);if(e==="ai"||e==="assistant"){const{tool_calls:r,...i}=t;if(!Array.isArray(r))return new bn(t);const a=r.map(GH);return new bn({...i,tool_calls:a})}else{if(e==="system")return new fs(t);if(e==="developer")return new fs({...t,additional_kwargs:{...t.additional_kwargs,__openai_role__:"developer"}});if(e==="tool"&&"tool_call_id"in t)return new ko({...t,content:t.content,tool_call_id:t.tool_call_id,name:t.name});throw D_(new Error(`Unable to coerce message from array: only human, AI, system, developer, or tool message coercion is currently supported.

Received: ${JSON.stringify(n,null,2)}`),"MESSAGE_COERCION_FAILURE")}}function is(n){if(typeof n=="string")return new ei(n);if(Ln(n))return n;if(Array.isArray(n)){const[e,t]=n;return Qw({type:e,content:t})}else if(BF(n)){const{role:e,...t}=n;return Qw({...t,type:e})}else return Qw(n)}function am(n,e="Human",t="AI"){const r=[];for(const i of n){let a;if(i._getType()==="human")a=e;else if(i._getType()==="ai")a=t;else if(i._getType()==="system")a="System";else if(i._getType()==="function")a="Function";else if(i._getType()==="tool")a="Tool";else if(i._getType()==="generic")a=i.role;else throw new Error(`Got unsupported message type: ${i._getType()}`);const s=i.name?`${i.name}, `:"",o=typeof i.content=="string"?i.content:JSON.stringify(i.content,null,2);r.push(`${a}: ${s}${o}`)}return r.join(`
`)}function KH(n){if(n.data!==void 0)return n;{const e=n;return{type:e.type,data:{content:e.text,role:e.role,name:void 0,tool_call_id:void 0}}}}function $R(n){const e=KH(n);switch(e.type){case"human":return new ei(e.data);case"ai":return new bn(e.data);case"system":return new fs(e.data);case"function":if(e.data.name===void 0)throw new Error("Name must be defined for function messages");return new M_(e.data);case"tool":if(e.data.tool_call_id===void 0)throw new Error("Tool call ID must be defined for tool messages");return new ko(e.data);case"generic":{if(e.data.role===void 0)throw new Error("Role must be defined for chat messages");return new La(e.data)}default:throw new Error(`Got unexpected type: ${e.type}`)}}function JH(n){return n.map($R)}function YH(n){return n.map(e=>e.toDict())}function Iv(n){var t;const e=n._getType();if(e==="human")return new oc({...n});if(e==="ai"){let r={...n};return"tool_calls"in r&&(r={...r,tool_call_chunks:(t=r.tool_calls)==null?void 0:t.map(i=>({...i,type:"tool_call_chunk",index:void 0,args:JSON.stringify(i.args)}))}),new Sn({...r})}else{if(e==="system")return new Gs({...n});if(e==="function")return new sc({...n});if(La.isInstance(n))return new ac({...n});throw new Error("Unknown message type.")}}var Zt;(function(n){n.assertEqual=i=>{};function e(i){}n.assertIs=e;function t(i){throw new Error}n.assertNever=t,n.arrayToEnum=i=>{const a={};for(const s of i)a[s]=s;return a},n.getValidEnumValues=i=>{const a=n.objectKeys(i).filter(o=>typeof i[i[o]]!="number"),s={};for(const o of a)s[o]=i[o];return n.objectValues(s)},n.objectValues=i=>n.objectKeys(i).map(function(a){return i[a]}),n.objectKeys=typeof Object.keys=="function"?i=>Object.keys(i):i=>{const a=[];for(const s in i)Object.prototype.hasOwnProperty.call(i,s)&&a.push(s);return a},n.find=(i,a)=>{for(const s of i)if(a(s))return s},n.isInteger=typeof Number.isInteger=="function"?i=>Number.isInteger(i):i=>typeof i=="number"&&Number.isFinite(i)&&Math.floor(i)===i;function r(i,a=" | "){return i.map(s=>typeof s=="string"?`'${s}'`:s).join(a)}n.joinValues=r,n.jsonStringifyReplacer=(i,a)=>typeof a=="bigint"?a.toString():a})(Zt||(Zt={}));var rM;(function(n){n.mergeShapes=(e,t)=>({...e,...t})})(rM||(rM={}));const st=Zt.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),wl=n=>{switch(typeof n){case"undefined":return st.undefined;case"string":return st.string;case"number":return Number.isNaN(n)?st.nan:st.number;case"boolean":return st.boolean;case"function":return st.function;case"bigint":return st.bigint;case"symbol":return st.symbol;case"object":return Array.isArray(n)?st.array:n===null?st.null:n.then&&typeof n.then=="function"&&n.catch&&typeof n.catch=="function"?st.promise:typeof Map<"u"&&n instanceof Map?st.map:typeof Set<"u"&&n instanceof Set?st.set:typeof Date<"u"&&n instanceof Date?st.date:st.object;default:return st.unknown}},Je=Zt.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class Mo extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};const t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){const t=e||function(a){return a.message},r={_errors:[]},i=a=>{for(const s of a.issues)if(s.code==="invalid_union")s.unionErrors.map(i);else if(s.code==="invalid_return_type")i(s.returnTypeError);else if(s.code==="invalid_arguments")i(s.argumentsError);else if(s.path.length===0)r._errors.push(t(s));else{let o=r,u=0;for(;u<s.path.length;){const c=s.path[u];u===s.path.length-1?(o[c]=o[c]||{_errors:[]},o[c]._errors.push(t(s))):o[c]=o[c]||{_errors:[]},o=o[c],u++}}};return i(this),r}static assert(e){if(!(e instanceof Mo))throw new Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,Zt.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=t=>t.message){const t={},r=[];for(const i of this.issues)i.path.length>0?(t[i.path[0]]=t[i.path[0]]||[],t[i.path[0]].push(e(i))):r.push(e(i));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}Mo.create=n=>new Mo(n);const zC=(n,e)=>{let t;switch(n.code){case Je.invalid_type:n.received===st.undefined?t="Required":t=`Expected ${n.expected}, received ${n.received}`;break;case Je.invalid_literal:t=`Invalid literal value, expected ${JSON.stringify(n.expected,Zt.jsonStringifyReplacer)}`;break;case Je.unrecognized_keys:t=`Unrecognized key(s) in object: ${Zt.joinValues(n.keys,", ")}`;break;case Je.invalid_union:t="Invalid input";break;case Je.invalid_union_discriminator:t=`Invalid discriminator value. Expected ${Zt.joinValues(n.options)}`;break;case Je.invalid_enum_value:t=`Invalid enum value. Expected ${Zt.joinValues(n.options)}, received '${n.received}'`;break;case Je.invalid_arguments:t="Invalid function arguments";break;case Je.invalid_return_type:t="Invalid function return type";break;case Je.invalid_date:t="Invalid date";break;case Je.invalid_string:typeof n.validation=="object"?"includes"in n.validation?(t=`Invalid input: must include "${n.validation.includes}"`,typeof n.validation.position=="number"&&(t=`${t} at one or more positions greater than or equal to ${n.validation.position}`)):"startsWith"in n.validation?t=`Invalid input: must start with "${n.validation.startsWith}"`:"endsWith"in n.validation?t=`Invalid input: must end with "${n.validation.endsWith}"`:Zt.assertNever(n.validation):n.validation!=="regex"?t=`Invalid ${n.validation}`:t="Invalid";break;case Je.too_small:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at least":"more than"} ${n.minimum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at least":"over"} ${n.minimum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${n.minimum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly equal to ":n.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(n.minimum))}`:t="Invalid input";break;case Je.too_big:n.type==="array"?t=`Array must contain ${n.exact?"exactly":n.inclusive?"at most":"less than"} ${n.maximum} element(s)`:n.type==="string"?t=`String must contain ${n.exact?"exactly":n.inclusive?"at most":"under"} ${n.maximum} character(s)`:n.type==="number"?t=`Number must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="bigint"?t=`BigInt must be ${n.exact?"exactly":n.inclusive?"less than or equal to":"less than"} ${n.maximum}`:n.type==="date"?t=`Date must be ${n.exact?"exactly":n.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(n.maximum))}`:t="Invalid input";break;case Je.custom:t="Invalid input";break;case Je.invalid_intersection_types:t="Intersection results could not be merged";break;case Je.not_multiple_of:t=`Number must be a multiple of ${n.multipleOf}`;break;case Je.not_finite:t="Number must be finite";break;default:t=e.defaultError,Zt.assertNever(n)}return{message:t}};let ZH=zC;function XH(){return ZH}const QH=n=>{const{data:e,path:t,errorMaps:r,issueData:i}=n,a=[...t,...i.path||[]],s={...i,path:a};if(i.message!==void 0)return{...i,path:a,message:i.message};let o="";const u=r.filter(c=>!!c).slice().reverse();for(const c of u)o=c(s,{data:e,defaultError:o}).message;return{...i,path:a,message:o}};function it(n,e){const t=XH(),r=QH({issueData:e,data:n.data,path:n.path,errorMaps:[n.common.contextualErrorMap,n.schemaErrorMap,t,t===zC?void 0:zC].filter(i=>!!i)});n.common.issues.push(r)}class pi{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,t){const r=[];for(const i of t){if(i.status==="aborted")return At;i.status==="dirty"&&e.dirty(),r.push(i.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){const r=[];for(const i of t){const a=await i.key,s=await i.value;r.push({key:a,value:s})}return pi.mergeObjectSync(e,r)}static mergeObjectSync(e,t){const r={};for(const i of t){const{key:a,value:s}=i;if(a.status==="aborted"||s.status==="aborted")return At;a.status==="dirty"&&e.dirty(),s.status==="dirty"&&e.dirty(),a.value!=="__proto__"&&(typeof s.value<"u"||i.alwaysSet)&&(r[a.value]=s.value)}return{status:e.value,value:r}}}const At=Object.freeze({status:"aborted"}),Vh=n=>({status:"dirty",value:n}),Ua=n=>({status:"valid",value:n}),iM=n=>n.status==="aborted",aM=n=>n.status==="dirty",Xf=n=>n.status==="valid",Pv=n=>typeof Promise<"u"&&n instanceof Promise;var ct;(function(n){n.errToObj=e=>typeof e=="string"?{message:e}:e||{},n.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(ct||(ct={}));class Ws{constructor(e,t,r,i){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=i}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}const sM=(n,e)=>{if(Xf(e))return{success:!0,data:e.value};if(!n.common.issues.length)throw new Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;const t=new Mo(n.common.issues);return this._error=t,this._error}}};function Lt(n){if(!n)return{};const{errorMap:e,invalid_type_error:t,required_error:r,description:i}=n;if(e&&(t||r))throw new Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:i}:{errorMap:(s,o)=>{const{message:u}=n;return s.code==="invalid_enum_value"?{message:u??o.defaultError}:typeof o.data>"u"?{message:u??r??o.defaultError}:s.code!=="invalid_type"?{message:o.defaultError}:{message:u??t??o.defaultError}},description:i}}class Gt{get description(){return this._def.description}_getType(e){return wl(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:wl(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new pi,ctx:{common:e.parent.common,data:e.data,parsedType:wl(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){const t=this._parse(e);if(Pv(t))throw new Error("Synchronous parse encountered promise.");return t}_parseAsync(e){const t=this._parse(e);return Promise.resolve(t)}parse(e,t){const r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){const r={common:{issues:[],async:(t==null?void 0:t.async)??!1,contextualErrorMap:t==null?void 0:t.errorMap},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:wl(e)},i=this._parseSync({data:e,path:r.path,parent:r});return sM(r,i)}"~validate"(e){var r,i;const t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:wl(e)};if(!this["~standard"].async)try{const a=this._parseSync({data:e,path:[],parent:t});return Xf(a)?{value:a.value}:{issues:t.common.issues}}catch(a){(i=(r=a==null?void 0:a.message)==null?void 0:r.toLowerCase())!=null&&i.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(a=>Xf(a)?{value:a.value}:{issues:t.common.issues})}async parseAsync(e,t){const r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){const r={common:{issues:[],contextualErrorMap:t==null?void 0:t.errorMap,async:!0},path:(t==null?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:wl(e)},i=this._parse({data:e,path:r.path,parent:r}),a=await(Pv(i)?i:Promise.resolve(i));return sM(r,a)}refine(e,t){const r=i=>typeof t=="string"||typeof t>"u"?{message:t}:typeof t=="function"?t(i):t;return this._refinement((i,a)=>{const s=e(i),o=()=>a.addIssue({code:Je.custom,...r(i)});return typeof Promise<"u"&&s instanceof Promise?s.then(u=>u?!0:(o(),!1)):s?!0:(o(),!1)})}refinement(e,t){return this._refinement((r,i)=>e(r)?!0:(i.addIssue(typeof t=="function"?t(r,i):t),!1))}_refinement(e){return new Gu({schema:this,typeName:De.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:t=>this["~validate"](t)}}optional(){return zs.create(this,this._def)}nullable(){return $o.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return Vs.create(this)}promise(){return Lv.create(this,this._def)}or(e){return Nv.create([this,e],this._def)}and(e){return kv.create(this,e,this._def)}transform(e){return new Gu({...Lt(this._def),schema:this,typeName:De.ZodEffects,effect:{type:"transform",transform:e}})}default(e){const t=typeof e=="function"?e:()=>e;return new Op({...Lt(this._def),innerType:this,defaultValue:t,typeName:De.ZodDefault})}brand(){return new HF({typeName:De.ZodBranded,type:this,...Lt(this._def)})}catch(e){const t=typeof e=="function"?e:()=>e;return new Uv({...Lt(this._def),innerType:this,catchValue:t,typeName:De.ZodCatch})}describe(e){const t=this.constructor;return new t({...this._def,description:e})}pipe(e){return UR.create(this,e)}readonly(){return jv.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}const eG=/^c[^\s-]{8,}$/i,tG=/^[0-9a-z]+$/,nG=/^[0-9A-HJKMNP-TV-Z]{26}$/i,rG=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,iG=/^[a-z0-9_-]{21}$/i,aG=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,sG=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,oG=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,lG="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$";let eE;const uG=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,cG=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,fG=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,dG=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,hG=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,pG=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,qF="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",mG=new RegExp(`^${qF}$`);function VF(n){let e="[0-5]\\d";n.precision?e=`${e}\\.\\d{${n.precision}}`:n.precision==null&&(e=`${e}(\\.\\d+)?`);const t=n.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${t}`}function gG(n){return new RegExp(`^${VF(n)}$`)}function yG(n){let e=`${qF}T${VF(n)}`;const t=[];return t.push(n.local?"Z?":"Z"),n.offset&&t.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${t.join("|")})`,new RegExp(`^${e}$`)}function vG(n,e){return!!((e==="v4"||!e)&&uG.test(n)||(e==="v6"||!e)&&fG.test(n))}function _G(n,e){if(!aG.test(n))return!1;try{const[t]=n.split("."),r=t.replace(/-/g,"+").replace(/_/g,"/").padEnd(t.length+(4-t.length%4)%4,"="),i=JSON.parse(atob(r));return!(typeof i!="object"||i===null||"typ"in i&&(i==null?void 0:i.typ)!=="JWT"||!i.alg||e&&i.alg!==e)}catch{return!1}}function bG(n,e){return!!((e==="v4"||!e)&&cG.test(n)||(e==="v6"||!e)&&dG.test(n))}class Ls extends Gt{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==st.string){const a=this._getOrReturnCtx(e);return it(a,{code:Je.invalid_type,expected:st.string,received:a.parsedType}),At}const r=new pi;let i;for(const a of this._def.checks)if(a.kind==="min")e.data.length<a.value&&(i=this._getOrReturnCtx(e,i),it(i,{code:Je.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="max")e.data.length>a.value&&(i=this._getOrReturnCtx(e,i),it(i,{code:Je.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!1,message:a.message}),r.dirty());else if(a.kind==="length"){const s=e.data.length>a.value,o=e.data.length<a.value;(s||o)&&(i=this._getOrReturnCtx(e,i),s?it(i,{code:Je.too_big,maximum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}):o&&it(i,{code:Je.too_small,minimum:a.value,type:"string",inclusive:!0,exact:!0,message:a.message}),r.dirty())}else if(a.kind==="email")oG.test(e.data)||(i=this._getOrReturnCtx(e,i),it(i,{validation:"email",code:Je.invalid_string,message:a.message}),r.dirty());else if(a.kind==="emoji")eE||(eE=new RegExp(lG,"u")),eE.test(e.data)||(i=this._getOrReturnCtx(e,i),it(i,{validation:"emoji",code:Je.invalid_string,message:a.message}),r.dirty());else if(a.kind==="uuid")rG.test(e.data)||(i=this._getOrReturnCtx(e,i),it(i,{validation:"uuid",code:Je.invalid_string,message:a.message}),r.dirty());else if(a.kind==="nanoid")iG.test(e.data)||(i=this._getOrReturnCtx(e,i),it(i,{validation:"nanoid",code:Je.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid")eG.test(e.data)||(i=this._getOrReturnCtx(e,i),it(i,{validation:"cuid",code:Je.invalid_string,message:a.message}),r.dirty());else if(a.kind==="cuid2")tG.test(e.data)||(i=this._getOrReturnCtx(e,i),it(i,{validation:"cuid2",code:Je.invalid_string,message:a.message}),r.dirty());else if(a.kind==="ulid")nG.test(e.data)||(i=this._getOrReturnCtx(e,i),it(i,{validation:"ulid",code:Je.invalid_string,message:a.message}),r.dirty());else if(a.kind==="url")try{new URL(e.data)}catch{i=this._getOrReturnCtx(e,i),it(i,{validation:"url",code:Je.invalid_string,message:a.message}),r.dirty()}else a.kind==="regex"?(a.regex.lastIndex=0,a.regex.test(e.data)||(i=this._getOrReturnCtx(e,i),it(i,{validation:"regex",code:Je.invalid_string,message:a.message}),r.dirty())):a.kind==="trim"?e.data=e.data.trim():a.kind==="includes"?e.data.includes(a.value,a.position)||(i=this._getOrReturnCtx(e,i),it(i,{code:Je.invalid_string,validation:{includes:a.value,position:a.position},message:a.message}),r.dirty()):a.kind==="toLowerCase"?e.data=e.data.toLowerCase():a.kind==="toUpperCase"?e.data=e.data.toUpperCase():a.kind==="startsWith"?e.data.startsWith(a.value)||(i=this._getOrReturnCtx(e,i),it(i,{code:Je.invalid_string,validation:{startsWith:a.value},message:a.message}),r.dirty()):a.kind==="endsWith"?e.data.endsWith(a.value)||(i=this._getOrReturnCtx(e,i),it(i,{code:Je.invalid_string,validation:{endsWith:a.value},message:a.message}),r.dirty()):a.kind==="datetime"?yG(a).test(e.data)||(i=this._getOrReturnCtx(e,i),it(i,{code:Je.invalid_string,validation:"datetime",message:a.message}),r.dirty()):a.kind==="date"?mG.test(e.data)||(i=this._getOrReturnCtx(e,i),it(i,{code:Je.invalid_string,validation:"date",message:a.message}),r.dirty()):a.kind==="time"?gG(a).test(e.data)||(i=this._getOrReturnCtx(e,i),it(i,{code:Je.invalid_string,validation:"time",message:a.message}),r.dirty()):a.kind==="duration"?sG.test(e.data)||(i=this._getOrReturnCtx(e,i),it(i,{validation:"duration",code:Je.invalid_string,message:a.message}),r.dirty()):a.kind==="ip"?vG(e.data,a.version)||(i=this._getOrReturnCtx(e,i),it(i,{validation:"ip",code:Je.invalid_string,message:a.message}),r.dirty()):a.kind==="jwt"?_G(e.data,a.alg)||(i=this._getOrReturnCtx(e,i),it(i,{validation:"jwt",code:Je.invalid_string,message:a.message}),r.dirty()):a.kind==="cidr"?bG(e.data,a.version)||(i=this._getOrReturnCtx(e,i),it(i,{validation:"cidr",code:Je.invalid_string,message:a.message}),r.dirty()):a.kind==="base64"?hG.test(e.data)||(i=this._getOrReturnCtx(e,i),it(i,{validation:"base64",code:Je.invalid_string,message:a.message}),r.dirty()):a.kind==="base64url"?pG.test(e.data)||(i=this._getOrReturnCtx(e,i),it(i,{validation:"base64url",code:Je.invalid_string,message:a.message}),r.dirty()):Zt.assertNever(a);return{status:r.value,value:e.data}}_regex(e,t,r){return this.refinement(i=>e.test(i),{validation:t,code:Je.invalid_string,...ct.errToObj(r)})}_addCheck(e){return new Ls({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...ct.errToObj(e)})}url(e){return this._addCheck({kind:"url",...ct.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...ct.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...ct.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...ct.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...ct.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...ct.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...ct.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...ct.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...ct.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...ct.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...ct.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...ct.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...ct.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:typeof(e==null?void 0:e.precision)>"u"?null:e==null?void 0:e.precision,...ct.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...ct.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...ct.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t==null?void 0:t.position,...ct.errToObj(t==null?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...ct.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...ct.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...ct.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...ct.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...ct.errToObj(t)})}nonempty(e){return this.min(1,ct.errToObj(e))}trim(){return new Ls({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ls({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ls({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Ls.create=n=>new Ls({checks:[],typeName:De.ZodString,coerce:(n==null?void 0:n.coerce)??!1,...Lt(n)});function wG(n,e){const t=(n.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,i=t>r?t:r,a=Number.parseInt(n.toFixed(i).replace(".","")),s=Number.parseInt(e.toFixed(i).replace(".",""));return a%s/10**i}class qu extends Gt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==st.number){const a=this._getOrReturnCtx(e);return it(a,{code:Je.invalid_type,expected:st.number,received:a.parsedType}),At}let r;const i=new pi;for(const a of this._def.checks)a.kind==="int"?Zt.isInteger(e.data)||(r=this._getOrReturnCtx(e,r),it(r,{code:Je.invalid_type,expected:"integer",received:"float",message:a.message}),i.dirty()):a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),it(r,{code:Je.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),it(r,{code:Je.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),i.dirty()):a.kind==="multipleOf"?wG(e.data,a.value)!==0&&(r=this._getOrReturnCtx(e,r),it(r,{code:Je.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):a.kind==="finite"?Number.isFinite(e.data)||(r=this._getOrReturnCtx(e,r),it(r,{code:Je.not_finite,message:a.message}),i.dirty()):Zt.assertNever(a);return{status:i.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,ct.toString(t))}gt(e,t){return this.setLimit("min",e,!1,ct.toString(t))}lte(e,t){return this.setLimit("max",e,!0,ct.toString(t))}lt(e,t){return this.setLimit("max",e,!1,ct.toString(t))}setLimit(e,t,r,i){return new qu({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:ct.toString(i)}]})}_addCheck(e){return new qu({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:ct.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:ct.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:ct.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:ct.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:ct.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:ct.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:ct.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:ct.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:ct.toString(e)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&Zt.isInteger(e.value))}get isFinite(){let e=null,t=null;for(const r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(t===null||r.value>t)&&(t=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}qu.create=n=>new qu({checks:[],typeName:De.ZodNumber,coerce:(n==null?void 0:n.coerce)||!1,...Lt(n)});class Vu extends Gt{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==st.bigint)return this._getInvalidInput(e);let r;const i=new pi;for(const a of this._def.checks)a.kind==="min"?(a.inclusive?e.data<a.value:e.data<=a.value)&&(r=this._getOrReturnCtx(e,r),it(r,{code:Je.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="max"?(a.inclusive?e.data>a.value:e.data>=a.value)&&(r=this._getOrReturnCtx(e,r),it(r,{code:Je.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),i.dirty()):a.kind==="multipleOf"?e.data%a.value!==BigInt(0)&&(r=this._getOrReturnCtx(e,r),it(r,{code:Je.not_multiple_of,multipleOf:a.value,message:a.message}),i.dirty()):Zt.assertNever(a);return{status:i.value,value:e.data}}_getInvalidInput(e){const t=this._getOrReturnCtx(e);return it(t,{code:Je.invalid_type,expected:st.bigint,received:t.parsedType}),At}gte(e,t){return this.setLimit("min",e,!0,ct.toString(t))}gt(e,t){return this.setLimit("min",e,!1,ct.toString(t))}lte(e,t){return this.setLimit("max",e,!0,ct.toString(t))}lt(e,t){return this.setLimit("max",e,!1,ct.toString(t))}setLimit(e,t,r,i){return new Vu({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:ct.toString(i)}]})}_addCheck(e){return new Vu({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:ct.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:ct.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:ct.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:ct.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:ct.toString(t)})}get minValue(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e}}Vu.create=n=>new Vu({checks:[],typeName:De.ZodBigInt,coerce:(n==null?void 0:n.coerce)??!1,...Lt(n)});class xv extends Gt{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==st.boolean){const r=this._getOrReturnCtx(e);return it(r,{code:Je.invalid_type,expected:st.boolean,received:r.parsedType}),At}return Ua(e.data)}}xv.create=n=>new xv({typeName:De.ZodBoolean,coerce:(n==null?void 0:n.coerce)||!1,...Lt(n)});class Qf extends Gt{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==st.date){const a=this._getOrReturnCtx(e);return it(a,{code:Je.invalid_type,expected:st.date,received:a.parsedType}),At}if(Number.isNaN(e.data.getTime())){const a=this._getOrReturnCtx(e);return it(a,{code:Je.invalid_date}),At}const r=new pi;let i;for(const a of this._def.checks)a.kind==="min"?e.data.getTime()<a.value&&(i=this._getOrReturnCtx(e,i),it(i,{code:Je.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):a.kind==="max"?e.data.getTime()>a.value&&(i=this._getOrReturnCtx(e,i),it(i,{code:Je.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):Zt.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Qf({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:ct.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:ct.toString(t)})}get minDate(){let e=null;for(const t of this._def.checks)t.kind==="min"&&(e===null||t.value>e)&&(e=t.value);return e!=null?new Date(e):null}get maxDate(){let e=null;for(const t of this._def.checks)t.kind==="max"&&(e===null||t.value<e)&&(e=t.value);return e!=null?new Date(e):null}}Qf.create=n=>new Qf({checks:[],coerce:(n==null?void 0:n.coerce)||!1,typeName:De.ZodDate,...Lt(n)});class oM extends Gt{_parse(e){if(this._getType(e)!==st.symbol){const r=this._getOrReturnCtx(e);return it(r,{code:Je.invalid_type,expected:st.symbol,received:r.parsedType}),At}return Ua(e.data)}}oM.create=n=>new oM({typeName:De.ZodSymbol,...Lt(n)});class HC extends Gt{_parse(e){if(this._getType(e)!==st.undefined){const r=this._getOrReturnCtx(e);return it(r,{code:Je.invalid_type,expected:st.undefined,received:r.parsedType}),At}return Ua(e.data)}}HC.create=n=>new HC({typeName:De.ZodUndefined,...Lt(n)});class Ov extends Gt{_parse(e){if(this._getType(e)!==st.null){const r=this._getOrReturnCtx(e);return it(r,{code:Je.invalid_type,expected:st.null,received:r.parsedType}),At}return Ua(e.data)}}Ov.create=n=>new Ov({typeName:De.ZodNull,...Lt(n)});class GC extends Gt{constructor(){super(...arguments),this._any=!0}_parse(e){return Ua(e.data)}}GC.create=n=>new GC({typeName:De.ZodAny,...Lt(n)});class WC extends Gt{constructor(){super(...arguments),this._unknown=!0}_parse(e){return Ua(e.data)}}WC.create=n=>new WC({typeName:De.ZodUnknown,...Lt(n)});class Do extends Gt{_parse(e){const t=this._getOrReturnCtx(e);return it(t,{code:Je.invalid_type,expected:st.never,received:t.parsedType}),At}}Do.create=n=>new Do({typeName:De.ZodNever,...Lt(n)});class lM extends Gt{_parse(e){if(this._getType(e)!==st.undefined){const r=this._getOrReturnCtx(e);return it(r,{code:Je.invalid_type,expected:st.void,received:r.parsedType}),At}return Ua(e.data)}}lM.create=n=>new lM({typeName:De.ZodVoid,...Lt(n)});class Vs extends Gt{_parse(e){const{ctx:t,status:r}=this._processInputParams(e),i=this._def;if(t.parsedType!==st.array)return it(t,{code:Je.invalid_type,expected:st.array,received:t.parsedType}),At;if(i.exactLength!==null){const s=t.data.length>i.exactLength.value,o=t.data.length<i.exactLength.value;(s||o)&&(it(t,{code:s?Je.too_big:Je.too_small,minimum:o?i.exactLength.value:void 0,maximum:s?i.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:i.exactLength.message}),r.dirty())}if(i.minLength!==null&&t.data.length<i.minLength.value&&(it(t,{code:Je.too_small,minimum:i.minLength.value,type:"array",inclusive:!0,exact:!1,message:i.minLength.message}),r.dirty()),i.maxLength!==null&&t.data.length>i.maxLength.value&&(it(t,{code:Je.too_big,maximum:i.maxLength.value,type:"array",inclusive:!0,exact:!1,message:i.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((s,o)=>i.type._parseAsync(new Ws(t,s,t.path,o)))).then(s=>pi.mergeArray(r,s));const a=[...t.data].map((s,o)=>i.type._parseSync(new Ws(t,s,t.path,o)));return pi.mergeArray(r,a)}get element(){return this._def.type}min(e,t){return new Vs({...this._def,minLength:{value:e,message:ct.toString(t)}})}max(e,t){return new Vs({...this._def,maxLength:{value:e,message:ct.toString(t)}})}length(e,t){return new Vs({...this._def,exactLength:{value:e,message:ct.toString(t)}})}nonempty(e){return this.min(1,e)}}Vs.create=(n,e)=>new Vs({type:n,minLength:null,maxLength:null,exactLength:null,typeName:De.ZodArray,...Lt(e)});function df(n){if(n instanceof Qn){const e={};for(const t in n.shape){const r=n.shape[t];e[t]=zs.create(df(r))}return new Qn({...n._def,shape:()=>e})}else return n instanceof Vs?new Vs({...n._def,type:df(n.element)}):n instanceof zs?zs.create(df(n.unwrap())):n instanceof $o?$o.create(df(n.unwrap())):n instanceof zu?zu.create(n.items.map(e=>df(e))):n}class Qn extends Gt{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;const e=this._def.shape(),t=Zt.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==st.object){const c=this._getOrReturnCtx(e);return it(c,{code:Je.invalid_type,expected:st.object,received:c.parsedType}),At}const{status:r,ctx:i}=this._processInputParams(e),{shape:a,keys:s}=this._getCached(),o=[];if(!(this._def.catchall instanceof Do&&this._def.unknownKeys==="strip"))for(const c in i.data)s.includes(c)||o.push(c);const u=[];for(const c of s){const d=a[c],p=i.data[c];u.push({key:{status:"valid",value:c},value:d._parse(new Ws(i,p,i.path,c)),alwaysSet:c in i.data})}if(this._def.catchall instanceof Do){const c=this._def.unknownKeys;if(c==="passthrough")for(const d of o)u.push({key:{status:"valid",value:d},value:{status:"valid",value:i.data[d]}});else if(c==="strict")o.length>0&&(it(i,{code:Je.unrecognized_keys,keys:o}),r.dirty());else if(c!=="strip")throw new Error("Internal ZodObject error: invalid unknownKeys value.")}else{const c=this._def.catchall;for(const d of o){const p=i.data[d];u.push({key:{status:"valid",value:d},value:c._parse(new Ws(i,p,i.path,d)),alwaysSet:d in i.data})}}return i.common.async?Promise.resolve().then(async()=>{const c=[];for(const d of u){const p=await d.key,m=await d.value;c.push({key:p,value:m,alwaysSet:d.alwaysSet})}return c}).then(c=>pi.mergeObjectSync(r,c)):pi.mergeObjectSync(r,u)}get shape(){return this._def.shape()}strict(e){return ct.errToObj,new Qn({...this._def,unknownKeys:"strict",...e!==void 0?{errorMap:(t,r)=>{var a,s;const i=((s=(a=this._def).errorMap)==null?void 0:s.call(a,t,r).message)??r.defaultError;return t.code==="unrecognized_keys"?{message:ct.errToObj(e).message??i}:{message:i}}}:{}})}strip(){return new Qn({...this._def,unknownKeys:"strip"})}passthrough(){return new Qn({...this._def,unknownKeys:"passthrough"})}extend(e){return new Qn({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Qn({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:De.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new Qn({...this._def,catchall:e})}pick(e){const t={};for(const r of Zt.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new Qn({...this._def,shape:()=>t})}omit(e){const t={};for(const r of Zt.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new Qn({...this._def,shape:()=>t})}deepPartial(){return df(this)}partial(e){const t={};for(const r of Zt.objectKeys(this.shape)){const i=this.shape[r];e&&!e[r]?t[r]=i:t[r]=i.optional()}return new Qn({...this._def,shape:()=>t})}required(e){const t={};for(const r of Zt.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let a=this.shape[r];for(;a instanceof zs;)a=a._def.innerType;t[r]=a}return new Qn({...this._def,shape:()=>t})}keyof(){return zF(Zt.objectKeys(this.shape))}}Qn.create=(n,e)=>new Qn({shape:()=>n,unknownKeys:"strip",catchall:Do.create(),typeName:De.ZodObject,...Lt(e)});Qn.strictCreate=(n,e)=>new Qn({shape:()=>n,unknownKeys:"strict",catchall:Do.create(),typeName:De.ZodObject,...Lt(e)});Qn.lazycreate=(n,e)=>new Qn({shape:n,unknownKeys:"strip",catchall:Do.create(),typeName:De.ZodObject,...Lt(e)});class Nv extends Gt{_parse(e){const{ctx:t}=this._processInputParams(e),r=this._def.options;function i(a){for(const o of a)if(o.result.status==="valid")return o.result;for(const o of a)if(o.result.status==="dirty")return t.common.issues.push(...o.ctx.common.issues),o.result;const s=a.map(o=>new Mo(o.ctx.common.issues));return it(t,{code:Je.invalid_union,unionErrors:s}),At}if(t.common.async)return Promise.all(r.map(async a=>{const s={...t,common:{...t.common,issues:[]},parent:null};return{result:await a._parseAsync({data:t.data,path:t.path,parent:s}),ctx:s}})).then(i);{let a;const s=[];for(const u of r){const c={...t,common:{...t.common,issues:[]},parent:null},d=u._parseSync({data:t.data,path:t.path,parent:c});if(d.status==="valid")return d;d.status==="dirty"&&!a&&(a={result:d,ctx:c}),c.common.issues.length&&s.push(c.common.issues)}if(a)return t.common.issues.push(...a.ctx.common.issues),a.result;const o=s.map(u=>new Mo(u));return it(t,{code:Je.invalid_union,unionErrors:o}),At}}get options(){return this._def.options}}Nv.create=(n,e)=>new Nv({options:n,typeName:De.ZodUnion,...Lt(e)});const _o=n=>n instanceof Dv?_o(n.schema):n instanceof Gu?_o(n.innerType()):n instanceof $v?[n.value]:n instanceof Hu?n.options:n instanceof JC?Zt.objectValues(n.enum):n instanceof Op?_o(n._def.innerType):n instanceof HC?[void 0]:n instanceof Ov?[null]:n instanceof zs?[void 0,..._o(n.unwrap())]:n instanceof $o?[null,..._o(n.unwrap())]:n instanceof HF||n instanceof jv?_o(n.unwrap()):n instanceof Uv?_o(n._def.innerType):[];class LR extends Gt{_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==st.object)return it(t,{code:Je.invalid_type,expected:st.object,received:t.parsedType}),At;const r=this.discriminator,i=t.data[r],a=this.optionsMap.get(i);return a?t.common.async?a._parseAsync({data:t.data,path:t.path,parent:t}):a._parseSync({data:t.data,path:t.path,parent:t}):(it(t,{code:Je.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),At)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){const i=new Map;for(const a of t){const s=_o(a.shape[e]);if(!s.length)throw new Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(const o of s){if(i.has(o))throw new Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);i.set(o,a)}}return new LR({typeName:De.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:i,...Lt(r)})}}function KC(n,e){const t=wl(n),r=wl(e);if(n===e)return{valid:!0,data:n};if(t===st.object&&r===st.object){const i=Zt.objectKeys(e),a=Zt.objectKeys(n).filter(o=>i.indexOf(o)!==-1),s={...n,...e};for(const o of a){const u=KC(n[o],e[o]);if(!u.valid)return{valid:!1};s[o]=u.data}return{valid:!0,data:s}}else if(t===st.array&&r===st.array){if(n.length!==e.length)return{valid:!1};const i=[];for(let a=0;a<n.length;a++){const s=n[a],o=e[a],u=KC(s,o);if(!u.valid)return{valid:!1};i.push(u.data)}return{valid:!0,data:i}}else return t===st.date&&r===st.date&&+n==+e?{valid:!0,data:n}:{valid:!1}}class kv extends Gt{_parse(e){const{status:t,ctx:r}=this._processInputParams(e),i=(a,s)=>{if(iM(a)||iM(s))return At;const o=KC(a.value,s.value);return o.valid?((aM(a)||aM(s))&&t.dirty(),{status:t.value,value:o.data}):(it(r,{code:Je.invalid_intersection_types}),At)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([a,s])=>i(a,s)):i(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}kv.create=(n,e,t)=>new kv({left:n,right:e,typeName:De.ZodIntersection,...Lt(t)});class zu extends Gt{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==st.array)return it(r,{code:Je.invalid_type,expected:st.array,received:r.parsedType}),At;if(r.data.length<this._def.items.length)return it(r,{code:Je.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),At;!this._def.rest&&r.data.length>this._def.items.length&&(it(r,{code:Je.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());const a=[...r.data].map((s,o)=>{const u=this._def.items[o]||this._def.rest;return u?u._parse(new Ws(r,s,r.path,o)):null}).filter(s=>!!s);return r.common.async?Promise.all(a).then(s=>pi.mergeArray(t,s)):pi.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new zu({...this._def,rest:e})}}zu.create=(n,e)=>{if(!Array.isArray(n))throw new Error("You must pass an array of schemas to z.tuple([ ... ])");return new zu({items:n,typeName:De.ZodTuple,rest:null,...Lt(e)})};class Mv extends Gt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==st.object)return it(r,{code:Je.invalid_type,expected:st.object,received:r.parsedType}),At;const i=[],a=this._def.keyType,s=this._def.valueType;for(const o in r.data)i.push({key:a._parse(new Ws(r,o,r.path,o)),value:s._parse(new Ws(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?pi.mergeObjectAsync(t,i):pi.mergeObjectSync(t,i)}get element(){return this._def.valueType}static create(e,t,r){return t instanceof Gt?new Mv({keyType:e,valueType:t,typeName:De.ZodRecord,...Lt(r)}):new Mv({keyType:Ls.create(),valueType:e,typeName:De.ZodRecord,...Lt(t)})}}class uM extends Gt{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==st.map)return it(r,{code:Je.invalid_type,expected:st.map,received:r.parsedType}),At;const i=this._def.keyType,a=this._def.valueType,s=[...r.data.entries()].map(([o,u],c)=>({key:i._parse(new Ws(r,o,r.path,[c,"key"])),value:a._parse(new Ws(r,u,r.path,[c,"value"]))}));if(r.common.async){const o=new Map;return Promise.resolve().then(async()=>{for(const u of s){const c=await u.key,d=await u.value;if(c.status==="aborted"||d.status==="aborted")return At;(c.status==="dirty"||d.status==="dirty")&&t.dirty(),o.set(c.value,d.value)}return{status:t.value,value:o}})}else{const o=new Map;for(const u of s){const c=u.key,d=u.value;if(c.status==="aborted"||d.status==="aborted")return At;(c.status==="dirty"||d.status==="dirty")&&t.dirty(),o.set(c.value,d.value)}return{status:t.value,value:o}}}}uM.create=(n,e,t)=>new uM({valueType:e,keyType:n,typeName:De.ZodMap,...Lt(t)});class xp extends Gt{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==st.set)return it(r,{code:Je.invalid_type,expected:st.set,received:r.parsedType}),At;const i=this._def;i.minSize!==null&&r.data.size<i.minSize.value&&(it(r,{code:Je.too_small,minimum:i.minSize.value,type:"set",inclusive:!0,exact:!1,message:i.minSize.message}),t.dirty()),i.maxSize!==null&&r.data.size>i.maxSize.value&&(it(r,{code:Je.too_big,maximum:i.maxSize.value,type:"set",inclusive:!0,exact:!1,message:i.maxSize.message}),t.dirty());const a=this._def.valueType;function s(u){const c=new Set;for(const d of u){if(d.status==="aborted")return At;d.status==="dirty"&&t.dirty(),c.add(d.value)}return{status:t.value,value:c}}const o=[...r.data.values()].map((u,c)=>a._parse(new Ws(r,u,r.path,c)));return r.common.async?Promise.all(o).then(u=>s(u)):s(o)}min(e,t){return new xp({...this._def,minSize:{value:e,message:ct.toString(t)}})}max(e,t){return new xp({...this._def,maxSize:{value:e,message:ct.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}xp.create=(n,e)=>new xp({valueType:n,minSize:null,maxSize:null,typeName:De.ZodSet,...Lt(e)});class Dv extends Gt{get schema(){return this._def.getter()}_parse(e){const{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}Dv.create=(n,e)=>new Dv({getter:n,typeName:De.ZodLazy,...Lt(e)});class $v extends Gt{_parse(e){if(e.data!==this._def.value){const t=this._getOrReturnCtx(e);return it(t,{received:t.data,code:Je.invalid_literal,expected:this._def.value}),At}return{status:"valid",value:e.data}}get value(){return this._def.value}}$v.create=(n,e)=>new $v({value:n,typeName:De.ZodLiteral,...Lt(e)});function zF(n,e){return new Hu({values:n,typeName:De.ZodEnum,...Lt(e)})}class Hu extends Gt{_parse(e){if(typeof e.data!="string"){const t=this._getOrReturnCtx(e),r=this._def.values;return it(t,{expected:Zt.joinValues(r),received:t.parsedType,code:Je.invalid_type}),At}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){const t=this._getOrReturnCtx(e),r=this._def.values;return it(t,{received:t.data,code:Je.invalid_enum_value,options:r}),At}return Ua(e.data)}get options(){return this._def.values}get enum(){const e={};for(const t of this._def.values)e[t]=t;return e}get Values(){const e={};for(const t of this._def.values)e[t]=t;return e}get Enum(){const e={};for(const t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return Hu.create(e,{...this._def,...t})}exclude(e,t=this._def){return Hu.create(this.options.filter(r=>!e.includes(r)),{...this._def,...t})}}Hu.create=zF;class JC extends Gt{_parse(e){const t=Zt.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==st.string&&r.parsedType!==st.number){const i=Zt.objectValues(t);return it(r,{expected:Zt.joinValues(i),received:r.parsedType,code:Je.invalid_type}),At}if(this._cache||(this._cache=new Set(Zt.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){const i=Zt.objectValues(t);return it(r,{received:r.data,code:Je.invalid_enum_value,options:i}),At}return Ua(e.data)}get enum(){return this._def.values}}JC.create=(n,e)=>new JC({values:n,typeName:De.ZodNativeEnum,...Lt(e)});class Lv extends Gt{unwrap(){return this._def.type}_parse(e){const{ctx:t}=this._processInputParams(e);if(t.parsedType!==st.promise&&t.common.async===!1)return it(t,{code:Je.invalid_type,expected:st.promise,received:t.parsedType}),At;const r=t.parsedType===st.promise?t.data:Promise.resolve(t.data);return Ua(r.then(i=>this._def.type.parseAsync(i,{path:t.path,errorMap:t.common.contextualErrorMap})))}}Lv.create=(n,e)=>new Lv({type:n,typeName:De.ZodPromise,...Lt(e)});class Gu extends Gt{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===De.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){const{status:t,ctx:r}=this._processInputParams(e),i=this._def.effect||null,a={addIssue:s=>{it(r,s),s.fatal?t.abort():t.dirty()},get path(){return r.path}};if(a.addIssue=a.addIssue.bind(a),i.type==="preprocess"){const s=i.transform(r.data,a);if(r.common.async)return Promise.resolve(s).then(async o=>{if(t.value==="aborted")return At;const u=await this._def.schema._parseAsync({data:o,path:r.path,parent:r});return u.status==="aborted"?At:u.status==="dirty"||t.value==="dirty"?Vh(u.value):u});{if(t.value==="aborted")return At;const o=this._def.schema._parseSync({data:s,path:r.path,parent:r});return o.status==="aborted"?At:o.status==="dirty"||t.value==="dirty"?Vh(o.value):o}}if(i.type==="refinement"){const s=o=>{const u=i.refinement(o,a);if(r.common.async)return Promise.resolve(u);if(u instanceof Promise)throw new Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(r.common.async===!1){const o=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return o.status==="aborted"?At:(o.status==="dirty"&&t.dirty(),s(o.value),{status:t.value,value:o.value})}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(o=>o.status==="aborted"?At:(o.status==="dirty"&&t.dirty(),s(o.value).then(()=>({status:t.value,value:o.value}))))}if(i.type==="transform")if(r.common.async===!1){const s=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!Xf(s))return At;const o=i.transform(s.value,a);if(o instanceof Promise)throw new Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:o}}else return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(s=>Xf(s)?Promise.resolve(i.transform(s.value,a)).then(o=>({status:t.value,value:o})):At);Zt.assertNever(i)}}Gu.create=(n,e,t)=>new Gu({schema:n,typeName:De.ZodEffects,effect:e,...Lt(t)});Gu.createWithPreprocess=(n,e,t)=>new Gu({schema:e,effect:{type:"preprocess",transform:n},typeName:De.ZodEffects,...Lt(t)});class zs extends Gt{_parse(e){return this._getType(e)===st.undefined?Ua(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}zs.create=(n,e)=>new zs({innerType:n,typeName:De.ZodOptional,...Lt(e)});class $o extends Gt{_parse(e){return this._getType(e)===st.null?Ua(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}$o.create=(n,e)=>new $o({innerType:n,typeName:De.ZodNullable,...Lt(e)});class Op extends Gt{_parse(e){const{ctx:t}=this._processInputParams(e);let r=t.data;return t.parsedType===st.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}Op.create=(n,e)=>new Op({innerType:n,typeName:De.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...Lt(e)});class Uv extends Gt{_parse(e){const{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},i=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return Pv(i)?i.then(a=>({status:"valid",value:a.status==="valid"?a.value:this._def.catchValue({get error(){return new Mo(r.common.issues)},input:r.data})})):{status:"valid",value:i.status==="valid"?i.value:this._def.catchValue({get error(){return new Mo(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}Uv.create=(n,e)=>new Uv({innerType:n,typeName:De.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...Lt(e)});class cM extends Gt{_parse(e){if(this._getType(e)!==st.nan){const r=this._getOrReturnCtx(e);return it(r,{code:Je.invalid_type,expected:st.nan,received:r.parsedType}),At}return{status:"valid",value:e.data}}}cM.create=n=>new cM({typeName:De.ZodNaN,...Lt(n)});class HF extends Gt{_parse(e){const{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class UR extends Gt{_parse(e){const{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{const a=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return a.status==="aborted"?At:a.status==="dirty"?(t.dirty(),Vh(a.value)):this._def.out._parseAsync({data:a.value,path:r.path,parent:r})})();{const i=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return i.status==="aborted"?At:i.status==="dirty"?(t.dirty(),{status:"dirty",value:i.value}):this._def.out._parseSync({data:i.value,path:r.path,parent:r})}}static create(e,t){return new UR({in:e,out:t,typeName:De.ZodPipeline})}}class jv extends Gt{_parse(e){const t=this._def.innerType._parse(e),r=i=>(Xf(i)&&(i.value=Object.freeze(i.value)),i);return Pv(t)?t.then(i=>r(i)):r(t)}unwrap(){return this._def.innerType}}jv.create=(n,e)=>new jv({innerType:n,typeName:De.ZodReadonly,...Lt(e)});var De;(function(n){n.ZodString="ZodString",n.ZodNumber="ZodNumber",n.ZodNaN="ZodNaN",n.ZodBigInt="ZodBigInt",n.ZodBoolean="ZodBoolean",n.ZodDate="ZodDate",n.ZodSymbol="ZodSymbol",n.ZodUndefined="ZodUndefined",n.ZodNull="ZodNull",n.ZodAny="ZodAny",n.ZodUnknown="ZodUnknown",n.ZodNever="ZodNever",n.ZodVoid="ZodVoid",n.ZodArray="ZodArray",n.ZodObject="ZodObject",n.ZodUnion="ZodUnion",n.ZodDiscriminatedUnion="ZodDiscriminatedUnion",n.ZodIntersection="ZodIntersection",n.ZodTuple="ZodTuple",n.ZodRecord="ZodRecord",n.ZodMap="ZodMap",n.ZodSet="ZodSet",n.ZodFunction="ZodFunction",n.ZodLazy="ZodLazy",n.ZodLiteral="ZodLiteral",n.ZodEnum="ZodEnum",n.ZodEffects="ZodEffects",n.ZodNativeEnum="ZodNativeEnum",n.ZodOptional="ZodOptional",n.ZodNullable="ZodNullable",n.ZodDefault="ZodDefault",n.ZodCatch="ZodCatch",n.ZodPromise="ZodPromise",n.ZodBranded="ZodBranded",n.ZodPipeline="ZodPipeline",n.ZodReadonly="ZodReadonly"})(De||(De={}));const Me=Ls.create,zn=qu.create;Vu.create;const qr=xv.create;Qf.create;const GF=Ov.create,Pa=GC.create,Wu=WC.create,WF=Do.create,Pt=Vs.create,Xe=Qn.create,An=Nv.create,EG=LR.create;kv.create;const SG=zu.create,ts=Mv.create,TG=Dv.create,Rt=$v.create,ds=Hu.create;Lv.create;const He=zs.create;$o.create;const Xc={string:n=>Ls.create({...n,coerce:!0}),number:n=>qu.create({...n,coerce:!0}),boolean:n=>xv.create({...n,coerce:!0}),bigint:n=>Vu.create({...n,coerce:!0}),date:n=>Qf.create({...n,coerce:!0})};var Sh={exports:{}},tE={},nE,fM;function AG(){if(fM)return nE;fM=1;function n(e,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return nE=n,n.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},n.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},n.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(r===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1);else return!1;var i=this;return this._timer=setTimeout(function(){i._attempts++,i._operationTimeoutCb&&(i._timeout=setTimeout(function(){i._operationTimeoutCb(i._attempts)},i._operationTimeout),i._options.unref&&i._timeout.unref()),i._fn(i._attempts)},r),this._options.unref&&this._timer.unref(),!0},n.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},n.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},n.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},n.prototype.start=n.prototype.try,n.prototype.errors=function(){return this._errors},n.prototype.attempts=function(){return this._attempts},n.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},t=null,r=0,i=0;i<this._errors.length;i++){var a=this._errors[i],s=a.message,o=(e[s]||0)+1;e[s]=o,o>=r&&(t=a,r=o)}return t},nE}var dM;function CG(){return dM||(dM=1,function(n){var e=AG();n.operation=function(t){var r=n.timeouts(t);return new e(r,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},n.timeouts=function(t){if(t instanceof Array)return[].concat(t);var r={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in t)r[i]=t[i];if(r.minTimeout>r.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var a=[],s=0;s<r.retries;s++)a.push(this.createTimeout(s,r));return t&&t.forever&&!a.length&&a.push(this.createTimeout(s,r)),a.sort(function(o,u){return o-u}),a},n.createTimeout=function(t,r){var i=r.randomize?Math.random()+1:1,a=Math.round(i*Math.max(r.minTimeout,1)*Math.pow(r.factor,t));return a=Math.min(a,r.maxTimeout),a},n.wrap=function(t,r,i){if(r instanceof Array&&(i=r,r=null),!i){i=[];for(var a in t)typeof t[a]=="function"&&i.push(a)}for(var s=0;s<i.length;s++){var o=i[s],u=t[o];t[o]=(function(d){var p=n.operation(r),m=Array.prototype.slice.call(arguments,1),y=m.pop();m.push(function(b){p.retry(b)||(b&&(arguments[0]=p.mainError()),y.apply(this,arguments))}),p.attempt(function(){d.apply(t,m)})}).bind(t,u),t[o].options=r}}}(tE)),tE}var rE,hM;function RG(){return hM||(hM=1,rE=CG()),rE}var pM;function IG(){if(pM)return Sh.exports;pM=1;const n=RG(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class t extends Error{constructor(o){super(),o instanceof Error?(this.originalError=o,{message:o}=o):(this.originalError=new Error(o),this.originalError.stack=this.stack),this.name="AbortError",this.message=o}}const r=(s,o,u)=>{const c=u.retries-(o-1);return s.attemptNumber=o,s.retriesLeft=c,s},i=s=>e.includes(s),a=(s,o)=>new Promise((u,c)=>{o={onFailedAttempt:()=>{},retries:10,...o};const d=n.operation(o);d.attempt(async p=>{try{u(await s(p))}catch(m){if(!(m instanceof Error)){c(new TypeError(`Non-error was thrown: "${m}". You should only throw errors.`));return}if(m instanceof t)d.stop(),c(m.originalError);else if(m instanceof TypeError&&!i(m.message))d.stop(),c(m);else{r(m,p,o);try{await o.onFailedAttempt(m)}catch(y){c(y);return}d.retry(m)||c(d.mainError())}}})});return Sh.exports=a,Sh.exports.default=a,Sh.exports.AbortError=t,Sh.exports}var PG=IG();const Fv=Js(PG),xG=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function Gy(n){return typeof n=="string"&&xG.test(n)}var Dr=[];for(var iE=0;iE<256;++iE)Dr.push((iE+256).toString(16).slice(1));function OG(n,e=0){return(Dr[n[e+0]]+Dr[n[e+1]]+Dr[n[e+2]]+Dr[n[e+3]]+"-"+Dr[n[e+4]]+Dr[n[e+5]]+"-"+Dr[n[e+6]]+Dr[n[e+7]]+"-"+Dr[n[e+8]]+Dr[n[e+9]]+"-"+Dr[n[e+10]]+Dr[n[e+11]]+Dr[n[e+12]]+Dr[n[e+13]]+Dr[n[e+14]]+Dr[n[e+15]]).toLowerCase()}var Kg,NG=new Uint8Array(16);function kG(){if(!Kg&&(Kg=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Kg))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Kg(NG)}var MG=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const mM={randomUUID:MG};function Eo(n,e,t){if(mM.randomUUID&&!n)return mM.randomUUID();n=n||{};var r=n.random||(n.rng||kG)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,OG(r)}const DG=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function KF(n){return typeof n=="string"&&DG.test(n)}function $G(n){if(!KF(n))throw TypeError("Invalid UUID");var e,t=new Uint8Array(16);return t[0]=(e=parseInt(n.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(n.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(n.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(n.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var $r=[];for(var aE=0;aE<256;++aE)$r.push((aE+256).toString(16).slice(1));function JF(n,e=0){return($r[n[e+0]]+$r[n[e+1]]+$r[n[e+2]]+$r[n[e+3]]+"-"+$r[n[e+4]]+$r[n[e+5]]+"-"+$r[n[e+6]]+$r[n[e+7]]+"-"+$r[n[e+8]]+$r[n[e+9]]+"-"+$r[n[e+10]]+$r[n[e+11]]+$r[n[e+12]]+$r[n[e+13]]+$r[n[e+14]]+$r[n[e+15]]).toLowerCase()}var Jg,LG=new Uint8Array(16);function UG(){if(!Jg&&(Jg=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Jg))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Jg(LG)}function jG(n){n=unescape(encodeURIComponent(n));for(var e=[],t=0;t<n.length;++t)e.push(n.charCodeAt(t));return e}var FG="6ba7b810-9dad-11d1-80b4-00c04fd430c8",BG="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function qG(n,e,t){function r(i,a,s,o){var u;if(typeof i=="string"&&(i=jG(i)),typeof a=="string"&&(a=$G(a)),((u=a)===null||u===void 0?void 0:u.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var c=new Uint8Array(16+i.length);if(c.set(a),c.set(i,a.length),c=t(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,s){o=o||0;for(var d=0;d<16;++d)s[o+d]=c[d];return s}return JF(c)}try{r.name=n}catch{}return r.DNS=FG,r.URL=BG,r}var VG=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const gM={randomUUID:VG};function hf(n,e,t){if(gM.randomUUID&&!n)return gM.randomUUID();n=n||{};var r=n.random||(n.rng||UG)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,JF(r)}function zG(n,e,t,r){switch(n){case 0:return e&t^~e&r;case 1:return e^t^r;case 2:return e&t^e&r^t&r;case 3:return e^t^r}}function sE(n,e){return n<<e|n>>>32-e}function HG(n){var e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){var r=unescape(encodeURIComponent(n));n=[];for(var i=0;i<r.length;++i)n.push(r.charCodeAt(i))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);for(var a=n.length/4+2,s=Math.ceil(a/16),o=new Array(s),u=0;u<s;++u){for(var c=new Uint32Array(16),d=0;d<16;++d)c[d]=n[u*64+d*4]<<24|n[u*64+d*4+1]<<16|n[u*64+d*4+2]<<8|n[u*64+d*4+3];o[u]=c}o[s-1][14]=(n.length-1)*8/Math.pow(2,32),o[s-1][14]=Math.floor(o[s-1][14]),o[s-1][15]=(n.length-1)*8&4294967295;for(var p=0;p<s;++p){for(var m=new Uint32Array(80),y=0;y<16;++y)m[y]=o[p][y];for(var b=16;b<80;++b)m[b]=sE(m[b-3]^m[b-8]^m[b-14]^m[b-16],1);for(var w=t[0],S=t[1],T=t[2],C=t[3],A=t[4],I=0;I<80;++I){var x=Math.floor(I/20),L=sE(w,5)+zG(x,S,T,C)+A+e[x]+m[I]>>>0;A=C,C=T,T=sE(S,30)>>>0,S=w,w=L}t[0]=t[0]+w>>>0,t[1]=t[1]+S>>>0,t[2]=t[2]+T>>>0,t[3]=t[3]+C>>>0,t[4]=t[4]+A>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var yM=qG("v5",80,HG),Yg={},oE={exports:{}},vM;function GG(){return vM||(vM=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function i(u,c,d){this.fn=u,this.context=c,this.once=d||!1}function a(u,c,d,p,m){if(typeof d!="function")throw new TypeError("The listener must be a function");var y=new i(d,p||u,m),b=t?t+c:c;return u._events[b]?u._events[b].fn?u._events[b]=[u._events[b],y]:u._events[b].push(y):(u._events[b]=y,u._eventsCount++),u}function s(u,c){--u._eventsCount===0?u._events=new r:delete u._events[c]}function o(){this._events=new r,this._eventsCount=0}o.prototype.eventNames=function(){var c=[],d,p;if(this._eventsCount===0)return c;for(p in d=this._events)e.call(d,p)&&c.push(t?p.slice(1):p);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(d)):c},o.prototype.listeners=function(c){var d=t?t+c:c,p=this._events[d];if(!p)return[];if(p.fn)return[p.fn];for(var m=0,y=p.length,b=new Array(y);m<y;m++)b[m]=p[m].fn;return b},o.prototype.listenerCount=function(c){var d=t?t+c:c,p=this._events[d];return p?p.fn?1:p.length:0},o.prototype.emit=function(c,d,p,m,y,b){var w=t?t+c:c;if(!this._events[w])return!1;var S=this._events[w],T=arguments.length,C,A;if(S.fn){switch(S.once&&this.removeListener(c,S.fn,void 0,!0),T){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,d),!0;case 3:return S.fn.call(S.context,d,p),!0;case 4:return S.fn.call(S.context,d,p,m),!0;case 5:return S.fn.call(S.context,d,p,m,y),!0;case 6:return S.fn.call(S.context,d,p,m,y,b),!0}for(A=1,C=new Array(T-1);A<T;A++)C[A-1]=arguments[A];S.fn.apply(S.context,C)}else{var I=S.length,x;for(A=0;A<I;A++)switch(S[A].once&&this.removeListener(c,S[A].fn,void 0,!0),T){case 1:S[A].fn.call(S[A].context);break;case 2:S[A].fn.call(S[A].context,d);break;case 3:S[A].fn.call(S[A].context,d,p);break;case 4:S[A].fn.call(S[A].context,d,p,m);break;default:if(!C)for(x=1,C=new Array(T-1);x<T;x++)C[x-1]=arguments[x];S[A].fn.apply(S[A].context,C)}}return!0},o.prototype.on=function(c,d,p){return a(this,c,d,p,!1)},o.prototype.once=function(c,d,p){return a(this,c,d,p,!0)},o.prototype.removeListener=function(c,d,p,m){var y=t?t+c:c;if(!this._events[y])return this;if(!d)return s(this,y),this;var b=this._events[y];if(b.fn)b.fn===d&&(!m||b.once)&&(!p||b.context===p)&&s(this,y);else{for(var w=0,S=[],T=b.length;w<T;w++)(b[w].fn!==d||m&&!b[w].once||p&&b[w].context!==p)&&S.push(b[w]);S.length?this._events[y]=S.length===1?S[0]:S:s(this,y)}return this},o.prototype.removeAllListeners=function(c){var d;return c?(d=t?t+c:c,this._events[d]&&s(this,d)):(this._events=new r,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=t,o.EventEmitter=o,n.exports=o}(oE)),oE.exports}var Th={exports:{}},lE,_M;function WG(){return _M||(_M=1,lE=(n,e)=>(e=e||(()=>{}),n.then(t=>new Promise(r=>{r(e())}).then(()=>t),t=>new Promise(r=>{r(e())}).then(()=>{throw t})))),lE}var bM;function KG(){if(bM)return Th.exports;bM=1;const n=WG();class e extends Error{constructor(i){super(i),this.name="TimeoutError"}}const t=(r,i,a)=>new Promise((s,o)=>{if(typeof i!="number"||i<0)throw new TypeError("Expected `milliseconds` to be a positive number");if(i===1/0){s(r);return}const u=setTimeout(()=>{if(typeof a=="function"){try{s(a())}catch(p){o(p)}return}const c=typeof a=="string"?a:`Promise timed out after ${i} milliseconds`,d=a instanceof Error?a:new e(c);typeof r.cancel=="function"&&r.cancel(),o(d)},i);n(r.then(s,o),()=>{clearTimeout(u)})});return Th.exports=t,Th.exports.default=t,Th.exports.TimeoutError=e,Th.exports}var Zg={},Xg={},wM;function JG(){if(wM)return Xg;wM=1,Object.defineProperty(Xg,"__esModule",{value:!0});function n(e,t,r){let i=0,a=e.length;for(;a>0;){const s=a/2|0;let o=i+s;r(e[o],t)<=0?(i=++o,a-=s+1):a=s}return i}return Xg.default=n,Xg}var EM;function YG(){if(EM)return Zg;EM=1,Object.defineProperty(Zg,"__esModule",{value:!0});const n=JG();class e{constructor(){this._queue=[]}enqueue(r,i){i=Object.assign({priority:0},i);const a={priority:i.priority,run:r};if(this.size&&this._queue[this.size-1].priority>=i.priority){this._queue.push(a);return}const s=n.default(this._queue,a,(o,u)=>u.priority-o.priority);this._queue.splice(s,0,a)}dequeue(){const r=this._queue.shift();return r==null?void 0:r.run}filter(r){return this._queue.filter(i=>i.priority===r.priority).map(i=>i.run)}get size(){return this._queue.length}}return Zg.default=e,Zg}var SM;function ZG(){if(SM)return Yg;SM=1,Object.defineProperty(Yg,"__esModule",{value:!0});const n=GG(),e=KG(),t=YG(),r=()=>{},i=new e.TimeoutError;class a extends n{constructor(o){var u,c,d,p;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=r,this._resolveIdle=r,o=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:t.default},o),!(typeof o.intervalCap=="number"&&o.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${(c=(u=o.intervalCap)===null||u===void 0?void 0:u.toString())!==null&&c!==void 0?c:""}\` (${typeof o.intervalCap})`);if(o.interval===void 0||!(Number.isFinite(o.interval)&&o.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${(p=(d=o.interval)===null||d===void 0?void 0:d.toString())!==null&&p!==void 0?p:""}\` (${typeof o.interval})`);this._carryoverConcurrencyCount=o.carryoverConcurrencyCount,this._isIntervalIgnored=o.intervalCap===1/0||o.interval===0,this._intervalCap=o.intervalCap,this._interval=o.interval,this._queue=new o.queueClass,this._queueClass=o.queueClass,this.concurrency=o.concurrency,this._timeout=o.timeout,this._throwOnTimeout=o.throwOnTimeout===!0,this._isPaused=o.autoStart===!1}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=r,this._pendingCount===0&&(this._resolveIdle(),this._resolveIdle=r,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){const o=Date.now();if(this._intervalId===void 0){const u=this._intervalEnd-o;if(u<0)this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0;else return this._timeoutId===void 0&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},u)),!0}return!1}_tryToStartAnother(){if(this._queue.size===0)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){const o=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){const u=this._queue.dequeue();return u?(this.emit("active"),u(),o&&this._initializeIntervalIfNeeded(),!0):!1}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||this._intervalId!==void 0||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){this._intervalCount===0&&this._pendingCount===0&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(o){if(!(typeof o=="number"&&o>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${o}\` (${typeof o})`);this._concurrency=o,this._processQueue()}async add(o,u={}){return new Promise((c,d)=>{const p=async()=>{this._pendingCount++,this._intervalCount++;try{const m=this._timeout===void 0&&u.timeout===void 0?o():e.default(Promise.resolve(o()),u.timeout===void 0?this._timeout:u.timeout,()=>{(u.throwOnTimeout===void 0?this._throwOnTimeout:u.throwOnTimeout)&&d(i)});c(await m)}catch(m){d(m)}this._next()};this._queue.enqueue(p,u),this._tryToStartAnother(),this.emit("add")})}async addAll(o,u){return Promise.all(o.map(async c=>this.add(c,u)))}start(){return this._isPaused?(this._isPaused=!1,this._processQueue(),this):this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(this._queue.size!==0)return new Promise(o=>{const u=this._resolveEmpty;this._resolveEmpty=()=>{u(),o()}})}async onIdle(){if(!(this._pendingCount===0&&this._queue.size===0))return new Promise(o=>{const u=this._resolveIdle;this._resolveIdle=()=>{u(),o()}})}get size(){return this._queue.size}sizeBy(o){return this._queue.filter(o).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(o){this._timeout=o}}return Yg.default=a,Yg}var XG=ZG();const Po=Js(XG),YF=()=>ns("PROJECT")??Dl("LANGCHAIN_SESSION")??"default",ZF="0.3.34";var up={};let po;const QG=()=>typeof window<"u"&&typeof window.document<"u",e7=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",t7=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),XF=()=>typeof Deno<"u",n7=()=>typeof at<"u"&&typeof at.versions<"u"&&typeof at.versions.node<"u"&&!XF(),r7=()=>po||(QG()?po="browser":n7()?po="node":e7()?po="webworker":t7()?po="jsdom":XF()?po="deno":po="other",po);let uE;function QF(){if(uE===void 0){const n=r7(),e=s7();uE={library:"langsmith",runtime:n,sdk:"langsmith-js",sdk_version:ZF,...e}}return uE}function i7(){const n=a7()||{},e={},t=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION","LANGSMITH_API_KEY","LANGSMITH_ENDPOINT","LANGSMITH_TRACING_V2","LANGSMITH_PROJECT","LANGSMITH_SESSION"];for(const[r,i]of Object.entries(n))(r.startsWith("LANGCHAIN_")||r.startsWith("LANGSMITH_"))&&typeof i=="string"&&!t.includes(r)&&!r.toLowerCase().includes("key")&&!r.toLowerCase().includes("secret")&&!r.toLowerCase().includes("token")&&(r==="LANGCHAIN_REVISION_ID"?e.revision_id=i:e[r]=i);return e}function a7(){try{return typeof at<"u"&&up?Object.entries(up).reduce((n,[e,t])=>(n[e]=String(t),n),{}):void 0}catch{return}}function Dl(n){try{return typeof at<"u"?up==null?void 0:up[n]:void 0}catch{return}}function ns(n){return Dl(`LANGSMITH_${n}`)||Dl(`LANGCHAIN_${n}`)}let cE;function s7(){if(cE!==void 0)return cE;const n=["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"],e={};for(const t of n){const r=Dl(t);r!==void 0&&(e[t]=r)}return cE=e,e}const o7=(...n)=>fetch(...n),eB=Symbol.for("ls:fetch_implementation"),l7=()=>{const n=globalThis[eB];return n?typeof n=="function"&&"Headers"in n&&"Request"in n&&"Response"in n:!1},dt=n=>async(...e)=>{if(n||ns("DEBUG")==="true"){const[r,i]=e;console.log(`→ ${(i==null?void 0:i.method)||"GET"} ${r}`)}const t=await(globalThis[eB]??o7)(...e);return(n||ns("DEBUG")==="true")&&console.log(`← ${t.status} ${t.statusText} ${t.url}`),t},u7=[400,401,403,404,405,406,407,408],c7=[409];let TM=class{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.debug=e.debug,"default"in Po?this.queue=new Po.default({concurrency:this.maxConcurrency}):this.queue=new Po({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e==null?void 0:e.onFailedResponseHook}call(e,...t){const r=this.onFailedResponseHook;return this.queue.add(()=>Fv(()=>e(...t).catch(i=>{throw i instanceof Error?i:new Error(i)}),{async onFailedAttempt(i){if(i.message.startsWith("Cancel")||i.message.startsWith("TimeoutError")||i.message.startsWith("AbortError")||(i==null?void 0:i.code)==="ECONNABORTED")throw i;const a=i==null?void 0:i.response,s=a==null?void 0:a.status;if(s){if(u7.includes(+s))throw i;if(c7.includes(+s))return;r&&await r(a)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((i,a)=>{var s;(s=e.signal)==null||s.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>dt(this.debug)(...e).then(t=>t.ok?t:Promise.reject(t)))}};function AM(n){return typeof(n==null?void 0:n._getType)=="function"}function CM(n){const e={type:n._getType(),data:{content:n.content}};return n!=null&&n.additional_kwargs&&Object.keys(n.additional_kwargs).length>0&&(e.data.additional_kwargs={...n.additional_kwargs}),e}function Nt(n,e){if(!KF(n)){const t=e!==void 0?`Invalid UUID for ${e}: ${n}`:`Invalid UUID: ${n}`;throw new Error(t)}return n}const RM={};function tB(n){RM[n]||(console.warn(n),RM[n]=!0)}var Qg={exports:{}},fE,IM;function $_(){if(IM)return fE;IM=1;const n="2.0.0",e=256,t=Number.MAX_SAFE_INTEGER||9007199254740991,r=16,i=e-6;return fE={MAX_LENGTH:e,MAX_SAFE_COMPONENT_LENGTH:r,MAX_SAFE_BUILD_LENGTH:i,MAX_SAFE_INTEGER:t,RELEASE_TYPES:["major","premajor","minor","preminor","patch","prepatch","prerelease"],SEMVER_SPEC_VERSION:n,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2},fE}var dE,PM;function L_(){if(PM)return dE;PM=1;var n={};return dE=typeof at=="object"&&n&&n.NODE_DEBUG&&/\bsemver\b/i.test(n.NODE_DEBUG)?(...t)=>console.error("SEMVER",...t):()=>{},dE}var xM;function sm(){return xM||(xM=1,function(n,e){const{MAX_SAFE_COMPONENT_LENGTH:t,MAX_SAFE_BUILD_LENGTH:r,MAX_LENGTH:i}=$_(),a=L_();e=n.exports={};const s=e.re=[],o=e.safeRe=[],u=e.src=[],c=e.safeSrc=[],d=e.t={};let p=0;const m="[a-zA-Z0-9-]",y=[["\\s",1],["\\d",i],[m,r]],b=S=>{for(const[T,C]of y)S=S.split(`${T}*`).join(`${T}{0,${C}}`).split(`${T}+`).join(`${T}{1,${C}}`);return S},w=(S,T,C)=>{const A=b(T),I=p++;a(S,I,T),d[S]=I,u[I]=T,c[I]=A,s[I]=new RegExp(T,C?"g":void 0),o[I]=new RegExp(A,C?"g":void 0)};w("NUMERICIDENTIFIER","0|[1-9]\\d*"),w("NUMERICIDENTIFIERLOOSE","\\d+"),w("NONNUMERICIDENTIFIER",`\\d*[a-zA-Z-]${m}*`),w("MAINVERSION",`(${u[d.NUMERICIDENTIFIER]})\\.(${u[d.NUMERICIDENTIFIER]})\\.(${u[d.NUMERICIDENTIFIER]})`),w("MAINVERSIONLOOSE",`(${u[d.NUMERICIDENTIFIERLOOSE]})\\.(${u[d.NUMERICIDENTIFIERLOOSE]})\\.(${u[d.NUMERICIDENTIFIERLOOSE]})`),w("PRERELEASEIDENTIFIER",`(?:${u[d.NONNUMERICIDENTIFIER]}|${u[d.NUMERICIDENTIFIER]})`),w("PRERELEASEIDENTIFIERLOOSE",`(?:${u[d.NONNUMERICIDENTIFIER]}|${u[d.NUMERICIDENTIFIERLOOSE]})`),w("PRERELEASE",`(?:-(${u[d.PRERELEASEIDENTIFIER]}(?:\\.${u[d.PRERELEASEIDENTIFIER]})*))`),w("PRERELEASELOOSE",`(?:-?(${u[d.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${u[d.PRERELEASEIDENTIFIERLOOSE]})*))`),w("BUILDIDENTIFIER",`${m}+`),w("BUILD",`(?:\\+(${u[d.BUILDIDENTIFIER]}(?:\\.${u[d.BUILDIDENTIFIER]})*))`),w("FULLPLAIN",`v?${u[d.MAINVERSION]}${u[d.PRERELEASE]}?${u[d.BUILD]}?`),w("FULL",`^${u[d.FULLPLAIN]}$`),w("LOOSEPLAIN",`[v=\\s]*${u[d.MAINVERSIONLOOSE]}${u[d.PRERELEASELOOSE]}?${u[d.BUILD]}?`),w("LOOSE",`^${u[d.LOOSEPLAIN]}$`),w("GTLT","((?:<|>)?=?)"),w("XRANGEIDENTIFIERLOOSE",`${u[d.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),w("XRANGEIDENTIFIER",`${u[d.NUMERICIDENTIFIER]}|x|X|\\*`),w("XRANGEPLAIN",`[v=\\s]*(${u[d.XRANGEIDENTIFIER]})(?:\\.(${u[d.XRANGEIDENTIFIER]})(?:\\.(${u[d.XRANGEIDENTIFIER]})(?:${u[d.PRERELEASE]})?${u[d.BUILD]}?)?)?`),w("XRANGEPLAINLOOSE",`[v=\\s]*(${u[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[d.XRANGEIDENTIFIERLOOSE]})(?:\\.(${u[d.XRANGEIDENTIFIERLOOSE]})(?:${u[d.PRERELEASELOOSE]})?${u[d.BUILD]}?)?)?`),w("XRANGE",`^${u[d.GTLT]}\\s*${u[d.XRANGEPLAIN]}$`),w("XRANGELOOSE",`^${u[d.GTLT]}\\s*${u[d.XRANGEPLAINLOOSE]}$`),w("COERCEPLAIN",`(^|[^\\d])(\\d{1,${t}})(?:\\.(\\d{1,${t}}))?(?:\\.(\\d{1,${t}}))?`),w("COERCE",`${u[d.COERCEPLAIN]}(?:$|[^\\d])`),w("COERCEFULL",u[d.COERCEPLAIN]+`(?:${u[d.PRERELEASE]})?(?:${u[d.BUILD]})?(?:$|[^\\d])`),w("COERCERTL",u[d.COERCE],!0),w("COERCERTLFULL",u[d.COERCEFULL],!0),w("LONETILDE","(?:~>?)"),w("TILDETRIM",`(\\s*)${u[d.LONETILDE]}\\s+`,!0),e.tildeTrimReplace="$1~",w("TILDE",`^${u[d.LONETILDE]}${u[d.XRANGEPLAIN]}$`),w("TILDELOOSE",`^${u[d.LONETILDE]}${u[d.XRANGEPLAINLOOSE]}$`),w("LONECARET","(?:\\^)"),w("CARETTRIM",`(\\s*)${u[d.LONECARET]}\\s+`,!0),e.caretTrimReplace="$1^",w("CARET",`^${u[d.LONECARET]}${u[d.XRANGEPLAIN]}$`),w("CARETLOOSE",`^${u[d.LONECARET]}${u[d.XRANGEPLAINLOOSE]}$`),w("COMPARATORLOOSE",`^${u[d.GTLT]}\\s*(${u[d.LOOSEPLAIN]})$|^$`),w("COMPARATOR",`^${u[d.GTLT]}\\s*(${u[d.FULLPLAIN]})$|^$`),w("COMPARATORTRIM",`(\\s*)${u[d.GTLT]}\\s*(${u[d.LOOSEPLAIN]}|${u[d.XRANGEPLAIN]})`,!0),e.comparatorTrimReplace="$1$2$3",w("HYPHENRANGE",`^\\s*(${u[d.XRANGEPLAIN]})\\s+-\\s+(${u[d.XRANGEPLAIN]})\\s*$`),w("HYPHENRANGELOOSE",`^\\s*(${u[d.XRANGEPLAINLOOSE]})\\s+-\\s+(${u[d.XRANGEPLAINLOOSE]})\\s*$`),w("STAR","(<|>)?=?\\s*\\*"),w("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),w("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(Qg,Qg.exports)),Qg.exports}var hE,OM;function jR(){if(OM)return hE;OM=1;const n=Object.freeze({loose:!0}),e=Object.freeze({});return hE=r=>r?typeof r!="object"?n:r:e,hE}var pE,NM;function nB(){if(NM)return pE;NM=1;const n=/^[0-9]+$/,e=(r,i)=>{const a=n.test(r),s=n.test(i);return a&&s&&(r=+r,i=+i),r===i?0:a&&!s?-1:s&&!a?1:r<i?-1:1};return pE={compareIdentifiers:e,rcompareIdentifiers:(r,i)=>e(i,r)},pE}var mE,kM;function mi(){if(kM)return mE;kM=1;const n=L_(),{MAX_LENGTH:e,MAX_SAFE_INTEGER:t}=$_(),{safeRe:r,t:i}=sm(),a=jR(),{compareIdentifiers:s}=nB();class o{constructor(c,d){if(d=a(d),c instanceof o){if(c.loose===!!d.loose&&c.includePrerelease===!!d.includePrerelease)return c;c=c.version}else if(typeof c!="string")throw new TypeError(`Invalid version. Must be a string. Got type "${typeof c}".`);if(c.length>e)throw new TypeError(`version is longer than ${e} characters`);n("SemVer",c,d),this.options=d,this.loose=!!d.loose,this.includePrerelease=!!d.includePrerelease;const p=c.trim().match(d.loose?r[i.LOOSE]:r[i.FULL]);if(!p)throw new TypeError(`Invalid Version: ${c}`);if(this.raw=c,this.major=+p[1],this.minor=+p[2],this.patch=+p[3],this.major>t||this.major<0)throw new TypeError("Invalid major version");if(this.minor>t||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>t||this.patch<0)throw new TypeError("Invalid patch version");p[4]?this.prerelease=p[4].split(".").map(m=>{if(/^[0-9]+$/.test(m)){const y=+m;if(y>=0&&y<t)return y}return m}):this.prerelease=[],this.build=p[5]?p[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(c){if(n("SemVer.compare",this.version,this.options,c),!(c instanceof o)){if(typeof c=="string"&&c===this.version)return 0;c=new o(c,this.options)}return c.version===this.version?0:this.compareMain(c)||this.comparePre(c)}compareMain(c){return c instanceof o||(c=new o(c,this.options)),s(this.major,c.major)||s(this.minor,c.minor)||s(this.patch,c.patch)}comparePre(c){if(c instanceof o||(c=new o(c,this.options)),this.prerelease.length&&!c.prerelease.length)return-1;if(!this.prerelease.length&&c.prerelease.length)return 1;if(!this.prerelease.length&&!c.prerelease.length)return 0;let d=0;do{const p=this.prerelease[d],m=c.prerelease[d];if(n("prerelease compare",d,p,m),p===void 0&&m===void 0)return 0;if(m===void 0)return 1;if(p===void 0)return-1;if(p===m)continue;return s(p,m)}while(++d)}compareBuild(c){c instanceof o||(c=new o(c,this.options));let d=0;do{const p=this.build[d],m=c.build[d];if(n("build compare",d,p,m),p===void 0&&m===void 0)return 0;if(m===void 0)return 1;if(p===void 0)return-1;if(p===m)continue;return s(p,m)}while(++d)}inc(c,d,p){if(c.startsWith("pre")){if(!d&&p===!1)throw new Error("invalid increment argument: identifier is empty");if(d){const m=`-${d}`.match(this.options.loose?r[i.PRERELEASELOOSE]:r[i.PRERELEASE]);if(!m||m[1]!==d)throw new Error(`invalid identifier: ${d}`)}}switch(c){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",d,p);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",d,p);break;case"prepatch":this.prerelease.length=0,this.inc("patch",d,p),this.inc("pre",d,p);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",d,p),this.inc("pre",d,p);break;case"release":if(this.prerelease.length===0)throw new Error(`version ${this.raw} is not a prerelease`);this.prerelease.length=0;break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const m=Number(p)?1:0;if(this.prerelease.length===0)this.prerelease=[m];else{let y=this.prerelease.length;for(;--y>=0;)typeof this.prerelease[y]=="number"&&(this.prerelease[y]++,y=-2);if(y===-1){if(d===this.prerelease.join(".")&&p===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(m)}}if(d){let y=[d,m];p===!1&&(y=[d]),s(this.prerelease[0],d)===0?isNaN(this.prerelease[1])&&(this.prerelease=y):this.prerelease=y}break}default:throw new Error(`invalid increment argument: ${c}`)}return this.raw=this.format(),this.build.length&&(this.raw+=`+${this.build.join(".")}`),this}}return mE=o,mE}var gE,MM;function dd(){if(MM)return gE;MM=1;const n=mi();return gE=(t,r,i=!1)=>{if(t instanceof n)return t;try{return new n(t,r)}catch(a){if(!i)return null;throw a}},gE}var yE,DM;function f7(){if(DM)return yE;DM=1;const n=dd();return yE=(t,r)=>{const i=n(t,r);return i?i.version:null},yE}var vE,$M;function d7(){if($M)return vE;$M=1;const n=dd();return vE=(t,r)=>{const i=n(t.trim().replace(/^[=v]+/,""),r);return i?i.version:null},vE}var _E,LM;function h7(){if(LM)return _E;LM=1;const n=mi();return _E=(t,r,i,a,s)=>{typeof i=="string"&&(s=a,a=i,i=void 0);try{return new n(t instanceof n?t.version:t,i).inc(r,a,s).version}catch{return null}},_E}var bE,UM;function p7(){if(UM)return bE;UM=1;const n=dd();return bE=(t,r)=>{const i=n(t,null,!0),a=n(r,null,!0),s=i.compare(a);if(s===0)return null;const o=s>0,u=o?i:a,c=o?a:i,d=!!u.prerelease.length;if(!!c.prerelease.length&&!d){if(!c.patch&&!c.minor)return"major";if(c.compareMain(u)===0)return c.minor&&!c.patch?"minor":"patch"}const m=d?"pre":"";return i.major!==a.major?m+"major":i.minor!==a.minor?m+"minor":i.patch!==a.patch?m+"patch":"prerelease"},bE}var wE,jM;function m7(){if(jM)return wE;jM=1;const n=mi();return wE=(t,r)=>new n(t,r).major,wE}var EE,FM;function g7(){if(FM)return EE;FM=1;const n=mi();return EE=(t,r)=>new n(t,r).minor,EE}var SE,BM;function y7(){if(BM)return SE;BM=1;const n=mi();return SE=(t,r)=>new n(t,r).patch,SE}var TE,qM;function v7(){if(qM)return TE;qM=1;const n=dd();return TE=(t,r)=>{const i=n(t,r);return i&&i.prerelease.length?i.prerelease:null},TE}var AE,VM;function ys(){if(VM)return AE;VM=1;const n=mi();return AE=(t,r,i)=>new n(t,i).compare(new n(r,i)),AE}var CE,zM;function _7(){if(zM)return CE;zM=1;const n=ys();return CE=(t,r,i)=>n(r,t,i),CE}var RE,HM;function b7(){if(HM)return RE;HM=1;const n=ys();return RE=(t,r)=>n(t,r,!0),RE}var IE,GM;function FR(){if(GM)return IE;GM=1;const n=mi();return IE=(t,r,i)=>{const a=new n(t,i),s=new n(r,i);return a.compare(s)||a.compareBuild(s)},IE}var PE,WM;function w7(){if(WM)return PE;WM=1;const n=FR();return PE=(t,r)=>t.sort((i,a)=>n(i,a,r)),PE}var xE,KM;function E7(){if(KM)return xE;KM=1;const n=FR();return xE=(t,r)=>t.sort((i,a)=>n(a,i,r)),xE}var OE,JM;function U_(){if(JM)return OE;JM=1;const n=ys();return OE=(t,r,i)=>n(t,r,i)>0,OE}var NE,YM;function BR(){if(YM)return NE;YM=1;const n=ys();return NE=(t,r,i)=>n(t,r,i)<0,NE}var kE,ZM;function rB(){if(ZM)return kE;ZM=1;const n=ys();return kE=(t,r,i)=>n(t,r,i)===0,kE}var ME,XM;function iB(){if(XM)return ME;XM=1;const n=ys();return ME=(t,r,i)=>n(t,r,i)!==0,ME}var DE,QM;function qR(){if(QM)return DE;QM=1;const n=ys();return DE=(t,r,i)=>n(t,r,i)>=0,DE}var $E,eD;function VR(){if(eD)return $E;eD=1;const n=ys();return $E=(t,r,i)=>n(t,r,i)<=0,$E}var LE,tD;function aB(){if(tD)return LE;tD=1;const n=rB(),e=iB(),t=U_(),r=qR(),i=BR(),a=VR();return LE=(o,u,c,d)=>{switch(u){case"===":return typeof o=="object"&&(o=o.version),typeof c=="object"&&(c=c.version),o===c;case"!==":return typeof o=="object"&&(o=o.version),typeof c=="object"&&(c=c.version),o!==c;case"":case"=":case"==":return n(o,c,d);case"!=":return e(o,c,d);case">":return t(o,c,d);case">=":return r(o,c,d);case"<":return i(o,c,d);case"<=":return a(o,c,d);default:throw new TypeError(`Invalid operator: ${u}`)}},LE}var UE,nD;function S7(){if(nD)return UE;nD=1;const n=mi(),e=dd(),{safeRe:t,t:r}=sm();return UE=(a,s)=>{if(a instanceof n)return a;if(typeof a=="number"&&(a=String(a)),typeof a!="string")return null;s=s||{};let o=null;if(!s.rtl)o=a.match(s.includePrerelease?t[r.COERCEFULL]:t[r.COERCE]);else{const y=s.includePrerelease?t[r.COERCERTLFULL]:t[r.COERCERTL];let b;for(;(b=y.exec(a))&&(!o||o.index+o[0].length!==a.length);)(!o||b.index+b[0].length!==o.index+o[0].length)&&(o=b),y.lastIndex=b.index+b[1].length+b[2].length;y.lastIndex=-1}if(o===null)return null;const u=o[2],c=o[3]||"0",d=o[4]||"0",p=s.includePrerelease&&o[5]?`-${o[5]}`:"",m=s.includePrerelease&&o[6]?`+${o[6]}`:"";return e(`${u}.${c}.${d}${p}${m}`,s)},UE}var jE,rD;function T7(){if(rD)return jE;rD=1;class n{constructor(){this.max=1e3,this.map=new Map}get(t){const r=this.map.get(t);if(r!==void 0)return this.map.delete(t),this.map.set(t,r),r}delete(t){return this.map.delete(t)}set(t,r){if(!this.delete(t)&&r!==void 0){if(this.map.size>=this.max){const a=this.map.keys().next().value;this.delete(a)}this.map.set(t,r)}return this}}return jE=n,jE}var FE,iD;function vs(){if(iD)return FE;iD=1;const n=/\s+/g;class e{constructor(ue,te){if(te=i(te),ue instanceof e)return ue.loose===!!te.loose&&ue.includePrerelease===!!te.includePrerelease?ue:new e(ue.raw,te);if(ue instanceof a)return this.raw=ue.value,this.set=[[ue]],this.formatted=void 0,this;if(this.options=te,this.loose=!!te.loose,this.includePrerelease=!!te.includePrerelease,this.raw=ue.trim().replace(n," "),this.set=this.raw.split("||").map(oe=>this.parseRange(oe.trim())).filter(oe=>oe.length),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${this.raw}`);if(this.set.length>1){const oe=this.set[0];if(this.set=this.set.filter(ge=>!w(ge[0])),this.set.length===0)this.set=[oe];else if(this.set.length>1){for(const ge of this.set)if(ge.length===1&&S(ge[0])){this.set=[ge];break}}}this.formatted=void 0}get range(){if(this.formatted===void 0){this.formatted="";for(let ue=0;ue<this.set.length;ue++){ue>0&&(this.formatted+="||");const te=this.set[ue];for(let oe=0;oe<te.length;oe++)oe>0&&(this.formatted+=" "),this.formatted+=te[oe].toString().trim()}}return this.formatted}format(){return this.range}toString(){return this.range}parseRange(ue){const oe=((this.options.includePrerelease&&y)|(this.options.loose&&b))+":"+ue,ge=r.get(oe);if(ge)return ge;const Ee=this.options.loose,Y=Ee?u[c.HYPHENRANGELOOSE]:u[c.HYPHENRANGE];ue=ue.replace(Y,V(this.options.includePrerelease)),s("hyphen replace",ue),ue=ue.replace(u[c.COMPARATORTRIM],d),s("comparator trim",ue),ue=ue.replace(u[c.TILDETRIM],p),s("tilde trim",ue),ue=ue.replace(u[c.CARETTRIM],m),s("caret trim",ue);let ve=ue.split(" ").map(ce=>C(ce,this.options)).join(" ").split(/\s+/).map(ce=>J(ce,this.options));Ee&&(ve=ve.filter(ce=>(s("loose invalid filter",ce,this.options),!!ce.match(u[c.COMPARATORLOOSE])))),s("range list",ve);const Re=new Map,Q=ve.map(ce=>new a(ce,this.options));for(const ce of Q){if(w(ce))return[ce];Re.set(ce.value,ce)}Re.size>1&&Re.has("")&&Re.delete("");const ie=[...Re.values()];return r.set(oe,ie),ie}intersects(ue,te){if(!(ue instanceof e))throw new TypeError("a Range is required");return this.set.some(oe=>T(oe,te)&&ue.set.some(ge=>T(ge,te)&&oe.every(Ee=>ge.every(Y=>Ee.intersects(Y,te)))))}test(ue){if(!ue)return!1;if(typeof ue=="string")try{ue=new o(ue,this.options)}catch{return!1}for(let te=0;te<this.set.length;te++)if(de(this.set[te],ue,this.options))return!0;return!1}}FE=e;const t=T7(),r=new t,i=jR(),a=j_(),s=L_(),o=mi(),{safeRe:u,t:c,comparatorTrimReplace:d,tildeTrimReplace:p,caretTrimReplace:m}=sm(),{FLAG_INCLUDE_PRERELEASE:y,FLAG_LOOSE:b}=$_(),w=ae=>ae.value==="<0.0.0-0",S=ae=>ae.value==="",T=(ae,ue)=>{let te=!0;const oe=ae.slice();let ge=oe.pop();for(;te&&oe.length;)te=oe.every(Ee=>ge.intersects(Ee,ue)),ge=oe.pop();return te},C=(ae,ue)=>(s("comp",ae,ue),ae=L(ae,ue),s("caret",ae),ae=I(ae,ue),s("tildes",ae),ae=N(ae,ue),s("xrange",ae),ae=q(ae,ue),s("stars",ae),ae),A=ae=>!ae||ae.toLowerCase()==="x"||ae==="*",I=(ae,ue)=>ae.trim().split(/\s+/).map(te=>x(te,ue)).join(" "),x=(ae,ue)=>{const te=ue.loose?u[c.TILDELOOSE]:u[c.TILDE];return ae.replace(te,(oe,ge,Ee,Y,ve)=>{s("tilde",ae,oe,ge,Ee,Y,ve);let Re;return A(ge)?Re="":A(Ee)?Re=`>=${ge}.0.0 <${+ge+1}.0.0-0`:A(Y)?Re=`>=${ge}.${Ee}.0 <${ge}.${+Ee+1}.0-0`:ve?(s("replaceTilde pr",ve),Re=`>=${ge}.${Ee}.${Y}-${ve} <${ge}.${+Ee+1}.0-0`):Re=`>=${ge}.${Ee}.${Y} <${ge}.${+Ee+1}.0-0`,s("tilde return",Re),Re})},L=(ae,ue)=>ae.trim().split(/\s+/).map(te=>U(te,ue)).join(" "),U=(ae,ue)=>{s("caret",ae,ue);const te=ue.loose?u[c.CARETLOOSE]:u[c.CARET],oe=ue.includePrerelease?"-0":"";return ae.replace(te,(ge,Ee,Y,ve,Re)=>{s("caret",ae,ge,Ee,Y,ve,Re);let Q;return A(Ee)?Q="":A(Y)?Q=`>=${Ee}.0.0${oe} <${+Ee+1}.0.0-0`:A(ve)?Ee==="0"?Q=`>=${Ee}.${Y}.0${oe} <${Ee}.${+Y+1}.0-0`:Q=`>=${Ee}.${Y}.0${oe} <${+Ee+1}.0.0-0`:Re?(s("replaceCaret pr",Re),Ee==="0"?Y==="0"?Q=`>=${Ee}.${Y}.${ve}-${Re} <${Ee}.${Y}.${+ve+1}-0`:Q=`>=${Ee}.${Y}.${ve}-${Re} <${Ee}.${+Y+1}.0-0`:Q=`>=${Ee}.${Y}.${ve}-${Re} <${+Ee+1}.0.0-0`):(s("no pr"),Ee==="0"?Y==="0"?Q=`>=${Ee}.${Y}.${ve}${oe} <${Ee}.${Y}.${+ve+1}-0`:Q=`>=${Ee}.${Y}.${ve}${oe} <${Ee}.${+Y+1}.0-0`:Q=`>=${Ee}.${Y}.${ve} <${+Ee+1}.0.0-0`),s("caret return",Q),Q})},N=(ae,ue)=>(s("replaceXRanges",ae,ue),ae.split(/\s+/).map(te=>B(te,ue)).join(" ")),B=(ae,ue)=>{ae=ae.trim();const te=ue.loose?u[c.XRANGELOOSE]:u[c.XRANGE];return ae.replace(te,(oe,ge,Ee,Y,ve,Re)=>{s("xRange",ae,oe,ge,Ee,Y,ve,Re);const Q=A(Ee),ie=Q||A(Y),ce=ie||A(ve),P=ce;return ge==="="&&P&&(ge=""),Re=ue.includePrerelease?"-0":"",Q?ge===">"||ge==="<"?oe="<0.0.0-0":oe="*":ge&&P?(ie&&(Y=0),ve=0,ge===">"?(ge=">=",ie?(Ee=+Ee+1,Y=0,ve=0):(Y=+Y+1,ve=0)):ge==="<="&&(ge="<",ie?Ee=+Ee+1:Y=+Y+1),ge==="<"&&(Re="-0"),oe=`${ge+Ee}.${Y}.${ve}${Re}`):ie?oe=`>=${Ee}.0.0${Re} <${+Ee+1}.0.0-0`:ce&&(oe=`>=${Ee}.${Y}.0${Re} <${Ee}.${+Y+1}.0-0`),s("xRange return",oe),oe})},q=(ae,ue)=>(s("replaceStars",ae,ue),ae.trim().replace(u[c.STAR],"")),J=(ae,ue)=>(s("replaceGTE0",ae,ue),ae.trim().replace(u[ue.includePrerelease?c.GTE0PRE:c.GTE0],"")),V=ae=>(ue,te,oe,ge,Ee,Y,ve,Re,Q,ie,ce,P)=>(A(oe)?te="":A(ge)?te=`>=${oe}.0.0${ae?"-0":""}`:A(Ee)?te=`>=${oe}.${ge}.0${ae?"-0":""}`:Y?te=`>=${te}`:te=`>=${te}${ae?"-0":""}`,A(Q)?Re="":A(ie)?Re=`<${+Q+1}.0.0-0`:A(ce)?Re=`<${Q}.${+ie+1}.0-0`:P?Re=`<=${Q}.${ie}.${ce}-${P}`:ae?Re=`<${Q}.${ie}.${+ce+1}-0`:Re=`<=${Re}`,`${te} ${Re}`.trim()),de=(ae,ue,te)=>{for(let oe=0;oe<ae.length;oe++)if(!ae[oe].test(ue))return!1;if(ue.prerelease.length&&!te.includePrerelease){for(let oe=0;oe<ae.length;oe++)if(s(ae[oe].semver),ae[oe].semver!==a.ANY&&ae[oe].semver.prerelease.length>0){const ge=ae[oe].semver;if(ge.major===ue.major&&ge.minor===ue.minor&&ge.patch===ue.patch)return!0}return!1}return!0};return FE}var BE,aD;function j_(){if(aD)return BE;aD=1;const n=Symbol("SemVer ANY");class e{static get ANY(){return n}constructor(d,p){if(p=t(p),d instanceof e){if(d.loose===!!p.loose)return d;d=d.value}d=d.trim().split(/\s+/).join(" "),s("comparator",d,p),this.options=p,this.loose=!!p.loose,this.parse(d),this.semver===n?this.value="":this.value=this.operator+this.semver.version,s("comp",this)}parse(d){const p=this.options.loose?r[i.COMPARATORLOOSE]:r[i.COMPARATOR],m=d.match(p);if(!m)throw new TypeError(`Invalid comparator: ${d}`);this.operator=m[1]!==void 0?m[1]:"",this.operator==="="&&(this.operator=""),m[2]?this.semver=new o(m[2],this.options.loose):this.semver=n}toString(){return this.value}test(d){if(s("Comparator.test",d,this.options.loose),this.semver===n||d===n)return!0;if(typeof d=="string")try{d=new o(d,this.options)}catch{return!1}return a(d,this.operator,this.semver,this.options)}intersects(d,p){if(!(d instanceof e))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new u(d.value,p).test(this.value):d.operator===""?d.value===""?!0:new u(this.value,p).test(d.semver):(p=t(p),p.includePrerelease&&(this.value==="<0.0.0-0"||d.value==="<0.0.0-0")||!p.includePrerelease&&(this.value.startsWith("<0.0.0")||d.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&d.operator.startsWith(">")||this.operator.startsWith("<")&&d.operator.startsWith("<")||this.semver.version===d.semver.version&&this.operator.includes("=")&&d.operator.includes("=")||a(this.semver,"<",d.semver,p)&&this.operator.startsWith(">")&&d.operator.startsWith("<")||a(this.semver,">",d.semver,p)&&this.operator.startsWith("<")&&d.operator.startsWith(">")))}}BE=e;const t=jR(),{safeRe:r,t:i}=sm(),a=aB(),s=L_(),o=mi(),u=vs();return BE}var qE,sD;function F_(){if(sD)return qE;sD=1;const n=vs();return qE=(t,r,i)=>{try{r=new n(r,i)}catch{return!1}return r.test(t)},qE}var VE,oD;function A7(){if(oD)return VE;oD=1;const n=vs();return VE=(t,r)=>new n(t,r).set.map(i=>i.map(a=>a.value).join(" ").trim().split(" ")),VE}var zE,lD;function C7(){if(lD)return zE;lD=1;const n=mi(),e=vs();return zE=(r,i,a)=>{let s=null,o=null,u=null;try{u=new e(i,a)}catch{return null}return r.forEach(c=>{u.test(c)&&(!s||o.compare(c)===-1)&&(s=c,o=new n(s,a))}),s},zE}var HE,uD;function R7(){if(uD)return HE;uD=1;const n=mi(),e=vs();return HE=(r,i,a)=>{let s=null,o=null,u=null;try{u=new e(i,a)}catch{return null}return r.forEach(c=>{u.test(c)&&(!s||o.compare(c)===1)&&(s=c,o=new n(s,a))}),s},HE}var GE,cD;function I7(){if(cD)return GE;cD=1;const n=mi(),e=vs(),t=U_();return GE=(i,a)=>{i=new e(i,a);let s=new n("0.0.0");if(i.test(s)||(s=new n("0.0.0-0"),i.test(s)))return s;s=null;for(let o=0;o<i.set.length;++o){const u=i.set[o];let c=null;u.forEach(d=>{const p=new n(d.semver.version);switch(d.operator){case">":p.prerelease.length===0?p.patch++:p.prerelease.push(0),p.raw=p.format();case"":case">=":(!c||t(p,c))&&(c=p);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${d.operator}`)}}),c&&(!s||t(s,c))&&(s=c)}return s&&i.test(s)?s:null},GE}var WE,fD;function P7(){if(fD)return WE;fD=1;const n=vs();return WE=(t,r)=>{try{return new n(t,r).range||"*"}catch{return null}},WE}var KE,dD;function zR(){if(dD)return KE;dD=1;const n=mi(),e=j_(),{ANY:t}=e,r=vs(),i=F_(),a=U_(),s=BR(),o=VR(),u=qR();return KE=(d,p,m,y)=>{d=new n(d,y),p=new r(p,y);let b,w,S,T,C;switch(m){case">":b=a,w=o,S=s,T=">",C=">=";break;case"<":b=s,w=u,S=a,T="<",C="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(i(d,p,y))return!1;for(let A=0;A<p.set.length;++A){const I=p.set[A];let x=null,L=null;if(I.forEach(U=>{U.semver===t&&(U=new e(">=0.0.0")),x=x||U,L=L||U,b(U.semver,x.semver,y)?x=U:S(U.semver,L.semver,y)&&(L=U)}),x.operator===T||x.operator===C||(!L.operator||L.operator===T)&&w(d,L.semver))return!1;if(L.operator===C&&S(d,L.semver))return!1}return!0},KE}var JE,hD;function x7(){if(hD)return JE;hD=1;const n=zR();return JE=(t,r,i)=>n(t,r,">",i),JE}var YE,pD;function O7(){if(pD)return YE;pD=1;const n=zR();return YE=(t,r,i)=>n(t,r,"<",i),YE}var ZE,mD;function N7(){if(mD)return ZE;mD=1;const n=vs();return ZE=(t,r,i)=>(t=new n(t,i),r=new n(r,i),t.intersects(r,i)),ZE}var XE,gD;function k7(){if(gD)return XE;gD=1;const n=F_(),e=ys();return XE=(t,r,i)=>{const a=[];let s=null,o=null;const u=t.sort((m,y)=>e(m,y,i));for(const m of u)n(m,r,i)?(o=m,s||(s=m)):(o&&a.push([s,o]),o=null,s=null);s&&a.push([s,null]);const c=[];for(const[m,y]of a)m===y?c.push(m):!y&&m===u[0]?c.push("*"):y?m===u[0]?c.push(`<=${y}`):c.push(`${m} - ${y}`):c.push(`>=${m}`);const d=c.join(" || "),p=typeof r.raw=="string"?r.raw:String(r);return d.length<p.length?d:r},XE}var QE,yD;function M7(){if(yD)return QE;yD=1;const n=vs(),e=j_(),{ANY:t}=e,r=F_(),i=ys(),a=(p,m,y={})=>{if(p===m)return!0;p=new n(p,y),m=new n(m,y);let b=!1;e:for(const w of p.set){for(const S of m.set){const T=u(w,S,y);if(b=b||T!==null,T)continue e}if(b)return!1}return!0},s=[new e(">=0.0.0-0")],o=[new e(">=0.0.0")],u=(p,m,y)=>{if(p===m)return!0;if(p.length===1&&p[0].semver===t){if(m.length===1&&m[0].semver===t)return!0;y.includePrerelease?p=s:p=o}if(m.length===1&&m[0].semver===t){if(y.includePrerelease)return!0;m=o}const b=new Set;let w,S;for(const N of p)N.operator===">"||N.operator===">="?w=c(w,N,y):N.operator==="<"||N.operator==="<="?S=d(S,N,y):b.add(N.semver);if(b.size>1)return null;let T;if(w&&S){if(T=i(w.semver,S.semver,y),T>0)return null;if(T===0&&(w.operator!==">="||S.operator!=="<="))return null}for(const N of b){if(w&&!r(N,String(w),y)||S&&!r(N,String(S),y))return null;for(const B of m)if(!r(N,String(B),y))return!1;return!0}let C,A,I,x,L=S&&!y.includePrerelease&&S.semver.prerelease.length?S.semver:!1,U=w&&!y.includePrerelease&&w.semver.prerelease.length?w.semver:!1;L&&L.prerelease.length===1&&S.operator==="<"&&L.prerelease[0]===0&&(L=!1);for(const N of m){if(x=x||N.operator===">"||N.operator===">=",I=I||N.operator==="<"||N.operator==="<=",w){if(U&&N.semver.prerelease&&N.semver.prerelease.length&&N.semver.major===U.major&&N.semver.minor===U.minor&&N.semver.patch===U.patch&&(U=!1),N.operator===">"||N.operator===">="){if(C=c(w,N,y),C===N&&C!==w)return!1}else if(w.operator===">="&&!r(w.semver,String(N),y))return!1}if(S){if(L&&N.semver.prerelease&&N.semver.prerelease.length&&N.semver.major===L.major&&N.semver.minor===L.minor&&N.semver.patch===L.patch&&(L=!1),N.operator==="<"||N.operator==="<="){if(A=d(S,N,y),A===N&&A!==S)return!1}else if(S.operator==="<="&&!r(S.semver,String(N),y))return!1}if(!N.operator&&(S||w)&&T!==0)return!1}return!(w&&I&&!S&&T!==0||S&&x&&!w&&T!==0||U||L)},c=(p,m,y)=>{if(!p)return m;const b=i(p.semver,m.semver,y);return b>0?p:b<0||m.operator===">"&&p.operator===">="?m:p},d=(p,m,y)=>{if(!p)return m;const b=i(p.semver,m.semver,y);return b<0?p:b>0||m.operator==="<"&&p.operator==="<="?m:p};return QE=a,QE}var eS,vD;function D7(){if(vD)return eS;vD=1;const n=sm(),e=$_(),t=mi(),r=nB(),i=dd(),a=f7(),s=d7(),o=h7(),u=p7(),c=m7(),d=g7(),p=y7(),m=v7(),y=ys(),b=_7(),w=b7(),S=FR(),T=w7(),C=E7(),A=U_(),I=BR(),x=rB(),L=iB(),U=qR(),N=VR(),B=aB(),q=S7(),J=j_(),V=vs(),de=F_(),ae=A7(),ue=C7(),te=R7(),oe=I7(),ge=P7(),Ee=zR(),Y=x7(),ve=O7(),Re=N7(),Q=k7(),ie=M7();return eS={parse:i,valid:a,clean:s,inc:o,diff:u,major:c,minor:d,patch:p,prerelease:m,compare:y,rcompare:b,compareLoose:w,compareBuild:S,sort:T,rsort:C,gt:A,lt:I,eq:x,neq:L,gte:U,lte:N,cmp:B,coerce:q,Comparator:J,Range:V,satisfies:de,toComparators:ae,maxSatisfying:ue,minSatisfying:te,minVersion:oe,validRange:ge,outside:Ee,gtr:Y,ltr:ve,intersects:Re,simplifyRange:Q,subset:ie,SemVer:t,re:n.re,src:n.src,tokens:n.t,SEMVER_SPEC_VERSION:e.SEMVER_SPEC_VERSION,RELEASE_TYPES:e.RELEASE_TYPES,compareIdentifiers:r.compareIdentifiers,rcompareIdentifiers:r.rcompareIdentifiers},eS}D7();function hl(n){if(!n||n.split("/").length>2||n.startsWith("/")||n.endsWith("/")||n.split(":").length>2)throw new Error(`Invalid identifier format: ${n}`);const[e,t]=n.split(":"),r=t||"latest";if(e.includes("/")){const[i,a]=e.split("/",2);if(!i||!a)throw new Error(`Invalid identifier format: ${n}`);return[i,a,r]}else{if(!e)throw new Error(`Invalid identifier format: ${n}`);return["-",e,r]}}class $7 extends Error{constructor(e){super(e),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="LangSmithConflictError",this.status=409}}async function $t(n,e,t){let r;if(n.ok){t&&(r=await n.text());return}r=await n.text();const i=`Failed to ${e}. Received status [${n.status}]: ${n.statusText}. Server response: ${r}`;if(n.status===409)throw new $7(i);const a=new Error(i);throw a.status=n.status,a}var _D="[...]",L7={result:"[Circular]"},Bv=[],Sf=[];const U7=new TextEncoder;function j7(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function ey(n){return U7.encode(n)}function Xi(n,e,t,r,i){var a;try{const s=JSON.stringify(n,t,r);return ey(s)}catch(s){if(!((a=s.message)!=null&&a.includes("Converting circular structure to JSON")))return console.warn(`[WARNING]: LangSmith received unserializable value.${e?`
Context: ${e}`:""}`),ey("[Unserializable]");ns("SUPPRESS_CIRCULAR_JSON_WARNINGS")!=="true"&&console.warn(`[WARNING]: LangSmith received circular JSON. This will decrease tracer performance. ${e?`
Context: ${e}`:""}`),typeof i>"u"&&(i=j7()),YC(n,"",0,[],void 0,0,i);let o;try{Sf.length===0?o=JSON.stringify(n,t,r):o=JSON.stringify(n,F7(t),r)}catch{return ey("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;Bv.length!==0;){const u=Bv.pop();u.length===4?Object.defineProperty(u[0],u[1],u[3]):u[0][u[1]]=u[2]}}return ey(o)}}function tS(n,e,t,r){var i=Object.getOwnPropertyDescriptor(r,t);i.get!==void 0?i.configurable?(Object.defineProperty(r,t,{value:n}),Bv.push([r,t,e,i])):Sf.push([e,t,n]):(r[t]=n,Bv.push([r,t,e]))}function YC(n,e,t,r,i,a,s){a+=1;var o;if(typeof n=="object"&&n!==null){for(o=0;o<r.length;o++)if(r[o]===n){tS(L7,n,e,i);return}if(typeof s.depthLimit<"u"&&a>s.depthLimit){tS(_D,n,e,i);return}if(typeof s.edgesLimit<"u"&&t+1>s.edgesLimit){tS(_D,n,e,i);return}if(r.push(n),Array.isArray(n))for(o=0;o<n.length;o++)YC(n[o],o,o,r,n,a,s);else{var u=Object.keys(n);for(o=0;o<u.length;o++){var c=u[o];YC(n[c],c,o,r,n,a,s)}}r.pop()}}function F7(n){return n=typeof n<"u"?n:function(e,t){return t},function(e,t){if(Sf.length>0)for(var r=0;r<Sf.length;r++){var i=Sf[r];if(i[1]===e&&i[0]===t){t=i[2],Sf.splice(r,1);break}}return n.call(this,e,t)}}function bD(n){const e=QF(),t=i7(),r=n.extra??{},i=r.metadata;return n.extra={...r,runtime:{...e,...r==null?void 0:r.runtime},metadata:{...t,...t.revision_id||n.revision_id?{revision_id:n.revision_id??t.revision_id}:{},...i}},n}const B7=n=>{const e=(n==null?void 0:n.toString())??ns("TRACING_SAMPLING_RATE");if(e===void 0)return;const t=parseFloat(e);if(t<0||t>1)throw new Error(`LANGSMITH_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},q7=n=>{const t=n.replace("http://","").replace("https://","").split("/")[0].split(":")[0];return t==="localhost"||t==="127.0.0.1"||t==="::1"};async function V7(n){const e=[];for await(const t of n)e.push(t);return e}function nS(n){if(n!==void 0)return n.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}const z7=async n=>{if((n==null?void 0:n.status)===429){const e=parseInt(n.headers.get("retry-after")??"30",10)*1e3;if(e>0)return await new Promise(t=>setTimeout(t,e)),!0}return!1};function wD(n){return typeof n=="number"?Number(n.toFixed(4)):n}class H7{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"sizeBytes",{enumerable:!0,configurable:!0,writable:!0,value:0})}peek(){return this.items[0]}push(e){let t;const r=new Promise(a=>{t=a}),i=Xi(e.item,`Serializing run with id: ${e.item.id}`).length;return this.items.push({action:e.action,payload:e.item,itemPromiseResolve:t,itemPromise:r,size:i}),this.sizeBytes+=i,r}pop(e){var i;if(e<1)throw new Error("Number of bytes to pop off may not be less than 1.");const t=[];let r=0;for(;r+(((i=this.peek())==null?void 0:i.size)??0)<e&&this.items.length>0;){const a=this.items.shift();a&&(t.push(a),r+=a.size,this.sizeBytes-=a.size)}if(t.length===0&&this.items.length>0){const a=this.items.shift();t.push(a),r+=a.size,this.sizeBytes-=a.size}return[t.map(a=>({action:a.action,item:a.payload})),()=>t.forEach(a=>a.itemPromiseResolve())]}}const G7=20971520,W7=2500;let sB=class ZC{constructor(e={}){var r;Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filteredPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new H7}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"batchSizeBytesLimit",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"settings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"blockOnRootRunFinalization",{enumerable:!0,configurable:!0,writable:!0,value:Dl("LANGSMITH_TRACING_BACKGROUND")==="false"}),Object.defineProperty(this,"traceBatchConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:5}),Object.defineProperty(this,"_serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_getServerInfoPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manualFlushMode",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:Dl("LANGSMITH_DEBUG")==="true"});const t=ZC.getDefaultClientConfig();if(this.tracingSampleRate=B7(e.tracingSamplingRate),this.apiUrl=nS(e.apiUrl??t.apiUrl)??"",this.apiUrl.endsWith("/")&&(this.apiUrl=this.apiUrl.slice(0,-1)),this.apiKey=nS(e.apiKey??t.apiKey),this.webUrl=nS(e.webUrl??t.webUrl),(r=this.webUrl)!=null&&r.endsWith("/")&&(this.webUrl=this.webUrl.slice(0,-1)),this.timeout_ms=e.timeout_ms??9e4,this.caller=new TM({...e.callerOptions??{},debug:e.debug??this.debug}),this.traceBatchConcurrency=e.traceBatchConcurrency??this.traceBatchConcurrency,this.traceBatchConcurrency<1)throw new Error("Trace batch concurrency must be positive.");this.debug=e.debug??this.debug,this.batchIngestCaller=new TM({maxRetries:2,maxConcurrency:this.traceBatchConcurrency,...e.callerOptions??{},onFailedResponseHook:z7,debug:e.debug??this.debug}),this.hideInputs=e.hideInputs??e.anonymizer??t.hideInputs,this.hideOutputs=e.hideOutputs??e.anonymizer??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.blockOnRootRunFinalization=e.blockOnRootRunFinalization??this.blockOnRootRunFinalization,this.batchSizeBytesLimit=e.batchSizeBytesLimit,this.fetchOptions=e.fetchOptions||{},this.manualFlushMode=e.manualFlushMode??this.manualFlushMode}static getDefaultClientConfig(){const e=ns("API_KEY"),t=ns("ENDPOINT")??"https://api.smith.langchain.com",r=ns("HIDE_INPUTS")==="true",i=ns("HIDE_OUTPUTS")==="true";return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:i}}getHostUrl(){return this.webUrl?this.webUrl:q7(this.apiUrl)?(this.webUrl="http://localhost:3000",this.webUrl):this.apiUrl.endsWith("/api/v1")?(this.webUrl=this.apiUrl.replace("/api/v1",""),this.webUrl):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("eu")?(this.webUrl="https://eu.smith.langchain.com",this.webUrl):this.apiUrl.split(".",1)[0].includes("beta")?(this.webUrl="https://beta.smith.langchain.com",this.webUrl):(this.webUrl="https://smith.langchain.com",this.webUrl)}get headers(){const e={"User-Agent":`langsmith-js/${ZF}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}async processInputs(e){return this.hideInputs===!1?e:this.hideInputs===!0?{}:typeof this.hideInputs=="function"?this.hideInputs(e):e}async processOutputs(e){return this.hideOutputs===!1?e:this.hideOutputs===!0?{}:typeof this.hideOutputs=="function"?this.hideOutputs(e):e}async prepareRunCreateOrUpdateInputs(e){const t={...e};return t.inputs!==void 0&&(t.inputs=await this.processInputs(t.inputs)),t.outputs!==void 0&&(t.outputs=await this.processOutputs(t.outputs)),t}async _getResponse(e,t){const r=(t==null?void 0:t.toString())??"",i=`${this.apiUrl}${e}?${r}`,a=await this.caller.call(dt(this.debug),i,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await $t(a,`Failed to fetch ${e}`),a}async _get(e,t){return(await this._getResponse(e,t)).json()}async*_getPaginated(e,t=new URLSearchParams,r){let i=Number(t.get("offset"))||0;const a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(i)),t.set("limit",String(a));const s=`${this.apiUrl}${e}?${t}`,o=await this.caller.call(dt(this.debug),s,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(o,`Failed to fetch ${e}`);const u=r?r(await o.json()):await o.json();if(u.length===0||(yield u,u.length<a))break;i+=u.length}}async*_getCursorPaginatedList(e,t=null,r="POST",i="runs"){const a=t?{...t}:{};for(;;){const o=await(await this.caller.call(dt(this.debug),`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(a)})).json();if(!o||!o[i])break;yield o[i];const u=o.cursors;if(!u||!u.next)break;a.cursor=u.next}}_shouldSample(){return this.tracingSampleRate===void 0?!0:Math.random()<this.tracingSampleRate}_filterForSampling(e,t=!1){if(this.tracingSampleRate===void 0)return e;if(t){const r=[];for(const i of e)this.filteredPostUuids.has(i.id)?this.filteredPostUuids.delete(i.id):r.push(i);return r}else{const r=[];for(const i of e){const a=i.trace_id??i.id;this.filteredPostUuids.has(a)||(i.id===a?this._shouldSample()?r.push(i):this.filteredPostUuids.add(a):r.push(i))}return r}}async _getBatchSizeLimitBytes(){var t;const e=await this._ensureServerInfo();return this.batchSizeBytesLimit??((t=e.batch_ingest_config)==null?void 0:t.size_limit_bytes)??G7}async _getMultiPartSupport(){var t;return((t=(await this._ensureServerInfo()).instance_flags)==null?void 0:t.dataset_examples_multipart_enabled)??!1}drainAutoBatchQueue(e){const t=[];for(;this.autoBatchQueue.items.length>0;){const[r,i]=this.autoBatchQueue.pop(e);if(!r.length){i();break}const a=this._processBatch(r,i).catch(console.error);t.push(a)}return Promise.all(t)}async _processBatch(e,t){var r;if(!e.length){t();return}try{const i={runCreates:e.filter(s=>s.action==="create").map(s=>s.item),runUpdates:e.filter(s=>s.action==="update").map(s=>s.item)},a=await this._ensureServerInfo();(r=a==null?void 0:a.batch_ingest_config)!=null&&r.use_multipart_endpoint?await this.multipartIngestRuns(i):await this.batchIngestRuns(i)}finally{t()}}async processRunOperation(e){clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0,e.action==="create"&&(e.item=bD(e.item));const t=this.autoBatchQueue.push(e);if(this.manualFlushMode)return t;const r=await this._getBatchSizeLimitBytes();return this.autoBatchQueue.sizeBytes>r&&this.drainAutoBatchQueue(r),this.autoBatchQueue.items.length>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue(r)},this.autoBatchAggregationDelayMs)),t}async _getServerInfo(){const e=await this.caller.call(dt(this.debug),`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(W7),...this.fetchOptions});await $t(e,"get server info");const t=await e.json();return this.debug&&console.log(`
=== LangSmith Server Configuration ===
`+JSON.stringify(t,null,2)+`
`),t}async _ensureServerInfo(){return this._getServerInfoPromise===void 0&&(this._getServerInfoPromise=(async()=>{if(this._serverInfo===void 0)try{this._serverInfo=await this._getServerInfo()}catch(e){console.warn(`[WARNING]: LangSmith failed to fetch info on supported operations with status code ${e.status}. Falling back to batch operations and default limits.`)}return this._serverInfo??{}})()),this._getServerInfoPromise.then(e=>(this._serverInfo===void 0&&(this._getServerInfoPromise=void 0),e))}async _getSettings(){return this.settings||(this.settings=this._get("/settings")),await this.settings}async flush(){const e=await this._getBatchSizeLimitBytes();await this.drainAutoBatchQueue(e)}async createRun(e){if(!this._filterForSampling([e]).length)return;const t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;const i=await this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&i.trace_id!==void 0&&i.dotted_order!==void 0){this.processRunOperation({action:"create",item:i}).catch(console.error);return}const a=bD(i),s=await this.caller.call(dt(this.debug),`${this.apiUrl}/runs`,{method:"POST",headers:t,body:Xi(a,`Creating run with id: ${a.id}`),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(s,"create run",!0)}async batchIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;let r=await Promise.all((e==null?void 0:e.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[]),i=await Promise.all((t==null?void 0:t.map(o=>this.prepareRunCreateOrUpdateInputs(o)))??[]);if(r.length>0&&i.length>0){const o=r.reduce((c,d)=>(d.id&&(c[d.id]=d),c),{}),u=[];for(const c of i)c.id!==void 0&&o[c.id]?o[c.id]={...o[c.id],...c}:u.push(c);r=Object.values(o),i=u}const a={post:r,patch:i};if(!a.post.length&&!a.patch.length)return;const s={post:[],patch:[]};for(const o of["post","patch"]){const u=o,c=a[u].reverse();let d=c.pop();for(;d!==void 0;)s[u].push(d),d=c.pop()}if(s.post.length>0||s.patch.length>0){const o=s.post.map(u=>u.id).concat(s.patch.map(u=>u.id)).join(",");await this._postBatchIngestRuns(Xi(s,`Ingesting runs with ids: ${o}`))}}async _postBatchIngestRuns(e){const t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call(dt(this.debug),`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(r,"batch create run",!0)}async multipartIngestRuns({runCreates:e,runUpdates:t}){if(e===void 0&&t===void 0)return;const r={};let i=[];for(const d of e??[]){const p=await this.prepareRunCreateOrUpdateInputs(d);p.id!==void 0&&p.attachments!==void 0&&(r[p.id]=p.attachments),delete p.attachments,i.push(p)}let a=[];for(const d of t??[])a.push(await this.prepareRunCreateOrUpdateInputs(d));if(i.find(d=>d.trace_id===void 0||d.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when creating a run');if(a.find(d=>d.trace_id===void 0||d.dotted_order===void 0)!==void 0)throw new Error('Multipart ingest requires "trace_id" and "dotted_order" to be set when updating a run');if(i.length>0&&a.length>0){const d=i.reduce((m,y)=>(y.id&&(m[y.id]=y),m),{}),p=[];for(const m of a)m.id!==void 0&&d[m.id]?d[m.id]={...d[m.id],...m}:p.push(m);i=Object.values(d),a=p}if(i.length===0&&a.length===0)return;const u=[],c=[];for(const[d,p]of[["post",i],["patch",a]])for(const m of p){const{inputs:y,outputs:b,events:w,attachments:S,...T}=m,C={inputs:y,outputs:b,events:w},A=Xi(T,`Serializing for multipart ingestion of run with id: ${T.id}`);c.push({name:`${d}.${T.id}`,payload:new Blob([A],{type:`application/json; length=${A.length}`})});for(const[I,x]of Object.entries(C)){if(x===void 0)continue;const L=Xi(x,`Serializing ${I} for multipart ingestion of run with id: ${T.id}`);c.push({name:`${d}.${T.id}.${I}`,payload:new Blob([L],{type:`application/json; length=${L.length}`})})}if(T.id!==void 0){const I=r[T.id];if(I){delete r[T.id];for(const[x,L]of Object.entries(I)){let U,N;if(Array.isArray(L)?[U,N]=L:(U=L.mimeType,N=L.data),x.includes(".")){console.warn(`Skipping attachment '${x}' for run ${T.id}: Invalid attachment name. Attachment names must not contain periods ('.'). Please rename the attachment and try again.`);continue}c.push({name:`attachment.${T.id}.${x}`,payload:new Blob([N],{type:`${U}; length=${N.byteLength}`})})}}}u.push(`trace=${T.trace_id},id=${T.id}`)}await this._sendMultipartRequest(c,u.join("; "))}async _createNodeFetchBody(e,t){const r=[];for(const s of e)r.push(new Blob([`--${t}\r
`])),r.push(new Blob([`Content-Disposition: form-data; name="${s.name}"\r
`,`Content-Type: ${s.payload.type}\r
\r
`])),r.push(s.payload),r.push(new Blob([`\r
`]));return r.push(new Blob([`--${t}--\r
`])),await new Blob(r).arrayBuffer()}async _createMultipartStream(e,t){const r=new TextEncoder;return new ReadableStream({async start(a){const s=async o=>{typeof o=="string"?a.enqueue(r.encode(o)):a.enqueue(o)};for(const o of e){await s(`--${t}\r
`),await s(`Content-Disposition: form-data; name="${o.name}"\r
`),await s(`Content-Type: ${o.payload.type}\r
\r
`);const c=o.payload.stream().getReader();try{let d;for(;!(d=await c.read()).done;)a.enqueue(d.value)}finally{c.releaseLock()}await s(`\r
`)}await s(`--${t}--\r
`),a.close()}})}async _sendMultipartRequest(e,t){try{const r="----LangSmithFormBoundary"+Math.random().toString(36).slice(2),i=await(l7()?this._createNodeFetchBody(e,r):this._createMultipartStream(e,r)),a=await this.batchIngestCaller.call(dt(this.debug),`${this.apiUrl}/runs/multipart`,{method:"POST",headers:{...this.headers,"Content-Type":`multipart/form-data; boundary=${r}`},body:i,duplex:"half",signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(a,"ingest multipart runs",!0)}catch(r){console.warn(`${r.message.trim()}

Context: ${t}`)}}async updateRun(e,t){Nt(e),t.inputs&&(t.inputs=await this.processInputs(t.inputs)),t.outputs&&(t.outputs=await this.processOutputs(t.outputs));const r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&r.trace_id!==void 0&&r.dotted_order!==void 0){if(t.end_time!==void 0&&r.parent_run_id===void 0&&this.blockOnRootRunFinalization&&!this.manualFlushMode){await this.processRunOperation({action:"update",item:r}).catch(console.error);return}else this.processRunOperation({action:"update",item:r}).catch(console.error);return}const i={...this.headers,"Content-Type":"application/json"},a=await this.caller.call(dt(this.debug),`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:i,body:Xi(t,`Serializing payload to update run with id: ${e}`),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(a,"update run",!0)}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){Nt(e);let r=await this._get(`/runs/${e}`);return t&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(t!==void 0){let i;t.session_id?i=t.session_id:r!=null&&r.projectName?i=(await this.readProject({projectName:r==null?void 0:r.projectName})).id:r!=null&&r.projectId?i=r==null?void 0:r.projectId:i=(await this.readProject({projectName:ns("PROJECT")||"default"})).id;const a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${i}/r/${t.id}?poll=true`}else if(e!==void 0){const i=await this.readRun(e);if(!i.app_path)throw new Error(`Run ${e} has no app_path`);return`${this.getHostUrl()}${i.app_path}`}else throw new Error("Must provide either runId or run")}async _loadChildRuns(e){var a;const t=await V7(this.listRuns({isRoot:!1,projectId:e.session_id,traceId:e.trace_id})),r={},i={};t.sort((s,o)=>((s==null?void 0:s.dotted_order)??"").localeCompare((o==null?void 0:o.dotted_order)??""));for(const s of t){if(s.parent_run_id===null||s.parent_run_id===void 0)throw new Error(`Child run ${s.id} has no parent`);(a=s.dotted_order)!=null&&a.startsWith(e.dotted_order??"")&&s.id!==e.id&&(s.parent_run_id in r||(r[s.parent_run_id]=[]),r[s.parent_run_id].push(s),i[s.id]=s)}e.child_runs=r[e.id]||[];for(const s in r)s!==e.id&&(i[s].child_runs=r[s]);return e}async*listRuns(e){const{projectId:t,projectName:r,parentRunId:i,traceId:a,referenceExampleId:s,startTime:o,executionOrder:u,isRoot:c,runType:d,error:p,id:m,query:y,filter:b,traceFilter:w,treeFilter:S,limit:T,select:C,order:A}=e;let I=[];if(t&&(I=Array.isArray(t)?t:[t]),r){const N=Array.isArray(r)?r:[r],B=await Promise.all(N.map(q=>this.readProject({projectName:q}).then(J=>J.id)));I.push(...B)}const x=["app_path","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],L={session:I.length?I:null,run_type:d,reference_example:s,query:y,filter:b,trace_filter:w,tree_filter:S,execution_order:u,parent_run:i,start_time:o?o.toISOString():null,error:p,id:m,limit:T,trace:a,select:C||x,is_root:c,order:A};let U=0;for await(const N of this._getCursorPaginatedList("/runs/query",L))if(T){if(U>=T)break;if(N.length+U>T){yield*N.slice(0,T-U);break}U+=N.length,yield*N}else yield*N}async*listGroupRuns(e){const{projectId:t,projectName:r,groupBy:i,filter:a,startTime:s,endTime:o,limit:u,offset:c}=e,p={session_id:t||(await this.readProject({projectName:r})).id,group_by:i,filter:a,start_time:s?s.toISOString():null,end_time:o?o.toISOString():null,limit:Number(u)||100};let m=Number(c)||0;const y="/runs/group",b=`${this.apiUrl}${y}`;for(;;){const w={...p,offset:m},S=Object.fromEntries(Object.entries(w).filter(([x,L])=>L!==void 0)),T=await this.caller.call(dt(),b,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(S),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(T,`Failed to fetch ${y}`);const C=await T.json(),{groups:A,total:I}=C;if(A.length===0)break;for(const x of A)yield x;if(m+=A.length,m>=I)break}}async getRunStats({id:e,trace:t,parentRun:r,runType:i,projectNames:a,projectIds:s,referenceExampleIds:o,startTime:u,endTime:c,error:d,query:p,filter:m,traceFilter:y,treeFilter:b,isRoot:w,dataSourceType:S}){let T=s||[];a&&(T=[...s||[],...await Promise.all(a.map(L=>this.readProject({projectName:L}).then(U=>U.id)))]);const A=Object.fromEntries(Object.entries({id:e,trace:t,parent_run:r,run_type:i,session:T,reference_example:o,start_time:u,end_time:c,error:d,query:p,filter:m,trace_filter:y,tree_filter:b,is_root:w,data_source_type:S}).filter(([L,U])=>U!==void 0));return await(await this.caller.call(dt(this.debug),`${this.apiUrl}/runs/stats`,{method:"POST",headers:this.headers,body:JSON.stringify(A),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async shareRun(e,{shareId:t}={}){const r={run_id:e,share_token:t||hf()};Nt(e);const a=await(await this.caller.call(dt(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(a===null||!("share_token"in a))throw new Error("Invalid response from server");return`${this.getHostUrl()}/public/${a.share_token}/r`}async unshareRun(e){Nt(e);const t=await this.caller.call(dt(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(t,"unshare run",!0)}async readRunSharedLink(e){Nt(e);const r=await(await this.caller.call(dt(this.debug),`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();if(!(r===null||!("share_token"in r)))return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){const r=new URLSearchParams({share_token:e});if(t!==void 0)for(const s of t)r.append("id",s);return Nt(e),await(await this.caller.call(dt(this.debug),`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async readDatasetSharedSchema(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id),Nt(e);const i=await(await this.caller.call(dt(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return i.url=`${this.getHostUrl()}/public/${i.share_token}/d`,i}async shareDataset(e,t){if(!e&&!t)throw new Error("Either datasetId or datasetName must be given");e||(e=(await this.readDataset({datasetName:t})).id);const r={dataset_id:e};Nt(e);const a=await(await this.caller.call(dt(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async unshareDataset(e){Nt(e);const t=await this.caller.call(dt(this.debug),`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(t,"unshare dataset",!0)}async readSharedDataset(e){return Nt(e),await(await this.caller.call(dt(this.debug),`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async listSharedExamples(e,t){const r={};t!=null&&t.exampleIds&&(r.id=t.exampleIds);const i=new URLSearchParams;Object.entries(r).forEach(([o,u])=>{Array.isArray(u)?u.forEach(c=>i.append(o,c)):i.append(o,u)});const a=await this.caller.call(dt(this.debug),`${this.apiUrl}/public/${e}/examples?${i.toString()}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),s=await a.json();if(!a.ok)throw"detail"in s?new Error(`Failed to list shared examples.
Status: ${a.status}
Message: ${Array.isArray(s.detail)?s.detail.join(`
`):"Unspecified error"}`):new Error(`Failed to list shared examples: ${a.status} ${a.statusText}`);return s.map(o=>({...o,_hostUrl:this.getHostUrl()}))}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:i=!1,projectExtra:a=null,referenceDatasetId:s=null}){const o=i?"?upsert=true":"",u=`${this.apiUrl}/sessions${o}`,c=a||{};r&&(c.metadata=r);const d={name:e,extra:c,description:t};s!==null&&(d.reference_dataset_id=s);const p=await this.caller.call(dt(this.debug),u,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(d),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await $t(p,"create project"),await p.json()}async updateProject(e,{name:t=null,description:r=null,metadata:i=null,projectExtra:a=null,endTime:s=null}){const o=`${this.apiUrl}/sessions/${e}`;let u=a;i&&(u={...u||{},metadata:i});const c={name:t,extra:u,description:r,end_time:s?new Date(s).toISOString():null},d=await this.caller.call(dt(this.debug),o,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await $t(d,"update project"),await d.json()}async hasProject({projectId:e,projectName:t}){let r="/sessions";const i=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Nt(e),r+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide projectName or projectId");const a=await this.caller.call(dt(this.debug),`${this.apiUrl}${r}?${i}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{const s=await a.json();return a.ok?Array.isArray(s)?s.length>0:!0:!1}catch{return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let i="/sessions";const a=new URLSearchParams;if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");if(e!==void 0)Nt(e),i+=`/${e}`;else if(t!==void 0)a.append("name",t);else throw new Error("Must provide projectName or projectId");r!==void 0&&a.append("include_stats",r.toString());const s=await this._get(i,a);let o;if(Array.isArray(s)){if(s.length===0)throw new Error(`Project[id=${e}, name=${t}] not found`);o=s[0]}else o=s;return o}async getProjectUrl({projectId:e,projectName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either projectName or projectId");const r=await this.readProject({projectId:e,projectName:t}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/projects/p/${r.id}`}async getDatasetUrl({datasetId:e,datasetName:t}){if(e===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");const r=await this.readDataset({datasetId:e,datasetName:t}),i=await this._getTenantId();return`${this.getHostUrl()}/o/${i}/datasets/${r.id}`}async _getTenantId(){if(this._tenantId!==null)return this._tenantId;const e=new URLSearchParams({limit:"1"});for await(const t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw new Error("No projects found to resolve tenant.")}async*listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:i,referenceDatasetName:a,referenceFree:s,metadata:o}={}){const u=new URLSearchParams;if(e!==void 0)for(const c of e)u.append("id",c);if(t!==void 0&&u.append("name",t),r!==void 0&&u.append("name_contains",r),i!==void 0)u.append("reference_dataset",i);else if(a!==void 0){const c=await this.readDataset({datasetName:a});u.append("reference_dataset",c.id)}s!==void 0&&u.append("reference_free",s.toString()),o!==void 0&&u.append("metadata",JSON.stringify(o));for await(const c of this._getPaginated("/sessions",u))yield*c}async deleteProject({projectId:e,projectName:t}){let r;if(e===void 0&&t===void 0)throw new Error("Must provide projectName or projectId");if(e!==void 0&&t!==void 0)throw new Error("Must provide either projectName or projectId, not both");e===void 0?r=(await this.readProject({projectName:t})).id:r=e,Nt(r);const i=await this.caller.call(dt(this.debug),`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(i,`delete session ${r} (${t})`,!0)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:i,description:a,dataType:s,name:o}){const u=`${this.apiUrl}/datasets/upload`,c=new FormData;c.append("file",e,t),r.forEach(m=>{c.append("input_keys",m)}),i.forEach(m=>{c.append("output_keys",m)}),a&&c.append("description",a),s&&c.append("data_type",s),o&&c.append("name",o);const d=await this.caller.call(dt(this.debug),u,{method:"POST",headers:this.headers,body:c,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await $t(d,"upload CSV"),await d.json()}async createDataset(e,{description:t,dataType:r,inputsSchema:i,outputsSchema:a,metadata:s}={}){const o={name:e,description:t,extra:s?{metadata:s}:void 0};r&&(o.data_type=r),i&&(o.inputs_schema_definition=i),a&&(o.outputs_schema_definition=a);const u=await this.caller.call(dt(this.debug),`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await $t(u,"create dataset"),await u.json()}async readDataset({datasetId:e,datasetName:t}){let r="/datasets";const i=new URLSearchParams({limit:"1"});if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)Nt(e),r+=`/${e}`;else if(t!==void 0)i.append("name",t);else throw new Error("Must provide datasetName or datasetId");const a=await this._get(r,i);let s;if(Array.isArray(a)){if(a.length===0)throw new Error(`Dataset[id=${e}, name=${t}] not found`);s=a[0]}else s=a;return s}async hasDataset({datasetId:e,datasetName:t}){try{return await this.readDataset({datasetId:e,datasetName:t}),!0}catch(r){if(r instanceof Error&&r.message.toLocaleLowerCase().includes("not found"))return!1;throw r}}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:i}){let a=e;if(a===void 0&&t===void 0)throw new Error("Must provide either datasetName or datasetId");if(a!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");a===void 0&&(a=(await this.readDataset({datasetName:t})).id);const s=new URLSearchParams({from_version:typeof r=="string"?r:r.toISOString(),to_version:typeof i=="string"?i:i.toISOString()});return await this._get(`/datasets/${a}/versions/diff`,s)}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){const r="/datasets";if(e===void 0)if(t!==void 0)e=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide either datasetName or datasetId");return(await(await this._getResponse(`${r}/${e}/openai_ft`)).text()).trim().split(`
`).map(o=>JSON.parse(o))}async*listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:i,datasetNameContains:a,metadata:s}={}){const o="/datasets",u=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(r!==void 0)for(const c of r)u.append("id",c);i!==void 0&&u.append("name",i),a!==void 0&&u.append("name_contains",a),s!==void 0&&u.append("metadata",JSON.stringify(s));for await(const c of this._getPaginated(o,u))yield*c}async updateDataset(e){const{datasetId:t,datasetName:r,...i}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");const a=t??(await this.readDataset({datasetName:r})).id;Nt(a);const s=await this.caller.call(dt(this.debug),`${this.apiUrl}/datasets/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await $t(s,"update dataset"),await s.json()}async updateDatasetTag(e){const{datasetId:t,datasetName:r,asOf:i,tag:a}=e;if(!t&&!r)throw new Error("Must provide either datasetName or datasetId");const s=t??(await this.readDataset({datasetName:r})).id;Nt(s);const o=await this.caller.call(dt(this.debug),`${this.apiUrl}/datasets/${s}/tags`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({as_of:typeof i=="string"?i:i.toISOString(),tag:a}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(o,"update dataset tags")}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",i=e;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(t!==void 0&&(i=(await this.readDataset({datasetName:t})).id),i!==void 0)Nt(i),r+=`/${i}`;else throw new Error("Must provide datasetName or datasetId");const a=await this.caller.call(dt(this.debug),this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(a,`delete ${r}`),await a.json()}async indexDataset({datasetId:e,datasetName:t,tag:r}){let i=e;if(!i&&!t)throw new Error("Must provide either datasetName or datasetId");if(i&&t)throw new Error("Must provide either datasetName or datasetId, not both");i||(i=(await this.readDataset({datasetName:t})).id),Nt(i);const a={tag:r},s=await this.caller.call(dt(this.debug),`${this.apiUrl}/datasets/${i}/index`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(s,"index dataset"),await s.json()}async similarExamples(e,t,r,{filter:i}={}){const a={limit:r,inputs:e};i!==void 0&&(a.filter=i),Nt(t);const s=await this.caller.call(dt(this.debug),`${this.apiUrl}/datasets/${t}/search`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await $t(s,"fetch similar examples"),(await s.json()).examples}async createExample(e,t,r){var d;if(ED(e)&&(t!==void 0||r!==void 0))throw new Error("Cannot provide outputs or options when using ExampleCreate object");let i=t?r==null?void 0:r.datasetId:e.dataset_id;const a=t?r==null?void 0:r.datasetName:e.dataset_name;if(i===void 0&&a===void 0)throw new Error("Must provide either datasetName or datasetId");if(i!==void 0&&a!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");i===void 0&&(i=(await this.readDataset({datasetName:a})).id);const s=(t?r==null?void 0:r.createdAt:e.created_at)||new Date;let o;ED(e)?o=e:o={inputs:e,outputs:t,created_at:s==null?void 0:s.toISOString(),id:r==null?void 0:r.exampleId,metadata:r==null?void 0:r.metadata,split:r==null?void 0:r.split,source_run_id:r==null?void 0:r.sourceRunId,use_source_run_io:r==null?void 0:r.useSourceRunIO,use_source_run_attachments:r==null?void 0:r.useSourceRunAttachments,attachments:r==null?void 0:r.attachments};const u=await this._uploadExamplesMultipart(i,[o]);return await this.readExample(((d=u.example_ids)==null?void 0:d[0])??hf())}async createExamples(e){if(Array.isArray(e)){if(e.length===0)return[];const C=e;let A=C[0].dataset_id;const I=C[0].dataset_name;if(A===void 0&&I===void 0)throw new Error("Must provide either datasetName or datasetId");if(A!==void 0&&I!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");A===void 0&&(A=(await this.readDataset({datasetName:I})).id);const x=await this._uploadExamplesMultipart(A,C);return await Promise.all(x.example_ids.map(U=>this.readExample(U)))}const{inputs:t,outputs:r,metadata:i,splits:a,sourceRunIds:s,useSourceRunIOs:o,useSourceRunAttachments:u,attachments:c,exampleIds:d,datasetId:p,datasetName:m}=e;if(t===void 0)throw new Error("Must provide inputs when using legacy parameters");let y=p;const b=m;if(y===void 0&&b===void 0)throw new Error("Must provide either datasetName or datasetId");if(y!==void 0&&b!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");y===void 0&&(y=(await this.readDataset({datasetName:b})).id);const w=t.map((C,A)=>({dataset_id:y,inputs:C,outputs:r==null?void 0:r[A],metadata:i==null?void 0:i[A],split:a==null?void 0:a[A],id:d==null?void 0:d[A],attachments:c==null?void 0:c[A],source_run_id:s==null?void 0:s[A],use_source_run_io:o==null?void 0:o[A],use_source_run_attachments:u==null?void 0:u[A]})),S=await this._uploadExamplesMultipart(y,w);return await Promise.all(S.example_ids.map(C=>this.readExample(C)))}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){const i=e.map(s=>AM(s)?CM(s):s),a=AM(t)?CM(t):t;return this.createExample({input:i},{output:a},r)}async readExample(e){Nt(e);const t=`/examples/${e}`,r=await this._get(t),{attachment_urls:i,...a}=r,s=a;return i&&(s.attachments=Object.entries(i).reduce((o,[u,c])=>(o[u.slice(11)]={presigned_url:c.presigned_url,mime_type:c.mime_type},o),{})),s}async*listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:i,splits:a,inlineS3Urls:s,metadata:o,limit:u,offset:c,filter:d,includeAttachments:p}={}){let m;if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");if(e!==void 0)m=e;else if(t!==void 0)m=(await this.readDataset({datasetName:t})).id;else throw new Error("Must provide a datasetName or datasetId");const y=new URLSearchParams({dataset:m}),b=i?typeof i=="string"?i:i==null?void 0:i.toISOString():void 0;b&&y.append("as_of",b);const w=s??!0;if(y.append("inline_s3_urls",w.toString()),r!==void 0)for(const T of r)y.append("id",T);if(a!==void 0)for(const T of a)y.append("splits",T);if(o!==void 0){const T=JSON.stringify(o);y.append("metadata",T)}u!==void 0&&y.append("limit",u.toString()),c!==void 0&&y.append("offset",c.toString()),d!==void 0&&y.append("filter",d),p===!0&&["attachment_urls","outputs","metadata"].forEach(T=>y.append("select",T));let S=0;for await(const T of this._getPaginated("/examples",y)){for(const C of T){const{attachment_urls:A,...I}=C,x=I;A&&(x.attachments=Object.entries(A).reduce((L,[U,N])=>(L[U.slice(11)]={presigned_url:N.presigned_url,mime_type:N.mime_type||void 0},L),{})),yield x,S++}if(u!==void 0&&S>=u)break}}async deleteExample(e){Nt(e);const t=`/examples/${e}`,r=await this.caller.call(dt(this.debug),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(r,`delete ${t}`),await r.json()}async updateExample(e,t){let r;t?r=e:r=e.id,Nt(r);let i;t?i={id:r,...t}:i=e;let a;return i.dataset_id!==void 0?a=i.dataset_id:a=(await this.readExample(r)).dataset_id,this._updateExamplesMultipart(a,[i])}async updateExamples(e){let t;return e[0].dataset_id===void 0?t=(await this.readExample(e[0].id)).dataset_id:t=e[0].dataset_id,this._updateExamplesMultipart(t,e)}async readDatasetVersion({datasetId:e,datasetName:t,asOf:r,tag:i}){let a;if(e?a=e:a=(await this.readDataset({datasetName:t})).id,Nt(a),r&&i||!r&&!i)throw new Error("Exactly one of asOf and tag must be specified.");const s=new URLSearchParams;r!==void 0&&s.append("as_of",typeof r=="string"?r:r.toISOString()),i!==void 0&&s.append("tag",i);const o=await this.caller.call(dt(this.debug),`${this.apiUrl}/datasets/${a}/version?${s.toString()}`,{method:"GET",headers:{...this.headers},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await $t(o,"read dataset version"),await o.json()}async listDatasetSplits({datasetId:e,datasetName:t,asOf:r}){let i;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?i=(await this.readDataset({datasetName:t})).id:i=e,Nt(i);const a=new URLSearchParams,s=r?typeof r=="string"?r:r==null?void 0:r.toISOString():void 0;return s&&a.append("as_of",s),await this._get(`/datasets/${i}/splits`,a)}async updateDatasetSplits({datasetId:e,datasetName:t,splitName:r,exampleIds:i,remove:a=!1}){let s;if(e===void 0&&t===void 0)throw new Error("Must provide dataset name or ID");if(e!==void 0&&t!==void 0)throw new Error("Must provide either datasetName or datasetId, not both");e===void 0?s=(await this.readDataset({datasetName:t})).id:s=e,Nt(s);const o={split_name:r,examples:i.map(c=>(Nt(c),c)),remove:a},u=await this.caller.call(dt(this.debug),`${this.apiUrl}/datasets/${s}/splits`,{method:"PUT",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(u,"update dataset splits",!0)}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:i,referenceExample:a}={loadChildRuns:!1}){tB("This method is deprecated and will be removed in future LangSmith versions, use `evaluate` from `langsmith/evaluation` instead.");let s;if(typeof e=="string")s=await this.readRun(e,{loadChildRuns:i});else if(typeof e=="object"&&"id"in e)s=e;else throw new Error(`Invalid run type: ${typeof e}`);s.reference_example_id!==null&&s.reference_example_id!==void 0&&(a=await this.readExample(s.reference_example_id));const o=await t.evaluateRun(s,a),[u,c]=await this._logEvaluationFeedback(o,s,r);return c[0]}async createFeedback(e,t,{score:r,value:i,correction:a,comment:s,sourceInfo:o,feedbackSourceType:u="api",sourceRunId:c,feedbackId:d,feedbackConfig:p,projectId:m,comparativeExperimentId:y}){var C;if(!e&&!m)throw new Error("One of runId or projectId must be provided");if(e&&m)throw new Error("Only one of runId or projectId can be provided");const b={type:u??"api",metadata:o??{}};c!==void 0&&(b==null?void 0:b.metadata)!==void 0&&!b.metadata.__run&&(b.metadata.__run={run_id:c}),(b==null?void 0:b.metadata)!==void 0&&((C=b.metadata.__run)==null?void 0:C.run_id)!==void 0&&Nt(b.metadata.__run.run_id);const w={id:d??hf(),run_id:e,key:t,score:wD(r),value:i,correction:a,comment:s,feedback_source:b,comparative_experiment_id:y,feedbackConfig:p,session_id:m},S=`${this.apiUrl}/feedback`,T=await this.caller.call(dt(this.debug),S,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(w),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await $t(T,"create feedback",!0),w}async updateFeedback(e,{score:t,value:r,correction:i,comment:a}){const s={};t!=null&&(s.score=wD(t)),r!=null&&(s.value=r),i!=null&&(s.correction=i),a!=null&&(s.comment=a),Nt(e);const o=await this.caller.call(dt(this.debug),`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(o,"update feedback",!0)}async readFeedback(e){Nt(e);const t=`/feedback/${e}`;return await this._get(t)}async deleteFeedback(e){Nt(e);const t=`/feedback/${e}`,r=await this.caller.call(dt(this.debug),this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(r,`delete ${t}`),await r.json()}async*listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){const i=new URLSearchParams;if(e&&i.append("run",e.join(",")),t)for(const a of t)i.append("key",a);if(r)for(const a of r)i.append("source",a);for await(const a of this._getPaginated("/feedback",i))yield*a}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:i}={}){const a={run_id:e,feedback_key:t,feedback_config:i};return r?typeof r=="string"?a.expires_at=r:(r!=null&&r.hours||r!=null&&r.minutes||r!=null&&r.days)&&(a.expires_in=r):a.expires_in={hours:3},await(await this.caller.call(dt(this.debug),`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async createComparativeExperiment({name:e,experimentIds:t,referenceDatasetId:r,createdAt:i,description:a,metadata:s,id:o}){var d;if(t.length===0)throw new Error("At least one experiment is required");if(r||(r=(await this.readProject({projectId:t[0]})).reference_dataset_id),!r==null)throw new Error("A reference dataset is required");const u={id:o,name:e,experiment_ids:t,reference_dataset_id:r,description:a,created_at:(d=i??new Date)==null?void 0:d.toISOString(),extra:{}};return s&&(u.extra.metadata=s),await(await this.caller.call(dt(this.debug),`${this.apiUrl}/datasets/comparative`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async*listPresignedFeedbackTokens(e){Nt(e);const t=new URLSearchParams({run_id:e});for await(const r of this._getPaginated("/feedback/tokens",t))yield*r}_selectEvalResults(e){let t;return"results"in e?t=e.results:Array.isArray(e)?t=e:t=[e],t}async _logEvaluationFeedback(e,t,r){const i=this._selectEvalResults(e),a=[];for(const s of i){let o=r||{};s.evaluatorInfo&&(o={...s.evaluatorInfo,...o});let u=null;s.targetRunId?u=s.targetRunId:t&&(u=t.id),a.push(await this.createFeedback(u,s.key,{score:s.score,value:s.value,comment:s.comment,correction:s.correction,sourceInfo:o,sourceRunId:s.sourceRunId,feedbackConfig:s.feedbackConfig,feedbackSourceType:"model"}))}return[i,a]}async logEvaluationFeedback(e,t,r){const[i]=await this._logEvaluationFeedback(e,t,r);return i}async*listAnnotationQueues(e={}){const{queueIds:t,name:r,nameContains:i,limit:a}=e,s=new URLSearchParams;t&&t.forEach((u,c)=>{Nt(u,`queueIds[${c}]`),s.append("ids",u)}),r&&s.append("name",r),i&&s.append("name_contains",i),s.append("limit",(a!==void 0?Math.min(a,100):100).toString());let o=0;for await(const u of this._getPaginated("/annotation-queues",s))if(yield*u,o++,a!==void 0&&o>=a)break}async createAnnotationQueue(e){const{name:t,description:r,queueId:i,rubricInstructions:a}=e,s={name:t,description:r,id:i||hf(),rubric_instructions:a},o=await this.caller.call(dt(this.debug),`${this.apiUrl}/annotation-queues`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(Object.fromEntries(Object.entries(s).filter(([c,d])=>d!==void 0))),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await $t(o,"create annotation queue"),await o.json()}async readAnnotationQueue(e){const t=await this.caller.call(dt(this.debug),`${this.apiUrl}/annotation-queues/${Nt(e,"queueId")}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await $t(t,"read annotation queue"),await t.json()}async updateAnnotationQueue(e,t){const{name:r,description:i,rubricInstructions:a}=t,s=await this.caller.call(dt(this.debug),`${this.apiUrl}/annotation-queues/${Nt(e,"queueId")}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify({name:r,description:i,rubric_instructions:a}),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(s,"update annotation queue")}async deleteAnnotationQueue(e){const t=await this.caller.call(dt(this.debug),`${this.apiUrl}/annotation-queues/${Nt(e,"queueId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(t,"delete annotation queue")}async addRunsToAnnotationQueue(e,t){const r=await this.caller.call(dt(this.debug),`${this.apiUrl}/annotation-queues/${Nt(e,"queueId")}/runs`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t.map((i,a)=>Nt(i,`runIds[${a}]`).toString())),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(r,"add runs to annotation queue")}async getRunFromAnnotationQueue(e,t){const r=`/annotation-queues/${Nt(e,"queueId")}/run`,i=await this.caller.call(dt(this.debug),`${this.apiUrl}${r}/${t}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await $t(i,"get run from annotation queue"),await i.json()}async deleteRunFromAnnotationQueue(e,t){const r=await this.caller.call(dt(this.debug),`${this.apiUrl}/annotation-queues/${Nt(e,"queueId")}/runs/${Nt(t,"queueRunId")}`,{method:"DELETE",headers:{...this.headers,Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(r,"delete run from annotation queue")}async getSizeFromAnnotationQueue(e){const t=await this.caller.call(dt(this.debug),`${this.apiUrl}/annotation-queues/${Nt(e,"queueId")}/size`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await $t(t,"get size from annotation queue"),await t.json()}async _currentTenantIsOwner(e){const t=await this._getSettings();return e=="-"||t.tenant_handle===e}async _ownerConflictError(e,t){const r=await this._getSettings();return new Error(`Cannot ${e} for another tenant.

      Current tenant: ${r.tenant_handle}

      Requested tenant: ${t}`)}async _getLatestCommitHash(e){const t=await this.caller.call(dt(this.debug),`${this.apiUrl}/commits/${e}/?limit=1&offset=0`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();if(!t.ok){const i=typeof r.detail=="string"?r.detail:JSON.stringify(r.detail),a=new Error(`Error ${t.status}: ${t.statusText}
${i}`);throw a.statusCode=t.status,a}if(r.commits.length!==0)return r.commits[0].commit_hash}async _likeOrUnlikePrompt(e,t){const[r,i,a]=hl(e),s=await this.caller.call(dt(this.debug),`${this.apiUrl}/likes/${r}/${i}`,{method:"POST",body:JSON.stringify({like:t}),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await $t(s,`${t?"like":"unlike"} prompt`),await s.json()}async _getPromptUrl(e){const[t,r,i]=hl(e);if(await this._currentTenantIsOwner(t)){const a=await this._getSettings();return i!=="latest"?`${this.getHostUrl()}/prompts/${r}/${i.substring(0,8)}?organizationId=${a.id}`:`${this.getHostUrl()}/prompts/${r}?organizationId=${a.id}`}else return i!=="latest"?`${this.getHostUrl()}/hub/${t}/${r}/${i.substring(0,8)}`:`${this.getHostUrl()}/hub/${t}/${r}`}async promptExists(e){return!!await this.getPrompt(e)}async likePrompt(e){return this._likeOrUnlikePrompt(e,!0)}async unlikePrompt(e){return this._likeOrUnlikePrompt(e,!1)}async*listCommits(e){for await(const t of this._getPaginated(`/commits/${e}/`,new URLSearchParams,r=>r.commits))yield*t}async*listPrompts(e){const t=new URLSearchParams;t.append("sort_field",(e==null?void 0:e.sortField)??"updated_at"),t.append("sort_direction","desc"),t.append("is_archived",(!!(e!=null&&e.isArchived)).toString()),(e==null?void 0:e.isPublic)!==void 0&&t.append("is_public",e.isPublic.toString()),e!=null&&e.query&&t.append("query",e.query);for await(const r of this._getPaginated("/repos",t,i=>i.repos))yield*r}async getPrompt(e){const[t,r,i]=hl(e),a=await this.caller.call(dt(this.debug),`${this.apiUrl}/repos/${t}/${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(a.status===404)return null;await $t(a,"get prompt");const s=await a.json();return s.repo?s.repo:null}async createPrompt(e,t){const r=await this._getSettings();if(t!=null&&t.isPublic&&!r.tenant_handle)throw new Error(`Cannot create a public prompt without first

        creating a LangChain Hub handle. 
        You can add a handle by creating a public prompt at:

        https://smith.langchain.com/prompts`);const[i,a,s]=hl(e);if(!await this._currentTenantIsOwner(i))throw await this._ownerConflictError("create a prompt",i);const o={repo_handle:a,...(t==null?void 0:t.description)&&{description:t.description},...(t==null?void 0:t.readme)&&{readme:t.readme},...(t==null?void 0:t.tags)&&{tags:t.tags},is_public:!!(t!=null&&t.isPublic)},u=await this.caller.call(dt(this.debug),`${this.apiUrl}/repos/`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(u,"create prompt");const{repo:c}=await u.json();return c}async createCommit(e,t,r){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[i,a,s]=hl(e),o=(r==null?void 0:r.parentCommitHash)==="latest"||!(r!=null&&r.parentCommitHash)?await this._getLatestCommitHash(`${i}/${a}`):r==null?void 0:r.parentCommitHash,u={manifest:JSON.parse(JSON.stringify(t)),parent_commit:o},c=await this.caller.call(dt(this.debug),`${this.apiUrl}/commits/${i}/${a}`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(c,"create commit");const d=await c.json();return this._getPromptUrl(`${i}/${a}${d.commit_hash?`:${d.commit_hash}`:""}`)}async updateExamplesMultipart(e,t=[]){return this._updateExamplesMultipart(e,t)}async _updateExamplesMultipart(e,t=[]){var o;if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const r=new FormData;for(const u of t){const c=u.id,d={...u.metadata&&{metadata:u.metadata},...u.split&&{split:u.split}},p=Xi(d,`Serializing body for example with id: ${c}`),m=new Blob([p],{type:"application/json"});if(r.append(c,m),u.inputs){const y=Xi(u.inputs,`Serializing inputs for example with id: ${c}`),b=new Blob([y],{type:"application/json"});r.append(`${c}.inputs`,b)}if(u.outputs){const y=Xi(u.outputs,`Serializing outputs whle updating example with id: ${c}`),b=new Blob([y],{type:"application/json"});r.append(`${c}.outputs`,b)}if(u.attachments)for(const[y,b]of Object.entries(u.attachments)){let w,S;Array.isArray(b)?[w,S]=b:(w=b.mimeType,S=b.data);const T=new Blob([S],{type:`${w}; length=${S.byteLength}`});r.append(`${c}.attachment.${y}`,T)}if(u.attachments_operations){const y=Xi(u.attachments_operations,`Serializing attachments while updating example with id: ${c}`),b=new Blob([y],{type:"application/json"});r.append(`${c}.attachments_operations`,b)}}const i=e??((o=t[0])==null?void 0:o.dataset_id);return await(await this.caller.call(dt(this.debug),`${this.apiUrl}/v1/platform/datasets/${i}/examples`,{method:"PATCH",headers:this.headers,body:r})).json()}async uploadExamplesMultipart(e,t=[]){return this._uploadExamplesMultipart(e,t)}async _uploadExamplesMultipart(e,t=[]){if(!await this._getMultiPartSupport())throw new Error("Your LangSmith deployment does not allow using the multipart examples endpoint, please upgrade your deployment to the latest version.");const r=new FormData;for(const s of t){const o=(s.id??hf()).toString(),u={created_at:s.created_at,...s.metadata&&{metadata:s.metadata},...s.split&&{split:s.split},...s.source_run_id&&{source_run_id:s.source_run_id},...s.use_source_run_io&&{use_source_run_io:s.use_source_run_io},...s.use_source_run_attachments&&{use_source_run_attachments:s.use_source_run_attachments}},c=Xi(u,`Serializing body for uploaded example with id: ${o}`),d=new Blob([c],{type:"application/json"});if(r.append(o,d),s.inputs){const p=Xi(s.inputs,`Serializing inputs for uploaded example with id: ${o}`),m=new Blob([p],{type:"application/json"});r.append(`${o}.inputs`,m)}if(s.outputs){const p=Xi(s.outputs,`Serializing outputs for uploaded example with id: ${o}`),m=new Blob([p],{type:"application/json"});r.append(`${o}.outputs`,m)}if(s.attachments)for(const[p,m]of Object.entries(s.attachments)){let y,b;Array.isArray(m)?[y,b]=m:(y=m.mimeType,b=m.data);const w=new Blob([b],{type:`${y}; length=${b.byteLength}`});r.append(`${o}.attachment.${p}`,w)}}const i=await this.caller.call(dt(this.debug),`${this.apiUrl}/v1/platform/datasets/${e}/examples`,{method:"POST",headers:this.headers,body:r});return await $t(i,"upload examples"),await i.json()}async updatePrompt(e,t){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[r,i]=hl(e);if(!await this._currentTenantIsOwner(r))throw await this._ownerConflictError("update a prompt",r);const a={};if((t==null?void 0:t.description)!==void 0&&(a.description=t.description),(t==null?void 0:t.readme)!==void 0&&(a.readme=t.readme),(t==null?void 0:t.tags)!==void 0&&(a.tags=t.tags),(t==null?void 0:t.isPublic)!==void 0&&(a.is_public=t.isPublic),(t==null?void 0:t.isArchived)!==void 0&&(a.is_archived=t.isArchived),Object.keys(a).length===0)throw new Error("No valid update options provided");const s=await this.caller.call(dt(this.debug),`${this.apiUrl}/repos/${r}/${i}`,{method:"PATCH",body:JSON.stringify(a),headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await $t(s,"update prompt"),s.json()}async deletePrompt(e){if(!await this.promptExists(e))throw new Error("Prompt does not exist, you must create it first.");const[t,r,i]=hl(e);if(!await this._currentTenantIsOwner(t))throw await this._ownerConflictError("delete a prompt",t);return await(await this.caller.call(dt(this.debug),`${this.apiUrl}/repos/${t}/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions})).json()}async pullPromptCommit(e,t){const[r,i,a]=hl(e),s=await this.caller.call(dt(this.debug),`${this.apiUrl}/commits/${r}/${i}/${a}${t!=null&&t.includeModel?"?include_model=true":""}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await $t(s,"pull prompt commit");const o=await s.json();return{owner:r,repo:i,commit_hash:o.commit_hash,manifest:o.manifest,examples:o.examples}}async _pullPrompt(e,t){const r=await this.pullPromptCommit(e,{includeModel:t==null?void 0:t.includeModel});return JSON.stringify(r.manifest)}async pushPrompt(e,t){return await this.promptExists(e)?t&&Object.keys(t).some(i=>i!=="object")&&await this.updatePrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}):await this.createPrompt(e,{description:t==null?void 0:t.description,readme:t==null?void 0:t.readme,tags:t==null?void 0:t.tags,isPublic:t==null?void 0:t.isPublic}),t!=null&&t.object?await this.createCommit(e,t==null?void 0:t.object,{parentCommitHash:t==null?void 0:t.parentCommitHash}):await this._getPromptUrl(e)}async clonePublicDataset(e,t={}){const{sourceApiUrl:r=this.apiUrl,datasetName:i}=t,[a,s]=this.parseTokenOrUrl(e,r),o=new ZC({apiUrl:a,apiKey:"placeholder"}),u=await o.readSharedDataset(s),c=i||u.name;try{if(await this.hasDataset({datasetId:c})){console.log(`Dataset ${c} already exists in your tenant. Skipping.`);return}}catch{}const d=await o.listSharedExamples(s),p=await this.createDataset(c,{description:u.description,dataType:u.data_type||"kv",inputsSchema:u.inputs_schema_definition??void 0,outputsSchema:u.outputs_schema_definition??void 0});try{await this.createExamples({inputs:d.map(m=>m.inputs),outputs:d.flatMap(m=>m.outputs?[m.outputs]:[]),datasetId:p.id})}catch(m){throw console.error(`An error occurred while creating dataset ${c}. You should delete it manually.`),m}}parseTokenOrUrl(e,t,r=2,i="dataset"){try{return Nt(e),[t,e]}catch{}try{const s=new URL(e).pathname.split("/").filter(o=>o!=="");if(s.length>=r){const o=s[s.length-r];return[t,o]}else throw new Error(`Invalid public ${i} URL: ${e}`)}catch{throw new Error(`Invalid public ${i} URL or token: ${e}`)}}awaitPendingTraceBatches(){return this.manualFlushMode?(console.warn("[WARNING]: When tracing in manual flush mode, you must call `await client.flush()` manually to submit trace batches."),Promise.resolve()):Promise.all([...this.autoBatchQueue.items.map(({itemPromise:e})=>e),this.batchIngestCaller.queue.onIdle()])}};function ED(n){return"dataset_id"in n||"dataset_name"in n}const K7=n=>!!["TRACING_V2","TRACING"].find(t=>ns(t)==="true"),rS=Symbol.for("lc:context_variables");function J7(n){return n.replace(/[-:.]/g,"")}function Y7(n,e,t=1){const r=t.toFixed(0).slice(0,3).padStart(3,"0");return J7(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}class qv{constructor(e,t,r,i){Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.metadata=e,this.tags=t,this.project_name=r,this.replicas=i}static fromHeader(e){const t=e.split(",");let r={},i=[],a,s;for(const o of t){const[u,c]=o.split("="),d=decodeURIComponent(c);u==="langsmith-metadata"?r=JSON.parse(d):u==="langsmith-tags"?i=d.split(","):u==="langsmith-project"?a=d:u==="langsmith-replicas"&&(s=JSON.parse(d))}return new qv(r,i,a,s)}toHeader(){const e=[];return this.metadata&&Object.keys(this.metadata).length>0&&e.push(`langsmith-metadata=${encodeURIComponent(JSON.stringify(this.metadata))}`),this.tags&&this.tags.length>0&&e.push(`langsmith-tags=${encodeURIComponent(this.tags.join(","))}`),this.project_name&&e.push(`langsmith-project=${encodeURIComponent(this.project_name)}`),e.join(",")}}class Ai{constructor(e){var o;if(Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"run_type",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"project_name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"parent_run",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_runs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"start_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"end_time",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"extra",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"error",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"serialized",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reference_example_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"events",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"dotted_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"child_execution_order",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"attachments",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),oB(e)){Object.assign(this,{...e});return}const t=Ai.getDefaultConfig(),{metadata:r,...i}=e,a=i.client??Ai.getSharedClient(),s={...r,...(o=i==null?void 0:i.extra)==null?void 0:o.metadata};if(i.extra={...i.extra,metadata:s},Object.assign(this,{...t,...i,client:a}),this.trace_id||(this.parent_run?this.trace_id=this.parent_run.trace_id??this.id:this.trace_id=this.id),this.execution_order??(this.execution_order=1),this.child_execution_order??(this.child_execution_order=1),!this.dotted_order){const u=Y7(this.start_time,this.id,this.execution_order);this.parent_run?this.dotted_order=this.parent_run.dotted_order+"."+u:this.dotted_order=u}}set metadata(e){var t;this.extra={...this.extra,metadata:{...(t=this.extra)==null?void 0:t.metadata,...e}}}get metadata(){var e;return(e=this.extra)==null?void 0:e.metadata}static getDefaultConfig(){return{id:hf(),run_type:"chain",project_name:YF(),child_runs:[],api_url:Dl("LANGCHAIN_ENDPOINT")??"http://localhost:1984",api_key:Dl("LANGCHAIN_API_KEY"),caller_options:{},start_time:Date.now(),serialized:{},inputs:{},extra:{}}}static getSharedClient(){return Ai.sharedClient||(Ai.sharedClient=new sB),Ai.sharedClient}createChild(e){var u,c,d,p,m,y;const t=this.child_execution_order+1,r=new Ai({...e,parent_run:this,project_name:this.project_name,replicas:this.replicas,client:this.client,tracingEnabled:this.tracingEnabled,execution_order:t,child_execution_order:t});rS in this&&(r[rS]=this[rS]);const i=Symbol.for("lc:child_config"),a=((u=e.extra)==null?void 0:u[i])??this.extra[i];if(X7(a)){const b={...a},w=Z7(b.callbacks)?(d=(c=b.callbacks).copy)==null?void 0:d.call(c):void 0;w&&(Object.assign(w,{_parentRunId:r.id}),(y=(m=(p=w.handlers)==null?void 0:p.find(lB))==null?void 0:m.updateFromRunTree)==null||y.call(m,r),b.callbacks=w),r.extra[i]=b}const s=new Set;let o=this;for(;o!=null&&!s.has(o.id);)s.add(o.id),o.child_execution_order=Math.max(o.child_execution_order,t),o=o.parent_run;return this.child_runs.push(r),r}async end(e,t,r=Date.now(),i){this.outputs=this.outputs??e,this.error=this.error??t,this.end_time=this.end_time??r,i&&Object.keys(i).length>0&&(this.extra=this.extra?{...this.extra,metadata:{...this.extra.metadata,...i}}:{metadata:i})}_convertToCreate(e,t,r=!0){var o,u;const i=e.extra??{};if(((o=i==null?void 0:i.runtime)==null?void 0:o.library)===void 0&&(i.runtime||(i.runtime={}),t))for(const[c,d]of Object.entries(t))i.runtime[c]||(i.runtime[c]=d);let a,s;return r?(s=(u=e.parent_run)==null?void 0:u.id,a=[]):(a=e.child_runs.map(c=>this._convertToCreate(c,t,r)),s=void 0),{id:e.id,name:e.name,start_time:e.start_time,end_time:e.end_time,run_type:e.run_type,reference_example_id:e.reference_example_id,extra:i,serialized:e.serialized,error:e.error,inputs:e.inputs,outputs:e.outputs,session_name:e.project_name,child_runs:a,parent_run_id:s,trace_id:e.trace_id,dotted_order:e.dotted_order,tags:e.tags,attachments:e.attachments,events:e.events}}_remapForProject(e,t,r=!0){const i=this._convertToCreate(this,t,r);if(e===this.project_name)return i;const a=p=>yM(`${p}:${e}`,yM.DNS),s=a(i.id),o=i.trace_id?a(i.trace_id):void 0,u=i.parent_run_id?a(i.parent_run_id):void 0;let c;if(i.dotted_order){const p=Q7(i.dotted_order),m=[];for(let b=0;b<p.length-1;b++){const[w,S]=p[b],T=a(S);m.push(w.toISOString().replace(/[-:]/g,"").replace(".","")+T)}const[y]=p[p.length-1];m.push(y.toISOString().replace(/[-:]/g,"").replace(".","")+s),c=m.join(".")}else c=void 0;return{...i,id:s,trace_id:o,parent_run_id:u,dotted_order:c,session_name:e}}async postRun(e=!0){try{const t=QF();if(this.replicas&&this.replicas.length>0)for(const[r]of this.replicas){const i=this._remapForProject(r,t,!0);await this.client.createRun(i)}else{const r=this._convertToCreate(this,t,e);await this.client.createRun(r)}if(!e){tB("Posting with excludeChildRuns=false is deprecated and will be removed in a future version.");for(const r of this.child_runs)await r.postRun(!1)}}catch(t){console.error(`Error in postRun for run ${this.id}:`,t)}}async patchRun(){var e;if(this.replicas&&this.replicas.length>0)for(const[t,r]of this.replicas){const i=this._remapForProject(t);await this.client.updateRun(i.id,{inputs:i.inputs,outputs:i.outputs,error:i.error,parent_run_id:i.parent_run_id,session_name:i.session_name,reference_example_id:i.reference_example_id,end_time:i.end_time,dotted_order:i.dotted_order,trace_id:i.trace_id,events:i.events,tags:i.tags,extra:i.extra,attachments:this.attachments,...r})}else try{const t={end_time:this.end_time,error:this.error,inputs:this.inputs,outputs:this.outputs,parent_run_id:(e=this.parent_run)==null?void 0:e.id,reference_example_id:this.reference_example_id,extra:this.extra,events:this.events,dotted_order:this.dotted_order,trace_id:this.trace_id,tags:this.tags,attachments:this.attachments,session_name:this.project_name};await this.client.updateRun(this.id,t)}catch(t){console.error(`Error in patchRun for run ${this.id}`,t)}}toJSON(){return this._convertToCreate(this,void 0,!1)}addEvent(e){this.events||(this.events=[]),typeof e=="string"?this.events.push({name:"event",time:new Date().toISOString(),message:e}):this.events.push({...e,time:e.time??new Date().toISOString()})}static fromRunnableConfig(e,t){var c,d,p,m;const r=e==null?void 0:e.callbacks;let i,a,s,o=K7();if(r){const y=((c=r==null?void 0:r.getParentRunId)==null?void 0:c.call(r))??"",b=(d=r==null?void 0:r.handlers)==null?void 0:d.find(w=>(w==null?void 0:w.name)=="langchain_tracer");i=(p=b==null?void 0:b.getRun)==null?void 0:p.call(b,y),a=b==null?void 0:b.projectName,s=b==null?void 0:b.client,o=o||!!b}return i?new Ai({name:i.name,id:i.id,trace_id:i.trace_id,dotted_order:i.dotted_order,client:s,tracingEnabled:o,project_name:a,tags:[...new Set(((i==null?void 0:i.tags)??[]).concat((e==null?void 0:e.tags)??[]))],extra:{metadata:{...(m=i==null?void 0:i.extra)==null?void 0:m.metadata,...e==null?void 0:e.metadata}}}).createChild(t):new Ai({...t,client:s,tracingEnabled:o,project_name:a})}static fromDottedOrder(e){return this.fromHeaders({"langsmith-trace":e})}static fromHeaders(e,t){var c;const r="get"in e&&typeof e.get=="function"?{"langsmith-trace":e.get("langsmith-trace"),baggage:e.get("baggage")}:e,i=r["langsmith-trace"];if(!i||typeof i!="string")return;const a=i.trim(),s=a.split(".").map(d=>{const[p,m]=d.split("Z");return{strTime:p,time:Date.parse(p+"Z"),uuid:m}}),o=s[0].uuid,u={...t,name:(t==null?void 0:t.name)??"parent",run_type:(t==null?void 0:t.run_type)??"chain",start_time:(t==null?void 0:t.start_time)??Date.now(),id:(c=s.at(-1))==null?void 0:c.uuid,trace_id:o,dotted_order:a};if(r.baggage&&typeof r.baggage=="string"){const d=qv.fromHeader(r.baggage);u.metadata=d.metadata,u.tags=d.tags,u.project_name=d.project_name,u.replicas=d.replicas}return new Ai(u)}toHeaders(e){var r;const t={"langsmith-trace":this.dotted_order,baggage:new qv((r=this.extra)==null?void 0:r.metadata,this.tags,this.project_name,this.replicas).toHeader()};if(e)for(const[i,a]of Object.entries(t))e.set(i,a);return t}}Object.defineProperty(Ai,"sharedClient",{enumerable:!0,configurable:!0,writable:!0,value:null});function oB(n){return n!==void 0&&typeof n.createChild=="function"&&typeof n.postRun=="function"}function lB(n){return typeof n=="object"&&n!=null&&typeof n.name=="string"&&n.name==="langchain_tracer"}function SD(n){return Array.isArray(n)&&n.some(e=>lB(e))}function Z7(n){return typeof n=="object"&&n!=null&&Array.isArray(n.handlers)}function X7(n){var e;return n!==void 0&&typeof n.callbacks=="object"&&(SD((e=n.callbacks)==null?void 0:e.handlers)||SD(n.callbacks))}function Q7(n){return n.split(".").map(t=>{const r=t.slice(0,-36),i=t.slice(-36),a=parseInt(r.slice(0,4)),s=parseInt(r.slice(4,6))-1,o=parseInt(r.slice(6,8)),u=parseInt(r.slice(9,11)),c=parseInt(r.slice(11,13)),d=parseInt(r.slice(13,15)),p=parseInt(r.slice(15,21));return[new Date(a,s,o,u,c,d,p/1e3),i]})}let eW=class{getStore(){}run(e,t){return t()}};const iS=Symbol.for("ls:tracing_async_local_storage"),tW=new eW;let nW=class{getInstance(){return globalThis[iS]??tW}initializeGlobalInstance(e){globalThis[iS]===void 0&&(globalThis[iS]=e)}};const rW=new nW;function iW(n=!1){const e=rW.getInstance().getStore();if(!n&&!oB(e))throw new Error(`Could not get the current run tree.

Please make sure you are calling this method within a traceable function and that tracing is enabled.`);return e}function HR(n){return typeof n=="function"&&"langsmith:traceable"in n}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */const aW=Object.prototype.hasOwnProperty;function XC(n,e){return aW.call(n,e)}function QC(n){if(Array.isArray(n)){const t=new Array(n.length);for(let r=0;r<t.length;r++)t[r]=""+r;return t}if(Object.keys)return Object.keys(n);let e=[];for(let t in n)XC(n,t)&&e.push(t);return e}function Us(n){switch(typeof n){case"object":return JSON.parse(JSON.stringify(n));case"undefined":return null;default:return n}}function e1(n){let e=0;const t=n.length;let r;for(;e<t;){if(r=n.charCodeAt(e),r>=48&&r<=57){e++;continue}return!1}return!0}function Qc(n){return n.indexOf("/")===-1&&n.indexOf("~")===-1?n:n.replace(/~/g,"~0").replace(/\//g,"~1")}function sW(n){return n.replace(/~1/g,"/").replace(/~0/g,"~")}function t1(n){if(n===void 0)return!0;if(n){if(Array.isArray(n)){for(let t=0,r=n.length;t<r;t++)if(t1(n[t]))return!0}else if(typeof n=="object"){const t=QC(n),r=t.length;for(var e=0;e<r;e++)if(t1(n[t[e]]))return!0}}return!1}function TD(n,e){const t=[n];for(const r in e){const i=typeof e[r]=="object"?JSON.stringify(e[r],null,2):e[r];typeof i<"u"&&t.push(`${r}: ${i}`)}return t.join(`
`)}class oW extends Error{constructor(e,t,r,i,a){super(TD(e,{name:t,index:r,operation:i,tree:a})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.setPrototypeOf(this,new.target.prototype),this.message=TD(e,{name:t,index:r,operation:i,tree:a})}}const er=oW,Tf={add:function(n,e,t){return n[e]=this.value,{newDocument:t}},remove:function(n,e,t){var r=n[e];return delete n[e],{newDocument:t,removed:r}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:function(n,e,t){let r=n1(t,this.path);r&&(r=Us(r));const i=cp(t,{op:"remove",path:this.from}).removed;return cp(t,{op:"add",path:this.path,value:i}),{newDocument:t,removed:r}},copy:function(n,e,t){const r=n1(t,this.from);return cp(t,{op:"add",path:this.path,value:Us(r)}),{newDocument:t}},test:function(n,e,t){return{newDocument:t,test:Vv(n[e],this.value)}},_get:function(n,e,t){return this.value=n[e],{newDocument:t}}};var lW={add:function(n,e,t){return e1(e)?n.splice(e,0,this.value):n[e]=this.value,{newDocument:t,index:e}},remove:function(n,e,t){var r=n.splice(e,1);return{newDocument:t,removed:r[0]}},replace:function(n,e,t){var r=n[e];return n[e]=this.value,{newDocument:t,removed:r}},move:Tf.move,copy:Tf.copy,test:Tf.test,_get:Tf._get};function n1(n,e){if(e=="")return n;var t={op:"_get",path:e};return cp(n,t),t.value}function cp(n,e,t=!1,r=!0,i=!0,a=0){if(t&&(typeof t=="function"?t(e,0,n,e.path):r1(e,0)),e.path===""){let s={newDocument:n};if(e.op==="add")return s.newDocument=e.value,s;if(e.op==="replace")return s.newDocument=e.value,s.removed=n,s;if(e.op==="move"||e.op==="copy")return s.newDocument=n1(n,e.from),e.op==="move"&&(s.removed=n),s;if(e.op==="test"){if(s.test=Vv(n,e.value),s.test===!1)throw new er("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return s.newDocument=n,s}else{if(e.op==="remove")return s.removed=n,s.newDocument=null,s;if(e.op==="_get")return e.value=n,s;if(t)throw new er("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",a,e,n);return s}}else{r||(n=Us(n));const o=(e.path||"").split("/");let u=n,c=1,d=o.length,p,m,y;for(typeof t=="function"?y=t:y=r1;;){if(m=o[c],m&&m.indexOf("~")!=-1&&(m=sW(m)),i&&(m=="__proto__"||m=="prototype"&&c>0&&o[c-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(t&&p===void 0&&(u[m]===void 0?p=o.slice(0,c).join("/"):c==d-1&&(p=e.path),p!==void 0&&y(e,0,n,p)),c++,Array.isArray(u)){if(m==="-")m=u.length;else{if(t&&!e1(m))throw new er("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",a,e,n);e1(m)&&(m=~~m)}if(c>=d){if(t&&e.op==="add"&&m>u.length)throw new er("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",a,e,n);const b=lW[e.op].call(e,u,m,n);if(b.test===!1)throw new er("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return b}}else if(c>=d){const b=Tf[e.op].call(e,u,m,n);if(b.test===!1)throw new er("Test operation failed","TEST_OPERATION_FAILED",a,e,n);return b}if(u=u[m],t&&c<d&&(!u||typeof u!="object"))throw new er("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",a,e,n)}}}function Np(n,e,t,r=!0,i=!0){if(t&&!Array.isArray(e))throw new er("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");r||(n=Us(n));const a=new Array(e.length);for(let s=0,o=e.length;s<o;s++)a[s]=cp(n,e[s],t,!0,i,s),n=a[s].newDocument;return a.newDocument=n,a}function r1(n,e,t,r){if(typeof n!="object"||n===null||Array.isArray(n))throw new er("Operation is not an object","OPERATION_NOT_AN_OBJECT",e,n,t);if(Tf[n.op]){if(typeof n.path!="string")throw new er("Operation `path` property is not a string","OPERATION_PATH_INVALID",e,n,t);if(n.path.indexOf("/")!==0&&n.path.length>0)throw new er('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",e,n,t);if((n.op==="move"||n.op==="copy")&&typeof n.from!="string")throw new er("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&n.value===void 0)throw new er("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",e,n,t);if((n.op==="add"||n.op==="replace"||n.op==="test")&&t1(n.value))throw new er("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",e,n,t);if(t){if(n.op=="add"){var i=n.path.split("/").length,a=r.split("/").length;if(i!==a+1&&i!==a)throw new er("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",e,n,t)}else if(n.op==="replace"||n.op==="remove"||n.op==="_get"){if(n.path!==r)throw new er("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",e,n,t)}else if(n.op==="move"||n.op==="copy"){var s={op:"_get",path:n.from,value:void 0},o=uW([s],t);if(o&&o.name==="OPERATION_PATH_UNRESOLVABLE")throw new er("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",e,n,t)}}}else throw new er("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",e,n,t)}function uW(n,e,t){try{if(!Array.isArray(n))throw new er("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(e)Np(Us(e),Us(n),t||!0);else{t=t||r1;for(var r=0;r<n.length;r++)t(n[r],r,e,void 0)}}catch(i){if(i instanceof er)return i;throw i}}function Vv(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){var t=Array.isArray(n),r=Array.isArray(e),i,a,s;if(t&&r){if(a=n.length,a!=e.length)return!1;for(i=a;i--!==0;)if(!Vv(n[i],e[i]))return!1;return!0}if(t!=r)return!1;var o=Object.keys(n);if(a=o.length,a!==Object.keys(e).length)return!1;for(i=a;i--!==0;)if(!e.hasOwnProperty(o[i]))return!1;for(i=a;i--!==0;)if(s=o[i],!Vv(n[s],e[s]))return!1;return!0}return n!==n&&e!==e}/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2013-2021 Joachim Wester
 * MIT license
 */function uB(n,e,t,r,i){if(e!==n){typeof e.toJSON=="function"&&(e=e.toJSON());for(var a=QC(e),s=QC(n),o=!1,u=s.length-1;u>=0;u--){var c=s[u],d=n[c];if(XC(e,c)&&!(e[c]===void 0&&d!==void 0&&Array.isArray(e)===!1)){var p=e[c];typeof d=="object"&&d!=null&&typeof p=="object"&&p!=null&&Array.isArray(d)===Array.isArray(p)?uB(d,p,t,r+"/"+Qc(c),i):d!==p&&(i&&t.push({op:"test",path:r+"/"+Qc(c),value:Us(d)}),t.push({op:"replace",path:r+"/"+Qc(c),value:Us(p)}))}else Array.isArray(n)===Array.isArray(e)?(i&&t.push({op:"test",path:r+"/"+Qc(c),value:Us(d)}),t.push({op:"remove",path:r+"/"+Qc(c)}),o=!0):(i&&t.push({op:"test",path:r,value:n}),t.push({op:"replace",path:r,value:e}))}if(!(!o&&a.length==s.length))for(var u=0;u<a.length;u++){var c=a[u];!XC(n,c)&&e[c]!==void 0&&t.push({op:"add",path:r+"/"+Qc(c),value:Us(e[c])})}}}function GR(n,e,t=!1){var r=[];return uB(n,e,r,"",t),r}var aS={};const cB=()=>typeof window<"u"&&typeof window.document<"u",fB=()=>typeof globalThis=="object"&&globalThis.constructor&&globalThis.constructor.name==="DedicatedWorkerGlobalScope",dB=()=>typeof window<"u"&&window.name==="nodejs"||typeof navigator<"u"&&navigator.userAgent.includes("jsdom"),B_=()=>typeof Deno<"u",hB=()=>typeof at<"u"&&typeof at.versions<"u"&&typeof at.versions.node<"u"&&!B_(),pB=()=>{let n;return cB()?n="browser":hB()?n="node":fB()?n="webworker":dB()?n="jsdom":B_()?n="deno":n="other",n};let sS;async function cW(){return WR()}function WR(){return sS===void 0&&(sS={library:"langchain-js",runtime:pB()}),sS}function Mi(n){try{return typeof at<"u"?aS==null?void 0:aS[n]:B_()?Deno==null?void 0:Deno.env.get(n):void 0}catch{return}}const fW=Object.freeze(Object.defineProperty({__proto__:null,getEnv:pB,getEnvironmentVariable:Mi,getRuntimeEnvironment:cW,getRuntimeEnvironmentSync:WR,isBrowser:cB,isDeno:B_,isJsDom:dB,isNode:hB,isWebWorker:fB},Symbol.toStringTag,{value:"Module"}));class dW{}function KR(n){return"lc_prefer_streaming"in n&&n.lc_prefer_streaming}class lc extends dW{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}get lc_serializable_keys(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,k_(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"raiseError",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:Mi("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.ignoreCustomEvent=e.ignoreCustomEvent??this.ignoreCustomEvent,this.raiseError=e.raiseError??this.raiseError,this.awaitHandlers=this.raiseError||(e._awaitHandler??this.awaitHandlers))}copy(){return new this.constructor(this)}toJSON(){return la.prototype.toJSON.call(this)}toJSONNotImplemented(){return la.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){class t extends lc{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Eo()}),Object.assign(this,e)}}return new t}}const mB=n=>{const e=n;return e!==void 0&&typeof e.copy=="function"&&typeof e.name=="string"&&typeof e.awaitHandlers=="boolean"},hW=Object.freeze(Object.defineProperty({__proto__:null,BaseCallbackHandler:lc,callbackHandlerPrefersStreaming:KR,isBaseCallbackHandler:mB},Symbol.toStringTag,{value:"Module"})),pW=n=>{if(n)return n.events=n.events??[],n.child_runs=n.child_runs??[],n};function i1(n,e){if(n)return new Ai({...n,parent_run:i1(e),child_runs:n.child_runs.map(t=>i1(t)).filter(t=>t!==void 0),extra:{...n.extra,runtime:WR()},tracingEnabled:!1})}function oS(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}function mW(n){return n.replace(/[-:.]/g,"")}function gW(n,e,t){const r=t.toFixed(0).slice(0,3).padStart(3,"0");return mW(`${new Date(n).toISOString().slice(0,-1)}${r}Z`)+e}function pf(n){return typeof n._addRunToRunMap=="function"}class Ys extends lc{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"runTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!1})}copy(){return this}getRunById(e){if(e!==void 0)return this.usesRunTreeMap?pW(this.runTreeMap.get(e)):this.runMap.get(e)}stringifyError(e){return e instanceof Error?e.message+(e!=null&&e.stack?`

${e.stack}`:""):typeof e=="string"?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}_addRunToRunMap(e){const t=gW(e.start_time,e.id,e.execution_order),r={...e},i=this.getRunById(r.parent_run_id);if(r.parent_run_id!==void 0?i&&(this._addChildRun(i,r),i.child_execution_order=Math.max(i.child_execution_order,r.child_execution_order),r.trace_id=i.trace_id,i.dotted_order!==void 0&&(r.dotted_order=[i.dotted_order,t].join("."))):(r.trace_id=r.id,r.dotted_order=t),this.usesRunTreeMap){const a=i1(r,i);a!==void 0&&this.runTreeMap.set(r.id,a)}else this.runMap.set(r.id,r);return r}async _endTrace(e){var r;const t=e.parent_run_id!==void 0&&this.getRunById(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),await((r=this.onRunUpdate)==null?void 0:r.call(this,e)),this.usesRunTreeMap?this.runTreeMap.delete(e.id):this.runMap.delete(e.id)}_getExecutionOrder(e){const t=e!==void 0&&this.getRunById(e);return t?t.child_execution_order+1:1}_createRunForLLMStart(e,t,r,i,a,s,o,u){const c=this._getExecutionOrder(i),d=Date.now(),p=o?{...a,metadata:o}:a,m={id:r,name:u??e.id[e.id.length-1],parent_run_id:i,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{prompts:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:p??{},tags:s||[]};return this._addRunToRunMap(m)}async handleLLMStart(e,t,r,i,a,s,o,u){var d,p;const c=this.getRunById(r)??this._createRunForLLMStart(e,t,r,i,a,s,o,u);return await((d=this.onRunCreate)==null?void 0:d.call(this,c)),await((p=this.onLLMStart)==null?void 0:p.call(this,c)),c}_createRunForChatModelStart(e,t,r,i,a,s,o,u){const c=this._getExecutionOrder(i),d=Date.now(),p=o?{...a,metadata:o}:a,m={id:r,name:u??e.id[e.id.length-1],parent_run_id:i,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:{messages:t},execution_order:c,child_runs:[],child_execution_order:c,run_type:"llm",extra:p??{},tags:s||[]};return this._addRunToRunMap(m)}async handleChatModelStart(e,t,r,i,a,s,o,u){var d,p;const c=this.getRunById(r)??this._createRunForChatModelStart(e,t,r,i,a,s,o,u);return await((d=this.onRunCreate)==null?void 0:d.call(this,c)),await((p=this.onLLMStart)==null?void 0:p.call(this,c)),c}async handleLLMEnd(e,t,r,i,a){var o;const s=this.getRunById(t);if(!s||(s==null?void 0:s.run_type)!=="llm")throw new Error("No LLM run to end.");return s.end_time=Date.now(),s.outputs=e,s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),s.extra={...s.extra,...a},await((o=this.onLLMEnd)==null?void 0:o.call(this,s)),await this._endTrace(s),s}async handleLLMError(e,t,r,i,a){var o;const s=this.getRunById(t);if(!s||(s==null?void 0:s.run_type)!=="llm")throw new Error("No LLM run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),s.extra={...s.extra,...a},await((o=this.onLLMError)==null?void 0:o.call(this,s)),await this._endTrace(s),s}_createRunForChainStart(e,t,r,i,a,s,o,u){const c=this._getExecutionOrder(i),d=Date.now(),p={id:r,name:u??e.id[e.id.length-1],parent_run_id:i,start_time:d,serialized:e,events:[{name:"start",time:new Date(d).toISOString()}],inputs:t,execution_order:c,child_execution_order:c,run_type:o??"chain",child_runs:[],extra:s?{metadata:s}:{},tags:a||[]};return this._addRunToRunMap(p)}async handleChainStart(e,t,r,i,a,s,o,u){var d,p;const c=this.getRunById(r)??this._createRunForChainStart(e,t,r,i,a,s,o,u);return await((d=this.onRunCreate)==null?void 0:d.call(this,c)),await((p=this.onChainStart)==null?void 0:p.call(this,c)),c}async handleChainEnd(e,t,r,i,a){var o;const s=this.getRunById(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.outputs=oS(e,"output"),s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(s.inputs=oS(a.inputs,"input")),await((o=this.onChainEnd)==null?void 0:o.call(this,s)),await this._endTrace(s),s}async handleChainError(e,t,r,i,a){var o;const s=this.getRunById(t);if(!s)throw new Error("No chain run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(e),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),(a==null?void 0:a.inputs)!==void 0&&(s.inputs=oS(a.inputs,"input")),await((o=this.onChainError)==null?void 0:o.call(this,s)),await this._endTrace(s),s}_createRunForToolStart(e,t,r,i,a,s,o){const u=this._getExecutionOrder(i),c=Date.now(),d={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{input:t},execution_order:u,child_execution_order:u,run_type:"tool",child_runs:[],extra:s?{metadata:s}:{},tags:a||[]};return this._addRunToRunMap(d)}async handleToolStart(e,t,r,i,a,s,o){var c,d;const u=this.getRunById(r)??this._createRunForToolStart(e,t,r,i,a,s,o);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((d=this.onToolStart)==null?void 0:d.call(this,u)),u}async handleToolEnd(e,t){var i;const r=this.getRunById(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((i=this.onToolEnd)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleToolError(e,t){var i;const r=this.getRunById(t);if(!r||(r==null?void 0:r.run_type)!=="tool")throw new Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((i=this.onToolError)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleAgentAction(e,t){var a;const r=this.getRunById(t);if(!r||(r==null?void 0:r.run_type)!=="chain")return;const i=r;i.actions=i.actions||[],i.actions.push(e),i.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await((a=this.onAgentAction)==null?void 0:a.call(this,r))}async handleAgentEnd(e,t){var i;const r=this.getRunById(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await((i=this.onAgentEnd)==null?void 0:i.call(this,r)))}_createRunForRetrieverStart(e,t,r,i,a,s,o){const u=this._getExecutionOrder(i),c=Date.now(),d={id:r,name:o??e.id[e.id.length-1],parent_run_id:i,start_time:c,serialized:e,events:[{name:"start",time:new Date(c).toISOString()}],inputs:{query:t},execution_order:u,child_execution_order:u,run_type:"retriever",child_runs:[],extra:s?{metadata:s}:{},tags:a||[]};return this._addRunToRunMap(d)}async handleRetrieverStart(e,t,r,i,a,s,o){var c,d;const u=this.getRunById(r)??this._createRunForRetrieverStart(e,t,r,i,a,s,o);return await((c=this.onRunCreate)==null?void 0:c.call(this,u)),await((d=this.onRetrieverStart)==null?void 0:d.call(this,u)),u}async handleRetrieverEnd(e,t){var i;const r=this.getRunById(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await((i=this.onRetrieverEnd)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleRetrieverError(e,t){var i;const r=this.getRunById(t);if(!r||(r==null?void 0:r.run_type)!=="retriever")throw new Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await((i=this.onRetrieverError)==null?void 0:i.call(this,r)),await this._endTrace(r),r}async handleText(e,t){var i;const r=this.getRunById(t);!r||(r==null?void 0:r.run_type)!=="chain"||(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await((i=this.onText)==null?void 0:i.call(this,r)))}async handleLLMNewToken(e,t,r,i,a,s){var u;const o=this.getRunById(r);if(!o||(o==null?void 0:o.run_type)!=="llm")throw new Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return o.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:s==null?void 0:s.chunk}}),await((u=this.onLLMNewToken)==null?void 0:u.call(this,o,e,{chunk:s==null?void 0:s.chunk})),o}}const yW=Object.freeze(Object.defineProperty({__proto__:null,BaseTracer:Ys,isBaseTracer:pf},Symbol.toStringTag,{value:"Module"}));var Wy={exports:{}};Wy.exports;var AD;function vW(){return AD||(AD=1,function(n){const t=(a=0)=>s=>`\x1B[${38+a};5;${s}m`,r=(a=0)=>(s,o,u)=>`\x1B[${38+a};2;${s};${o};${u}m`;function i(){const a=new Map,s={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};s.color.gray=s.color.blackBright,s.bgColor.bgGray=s.bgColor.bgBlackBright,s.color.grey=s.color.blackBright,s.bgColor.bgGrey=s.bgColor.bgBlackBright;for(const[o,u]of Object.entries(s)){for(const[c,d]of Object.entries(u))s[c]={open:`\x1B[${d[0]}m`,close:`\x1B[${d[1]}m`},u[c]=s[c],a.set(d[0],d[1]);Object.defineProperty(s,o,{value:u,enumerable:!1})}return Object.defineProperty(s,"codes",{value:a,enumerable:!1}),s.color.close="\x1B[39m",s.bgColor.close="\x1B[49m",s.color.ansi256=t(),s.color.ansi16m=r(),s.bgColor.ansi256=t(10),s.bgColor.ansi16m=r(10),Object.defineProperties(s,{rgbToAnsi256:{value:(o,u,c)=>o===u&&u===c?o<8?16:o>248?231:Math.round((o-8)/247*24)+232:16+36*Math.round(o/255*5)+6*Math.round(u/255*5)+Math.round(c/255*5),enumerable:!1},hexToRgb:{value:o=>{const u=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(o.toString(16));if(!u)return[0,0,0];let{colorString:c}=u.groups;c.length===3&&(c=c.split("").map(p=>p+p).join(""));const d=Number.parseInt(c,16);return[d>>16&255,d>>8&255,d&255]},enumerable:!1},hexToAnsi256:{value:o=>s.rgbToAnsi256(...s.hexToRgb(o)),enumerable:!1}}),s}Object.defineProperty(n,"exports",{enumerable:!0,get:i})}(Wy)),Wy.exports}var _W=vW();const gB=Js(_W);function si(n,e){return`${n.open}${e}${n.close}`}function Ta(n,e){try{return JSON.stringify(n,null,2)}catch{return e}}function CD(n){return typeof n=="string"?n.trim():n==null?n:Ta(n,n.toString())}function pl(n){if(!n.end_time)return"";const e=n.end_time-n.start_time;return e<1e3?`${e}ms`:`${(e/1e3).toFixed(2)}s`}const{color:Si}=gB;class a1 extends Ys{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){const t=[];let r=e;for(;r.parent_run_id;){const i=this.runMap.get(r.parent_run_id);if(i)t.push(i),r=i;else break}return t}getBreadcrumbs(e){const r=[...this.getParents(e).reverse(),e].map((i,a,s)=>{const o=`${i.execution_order}:${i.run_type}:${i.name}`;return a===s.length-1?si(gB.bold,o):o}).join(" > ");return si(Si.grey,r)}onChainStart(e){const t=this.getBreadcrumbs(e);console.log(`${si(Si.green,"[chain/start]")} [${t}] Entering Chain run with input: ${Ta(e.inputs,"[inputs]")}`)}onChainEnd(e){const t=this.getBreadcrumbs(e);console.log(`${si(Si.cyan,"[chain/end]")} [${t}] [${pl(e)}] Exiting Chain run with output: ${Ta(e.outputs,"[outputs]")}`)}onChainError(e){const t=this.getBreadcrumbs(e);console.log(`${si(Si.red,"[chain/error]")} [${t}] [${pl(e)}] Chain run errored with error: ${Ta(e.error,"[error]")}`)}onLLMStart(e){const t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(i=>i.trim())}:e.inputs;console.log(`${si(Si.green,"[llm/start]")} [${t}] Entering LLM run with input: ${Ta(r,"[inputs]")}`)}onLLMEnd(e){const t=this.getBreadcrumbs(e);console.log(`${si(Si.cyan,"[llm/end]")} [${t}] [${pl(e)}] Exiting LLM run with output: ${Ta(e.outputs,"[response]")}`)}onLLMError(e){const t=this.getBreadcrumbs(e);console.log(`${si(Si.red,"[llm/error]")} [${t}] [${pl(e)}] LLM run errored with error: ${Ta(e.error,"[error]")}`)}onToolStart(e){const t=this.getBreadcrumbs(e);console.log(`${si(Si.green,"[tool/start]")} [${t}] Entering Tool run with input: "${CD(e.inputs.input)}"`)}onToolEnd(e){var r;const t=this.getBreadcrumbs(e);console.log(`${si(Si.cyan,"[tool/end]")} [${t}] [${pl(e)}] Exiting Tool run with output: "${CD((r=e.outputs)==null?void 0:r.output)}"`)}onToolError(e){const t=this.getBreadcrumbs(e);console.log(`${si(Si.red,"[tool/error]")} [${t}] [${pl(e)}] Tool run errored with error: ${Ta(e.error,"[error]")}`)}onRetrieverStart(e){const t=this.getBreadcrumbs(e);console.log(`${si(Si.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${Ta(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){const t=this.getBreadcrumbs(e);console.log(`${si(Si.cyan,"[retriever/end]")} [${t}] [${pl(e)}] Exiting Retriever run with output: ${Ta(e.outputs,"[outputs]")}`)}onRetrieverError(e){const t=this.getBreadcrumbs(e);console.log(`${si(Si.red,"[retriever/error]")} [${t}] [${pl(e)}] Retriever run errored with error: ${Ta(e.error,"[error]")}`)}onAgentAction(e){const t=e,r=this.getBreadcrumbs(e);console.log(`${si(Si.blue,"[agent/action]")} [${r}] Agent selected action: ${Ta(t.actions[t.actions.length-1],"[action]")}`)}}const bW=Object.freeze(Object.defineProperty({__proto__:null,ConsoleCallbackHandler:a1},Symbol.toStringTag,{value:"Module"}));let lS;const yB=()=>{if(lS===void 0){const n=Mi("LANGCHAIN_CALLBACKS_BACKGROUND")==="false"?{blockOnRootRunFinalization:!0}:{};lS=new sB(n)}return lS};class Ol extends Ys{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"replicas",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"usesRunTreeMap",{enumerable:!0,configurable:!0,writable:!0,value:!0});const{exampleId:t,projectName:r,client:i,replicas:a}=e;this.projectName=r??YF(),this.replicas=a,this.exampleId=t,this.client=i??yB();const s=Ol.getTraceableRunTree();s&&this.updateFromRunTree(s)}async persistRun(e){}async onRunCreate(e){const t=this.getRunTreeWithTracingConfig(e.id);await(t==null?void 0:t.postRun())}async onRunUpdate(e){const t=this.getRunTreeWithTracingConfig(e.id);await(t==null?void 0:t.patchRun())}getRun(e){return this.runTreeMap.get(e)}updateFromRunTree(e){let t=e;const r=new Set;for(;t.parent_run&&!(r.has(t.id)||(r.add(t.id),!t.parent_run));)t=t.parent_run;r.clear();const i=[t];for(;i.length>0;){const a=i.shift();!a||r.has(a.id)||(r.add(a.id),this.runTreeMap.set(a.id,a),a.child_runs&&i.push(...a.child_runs))}this.client=e.client??this.client,this.replicas=e.replicas??this.replicas,this.projectName=e.project_name??this.projectName,this.exampleId=e.reference_example_id??this.exampleId}getRunTreeWithTracingConfig(e){const t=this.runTreeMap.get(e);if(t)return new Ai({...t,client:this.client,project_name:this.projectName,replicas:this.replicas,reference_example_id:this.exampleId,tracingEnabled:!0})}static getTraceableRunTree(){try{return iW(!0)}catch{return}}}const wW=Object.freeze(Object.defineProperty({__proto__:null,LangChainTracer:Ol},Symbol.toStringTag,{value:"Module"})),vB=Symbol.for("ls:tracing_async_local_storage"),Ky=Symbol.for("lc:context_variables"),EW=n=>{globalThis[vB]=n},kp=()=>globalThis[vB];let Pu;function SW(){const n="default"in Po?Po.default:Po;return new n({autoStart:!0,concurrency:1})}function TW(){return typeof Pu>"u"&&(Pu=SW()),Pu}async function nr(n,e){if(e===!0){const t=kp();t!==void 0?await t.run(void 0,async()=>n()):await n()}else Pu=TW(),Pu.add(async()=>{const t=kp();t!==void 0?await t.run(void 0,async()=>n()):await n()})}async function AW(){const n=yB();await Promise.allSettled([typeof Pu<"u"?Pu.onIdle():Promise.resolve(),n.awaitPendingTraceBatches()])}const CW=Object.freeze(Object.defineProperty({__proto__:null,awaitAllCallbacks:AW,consumeCallback:nr},Symbol.toStringTag,{value:"Module"})),RW=n=>!!["LANGSMITH_TRACING_V2","LANGCHAIN_TRACING_V2","LANGSMITH_TRACING","LANGCHAIN_TRACING"].find(t=>Mi(t)==="true");function _B(n){var r;const e=kp();if(e===void 0)return;const t=e.getStore();return(r=t==null?void 0:t[Ky])==null?void 0:r[n]}const IW=Symbol("lc:configure_hooks"),PW=()=>_B(IW)||[];function om(n){return n?Array.isArray(n)||"name"in n?{callbacks:n}:n:{}}class bB{setHandler(e){return this.setHandlers([e])}}class lm{constructor(e,t,r,i,a,s,o,u){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:u})}get parentRunId(){return this._parentRunId}async handleText(e){await Promise.all(this.handlers.map(t=>nr(async()=>{var r;try{await((r=t.handleText)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleText: ${i}`),t.raiseError)throw i}},t.awaitHandlers)))}async handleCustomEvent(e,t,r,i,a){await Promise.all(this.handlers.map(s=>nr(async()=>{var o;try{await((o=s.handleCustomEvent)==null?void 0:o.call(s,e,t,this.runId,this.tags,this.metadata))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleCustomEvent: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}}class wB extends lm{getChild(e){const t=new Jn(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>nr(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetriever`),t.raiseError)throw i}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>nr(async()=>{var r;if(!t.ignoreRetriever)try{await((r=t.handleRetrieverError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleRetrieverError: ${i}`),t.raiseError)throw e}},t.awaitHandlers)))}}class s1 extends lm{async handleLLMNewToken(e,t,r,i,a,s){await Promise.all(this.handlers.map(o=>nr(async()=>{var u;if(!o.ignoreLLM)try{await((u=o.handleLLMNewToken)==null?void 0:u.call(o,e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,s))}catch(c){if((o.raiseError?console.error:console.warn)(`Error in handler ${o.constructor.name}, handleLLMNewToken: ${c}`),o.raiseError)throw c}},o.awaitHandlers)))}async handleLLMError(e,t,r,i,a){await Promise.all(this.handlers.map(s=>nr(async()=>{var o;if(!s.ignoreLLM)try{await((o=s.handleLLMError)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,a))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleLLMError: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}async handleLLMEnd(e,t,r,i,a){await Promise.all(this.handlers.map(s=>nr(async()=>{var o;if(!s.ignoreLLM)try{await((o=s.handleLLMEnd)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,a))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleLLMEnd: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}}class EB extends lm{getChild(e){const t=new Jn(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,i,a){await Promise.all(this.handlers.map(s=>nr(async()=>{var o;if(!s.ignoreChain)try{await((o=s.handleChainError)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,a))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleChainError: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}async handleChainEnd(e,t,r,i,a){await Promise.all(this.handlers.map(s=>nr(async()=>{var o;if(!s.ignoreChain)try{await((o=s.handleChainEnd)==null?void 0:o.call(s,e,this.runId,this._parentRunId,this.tags,a))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleChainEnd: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>nr(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentAction)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentAction: ${i}`),t.raiseError)throw i}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>nr(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleAgentEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleAgentEnd: ${i}`),t.raiseError)throw i}},t.awaitHandlers)))}}class SB extends lm{getChild(e){const t=new Jn(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>nr(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolError)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolError: ${i}`),t.raiseError)throw i}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>nr(async()=>{var r;if(!t.ignoreAgent)try{await((r=t.handleToolEnd)==null?void 0:r.call(t,e,this.runId,this._parentRunId,this.tags))}catch(i){if((t.raiseError?console.error:console.warn)(`Error in handler ${t.constructor.name}, handleToolEnd: ${i}`),t.raiseError)throw i}},t.awaitHandlers)))}}class Jn extends bB{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=(t==null?void 0:t.handlers)??this.handlers,this.inheritableHandlers=(t==null?void 0:t.inheritableHandlers)??this.inheritableHandlers,this.tags=(t==null?void 0:t.tags)??this.tags,this.inheritableTags=(t==null?void 0:t.inheritableTags)??this.inheritableTags,this.metadata=(t==null?void 0:t.metadata)??this.metadata,this.inheritableMetadata=(t==null?void 0:t.inheritableMetadata)??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r=void 0,i=void 0,a=void 0,s=void 0,o=void 0,u=void 0){return Promise.all(t.map(async(c,d)=>{const p=d===0&&r?r:Eo();return await Promise.all(this.handlers.map(m=>{if(!m.ignoreLLM)return pf(m)&&m._createRunForLLMStart(e,[c],p,this._parentRunId,a,this.tags,this.metadata,u),nr(async()=>{var y;try{await((y=m.handleLLMStart)==null?void 0:y.call(m,e,[c],p,this._parentRunId,a,this.tags,this.metadata,u))}catch(b){if((m.raiseError?console.error:console.warn)(`Error in handler ${m.constructor.name}, handleLLMStart: ${b}`),m.raiseError)throw b}},m.awaitHandlers)})),new s1(p,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r=void 0,i=void 0,a=void 0,s=void 0,o=void 0,u=void 0){return Promise.all(t.map(async(c,d)=>{const p=d===0&&r?r:Eo();return await Promise.all(this.handlers.map(m=>{if(!m.ignoreLLM)return pf(m)&&m._createRunForChatModelStart(e,[c],p,this._parentRunId,a,this.tags,this.metadata,u),nr(async()=>{var y,b;try{if(m.handleChatModelStart)await((y=m.handleChatModelStart)==null?void 0:y.call(m,e,[c],p,this._parentRunId,a,this.tags,this.metadata,u));else if(m.handleLLMStart){const w=am(c);await((b=m.handleLLMStart)==null?void 0:b.call(m,e,[w],p,this._parentRunId,a,this.tags,this.metadata,u))}}catch(w){if((m.raiseError?console.error:console.warn)(`Error in handler ${m.constructor.name}, handleLLMStart: ${w}`),m.raiseError)throw w}},m.awaitHandlers)})),new s1(p,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=Eo(),i=void 0,a=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreChain)return pf(u)&&u._createRunForChainStart(e,t,r,this._parentRunId,this.tags,this.metadata,i,o),nr(async()=>{var c;try{await((c=u.handleChainStart)==null?void 0:c.call(u,e,t,r,this._parentRunId,this.tags,this.metadata,i,o))}catch(d){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleChainStart: ${d}`),u.raiseError)throw d}},u.awaitHandlers)})),new EB(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=Eo(),i=void 0,a=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreAgent)return pf(u)&&u._createRunForToolStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),nr(async()=>{var c;try{await((c=u.handleToolStart)==null?void 0:c.call(u,e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(d){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleToolStart: ${d}`),u.raiseError)throw d}},u.awaitHandlers)})),new SB(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=Eo(),i=void 0,a=void 0,s=void 0,o=void 0){return await Promise.all(this.handlers.map(u=>{if(!u.ignoreRetriever)return pf(u)&&u._createRunForRetrieverStart(e,t,r,this._parentRunId,this.tags,this.metadata,o),nr(async()=>{var c;try{await((c=u.handleRetrieverStart)==null?void 0:c.call(u,e,t,r,this._parentRunId,this.tags,this.metadata,o))}catch(d){if((u.raiseError?console.error:console.warn)(`Error in handler ${u.constructor.name}, handleRetrieverStart: ${d}`),u.raiseError)throw d}},u.awaitHandlers)})),new wB(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleCustomEvent(e,t,r,i,a){await Promise.all(this.handlers.map(s=>nr(async()=>{var o;if(!s.ignoreCustomEvent)try{await((o=s.handleCustomEvent)==null?void 0:o.call(s,e,t,r,this.tags,this.metadata))}catch(u){if((s.raiseError?console.error:console.warn)(`Error in handler ${s.constructor.name}, handleCustomEvent: ${u}`),s.raiseError)throw u}},s.awaitHandlers)))}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){this.handlers=[],this.inheritableHandlers=[];for(const r of e)this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(const t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){const r=new Jn(this._parentRunId);for(const i of this.handlers){const a=this.inheritableHandlers.includes(i);r.addHandler(i,a)}for(const i of this.tags){const a=this.inheritableTags.includes(i);r.addTags([i],a)}for(const i of Object.keys(this.metadata)){const a=Object.keys(this.inheritableMetadata).includes(i);r.addMetadata({[i]:this.metadata[i]},a)}for(const i of e)r.handlers.filter(a=>a.name==="console_callback_handler").some(a=>a.name===i.name)||r.addHandler(i,t);return r}static fromHandlers(e){class t extends lc{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:Eo()}),Object.assign(this,e)}}const r=new this;return r.addHandler(new t),r}static configure(e,t,r,i,a,s,o){return this._configureSync(e,t,r,i,a,s,o)}static _configureSync(e,t,r,i,a,s,o){var m,y;let u;(e||t)&&(Array.isArray(e)||!e?(u=new Jn,u.setHandlers((e==null?void 0:e.map(Mp))??[],!0)):u=e,u=u.copy(Array.isArray(t)?t.map(Mp):t==null?void 0:t.handlers,!1));const c=Mi("LANGCHAIN_VERBOSE")==="true"||(o==null?void 0:o.verbose),d=((m=Ol.getTraceableRunTree())==null?void 0:m.tracingEnabled)||RW(),p=d||(Mi("LANGCHAIN_TRACING")??!1);if(c||p){if(u||(u=new Jn),c&&!u.handlers.some(b=>b.name===a1.prototype.name)){const b=new a1;u.addHandler(b,!0)}if(p&&!u.handlers.some(b=>b.name==="langchain_tracer")&&d){const b=new Ol;u.addHandler(b,!0),u._parentRunId=((y=Ol.getTraceableRunTree())==null?void 0:y.id)??u._parentRunId}}for(const{contextVar:b,inheritable:w=!0,handlerClass:S,envVar:T}of PW()){const C=T&&Mi(T)==="true"&&S;let A;const I=b!==void 0?_B(b):void 0;I&&mB(I)?A=I:C&&(A=new S({})),A!==void 0&&(u||(u=new Jn),u.handlers.some(x=>x.name===A.name)||u.addHandler(A,w))}return(r||i)&&u&&(u.addTags(r??[]),u.addTags(i??[],!1)),(a||s)&&u&&(u.addMetadata(a??{}),u.addMetadata(s??{},!1)),u}}function Mp(n){return"name"in n?n:lc.fromMethods(n)}class TB{constructor(e,t){Object.defineProperty(this,"groupName",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"options",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"runManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}async getTraceGroupCallbackManager(e,t,r){const i=new Ol(r),a=await Jn.configure([i]),s=await(a==null?void 0:a.handleChainStart({lc:1,type:"not_implemented",id:["langchain","callbacks","groups",e]},t??{}));if(!s)throw new Error("Failed to create run group callback manager.");return s}async start(e){return this.runManager||(this.runManager=await this.getTraceGroupCallbackManager(this.groupName,e,this.options)),this.runManager.getChild()}async error(e){this.runManager&&(await this.runManager.handleChainError(e),this.runManager=void 0)}async end(e){this.runManager&&(await this.runManager.handleChainEnd(e??{}),this.runManager=void 0)}}function xW(n,e){return n&&!Array.isArray(n)&&typeof n=="object"?n:{[e]:n}}async function OW(n,e,...t){const r=new TB(n.name,n),i=await r.start({...t});try{const a=await e(i,...t);return await r.end(xW(a,"output")),a}catch(a){throw await r.error(a),a}}const NW=Object.freeze(Object.defineProperty({__proto__:null,BaseCallbackManager:bB,BaseRunManager:lm,CallbackManager:Jn,CallbackManagerForChainRun:EB,CallbackManagerForLLMRun:s1,CallbackManagerForRetrieverRun:wB,CallbackManagerForToolRun:SB,TraceGroup:TB,ensureHandler:Mp,parseCallbackConfigArg:om,traceAsGroup:OW},Symbol.toStringTag,{value:"Module"}));class kW{getStore(){}run(e,t){return t()}enterWith(e){}}const MW=new kW,RD=Symbol.for("lc:child_config");class DW{getInstance(){return kp()??MW}getRunnableConfig(){var t,r;return(r=(t=this.getInstance().getStore())==null?void 0:t.extra)==null?void 0:r[RD]}runWithConfig(e,t,r){var d;const i=Jn._configureSync(e==null?void 0:e.callbacks,void 0,e==null?void 0:e.tags,void 0,e==null?void 0:e.metadata),a=this.getInstance(),s=a.getStore(),o=i==null?void 0:i.getParentRunId(),u=(d=i==null?void 0:i.handlers)==null?void 0:d.find(p=>(p==null?void 0:p.name)==="langchain_tracer");let c;return u&&o?c=u.getRunTreeWithTracingConfig(o):r||(c=new Ai({name:"<runnable_lambda>",tracingEnabled:!1})),c&&(c.extra={...c.extra,[RD]:e}),s!==void 0&&s[Ky]!==void 0&&(c===void 0&&(c={}),c[Ky]=s[Ky]),a.run(c,t)}initializeGlobalInstance(e){kp()===void 0&&EW(e)}}const Di=new DW,uS=25;async function $i(n){return Jn._configureSync(n==null?void 0:n.callbacks,void 0,n==null?void 0:n.tags,void 0,n==null?void 0:n.metadata)}function as(...n){const e={};for(const t of n.filter(r=>!!r))for(const r of Object.keys(t))if(r==="metadata")e[r]={...e[r],...t[r]};else if(r==="tags"){const i=e[r]??[];e[r]=[...new Set(i.concat(t[r]??[]))]}else if(r==="configurable")e[r]={...e[r],...t[r]};else if(r==="timeout")e.timeout===void 0?e.timeout=t.timeout:t.timeout!==void 0&&(e.timeout=Math.min(e.timeout,t.timeout));else if(r==="signal")e.signal===void 0?e.signal=t.signal:t.signal!==void 0&&("any"in AbortSignal?e.signal=AbortSignal.any([e.signal,t.signal]):e.signal=t.signal);else if(r==="callbacks"){const i=e.callbacks,a=t.callbacks;if(Array.isArray(a))if(!i)e.callbacks=a;else if(Array.isArray(i))e.callbacks=i.concat(a);else{const s=i.copy();for(const o of a)s.addHandler(Mp(o),!0);e.callbacks=s}else if(a)if(!i)e.callbacks=a;else if(Array.isArray(i)){const s=a.copy();for(const o of i)s.addHandler(Mp(o),!0);e.callbacks=s}else e.callbacks=new Jn(a._parentRunId,{handlers:i.handlers.concat(a.handlers),inheritableHandlers:i.inheritableHandlers.concat(a.inheritableHandlers),tags:Array.from(new Set(i.tags.concat(a.tags))),inheritableTags:Array.from(new Set(i.inheritableTags.concat(a.inheritableTags))),metadata:{...i.metadata,...a.metadata}})}else{const i=r;e[i]=t[i]??e[i]}return e}const $W=new Set(["string","number","boolean"]);function Jt(n){var r;const e=Di.getRunnableConfig();let t={tags:[],metadata:{},recursionLimit:25,runId:void 0};if(e){const{runId:i,runName:a,...s}=e;t=Object.entries(s).reduce((o,[u,c])=>(c!==void 0&&(o[u]=c),o),t)}if(n&&(t=Object.entries(n).reduce((i,[a,s])=>(s!==void 0&&(i[a]=s),i),t)),t!=null&&t.configurable)for(const i of Object.keys(t.configurable))$W.has(typeof t.configurable[i])&&!((r=t.metadata)!=null&&r[i])&&(t.metadata||(t.metadata={}),t.metadata[i]=t.configurable[i]);if(t.timeout!==void 0){if(t.timeout<=0)throw new Error("Timeout must be a positive number");const i=AbortSignal.timeout(t.timeout);t.signal!==void 0?"any"in AbortSignal&&(t.signal=AbortSignal.any([t.signal,i])):t.signal=i,delete t.timeout}return t}function on(n={},{callbacks:e,maxConcurrency:t,recursionLimit:r,runName:i,configurable:a,runId:s}={}){const o=Jt(n);return e!==void 0&&(delete o.runName,o.callbacks=e),r!==void 0&&(o.recursionLimit=r),t!==void 0&&(o.maxConcurrency=t),i!==void 0&&(o.runName=i),a!==void 0&&(o.configurable={...o.configurable,...a}),s!==void 0&&delete o.runId,o}function Lo(n){return n?{configurable:n.configurable,recursionLimit:n.recursionLimit,callbacks:n.callbacks,tags:n.tags,metadata:n.metadata,maxConcurrency:n.maxConcurrency,timeout:n.timeout,signal:n.signal}:void 0}async function $l(n,e){if(e===void 0)return n;let t;return Promise.race([n.catch(r=>{if(!(e!=null&&e.aborted))throw r}),new Promise((r,i)=>{t=()=>{i(new Error("Aborted"))},e.addEventListener("abort",t),e.aborted&&i(new Error("Aborted"))})]).finally(()=>e.removeEventListener("abort",t))}class ti extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{const e=await this.reader.read();return e.done?(this.reader.releaseLock(),{done:!0,value:void 0}):{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){const e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){const t=this.reader.cancel();this.reader.releaseLock(),await t}throw e}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}static fromReadableStream(e){const t=e.getReader();return new ti({start(r){return i();function i(){return t.read().then(({done:a,value:s})=>{if(a){r.close();return}return r.enqueue(s),i()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new ti({async pull(t){const{value:r,done:i}=await e.next();i&&t.close(),t.enqueue(r)},async cancel(t){await e.return(t)}})}}function JR(n,e=2){const t=Array.from({length:e},()=>[]);return t.map(async function*(i){for(;;)if(i.length===0){const a=await n.next();for(const s of t)s.push(a)}else{if(i[0].done)return;yield i.shift().value}})}function fi(n,e){if(Array.isArray(n)&&Array.isArray(e))return n.concat(e);if(typeof n=="string"&&typeof e=="string")return n+e;if(typeof n=="number"&&typeof e=="number")return n+e;if("concat"in n&&typeof n.concat=="function")return n.concat(e);if(typeof n=="object"&&typeof e=="object"){const t={...n};for(const[r,i]of Object.entries(e))r in t&&!Array.isArray(t[r])?t[r]=fi(t[r],i):t[r]=i;return t}else throw new Error(`Cannot concat ${typeof n} and ${typeof e}`)}class uc{constructor(e){var t;Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"signal",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e.generator,this.config=e.config,this.signal=e.signal??((t=this.config)==null?void 0:t.signal),this.setup=new Promise((r,i)=>{Di.runWithConfig(Lo(e.config),async()=>{this.firstResult=e.generator.next(),e.startSetup?this.firstResult.then(e.startSetup).then(r,i):this.firstResult.then(a=>r(void 0),i)},!0)})}async next(...e){var t;return(t=this.signal)==null||t.throwIfAborted(),this.firstResultUsed?Di.runWithConfig(Lo(this.config),this.signal?async()=>$l(this.generator.next(...e),this.signal):async()=>this.generator.next(...e),!0):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}async[Symbol.asyncDispose](){await this.return()}}async function AB(n,e,t,r,...i){const a=new uc({generator:e,startSetup:t,signal:r}),s=await a.setup;return{output:n(a,s,...i),setup:s}}const LW=Object.freeze(Object.defineProperty({__proto__:null,AsyncGeneratorWithSetup:uc,IterableReadableStream:ti,atee:JR,concat:fi,pipeGeneratorWithSetup:AB},Symbol.toStringTag,{value:"Module"}));class So{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){const t=this.ops.concat(e.ops),r=Np({},t);return new ed({ops:t,state:r[r.length-1].newDocument})}}class ed extends So{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){const t=this.ops.concat(e.ops),r=Np(this.state,e.ops);return new ed({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){const t=Np({},e.ops);return new ed({ops:e.ops,state:t[t.length-1].newDocument})}}const CB=n=>n.name==="log_stream_tracer";async function ID(n,e){if(e==="original")throw new Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");const{inputs:t}=n;if(["retriever","llm","prompt"].includes(n.run_type))return t;if(!(Object.keys(t).length===1&&(t==null?void 0:t.input)===""))return t.input}async function PD(n,e){const{outputs:t}=n;return e==="original"||["retriever","llm","prompt"].includes(n.run_type)?t:t!==void 0&&Object.keys(t).length===1&&(t==null?void 0:t.output)!==void 0?t.output:t}function UW(n){return n!==void 0&&n.message!==void 0}class o1 extends Ys{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this._schemaFormat=(e==null?void 0:e._schemaFormat)??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=ti.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;const t=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.run_type)),this.includeTags!==void 0&&(r=r||t.find(i=>{var a;return(a=this.includeTags)==null?void 0:a.includes(i)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.run_type)),this.excludeTags!==void 0&&(r=r&&t.every(i=>{var a;return!((a=this.excludeTags)!=null&&a.includes(i))})),r}async*tapOutputIterable(e,t){for await(const r of t){if(e!==this.rootId){const i=this.keyMapByRunId[e];i&&await this.writer.write(new So({ops:[{op:"add",path:`/logs/${i}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){var i;if(this.rootId===void 0&&(this.rootId=e.id,await this.writer.write(new So({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;this.counterMapByRunName[e.name]===void 0&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;const t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=t===1?e.name:`${e.name}:${t}`;const r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};this._schemaFormat==="streaming_events"&&(r.inputs=await ID(e,this._schemaFormat)),await this.writer.write(new So({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{const t=this.keyMapByRunId[e.id];if(t===void 0)return;const r=[];this._schemaFormat==="streaming_events"&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await ID(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await PD(e,this._schemaFormat)}),e.end_time!==void 0&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});const i=new So({ops:r});await this.writer.write(i)}finally{if(e.id===this.rootId){const t=new So({ops:[{op:"replace",path:"/final_output",value:await PD(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){const i=this.keyMapByRunId[e.id];if(i===void 0)return;const a=e.inputs.messages!==void 0;let s;a?UW(r==null?void 0:r.chunk)?s=r==null?void 0:r.chunk:s=new Sn({id:`run-${e.id}`,content:t}):s=t;const o=new So({ops:[{op:"add",path:`/logs/${i}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${i}/streamed_output/-`,value:s}]});await this.writer.write(o)}}const jW=Object.freeze(Object.defineProperty({__proto__:null,LogStreamCallbackHandler:o1,RunLog:ed,RunLogPatch:So,isLogStreamHandler:CB},Symbol.toStringTag,{value:"Module"})),Dp="__run";class Ll{constructor(e){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=e.text,this.generationInfo=e.generationInfo}concat(e){return new Ll({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo}})}}class ca extends Ll{constructor(e){super(e),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=e.message}concat(e){return new ca({text:this.text+e.text,generationInfo:{...this.generationInfo,...e.generationInfo},message:this.message.concat(e.message)})}}const FW=Object.freeze(Object.defineProperty({__proto__:null,ChatGenerationChunk:ca,GenerationChunk:Ll,RUN_KEY:Dp},Symbol.toStringTag,{value:"Module"}));function ty({name:n,serialized:e}){return n!==void 0?n:(e==null?void 0:e.name)!==void 0?e.name:(e==null?void 0:e.id)!==void 0&&Array.isArray(e==null?void 0:e.id)?e.id[e.id.length-1]:"Unnamed"}const BW=n=>n.name==="event_stream_tracer";class qW extends Ys{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runInfoMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"tappedPromises",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"event_stream_tracer"}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.autoClose=(e==null?void 0:e.autoClose)??!0,this.includeNames=e==null?void 0:e.includeNames,this.includeTypes=e==null?void 0:e.includeTypes,this.includeTags=e==null?void 0:e.includeTags,this.excludeNames=e==null?void 0:e.excludeNames,this.excludeTypes=e==null?void 0:e.excludeTypes,this.excludeTags=e==null?void 0:e.excludeTags,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=ti.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){const t=e.tags??[];let r=this.includeNames===void 0&&this.includeTags===void 0&&this.includeTypes===void 0;return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(e.runType)),this.includeTags!==void 0&&(r=r||t.find(i=>{var a;return(a=this.includeTags)==null?void 0:a.includes(i)})!==void 0),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(e.runType)),this.excludeTags!==void 0&&(r=r&&t.every(i=>{var a;return!((a=this.excludeTags)!=null&&a.includes(i))})),r}async*tapOutputIterable(e,t){const r=await t.next();if(r.done)return;const i=this.runInfoMap.get(e);if(i===void 0){yield r.value;return}function a(o,u){return o==="llm"&&typeof u=="string"?new Ll({text:u}):u}let s=this.tappedPromises.get(e);if(s===void 0){let o;s=new Promise(u=>{o=u}),this.tappedPromises.set(e,s);try{const u={event:`on_${i.runType}_stream`,run_id:e,name:i.name,tags:i.tags,metadata:i.metadata,data:{}};await this.send({...u,data:{chunk:a(i.runType,r.value)}},i),yield r.value;for await(const c of t)i.runType!=="tool"&&i.runType!=="retriever"&&await this.send({...u,data:{chunk:a(i.runType,c)}},i),yield c}finally{o()}}else{yield r.value;for await(const o of t)yield o}}async send(e,t){this._includeRun(t)&&await this.writer.write(e)}async sendEndEvent(e,t){const r=this.tappedPromises.get(e.run_id);r!==void 0?r.then(()=>{this.send(e,t)}):await this.send(e,t)}async onLLMStart(e){var s,o;const t=ty(e),r=e.inputs.messages!==void 0?"chat_model":"llm",i={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:t,runType:r,inputs:e.inputs};this.runInfoMap.set(e.id,i);const a=`on_${r}_start`;await this.send({event:a,data:{input:e.inputs},name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},i)}async onLLMNewToken(e,t,r){const i=this.runInfoMap.get(e.id);let a,s;if(i===void 0)throw new Error(`onLLMNewToken: Run ID ${e.id} not found in run map.`);if(this.runInfoMap.size!==1){if(i.runType==="chat_model")s="on_chat_model_stream",(r==null?void 0:r.chunk)===void 0?a=new Sn({content:t,id:`run-${e.id}`}):a=r.chunk.message;else if(i.runType==="llm")s="on_llm_stream",(r==null?void 0:r.chunk)===void 0?a=new Ll({text:t}):a=r.chunk;else throw new Error(`Unexpected run type ${i.runType}`);await this.send({event:s,data:{chunk:a},run_id:e.id,name:i.name,tags:i.tags,metadata:i.metadata},i)}}async onLLMEnd(e){var s,o,u;const t=this.runInfoMap.get(e.id);this.runInfoMap.delete(e.id);let r;if(t===void 0)throw new Error(`onLLMEnd: Run ID ${e.id} not found in run map.`);const i=(s=e.outputs)==null?void 0:s.generations;let a;if(t.runType==="chat_model"){for(const c of i??[]){if(a!==void 0)break;a=(o=c[0])==null?void 0:o.message}r="on_chat_model_end"}else if(t.runType==="llm")a={generations:i==null?void 0:i.map(c=>c.map(d=>({text:d.text,generationInfo:d.generationInfo}))),llmOutput:((u=e.outputs)==null?void 0:u.llmOutput)??{}},r="on_llm_end";else throw new Error(`onLLMEnd: Unexpected run type: ${t.runType}`);await this.sendEndEvent({event:r,data:{output:a,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onChainStart(e){var s,o;const t=ty(e),r=e.run_type??"chain",i={tags:e.tags??[],metadata:((s=e.extra)==null?void 0:s.metadata)??{},name:t,runType:e.run_type};let a={};e.inputs.input===""&&Object.keys(e.inputs).length===1?(a={},i.inputs={}):e.inputs.input!==void 0?(a.input=e.inputs.input,i.inputs=e.inputs.input):(a.input=e.inputs,i.inputs=e.inputs),this.runInfoMap.set(e.id,i),await this.send({event:`on_${r}_start`,data:a,name:t,tags:e.tags??[],run_id:e.id,metadata:((o=e.extra)==null?void 0:o.metadata)??{}},i)}async onChainEnd(e){var o;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onChainEnd: Run ID ${e.id} not found in run map.`);const r=`on_${e.run_type}_end`,i=e.inputs??t.inputs??{},s={output:((o=e.outputs)==null?void 0:o.output)??e.outputs,input:i};i.input&&Object.keys(i).length===1&&(s.input=i.input,t.inputs=i.input),await this.sendEndEvent({event:r,data:s,run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata??{}},t)}async onToolStart(e){var i,a;const t=ty(e),r={tags:e.tags??[],metadata:((i=e.extra)==null?void 0:i.metadata)??{},name:t,runType:"tool",inputs:e.inputs??{}};this.runInfoMap.set(e.id,r),await this.send({event:"on_tool_start",data:{input:e.inputs??{}},name:t,run_id:e.id,tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{}},r)}async onToolEnd(e){var i;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onToolEnd: Run ID ${e.id} not found in run map.`);if(t.inputs===void 0)throw new Error(`onToolEnd: Run ID ${e.id} is a tool call, and is expected to have traced inputs.`);const r=((i=e.outputs)==null?void 0:i.output)===void 0?e.outputs:e.outputs.output;await this.sendEndEvent({event:"on_tool_end",data:{output:r,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async onRetrieverStart(e){var a,s;const t=ty(e),i={tags:e.tags??[],metadata:((a=e.extra)==null?void 0:a.metadata)??{},name:t,runType:"retriever",inputs:{query:e.inputs.query}};this.runInfoMap.set(e.id,i),await this.send({event:"on_retriever_start",data:{input:{query:e.inputs.query}},name:t,tags:e.tags??[],run_id:e.id,metadata:((s=e.extra)==null?void 0:s.metadata)??{}},i)}async onRetrieverEnd(e){var r;const t=this.runInfoMap.get(e.id);if(this.runInfoMap.delete(e.id),t===void 0)throw new Error(`onRetrieverEnd: Run ID ${e.id} not found in run map.`);await this.sendEndEvent({event:"on_retriever_end",data:{output:((r=e.outputs)==null?void 0:r.documents)??e.outputs,input:t.inputs},run_id:e.id,name:t.name,tags:t.tags,metadata:t.metadata},t)}async handleCustomEvent(e,t,r){const i=this.runInfoMap.get(r);if(i===void 0)throw new Error(`handleCustomEvent: Run ID ${r} not found in run map.`);await this.send({event:"on_custom_event",run_id:r,name:e,tags:i.tags,metadata:i.metadata,data:t},i)}async finish(){const e=[...this.tappedPromises.values()];Promise.all(e).finally(()=>{this.writer.close()})}}const VW=[400,401,402,403,404,405,406,407,409],zW=n=>{var t,r;if(n.message.startsWith("Cancel")||n.message.startsWith("AbortError")||n.name==="AbortError"||(n==null?void 0:n.code)==="ECONNABORTED")throw n;const e=((t=n==null?void 0:n.response)==null?void 0:t.status)??(n==null?void 0:n.status);if(e&&VW.includes(+e))throw n;if(((r=n==null?void 0:n.error)==null?void 0:r.code)==="insufficient_quota"){const i=new Error(n==null?void 0:n.message);throw i.name="InsufficientQuotaError",i}};class um{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??zW;const t="default"in Po?Po.default:Po;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>Fv(()=>e(...t).catch(r=>{throw r instanceof Error?r:new Error(r)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((i,a)=>{var s;(s=e.signal)==null||s.addEventListener("abort",()=>{a(new Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(t=>t.ok?t:Promise.reject(t)))}}const HW=Object.freeze(Object.defineProperty({__proto__:null,AsyncCaller:um},Symbol.toStringTag,{value:"Module"}));class RB extends Ys{constructor({config:e,onStart:t,onEnd:r,onError:i}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=i}persistRun(e){return Promise.resolve()}async onRunCreate(e){this.rootId||(this.rootId=e.id,this.argOnStart&&await this.argOnStart(e,this.config))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&await this.argOnError(e,this.config):this.argOnEnd&&await this.argOnEnd(e,this.config))}}function YR(n){return n?n.lc_runnable:!1}class GW{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=this.includeNames===void 0&&this.includeTypes===void 0&&this.includeTags===void 0;const i=e.tags??[];return this.includeNames!==void 0&&(r=r||this.includeNames.includes(e.name)),this.includeTypes!==void 0&&(r=r||this.includeTypes.includes(t)),this.includeTags!==void 0&&(r=r||i.some(a=>{var s;return(s=this.includeTags)==null?void 0:s.includes(a)})),this.excludeNames!==void 0&&(r=r&&!this.excludeNames.includes(e.name)),this.excludeTypes!==void 0&&(r=r&&!this.excludeTypes.includes(t)),this.excludeTags!==void 0&&(r=r&&i.every(a=>{var s;return!((s=this.excludeTags)!=null&&s.includes(a))})),r}}function cS(n){return n.replace(/[^a-zA-Z-_0-9]/g,"_")}const WW=["*","_","`"];function KW(n){let e="";for(const[t,r]of Object.entries(n))e+=`	classDef ${t} ${r};
`;return e}function JW(n,e,t){const{firstNode:r,lastNode:i,nodeColors:a,withStyles:s=!0,curveStyle:o="linear",wrapLabelNWords:u=9}=t??{};let c=s?`%%{init: {'flowchart': {'curve': '${o}'}}}%%
graph TD;
`:`graph TD;
`;if(s){const y="default",b={[y]:"{0}({1})"};r!==void 0&&(b[r]="{0}([{1}]):::first"),i!==void 0&&(b[i]="{0}([{1}]):::last");for(const[w,S]of Object.entries(n)){const T=S.name.split(":").pop()??"";let A=WW.some(x=>T.startsWith(x)&&T.endsWith(x))?`<p>${T}</p>`:T;Object.keys(S.metadata??{}).length&&(A+=`<hr/><small><em>${Object.entries(S.metadata??{}).map(([x,L])=>`${x} = ${L}`).join(`
`)}</em></small>`);const I=(b[w]??b[y]).replace("{0}",cS(w)).replace("{1}",A);c+=`	${I}
`}}const d={};for(const y of e){const b=y.source.split(":"),w=y.target.split(":"),S=b.filter((T,C)=>T===w[C]).join(":");d[S]||(d[S]=[]),d[S].push(y)}const p=new Set;function m(y,b){const w=y.length===1&&y[0].source===y[0].target;if(b&&!w){const S=b.split(":").pop();if(p.has(S))throw new Error(`Found duplicate subgraph '${S}' -- this likely means that you're reusing a subgraph node with the same name. Please adjust your graph to have subgraph nodes with unique names.`);p.add(S),c+=`	subgraph ${S}
`}for(const S of y){const{source:T,target:C,data:A,conditional:I}=S;let x="";if(A!==void 0){let L=A;const U=L.split(" ");U.length>u&&(L=Array.from({length:Math.ceil(U.length/u)},(N,B)=>U.slice(B*u,(B+1)*u).join(" ")).join("&nbsp;<br>&nbsp;")),x=I?` -. &nbsp;${L}&nbsp; .-> `:` -- &nbsp;${L}&nbsp; --> `}else x=I?" -.-> ":" --> ";c+=`	${cS(T)}${x}${cS(C)};
`}for(const S in d)S.startsWith(`${b}:`)&&S!==b&&m(d[S],S);b&&!w&&(c+=`	end
`)}m(d[""]??[],"");for(const y in d)!y.includes(":")&&y!==""&&m(d[y],y);return s&&(c+=KW(a??{})),c}async function YW(n,e){let{backgroundColor:t="white"}=e??{};const r=btoa(n);t!==void 0&&(/^#(?:[0-9a-fA-F]{3}){1,2}$/.test(t)||(t=`!${t}`));const i=`https://mermaid.ink/img/${r}?bgColor=${t}`,a=await fetch(i);if(!a.ok)throw new Error(["Failed to render the graph using the Mermaid.INK API.",`Status code: ${a.status}`,`Status text: ${a.statusText}`].join(`
`));return await a.blob()}function hd(n,e,t){function r(o,u){var c;Object.defineProperty(o,"_zod",{value:o._zod??{},enumerable:!1}),(c=o._zod).traits??(c.traits=new Set),o._zod.traits.add(n),e(o,u);for(const d in s.prototype)d in o||Object.defineProperty(o,d,{value:s.prototype[d].bind(o)});o._zod.constr=s,o._zod.def=u}const i=(t==null?void 0:t.Parent)??Object;class a extends i{}Object.defineProperty(a,"name",{value:n});function s(o){var u;const c=t!=null&&t.Parent?new a:this;r(c,o),(u=c._zod).deferred??(u.deferred=[]);for(const d of c._zod.deferred)d();return c}return Object.defineProperty(s,"init",{value:r}),Object.defineProperty(s,Symbol.hasInstance,{value:o=>{var u,c;return t!=null&&t.Parent&&o instanceof t.Parent?!0:(c=(u=o==null?void 0:o._zod)==null?void 0:u.traits)==null?void 0:c.has(n)}}),Object.defineProperty(s,"name",{value:n}),s}class zv extends Error{constructor(){super("Encountered Promise during synchronous parse. Use .parseAsync() instead.")}}const ZW={};function q_(n){return ZW}function XW(n){const e=Object.values(n).filter(r=>typeof r=="number");return Object.entries(n).filter(([r,i])=>e.indexOf(+r)===-1).map(([r,i])=>i)}function QW(n,e){return typeof e=="bigint"?e.toString():e}function eK(n){const e=n.startsWith("^")?1:0,t=n.endsWith("$")?n.length-1:n.length;return n.slice(e,t)}function l1(n,e,t){Object.defineProperty(n,e,{get(){{const r=t();return n[e]=r,r}},set(r){Object.defineProperty(n,e,{value:r})},configurable:!0})}function tK(n,e,t){Object.defineProperty(n,e,{value:t,writable:!0,enumerable:!0,configurable:!0})}function nK(n=10){const e="abcdefghijklmnopqrstuvwxyz";let t="";for(let r=0;r<n;r++)t+=e[Math.floor(Math.random()*e.length)];return t}const IB=Error.captureStackTrace?Error.captureStackTrace:(...n)=>{};function Ul(n,e,t){const r=new n._zod.constr(e??n._zod.def);return(!e||t!=null&&t.parent)&&(r._zod.parent=n),r}function rK(n){return{}}function iK(n,e){const t={...n._zod.def,get shape(){const r={...n._zod.def.shape,...e};return tK(this,"shape",r),r},checks:[]};return Ul(n,t)}function aK(n,e,t){const r=e._zod.def.shape,i={...r};for(const a in r)i[a]=n?new n({type:"optional",innerType:r[a]}):r[a];return Ul(e,{...e._zod.def,shape:i,checks:[]})}function fS(n,e=0){for(let t=e;t<n.issues.length;t++)if(n.issues[t].continue!==!0)return!0;return!1}function ny(n){return typeof n=="string"?n:n==null?void 0:n.message}function V_(n,e,t){var i,a,s,o,u,c;const r={...n,path:n.path??[]};if(!n.message){const d=ny((s=(a=(i=n.inst)==null?void 0:i._zod.def)==null?void 0:a.error)==null?void 0:s.call(a,n))??ny((o=e==null?void 0:e.error)==null?void 0:o.call(e,n))??ny((u=t.customError)==null?void 0:u.call(t,n))??ny((c=t.localeError)==null?void 0:c.call(t,n))??"Invalid input";r.message=d}return delete r.inst,delete r.continue,e!=null&&e.reportInput||delete r.input,r}const PB=(n,e)=>{n.name="$ZodError",Object.defineProperty(n,"_zod",{value:n._zod,enumerable:!1}),Object.defineProperty(n,"issues",{value:e,enumerable:!1}),Object.defineProperty(n,"message",{get(){return JSON.stringify(e,QW,2)},enumerable:!0})},sK=hd("$ZodError",PB),z_=hd("$ZodError",PB,{Parent:Error}),oK=n=>(e,t,r,i)=>{const a=r?Object.assign(r,{async:!1}):{async:!1},s=e._zod.run({value:t,issues:[]},a);if(s instanceof Promise)throw new zv;if(s.issues.length){const o=new((i==null?void 0:i.Err)??n)(s.issues.map(u=>V_(u,a,q_())));throw IB(o,i==null?void 0:i.callee),o}return s.value},cm=oK(z_),lK=n=>async(e,t,r,i)=>{const a=r?Object.assign(r,{async:!0}):{async:!0};let s=e._zod.run({value:t,issues:[]},a);if(s instanceof Promise&&(s=await s),s.issues.length){const o=new((i==null?void 0:i.Err)??n)(s.issues.map(u=>V_(u,a,q_())));throw IB(o,i==null?void 0:i.callee),o}return s.value},uK=lK(z_),cK=n=>(e,t,r)=>{const i=r?{...r,async:!1}:{async:!1},a=e._zod.run({value:t,issues:[]},i);if(a instanceof Promise)throw new zv;return a.issues.length?{success:!1,error:new(n??sK)(a.issues.map(s=>V_(s,i,q_())))}:{success:!0,data:a.value}},fK=cK(z_),dK=n=>async(e,t,r)=>{const i=r?Object.assign(r,{async:!0}):{async:!0};let a=e._zod.run({value:t,issues:[]},i);return a instanceof Promise&&(a=await a),a.issues.length?{success:!1,error:new n(a.issues.map(s=>V_(s,i,q_())))}:{success:!0,data:a.value}},hK=dK(z_),pK={major:4,minor:0,patch:0},ZR=hd("$ZodType",(n,e)=>{var i;var t;n??(n={}),l1(n._zod,"id",()=>e.type+"_"+nK(10)),n._zod.def=e,n._zod.bag=n._zod.bag||{},n._zod.version=pK;const r=[...n._zod.def.checks??[]];n._zod.traits.has("$ZodCheck")&&r.unshift(n);for(const a of r)for(const s of a._zod.onattach)s(n);if(r.length===0)(t=n._zod).deferred??(t.deferred=[]),(i=n._zod.deferred)==null||i.push(()=>{n._zod.run=n._zod.parse});else{const a=(s,o,u)=>{let c=fS(s),d;for(const p of o){if(p._zod.when){if(!p._zod.when(s))continue}else if(c)continue;const m=s.issues.length,y=p._zod.check(s);if(y instanceof Promise&&(u==null?void 0:u.async)===!1)throw new zv;if(d||y instanceof Promise)d=(d??Promise.resolve()).then(async()=>{await y,s.issues.length!==m&&(c||(c=fS(s,m)))});else{if(s.issues.length===m)continue;c||(c=fS(s,m))}}return d?d.then(()=>s):s};n._zod.run=(s,o)=>{const u=n._zod.parse(s,o);if(u instanceof Promise){if(o.async===!1)throw new zv;return u.then(c=>a(c,r,o))}return a(u,r,o)}}n["~standard"]={validate:a=>{var s;try{const o=fK(n,a);return o.success?{value:o.data}:{issues:(s=o.error)==null?void 0:s.issues}}catch{return hK(n,a).then(u=>{var c;return u.success?{value:u.data}:{issues:(c=u.error)==null?void 0:c.issues}})}},vendor:"zod",version:1}}),mK=hd("$ZodUnknown",(n,e)=>{ZR.init(n,e),n._zod.parse=t=>t}),gK=hd("$ZodNever",(n,e)=>{ZR.init(n,e),n._zod.parse=(t,r)=>(t.issues.push({expected:"never",code:"invalid_type",input:t.value,inst:n}),t)}),yK=hd("$ZodOptional",(n,e)=>{ZR.init(n,e),n._zod.optin="optional",n._zod.optout="optional",l1(n._zod,"values",()=>e.innerType._zod.values?new Set([...e.innerType._zod.values,void 0]):void 0),l1(n._zod,"pattern",()=>{const t=e.innerType._zod.pattern;return t?new RegExp(`^(${eK(t.source)})?$`):void 0}),n._zod.parse=(t,r)=>t.value===void 0?t:e.innerType._zod.run(t,r)});class xB{constructor(){this._map=new WeakMap,this._idmap=new Map}add(e,...t){const r=t[0];if(this._map.set(e,r),r&&typeof r=="object"&&"id"in r){if(this._idmap.has(r.id))throw new Error(`ID ${r.id} already exists in the registry`);this._idmap.set(r.id,e)}return this}remove(e){return this._map.delete(e),this}get(e){const t=e._zod.parent;if(t){const r={...this.get(t)??{}};return delete r.id,{...r,...this._map.get(e)}}return this._map.get(e)}has(e){return this._map.has(e)}}function vK(){return new xB}const xa=vK();function _K(n){return new n({type:"unknown"})}function bK(n,e){return new n({type:"never",...rK()})}class xD{constructor(e){this.counter=0,this.metadataRegistry=(e==null?void 0:e.metadata)??xa,this.target=(e==null?void 0:e.target)??"draft-2020-12",this.unrepresentable=(e==null?void 0:e.unrepresentable)??"throw",this.override=(e==null?void 0:e.override)??(()=>{}),this.io=(e==null?void 0:e.io)??"output",this.seen=new Map}process(e,t={path:[],schemaPath:[]}){var p,m,y;var r;const i=e._zod.def,a={guid:"uuid",url:"uri",datetime:"date-time",json_string:"json-string",regex:""},s=this.seen.get(e);if(s)return s.count++,t.schemaPath.includes(e)&&(s.cycle=t.path),s.schema;const o={schema:{},count:1,cycle:void 0};this.seen.set(e,o);const u=(m=(p=e._zod).toJSONSchema)==null?void 0:m.call(p);if(u)o.schema=u;else{const b={...t,schemaPath:[...t.schemaPath,e],path:t.path},w=e._zod.parent;if(w)o.ref=w,this.process(w,b),this.seen.get(w).isParent=!0;else{const S=o.schema;switch(i.type){case"string":{const T=S;T.type="string";const{minimum:C,maximum:A,format:I,patterns:x,contentEncoding:L}=e._zod.bag;if(typeof C=="number"&&(T.minLength=C),typeof A=="number"&&(T.maxLength=A),I&&(T.format=a[I]??I,T.format===""&&delete T.format),L&&(T.contentEncoding=L),x&&x.size>0){const U=[...x];U.length===1?T.pattern=U[0].source:U.length>1&&(o.schema.allOf=[...U.map(N=>({...this.target==="draft-7"?{type:"string"}:{},pattern:N.source}))])}break}case"number":{const T=S,{minimum:C,maximum:A,format:I,multipleOf:x,exclusiveMaximum:L,exclusiveMinimum:U}=e._zod.bag;typeof I=="string"&&I.includes("int")?T.type="integer":T.type="number",typeof U=="number"&&(T.exclusiveMinimum=U),typeof C=="number"&&(T.minimum=C,typeof U=="number"&&(U>=C?delete T.minimum:delete T.exclusiveMinimum)),typeof L=="number"&&(T.exclusiveMaximum=L),typeof A=="number"&&(T.maximum=A,typeof L=="number"&&(L<=A?delete T.maximum:delete T.exclusiveMaximum)),typeof x=="number"&&(T.multipleOf=x);break}case"boolean":{const T=S;T.type="boolean";break}case"bigint":{if(this.unrepresentable==="throw")throw new Error("BigInt cannot be represented in JSON Schema");break}case"symbol":{if(this.unrepresentable==="throw")throw new Error("Symbols cannot be represented in JSON Schema");break}case"undefined":{const T=S;T.type="null";break}case"null":{S.type="null";break}case"any":break;case"unknown":break;case"never":{S.not={};break}case"void":{if(this.unrepresentable==="throw")throw new Error("Void cannot be represented in JSON Schema");break}case"date":{if(this.unrepresentable==="throw")throw new Error("Date cannot be represented in JSON Schema");break}case"array":{const T=S,{minimum:C,maximum:A}=e._zod.bag;typeof C=="number"&&(T.minItems=C),typeof A=="number"&&(T.maxItems=A),T.type="array",T.items=this.process(i.element,{...b,path:[...b.path,"items"]});break}case"object":{const T=S;T.type="object",T.properties={};const C=i.shape;for(const x in C)T.properties[x]=this.process(C[x],{...b,path:[...b.path,"properties",x]});const A=new Set(Object.keys(C)),I=new Set([...A].filter(x=>{const L=i.shape[x]._zod;return this.io==="input"?L.optin===void 0:L.optout===void 0}));I.size>0&&(T.required=Array.from(I)),((y=i.catchall)==null?void 0:y._zod.def.type)==="never"?T.additionalProperties=!1:i.catchall?i.catchall&&(T.additionalProperties=this.process(i.catchall,{...b,path:[...b.path,"additionalProperties"]})):this.io==="output"&&(T.additionalProperties=!1);break}case"union":{const T=S;T.anyOf=i.options.map((C,A)=>this.process(C,{...b,path:[...b.path,"anyOf",A]}));break}case"intersection":{const T=S,C=this.process(i.left,{...b,path:[...b.path,"allOf",0]}),A=this.process(i.right,{...b,path:[...b.path,"allOf",1]}),I=L=>"allOf"in L&&Object.keys(L).length===1,x=[...I(C)?C.allOf:[C],...I(A)?A.allOf:[A]];T.allOf=x;break}case"tuple":{const T=S;T.type="array";const C=i.items.map((x,L)=>this.process(x,{...b,path:[...b.path,"prefixItems",L]}));if(this.target==="draft-2020-12"?T.prefixItems=C:T.items=C,i.rest){const x=this.process(i.rest,{...b,path:[...b.path,"items"]});this.target==="draft-2020-12"?T.items=x:T.additionalItems=x}i.rest&&(T.items=this.process(i.rest,{...b,path:[...b.path,"items"]}));const{minimum:A,maximum:I}=e._zod.bag;typeof A=="number"&&(T.minItems=A),typeof I=="number"&&(T.maxItems=I);break}case"record":{const T=S;T.type="object",T.propertyNames=this.process(i.keyType,{...b,path:[...b.path,"propertyNames"]}),T.additionalProperties=this.process(i.valueType,{...b,path:[...b.path,"additionalProperties"]});break}case"map":{if(this.unrepresentable==="throw")throw new Error("Map cannot be represented in JSON Schema");break}case"set":{if(this.unrepresentable==="throw")throw new Error("Set cannot be represented in JSON Schema");break}case"enum":{const T=S,C=XW(i.entries);C.every(A=>typeof A=="number")&&(T.type="number"),C.every(A=>typeof A=="string")&&(T.type="string"),T.enum=C;break}case"literal":{const T=S,C=[];for(const A of i.values)if(A===void 0){if(this.unrepresentable==="throw")throw new Error("Literal `undefined` cannot be represented in JSON Schema")}else if(typeof A=="bigint"){if(this.unrepresentable==="throw")throw new Error("BigInt literals cannot be represented in JSON Schema");C.push(Number(A))}else C.push(A);if(C.length!==0)if(C.length===1){const A=C[0];T.type=A===null?"null":typeof A,T.const=A}else C.every(A=>typeof A=="number")&&(T.type="number"),C.every(A=>typeof A=="string")&&(T.type="string"),C.every(A=>typeof A=="boolean")&&(T.type="string"),C.every(A=>A===null)&&(T.type="null"),T.enum=C;break}case"file":{const T=S,C={type:"string",format:"binary",contentEncoding:"binary"},{minimum:A,maximum:I,mime:x}=e._zod.bag;A!==void 0&&(C.minLength=A),I!==void 0&&(C.maxLength=I),x?x.length===1?(C.contentMediaType=x[0],Object.assign(T,C)):T.anyOf=x.map(L=>({...C,contentMediaType:L})):Object.assign(T,C);break}case"transform":{if(this.unrepresentable==="throw")throw new Error("Transforms cannot be represented in JSON Schema");break}case"nullable":{const T=this.process(i.innerType,b);S.anyOf=[T,{type:"null"}];break}case"nonoptional":{this.process(i.innerType,b),o.ref=i.innerType;break}case"success":{const T=S;T.type="boolean";break}case"default":{this.process(i.innerType,b),o.ref=i.innerType,S.default=JSON.parse(JSON.stringify(i.defaultValue));break}case"prefault":{this.process(i.innerType,b),o.ref=i.innerType,this.io==="input"&&(S._prefault=JSON.parse(JSON.stringify(i.defaultValue)));break}case"catch":{this.process(i.innerType,b),o.ref=i.innerType;let T;try{T=i.catchValue(void 0)}catch{throw new Error("Dynamic catch values are not supported in JSON Schema")}S.default=T;break}case"nan":{if(this.unrepresentable==="throw")throw new Error("NaN cannot be represented in JSON Schema");break}case"template_literal":{const T=S,C=e._zod.pattern;if(!C)throw new Error("Pattern not found in template literal");T.type="string",T.pattern=C.source;break}case"pipe":{const T=this.io==="input"?i.in._zod.def.type==="transform"?i.out:i.in:i.out;this.process(T,b),o.ref=T;break}case"readonly":{this.process(i.innerType,b),o.ref=i.innerType,S.readOnly=!0;break}case"promise":{this.process(i.innerType,b),o.ref=i.innerType;break}case"optional":{this.process(i.innerType,b),o.ref=i.innerType;break}case"lazy":{const T=e._zod.innerType;this.process(T,b),o.ref=T;break}case"custom":{if(this.unrepresentable==="throw")throw new Error("Custom types cannot be represented in JSON Schema");break}}}}const c=this.metadataRegistry.get(e);return c&&Object.assign(o.schema,c),this.io==="input"&&dr(e)&&(delete o.schema.examples,delete o.schema.default),this.io==="input"&&o.schema._prefault&&((r=o.schema).default??(r.default=o.schema._prefault)),delete o.schema._prefault,this.seen.get(e).schema}emit(e,t){var d,p,m,y;const r={cycles:(t==null?void 0:t.cycles)??"ref",reused:(t==null?void 0:t.reused)??"inline",external:(t==null?void 0:t.external)??void 0},i=this.seen.get(e);if(!i)throw new Error("Unprocessed schema. This is a bug in Zod.");const a=b=>{var A;const w=this.target==="draft-2020-12"?"$defs":"definitions";if(r.external){const I=(A=r.external.registry.get(b[0]))==null?void 0:A.id;if(I)return{ref:r.external.uri(I)};const x=b[1].defId??b[1].schema.id??`schema${this.counter++}`;return b[1].defId=x,{defId:x,ref:`${r.external.uri("__shared")}#/${w}/${x}`}}if(b[1]===i)return{ref:"#"};const T=`#/${w}/`,C=b[1].schema.id??`__schema${this.counter++}`;return{defId:C,ref:T+C}},s=b=>{if(b[1].schema.$ref)return;const w=b[1],{ref:S,defId:T}=a(b);w.def={...w.schema},T&&(w.defId=T);const C=w.schema;for(const A in C)delete C[A];C.$ref=S};for(const b of this.seen.entries()){const w=b[1];if(e===b[0]){s(b);continue}if(r.external){const T=(d=r.external.registry.get(b[0]))==null?void 0:d.id;if(e!==b[0]&&T){s(b);continue}}if((p=this.metadataRegistry.get(b[0]))==null?void 0:p.id){s(b);continue}if(w.cycle){if(r.cycles==="throw")throw new Error(`Cycle detected: #/${(m=w.cycle)==null?void 0:m.join("/")}/<root>

Set the \`cycles\` parameter to \`"ref"\` to resolve cyclical schemas with defs.`);r.cycles==="ref"&&s(b);continue}if(w.count>1&&r.reused==="ref"){s(b);continue}}const o=(b,w)=>{const S=this.seen.get(b),T=S.def??S.schema,C={...T};if(S.ref===null)return;const A=S.ref;if(S.ref=null,A){o(A,w);const I=this.seen.get(A).schema;I.$ref&&w.target==="draft-7"?(T.allOf=T.allOf??[],T.allOf.push(I)):(Object.assign(T,I),Object.assign(T,C))}S.isParent||this.override({zodSchema:b,jsonSchema:T})};for(const b of[...this.seen.entries()].reverse())o(b[0],{target:this.target});const u={};this.target==="draft-2020-12"?u.$schema="https://json-schema.org/draft/2020-12/schema":this.target==="draft-7"?u.$schema="http://json-schema.org/draft-07/schema#":console.warn(`Invalid target: ${this.target}`),Object.assign(u,i.def);const c=((y=r.external)==null?void 0:y.defs)??{};for(const b of this.seen.entries()){const w=b[1];w.def&&w.defId&&(c[w.defId]=w.def)}!r.external&&Object.keys(c).length>0&&(this.target==="draft-2020-12"?u.$defs=c:u.definitions=c);try{return JSON.parse(JSON.stringify(u))}catch{throw new Error("Error converting schema to JSON.")}}}function u1(n,e){if(n instanceof xB){const r=new xD(e),i={};for(const o of n._idmap.entries()){const[u,c]=o;r.process(c)}const a={},s={registry:n,uri:(e==null?void 0:e.uri)||(o=>o),defs:i};for(const o of n._idmap.entries()){const[u,c]=o;a[u]=r.emit(c,{...e,external:s})}if(Object.keys(i).length>0){const o=r.target==="draft-2020-12"?"$defs":"definitions";a.__shared={[o]:i}}return{schemas:a}}const t=new xD(e);return t.process(n),t.emit(n,e)}function dr(n,e){const t=e??{seen:new Set};if(t.seen.has(n))return!1;t.seen.add(n);const i=n._zod.def;switch(i.type){case"string":case"number":case"bigint":case"boolean":case"date":case"symbol":case"undefined":case"null":case"any":case"unknown":case"never":case"void":case"literal":case"enum":case"nan":case"file":case"template_literal":return!1;case"array":return dr(i.element,t);case"object":{for(const a in i.shape)if(dr(i.shape[a],t))return!0;return!1}case"union":{for(const a of i.options)if(dr(a,t))return!0;return!1}case"intersection":return dr(i.left,t)||dr(i.right,t);case"tuple":{for(const a of i.items)if(dr(a,t))return!0;return!!(i.rest&&dr(i.rest,t))}case"record":return dr(i.keyType,t)||dr(i.valueType,t);case"map":return dr(i.keyType,t)||dr(i.valueType,t);case"set":return dr(i.valueType,t);case"promise":case"optional":case"nonoptional":case"nullable":case"readonly":return dr(i.innerType,t);case"lazy":return dr(i.getter(),t);case"default":return dr(i.innerType,t);case"prefault":return dr(i.innerType,t);case"custom":return!1;case"transform":return!0;case"pipe":return dr(i.in,t)||dr(i.out,t);case"success":return!1;case"catch":return!1}throw new Error(`Unknown schema type: ${i.type}`)}const wK=Symbol("Let zodToJsonSchema decide on which parser to use"),EK={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref",openAiAnyTypeName:"OpenAiAnyType"},SK=n=>({...EK,...n}),TK=n=>{const e=SK(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,flags:{hasReferencedOpenAiAnyType:!1},currentPath:t,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,i])=>[i._def,{def:i._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function OB(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function hn(n,e,t,r,i){n[e]=t,OB(n,e,r,i)}const NB=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")};function fa(n){if(n.target!=="openAi")return{};const e=[...n.basePath,n.definitionPath,n.openAiAnyTypeName];return n.flags.hasReferencedOpenAiAnyType=!0,{$ref:n.$refStrategy==="relative"?NB(e,n.currentPath):e.join("/")}}function AK(n,e){var r,i,a;const t={type:"array"};return(r=n.type)!=null&&r._def&&((a=(i=n.type)==null?void 0:i._def)==null?void 0:a.typeName)!==De.ZodAny&&(t.items=ln(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&hn(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&hn(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(hn(t,"minItems",n.exactLength.value,n.exactLength.message,e),hn(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function CK(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?hn(t,"minimum",r.value,r.message,e):hn(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),hn(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?hn(t,"maximum",r.value,r.message,e):hn(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),hn(t,"maximum",r.value,r.message,e));break;case"multipleOf":hn(t,"multipleOf",r.value,r.message,e);break}return t}function RK(){return{type:"boolean"}}function kB(n,e){return ln(n.type._def,e)}const IK=(n,e)=>ln(n.innerType._def,e);function MB(n,e,t){const r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((i,a)=>MB(n,e,i))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return PK(n,e)}}const PK=(n,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const r of n.checks)switch(r.kind){case"min":hn(t,"minimum",r.value,r.message,e);break;case"max":hn(t,"maximum",r.value,r.message,e);break}return t};function xK(n,e){return{...ln(n.innerType._def,e),default:n.defaultValue()}}function OK(n,e){return e.effectStrategy==="input"?ln(n.schema._def,e):fa(e)}function NK(n){return{type:"string",enum:Array.from(n.values)}}const kK=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function MK(n,e){const t=[ln(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),ln(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const i=[];return t.forEach(a=>{if(kK(a))i.push(...a.allOf),a.unevaluatedProperties===void 0&&(r=void 0);else{let s=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...u}=a;s=u}else r=void 0;i.push(s)}}),i.length?{allOf:i,...r}:void 0}function DK(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}let dS;const Ga={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(dS===void 0&&(dS=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),dS),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function DB(n,e){const t={type:"string"};if(n.checks)for(const r of n.checks)switch(r.kind){case"min":hn(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e);break;case"max":hn(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Wa(t,"email",r.message,e);break;case"format:idn-email":Wa(t,"idn-email",r.message,e);break;case"pattern:zod":oi(t,Ga.email,r.message,e);break}break;case"url":Wa(t,"uri",r.message,e);break;case"uuid":Wa(t,"uuid",r.message,e);break;case"regex":oi(t,r.regex,r.message,e);break;case"cuid":oi(t,Ga.cuid,r.message,e);break;case"cuid2":oi(t,Ga.cuid2,r.message,e);break;case"startsWith":oi(t,RegExp(`^${hS(r.value,e)}`),r.message,e);break;case"endsWith":oi(t,RegExp(`${hS(r.value,e)}$`),r.message,e);break;case"datetime":Wa(t,"date-time",r.message,e);break;case"date":Wa(t,"date",r.message,e);break;case"time":Wa(t,"time",r.message,e);break;case"duration":Wa(t,"duration",r.message,e);break;case"length":hn(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,r.value):r.value,r.message,e),hn(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,r.value):r.value,r.message,e);break;case"includes":{oi(t,RegExp(hS(r.value,e)),r.message,e);break}case"ip":{r.version!=="v6"&&Wa(t,"ipv4",r.message,e),r.version!=="v4"&&Wa(t,"ipv6",r.message,e);break}case"base64url":oi(t,Ga.base64url,r.message,e);break;case"jwt":oi(t,Ga.jwt,r.message,e);break;case"cidr":{r.version!=="v6"&&oi(t,Ga.ipv4Cidr,r.message,e),r.version!=="v4"&&oi(t,Ga.ipv6Cidr,r.message,e);break}case"emoji":oi(t,Ga.emoji(),r.message,e);break;case"ulid":{oi(t,Ga.ulid,r.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Wa(t,"binary",r.message,e);break}case"contentEncoding:base64":{hn(t,"contentEncoding","base64",r.message,e);break}case"pattern:zod":{oi(t,Ga.base64,r.message,e);break}}break}case"nanoid":oi(t,Ga.nanoid,r.message,e)}return t}function hS(n,e){return e.patternStrategy==="escape"?LK(n):n}const $K=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function LK(n){let e="";for(let t=0;t<n.length;t++)$K.has(n[t])||(e+="\\"),e+=n[t];return e}function Wa(n,e,t,r){var i;n.format||(i=n.anyOf)!=null&&i.some(a=>a.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):hn(n,"format",e,t,r)}function oi(n,e,t,r){var i;n.pattern||(i=n.allOf)!=null&&i.some(a=>a.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:OD(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):hn(n,"pattern",OD(e,r),t,r)}function OD(n,e){var u;if(!e.applyRegexFlags||!n.flags)return n.source;const t={i:n.flags.includes("i"),m:n.flags.includes("m"),s:n.flags.includes("s")},r=t.i?n.source.toLowerCase():n.source;let i="",a=!1,s=!1,o=!1;for(let c=0;c<r.length;c++){if(a){i+=r[c],a=!1;continue}if(t.i){if(s){if(r[c].match(/[a-z]/)){o?(i+=r[c],i+=`${r[c-2]}-${r[c]}`.toUpperCase(),o=!1):r[c+1]==="-"&&((u=r[c+2])!=null&&u.match(/[a-z]/))?(i+=r[c],o=!0):i+=`${r[c]}${r[c].toUpperCase()}`;continue}}else if(r[c].match(/[a-z]/)){i+=`[${r[c]}${r[c].toUpperCase()}]`;continue}}if(t.m){if(r[c]==="^"){i+=`(^|(?<=[\r
]))`;continue}else if(r[c]==="$"){i+=`($|(?=[\r
]))`;continue}}if(t.s&&r[c]==="."){i+=s?`${r[c]}\r
`:`[${r[c]}\r
]`;continue}i+=r[c],r[c]==="\\"?a=!0:s&&r[c]==="]"?s=!1:!s&&r[c]==="["&&(s=!0)}try{new RegExp(i)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),n.source}return i}function $B(n,e){var r,i,a,s,o,u;if(e.target==="openAi"&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),e.target==="openApi3"&&((r=n.keyType)==null?void 0:r._def.typeName)===De.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((c,d)=>({...c,[d]:ln(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",d]})??fa(e)}),{}),additionalProperties:e.rejectedAdditionalProperties};const t={type:"object",additionalProperties:ln(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(e.target==="openApi3")return t;if(((i=n.keyType)==null?void 0:i._def.typeName)===De.ZodString&&((a=n.keyType._def.checks)!=null&&a.length)){const{type:c,...d}=DB(n.keyType._def,e);return{...t,propertyNames:d}}else{if(((s=n.keyType)==null?void 0:s._def.typeName)===De.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};if(((o=n.keyType)==null?void 0:o._def.typeName)===De.ZodBranded&&n.keyType._def.type._def.typeName===De.ZodString&&((u=n.keyType._def.type._def.checks)!=null&&u.length)){const{type:c,...d}=kB(n.keyType._def,e);return{...t,propertyNames:d}}}return t}function UK(n,e){if(e.mapStrategy==="record")return $B(n,e);const t=ln(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||fa(e),r=ln(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||fa(e);return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function jK(n){const e=n.values,r=Object.keys(n.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),i=Array.from(new Set(r.map(a=>typeof a)));return{type:i.length===1?i[0]==="string"?"string":"number":["string","number"],enum:r}}function FK(n){return n.target==="openAi"?void 0:{not:fa({...n,currentPath:[...n.currentPath,"not"]})}}function BK(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const Hv={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function qK(n,e){if(e.target==="openApi3")return ND(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in Hv&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((i,a)=>{const s=Hv[a._def.typeName];return s&&!i.includes(s)?[...i,s]:i},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((i,a)=>{const s=typeof a._def.value;switch(s){case"string":case"number":case"boolean":return[...i,s];case"bigint":return[...i,"integer"];case"object":if(a._def.value===null)return[...i,"null"];case"symbol":case"undefined":case"function":default:return i}},[]);if(r.length===t.length){const i=r.filter((a,s,o)=>o.indexOf(a)===s);return{type:i.length>1?i:i[0],enum:t.reduce((a,s)=>a.includes(s._def.value)?a:[...a,s._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,i)=>[...r,...i._def.values.filter(a=>!r.includes(a))],[])};return ND(n,e)}const ND=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,i)=>ln(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${i}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function VK(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"?{type:Hv[n.innerType._def.typeName],nullable:!0}:{type:[Hv[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=ln(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const t=ln(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function zK(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",OB(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?hn(t,"minimum",r.value,r.message,e):hn(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),hn(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?hn(t,"maximum",r.value,r.message,e):hn(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),hn(t,"maximum",r.value,r.message,e));break;case"multipleOf":hn(t,"multipleOf",r.value,r.message,e);break}return t}function HK(n,e){const t=e.target==="openAi",r={type:"object",properties:{}},i=[],a=n.shape();for(const o in a){let u=a[o];if(u===void 0||u._def===void 0)continue;let c=WK(u);c&&t&&(u._def.typeName==="ZodOptional"&&(u=u._def.innerType),u.isNullable()||(u=u.nullable()),c=!1);const d=ln(u._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});d!==void 0&&(r.properties[o]=d,c||i.push(o))}i.length&&(r.required=i);const s=GK(n,e);return s!==void 0&&(r.additionalProperties=s),r}function GK(n,e){if(n.catchall._def.typeName!=="ZodNever")return ln(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(n.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function WK(n){try{return n.isOptional()}catch{return!0}}const KK=(n,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return ln(n.innerType._def,e);const t=ln(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:fa(e)},t]}:fa(e)},JK=(n,e)=>{if(e.pipeStrategy==="input")return ln(n.in._def,e);if(e.pipeStrategy==="output")return ln(n.out._def,e);const t=ln(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=ln(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(i=>i!==void 0)}};function YK(n,e){return ln(n.type._def,e)}function ZK(n,e){const r={type:"array",uniqueItems:!0,items:ln(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&hn(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&hn(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function XK(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>ln(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:ln(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>ln(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function QK(n){return{not:fa(n)}}function eJ(n){return fa(n)}const tJ=(n,e)=>ln(n.innerType._def,e),nJ=(n,e,t)=>{switch(e){case De.ZodString:return DB(n,t);case De.ZodNumber:return zK(n,t);case De.ZodObject:return HK(n,t);case De.ZodBigInt:return CK(n,t);case De.ZodBoolean:return RK();case De.ZodDate:return MB(n,t);case De.ZodUndefined:return QK(t);case De.ZodNull:return BK(t);case De.ZodArray:return AK(n,t);case De.ZodUnion:case De.ZodDiscriminatedUnion:return qK(n,t);case De.ZodIntersection:return MK(n,t);case De.ZodTuple:return XK(n,t);case De.ZodRecord:return $B(n,t);case De.ZodLiteral:return DK(n,t);case De.ZodEnum:return NK(n);case De.ZodNativeEnum:return jK(n);case De.ZodNullable:return VK(n,t);case De.ZodOptional:return KK(n,t);case De.ZodMap:return UK(n,t);case De.ZodSet:return ZK(n,t);case De.ZodLazy:return()=>n.getter()._def;case De.ZodPromise:return YK(n,t);case De.ZodNaN:case De.ZodNever:return FK(t);case De.ZodEffects:return OK(n,t);case De.ZodAny:return fa(t);case De.ZodUnknown:return eJ(t);case De.ZodDefault:return xK(n,t);case De.ZodBranded:return kB(n,t);case De.ZodReadonly:return tJ(n,t);case De.ZodCatch:return IK(n,t);case De.ZodPipeline:return JK(n,t);case De.ZodFunction:case De.ZodVoid:case De.ZodSymbol:return;default:return(r=>{})()}};function ln(n,e,t=!1){var o;const r=e.seen.get(n);if(e.override){const u=(o=e.override)==null?void 0:o.call(e,n,e,r,t);if(u!==wK)return u}if(r&&!t){const u=rJ(r,e);if(u!==void 0)return u}const i={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,i);const a=nJ(n,n.typeName,e),s=typeof a=="function"?ln(a(),e):a;if(s&&iJ(n,e,s),e.postProcess){const u=e.postProcess(s,n,e);return i.jsonSchema=s,u}return i.jsonSchema=s,s}const rJ=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"relative":return{$ref:NB(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((t,r)=>e.currentPath[r]===t)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),fa(e)):e.$refStrategy==="seen"?fa(e):void 0}},iJ=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),aJ=(n,e)=>{const t=TK(e);let r;const i=e==null?void 0:e.name,a=ln(n._def,t,!1)??fa(t);t.flags.hasReferencedOpenAiAnyType&&(r||(r={}),r[t.openAiAnyTypeName]||(r[t.openAiAnyTypeName]={type:["string","number","integer","boolean","array","null"],items:{$ref:t.$refStrategy==="relative"?"1":[...t.basePath,t.definitionPath,t.openAiAnyTypeName].join("/")}}));const s=i===void 0?r?{...a,[t.definitionPath]:r}:a:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,i].join("/"),[t.definitionPath]:{...r,[i]:a}};return t.target==="jsonSchema7"?s.$schema="http://json-schema.org/draft-07/schema#":(t.target==="jsonSchema2019-09"||t.target==="openAi")&&(s.$schema="https://json-schema.org/draft/2019-09/schema#"),t.target==="openAi"&&("anyOf"in s||"oneOf"in s||"allOf"in s||"type"in s&&Array.isArray(s.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),s};function xu(n,e){const t=typeof n;if(t!==typeof e)return!1;if(Array.isArray(n)){if(!Array.isArray(e))return!1;const r=n.length;if(r!==e.length)return!1;for(let i=0;i<r;i++)if(!xu(n[i],e[i]))return!1;return!0}if(t==="object"){if(!n||!e)return n===e;const r=Object.keys(n),i=Object.keys(e);if(r.length!==i.length)return!1;for(const s of r)if(!xu(n[s],e[s]))return!1;return!0}return n===e}function Xa(n){return encodeURI(sJ(n))}function sJ(n){return n.replace(/~/g,"~0").replace(/\//g,"~1")}const oJ={prefixItems:!0,items:!0,allOf:!0,anyOf:!0,oneOf:!0},lJ={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependentSchemas:!0},uJ={id:!0,$id:!0,$ref:!0,$schema:!0,$anchor:!0,$vocabulary:!0,$comment:!0,default:!0,enum:!0,const:!0,required:!0,type:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};let cJ=typeof self<"u"&&self.location&&self.location.origin!=="null"?new URL(self.location.origin+self.location.pathname+location.search):new URL("https://github.com/cfworker");function Cl(n,e=Object.create(null),t=cJ,r=""){if(n&&typeof n=="object"&&!Array.isArray(n)){const a=n.$id||n.id;if(a){const s=new URL(a,t.href);s.hash.length>1?e[s.href]=n:(s.hash="",r===""?t=s:Cl(n,e,t))}}else if(n!==!0&&n!==!1)return e;const i=t.href+(r?"#"+r:"");if(e[i]!==void 0)throw new Error(`Duplicate schema URI "${i}".`);if(e[i]=n,n===!0||n===!1)return e;if(n.__absolute_uri__===void 0&&Object.defineProperty(n,"__absolute_uri__",{enumerable:!1,value:i}),n.$ref&&n.__absolute_ref__===void 0){const a=new URL(n.$ref,t.href);a.hash=a.hash,Object.defineProperty(n,"__absolute_ref__",{enumerable:!1,value:a.href})}if(n.$recursiveRef&&n.__absolute_recursive_ref__===void 0){const a=new URL(n.$recursiveRef,t.href);a.hash=a.hash,Object.defineProperty(n,"__absolute_recursive_ref__",{enumerable:!1,value:a.href})}if(n.$anchor){const a=new URL("#"+n.$anchor,t.href);e[a.href]=n}for(let a in n){if(uJ[a])continue;const s=`${r}/${Xa(a)}`,o=n[a];if(Array.isArray(o)){if(oJ[a]){const u=o.length;for(let c=0;c<u;c++)Cl(o[c],e,t,`${s}/${c}`)}}else if(lJ[a])for(let u in o)Cl(o[u],e,t,`${s}/${Xa(u)}`);else Cl(o,e,t,s)}return e}const fJ=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,dJ=[0,31,28,31,30,31,30,31,31,30,31,30,31],hJ=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,pJ=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,mJ=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,gJ=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,yJ=/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,vJ=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,_J=/^(?:\/(?:[^~/]|~0|~1)*)*$/,bJ=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,wJ=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,EJ=n=>{if(n[0]==='"')return!1;const[e,t,...r]=n.split("@");return!e||!t||r.length!==0||e.length>64||t.length>253||e[0]==="."||e.endsWith(".")||e.includes("..")||!/^[a-z0-9.-]+$/i.test(t)||!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(e)?!1:t.split(".").every(i=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(i))},SJ=/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,TJ=/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,AJ=n=>n.length>1&&n.length<80&&(/^P\d+([.,]\d+)?W$/.test(n)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(n)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(n));function As(n){return n.test.bind(n)}const kD={date:LB,time:UB.bind(void 0,!1),"date-time":IJ,duration:AJ,uri:OJ,"uri-reference":As(mJ),"uri-template":As(gJ),url:As(yJ),email:EJ,hostname:As(pJ),ipv4:As(SJ),ipv6:As(TJ),regex:kJ,uuid:As(vJ),"json-pointer":As(_J),"json-pointer-uri-fragment":As(bJ),"relative-json-pointer":As(wJ)};function CJ(n){return n%4===0&&(n%100!==0||n%400===0)}function LB(n){const e=n.match(fJ);if(!e)return!1;const t=+e[1],r=+e[2],i=+e[3];return r>=1&&r<=12&&i>=1&&i<=(r==2&&CJ(t)?29:dJ[r])}function UB(n,e){const t=e.match(hJ);if(!t)return!1;const r=+t[1],i=+t[2],a=+t[3],s=!!t[5];return(r<=23&&i<=59&&a<=59||r==23&&i==59&&a==60)&&(!n||s)}const RJ=/t|\s/i;function IJ(n){const e=n.split(RJ);return e.length==2&&LB(e[0])&&UB(!0,e[1])}const PJ=/\/|:/,xJ=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function OJ(n){return PJ.test(n)&&xJ.test(n)}const NJ=/[^\\]\\Z/;function kJ(n){if(NJ.test(n))return!1;try{return new RegExp(n,"u"),!0}catch{return!1}}function MJ(n){let e=0,t=n.length,r=0,i;for(;r<t;)e++,i=n.charCodeAt(r++),i>=55296&&i<=56319&&r<t&&(i=n.charCodeAt(r),(i&64512)==56320&&r++);return e}function On(n,e,t="2019-09",r=Cl(e),i=!0,a=null,s="#",o="#",u=Object.create(null)){if(e===!0)return{valid:!0,errors:[]};if(e===!1)return{valid:!1,errors:[{instanceLocation:s,keyword:"false",keywordLocation:s,error:"False boolean schema."}]};const c=typeof n;let d;switch(c){case"boolean":case"number":case"string":d=c;break;case"object":n===null?d="null":Array.isArray(n)?d="array":d="object";break;default:throw new Error(`Instances of "${c}" type are not supported.`)}const{$ref:p,$recursiveRef:m,$recursiveAnchor:y,type:b,const:w,enum:S,required:T,not:C,anyOf:A,allOf:I,oneOf:x,if:L,then:U,else:N,format:B,properties:q,patternProperties:J,additionalProperties:V,unevaluatedProperties:de,minProperties:ae,maxProperties:ue,propertyNames:te,dependentRequired:oe,dependentSchemas:ge,dependencies:Ee,prefixItems:Y,items:ve,additionalItems:Re,unevaluatedItems:Q,contains:ie,minContains:ce,maxContains:P,minItems:O,maxItems:K,uniqueItems:X,minimum:se,maximum:F,exclusiveMinimum:z,exclusiveMaximum:ye,multipleOf:ke,minLength:Qe,maxLength:$e,pattern:ze,__absolute_ref__:xt,__absolute_recursive_ref__:Oe}=e,qe=[];if(y===!0&&a===null&&(a=e),m==="#"){const Ve=a===null?r[Oe]:a,Be=`${o}/$recursiveRef`,et=On(n,a===null?e:a,t,r,i,Ve,s,Be,u);et.valid||qe.push({instanceLocation:s,keyword:"$recursiveRef",keywordLocation:Be,error:"A subschema had errors."},...et.errors)}if(p!==void 0){const Be=r[xt||p];if(Be===void 0){let We=`Unresolved $ref "${p}".`;throw xt&&xt!==p&&(We+=`  Absolute URI "${xt}".`),We+=`
Known schemas:
- ${Object.keys(r).join(`
- `)}`,new Error(We)}const et=`${o}/$ref`,Ye=On(n,Be,t,r,i,a,s,et,u);if(Ye.valid||qe.push({instanceLocation:s,keyword:"$ref",keywordLocation:et,error:"A subschema had errors."},...Ye.errors),t==="4"||t==="7")return{valid:qe.length===0,errors:qe}}if(Array.isArray(b)){let Ve=b.length,Be=!1;for(let et=0;et<Ve;et++)if(d===b[et]||b[et]==="integer"&&d==="number"&&n%1===0&&n===n){Be=!0;break}Be||qe.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${d}" is invalid. Expected "${b.join('", "')}".`})}else b==="integer"?(d!=="number"||n%1||n!==n)&&qe.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${d}" is invalid. Expected "${b}".`}):b!==void 0&&d!==b&&qe.push({instanceLocation:s,keyword:"type",keywordLocation:`${o}/type`,error:`Instance type "${d}" is invalid. Expected "${b}".`});if(w!==void 0&&(d==="object"||d==="array"?xu(n,w)||qe.push({instanceLocation:s,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(w)}.`}):n!==w&&qe.push({instanceLocation:s,keyword:"const",keywordLocation:`${o}/const`,error:`Instance does not match ${JSON.stringify(w)}.`})),S!==void 0&&(d==="object"||d==="array"?S.some(Ve=>xu(n,Ve))||qe.push({instanceLocation:s,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(S)}.`}):S.some(Ve=>n===Ve)||qe.push({instanceLocation:s,keyword:"enum",keywordLocation:`${o}/enum`,error:`Instance does not match any of ${JSON.stringify(S)}.`})),C!==void 0){const Ve=`${o}/not`;On(n,C,t,r,i,a,s,Ve).valid&&qe.push({instanceLocation:s,keyword:"not",keywordLocation:Ve,error:'Instance matched "not" schema.'})}let It=[];if(A!==void 0){const Ve=`${o}/anyOf`,Be=qe.length;let et=!1;for(let Ye=0;Ye<A.length;Ye++){const We=A[Ye],rt=Object.create(u),tt=On(n,We,t,r,i,y===!0?a:null,s,`${Ve}/${Ye}`,rt);qe.push(...tt.errors),et=et||tt.valid,tt.valid&&It.push(rt)}et?qe.length=Be:qe.splice(Be,0,{instanceLocation:s,keyword:"anyOf",keywordLocation:Ve,error:"Instance does not match any subschemas."})}if(I!==void 0){const Ve=`${o}/allOf`,Be=qe.length;let et=!0;for(let Ye=0;Ye<I.length;Ye++){const We=I[Ye],rt=Object.create(u),tt=On(n,We,t,r,i,y===!0?a:null,s,`${Ve}/${Ye}`,rt);qe.push(...tt.errors),et=et&&tt.valid,tt.valid&&It.push(rt)}et?qe.length=Be:qe.splice(Be,0,{instanceLocation:s,keyword:"allOf",keywordLocation:Ve,error:"Instance does not match every subschema."})}if(x!==void 0){const Ve=`${o}/oneOf`,Be=qe.length,et=x.filter((Ye,We)=>{const rt=Object.create(u),tt=On(n,Ye,t,r,i,y===!0?a:null,s,`${Ve}/${We}`,rt);return qe.push(...tt.errors),tt.valid&&It.push(rt),tt.valid}).length;et===1?qe.length=Be:qe.splice(Be,0,{instanceLocation:s,keyword:"oneOf",keywordLocation:Ve,error:`Instance does not match exactly one subschema (${et} matches).`})}if((d==="object"||d==="array")&&Object.assign(u,...It),L!==void 0){const Ve=`${o}/if`;if(On(n,L,t,r,i,a,s,Ve,u).valid){if(U!==void 0){const et=On(n,U,t,r,i,a,s,`${o}/then`,u);et.valid||qe.push({instanceLocation:s,keyword:"if",keywordLocation:Ve,error:'Instance does not match "then" schema.'},...et.errors)}}else if(N!==void 0){const et=On(n,N,t,r,i,a,s,`${o}/else`,u);et.valid||qe.push({instanceLocation:s,keyword:"if",keywordLocation:Ve,error:'Instance does not match "else" schema.'},...et.errors)}}if(d==="object"){if(T!==void 0)for(const Ye of T)Ye in n||qe.push({instanceLocation:s,keyword:"required",keywordLocation:`${o}/required`,error:`Instance does not have required property "${Ye}".`});const Ve=Object.keys(n);if(ae!==void 0&&Ve.length<ae&&qe.push({instanceLocation:s,keyword:"minProperties",keywordLocation:`${o}/minProperties`,error:`Instance does not have at least ${ae} properties.`}),ue!==void 0&&Ve.length>ue&&qe.push({instanceLocation:s,keyword:"maxProperties",keywordLocation:`${o}/maxProperties`,error:`Instance does not have at least ${ue} properties.`}),te!==void 0){const Ye=`${o}/propertyNames`;for(const We in n){const rt=`${s}/${Xa(We)}`,tt=On(We,te,t,r,i,a,rt,Ye);tt.valid||qe.push({instanceLocation:s,keyword:"propertyNames",keywordLocation:Ye,error:`Property name "${We}" does not match schema.`},...tt.errors)}}if(oe!==void 0){const Ye=`${o}/dependantRequired`;for(const We in oe)if(We in n){const rt=oe[We];for(const tt of rt)tt in n||qe.push({instanceLocation:s,keyword:"dependentRequired",keywordLocation:Ye,error:`Instance has "${We}" but does not have "${tt}".`})}}if(ge!==void 0)for(const Ye in ge){const We=`${o}/dependentSchemas`;if(Ye in n){const rt=On(n,ge[Ye],t,r,i,a,s,`${We}/${Xa(Ye)}`,u);rt.valid||qe.push({instanceLocation:s,keyword:"dependentSchemas",keywordLocation:We,error:`Instance has "${Ye}" but does not match dependant schema.`},...rt.errors)}}if(Ee!==void 0){const Ye=`${o}/dependencies`;for(const We in Ee)if(We in n){const rt=Ee[We];if(Array.isArray(rt))for(const tt of rt)tt in n||qe.push({instanceLocation:s,keyword:"dependencies",keywordLocation:Ye,error:`Instance has "${We}" but does not have "${tt}".`});else{const tt=On(n,rt,t,r,i,a,s,`${Ye}/${Xa(We)}`);tt.valid||qe.push({instanceLocation:s,keyword:"dependencies",keywordLocation:Ye,error:`Instance has "${We}" but does not match dependant schema.`},...tt.errors)}}}const Be=Object.create(null);let et=!1;if(q!==void 0){const Ye=`${o}/properties`;for(const We in q){if(!(We in n))continue;const rt=`${s}/${Xa(We)}`,tt=On(n[We],q[We],t,r,i,a,rt,`${Ye}/${Xa(We)}`);if(tt.valid)u[We]=Be[We]=!0;else if(et=i,qe.push({instanceLocation:s,keyword:"properties",keywordLocation:Ye,error:`Property "${We}" does not match schema.`},...tt.errors),et)break}}if(!et&&J!==void 0){const Ye=`${o}/patternProperties`;for(const We in J){const rt=new RegExp(We,"u"),tt=J[We];for(const St in n){if(!rt.test(St))continue;const H=`${s}/${Xa(St)}`,k=On(n[St],tt,t,r,i,a,H,`${Ye}/${Xa(We)}`);k.valid?u[St]=Be[St]=!0:(et=i,qe.push({instanceLocation:s,keyword:"patternProperties",keywordLocation:Ye,error:`Property "${St}" matches pattern "${We}" but does not match associated schema.`},...k.errors))}}}if(!et&&V!==void 0){const Ye=`${o}/additionalProperties`;for(const We in n){if(Be[We])continue;const rt=`${s}/${Xa(We)}`,tt=On(n[We],V,t,r,i,a,rt,Ye);tt.valid?u[We]=!0:(et=i,qe.push({instanceLocation:s,keyword:"additionalProperties",keywordLocation:Ye,error:`Property "${We}" does not match additional properties schema.`},...tt.errors))}}else if(!et&&de!==void 0){const Ye=`${o}/unevaluatedProperties`;for(const We in n)if(!u[We]){const rt=`${s}/${Xa(We)}`,tt=On(n[We],de,t,r,i,a,rt,Ye);tt.valid?u[We]=!0:qe.push({instanceLocation:s,keyword:"unevaluatedProperties",keywordLocation:Ye,error:`Property "${We}" does not match unevaluated properties schema.`},...tt.errors)}}}else if(d==="array"){K!==void 0&&n.length>K&&qe.push({instanceLocation:s,keyword:"maxItems",keywordLocation:`${o}/maxItems`,error:`Array has too many items (${n.length} > ${K}).`}),O!==void 0&&n.length<O&&qe.push({instanceLocation:s,keyword:"minItems",keywordLocation:`${o}/minItems`,error:`Array has too few items (${n.length} < ${O}).`});const Ve=n.length;let Be=0,et=!1;if(Y!==void 0){const Ye=`${o}/prefixItems`,We=Math.min(Y.length,Ve);for(;Be<We;Be++){const rt=On(n[Be],Y[Be],t,r,i,a,`${s}/${Be}`,`${Ye}/${Be}`);if(u[Be]=!0,!rt.valid&&(et=i,qe.push({instanceLocation:s,keyword:"prefixItems",keywordLocation:Ye,error:"Items did not match schema."},...rt.errors),et))break}}if(ve!==void 0){const Ye=`${o}/items`;if(Array.isArray(ve)){const We=Math.min(ve.length,Ve);for(;Be<We;Be++){const rt=On(n[Be],ve[Be],t,r,i,a,`${s}/${Be}`,`${Ye}/${Be}`);if(u[Be]=!0,!rt.valid&&(et=i,qe.push({instanceLocation:s,keyword:"items",keywordLocation:Ye,error:"Items did not match schema."},...rt.errors),et))break}}else for(;Be<Ve;Be++){const We=On(n[Be],ve,t,r,i,a,`${s}/${Be}`,Ye);if(u[Be]=!0,!We.valid&&(et=i,qe.push({instanceLocation:s,keyword:"items",keywordLocation:Ye,error:"Items did not match schema."},...We.errors),et))break}if(!et&&Re!==void 0){const We=`${o}/additionalItems`;for(;Be<Ve;Be++){const rt=On(n[Be],Re,t,r,i,a,`${s}/${Be}`,We);u[Be]=!0,rt.valid||(et=i,qe.push({instanceLocation:s,keyword:"additionalItems",keywordLocation:We,error:"Items did not match additional items schema."},...rt.errors))}}}if(ie!==void 0)if(Ve===0&&ce===void 0)qe.push({instanceLocation:s,keyword:"contains",keywordLocation:`${o}/contains`,error:"Array is empty. It must contain at least one item matching the schema."});else if(ce!==void 0&&Ve<ce)qe.push({instanceLocation:s,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array has less items (${Ve}) than minContains (${ce}).`});else{const Ye=`${o}/contains`,We=qe.length;let rt=0;for(let tt=0;tt<Ve;tt++){const St=On(n[tt],ie,t,r,i,a,`${s}/${tt}`,Ye);St.valid?(u[tt]=!0,rt++):qe.push(...St.errors)}rt>=(ce||0)&&(qe.length=We),ce===void 0&&P===void 0&&rt===0?qe.splice(We,0,{instanceLocation:s,keyword:"contains",keywordLocation:Ye,error:"Array does not contain item matching schema."}):ce!==void 0&&rt<ce?qe.push({instanceLocation:s,keyword:"minContains",keywordLocation:`${o}/minContains`,error:`Array must contain at least ${ce} items matching schema. Only ${rt} items were found.`}):P!==void 0&&rt>P&&qe.push({instanceLocation:s,keyword:"maxContains",keywordLocation:`${o}/maxContains`,error:`Array may contain at most ${P} items matching schema. ${rt} items were found.`})}if(!et&&Q!==void 0){const Ye=`${o}/unevaluatedItems`;for(Be;Be<Ve;Be++){if(u[Be])continue;const We=On(n[Be],Q,t,r,i,a,`${s}/${Be}`,Ye);u[Be]=!0,We.valid||qe.push({instanceLocation:s,keyword:"unevaluatedItems",keywordLocation:Ye,error:"Items did not match unevaluated items schema."},...We.errors)}}if(X)for(let Ye=0;Ye<Ve;Ye++){const We=n[Ye],rt=typeof We=="object"&&We!==null;for(let tt=0;tt<Ve;tt++){if(Ye===tt)continue;const St=n[tt];(We===St||rt&&(typeof St=="object"&&St!==null)&&xu(We,St))&&(qe.push({instanceLocation:s,keyword:"uniqueItems",keywordLocation:`${o}/uniqueItems`,error:`Duplicate items at indexes ${Ye} and ${tt}.`}),Ye=Number.MAX_SAFE_INTEGER,tt=Number.MAX_SAFE_INTEGER)}}}else if(d==="number"){if(t==="4"?(se!==void 0&&(z===!0&&n<=se||n<se)&&qe.push({instanceLocation:s,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${n} is less than ${z?"or equal to ":""} ${se}.`}),F!==void 0&&(ye===!0&&n>=F||n>F)&&qe.push({instanceLocation:s,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${n} is greater than ${ye?"or equal to ":""} ${F}.`})):(se!==void 0&&n<se&&qe.push({instanceLocation:s,keyword:"minimum",keywordLocation:`${o}/minimum`,error:`${n} is less than ${se}.`}),F!==void 0&&n>F&&qe.push({instanceLocation:s,keyword:"maximum",keywordLocation:`${o}/maximum`,error:`${n} is greater than ${F}.`}),z!==void 0&&n<=z&&qe.push({instanceLocation:s,keyword:"exclusiveMinimum",keywordLocation:`${o}/exclusiveMinimum`,error:`${n} is less than ${z}.`}),ye!==void 0&&n>=ye&&qe.push({instanceLocation:s,keyword:"exclusiveMaximum",keywordLocation:`${o}/exclusiveMaximum`,error:`${n} is greater than or equal to ${ye}.`})),ke!==void 0){const Ve=n%ke;Math.abs(0-Ve)>=11920929e-14&&Math.abs(ke-Ve)>=11920929e-14&&qe.push({instanceLocation:s,keyword:"multipleOf",keywordLocation:`${o}/multipleOf`,error:`${n} is not a multiple of ${ke}.`})}}else if(d==="string"){const Ve=Qe===void 0&&$e===void 0?0:MJ(n);Qe!==void 0&&Ve<Qe&&qe.push({instanceLocation:s,keyword:"minLength",keywordLocation:`${o}/minLength`,error:`String is too short (${Ve} < ${Qe}).`}),$e!==void 0&&Ve>$e&&qe.push({instanceLocation:s,keyword:"maxLength",keywordLocation:`${o}/maxLength`,error:`String is too long (${Ve} > ${$e}).`}),ze!==void 0&&!new RegExp(ze,"u").test(n)&&qe.push({instanceLocation:s,keyword:"pattern",keywordLocation:`${o}/pattern`,error:"String does not match pattern."}),B!==void 0&&kD[B]&&!kD[B](n)&&qe.push({instanceLocation:s,keyword:"format",keywordLocation:`${o}/format`,error:`String does not match format "${B}".`})}return{valid:qe.length===0,errors:qe}}class DJ{constructor(e,t="2019-09",r=!0){Kr(this,"schema");Kr(this,"draft");Kr(this,"shortCircuit");Kr(this,"lookup");this.schema=e,this.draft=t,this.shortCircuit=r,this.lookup=Cl(e)}validate(e){return On(e,this.schema,this.draft,this.lookup,this.shortCircuit)}addSchema(e,t){t&&(e={...e,$id:t}),Cl(e,this.lookup)}}function ar(n){if(typeof n!="object"||n===null)return!1;const e=n;if(!("_zod"in e))return!1;const t=e._zod;return typeof t=="object"&&t!==null&&"def"in t}function sr(n){if(typeof n!="object"||n===null)return!1;const e=n;if(!("_def"in e)||"_zod"in e)return!1;const t=e._def;return typeof t=="object"&&t!=null&&"typeName"in t}function $J(n){return ar(n)&&console.warn("[WARNING] Attempting to use Zod 4 schema in a context where Zod 3 schema is expected. This may cause unexpected behavior."),sr(n)}function Pi(n){return!n||typeof n!="object"||Array.isArray(n)?!1:!!(ar(n)||sr(n))}async function H_(n,e){if(ar(n))try{return{success:!0,data:await uK(n,e)}}catch(t){return{success:!1,error:t}}if(sr(n))return n.safeParse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}async function G_(n,e){if(ar(n))return cm(n,e);if(sr(n))return n.parse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function LJ(n,e){if(ar(n))try{return{success:!0,data:cm(n,e)}}catch(t){return{success:!1,error:t}}if(sr(n))return n.safeParse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function Jy(n,e){if(ar(n))return cm(n,e);if(sr(n))return n.parse(e);throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function td(n){var e;if(ar(n))return(e=xa.get(n))==null?void 0:e.description;if(sr(n)||"description"in n&&typeof n.description=="string")return n.description}function UJ(n){if(!Pi(n))return!1;if(sr(n)){const e=n._def;if(e.typeName==="ZodObject"){const t=n;return!t.shape||Object.keys(t.shape).length===0}if(e.typeName==="ZodRecord")return!0}if(ar(n)){const e=n._zod.def;if(e.type==="object"){const t=n;return!t.shape||Object.keys(t.shape).length===0}if(e.type==="record")return!0}return typeof n=="object"&&n!==null&&!("shape"in n)}function XR(n){return Pi(n)?sr(n)?n._def.typeName==="ZodString":ar(n)?n._zod.def.type==="string":!1:!1}function QR(n){return typeof n=="object"&&n!==null&&"_def"in n&&typeof n._def=="object"&&n._def!==null&&"typeName"in n._def&&n._def.typeName==="ZodObject"}function Hs(n){return ar(n)?typeof n=="object"&&n!==null&&"_zod"in n&&typeof n._zod=="object"&&n._zod!==null&&"def"in n._zod&&typeof n._zod.def=="object"&&n._zod.def!==null&&"type"in n._zod.def&&n._zod.def.type==="object":!1}function W_(n){return ar(n)?typeof n=="object"&&n!==null&&"_zod"in n&&typeof n._zod=="object"&&n._zod!==null&&"def"in n._zod&&typeof n._zod.def=="object"&&n._zod.def!==null&&"type"in n._zod.def&&n._zod.def.type==="array":!1}function xo(n){return!!(QR(n)||Hs(n))}function c1(n){if(sr(n))return n.shape;if(ar(n))return n._zod.def.shape;throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function jB(n,e){if(sr(n))return n.extend(e);if(ar(n))return iK(n,e);throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function eI(n){if(sr(n))return n.partial();if(ar(n))return aK(yK,n);throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function Gv(n,e=!1){if(sr(n))return n.strict();if(Hs(n)){const t=n._zod.def.shape;if(e)for(const[a,s]of Object.entries(n._zod.def.shape)){if(Hs(s)){const u=Gv(s,e);t[a]=u}else if(W_(s)){let u=s._zod.def.element;Hs(u)&&(u=Gv(u,e)),t[a]=Ul(s,{...s._zod.def,element:u})}else t[a]=s;const o=xa.get(s);o&&xa.add(t[a],o)}const r=Ul(n,{...n._zod.def,shape:t,catchall:bK(gK)}),i=xa.get(n);return i&&xa.add(r,i),r}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function f1(n,e=!1){if(QR(n))return n.passthrough();if(Hs(n)){const t=n._zod.def.shape;if(e)for(const[a,s]of Object.entries(n._zod.def.shape)){if(Hs(s)){const u=f1(s,e);t[a]=u}else if(W_(s)){let u=s._zod.def.element;Hs(u)&&(u=f1(u,e)),t[a]=Ul(s,{...s._zod.def,element:u})}else t[a]=s;const o=xa.get(s);o&&xa.add(t[a],o)}const r=Ul(n,{...n._zod.def,shape:t,catchall:_K(mK)}),i=xa.get(n);return i&&xa.add(r,i),r}throw new Error("Schema must be an instance of z3.ZodObject or z4.$ZodObject")}function jJ(n){if(sr(n))try{const e=n.parse(void 0);return()=>e}catch{return}if(ar(n))try{const e=cm(n,void 0);return()=>e}catch{return}}function FJ(n){return sr(n)&&"typeName"in n._def&&n._def.typeName==="ZodEffects"}function BJ(n){return ar(n)&&n._zod.def.type==="pipe"}function Af(n,e=!1){if(sr(n))return FJ(n)?Af(n._def.schema,e):n;if(ar(n)){let t=n;if(BJ(n)&&(t=Af(n._zod.def.in,e)),e){if(Hs(t)){const i=t._zod.def.shape;for(const[a,s]of Object.entries(t._zod.def.shape))i[a]=Af(s,e);t=Ul(t,{...t._zod.def,shape:i})}else if(W_(t)){const i=Af(t._zod.def.element,e);t=Ul(t,{...t._zod.def,element:i})}}const r=xa.get(n);return r&&xa.add(t,r),t}throw new Error("Schema must be an instance of z3.ZodType or z4.$ZodType")}function yr(n){if(ar(n)){const e=Af(n,!0);if(Hs(e)){const t=Gv(e,!0);return u1(t)}else return u1(n)}return sr(n)?aJ(n):n}function fp(n){if(!n||typeof n!="object"||Object.keys(n).length===0||Array.isArray(n))return!1;if("type"in n)return typeof n.type=="string"?n.type==="string":Array.isArray(n.type)?n.type.every(e=>e==="string"):!1;if("enum"in n)return Array.isArray(n.enum)&&n.enum.length>0&&n.enum.every(e=>typeof e=="string");if("const"in n)return typeof n.const=="string";if("allOf"in n&&Array.isArray(n.allOf))return n.allOf.some(e=>fp(e));if("anyOf"in n&&Array.isArray(n.anyOf)||"oneOf"in n&&Array.isArray(n.oneOf)){const e="anyOf"in n?n.anyOf:n.oneOf;return e.length>0&&e.every(t=>fp(t))}if("not"in n)return!1;if("$ref"in n&&typeof n.$ref=="string"){const e=n.$ref,t=Cl(n);return t[e]?fp(t[e]):!1}return!1}const qJ=Object.freeze(Object.defineProperty({__proto__:null,Validator:DJ,deepCompareStrict:xu,toJsonSchema:yr,validatesOnlyStrings:fp},Symbol.toStringTag,{value:"Module"}));function VJ(n,e){if(n!==void 0&&!Gy(n))return n;if(YR(e))try{let t=e.getName();return t=t.startsWith("Runnable")?t.slice(8):t,t}catch{return e.getName()}else return e.name??"UnknownSchema"}function zJ(n){return YR(n.data)?{type:"runnable",data:{id:n.data.lc_id,name:n.data.getName()}}:{type:"schema",data:{...yr(n.data.schema),title:n.data.name}}}let Wv=class FB{constructor(e){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.nodes=(e==null?void 0:e.nodes)??this.nodes,this.edges=(e==null?void 0:e.edges)??this.edges}toJSON(){const e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=Gy(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...zJ(t)})),edges:this.edges.map(t=>{const r={source:e[t.source],target:e[t.target]};return typeof t.data<"u"&&(r.data=t.data),typeof t.conditional<"u"&&(r.conditional=t.conditional),r})}}addNode(e,t,r){if(t!==void 0&&this.nodes[t]!==void 0)throw new Error(`Node with id ${t} already exists`);const i=t??Eo(),a={id:i,data:e,name:VJ(t,e),metadata:r};return this.nodes[i]=a,a}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r,i){if(this.nodes[e.id]===void 0)throw new Error(`Source node ${e.id} not in graph`);if(this.nodes[t.id]===void 0)throw new Error(`Target node ${t.id} not in graph`);const a={source:e.id,target:t.id,data:r,conditional:i};return this.edges.push(a),a}firstNode(){return MD(this)}lastNode(){return DD(this)}extend(e,t=""){let r=t;Object.values(e.nodes).map(c=>c.id).every(Gy)&&(r="");const a=c=>r?`${r}:${c}`:c;Object.entries(e.nodes).forEach(([c,d])=>{this.nodes[a(c)]={...d,id:a(c)}});const s=e.edges.map(c=>({...c,source:a(c.source),target:a(c.target)}));this.edges=[...this.edges,...s];const o=e.firstNode(),u=e.lastNode();return[o?{id:a(o.id),data:o.data}:void 0,u?{id:a(u.id),data:u.data}:void 0]}trimFirstNode(){const e=this.firstNode();e&&MD(this,[e.id])&&this.removeNode(e)}trimLastNode(){const e=this.lastNode();e&&DD(this,[e.id])&&this.removeNode(e)}reid(){const e=Object.fromEntries(Object.values(this.nodes).map(i=>[i.id,i.name])),t=new Map;Object.values(e).forEach(i=>{t.set(i,(t.get(i)||0)+1)});const r=i=>{const a=e[i];return Gy(i)&&t.get(a)===1?a:i};return new FB({nodes:Object.fromEntries(Object.entries(this.nodes).map(([i,a])=>[r(i),{...a,id:r(i)}])),edges:this.edges.map(i=>({...i,source:r(i.source),target:r(i.target)}))})}drawMermaid(e){const{withStyles:t,curveStyle:r,nodeColors:i={default:"fill:#f2f0ff,line-height:1.2",first:"fill-opacity:0",last:"fill:#bfb6fc"},wrapLabelNWords:a}=e??{},s=this.reid(),o=s.firstNode(),u=s.lastNode();return JW(s.nodes,s.edges,{firstNode:o==null?void 0:o.id,lastNode:u==null?void 0:u.id,withStyles:t,curveStyle:r,nodeColors:i,wrapLabelNWords:a})}async drawMermaidPng(e){const t=this.drawMermaid(e);return YW(t,{backgroundColor:e==null?void 0:e.backgroundColor})}};function MD(n,e=[]){const t=new Set(n.edges.filter(i=>!e.includes(i.source)).map(i=>i.target)),r=[];for(const i of Object.values(n.nodes))!e.includes(i.id)&&!t.has(i.id)&&r.push(i);return r.length===1?r[0]:void 0}function DD(n,e=[]){const t=new Set(n.edges.filter(i=>!e.includes(i.target)).map(i=>i.source)),r=[];for(const i of Object.values(n.nodes))!e.includes(i.id)&&!t.has(i.id)&&r.push(i);return r.length===1?r[0]:void 0}function HJ(n){const e=new TextEncoder,t=new ReadableStream({async start(r){for await(const i of n)r.enqueue(e.encode(`event: data
data: ${JSON.stringify(i)}

`));r.enqueue(e.encode(`event: end

`)),r.close()}});return ti.fromReadableStream(t)}function $D(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.iterator]=="function"&&typeof n.next=="function"}const GJ=n=>n!=null&&typeof n=="object"&&"next"in n&&typeof n.next=="function";function d1(n){return typeof n=="object"&&n!==null&&typeof n[Symbol.asyncIterator]=="function"}function*LD(n,e){for(;;){const{value:t,done:r}=Di.runWithConfig(Lo(n),e.next.bind(e),!0);if(r)break;yield t}}async function*h1(n,e){const t=e[Symbol.asyncIterator]();for(;;){const{value:r,done:i}=await Di.runWithConfig(Lo(n),t.next.bind(e),!0);if(i)break;yield r}}function gr(n,e){return n&&!Array.isArray(n)&&!(n instanceof Date)&&typeof n=="object"?n:{[e]:n}}class qt extends la{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){const t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new di({bound:this,kwargs:e,config:{}})}map(){return new $p({bound:this})}withRetry(e){return new tI({bound:this,kwargs:{},config:{},maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}withConfig(e){return new di({bound:this,config:e,kwargs:{}})}withFallbacks(e){const t=Array.isArray(e)?e:e.fallbacks;return new BB({runnable:this,fallbacks:t})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw new Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(Jt);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");const r=Object.fromEntries(Object.entries(e).filter(([i])=>i!=="runId"));return Array.from({length:t},(i,a)=>Jt(a===0?e:r))}return Array.from({length:t},()=>Jt(e))}async batch(e,t,r){var u;const i=this._getOptionsList(t??{},e.length),a=((u=i[0])==null?void 0:u.maxConcurrency)??(r==null?void 0:r.maxConcurrency),s=new um({maxConcurrency:a,onFailedAttempt:c=>{throw c}}),o=e.map((c,d)=>s.call(async()=>{try{return await this.invoke(c,i[d])}catch(p){if(r!=null&&r.returnExceptions)return p;throw p}}));return Promise.all(o)}async*_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){const r=Jt(t),i=new uc({generator:this._streamIterator(e,r),config:r});return await i.setup,ti.fromAsyncGenerator(i)}_separateRunnableConfigFromCallOptions(e){let t;e===void 0?t=Jt(e):t=Jt({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId,timeout:e.timeout,signal:e.signal});const r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,delete r.timeout,delete r.signal,[t,r]}async _callWithConfig(e,t,r){const i=Jt(r),a=await $i(i),s=await(a==null?void 0:a.handleChainStart(this.toJSON(),gr(t,"input"),i.runId,i==null?void 0:i.runType,void 0,void 0,(i==null?void 0:i.runName)??this.getName()));delete i.runId;let o;try{const u=e.call(this,t,i,s);o=await $l(u,r==null?void 0:r.signal)}catch(u){throw await(s==null?void 0:s.handleChainError(u)),u}return await(s==null?void 0:s.handleChainEnd(gr(o,"output"))),o}async _batchWithConfig(e,t,r,i){var c;const a=this._getOptionsList(r??{},t.length),s=await Promise.all(a.map($i)),o=await Promise.all(s.map(async(d,p)=>{const m=await(d==null?void 0:d.handleChainStart(this.toJSON(),gr(t[p],"input"),a[p].runId,a[p].runType,void 0,void 0,a[p].runName??this.getName()));return delete a[p].runId,m}));let u;try{const d=e.call(this,t,a,o,i);u=await $l(d,(c=a==null?void 0:a[0])==null?void 0:c.signal)}catch(d){throw await Promise.all(o.map(p=>p==null?void 0:p.handleChainError(d))),d}return await Promise.all(o.map(d=>d==null?void 0:d.handleChainEnd(gr(u,"output")))),u}async*_transformStreamWithConfig(e,t,r){let i,a=!0,s,o=!0;const u=Jt(r),c=await $i(u);async function*d(){for await(const m of e){if(a)if(i===void 0)i=m;else try{i=fi(i,m)}catch{i=void 0,a=!1}yield m}}let p;try{const m=await AB(t.bind(this),d(),async()=>c==null?void 0:c.handleChainStart(this.toJSON(),{input:""},u.runId,u.runType,void 0,void 0,u.runName??this.getName()),r==null?void 0:r.signal,u);delete u.runId,p=m.setup;const y=p==null?void 0:p.handlers.find(BW);let b=m.output;y!==void 0&&p!==void 0&&(b=y.tapOutputIterable(p.runId,b));const w=p==null?void 0:p.handlers.find(CB);w!==void 0&&p!==void 0&&(b=w.tapOutputIterable(p.runId,b));for await(const S of b)if(yield S,o)if(s===void 0)s=S;else try{s=fi(s,S)}catch{s=void 0,o=!1}}catch(m){throw await(p==null?void 0:p.handleChainError(m,void 0,void 0,void 0,{inputs:gr(i,"input")})),m}await(p==null?void 0:p.handleChainEnd(s??{},void 0,void 0,void 0,{inputs:gr(i,"input")}))}getGraph(e){const t=new Wv,r=t.addNode({name:`${this.getName()}Input`,schema:Pa()}),i=t.addNode(this),a=t.addNode({name:`${this.getName()}Output`,schema:Pa()});return t.addEdge(r,i),t.addEdge(i,a),t}pipe(e){return new vr({first:this,last:Vr(e)})}pick(e){return this.pipe(new qB(e))}assign(e){return this.pipe(new rI(new Vl({steps:e})))}async*transform(e,t){let r;for await(const i of e)r===void 0?r=i:r=fi(r,i);yield*this._streamIterator(r,Jt(t))}async*streamLog(e,t,r){const i=new o1({...r,autoClose:!1,_schemaFormat:"original"}),a=Jt(t);yield*this._streamLog(e,i,a)}async*_streamLog(e,t,r){const{callbacks:i}=r;if(i===void 0)r.callbacks=[t];else if(Array.isArray(i))r.callbacks=i.concat([t]);else{const u=i.copy();u.addHandler(t,!0),r.callbacks=u}const a=this.stream(e,r);async function s(){try{const u=await a;for await(const c of u){const d=new So({ops:[{op:"add",path:"/streamed_output/-",value:c}]});await t.writer.write(d)}}finally{await t.writer.close()}}const o=s();try{for await(const u of t)yield u}finally{await o}}streamEvents(e,t,r){let i;if(t.version==="v1")i=this._streamEventsV1(e,t,r);else if(t.version==="v2")i=this._streamEventsV2(e,t,r);else throw new Error('Only versions "v1" and "v2" of the schema are currently supported.');return t.encoding==="text/event-stream"?HJ(i):ti.fromAsyncGenerator(i)}async*_streamEventsV2(e,t,r){var b;const i=new qW({...r,autoClose:!1}),a=Jt(t),s=a.runId??Eo();a.runId=s;const o=a.callbacks;if(o===void 0)a.callbacks=[i];else if(Array.isArray(o))a.callbacks=o.concat(i);else{const w=o.copy();w.addHandler(i,!0),a.callbacks=w}const u=new AbortController,c=this;async function d(){try{let w;t!=null&&t.signal?"any"in AbortSignal?w=AbortSignal.any([u.signal,t.signal]):(w=t.signal,t.signal.addEventListener("abort",()=>{u.abort()},{once:!0})):w=u.signal;const S=await c.stream(e,{...a,signal:w}),T=i.tapOutputIterable(s,S);for await(const C of T)if(u.signal.aborted)break}finally{await i.finish()}}const p=d();let m=!1,y;try{for await(const w of i){if(!m){w.data.input=e,m=!0,y=w.run_id,yield w;continue}w.run_id===y&&w.event.endsWith("_end")&&(b=w.data)!=null&&b.input&&delete w.data.input,yield w}}finally{u.abort(),await p}}async*_streamEventsV1(e,t,r){let i,a=!1;const s=Jt(t),o=s.tags??[],u=s.metadata??{},c=s.runName??this.getName(),d=new o1({...r,autoClose:!1,_schemaFormat:"streaming_events"}),p=new GW({...r}),m=this._streamLog(e,d,s);for await(const b of m){if(i?i=i.concat(b):i=ed.fromRunLogPatch(b),i.state===void 0)throw new Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!a){a=!0;const C={...i.state},A={run_id:C.id,event:`on_${C.type}_start`,name:c,tags:o,metadata:u,data:{input:e}};p.includeEvent(A,C.type)&&(yield A)}const w=b.ops.filter(C=>C.path.startsWith("/logs/")).map(C=>C.path.split("/")[2]),S=[...new Set(w)];for(const C of S){let A,I={};const x=i.state.logs[C];if(x.end_time===void 0?x.streamed_output.length>0?A="stream":A="start":A="end",A==="start")x.inputs!==void 0&&(I.input=x.inputs);else if(A==="end")x.inputs!==void 0&&(I.input=x.inputs),I.output=x.final_output;else if(A==="stream"){const L=x.streamed_output.length;if(L!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${L} instead. Encountered in: "${x.name}"`);I={chunk:x.streamed_output[0]},x.streamed_output=[]}yield{event:`on_${x.type}_${A}`,name:x.name,run_id:x.id,tags:x.tags,metadata:x.metadata,data:I}}const{state:T}=i;if(T.streamed_output.length>0){const C=T.streamed_output.length;if(C!==1)throw new Error(`Expected exactly one chunk of streamed output, got ${C} instead. Encountered in: "${T.name}"`);const A={chunk:T.streamed_output[0]};T.streamed_output=[];const I={event:`on_${T.type}_stream`,run_id:T.id,tags:o,metadata:u,name:c,data:A};p.includeEvent(I,T.type)&&(yield I)}}const y=i==null?void 0:i.state;if(y!==void 0){const b={event:`on_${y.type}_end`,name:c,run_id:y.id,tags:o,metadata:u,data:{output:y.final_output}};p.includeEvent(b,y.type)&&(yield b)}}static isRunnable(e){return YR(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new di({bound:this,config:{},configFactories:[i=>({callbacks:[new RB({config:i,onStart:e,onEnd:t,onError:r})]})]})}asTool(e){return JJ(this,e)}}class di extends qt{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){const t=as(this.config,...e);return as(t,...this.configFactories?await Promise.all(this.configFactories.map(async r=>await r(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new tI({bound:this.bound,kwargs:this.kwargs,config:this.config,maxAttemptNumber:e==null?void 0:e.stopAfterAttempt,...e})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig(Jt(t),this.kwargs))}async batch(e,t,r){const i=Array.isArray(t)?await Promise.all(t.map(async a=>this._mergeConfig(Jt(a),this.kwargs))):await this._mergeConfig(Jt(t),this.kwargs);return this.bound.batch(e,i,r)}async*_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig(Jt(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig(Jt(t),this.kwargs))}async*transform(e,t){yield*this.bound.transform(e,await this._mergeConfig(Jt(t),this.kwargs))}streamEvents(e,t,r){const i=this,a=async function*(){yield*i.bound.streamEvents(e,{...await i._mergeConfig(Jt(t),i.kwargs),version:t.version},r)};return ti.fromAsyncGenerator(a())}static isRunnableBinding(e){return e.bound&&qt.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new di({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[i=>({callbacks:[new RB({config:i,onStart:e,onEnd:t,onError:r})]})]})}}class $p extends qt{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new $p({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _invoke(e,t,r){return this.bound.batch(e,on(t,{callbacks:r==null?void 0:r.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new $p({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}}class tI extends di{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){const i=e>1?`retry:attempt:${e}`:void 0;return on(t,{callbacks:r==null?void 0:r.getChild(i)})}async _invoke(e,t,r){return Fv(i=>super.invoke(e,this._patchConfigForRetry(i,t,r)),{onFailedAttempt:i=>this.onFailedAttempt(i,e),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async _batch(e,t,r,i){const a={};try{await Fv(async s=>{const o=e.map((m,y)=>y).filter(m=>a[m.toString()]===void 0||a[m.toString()]instanceof Error),u=o.map(m=>e[m]),c=o.map(m=>this._patchConfigForRetry(s,t==null?void 0:t[m],r==null?void 0:r[m])),d=await super.batch(u,c,{...i,returnExceptions:!0});let p;for(let m=0;m<d.length;m+=1){const y=d[m],b=o[m];y instanceof Error&&p===void 0&&(p=y,p.input=u[m]),a[b.toString()]=y}if(p)throw p;return d},{onFailedAttempt:s=>this.onFailedAttempt(s,s.input),retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(s){if((i==null?void 0:i.returnExceptions)!==!0)throw s}return Object.keys(a).sort((s,o)=>parseInt(s,10)-parseInt(o,10)).map(s=>a[parseInt(s,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}}class vr extends qt{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"omitSequenceTags",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name,this.omitSequenceTags=e.omitSequenceTags??this.omitSequenceTags}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){var u;const r=Jt(t),i=await $i(r),a=await(i==null?void 0:i.handleChainStart(this.toJSON(),gr(e,"input"),r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;let s=e,o;try{const c=[this.first,...this.middle];for(let d=0;d<c.length;d+=1){const m=c[d].invoke(s,on(r,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${d+1}`)}));s=await $l(m,t==null?void 0:t.signal)}if((u=t==null?void 0:t.signal)!=null&&u.aborted)throw new Error("Aborted");o=await this.last.invoke(s,on(r,{callbacks:a==null?void 0:a.getChild(this.omitSequenceTags?void 0:`seq:step:${this.steps.length}`)}))}catch(c){throw await(a==null?void 0:a.handleChainError(c)),c}return await(a==null?void 0:a.handleChainEnd(gr(o,"output"))),o}async batch(e,t,r){var u;const i=this._getOptionsList(t??{},e.length),a=await Promise.all(i.map($i)),s=await Promise.all(a.map(async(c,d)=>{const p=await(c==null?void 0:c.handleChainStart(this.toJSON(),gr(e[d],"input"),i[d].runId,void 0,void 0,void 0,i[d].runName));return delete i[d].runId,p}));let o=e;try{for(let c=0;c<this.steps.length;c+=1){const p=this.steps[c].batch(o,s.map((m,y)=>{const b=m==null?void 0:m.getChild(this.omitSequenceTags?void 0:`seq:step:${c+1}`);return on(i[y],{callbacks:b})}),r);o=await $l(p,(u=i[0])==null?void 0:u.signal)}}catch(c){throw await Promise.all(s.map(d=>d==null?void 0:d.handleChainError(c))),c}return await Promise.all(s.map(c=>c==null?void 0:c.handleChainEnd(gr(o,"output")))),o}async*_streamIterator(e,t){var p;const r=await $i(t),{runId:i,...a}=t??{},s=await(r==null?void 0:r.handleChainStart(this.toJSON(),gr(e,"input"),i,void 0,void 0,void 0,a==null?void 0:a.runName)),o=[this.first,...this.middle,this.last];let u=!0,c;async function*d(){yield e}try{let m=o[0].transform(d(),on(a,{callbacks:s==null?void 0:s.getChild(this.omitSequenceTags?void 0:"seq:step:1")}));for(let y=1;y<o.length;y+=1)m=await o[y].transform(m,on(a,{callbacks:s==null?void 0:s.getChild(this.omitSequenceTags?void 0:`seq:step:${y+1}`)}));for await(const y of m)if((p=t==null?void 0:t.signal)==null||p.throwIfAborted(),yield y,u)if(c===void 0)c=y;else try{c=fi(c,y)}catch{c=void 0,u=!1}}catch(m){throw await(s==null?void 0:s.handleChainError(m)),m}await(s==null?void 0:s.handleChainEnd(gr(c,"output")))}getGraph(e){const t=new Wv;let r=null;return this.steps.forEach((i,a)=>{const s=i.getGraph(e);a!==0&&s.trimFirstNode(),a!==this.steps.length-1&&s.trimLastNode(),t.extend(s);const o=s.firstNode();if(!o)throw new Error(`Runnable ${i} has no first node`);r&&t.addEdge(r,o),r=s.lastNode()}),t}pipe(e){return vr.isRunnableSequence(e)?new vr({first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}):new vr({first:this.first,middle:[...this.middle,this.last],last:Vr(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&qt.isRunnable(e)}static from([e,...t],r){let i={};return typeof r=="string"?i.name=r:r!==void 0&&(i=r),new vr({...i,first:Vr(e),middle:t.slice(0,-1).map(Vr),last:Vr(t[t.length-1])})}}class Vl extends qt{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={};for(const[t,r]of Object.entries(e.steps))this.steps[t]=Vr(r)}static from(e){return new Vl({steps:e})}async invoke(e,t){const r=Jt(t),i=await $i(r),a=await(i==null?void 0:i.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r==null?void 0:r.runName));delete r.runId;const s={};try{const o=Object.entries(this.steps).map(async([u,c])=>{s[u]=await c.invoke(e,on(r,{callbacks:a==null?void 0:a.getChild(`map:key:${u}`)}))});await $l(Promise.all(o),t==null?void 0:t.signal)}catch(o){throw await(a==null?void 0:a.handleChainError(o)),o}return await(a==null?void 0:a.handleChainEnd(s)),s}async*_transform(e,t,r){const i={...this.steps},a=JR(e,Object.keys(i).length),s=new Map(Object.entries(i).map(([o,u],c)=>{const d=u.transform(a[c],on(r,{callbacks:t==null?void 0:t.getChild(`map:key:${o}`)}));return[o,d.next().then(p=>({key:o,gen:d,result:p}))]}));for(;s.size;){const o=Promise.race(s.values()),{key:u,result:c,gen:d}=await $l(o,r==null?void 0:r.signal);s.delete(u),c.done||(yield{[u]:c.value},s.set(u,d.next().then(p=>({key:u,gen:d,result:p}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=Jt(t),a=new uc({generator:this.transform(r(),i),config:i});return await a.setup,ti.fromAsyncGenerator(a)}}class nI extends qt{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),!HR(e.func))throw new Error("RunnableTraceable requires a function that is wrapped in traceable higher-order function");this.func=e.func}async invoke(e,t){const[r]=this._getOptionsList(t??{},1),i=await $i(r),a=this.func(on(r,{callbacks:i}),e);return $l(a,r==null?void 0:r.signal)}async*_streamIterator(e,t){var a,s;const[r]=this._getOptionsList(t??{},1),i=await this.invoke(e,t);if(d1(i)){for await(const o of i)(a=r==null?void 0:r.signal)==null||a.throwIfAborted(),yield o;return}if(GJ(i)){for(;;){(s=r==null?void 0:r.signal)==null||s.throwIfAborted();const o=i.next();if(o.done)break;yield o.value}return}yield i}static from(e){return new nI({func:e})}}function WJ(n){if(HR(n))throw new Error("RunnableLambda requires a function that is not wrapped in traceable higher-order function. This shouldn't happen.")}class _r extends qt{static lc_name(){return"RunnableLambda"}constructor(e){if(HR(e.func))return nI.from(e.func);super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),WJ(e.func),this.func=e.func}static from(e){return new _r({func:e})}async _invoke(e,t,r){return new Promise((i,a)=>{const s=on(t,{callbacks:r==null?void 0:r.getChild(),recursionLimit:((t==null?void 0:t.recursionLimit)??uS)-1});Di.runWithConfig(Lo(s),async()=>{var o,u;try{let c=await this.func(e,{...s});if(c&&qt.isRunnable(c)){if((t==null?void 0:t.recursionLimit)===0)throw new Error("Recursion limit reached.");c=await c.invoke(e,{...s,recursionLimit:(s.recursionLimit??uS)-1})}else if(d1(c)){let d;for await(const p of h1(s,c))if((o=t==null?void 0:t.signal)==null||o.throwIfAborted(),d===void 0)d=p;else try{d=fi(d,p)}catch{d=p}c=d}else if($D(c)){let d;for(const p of LD(s,c))if((u=t==null?void 0:t.signal)==null||u.throwIfAborted(),d===void 0)d=p;else try{d=fi(d,p)}catch{d=p}c=d}i(c)}catch(c){a(c)}})})}async invoke(e,t){return this._callWithConfig(this._invoke.bind(this),e,t)}async*_transform(e,t,r){var o,u;let i;for await(const c of e)if(i===void 0)i=c;else try{i=fi(i,c)}catch{i=c}const a=on(r,{callbacks:t==null?void 0:t.getChild(),recursionLimit:((r==null?void 0:r.recursionLimit)??uS)-1}),s=await new Promise((c,d)=>{Di.runWithConfig(Lo(a),async()=>{try{const p=await this.func(i,{...a,config:a});c(p)}catch(p){d(p)}})});if(s&&qt.isRunnable(s)){if((r==null?void 0:r.recursionLimit)===0)throw new Error("Recursion limit reached.");const c=await s.stream(i,a);for await(const d of c)yield d}else if(d1(s))for await(const c of h1(a,s))(o=r==null?void 0:r.signal)==null||o.throwIfAborted(),yield c;else if($D(s))for(const c of LD(a,s))(u=r==null?void 0:r.signal)==null||u.throwIfAborted(),yield c;else yield s}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=Jt(t),a=new uc({generator:this.transform(r(),i),config:i});return await a.setup,ti.fromAsyncGenerator(a)}}class KJ extends Vl{}class BB extends qt{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){yield this.runnable;for(const e of this.fallbacks)yield e}async invoke(e,t){const r=Jt(t),i=await $i(r),{runId:a,...s}=r,o=await(i==null?void 0:i.handleChainStart(this.toJSON(),gr(e,"input"),a,void 0,void 0,void 0,s==null?void 0:s.runName)),u=on(s,{callbacks:o==null?void 0:o.getChild()});return await Di.runWithConfig(u,async()=>{var p;let d;for(const m of this.runnables()){(p=r==null?void 0:r.signal)==null||p.throwIfAborted();try{const y=await m.invoke(e,u);return await(o==null?void 0:o.handleChainEnd(gr(y,"output"))),y}catch(y){d===void 0&&(d=y)}}throw d===void 0?new Error("No error stored at end of fallback."):(await(o==null?void 0:o.handleChainError(d)),d)})}async*_streamIterator(e,t){var p;const r=Jt(t),i=await $i(r),{runId:a,...s}=r,o=await(i==null?void 0:i.handleChainStart(this.toJSON(),gr(e,"input"),a,void 0,void 0,void 0,s==null?void 0:s.runName));let u,c;for(const m of this.runnables()){(p=r==null?void 0:r.signal)==null||p.throwIfAborted();const y=on(s,{callbacks:o==null?void 0:o.getChild()});try{const b=await m.stream(e,y);c=h1(y,b);break}catch(b){u===void 0&&(u=b)}}if(c===void 0){const m=u??new Error("No error stored at end of fallback.");throw await(o==null?void 0:o.handleChainError(m)),m}let d;try{for await(const m of c){yield m;try{d=d===void 0?d:fi(d,m)}catch{d=void 0}}}catch(m){throw await(o==null?void 0:o.handleChainError(m)),m}await(o==null?void 0:o.handleChainEnd(gr(d,"output")))}async batch(e,t,r){var u;if(r!=null&&r.returnExceptions)throw new Error("Not implemented.");const i=this._getOptionsList(t??{},e.length),a=await Promise.all(i.map(c=>$i(c))),s=await Promise.all(a.map(async(c,d)=>{const p=await(c==null?void 0:c.handleChainStart(this.toJSON(),gr(e[d],"input"),i[d].runId,void 0,void 0,void 0,i[d].runName));return delete i[d].runId,p}));let o;for(const c of this.runnables()){(u=i[0].signal)==null||u.throwIfAborted();try{const d=await c.batch(e,s.map((p,m)=>on(i[m],{callbacks:p==null?void 0:p.getChild()})),r);return await Promise.all(s.map((p,m)=>p==null?void 0:p.handleChainEnd(gr(d[m],"output")))),d}catch(d){o===void 0&&(o=d)}}throw o?(await Promise.all(s.map(c=>c==null?void 0:c.handleChainError(o))),o):new Error("No error stored at end of fallbacks.")}}function Vr(n){if(typeof n=="function")return new _r({func:n});if(qt.isRunnable(n))return n;if(!Array.isArray(n)&&typeof n=="object"){const e={};for(const[t,r]of Object.entries(n))e[t]=Vr(r);return new Vl({steps:e})}else throw new Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`)}class rI extends qt{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof Vl&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){const r=await this.mapper.invoke(e,t);return{...e,...r}}async*_transform(e,t,r){const i=this.mapper.getStepsKeys(),[a,s]=JR(e),o=this.mapper.transform(s,on(r,{callbacks:t==null?void 0:t.getChild()})),u=o.next();for await(const c of a){if(typeof c!="object"||Array.isArray(c))throw new Error(`RunnableAssign can only be used with objects as input, got ${typeof c}`);const d=Object.fromEntries(Object.entries(c).filter(([p])=>!i.includes(p)));Object.keys(d).length>0&&(yield d)}yield(await u).value;for await(const c of o)yield c}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=Jt(t),a=new uc({generator:this.transform(r(),i),config:i});return await a.setup,ti.fromAsyncGenerator(a)}}class qB extends qt{static lc_name(){return"RunnablePick"}constructor(e){(typeof e=="string"||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if(typeof this.keys=="string")return e[this.keys];{const t=this.keys.map(r=>[r,e[r]]).filter(r=>r[1]!==void 0);return t.length===0?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async*_transform(e){for await(const t of e){const r=await this._pick(t);r!==void 0&&(yield r)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*r(){yield e}const i=Jt(t),a=new uc({generator:this.transform(r(),i),config:i});return await a.setup,ti.fromAsyncGenerator(a)}}class p1 extends di{constructor(e){const t=vr.from([_r.from(async r=>{let i;if(lp(r))try{i=await G_(this.schema,r.args)}catch{throw new Rv("Received tool input did not match expected schema",JSON.stringify(r.args))}else i=r;return i}).withConfig({runName:`${e.name}:parse_input`}),e.bound]).withConfig({runName:e.name});super({bound:t,config:e.config??{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}static lc_name(){return"RunnableToolLike"}}function JJ(n,e){const t=e.name??n.getName(),r=e.description??td(e.schema);return XR(e.schema)?new p1({name:t,description:r,schema:Xe({input:Me()}).transform(i=>i.input),bound:n}):new p1({name:t,description:r,schema:e.schema,bound:n})}class m1 extends Oa{constructor(e){super({...e,content:""}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.id=e.id}_getType(){return"remove"}get _printableFields(){return{...super._printableFields,id:this.id}}}const Kv=(n,e)=>{const t=[...new Set(e==null?void 0:e.map(i=>{if(typeof i=="string")return i;const a=new i({});if(!("getType"in a)||typeof a.getType!="function")throw new Error("Invalid type provided.");return a.getType()}))],r=n.getType();return t.some(i=>i===r)};function YJ(n,e){return Array.isArray(n)?UD(n,e):_r.from(t=>UD(t,n))}function UD(n,e={}){const{includeNames:t,excludeNames:r,includeTypes:i,excludeTypes:a,includeIds:s,excludeIds:o}=e,u=[];for(const c of n)if(!(r&&c.name&&r.includes(c.name))){{if(a&&Kv(c,a))continue;if(o&&c.id&&o.includes(c.id))continue}i||s||t?(t&&c.name&&t.some(d=>d===c.name)||i&&Kv(c,i)||s&&c.id&&s.some(d=>d===c.id))&&u.push(c):u.push(c)}return u}function ZJ(n){return Array.isArray(n)?jD(n):_r.from(jD)}function jD(n){if(!n.length)return[];const e=[];for(const t of n){const r=t,i=e.pop();if(!i)e.push(r);else if(r.getType()==="tool"||r.getType()!==i.getType())e.push(i,r);else{const a=Iv(i),s=Iv(r),o=a.concat(s);typeof a.content=="string"&&typeof s.content=="string"&&(o.content=`${a.content}
${s.content}`),e.push(eY(o))}}return e}function XJ(n,e){if(Array.isArray(n)){const t=n;if(!e)throw new Error("Options parameter is required when providing messages.");return FD(t,e)}else{const t=n;return _r.from(r=>FD(r,t)).withConfig({runName:"trim_messages"})}}async function FD(n,e){const{maxTokens:t,tokenCounter:r,strategy:i="last",allowPartial:a=!1,endOn:s,startOn:o,includeSystem:u=!1,textSplitter:c}=e;if(o&&i==="first")throw new Error("`startOn` should only be specified if `strategy` is 'last'.");if(u&&i==="first")throw new Error("`includeSystem` should only be specified if `strategy` is 'last'.");let d;"getNumTokens"in r?d=async m=>(await Promise.all(m.map(b=>r.getNumTokens(b.content)))).reduce((b,w)=>b+w,0):d=async m=>r(m);let p=zB;if(c&&("splitText"in c?p=c.splitText:p=async m=>c(m)),i==="first")return VB(n,{maxTokens:t,tokenCounter:d,textSplitter:p,partialStrategy:a?"first":void 0,endOn:s});if(i==="last")return QJ(n,{maxTokens:t,tokenCounter:d,textSplitter:p,allowPartial:a,includeSystem:u,startOn:o,endOn:s});throw new Error(`Unrecognized strategy: '${i}'. Must be one of 'first' or 'last'.`)}async function VB(n,e){const{maxTokens:t,tokenCounter:r,textSplitter:i,partialStrategy:a,endOn:s}=e;let o=[...n],u=0;for(let c=0;c<o.length;c+=1){const d=c>0?o.slice(0,-c):o;if(await r(d)<=t){u=o.length-c;break}}if(u<o.length-1&&a){let c=!1;if(Array.isArray(o[u].content)){const d=o[u];if(typeof d.content=="string")throw new Error("Expected content to be an array.");const p=d.content.length,m=a==="last"?[...d.content].reverse():d.content;for(let y=1;y<=p;y+=1){const b=a==="first"?m.slice(0,y):m.slice(-y),w=Object.fromEntries(Object.entries(d).filter(([C])=>C!=="type"&&!C.startsWith("lc_"))),S=iI(d.getType(),{...w,content:b}),T=[...o.slice(0,u),S];if(await r(T)<=t)o=T,u+=1,c=!0;else break}c&&a==="last"&&(d.content=[...m].reverse())}if(!c){const d=o[u];let p;if(Array.isArray(d.content)&&d.content.some(m=>typeof m=="string"||m.type==="text")){const m=d.content.find(y=>y.type==="text"&&y.text);p=m==null?void 0:m.text}else typeof d.content=="string"&&(p=d.content);if(p){const m=await i(p),y=m.length;a==="last"&&m.reverse();for(let b=0;b<y-1;b+=1)if(m.pop(),d.content=m.join(""),await r([...o.slice(0,u),d])<=t){a==="last"&&(d.content=[...m].reverse().join("")),o=[...o.slice(0,u),d],u+=1;break}}}}if(s){const c=Array.isArray(s)?s:[s];for(;u>0&&!Kv(o[u-1],c);)u-=1}return o.slice(0,u)}async function QJ(n,e){var d;const{allowPartial:t=!1,includeSystem:r=!1,endOn:i,startOn:a,...s}=e;let o=n.map(p=>{const m=Object.fromEntries(Object.entries(p).filter(([y])=>y!=="type"&&!y.startsWith("lc_")));return iI(p.getType(),m,Zf(p))});if(i){const p=Array.isArray(i)?i:[i];for(;o.length>0&&!Kv(o[o.length-1],p);)o=o.slice(0,-1)}const u=r&&((d=o[0])==null?void 0:d.getType())==="system";let c=u?o.slice(0,1).concat(o.slice(1).reverse()):o.reverse();return c=await VB(c,{...s,partialStrategy:t?"last":void 0,endOn:a}),u?[c[0],...c.slice(1).reverse()]:c.reverse()}const BD={human:{message:ei,messageChunk:oc},ai:{message:bn,messageChunk:Sn},system:{message:fs,messageChunk:Gs},developer:{message:fs,messageChunk:Gs},tool:{message:ko,messageChunk:fd},function:{message:M_,messageChunk:sc},generic:{message:La,messageChunk:ac},remove:{message:m1,messageChunk:m1}};function iI(n,e,t){var a;let r,i;switch(n){case"human":t?r=new oc(e):i=new ei(e);break;case"ai":if(t){let s={...e};"tool_calls"in s&&(s={...s,tool_call_chunks:(a=s.tool_calls)==null?void 0:a.map(o=>({...o,type:"tool_call_chunk",index:void 0,args:JSON.stringify(o.args)}))}),r=new Sn(s)}else i=new bn(e);break;case"system":t?r=new Gs(e):i=new fs(e);break;case"developer":t?r=new Gs({...e,additional_kwargs:{...e.additional_kwargs,__openai_role__:"developer"}}):i=new fs({...e,additional_kwargs:{...e.additional_kwargs,__openai_role__:"developer"}});break;case"tool":if("tool_call_id"in e)t?r=new fd(e):i=new ko(e);else throw new Error("Can not convert ToolMessage to ToolMessageChunk if 'tool_call_id' field is not defined.");break;case"function":if(t)r=new sc(e);else{if(!e.name)throw new Error("FunctionMessage must have a 'name' field");i=new M_(e)}break;case"generic":if("role"in e)t?r=new ac(e):i=new La(e);else throw new Error("Can not convert ChatMessage to ChatMessageChunk if 'role' field is not defined.");break;default:throw new Error(`Unrecognized message type ${n}`)}if(t&&r)return r;if(i)return i;throw new Error(`Unrecognized message type ${n}`)}function eY(n){const e=n.getType();let t;const r=Object.fromEntries(Object.entries(n).filter(([i])=>!["type","tool_call_chunks"].includes(i)&&!i.startsWith("lc_")));if(e in BD&&(t=iI(e,r)),!t)throw new Error(`Unrecognized message chunk class ${e}. Supported classes are ${Object.keys(BD)}`);return t}function zB(n){const e=n.split(`
`);return Promise.resolve([...e.slice(0,-1).map(t=>`${t}
`),e[e.length-1]])}const tY=Object.freeze(Object.defineProperty({__proto__:null,AIMessage:bn,AIMessageChunk:Sn,BaseMessage:Oa,BaseMessageChunk:ic,ChatMessage:La,ChatMessageChunk:ac,FunctionMessage:M_,FunctionMessageChunk:sc,HumanMessage:ei,HumanMessageChunk:oc,RemoveMessage:m1,SystemMessage:fs,SystemMessageChunk:Gs,ToolMessage:ko,ToolMessageChunk:fd,_isMessageFieldWithRole:BF,_mergeDicts:Qr,_mergeLists:im,_mergeObj:FF,_mergeStatus:jF,coerceMessageLikeToMessage:is,convertToChunk:Iv,convertToOpenAIImageBlock:UF,convertToProviderContentBlock:rm,defaultTextSplitter:zB,filterMessages:YJ,getBufferString:am,isAIMessage:ua,isAIMessageChunk:Cv,isBase64ContentBlock:LF,isBaseMessage:Ln,isBaseMessageChunk:Zf,isChatMessage:LH,isChatMessageChunk:UH,isDataContentBlock:Da,isFunctionMessage:jH,isFunctionMessageChunk:FH,isHumanMessage:BH,isHumanMessageChunk:qH,isIDContentBlock:OH,isOpenAIToolCallArray:kH,isPlainTextContentBlock:xH,isSystemMessage:VH,isSystemMessageChunk:zH,isToolMessage:Pp,isToolMessageChunk:$H,isURLContentBlock:$F,mapChatMessagesToStoredMessages:YH,mapStoredMessageToChatMessage:$R,mapStoredMessagesToChatMessages:JH,mergeContent:rc,mergeMessageRuns:ZJ,parseBase64DataUrl:xl,parseMimeType:VC,trimMessages:XJ},Symbol.toStringTag,{value:"Module"})),nY=({apiKeys:n,activeProvider:e,mcpServers:t,keysLoadedFromStorage:r,langchainAgent:i,activeLLMService:a})=>{const[s,o]=_t.useState([]),[u,c]=_t.useState(""),[d,p]=_t.useState(!1),m=_t.useRef(null),y=_t.useRef(null),b=_t.useCallback(()=>{y.current&&(y.current.scrollTop=y.current.scrollHeight)},[]);_t.useEffect(b,[s,b]);const w=_t.useRef(null),S=t.filter(C=>C.status==="connected").map(C=>C.id||C.url||JSON.stringify(C)).join(",");return _t.useEffect(()=>{if(!r)return;const C=i?"langchain":e;if(w.current!==C){w.current=C;const A=(a==null?void 0:a.isAvailable(n[e]))||!1,I=e.charAt(0).toUpperCase()+e.slice(1);o(i?[{id:"system-init",text:"Langchain agent with MCP tools ready. Type your message below.",sender:"system",timestamp:new Date,provider:void 0}]:A?[{id:"system-init",text:`${I} chat ready. Type your message below.`,sender:"system",timestamp:new Date,provider:e}]:[{id:"system-unavailable",text:`${I} API Key not provided or invalid. Please set it in API Key Management.`,sender:"system",timestamp:new Date,provider:e}])}},[e,n,a,r,i,S]),{messages:s,input:u,setInput:c,isLoading:d,handleSend:async()=>{const C=(a==null?void 0:a.isAvailable(n[e]))||!1;if(!u.trim()||d||!r||!i&&!C&&t.every(B=>B.status!=="connected"))return;const A={id:`user-${Date.now()}`,text:u,sender:"user",timestamp:new Date,provider:e},I=[...s,A];o(I);const x=u;c(""),p(!0);let L="",U=!1,N=!1;try{if(i){const B=I.slice(-20).map(de=>de.sender==="user"&&typeof de.text=="string"&&de.text.trim()!==""?new ei(de.text):de.sender==="bot"&&typeof de.text=="string"&&de.text.trim()!==""?new bn(de.text):null).filter(de=>de!==null),q=await i.invoke({messages:B},{configurable:{thread_id:"chat-thread"}}),J=q==null?void 0:q.messages,V=Array.isArray(J)&&J.length>0?J[J.length-1]:void 0;V&&typeof V=="object"&&"content"in V&&typeof V.content=="string"?L=V.content:(L="Received an unexpected or empty response from the AI agent.",U=!0)}else if(a&&a.isAvailable(n[e]))if(a.generateTextStream){N=!0,o(B=>[...B,{id:`bot-${Date.now()}`,text:"",sender:"bot",timestamp:new Date,provider:e}]);try{await a.generateTextStream(x,n[e],B=>{o(q=>{const J={...q[q.length-1]};return J.text+=B,[...q.slice(0,-1),J]})},()=>{p(!1)},B=>{o(q=>{const J={...q[q.length-1]};return J.text=`Error: ${B}`,J.sender="error",[...q.slice(0,-1),J]}),p(!1),U=!0})}catch(B){console.error(`Streaming chat error with ${e}:`,B),o(q=>{const J={...q[q.length-1]};return J.text=`Error initiating streaming: ${B.message||"Unknown error"}`,J.sender="error",[...q.slice(0,-1),J]}),p(!1),U=!0}}else try{L=await a.generateText(x,n[e]),(L.startsWith("Error from")||L.includes("API is not available")||L.includes("API client could not be initialized")||L.includes("not configured")||L.includes("not fully implemented")||L.includes("placeholder"))&&(U=!0)}catch(B){console.error(`Non-streaming chat error with ${e}:`,B),L=`An unexpected error occurred with ${e}: ${B.message||"Unknown error"}.`,U=!0}else L="No LLM provider configured and no MCP server connected.",U=!0}catch(B){console.error("Overall chat handling error:",B),L=`An unexpected error occurred: ${B.message||"Unknown error"}.`,U=!0}if(!N||U){const B={id:`bot-${Date.now()}`,text:L,sender:U?"error":"bot",timestamp:new Date,provider:i?void 0:e};o(q=>[...q,B]),p(!1)}},messagesEndRef:m,chatContainerRef:y}},rY=({apiKeys:n,activeProvider:e,mcpServers:t,keysLoadedFromStorage:r,langchainAgent:i,activeLLMService:a})=>{const{messages:s,input:o,setInput:u,isLoading:c,handleSend:d,messagesEndRef:p,chatContainerRef:m}=nY({apiKeys:n,activeProvider:e,mcpServers:t,keysLoadedFromStorage:r,langchainAgent:i,activeLLMService:a}),y=(a==null?void 0:a.isAvailable(n[e]))||!1,b=I=>{switch(I){case"user":return"bg-sky-600 text-white self-end rounded-t-xl rounded-bl-xl";case"bot":return"bg-gray-700 text-gray-200 self-start rounded-t-xl rounded-br-xl";case"system":return"bg-transparent text-gray-400 self-center text-xs italic px-2 py-1 text-center";case"error":return"bg-red-700/60 text-red-200 self-start rounded-lg border border-red-600";default:return"bg-gray-600 text-white self-start rounded-lg"}},w=()=>{if(!r)return"Cargando claves API...";if(i)return"Type your message to the Langchain agent...";const I=e.charAt(0).toUpperCase()+e.slice(1);return y?`Type your message to ${I}...`:`${I} API Key not configured`},S=()=>{if(i)return Ae.jsx(BC,{className:"mr-3 text-sky-400 h-6 w-6"});switch(e){case"gemini":return Ae.jsx(MF,{className:"mr-3 text-sky-400 h-6 w-6"});case"openai":return Ae.jsx(NF,{className:"mr-3 text-sky-400 h-6 w-6"});case"claude":return Ae.jsx(kF,{className:"mr-3 text-sky-400 h-6 w-6"});default:return Ae.jsx(BC,{className:"mr-3 text-sky-400 h-6 w-6"})}},T=i?"Langchain Agent":e.charAt(0).toUpperCase()+e.slice(1),C=c||!r||!i&&!y&&t.every(I=>I.status!=="connected"),A=c||!o.trim()||!r||!i&&!y&&t.every(I=>I.status!=="connected");return Ae.jsxs("div",{className:"p-4 sm:p-6 bg-gray-800 rounded-xl shadow-xl flex flex-col h-[80vh] max-h-[900px] min-h-[400px] overflow-hidden",children:[Ae.jsxs("h2",{className:"text-xl sm:text-2xl font-semibold text-sky-400 mb-4 flex items-center",children:[Ae.jsx(S,{})," Chat with ",T]}),r?Ae.jsxs(Ae.Fragment,{children:[!i&&!y&&s.length<=1&&Ae.jsxs("div",{className:"p-3 mb-4 text-center bg-yellow-800/60 text-yellow-300 rounded-lg border border-yellow-700 text-sm",children:[w(),". Chat features disabled."]}),Ae.jsxs("div",{ref:m,className:"flex-grow overflow-y-auto mb-4 p-3 space-y-4 bg-gray-850 rounded-lg border border-gray-700 custom-scrollbar min-h-0",style:{minHeight:0,maxHeight:"100%"},children:[s.map(I=>Ae.jsx("div",{className:`flex ${I.sender==="user"?"justify-end":I.sender==="system"?"justify-center":"justify-start"}`,children:Ae.jsxs("div",{className:`max-w-xs md:max-w-md lg:max-w-lg px-3.5 py-2.5 shadow ${b(I.sender)}`,style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:[Ae.jsx("p",{className:"text-sm leading-relaxed",children:I.sender==="bot"&&I.text===""?Ae.jsx("span",{className:"inline-block animate-pulse text-sky-300",children:"..."}):I.text}),I.sender!=="system"&&Ae.jsx("p",{className:`text-xs mt-1.5 ${I.sender==="user"?"text-sky-200/80":"text-gray-400/80"} text-right`,children:I.timestamp.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})})]})},I.id)),Ae.jsx("div",{ref:p})]}),Ae.jsxs("div",{className:"flex items-center border-t border-gray-700 pt-4",children:[Ae.jsx("input",{type:"text",value:o,onChange:I=>u(I.target.value),onKeyPress:I=>I.key==="Enter"&&!A&&d(),placeholder:w(),className:"flex-grow px-4 py-2.5 bg-gray-700 border border-gray-600 rounded-l-lg text-gray-200 focus:ring-1 focus:ring-sky-500 focus:border-sky-500 transition-colors disabled:opacity-60",disabled:C}),Ae.jsx("button",{onClick:d,disabled:A,className:"bg-sky-600 hover:bg-sky-700 text-white font-semibold py-2.5 px-5 sm:px-6 rounded-r-lg transition duration-150 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-opacity-75 disabled:opacity-60 disabled:cursor-not-allowed flex items-center justify-center min-w-[80px] sm:min-w-[100px]",children:c?Ae.jsx(Uf,{className:"w-5 h-5 text-white"}):"Send"})]})]}):Ae.jsxs("div",{className:"flex items-center justify-center h-full",children:[Ae.jsx(Uf,{className:"w-6 h-6 text-sky-400 mr-2"}),Ae.jsx("span",{className:"text-gray-300",children:"Cargando claves API..."})]})]})};/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var iY=typeof window=="object"?window:{},Ut="0123456789abcdef".split(""),aY=[-2147483648,8388608,32768,128],Ka=[24,16,8,0],Ar=[];function hs(n){n?(Ar[0]=Ar[16]=Ar[1]=Ar[2]=Ar[3]=Ar[4]=Ar[5]=Ar[6]=Ar[7]=Ar[8]=Ar[9]=Ar[10]=Ar[11]=Ar[12]=Ar[13]=Ar[14]=Ar[15]=0,this.blocks=Ar):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}hs.prototype.update=function(n){if(!this.finalized){var e=typeof n!="string";e&&n.constructor===iY.ArrayBuffer&&(n=new Uint8Array(n));for(var t,r=0,i,a=n.length||0,s=this.blocks;r<a;){if(this.hashed&&(this.hashed=!1,s[0]=this.block,s[16]=s[1]=s[2]=s[3]=s[4]=s[5]=s[6]=s[7]=s[8]=s[9]=s[10]=s[11]=s[12]=s[13]=s[14]=s[15]=0),e)for(i=this.start;r<a&&i<64;++r)s[i>>2]|=n[r]<<Ka[i++&3];else for(i=this.start;r<a&&i<64;++r)t=n.charCodeAt(r),t<128?s[i>>2]|=t<<Ka[i++&3]:t<2048?(s[i>>2]|=(192|t>>6)<<Ka[i++&3],s[i>>2]|=(128|t&63)<<Ka[i++&3]):t<55296||t>=57344?(s[i>>2]|=(224|t>>12)<<Ka[i++&3],s[i>>2]|=(128|t>>6&63)<<Ka[i++&3],s[i>>2]|=(128|t&63)<<Ka[i++&3]):(t=65536+((t&1023)<<10|n.charCodeAt(++r)&1023),s[i>>2]|=(240|t>>18)<<Ka[i++&3],s[i>>2]|=(128|t>>12&63)<<Ka[i++&3],s[i>>2]|=(128|t>>6&63)<<Ka[i++&3],s[i>>2]|=(128|t&63)<<Ka[i++&3]);this.lastByteIndex=i,this.bytes+=i-this.start,i>=64?(this.block=s[16],this.start=i-64,this.hash(),this.hashed=!0):this.start=i}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};hs.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var n=this.blocks,e=this.lastByteIndex;n[16]=this.block,n[e>>2]|=aY[e&3],this.block=n[16],e>=56&&(this.hashed||this.hash(),n[0]=this.block,n[16]=n[1]=n[2]=n[3]=n[4]=n[5]=n[6]=n[7]=n[8]=n[9]=n[10]=n[11]=n[12]=n[13]=n[14]=n[15]=0),n[14]=this.hBytes<<3|this.bytes>>>29,n[15]=this.bytes<<3,this.hash()}};hs.prototype.hash=function(){var n=this.h0,e=this.h1,t=this.h2,r=this.h3,i=this.h4,a,s,o,u=this.blocks;for(s=16;s<80;++s)o=u[s-3]^u[s-8]^u[s-14]^u[s-16],u[s]=o<<1|o>>>31;for(s=0;s<20;s+=5)a=e&t|~e&r,o=n<<5|n>>>27,i=o+a+i+1518500249+u[s]<<0,e=e<<30|e>>>2,a=n&e|~n&t,o=i<<5|i>>>27,r=o+a+r+1518500249+u[s+1]<<0,n=n<<30|n>>>2,a=i&n|~i&e,o=r<<5|r>>>27,t=o+a+t+1518500249+u[s+2]<<0,i=i<<30|i>>>2,a=r&i|~r&n,o=t<<5|t>>>27,e=o+a+e+1518500249+u[s+3]<<0,r=r<<30|r>>>2,a=t&r|~t&i,o=e<<5|e>>>27,n=o+a+n+1518500249+u[s+4]<<0,t=t<<30|t>>>2;for(;s<40;s+=5)a=e^t^r,o=n<<5|n>>>27,i=o+a+i+1859775393+u[s]<<0,e=e<<30|e>>>2,a=n^e^t,o=i<<5|i>>>27,r=o+a+r+1859775393+u[s+1]<<0,n=n<<30|n>>>2,a=i^n^e,o=r<<5|r>>>27,t=o+a+t+1859775393+u[s+2]<<0,i=i<<30|i>>>2,a=r^i^n,o=t<<5|t>>>27,e=o+a+e+1859775393+u[s+3]<<0,r=r<<30|r>>>2,a=t^r^i,o=e<<5|e>>>27,n=o+a+n+1859775393+u[s+4]<<0,t=t<<30|t>>>2;for(;s<60;s+=5)a=e&t|e&r|t&r,o=n<<5|n>>>27,i=o+a+i-1894007588+u[s]<<0,e=e<<30|e>>>2,a=n&e|n&t|e&t,o=i<<5|i>>>27,r=o+a+r-1894007588+u[s+1]<<0,n=n<<30|n>>>2,a=i&n|i&e|n&e,o=r<<5|r>>>27,t=o+a+t-1894007588+u[s+2]<<0,i=i<<30|i>>>2,a=r&i|r&n|i&n,o=t<<5|t>>>27,e=o+a+e-1894007588+u[s+3]<<0,r=r<<30|r>>>2,a=t&r|t&i|r&i,o=e<<5|e>>>27,n=o+a+n-1894007588+u[s+4]<<0,t=t<<30|t>>>2;for(;s<80;s+=5)a=e^t^r,o=n<<5|n>>>27,i=o+a+i-899497514+u[s]<<0,e=e<<30|e>>>2,a=n^e^t,o=i<<5|i>>>27,r=o+a+r-899497514+u[s+1]<<0,n=n<<30|n>>>2,a=i^n^e,o=r<<5|r>>>27,t=o+a+t-899497514+u[s+2]<<0,i=i<<30|i>>>2,a=r^i^n,o=t<<5|t>>>27,e=o+a+e-899497514+u[s+3]<<0,r=r<<30|r>>>2,a=t^r^i,o=e<<5|e>>>27,n=o+a+n-899497514+u[s+4]<<0,t=t<<30|t>>>2;this.h0=this.h0+n<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+r<<0,this.h4=this.h4+i<<0};hs.prototype.hex=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,i=this.h4;return Ut[n>>28&15]+Ut[n>>24&15]+Ut[n>>20&15]+Ut[n>>16&15]+Ut[n>>12&15]+Ut[n>>8&15]+Ut[n>>4&15]+Ut[n&15]+Ut[e>>28&15]+Ut[e>>24&15]+Ut[e>>20&15]+Ut[e>>16&15]+Ut[e>>12&15]+Ut[e>>8&15]+Ut[e>>4&15]+Ut[e&15]+Ut[t>>28&15]+Ut[t>>24&15]+Ut[t>>20&15]+Ut[t>>16&15]+Ut[t>>12&15]+Ut[t>>8&15]+Ut[t>>4&15]+Ut[t&15]+Ut[r>>28&15]+Ut[r>>24&15]+Ut[r>>20&15]+Ut[r>>16&15]+Ut[r>>12&15]+Ut[r>>8&15]+Ut[r>>4&15]+Ut[r&15]+Ut[i>>28&15]+Ut[i>>24&15]+Ut[i>>20&15]+Ut[i>>16&15]+Ut[i>>12&15]+Ut[i>>8&15]+Ut[i>>4&15]+Ut[i&15]};hs.prototype.toString=hs.prototype.hex;hs.prototype.digest=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,i=this.h4;return[n>>24&255,n>>16&255,n>>8&255,n&255,e>>24&255,e>>16&255,e>>8&255,e&255,t>>24&255,t>>16&255,t>>8&255,t&255,r>>24&255,r>>16&255,r>>8&255,r&255,i>>24&255,i>>16&255,i>>8&255,i&255]};hs.prototype.array=hs.prototype.digest;hs.prototype.arrayBuffer=function(){this.finalize();var n=new ArrayBuffer(20),e=new DataView(n);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),n};let qD=!1;const HB=n=>(qD||(console.warn(["The default method for hashing keys is insecure and will be replaced in a future version,","but hasn't been replaced yet as to not break existing caches. It's recommended that you use","a more secure hashing algorithm to avoid cache poisoning.","","See this page for more information:","|","└> https://js.langchain.com/docs/troubleshooting/warnings/insecure-cache-algorithm"].join(`
`)),qD=!0),new hs(!0).update(n).hex());/**
 * [js-sha256]{@link https://github.com/emn178/js-sha256}
 *
 * @version 0.11.1
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2025
 * @license MIT
 */var lt="0123456789abcdef".split(""),sY=[-2147483648,8388608,32768,128],Ja=[24,16,8,0],ry=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],Cr=[];function ps(n,e){e?(Cr[0]=Cr[16]=Cr[1]=Cr[2]=Cr[3]=Cr[4]=Cr[5]=Cr[6]=Cr[7]=Cr[8]=Cr[9]=Cr[10]=Cr[11]=Cr[12]=Cr[13]=Cr[14]=Cr[15]=0,this.blocks=Cr):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=n}ps.prototype.update=function(n){if(!this.finalized){var e,t=typeof n;if(t!=="string"){if(t==="object"){if(n===null)throw new Error(ERROR);if(ARRAY_BUFFER&&n.constructor===ArrayBuffer)n=new Uint8Array(n);else if(!Array.isArray(n)&&(!ARRAY_BUFFER||!ArrayBuffer.isView(n)))throw new Error(ERROR)}else throw new Error(ERROR);e=!0}for(var r,i=0,a,s=n.length,o=this.blocks;i<s;){if(this.hashed&&(this.hashed=!1,o[0]=this.block,this.block=o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0),e)for(a=this.start;i<s&&a<64;++i)o[a>>>2]|=n[i]<<Ja[a++&3];else for(a=this.start;i<s&&a<64;++i)r=n.charCodeAt(i),r<128?o[a>>>2]|=r<<Ja[a++&3]:r<2048?(o[a>>>2]|=(192|r>>>6)<<Ja[a++&3],o[a>>>2]|=(128|r&63)<<Ja[a++&3]):r<55296||r>=57344?(o[a>>>2]|=(224|r>>>12)<<Ja[a++&3],o[a>>>2]|=(128|r>>>6&63)<<Ja[a++&3],o[a>>>2]|=(128|r&63)<<Ja[a++&3]):(r=65536+((r&1023)<<10|n.charCodeAt(++i)&1023),o[a>>>2]|=(240|r>>>18)<<Ja[a++&3],o[a>>>2]|=(128|r>>>12&63)<<Ja[a++&3],o[a>>>2]|=(128|r>>>6&63)<<Ja[a++&3],o[a>>>2]|=(128|r&63)<<Ja[a++&3]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.block=o[16],this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}};ps.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var n=this.blocks,e=this.lastByteIndex;n[16]=this.block,n[e>>>2]|=sY[e&3],this.block=n[16],e>=56&&(this.hashed||this.hash(),n[0]=this.block,n[16]=n[1]=n[2]=n[3]=n[4]=n[5]=n[6]=n[7]=n[8]=n[9]=n[10]=n[11]=n[12]=n[13]=n[14]=n[15]=0),n[14]=this.hBytes<<3|this.bytes>>>29,n[15]=this.bytes<<3,this.hash()}};ps.prototype.hash=function(){var n=this.h0,e=this.h1,t=this.h2,r=this.h3,i=this.h4,a=this.h5,s=this.h6,o=this.h7,u=this.blocks,c,d,p,m,y,b,w,S,T,C,A;for(c=16;c<64;++c)y=u[c-15],d=(y>>>7|y<<25)^(y>>>18|y<<14)^y>>>3,y=u[c-2],p=(y>>>17|y<<15)^(y>>>19|y<<13)^y>>>10,u[c]=u[c-16]+d+u[c-7]+p<<0;for(A=e&t,c=0;c<64;c+=4)this.first?(this.is224?(S=300032,y=u[0]-1413257819,o=y-150054599<<0,r=y+24177077<<0):(S=704751109,y=u[0]-210244248,o=y-1521486534<<0,r=y+143694565<<0),this.first=!1):(d=(n>>>2|n<<30)^(n>>>13|n<<19)^(n>>>22|n<<10),p=(i>>>6|i<<26)^(i>>>11|i<<21)^(i>>>25|i<<7),S=n&e,m=S^n&t^A,w=i&a^~i&s,y=o+p+w+ry[c]+u[c],b=d+m,o=r+y<<0,r=y+b<<0),d=(r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10),p=(o>>>6|o<<26)^(o>>>11|o<<21)^(o>>>25|o<<7),T=r&n,m=T^r&e^S,w=s&o^~s&i,y=a+p+w+ry[c+1]+u[c+1],b=d+m,s=t+y<<0,t=y+b<<0,d=(t>>>2|t<<30)^(t>>>13|t<<19)^(t>>>22|t<<10),p=(s>>>6|s<<26)^(s>>>11|s<<21)^(s>>>25|s<<7),C=t&r,m=C^t&n^T,w=a&s^~a&o,y=i+p+w+ry[c+2]+u[c+2],b=d+m,a=e+y<<0,e=y+b<<0,d=(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10),p=(a>>>6|a<<26)^(a>>>11|a<<21)^(a>>>25|a<<7),A=e&t,m=A^e&r^C,w=a&s^~a&o,y=i+p+w+ry[c+3]+u[c+3],b=d+m,i=n+y<<0,n=y+b<<0,this.chromeBugWorkAround=!0;this.h0=this.h0+n<<0,this.h1=this.h1+e<<0,this.h2=this.h2+t<<0,this.h3=this.h3+r<<0,this.h4=this.h4+i<<0,this.h5=this.h5+a<<0,this.h6=this.h6+s<<0,this.h7=this.h7+o<<0};ps.prototype.hex=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,i=this.h4,a=this.h5,s=this.h6,o=this.h7,u=lt[n>>>28&15]+lt[n>>>24&15]+lt[n>>>20&15]+lt[n>>>16&15]+lt[n>>>12&15]+lt[n>>>8&15]+lt[n>>>4&15]+lt[n&15]+lt[e>>>28&15]+lt[e>>>24&15]+lt[e>>>20&15]+lt[e>>>16&15]+lt[e>>>12&15]+lt[e>>>8&15]+lt[e>>>4&15]+lt[e&15]+lt[t>>>28&15]+lt[t>>>24&15]+lt[t>>>20&15]+lt[t>>>16&15]+lt[t>>>12&15]+lt[t>>>8&15]+lt[t>>>4&15]+lt[t&15]+lt[r>>>28&15]+lt[r>>>24&15]+lt[r>>>20&15]+lt[r>>>16&15]+lt[r>>>12&15]+lt[r>>>8&15]+lt[r>>>4&15]+lt[r&15]+lt[i>>>28&15]+lt[i>>>24&15]+lt[i>>>20&15]+lt[i>>>16&15]+lt[i>>>12&15]+lt[i>>>8&15]+lt[i>>>4&15]+lt[i&15]+lt[a>>>28&15]+lt[a>>>24&15]+lt[a>>>20&15]+lt[a>>>16&15]+lt[a>>>12&15]+lt[a>>>8&15]+lt[a>>>4&15]+lt[a&15]+lt[s>>>28&15]+lt[s>>>24&15]+lt[s>>>20&15]+lt[s>>>16&15]+lt[s>>>12&15]+lt[s>>>8&15]+lt[s>>>4&15]+lt[s&15];return this.is224||(u+=lt[o>>>28&15]+lt[o>>>24&15]+lt[o>>>20&15]+lt[o>>>16&15]+lt[o>>>12&15]+lt[o>>>8&15]+lt[o>>>4&15]+lt[o&15]),u};ps.prototype.toString=ps.prototype.hex;ps.prototype.digest=function(){this.finalize();var n=this.h0,e=this.h1,t=this.h2,r=this.h3,i=this.h4,a=this.h5,s=this.h6,o=this.h7,u=[n>>>24&255,n>>>16&255,n>>>8&255,n&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255,r>>>24&255,r>>>16&255,r>>>8&255,r&255,i>>>24&255,i>>>16&255,i>>>8&255,i&255,a>>>24&255,a>>>16&255,a>>>8&255,a&255,s>>>24&255,s>>>16&255,s>>>8&255,s&255];return this.is224||u.push(o>>>24&255,o>>>16&255,o>>>8&255,o&255),u};ps.prototype.array=ps.prototype.digest;ps.prototype.arrayBuffer=function(){this.finalize();var n=new ArrayBuffer(this.is224?28:32),e=new DataView(n);return e.setUint32(0,this.h0),e.setUint32(4,this.h1),e.setUint32(8,this.h2),e.setUint32(12,this.h3),e.setUint32(16,this.h4),e.setUint32(20,this.h5),e.setUint32(24,this.h6),this.is224||e.setUint32(28,this.h7),n};const oY=(...n)=>new ps(!1,!0).update(n.join("")).hex(),lY=Object.freeze(Object.defineProperty({__proto__:null,insecureHash:HB,sha256:oY},Symbol.toStringTag,{value:"Module"})),GB=(...n)=>HB(n.join("_"));function uY(n){return n.message!==void 0?{text:n.text,message:$R(n.message)}:{text:n.text}}function cY(n){const e={text:n.text};return n.message!==void 0&&(e.message=n.message.toDict()),e}let WB=class{constructor(){Object.defineProperty(this,"keyEncoder",{enumerable:!0,configurable:!0,writable:!0,value:GB})}makeDefaultKeyEncoder(e){this.keyEncoder=e}};const fY=new Map;class K_ extends WB{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(this.keyEncoder(e,t))??null)}async update(e,t,r){this.cache.set(this.keyEncoder(e,t),r)}static global(){return new K_(fY)}}const dY=Object.freeze(Object.defineProperty({__proto__:null,BaseCache:WB,InMemoryCache:K_,deserializeStoredGeneration:uY,getCacheKey:GB,serializeGeneration:cY},Symbol.toStringTag,{value:"Module"}));class J_ extends la{}class aI extends J_{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new ei(this.value)]}}class sI extends J_{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return am(this.messages)}toChatMessages(){return this.messages}}class KB extends J_{static lc_name(){return"ImagePromptValue"}constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"imageUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new ei({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}}const hY=Object.freeze(Object.defineProperty({__proto__:null,BasePromptValue:J_,ChatPromptValue:sI,ImagePromptValue:KB,StringPromptValue:aI},Symbol.toStringTag,{value:"Module"}));var Ah={},VD;function pY(){if(VD)return Ah;VD=1,Ah.byteLength=o,Ah.toByteArray=c,Ah.fromByteArray=m;for(var n=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,a=r.length;i<a;++i)n[i]=r[i],e[r.charCodeAt(i)]=i;e[45]=62,e[95]=63;function s(y){var b=y.length;if(b%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var w=y.indexOf("=");w===-1&&(w=b);var S=w===b?0:4-w%4;return[w,S]}function o(y){var b=s(y),w=b[0],S=b[1];return(w+S)*3/4-S}function u(y,b,w){return(b+w)*3/4-w}function c(y){var b,w=s(y),S=w[0],T=w[1],C=new t(u(y,S,T)),A=0,I=T>0?S-4:S,x;for(x=0;x<I;x+=4)b=e[y.charCodeAt(x)]<<18|e[y.charCodeAt(x+1)]<<12|e[y.charCodeAt(x+2)]<<6|e[y.charCodeAt(x+3)],C[A++]=b>>16&255,C[A++]=b>>8&255,C[A++]=b&255;return T===2&&(b=e[y.charCodeAt(x)]<<2|e[y.charCodeAt(x+1)]>>4,C[A++]=b&255),T===1&&(b=e[y.charCodeAt(x)]<<10|e[y.charCodeAt(x+1)]<<4|e[y.charCodeAt(x+2)]>>2,C[A++]=b>>8&255,C[A++]=b&255),C}function d(y){return n[y>>18&63]+n[y>>12&63]+n[y>>6&63]+n[y&63]}function p(y,b,w){for(var S,T=[],C=b;C<w;C+=3)S=(y[C]<<16&16711680)+(y[C+1]<<8&65280)+(y[C+2]&255),T.push(d(S));return T.join("")}function m(y){for(var b,w=y.length,S=w%3,T=[],C=16383,A=0,I=w-S;A<I;A+=C)T.push(p(y,A,A+C>I?I:A+C));return S===1?(b=y[w-1],T.push(n[b>>2]+n[b<<4&63]+"==")):S===2&&(b=(y[w-2]<<8)+y[w-1],T.push(n[b>>10]+n[b>>4&63]+n[b<<2&63]+"=")),T.join("")}return Ah}var mY=pY();const gY=Js(mY);var yY=Object.defineProperty,vY=(n,e,t)=>e in n?yY(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,_Y=(n,e,t)=>(vY(n,e+"",t),t);function bY(n,e){let t=Array.from({length:n.length},(r,i)=>({start:i,end:i+1}));for(;t.length>1;){let r=null;for(let i=0;i<t.length-1;i++){const a=n.slice(t[i].start,t[i+1].end),s=e.get(a.join(","));s!=null&&(r==null||s<r[0])&&(r=[s,i])}if(r!=null){const i=r[1];t[i]={start:t[i].start,end:t[i+1].end},t.splice(i+1,1)}else break}return t}function wY(n,e){return n.length===1?[e.get(n.join(","))]:bY(n,e).map(t=>e.get(n.slice(t.start,t.end).join(","))).filter(t=>t!=null)}function EY(n){return n.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var g1=class{constructor(n,e){Kr(this,"specialTokens");Kr(this,"inverseSpecialTokens");Kr(this,"patStr");Kr(this,"textEncoder",new TextEncoder);Kr(this,"textDecoder",new TextDecoder("utf-8"));Kr(this,"rankMap",new Map);Kr(this,"textMap",new Map);this.patStr=n.pat_str;const t=n.bpe_ranks.split(`
`).filter(Boolean).reduce((r,i)=>{const[a,s,...o]=i.split(" "),u=Number.parseInt(s,10);return o.forEach((c,d)=>r[c]=u+d),r},{});for(const[r,i]of Object.entries(t)){const a=gY.toByteArray(r);this.rankMap.set(a.join(","),i),this.textMap.set(i,a)}this.specialTokens={...n.special_tokens,...e},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((r,[i,a])=>(r[a]=this.textEncoder.encode(i),r),{})}encode(n,e=[],t="all"){const r=new RegExp(this.patStr,"ug"),i=g1.specialTokenRegex(Object.keys(this.specialTokens)),a=[],s=new Set(e==="all"?Object.keys(this.specialTokens):e),o=new Set(t==="all"?Object.keys(this.specialTokens).filter(c=>!s.has(c)):t);if(o.size>0){const c=g1.specialTokenRegex([...o]),d=n.match(c);if(d!=null)throw new Error(`The text contains a special token that is not allowed: ${d[0]}`)}let u=0;for(;;){let c=null,d=u;for(;i.lastIndex=d,c=i.exec(n),!(c==null||s.has(c[0]));)d=c.index+1;const p=(c==null?void 0:c.index)??n.length;for(const y of n.substring(u,p).matchAll(r)){const b=this.textEncoder.encode(y[0]),w=this.rankMap.get(b.join(","));if(w!=null){a.push(w);continue}a.push(...wY(b,this.rankMap))}if(c==null)break;let m=this.specialTokens[c[0]];a.push(m),u=c.index+c[0].length}return a}decode(n){const e=[];let t=0;for(let a=0;a<n.length;++a){const s=n[a],o=this.textMap.get(s)??this.inverseSpecialTokens[s];o!=null&&(e.push(o),t+=o.length)}const r=new Uint8Array(t);let i=0;for(const a of e)r.set(a,i),i+=a.length;return this.textDecoder.decode(r)}},JB=g1;_Y(JB,"specialTokenRegex",n=>new RegExp(n.map(e=>EY(e)).join("|"),"g"));function SY(n){switch(n){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":case"text-embedding-3-small":case"text-embedding-3-large":return"cl100k_base";case"gpt-4o":case"gpt-4o-2024-05-13":case"gpt-4o-2024-08-06":case"gpt-4o-2024-11-20":case"gpt-4o-mini-2024-07-18":case"gpt-4o-mini":case"gpt-4o-search-preview":case"gpt-4o-search-preview-2025-03-11":case"gpt-4o-mini-search-preview":case"gpt-4o-mini-search-preview-2025-03-11":case"gpt-4o-audio-preview":case"gpt-4o-audio-preview-2024-12-17":case"gpt-4o-audio-preview-2024-10-01":case"gpt-4o-mini-audio-preview":case"gpt-4o-mini-audio-preview-2024-12-17":case"o1":case"o1-2024-12-17":case"o1-mini":case"o1-mini-2024-09-12":case"o1-preview":case"o1-preview-2024-09-12":case"o1-pro":case"o1-pro-2025-03-19":case"o3":case"o3-2025-04-16":case"o3-mini":case"o3-mini-2025-01-31":case"o4-mini":case"o4-mini-2025-04-16":case"chatgpt-4o-latest":case"gpt-4o-realtime":case"gpt-4o-realtime-preview-2024-10-01":case"gpt-4o-realtime-preview-2024-12-17":case"gpt-4o-mini-realtime-preview":case"gpt-4o-mini-realtime-preview-2024-12-17":case"gpt-4.1":case"gpt-4.1-2025-04-14":case"gpt-4.1-mini":case"gpt-4.1-mini-2025-04-14":case"gpt-4.1-nano":case"gpt-4.1-nano-2025-04-14":case"gpt-4.5-preview":case"gpt-4.5-preview-2025-02-27":return"o200k_base";default:throw new Error("Unknown model")}}const iy={},TY=new um({});async function YB(n){return n in iy||(iy[n]=TY.fetch(`https://tiktoken.pages.dev/js/${n}.json`).then(e=>e.json()).then(e=>new JB(e)).catch(e=>{throw delete iy[n],e})),await iy[n]}async function oI(n){return YB(SY(n))}const AY=Object.freeze(Object.defineProperty({__proto__:null,encodingForModel:oI,getEncoding:YB},Symbol.toStringTag,{value:"Module"})),Y_=n=>n.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":n.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":n.startsWith("gpt-4-32k")?"gpt-4-32k":n.startsWith("gpt-4-")?"gpt-4":n.startsWith("gpt-4o")?"gpt-4o":n,CY=n=>{switch(n){case"text-embedding-ada-002":return 8191;default:return 2046}},ZB=n=>{switch(Y_(n)){case"gpt-3.5-turbo-16k":return 16384;case"gpt-3.5-turbo":return 4096;case"gpt-4-32k":return 32768;case"gpt-4":return 8192;case"text-davinci-003":return 4097;case"text-curie-001":return 2048;case"text-babbage-001":return 2048;case"text-ada-001":return 2048;case"code-davinci-002":return 8e3;case"code-cushman-001":return 2048;default:return 4097}};function pd(n){return typeof n!="object"||!n?!1:!!("type"in n&&n.type==="function"&&"function"in n&&typeof n.function=="object"&&n.function&&"name"in n.function&&"parameters"in n.function)}const RY=async({prompt:n,modelName:e})=>{let t;try{t=(await oI(Y_(e))).encode(n).length}catch{console.warn("Failed to calculate number of tokens, falling back to approximate count"),t=Math.ceil(n.length/4)}return ZB(e)-t},IY=()=>!1;class lI extends qt{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??IY(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}}class uI extends lI{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){const{cache:i,...a}=r;super({callbacks:e??t,...a}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),typeof i=="object"?this.cache=i:i?this.cache=K_.global():this.cache=void 0,this.caller=new um(r??{})}async getNumTokens(e){let t;typeof e=="string"?t=e:t=e.map(i=>typeof i=="string"?i:i.type==="text"&&"text"in i?i.text:"").join("");let r=Math.ceil(t.length/4);if(!this._encoding)try{this._encoding=await oI("modelName"in this?Y_(this.modelName):"gpt2")}catch(i){console.warn("Failed to calculate number of tokens, falling back to approximate count",i)}if(this._encoding)try{r=this._encoding.encode(t).length}catch(i){console.warn("Failed to calculate number of tokens, falling back to approximate count",i)}return r}static _convertInputToPromptValue(e){return typeof e=="string"?new aI(e):Array.isArray(e)?new sI(e.map(is)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall({config:e,...t}){const r={...this._identifyingParams(),...t,_type:this._llmType(),_model:this._modelType()};return Object.entries(r).filter(([s,o])=>o!==void 0).map(([s,o])=>`${s}:${JSON.stringify(o)}`).sort().join(",")}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw new Error("Use .toJSON() instead")}}const PY=Object.freeze(Object.defineProperty({__proto__:null,BaseLangChain:lI,BaseLanguageModel:uI,calculateMaxTokens:RY,getEmbeddingContextSize:CY,getModelContextSize:ZB,getModelNameForTiktoken:Y_,isOpenAITool:pd},Symbol.toStringTag,{value:"Module"}));function cI(n){return n!==void 0&&Array.isArray(n.lc_namespace)}function fI(n){return n!==void 0&&qt.isRunnable(n)&&"lc_name"in n.constructor&&typeof n.constructor.lc_name=="function"&&n.constructor.lc_name()==="RunnableToolLike"}function dI(n){return!!n&&typeof n=="object"&&"name"in n&&"schema"in n&&(Pi(n.schema)||n.schema!=null&&typeof n.schema=="object"&&"type"in n.schema&&typeof n.schema.type=="string"&&["null","boolean","object","array","number","string"].includes(n.schema.type))}function cc(n){return dI(n)||fI(n)||cI(n)}class Z_ extends lI{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"verboseParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"content"}),this.verboseParsingErrors=(e==null?void 0:e.verboseParsingErrors)??this.verboseParsingErrors,this.responseFormat=(e==null?void 0:e.responseFormat)??this.responseFormat}async invoke(e,t){let r,i=Jt(t);return lp(e)?(r=e.args,i={...i,toolCall:e}):r=e,this.call(r,i)}async call(e,t,r){const i=lp(e)?e.args:e;let a;if(Pi(this.schema))try{a=await G_(this.schema,i)}catch(b){let w="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(w=`${w}
Details: ${b.message}`),new Rv(w,JSON.stringify(e))}else{const b=On(i,this.schema);if(!b.valid){let w="Received tool input did not match expected schema";throw this.verboseParsingErrors&&(w=`${w}
Details: ${b.errors.map(S=>`${S.keywordLocation}: ${S.error}`).join(`
`)}`),new Rv(w,JSON.stringify(e))}a=i}const s=om(t),o=Jn.configure(s.callbacks,this.callbacks,s.tags||r,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),u=await(o==null?void 0:o.handleToolStart(this.toJSON(),typeof e=="string"?e:JSON.stringify(e),s.runId,void 0,void 0,void 0,s.runName));delete s.runId;let c;try{c=await this._call(a,u,s)}catch(b){throw await(u==null?void 0:u.handleToolError(b)),b}let d,p;if(this.responseFormat==="content_and_artifact")if(Array.isArray(c)&&c.length===2)[d,p]=c;else throw new Error(`Tool response format is "content_and_artifact" but the output was not a two-tuple.
Result: ${JSON.stringify(c)}`);else d=c;let m;lp(e)&&(m=e.id),!m&&HH(s)&&(m=s.toolCall.id);const y=NY({content:d,artifact:p,toolCallId:m,name:this.name});return await(u==null?void 0:u.handleToolEnd(y)),y}}class XB extends Z_{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:Xe({input:Me().optional()}).transform(t=>t.input)})}call(e,t){const r=typeof e=="string"||e==null?{input:e}:e;return super.call(r,t)}}class QB extends XB{static lc_name(){return"DynamicTool"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect}async call(e,t){const r=om(t);return r.runName===void 0&&(r.runName=this.name),super.call(e,r)}async _call(e,t,r){return this.func(e,t,r)}}class hI extends Z_{static lc_name(){return"DynamicStructuredTool"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect,this.schema=e.schema}async call(e,t,r){const i=om(t);return i.runName===void 0&&(i.runName=this.name),super.call(e,i,r)}_call(e,t,r){return this.func(e,t,r)}}class xY{getTools(){return this.tools}}function OY(n,e){var s;const t=XR(e.schema),r=fp(e.schema);if(!e.schema||t||r)return new QB({...e,description:e.description??((s=e.schema)==null?void 0:s.description)??`${e.name} tool`,func:async(o,u,c)=>new Promise((d,p)=>{const m=on(c,{callbacks:u==null?void 0:u.getChild()});Di.runWithConfig(Lo(m),async()=>{try{d(n(o,m))}catch(y){p(y)}})})});const i=e.schema,a=e.description??e.schema.description??`${e.name} tool`;return new hI({...e,description:a,schema:i,func:async(o,u,c)=>new Promise((d,p)=>{const m=on(c,{callbacks:u==null?void 0:u.getChild()});Di.runWithConfig(Lo(m),async()=>{try{d(n(o,m))}catch(y){p(y)}})})})}function NY(n){const{content:e,artifact:t,toolCallId:r}=n;return r&&!MH(e)?typeof e=="string"||Array.isArray(e)&&e.every(i=>typeof i=="object")?new ko({content:e,artifact:t,tool_call_id:r,name:n.name}):new ko({content:kY(e),artifact:t,tool_call_id:r,name:n.name}):e}function kY(n){try{return JSON.stringify(n,null,2)??""}catch{return`${n}`}}const MY=Object.freeze(Object.defineProperty({__proto__:null,BaseToolkit:xY,DynamicStructuredTool:hI,DynamicTool:QB,StructuredTool:Z_,Tool:XB,ToolInputParsingException:Rv,isLangChainTool:cc,isRunnableToolLike:fI,isStructuredTool:cI,isStructuredToolParams:dI,tool:OY},Symbol.toStringTag,{value:"Module"})),X_="2025-06-18",DY=[X_,"2025-03-26","2024-11-05","2024-10-07"],Q_="2.0",e3=An([Me(),zn().int()]),t3=Me(),$Y=Xe({progressToken:He(e3)}).passthrough(),ja=Xe({_meta:He($Y)}).passthrough(),Bi=Xe({method:Me(),params:He(ja)}),fm=Xe({_meta:He(Xe({}).passthrough())}).passthrough(),Zs=Xe({method:Me(),params:He(fm)}),Fa=Xe({_meta:He(Xe({}).passthrough())}).passthrough(),eb=An([Me(),zn().int()]),n3=Xe({jsonrpc:Rt(Q_),id:eb}).merge(Bi).strict(),r3=n=>n3.safeParse(n).success,i3=Xe({jsonrpc:Rt(Q_)}).merge(Zs).strict(),LY=n=>i3.safeParse(n).success,a3=Xe({jsonrpc:Rt(Q_),id:eb,result:Fa}).strict(),y1=n=>a3.safeParse(n).success;var xs;(function(n){n[n.ConnectionClosed=-32e3]="ConnectionClosed",n[n.RequestTimeout=-32001]="RequestTimeout",n[n.ParseError=-32700]="ParseError",n[n.InvalidRequest=-32600]="InvalidRequest",n[n.MethodNotFound=-32601]="MethodNotFound",n[n.InvalidParams=-32602]="InvalidParams",n[n.InternalError=-32603]="InternalError"})(xs||(xs={}));const s3=Xe({jsonrpc:Rt(Q_),id:eb,error:Xe({code:zn().int(),message:Me(),data:He(Wu())})}).strict(),UY=n=>s3.safeParse(n).success,jf=An([n3,i3,a3,s3]),Cf=Fa.strict(),pI=Zs.extend({method:Rt("notifications/cancelled"),params:fm.extend({requestId:eb,reason:Me().optional()})}),dm=Xe({name:Me(),title:He(Me())}).passthrough(),o3=dm.extend({version:Me()}),jY=Xe({experimental:He(Xe({}).passthrough()),sampling:He(Xe({}).passthrough()),elicitation:He(Xe({}).passthrough()),roots:He(Xe({listChanged:He(qr())}).passthrough())}).passthrough(),FY=Bi.extend({method:Rt("initialize"),params:ja.extend({protocolVersion:Me(),capabilities:jY,clientInfo:o3})}),BY=Xe({experimental:He(Xe({}).passthrough()),logging:He(Xe({}).passthrough()),completions:He(Xe({}).passthrough()),prompts:He(Xe({listChanged:He(qr())}).passthrough()),resources:He(Xe({subscribe:He(qr()),listChanged:He(qr())}).passthrough()),tools:He(Xe({listChanged:He(qr())}).passthrough())}).passthrough(),l3=Fa.extend({protocolVersion:Me(),capabilities:BY,serverInfo:o3,instructions:He(Me())}),u3=Zs.extend({method:Rt("notifications/initialized")}),qY=n=>u3.safeParse(n).success,mI=Bi.extend({method:Rt("ping")}),VY=Xe({progress:zn(),total:He(zn()),message:He(Me())}).passthrough(),gI=Zs.extend({method:Rt("notifications/progress"),params:fm.merge(VY).extend({progressToken:e3})}),tb=Bi.extend({params:ja.extend({cursor:He(t3)}).optional()}),nb=Fa.extend({nextCursor:He(t3)}),c3=Xe({uri:Me(),mimeType:He(Me()),_meta:He(Xe({}).passthrough())}).passthrough(),f3=c3.extend({text:Me()}),d3=c3.extend({blob:Me().base64()}),h3=dm.extend({uri:Me(),description:He(Me()),mimeType:He(Me()),_meta:He(Xe({}).passthrough())}),zY=dm.extend({uriTemplate:Me(),description:He(Me()),mimeType:He(Me()),_meta:He(Xe({}).passthrough())}),HY=tb.extend({method:Rt("resources/list")}),p3=nb.extend({resources:Pt(h3)}),GY=tb.extend({method:Rt("resources/templates/list")}),m3=nb.extend({resourceTemplates:Pt(zY)}),WY=Bi.extend({method:Rt("resources/read"),params:ja.extend({uri:Me()})}),g3=Fa.extend({contents:Pt(An([f3,d3]))}),KY=Zs.extend({method:Rt("notifications/resources/list_changed")}),JY=Bi.extend({method:Rt("resources/subscribe"),params:ja.extend({uri:Me()})}),YY=Bi.extend({method:Rt("resources/unsubscribe"),params:ja.extend({uri:Me()})}),ZY=Zs.extend({method:Rt("notifications/resources/updated"),params:fm.extend({uri:Me()})}),XY=Xe({name:Me(),description:He(Me()),required:He(qr())}).passthrough(),QY=dm.extend({description:He(Me()),arguments:He(Pt(XY)),_meta:He(Xe({}).passthrough())}),eZ=tb.extend({method:Rt("prompts/list")}),y3=nb.extend({prompts:Pt(QY)}),tZ=Bi.extend({method:Rt("prompts/get"),params:ja.extend({name:Me(),arguments:He(ts(Me()))})}),yI=Xe({type:Rt("text"),text:Me(),_meta:He(Xe({}).passthrough())}).passthrough(),vI=Xe({type:Rt("image"),data:Me().base64(),mimeType:Me(),_meta:He(Xe({}).passthrough())}).passthrough(),_I=Xe({type:Rt("audio"),data:Me().base64(),mimeType:Me(),_meta:He(Xe({}).passthrough())}).passthrough(),nZ=Xe({type:Rt("resource"),resource:An([f3,d3]),_meta:He(Xe({}).passthrough())}).passthrough(),rZ=h3.extend({type:Rt("resource_link")}),v3=An([yI,vI,_I,rZ,nZ]),iZ=Xe({role:ds(["user","assistant"]),content:v3}).passthrough(),_3=Fa.extend({description:He(Me()),messages:Pt(iZ)}),aZ=Zs.extend({method:Rt("notifications/prompts/list_changed")}),sZ=Xe({title:He(Me()),readOnlyHint:He(qr()),destructiveHint:He(qr()),idempotentHint:He(qr()),openWorldHint:He(qr())}).passthrough(),oZ=dm.extend({description:He(Me()),inputSchema:Xe({type:Rt("object"),properties:He(Xe({}).passthrough()),required:He(Pt(Me()))}).passthrough(),outputSchema:He(Xe({type:Rt("object"),properties:He(Xe({}).passthrough()),required:He(Pt(Me()))}).passthrough()),annotations:He(sZ),_meta:He(Xe({}).passthrough())}),lZ=tb.extend({method:Rt("tools/list")}),bI=nb.extend({tools:Pt(oZ)}),rb=Fa.extend({content:Pt(v3).default([]),structuredContent:Xe({}).passthrough().optional(),isError:He(qr())});rb.or(Fa.extend({toolResult:Wu()}));const uZ=Bi.extend({method:Rt("tools/call"),params:ja.extend({name:Me(),arguments:He(ts(Wu()))})}),cZ=Zs.extend({method:Rt("notifications/tools/list_changed")}),b3=ds(["debug","info","notice","warning","error","critical","alert","emergency"]),fZ=Bi.extend({method:Rt("logging/setLevel"),params:ja.extend({level:b3})}),dZ=Zs.extend({method:Rt("notifications/message"),params:fm.extend({level:b3,logger:He(Me()),data:Wu()})}),hZ=Xe({name:Me().optional()}).passthrough(),pZ=Xe({hints:He(Pt(hZ)),costPriority:He(zn().min(0).max(1)),speedPriority:He(zn().min(0).max(1)),intelligencePriority:He(zn().min(0).max(1))}).passthrough(),mZ=Xe({role:ds(["user","assistant"]),content:An([yI,vI,_I])}).passthrough(),gZ=Bi.extend({method:Rt("sampling/createMessage"),params:ja.extend({messages:Pt(mZ),systemPrompt:He(Me()),includeContext:He(ds(["none","thisServer","allServers"])),temperature:He(zn()),maxTokens:zn().int(),stopSequences:He(Pt(Me())),metadata:He(Xe({}).passthrough()),modelPreferences:He(pZ)})}),yZ=Fa.extend({model:Me(),stopReason:He(ds(["endTurn","stopSequence","maxTokens"]).or(Me())),role:ds(["user","assistant"]),content:EG("type",[yI,vI,_I])}),vZ=Xe({type:Rt("boolean"),title:He(Me()),description:He(Me()),default:He(qr())}).passthrough(),_Z=Xe({type:Rt("string"),title:He(Me()),description:He(Me()),minLength:He(zn()),maxLength:He(zn()),format:He(ds(["email","uri","date","date-time"]))}).passthrough(),bZ=Xe({type:ds(["number","integer"]),title:He(Me()),description:He(Me()),minimum:He(zn()),maximum:He(zn())}).passthrough(),wZ=Xe({type:Rt("string"),title:He(Me()),description:He(Me()),enum:Pt(Me()),enumNames:He(Pt(Me()))}).passthrough(),EZ=An([vZ,_Z,bZ,wZ]),SZ=Bi.extend({method:Rt("elicitation/create"),params:ja.extend({message:Me(),requestedSchema:Xe({type:Rt("object"),properties:ts(Me(),EZ),required:He(Pt(Me()))}).passthrough()})}),TZ=Fa.extend({action:ds(["accept","reject","cancel"]),content:He(ts(Me(),Wu()))}),AZ=Xe({type:Rt("ref/resource"),uri:Me()}).passthrough(),CZ=Xe({type:Rt("ref/prompt"),name:Me()}).passthrough(),RZ=Bi.extend({method:Rt("completion/complete"),params:ja.extend({ref:An([CZ,AZ]),argument:Xe({name:Me(),value:Me()}).passthrough(),context:He(Xe({arguments:He(ts(Me(),Me()))}))})}),w3=Fa.extend({completion:Xe({values:Pt(Me()).max(100),total:He(zn().int()),hasMore:He(qr())}).passthrough()}),IZ=Xe({uri:Me().startsWith("file://"),name:He(Me()),_meta:He(Xe({}).passthrough())}).passthrough(),PZ=Bi.extend({method:Rt("roots/list")}),xZ=Fa.extend({roots:Pt(IZ)}),OZ=Zs.extend({method:Rt("notifications/roots/list_changed")});An([mI,FY,RZ,fZ,tZ,eZ,HY,GY,WY,JY,YY,uZ,lZ]);An([pI,gI,u3,OZ]);An([Cf,yZ,TZ,xZ]);An([mI,gZ,SZ,PZ]);An([pI,gI,dZ,ZY,KY,cZ,aZ]);An([Cf,l3,w3,_3,y3,p3,m3,g3,rb,bI]);class Rl extends Error{constructor(e,t,r){super(`MCP error ${e}: ${t}`),this.code=e,this.data=r,this.name="McpError"}}const NZ=6e4;class kZ{constructor(e){this._options=e,this._requestMessageId=0,this._requestHandlers=new Map,this._requestHandlerAbortControllers=new Map,this._notificationHandlers=new Map,this._responseHandlers=new Map,this._progressHandlers=new Map,this._timeoutInfo=new Map,this.setNotificationHandler(pI,t=>{const r=this._requestHandlerAbortControllers.get(t.params.requestId);r==null||r.abort(t.params.reason)}),this.setNotificationHandler(gI,t=>{this._onprogress(t)}),this.setRequestHandler(mI,t=>({}))}_setupTimeout(e,t,r,i,a=!1){this._timeoutInfo.set(e,{timeoutId:setTimeout(i,t),startTime:Date.now(),timeout:t,maxTotalTimeout:r,resetTimeoutOnProgress:a,onTimeout:i})}_resetTimeout(e){const t=this._timeoutInfo.get(e);if(!t)return!1;const r=Date.now()-t.startTime;if(t.maxTotalTimeout&&r>=t.maxTotalTimeout)throw this._timeoutInfo.delete(e),new Rl(xs.RequestTimeout,"Maximum total timeout exceeded",{maxTotalTimeout:t.maxTotalTimeout,totalElapsed:r});return clearTimeout(t.timeoutId),t.timeoutId=setTimeout(t.onTimeout,t.timeout),!0}_cleanupTimeout(e){const t=this._timeoutInfo.get(e);t&&(clearTimeout(t.timeoutId),this._timeoutInfo.delete(e))}async connect(e){var t,r,i;this._transport=e;const a=(t=this.transport)===null||t===void 0?void 0:t.onclose;this._transport.onclose=()=>{a==null||a(),this._onclose()};const s=(r=this.transport)===null||r===void 0?void 0:r.onerror;this._transport.onerror=u=>{s==null||s(u),this._onerror(u)};const o=(i=this._transport)===null||i===void 0?void 0:i.onmessage;this._transport.onmessage=(u,c)=>{o==null||o(u,c),y1(u)||UY(u)?this._onresponse(u):r3(u)?this._onrequest(u,c):LY(u)?this._onnotification(u):this._onerror(new Error(`Unknown message type: ${JSON.stringify(u)}`))},await this._transport.start()}_onclose(){var e;const t=this._responseHandlers;this._responseHandlers=new Map,this._progressHandlers.clear(),this._transport=void 0,(e=this.onclose)===null||e===void 0||e.call(this);const r=new Rl(xs.ConnectionClosed,"Connection closed");for(const i of t.values())i(r)}_onerror(e){var t;(t=this.onerror)===null||t===void 0||t.call(this,e)}_onnotification(e){var t;const r=(t=this._notificationHandlers.get(e.method))!==null&&t!==void 0?t:this.fallbackNotificationHandler;r!==void 0&&Promise.resolve().then(()=>r(e)).catch(i=>this._onerror(new Error(`Uncaught error in notification handler: ${i}`)))}_onrequest(e,t){var r,i,a,s;const o=(r=this._requestHandlers.get(e.method))!==null&&r!==void 0?r:this.fallbackRequestHandler;if(o===void 0){(i=this._transport)===null||i===void 0||i.send({jsonrpc:"2.0",id:e.id,error:{code:xs.MethodNotFound,message:"Method not found"}}).catch(d=>this._onerror(new Error(`Failed to send an error response: ${d}`)));return}const u=new AbortController;this._requestHandlerAbortControllers.set(e.id,u);const c={signal:u.signal,sessionId:(a=this._transport)===null||a===void 0?void 0:a.sessionId,_meta:(s=e.params)===null||s===void 0?void 0:s._meta,sendNotification:d=>this.notification(d,{relatedRequestId:e.id}),sendRequest:(d,p,m)=>this.request(d,p,{...m,relatedRequestId:e.id}),authInfo:t==null?void 0:t.authInfo,requestId:e.id,requestInfo:t==null?void 0:t.requestInfo};Promise.resolve().then(()=>o(e,c)).then(d=>{var p;if(!u.signal.aborted)return(p=this._transport)===null||p===void 0?void 0:p.send({result:d,jsonrpc:"2.0",id:e.id})},d=>{var p,m;if(!u.signal.aborted)return(p=this._transport)===null||p===void 0?void 0:p.send({jsonrpc:"2.0",id:e.id,error:{code:Number.isSafeInteger(d.code)?d.code:xs.InternalError,message:(m=d.message)!==null&&m!==void 0?m:"Internal error"}})}).catch(d=>this._onerror(new Error(`Failed to send response: ${d}`))).finally(()=>{this._requestHandlerAbortControllers.delete(e.id)})}_onprogress(e){const{progressToken:t,...r}=e.params,i=Number(t),a=this._progressHandlers.get(i);if(!a){this._onerror(new Error(`Received a progress notification for an unknown token: ${JSON.stringify(e)}`));return}const s=this._responseHandlers.get(i),o=this._timeoutInfo.get(i);if(o&&s&&o.resetTimeoutOnProgress)try{this._resetTimeout(i)}catch(u){s(u);return}a(r)}_onresponse(e){const t=Number(e.id),r=this._responseHandlers.get(t);if(r===void 0){this._onerror(new Error(`Received a response for an unknown message ID: ${JSON.stringify(e)}`));return}if(this._responseHandlers.delete(t),this._progressHandlers.delete(t),this._cleanupTimeout(t),y1(e))r(e);else{const i=new Rl(e.error.code,e.error.message,e.error.data);r(i)}}get transport(){return this._transport}async close(){var e;await((e=this._transport)===null||e===void 0?void 0:e.close())}request(e,t,r){const{relatedRequestId:i,resumptionToken:a,onresumptiontoken:s}=r??{};return new Promise((o,u)=>{var c,d,p,m,y,b;if(!this._transport){u(new Error("Not connected"));return}((c=this._options)===null||c===void 0?void 0:c.enforceStrictCapabilities)===!0&&this.assertCapabilityForMethod(e.method),(d=r==null?void 0:r.signal)===null||d===void 0||d.throwIfAborted();const w=this._requestMessageId++,S={...e,jsonrpc:"2.0",id:w};r!=null&&r.onprogress&&(this._progressHandlers.set(w,r.onprogress),S.params={...e.params,_meta:{...((p=e.params)===null||p===void 0?void 0:p._meta)||{},progressToken:w}});const T=I=>{var x;this._responseHandlers.delete(w),this._progressHandlers.delete(w),this._cleanupTimeout(w),(x=this._transport)===null||x===void 0||x.send({jsonrpc:"2.0",method:"notifications/cancelled",params:{requestId:w,reason:String(I)}},{relatedRequestId:i,resumptionToken:a,onresumptiontoken:s}).catch(L=>this._onerror(new Error(`Failed to send cancellation: ${L}`))),u(I)};this._responseHandlers.set(w,I=>{var x;if(!(!((x=r==null?void 0:r.signal)===null||x===void 0)&&x.aborted)){if(I instanceof Error)return u(I);try{const L=t.parse(I.result);o(L)}catch(L){u(L)}}}),(m=r==null?void 0:r.signal)===null||m===void 0||m.addEventListener("abort",()=>{var I;T((I=r==null?void 0:r.signal)===null||I===void 0?void 0:I.reason)});const C=(y=r==null?void 0:r.timeout)!==null&&y!==void 0?y:NZ,A=()=>T(new Rl(xs.RequestTimeout,"Request timed out",{timeout:C}));this._setupTimeout(w,C,r==null?void 0:r.maxTotalTimeout,A,(b=r==null?void 0:r.resetTimeoutOnProgress)!==null&&b!==void 0?b:!1),this._transport.send(S,{relatedRequestId:i,resumptionToken:a,onresumptiontoken:s}).catch(I=>{this._cleanupTimeout(w),u(I)})})}async notification(e,t){if(!this._transport)throw new Error("Not connected");this.assertNotificationCapability(e.method);const r={...e,jsonrpc:"2.0"};await this._transport.send(r,t)}setRequestHandler(e,t){const r=e.shape.method.value;this.assertRequestHandlerCapability(r),this._requestHandlers.set(r,(i,a)=>Promise.resolve(t(e.parse(i),a)))}removeRequestHandler(e){this._requestHandlers.delete(e)}assertCanSetRequestHandler(e){if(this._requestHandlers.has(e))throw new Error(`A request handler for ${e} already exists, which would be overridden`)}setNotificationHandler(e,t){this._notificationHandlers.set(e.shape.method.value,r=>Promise.resolve(t(e.parse(r))))}removeNotificationHandler(e){this._notificationHandlers.delete(e)}}function MZ(n,e){return Object.entries(e).reduce((t,[r,i])=>(i&&typeof i=="object"?t[r]=t[r]?{...t[r],...i}:i:t[r]=i,t),{...n})}var zh={exports:{}};/** @license URI.js v4.4.1 (c) 2011 Gary Court. License: http://github.com/garycourt/uri-js */var DZ=zh.exports,zD;function $Z(){return zD||(zD=1,function(n,e){(function(t,r){r(e)})(DZ,function(t){function r(){for(var Z=arguments.length,ee=Array(Z),fe=0;fe<Z;fe++)ee[fe]=arguments[fe];if(ee.length>1){ee[0]=ee[0].slice(0,-1);for(var we=ee.length-1,be=1;be<we;++be)ee[be]=ee[be].slice(1,-1);return ee[we]=ee[we].slice(1),ee.join("")}else return ee[0]}function i(Z){return"(?:"+Z+")"}function a(Z){return Z===void 0?"undefined":Z===null?"null":Object.prototype.toString.call(Z).split(" ").pop().split("]").shift().toLowerCase()}function s(Z){return Z.toUpperCase()}function o(Z){return Z!=null?Z instanceof Array?Z:typeof Z.length!="number"||Z.split||Z.setInterval||Z.call?[Z]:Array.prototype.slice.call(Z):[]}function u(Z,ee){var fe=Z;if(ee)for(var we in ee)fe[we]=ee[we];return fe}function c(Z){var ee="[A-Za-z]",fe="[0-9]",we=r(fe,"[A-Fa-f]"),be=i(i("%[EFef]"+we+"%"+we+we+"%"+we+we)+"|"+i("%[89A-Fa-f]"+we+"%"+we+we)+"|"+i("%"+we+we)),Ze="[\\:\\/\\?\\#\\[\\]\\@]",ut="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",Mt=r(Ze,ut),nn=Z?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]",mn=Z?"[\\uE000-\\uF8FF]":"[]",pt=r(ee,fe,"[\\-\\.\\_\\~]",nn);i(ee+r(ee,fe,"[\\+\\-\\.]")+"*"),i(i(be+"|"+r(pt,ut,"[\\:]"))+"*");var cn=i(i("25[0-5]")+"|"+i("2[0-4]"+fe)+"|"+i("1"+fe+fe)+"|"+i("0?[1-9]"+fe)+"|0?0?"+fe),Pn=i(cn+"\\."+cn+"\\."+cn+"\\."+cn),gt=i(we+"{1,4}"),rn=i(i(gt+"\\:"+gt)+"|"+Pn),Fn=i(i(gt+"\\:")+"{6}"+rn),wn=i("\\:\\:"+i(gt+"\\:")+"{5}"+rn),Ba=i(i(gt)+"?\\:\\:"+i(gt+"\\:")+"{4}"+rn),ha=i(i(i(gt+"\\:")+"{0,1}"+gt)+"?\\:\\:"+i(gt+"\\:")+"{3}"+rn),ii=i(i(i(gt+"\\:")+"{0,2}"+gt)+"?\\:\\:"+i(gt+"\\:")+"{2}"+rn),qa=i(i(i(gt+"\\:")+"{0,3}"+gt)+"?\\:\\:"+gt+"\\:"+rn),xr=i(i(i(gt+"\\:")+"{0,4}"+gt)+"?\\:\\:"+rn),Gr=i(i(i(gt+"\\:")+"{0,5}"+gt)+"?\\:\\:"+gt),Vi=i(i(i(gt+"\\:")+"{0,6}"+gt)+"?\\:\\:"),vi=i([Fn,wn,Ba,ha,ii,qa,xr,Gr,Vi].join("|")),zi=i(i(pt+"|"+be)+"+");i("[vV]"+we+"+\\."+r(pt,ut,"[\\:]")+"+"),i(i(be+"|"+r(pt,ut))+"*");var Xs=i(be+"|"+r(pt,ut,"[\\:\\@]"));return i(i(be+"|"+r(pt,ut,"[\\@]"))+"+"),i(i(Xs+"|"+r("[\\/\\?]",mn))+"*"),{NOT_SCHEME:new RegExp(r("[^]",ee,fe,"[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(r("[^\\%\\:]",pt,ut),"g"),NOT_HOST:new RegExp(r("[^\\%\\[\\]\\:]",pt,ut),"g"),NOT_PATH:new RegExp(r("[^\\%\\/\\:\\@]",pt,ut),"g"),NOT_PATH_NOSCHEME:new RegExp(r("[^\\%\\/\\@]",pt,ut),"g"),NOT_QUERY:new RegExp(r("[^\\%]",pt,ut,"[\\:\\@\\/\\?]",mn),"g"),NOT_FRAGMENT:new RegExp(r("[^\\%]",pt,ut,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(r("[^]",pt,ut),"g"),UNRESERVED:new RegExp(pt,"g"),OTHER_CHARS:new RegExp(r("[^\\%]",pt,Mt),"g"),PCT_ENCODED:new RegExp(be,"g"),IPV4ADDRESS:new RegExp("^("+Pn+")$"),IPV6ADDRESS:new RegExp("^\\[?("+vi+")"+i(i("\\%25|\\%(?!"+we+"{2})")+"("+zi+")")+"?\\]?$")}}var d=c(!1),p=c(!0),m=function(){function Z(ee,fe){var we=[],be=!0,Ze=!1,ut=void 0;try{for(var Mt=ee[Symbol.iterator](),nn;!(be=(nn=Mt.next()).done)&&(we.push(nn.value),!(fe&&we.length===fe));be=!0);}catch(mn){Ze=!0,ut=mn}finally{try{!be&&Mt.return&&Mt.return()}finally{if(Ze)throw ut}}return we}return function(ee,fe){if(Array.isArray(ee))return ee;if(Symbol.iterator in Object(ee))return Z(ee,fe);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),y=function(Z){if(Array.isArray(Z)){for(var ee=0,fe=Array(Z.length);ee<Z.length;ee++)fe[ee]=Z[ee];return fe}else return Array.from(Z)},b=2147483647,w=36,S=1,T=26,C=38,A=700,I=72,x=128,L="-",U=/^xn--/,N=/[^\0-\x7E]/,B=/[\x2E\u3002\uFF0E\uFF61]/g,q={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},J=w-S,V=Math.floor,de=String.fromCharCode;function ae(Z){throw new RangeError(q[Z])}function ue(Z,ee){for(var fe=[],we=Z.length;we--;)fe[we]=ee(Z[we]);return fe}function te(Z,ee){var fe=Z.split("@"),we="";fe.length>1&&(we=fe[0]+"@",Z=fe[1]),Z=Z.replace(B,".");var be=Z.split("."),Ze=ue(be,ee).join(".");return we+Ze}function oe(Z){for(var ee=[],fe=0,we=Z.length;fe<we;){var be=Z.charCodeAt(fe++);if(be>=55296&&be<=56319&&fe<we){var Ze=Z.charCodeAt(fe++);(Ze&64512)==56320?ee.push(((be&1023)<<10)+(Ze&1023)+65536):(ee.push(be),fe--)}else ee.push(be)}return ee}var ge=function(ee){return String.fromCodePoint.apply(String,y(ee))},Ee=function(ee){return ee-48<10?ee-22:ee-65<26?ee-65:ee-97<26?ee-97:w},Y=function(ee,fe){return ee+22+75*(ee<26)-((fe!=0)<<5)},ve=function(ee,fe,we){var be=0;for(ee=we?V(ee/A):ee>>1,ee+=V(ee/fe);ee>J*T>>1;be+=w)ee=V(ee/J);return V(be+(J+1)*ee/(ee+C))},Re=function(ee){var fe=[],we=ee.length,be=0,Ze=x,ut=I,Mt=ee.lastIndexOf(L);Mt<0&&(Mt=0);for(var nn=0;nn<Mt;++nn)ee.charCodeAt(nn)>=128&&ae("not-basic"),fe.push(ee.charCodeAt(nn));for(var mn=Mt>0?Mt+1:0;mn<we;){for(var pt=be,cn=1,Pn=w;;Pn+=w){mn>=we&&ae("invalid-input");var gt=Ee(ee.charCodeAt(mn++));(gt>=w||gt>V((b-be)/cn))&&ae("overflow"),be+=gt*cn;var rn=Pn<=ut?S:Pn>=ut+T?T:Pn-ut;if(gt<rn)break;var Fn=w-rn;cn>V(b/Fn)&&ae("overflow"),cn*=Fn}var wn=fe.length+1;ut=ve(be-pt,wn,pt==0),V(be/wn)>b-Ze&&ae("overflow"),Ze+=V(be/wn),be%=wn,fe.splice(be++,0,Ze)}return String.fromCodePoint.apply(String,fe)},Q=function(ee){var fe=[];ee=oe(ee);var we=ee.length,be=x,Ze=0,ut=I,Mt=!0,nn=!1,mn=void 0;try{for(var pt=ee[Symbol.iterator](),cn;!(Mt=(cn=pt.next()).done);Mt=!0){var Pn=cn.value;Pn<128&&fe.push(de(Pn))}}catch(_s){nn=!0,mn=_s}finally{try{!Mt&&pt.return&&pt.return()}finally{if(nn)throw mn}}var gt=fe.length,rn=gt;for(gt&&fe.push(L);rn<we;){var Fn=b,wn=!0,Ba=!1,ha=void 0;try{for(var ii=ee[Symbol.iterator](),qa;!(wn=(qa=ii.next()).done);wn=!0){var xr=qa.value;xr>=be&&xr<Fn&&(Fn=xr)}}catch(_s){Ba=!0,ha=_s}finally{try{!wn&&ii.return&&ii.return()}finally{if(Ba)throw ha}}var Gr=rn+1;Fn-be>V((b-Ze)/Gr)&&ae("overflow"),Ze+=(Fn-be)*Gr,be=Fn;var Vi=!0,vi=!1,zi=void 0;try{for(var Xs=ee[Symbol.iterator](),Fm;!(Vi=(Fm=Xs.next()).done);Vi=!0){var Rd=Fm.value;if(Rd<be&&++Ze>b&&ae("overflow"),Rd==be){for(var Or=Ze,Kl=w;;Kl+=w){var vc=Kl<=ut?S:Kl>=ut+T?T:Kl-ut;if(Or<vc)break;var Jl=Or-vc,Id=w-vc;fe.push(de(Y(vc+Jl%Id,0))),Or=V(Jl/Id)}fe.push(de(Y(Or,0))),ut=ve(Ze,Gr,rn==gt),Ze=0,++rn}}}catch(_s){vi=!0,zi=_s}finally{try{!Vi&&Xs.return&&Xs.return()}finally{if(vi)throw zi}}++Ze,++be}return fe.join("")},ie=function(ee){return te(ee,function(fe){return U.test(fe)?Re(fe.slice(4).toLowerCase()):fe})},ce=function(ee){return te(ee,function(fe){return N.test(fe)?"xn--"+Q(fe):fe})},P={version:"2.1.0",ucs2:{decode:oe,encode:ge},decode:Re,encode:Q,toASCII:ce,toUnicode:ie},O={};function K(Z){var ee=Z.charCodeAt(0),fe=void 0;return ee<16?fe="%0"+ee.toString(16).toUpperCase():ee<128?fe="%"+ee.toString(16).toUpperCase():ee<2048?fe="%"+(ee>>6|192).toString(16).toUpperCase()+"%"+(ee&63|128).toString(16).toUpperCase():fe="%"+(ee>>12|224).toString(16).toUpperCase()+"%"+(ee>>6&63|128).toString(16).toUpperCase()+"%"+(ee&63|128).toString(16).toUpperCase(),fe}function X(Z){for(var ee="",fe=0,we=Z.length;fe<we;){var be=parseInt(Z.substr(fe+1,2),16);if(be<128)ee+=String.fromCharCode(be),fe+=3;else if(be>=194&&be<224){if(we-fe>=6){var Ze=parseInt(Z.substr(fe+4,2),16);ee+=String.fromCharCode((be&31)<<6|Ze&63)}else ee+=Z.substr(fe,6);fe+=6}else if(be>=224){if(we-fe>=9){var ut=parseInt(Z.substr(fe+4,2),16),Mt=parseInt(Z.substr(fe+7,2),16);ee+=String.fromCharCode((be&15)<<12|(ut&63)<<6|Mt&63)}else ee+=Z.substr(fe,9);fe+=9}else ee+=Z.substr(fe,3),fe+=3}return ee}function se(Z,ee){function fe(we){var be=X(we);return be.match(ee.UNRESERVED)?be:we}return Z.scheme&&(Z.scheme=String(Z.scheme).replace(ee.PCT_ENCODED,fe).toLowerCase().replace(ee.NOT_SCHEME,"")),Z.userinfo!==void 0&&(Z.userinfo=String(Z.userinfo).replace(ee.PCT_ENCODED,fe).replace(ee.NOT_USERINFO,K).replace(ee.PCT_ENCODED,s)),Z.host!==void 0&&(Z.host=String(Z.host).replace(ee.PCT_ENCODED,fe).toLowerCase().replace(ee.NOT_HOST,K).replace(ee.PCT_ENCODED,s)),Z.path!==void 0&&(Z.path=String(Z.path).replace(ee.PCT_ENCODED,fe).replace(Z.scheme?ee.NOT_PATH:ee.NOT_PATH_NOSCHEME,K).replace(ee.PCT_ENCODED,s)),Z.query!==void 0&&(Z.query=String(Z.query).replace(ee.PCT_ENCODED,fe).replace(ee.NOT_QUERY,K).replace(ee.PCT_ENCODED,s)),Z.fragment!==void 0&&(Z.fragment=String(Z.fragment).replace(ee.PCT_ENCODED,fe).replace(ee.NOT_FRAGMENT,K).replace(ee.PCT_ENCODED,s)),Z}function F(Z){return Z.replace(/^0*(.*)/,"$1")||"0"}function z(Z,ee){var fe=Z.match(ee.IPV4ADDRESS)||[],we=m(fe,2),be=we[1];return be?be.split(".").map(F).join("."):Z}function ye(Z,ee){var fe=Z.match(ee.IPV6ADDRESS)||[],we=m(fe,3),be=we[1],Ze=we[2];if(be){for(var ut=be.toLowerCase().split("::").reverse(),Mt=m(ut,2),nn=Mt[0],mn=Mt[1],pt=mn?mn.split(":").map(F):[],cn=nn.split(":").map(F),Pn=ee.IPV4ADDRESS.test(cn[cn.length-1]),gt=Pn?7:8,rn=cn.length-gt,Fn=Array(gt),wn=0;wn<gt;++wn)Fn[wn]=pt[wn]||cn[rn+wn]||"";Pn&&(Fn[gt-1]=z(Fn[gt-1],ee));var Ba=Fn.reduce(function(Gr,Vi,vi){if(!Vi||Vi==="0"){var zi=Gr[Gr.length-1];zi&&zi.index+zi.length===vi?zi.length++:Gr.push({index:vi,length:1})}return Gr},[]),ha=Ba.sort(function(Gr,Vi){return Vi.length-Gr.length})[0],ii=void 0;if(ha&&ha.length>1){var qa=Fn.slice(0,ha.index),xr=Fn.slice(ha.index+ha.length);ii=qa.join(":")+"::"+xr.join(":")}else ii=Fn.join(":");return Ze&&(ii+="%"+Ze),ii}else return Z}var ke=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,Qe="".match(/(){0}/)[1]===void 0;function $e(Z){var ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},fe={},we=ee.iri!==!1?p:d;ee.reference==="suffix"&&(Z=(ee.scheme?ee.scheme+":":"")+"//"+Z);var be=Z.match(ke);if(be){Qe?(fe.scheme=be[1],fe.userinfo=be[3],fe.host=be[4],fe.port=parseInt(be[5],10),fe.path=be[6]||"",fe.query=be[7],fe.fragment=be[8],isNaN(fe.port)&&(fe.port=be[5])):(fe.scheme=be[1]||void 0,fe.userinfo=Z.indexOf("@")!==-1?be[3]:void 0,fe.host=Z.indexOf("//")!==-1?be[4]:void 0,fe.port=parseInt(be[5],10),fe.path=be[6]||"",fe.query=Z.indexOf("?")!==-1?be[7]:void 0,fe.fragment=Z.indexOf("#")!==-1?be[8]:void 0,isNaN(fe.port)&&(fe.port=Z.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?be[4]:void 0)),fe.host&&(fe.host=ye(z(fe.host,we),we)),fe.scheme===void 0&&fe.userinfo===void 0&&fe.host===void 0&&fe.port===void 0&&!fe.path&&fe.query===void 0?fe.reference="same-document":fe.scheme===void 0?fe.reference="relative":fe.fragment===void 0?fe.reference="absolute":fe.reference="uri",ee.reference&&ee.reference!=="suffix"&&ee.reference!==fe.reference&&(fe.error=fe.error||"URI is not a "+ee.reference+" reference.");var Ze=O[(ee.scheme||fe.scheme||"").toLowerCase()];if(!ee.unicodeSupport&&(!Ze||!Ze.unicodeSupport)){if(fe.host&&(ee.domainHost||Ze&&Ze.domainHost))try{fe.host=P.toASCII(fe.host.replace(we.PCT_ENCODED,X).toLowerCase())}catch(ut){fe.error=fe.error||"Host's domain name can not be converted to ASCII via punycode: "+ut}se(fe,d)}else se(fe,we);Ze&&Ze.parse&&Ze.parse(fe,ee)}else fe.error=fe.error||"URI can not be parsed.";return fe}function ze(Z,ee){var fe=ee.iri!==!1?p:d,we=[];return Z.userinfo!==void 0&&(we.push(Z.userinfo),we.push("@")),Z.host!==void 0&&we.push(ye(z(String(Z.host),fe),fe).replace(fe.IPV6ADDRESS,function(be,Ze,ut){return"["+Ze+(ut?"%25"+ut:"")+"]"})),(typeof Z.port=="number"||typeof Z.port=="string")&&(we.push(":"),we.push(String(Z.port))),we.length?we.join(""):void 0}var xt=/^\.\.?\//,Oe=/^\/\.(\/|$)/,qe=/^\/\.\.(\/|$)/,It=/^\/?(?:.|\n)*?(?=\/|$)/;function Ve(Z){for(var ee=[];Z.length;)if(Z.match(xt))Z=Z.replace(xt,"");else if(Z.match(Oe))Z=Z.replace(Oe,"/");else if(Z.match(qe))Z=Z.replace(qe,"/"),ee.pop();else if(Z==="."||Z==="..")Z="";else{var fe=Z.match(It);if(fe){var we=fe[0];Z=Z.slice(we.length),ee.push(we)}else throw new Error("Unexpected dot segment condition")}return ee.join("")}function Be(Z){var ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},fe=ee.iri?p:d,we=[],be=O[(ee.scheme||Z.scheme||"").toLowerCase()];if(be&&be.serialize&&be.serialize(Z,ee),Z.host&&!fe.IPV6ADDRESS.test(Z.host)){if(ee.domainHost||be&&be.domainHost)try{Z.host=ee.iri?P.toUnicode(Z.host):P.toASCII(Z.host.replace(fe.PCT_ENCODED,X).toLowerCase())}catch(Mt){Z.error=Z.error||"Host's domain name can not be converted to "+(ee.iri?"Unicode":"ASCII")+" via punycode: "+Mt}}se(Z,fe),ee.reference!=="suffix"&&Z.scheme&&(we.push(Z.scheme),we.push(":"));var Ze=ze(Z,ee);if(Ze!==void 0&&(ee.reference!=="suffix"&&we.push("//"),we.push(Ze),Z.path&&Z.path.charAt(0)!=="/"&&we.push("/")),Z.path!==void 0){var ut=Z.path;!ee.absolutePath&&(!be||!be.absolutePath)&&(ut=Ve(ut)),Ze===void 0&&(ut=ut.replace(/^\/\//,"/%2F")),we.push(ut)}return Z.query!==void 0&&(we.push("?"),we.push(Z.query)),Z.fragment!==void 0&&(we.push("#"),we.push(Z.fragment)),we.join("")}function et(Z,ee){var fe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},we=arguments[3],be={};return we||(Z=$e(Be(Z,fe),fe),ee=$e(Be(ee,fe),fe)),fe=fe||{},!fe.tolerant&&ee.scheme?(be.scheme=ee.scheme,be.userinfo=ee.userinfo,be.host=ee.host,be.port=ee.port,be.path=Ve(ee.path||""),be.query=ee.query):(ee.userinfo!==void 0||ee.host!==void 0||ee.port!==void 0?(be.userinfo=ee.userinfo,be.host=ee.host,be.port=ee.port,be.path=Ve(ee.path||""),be.query=ee.query):(ee.path?(ee.path.charAt(0)==="/"?be.path=Ve(ee.path):((Z.userinfo!==void 0||Z.host!==void 0||Z.port!==void 0)&&!Z.path?be.path="/"+ee.path:Z.path?be.path=Z.path.slice(0,Z.path.lastIndexOf("/")+1)+ee.path:be.path=ee.path,be.path=Ve(be.path)),be.query=ee.query):(be.path=Z.path,ee.query!==void 0?be.query=ee.query:be.query=Z.query),be.userinfo=Z.userinfo,be.host=Z.host,be.port=Z.port),be.scheme=Z.scheme),be.fragment=ee.fragment,be}function Ye(Z,ee,fe){var we=u({scheme:"null"},fe);return Be(et($e(Z,we),$e(ee,we),we,!0),we)}function We(Z,ee){return typeof Z=="string"?Z=Be($e(Z,ee),ee):a(Z)==="object"&&(Z=$e(Be(Z,ee),ee)),Z}function rt(Z,ee,fe){return typeof Z=="string"?Z=Be($e(Z,fe),fe):a(Z)==="object"&&(Z=Be(Z,fe)),typeof ee=="string"?ee=Be($e(ee,fe),fe):a(ee)==="object"&&(ee=Be(ee,fe)),Z===ee}function tt(Z,ee){return Z&&Z.toString().replace(!ee||!ee.iri?d.ESCAPE:p.ESCAPE,K)}function St(Z,ee){return Z&&Z.toString().replace(!ee||!ee.iri?d.PCT_ENCODED:p.PCT_ENCODED,X)}var H={scheme:"http",domainHost:!0,parse:function(ee,fe){return ee.host||(ee.error=ee.error||"HTTP URIs must have a host."),ee},serialize:function(ee,fe){var we=String(ee.scheme).toLowerCase()==="https";return(ee.port===(we?443:80)||ee.port==="")&&(ee.port=void 0),ee.path||(ee.path="/"),ee}},k={scheme:"https",domainHost:H.domainHost,parse:H.parse,serialize:H.serialize};function $(Z){return typeof Z.secure=="boolean"?Z.secure:String(Z.scheme).toLowerCase()==="wss"}var re={scheme:"ws",domainHost:!0,parse:function(ee,fe){var we=ee;return we.secure=$(we),we.resourceName=(we.path||"/")+(we.query?"?"+we.query:""),we.path=void 0,we.query=void 0,we},serialize:function(ee,fe){if((ee.port===($(ee)?443:80)||ee.port==="")&&(ee.port=void 0),typeof ee.secure=="boolean"&&(ee.scheme=ee.secure?"wss":"ws",ee.secure=void 0),ee.resourceName){var we=ee.resourceName.split("?"),be=m(we,2),Ze=be[0],ut=be[1];ee.path=Ze&&Ze!=="/"?Ze:void 0,ee.query=ut,ee.resourceName=void 0}return ee.fragment=void 0,ee}},pe={scheme:"wss",domainHost:re.domainHost,parse:re.parse,serialize:re.serialize},Ce={},Le="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",ht="[0-9A-Fa-f]",sn=i(i("%[EFef]"+ht+"%"+ht+ht+"%"+ht+ht)+"|"+i("%[89A-Fa-f]"+ht+"%"+ht+ht)+"|"+i("%"+ht+ht)),tn="[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]",un="[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",Kt=r(un,'[\\"\\\\]'),da="[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]",yi=new RegExp(Le,"g"),qi=new RegExp(sn,"g"),yc=new RegExp(r("[^]",tn,"[\\.]",'[\\"]',Kt),"g"),ri=new RegExp(r("[^]",Le,da),"g"),Wl=ri;function G(Z){var ee=X(Z);return ee.match(yi)?ee:Z}var M={scheme:"mailto",parse:function(ee,fe){var we=ee,be=we.to=we.path?we.path.split(","):[];if(we.path=void 0,we.query){for(var Ze=!1,ut={},Mt=we.query.split("&"),nn=0,mn=Mt.length;nn<mn;++nn){var pt=Mt[nn].split("=");switch(pt[0]){case"to":for(var cn=pt[1].split(","),Pn=0,gt=cn.length;Pn<gt;++Pn)be.push(cn[Pn]);break;case"subject":we.subject=St(pt[1],fe);break;case"body":we.body=St(pt[1],fe);break;default:Ze=!0,ut[St(pt[0],fe)]=St(pt[1],fe);break}}Ze&&(we.headers=ut)}we.query=void 0;for(var rn=0,Fn=be.length;rn<Fn;++rn){var wn=be[rn].split("@");if(wn[0]=St(wn[0]),fe.unicodeSupport)wn[1]=St(wn[1],fe).toLowerCase();else try{wn[1]=P.toASCII(St(wn[1],fe).toLowerCase())}catch(Ba){we.error=we.error||"Email address's domain name can not be converted to ASCII via punycode: "+Ba}be[rn]=wn.join("@")}return we},serialize:function(ee,fe){var we=ee,be=o(ee.to);if(be){for(var Ze=0,ut=be.length;Ze<ut;++Ze){var Mt=String(be[Ze]),nn=Mt.lastIndexOf("@"),mn=Mt.slice(0,nn).replace(qi,G).replace(qi,s).replace(yc,K),pt=Mt.slice(nn+1);try{pt=fe.iri?P.toUnicode(pt):P.toASCII(St(pt,fe).toLowerCase())}catch(rn){we.error=we.error||"Email address's domain name can not be converted to "+(fe.iri?"Unicode":"ASCII")+" via punycode: "+rn}be[Ze]=mn+"@"+pt}we.path=be.join(",")}var cn=ee.headers=ee.headers||{};ee.subject&&(cn.subject=ee.subject),ee.body&&(cn.body=ee.body);var Pn=[];for(var gt in cn)cn[gt]!==Ce[gt]&&Pn.push(gt.replace(qi,G).replace(qi,s).replace(ri,K)+"="+cn[gt].replace(qi,G).replace(qi,s).replace(Wl,K));return Pn.length&&(we.query=Pn.join("&")),we}},D=/^([^\:]+)\:(.*)/,ne={scheme:"urn",parse:function(ee,fe){var we=ee.path&&ee.path.match(D),be=ee;if(we){var Ze=fe.scheme||be.scheme||"urn",ut=we[1].toLowerCase(),Mt=we[2],nn=Ze+":"+(fe.nid||ut),mn=O[nn];be.nid=ut,be.nss=Mt,be.path=void 0,mn&&(be=mn.parse(be,fe))}else be.error=be.error||"URN can not be parsed.";return be},serialize:function(ee,fe){var we=fe.scheme||ee.scheme||"urn",be=ee.nid,Ze=we+":"+(fe.nid||be),ut=O[Ze];ut&&(ee=ut.serialize(ee,fe));var Mt=ee,nn=ee.nss;return Mt.path=(be||fe.nid)+":"+nn,Mt}},he=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,Ie={scheme:"urn:uuid",parse:function(ee,fe){var we=ee;return we.uuid=we.nss,we.nss=void 0,!fe.tolerant&&(!we.uuid||!we.uuid.match(he))&&(we.error=we.error||"UUID is not valid."),we},serialize:function(ee,fe){var we=ee;return we.nss=(ee.uuid||"").toLowerCase(),we}};O[H.scheme]=H,O[k.scheme]=k,O[re.scheme]=re,O[pe.scheme]=pe,O[M.scheme]=M,O[ne.scheme]=ne,O[Ie.scheme]=Ie,t.SCHEMES=O,t.pctEncChar=K,t.pctDecChars=X,t.parse=$e,t.removeDotSegments=Ve,t.serialize=Be,t.resolveComponents=et,t.resolve=Ye,t.normalize=We,t.equal=rt,t.escapeComponent=tt,t.unescapeComponent=St,Object.defineProperty(t,"__esModule",{value:!0})})}(zh,zh.exports)),zh.exports}var pS,HD;function wI(){return HD||(HD=1,pS=function n(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var r,i,a;if(Array.isArray(e)){if(r=e.length,r!=t.length)return!1;for(i=r;i--!==0;)if(!n(e[i],t[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(a=Object.keys(e),r=a.length,r!==Object.keys(t).length)return!1;for(i=r;i--!==0;)if(!Object.prototype.hasOwnProperty.call(t,a[i]))return!1;for(i=r;i--!==0;){var s=a[i];if(!n(e[s],t[s]))return!1}return!0}return e!==e&&t!==t}),pS}var mS,GD;function LZ(){return GD||(GD=1,mS=function(e){for(var t=0,r=e.length,i=0,a;i<r;)t++,a=e.charCodeAt(i++),a>=55296&&a<=56319&&i<r&&(a=e.charCodeAt(i),(a&64512)==56320&&i++);return t}),mS}var gS,WD;function md(){if(WD)return gS;WD=1,gS={copy:n,checkDataType:e,checkDataTypes:t,coerceToTypes:i,toHash:a,getProperty:u,escapeQuotes:c,equal:wI(),ucs2length:LZ(),varOccurences:d,varReplace:p,schemaHasRules:m,schemaHasRulesExcept:y,schemaUnknownRules:b,toQuotedString:w,getPathExpr:S,getPath:T,getData:I,unescapeFragment:L,unescapeJsonPointer:B,escapeFragment:U,escapeJsonPointer:N};function n(q,J){J=J||{};for(var V in q)J[V]=q[V];return J}function e(q,J,V,de){var ae=de?" !== ":" === ",ue=de?" || ":" && ",te=de?"!":"",oe=de?"":"!";switch(q){case"null":return J+ae+"null";case"array":return te+"Array.isArray("+J+")";case"object":return"("+te+J+ue+"typeof "+J+ae+'"object"'+ue+oe+"Array.isArray("+J+"))";case"integer":return"(typeof "+J+ae+'"number"'+ue+oe+"("+J+" % 1)"+ue+J+ae+J+(V?ue+te+"isFinite("+J+")":"")+")";case"number":return"(typeof "+J+ae+'"'+q+'"'+(V?ue+te+"isFinite("+J+")":"")+")";default:return"typeof "+J+ae+'"'+q+'"'}}function t(q,J,V){switch(q.length){case 1:return e(q[0],J,V,!0);default:var de="",ae=a(q);ae.array&&ae.object&&(de=ae.null?"(":"(!"+J+" || ",de+="typeof "+J+' !== "object")',delete ae.null,delete ae.array,delete ae.object),ae.number&&delete ae.integer;for(var ue in ae)de+=(de?" && ":"")+e(ue,J,V,!0);return de}}var r=a(["string","number","integer","boolean","null"]);function i(q,J){if(Array.isArray(J)){for(var V=[],de=0;de<J.length;de++){var ae=J[de];(r[ae]||q==="array"&&ae==="array")&&(V[V.length]=ae)}if(V.length)return V}else{if(r[J])return[J];if(q==="array"&&J==="array")return["array"]}}function a(q){for(var J={},V=0;V<q.length;V++)J[q[V]]=!0;return J}var s=/^[a-z$_][a-z$_0-9]*$/i,o=/'|\\/g;function u(q){return typeof q=="number"?"["+q+"]":s.test(q)?"."+q:"['"+c(q)+"']"}function c(q){return q.replace(o,"\\$&").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\f/g,"\\f").replace(/\t/g,"\\t")}function d(q,J){J+="[^0-9]";var V=q.match(new RegExp(J,"g"));return V?V.length:0}function p(q,J,V){return J+="([^0-9])",V=V.replace(/\$/g,"$$$$"),q.replace(new RegExp(J,"g"),V+"$1")}function m(q,J){if(typeof q=="boolean")return!q;for(var V in q)if(J[V])return!0}function y(q,J,V){if(typeof q=="boolean")return!q&&V!="not";for(var de in q)if(de!=V&&J[de])return!0}function b(q,J){if(typeof q!="boolean"){for(var V in q)if(!J[V])return V}}function w(q){return"'"+c(q)+"'"}function S(q,J,V,de){var ae=V?"'/' + "+J+(de?"":".replace(/~/g, '~0').replace(/\\//g, '~1')"):de?"'[' + "+J+" + ']'":"'[\\'' + "+J+" + '\\']'";return x(q,ae)}function T(q,J,V){var de=w(V?"/"+N(J):u(J));return x(q,de)}var C=/^\/(?:[^~]|~0|~1)*$/,A=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function I(q,J,V){var de,ae,ue,te;if(q==="")return"rootData";if(q[0]=="/"){if(!C.test(q))throw new Error("Invalid JSON-pointer: "+q);ae=q,ue="rootData"}else{if(te=q.match(A),!te)throw new Error("Invalid JSON-pointer: "+q);if(de=+te[1],ae=te[2],ae=="#"){if(de>=J)throw new Error("Cannot access property/index "+de+" levels up, current level is "+J);return V[J-de]}if(de>J)throw new Error("Cannot access data "+de+" levels up, current level is "+J);if(ue="data"+(J-de||""),!ae)return ue}for(var oe=ue,ge=ae.split("/"),Ee=0;Ee<ge.length;Ee++){var Y=ge[Ee];Y&&(ue+=u(B(Y)),oe+=" && "+ue)}return oe}function x(q,J){return q=='""'?J:(q+" + "+J).replace(/([^\\])' \+ '/g,"$1")}function L(q){return B(decodeURIComponent(q))}function U(q){return encodeURIComponent(N(q))}function N(q){return q.replace(/~/g,"~0").replace(/\//g,"~1")}function B(q){return q.replace(/~1/g,"/").replace(/~0/g,"~")}return gS}var yS,KD;function E3(){if(KD)return yS;KD=1;var n=md();yS=e;function e(t){n.copy(t,this)}return yS}var vS={exports:{}},JD;function UZ(){if(JD)return vS.exports;JD=1;var n=vS.exports=function(r,i,a){typeof i=="function"&&(a=i,i={}),a=i.cb||a;var s=typeof a=="function"?a:a.pre||function(){},o=a.post||function(){};e(i,s,o,r,"",r)};n.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0},n.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},n.propsKeywords={definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},n.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function e(r,i,a,s,o,u,c,d,p,m){if(s&&typeof s=="object"&&!Array.isArray(s)){i(s,o,u,c,d,p,m);for(var y in s){var b=s[y];if(Array.isArray(b)){if(y in n.arrayKeywords)for(var w=0;w<b.length;w++)e(r,i,a,b[w],o+"/"+y+"/"+w,u,o,y,s,w)}else if(y in n.propsKeywords){if(b&&typeof b=="object")for(var S in b)e(r,i,a,b[S],o+"/"+y+"/"+t(S),u,o,y,s,S)}else(y in n.keywords||r.allKeys&&!(y in n.skipKeywords))&&e(r,i,a,b,o+"/"+y,u,o,y,s)}a(s,o,u,c,d,p,m)}}function t(r){return r.replace(/~/g,"~0").replace(/\//g,"~1")}return vS.exports}var _S,YD;function EI(){if(YD)return _S;YD=1;var n=$Z(),e=wI(),t=md(),r=E3(),i=UZ();_S=a,a.normalizeId=T,a.fullPath=b,a.url=C,a.ids=A,a.inlineRef=p,a.schema=s;function a(I,x,L){var U=this._refs[L];if(typeof U=="string")if(this._refs[U])U=this._refs[U];else return a.call(this,I,x,U);if(U=U||this._schemas[L],U instanceof r)return p(U.schema,this._opts.inlineRefs)?U.schema:U.validate||this._compile(U);var N=s.call(this,x,L),B,q,J;return N&&(B=N.schema,x=N.root,J=N.baseId),B instanceof r?q=B.validate||I.call(this,B.schema,x,void 0,J):B!==void 0&&(q=p(B,this._opts.inlineRefs)?B:I.call(this,B,x,void 0,J)),q}function s(I,x){var L=n.parse(x),U=w(L),N=b(this._getId(I.schema));if(Object.keys(I.schema).length===0||U!==N){var B=T(U),q=this._refs[B];if(typeof q=="string")return o.call(this,I,q,L);if(q instanceof r)q.validate||this._compile(q),I=q;else if(q=this._schemas[B],q instanceof r){if(q.validate||this._compile(q),B==T(x))return{schema:q,root:I,baseId:N};I=q}else return;if(!I.schema)return;N=b(this._getId(I.schema))}return c.call(this,L,N,I.schema,I)}function o(I,x,L){var U=s.call(this,I,x);if(U){var N=U.schema,B=U.baseId;I=U.root;var q=this._getId(N);return q&&(B=C(B,q)),c.call(this,L,B,N,I)}}var u=t.toHash(["properties","patternProperties","enum","dependencies","definitions"]);function c(I,x,L,U){if(I.fragment=I.fragment||"",I.fragment.slice(0,1)=="/"){for(var N=I.fragment.split("/"),B=1;B<N.length;B++){var q=N[B];if(q){if(q=t.unescapeFragment(q),L=L[q],L===void 0)break;var J;if(!u[q]&&(J=this._getId(L),J&&(x=C(x,J)),L.$ref)){var V=C(x,L.$ref),de=s.call(this,U,V);de&&(L=de.schema,U=de.root,x=de.baseId)}}}if(L!==void 0&&L!==U.schema)return{schema:L,root:U,baseId:x}}}var d=t.toHash(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum"]);function p(I,x){if(x===!1)return!1;if(x===void 0||x===!0)return m(I);if(x)return y(I)<=x}function m(I){var x;if(Array.isArray(I)){for(var L=0;L<I.length;L++)if(x=I[L],typeof x=="object"&&!m(x))return!1}else for(var U in I)if(U=="$ref"||(x=I[U],typeof x=="object"&&!m(x)))return!1;return!0}function y(I){var x=0,L;if(Array.isArray(I)){for(var U=0;U<I.length;U++)if(L=I[U],typeof L=="object"&&(x+=y(L)),x==1/0)return 1/0}else for(var N in I){if(N=="$ref")return 1/0;if(d[N])x++;else if(L=I[N],typeof L=="object"&&(x+=y(L)+1),x==1/0)return 1/0}return x}function b(I,x){x!==!1&&(I=T(I));var L=n.parse(I);return w(L)}function w(I){return n.serialize(I).split("#")[0]+"#"}var S=/#\/?$/;function T(I){return I?I.replace(S,""):""}function C(I,x){return x=T(x),n.resolve(I,x)}function A(I){var x=T(this._getId(I)),L={"":x},U={"":b(x,!1)},N={},B=this;return i(I,{allKeys:!0},function(q,J,V,de,ae,ue,te){if(J!==""){var oe=B._getId(q),ge=L[de],Ee=U[de]+"/"+ae;if(te!==void 0&&(Ee+="/"+(typeof te=="number"?te:t.escapeFragment(te))),typeof oe=="string"){oe=ge=T(ge?n.resolve(ge,oe):oe);var Y=B._refs[oe];if(typeof Y=="string"&&(Y=B._refs[Y]),Y&&Y.schema){if(!e(q,Y.schema))throw new Error('id "'+oe+'" resolves to more than one schema')}else if(oe!=T(Ee))if(oe[0]=="#"){if(N[oe]&&!e(q,N[oe]))throw new Error('id "'+oe+'" resolves to more than one schema');N[oe]=q}else B._refs[oe]=Ee}L[J]=ge,U[J]=Ee}}),N}return _S}var bS,ZD;function SI(){if(ZD)return bS;ZD=1;var n=EI();bS={Validation:r(e),MissingRef:r(t)};function e(i){this.message="validation failed",this.errors=i,this.ajv=this.validation=!0}t.message=function(i,a){return"can't resolve reference "+a+" from id "+i};function t(i,a,s){this.message=s||t.message(i,a),this.missingRef=n.url(i,a),this.missingSchema=n.normalizeId(n.fullPath(this.missingRef))}function r(i){return i.prototype=Object.create(Error.prototype),i.prototype.constructor=i,i}return bS}var wS,XD;function S3(){return XD||(XD=1,wS=function(n,e){e||(e={}),typeof e=="function"&&(e={cmp:e});var t=typeof e.cycles=="boolean"?e.cycles:!1,r=e.cmp&&function(a){return function(s){return function(o,u){var c={key:o,value:s[o]},d={key:u,value:s[u]};return a(c,d)}}}(e.cmp),i=[];return function a(s){if(s&&s.toJSON&&typeof s.toJSON=="function"&&(s=s.toJSON()),s!==void 0){if(typeof s=="number")return isFinite(s)?""+s:"null";if(typeof s!="object")return JSON.stringify(s);var o,u;if(Array.isArray(s)){for(u="[",o=0;o<s.length;o++)o&&(u+=","),u+=a(s[o])||"null";return u+"]"}if(s===null)return"null";if(i.indexOf(s)!==-1){if(t)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var c=i.push(s)-1,d=Object.keys(s).sort(r&&r(s));for(u="",o=0;o<d.length;o++){var p=d[o],m=a(s[p]);m&&(u&&(u+=","),u+=JSON.stringify(p)+":"+m)}return i.splice(c,1),"{"+u+"}"}}(n)}),wS}var ES,QD;function T3(){return QD||(QD=1,ES=function(e,t,r){var i="",a=e.schema.$async===!0,s=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"),o=e.self._getId(e.schema);if(e.opts.strictKeywords){var u=e.util.schemaUnknownRules(e.schema,e.RULES.keywords);if(u){var c="unknown keyword: "+u;if(e.opts.strictKeywords==="log")e.logger.warn(c);else throw new Error(c)}}if(e.isTop&&(i+=" var validate = ",a&&(e.async=!0,i+="async "),i+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",o&&(e.opts.sourceCode||e.opts.processCode)&&(i+=" "+("/*# sourceURL="+o+" */")+" ")),typeof e.schema=="boolean"||!(s||e.schema.$ref)){var t="false schema",d=e.level,p=e.dataLevel,m=e.schema[t],y=e.schemaPath+e.util.getProperty(t),b=e.errSchemaPath+"/"+t,x=!e.opts.allErrors,N,w="data"+(p||""),I="valid"+d;if(e.schema===!1){e.isTop?x=!0:i+=" var "+I+" = false; ";var S=S||[];S.push(i),i="",e.createErrors!==!1?(i+=" { keyword: '"+(N||"false schema")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(b)+" , params: {} ",e.opts.messages!==!1&&(i+=" , message: 'boolean schema is false' "),e.opts.verbose&&(i+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+w+" "),i+=" } "):i+=" {} ";var T=i;i=S.pop(),!e.compositeRule&&x?e.async?i+=" throw new ValidationError(["+T+"]); ":i+=" validate.errors = ["+T+"]; return false; ":i+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else e.isTop?a?i+=" return data; ":i+=" validate.errors = null; return true; ":i+=" var "+I+" = true; ";return e.isTop&&(i+=" }; return validate; "),i}if(e.isTop){var C=e.isTop,d=e.level=0,p=e.dataLevel=0,w="data";if(e.rootId=e.resolve.fullPath(e.self._getId(e.root.schema)),e.baseId=e.baseId||e.rootId,delete e.isTop,e.dataPathArr=[""],e.schema.default!==void 0&&e.opts.useDefaults&&e.opts.strictDefaults){var A="default is ignored in the schema root";if(e.opts.strictDefaults==="log")e.logger.warn(A);else throw new Error(A)}i+=" var vErrors = null; ",i+=" var errors = 0;     ",i+=" if (rootData === undefined) rootData = data; "}else{var d=e.level,p=e.dataLevel,w="data"+(p||"");if(o&&(e.baseId=e.resolve.url(e.baseId,o)),a&&!e.async)throw new Error("async schema in sync schema");i+=" var errs_"+d+" = errors;"}var I="valid"+d,x=!e.opts.allErrors,L="",U="",N,B=e.schema.type,q=Array.isArray(B);if(B&&e.opts.nullable&&e.schema.nullable===!0&&(q?B.indexOf("null")==-1&&(B=B.concat("null")):B!="null"&&(B=[B,"null"],q=!0)),q&&B.length==1&&(B=B[0],q=!1),e.schema.$ref&&s){if(e.opts.extendRefs=="fail")throw new Error('$ref: validation keywords used in schema at path "'+e.errSchemaPath+'" (see option extendRefs)');e.opts.extendRefs!==!0&&(s=!1,e.logger.warn('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"'))}if(e.schema.$comment&&e.opts.$comment&&(i+=" "+e.RULES.all.$comment.code(e,"$comment")),B){if(e.opts.coerceTypes)var J=e.util.coerceToTypes(e.opts.coerceTypes,B);var V=e.RULES.types[B];if(J||q||V===!0||V&&!Oe(V)){var y=e.schemaPath+".type",b=e.errSchemaPath+"/type",y=e.schemaPath+".type",b=e.errSchemaPath+"/type",de=q?"checkDataTypes":"checkDataType";if(i+=" if ("+e.util[de](B,w,e.opts.strictNumbers,!0)+") { ",J){var ae="dataType"+d,ue="coerced"+d;i+=" var "+ae+" = typeof "+w+"; var "+ue+" = undefined; ",e.opts.coerceTypes=="array"&&(i+=" if ("+ae+" == 'object' && Array.isArray("+w+") && "+w+".length == 1) { "+w+" = "+w+"[0]; "+ae+" = typeof "+w+"; if ("+e.util.checkDataType(e.schema.type,w,e.opts.strictNumbers)+") "+ue+" = "+w+"; } "),i+=" if ("+ue+" !== undefined) ; ";var te=J;if(te)for(var oe,ge=-1,Ee=te.length-1;ge<Ee;)oe=te[ge+=1],oe=="string"?i+=" else if ("+ae+" == 'number' || "+ae+" == 'boolean') "+ue+" = '' + "+w+"; else if ("+w+" === null) "+ue+" = ''; ":oe=="number"||oe=="integer"?(i+=" else if ("+ae+" == 'boolean' || "+w+" === null || ("+ae+" == 'string' && "+w+" && "+w+" == +"+w+" ",oe=="integer"&&(i+=" && !("+w+" % 1)"),i+=")) "+ue+" = +"+w+"; "):oe=="boolean"?i+=" else if ("+w+" === 'false' || "+w+" === 0 || "+w+" === null) "+ue+" = false; else if ("+w+" === 'true' || "+w+" === 1) "+ue+" = true; ":oe=="null"?i+=" else if ("+w+" === '' || "+w+" === 0 || "+w+" === false) "+ue+" = null; ":e.opts.coerceTypes=="array"&&oe=="array"&&(i+=" else if ("+ae+" == 'string' || "+ae+" == 'number' || "+ae+" == 'boolean' || "+w+" == null) "+ue+" = ["+w+"]; ");i+=" else {   ";var S=S||[];S.push(i),i="",e.createErrors!==!1?(i+=" { keyword: '"+(N||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(b)+" , params: { type: '",q?i+=""+B.join(","):i+=""+B,i+="' } ",e.opts.messages!==!1&&(i+=" , message: 'should be ",q?i+=""+B.join(","):i+=""+B,i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+y+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+w+" "),i+=" } "):i+=" {} ";var T=i;i=S.pop(),!e.compositeRule&&x?e.async?i+=" throw new ValidationError(["+T+"]); ":i+=" validate.errors = ["+T+"]; return false; ":i+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } if ("+ue+" !== undefined) {  ";var Y=p?"data"+(p-1||""):"parentData",ve=p?e.dataPathArr[p]:"parentDataProperty";i+=" "+w+" = "+ue+"; ",p||(i+="if ("+Y+" !== undefined)"),i+=" "+Y+"["+ve+"] = "+ue+"; } "}else{var S=S||[];S.push(i),i="",e.createErrors!==!1?(i+=" { keyword: '"+(N||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(b)+" , params: { type: '",q?i+=""+B.join(","):i+=""+B,i+="' } ",e.opts.messages!==!1&&(i+=" , message: 'should be ",q?i+=""+B.join(","):i+=""+B,i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+y+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+w+" "),i+=" } "):i+=" {} ";var T=i;i=S.pop(),!e.compositeRule&&x?e.async?i+=" throw new ValidationError(["+T+"]); ":i+=" validate.errors = ["+T+"]; return false; ":i+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}i+=" } "}}if(e.schema.$ref&&!s)i+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",x&&(i+=" } if (errors === ",C?i+="0":i+="errs_"+d,i+=") { ",U+="}");else{var Re=e.RULES;if(Re){for(var V,Q=-1,ie=Re.length-1;Q<ie;)if(V=Re[Q+=1],Oe(V)){if(V.type&&(i+=" if ("+e.util.checkDataType(V.type,w,e.opts.strictNumbers)+") { "),e.opts.useDefaults){if(V.type=="object"&&e.schema.properties){var m=e.schema.properties,ce=Object.keys(m),P=ce;if(P)for(var O,K=-1,X=P.length-1;K<X;){O=P[K+=1];var se=m[O];if(se.default!==void 0){var F=w+e.util.getProperty(O);if(e.compositeRule){if(e.opts.strictDefaults){var A="default is ignored for: "+F;if(e.opts.strictDefaults==="log")e.logger.warn(A);else throw new Error(A)}}else i+=" if ("+F+" === undefined ",e.opts.useDefaults=="empty"&&(i+=" || "+F+" === null || "+F+" === '' "),i+=" ) "+F+" = ",e.opts.useDefaults=="shared"?i+=" "+e.useDefault(se.default)+" ":i+=" "+JSON.stringify(se.default)+" ",i+="; "}}}else if(V.type=="array"&&Array.isArray(e.schema.items)){var z=e.schema.items;if(z){for(var se,ge=-1,ye=z.length-1;ge<ye;)if(se=z[ge+=1],se.default!==void 0){var F=w+"["+ge+"]";if(e.compositeRule){if(e.opts.strictDefaults){var A="default is ignored for: "+F;if(e.opts.strictDefaults==="log")e.logger.warn(A);else throw new Error(A)}}else i+=" if ("+F+" === undefined ",e.opts.useDefaults=="empty"&&(i+=" || "+F+" === null || "+F+" === '' "),i+=" ) "+F+" = ",e.opts.useDefaults=="shared"?i+=" "+e.useDefault(se.default)+" ":i+=" "+JSON.stringify(se.default)+" ",i+="; "}}}}var ke=V.rules;if(ke){for(var Qe,$e=-1,ze=ke.length-1;$e<ze;)if(Qe=ke[$e+=1],qe(Qe)){var xt=Qe.code(e,Qe.keyword,V.type);xt&&(i+=" "+xt+" ",x&&(L+="}"))}}if(x&&(i+=" "+L+" ",L=""),V.type&&(i+=" } ",B&&B===V.type&&!J)){i+=" else { ";var y=e.schemaPath+".type",b=e.errSchemaPath+"/type",S=S||[];S.push(i),i="",e.createErrors!==!1?(i+=" { keyword: '"+(N||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(b)+" , params: { type: '",q?i+=""+B.join(","):i+=""+B,i+="' } ",e.opts.messages!==!1&&(i+=" , message: 'should be ",q?i+=""+B.join(","):i+=""+B,i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+y+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+w+" "),i+=" } "):i+=" {} ";var T=i;i=S.pop(),!e.compositeRule&&x?e.async?i+=" throw new ValidationError(["+T+"]); ":i+=" validate.errors = ["+T+"]; return false; ":i+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } "}x&&(i+=" if (errors === ",C?i+="0":i+="errs_"+d,i+=") { ",U+="}")}}}x&&(i+=" "+U+" "),C?(a?(i+=" if (errors === 0) return data;           ",i+=" else throw new ValidationError(vErrors); "):(i+=" validate.errors = vErrors; ",i+=" return errors === 0;       "),i+=" }; return validate;"):i+=" var "+I+" = errors === errs_"+d+";";function Oe(Ve){for(var Be=Ve.rules,et=0;et<Be.length;et++)if(qe(Be[et]))return!0}function qe(Ve){return e.schema[Ve.keyword]!==void 0||Ve.implements&&It(Ve)}function It(Ve){for(var Be=Ve.implements,et=0;et<Be.length;et++)if(e.schema[Be[et]]!==void 0)return!0}return i}),ES}var SS,e$;function jZ(){if(e$)return SS;e$=1;var n=EI(),e=md(),t=SI(),r=S3(),i=T3(),a=e.ucs2length,s=wI(),o=t.Validation;SS=u;function u(T,C,A,I){var x=this,L=this._opts,U=[void 0],N={},B=[],q={},J=[],V={},de=[];C=C||{schema:T,refVal:U,refs:N};var ae=c.call(this,T,C,I),ue=this._compilations[ae.index];if(ae.compiling)return ue.callValidate=Y;var te=this._formats,oe=this.RULES;try{var ge=ve(T,C,A,I);ue.validate=ge;var Ee=ue.callValidate;return Ee&&(Ee.schema=ge.schema,Ee.errors=null,Ee.refs=ge.refs,Ee.refVal=ge.refVal,Ee.root=ge.root,Ee.$async=ge.$async,L.sourceCode&&(Ee.source=ge.source)),ge}finally{d.call(this,T,C,I)}function Y(){var se=ue.validate,F=se.apply(this,arguments);return Y.errors=se.errors,F}function ve(se,F,z,ye){var ke=!F||F&&F.schema==se;if(F.schema!=C.schema)return u.call(x,se,F,z,ye);var Qe=se.$async===!0,$e=i({isTop:!0,schema:se,isRoot:ke,baseId:ye,root:F,schemaPath:"",errSchemaPath:"#",errorPath:'""',MissingRefError:t.MissingRef,RULES:oe,validate:i,util:e,resolve:n,resolveRef:Re,usePattern:O,useDefault:K,useCustomRule:X,opts:L,formats:te,logger:x.logger,self:x});$e=S(U,b)+S(B,m)+S(J,y)+S(de,w)+$e,L.processCode&&($e=L.processCode($e,se));var ze;try{var xt=new Function("self","RULES","formats","root","refVal","defaults","customRules","equal","ucs2length","ValidationError",$e);ze=xt(x,oe,te,C,U,J,de,s,a,o),U[0]=ze}catch(Oe){throw x.logger.error("Error compiling schema, function code:",$e),Oe}return ze.schema=se,ze.errors=null,ze.refs=N,ze.refVal=U,ze.root=ke?ze:F,Qe&&(ze.$async=!0),L.sourceCode===!0&&(ze.source={code:$e,patterns:B,defaults:J}),ze}function Re(se,F,z){F=n.url(se,F);var ye=N[F],ke,Qe;if(ye!==void 0)return ke=U[ye],Qe="refVal["+ye+"]",P(ke,Qe);if(!z&&C.refs){var $e=C.refs[F];if($e!==void 0)return ke=C.refVal[$e],Qe=Q(F,ke),P(ke,Qe)}Qe=Q(F);var ze=n.call(x,ve,C,F);if(ze===void 0){var xt=A&&A[F];xt&&(ze=n.inlineRef(xt,L.inlineRefs)?xt:u.call(x,xt,C,A,se))}if(ze===void 0)ie(F);else return ce(F,ze),P(ze,Qe)}function Q(se,F){var z=U.length;return U[z]=F,N[se]=z,"refVal"+z}function ie(se){delete N[se]}function ce(se,F){var z=N[se];U[z]=F}function P(se,F){return typeof se=="object"||typeof se=="boolean"?{code:F,schema:se,inline:!0}:{code:F,$async:se&&!!se.$async}}function O(se){var F=q[se];return F===void 0&&(F=q[se]=B.length,B[F]=se),"pattern"+F}function K(se){switch(typeof se){case"boolean":case"number":return""+se;case"string":return e.toQuotedString(se);case"object":if(se===null)return"null";var F=r(se),z=V[F];return z===void 0&&(z=V[F]=J.length,J[z]=se),"default"+z}}function X(se,F,z,ye){if(x._opts.validateSchema!==!1){var ke=se.definition.dependencies;if(ke&&!ke.every(function(Be){return Object.prototype.hasOwnProperty.call(z,Be)}))throw new Error("parent schema must have all required keywords: "+ke.join(","));var Qe=se.definition.validateSchema;if(Qe){var $e=Qe(F);if(!$e){var ze="keyword schema is invalid: "+x.errorsText(Qe.errors);if(x._opts.validateSchema=="log")x.logger.error(ze);else throw new Error(ze)}}}var xt=se.definition.compile,Oe=se.definition.inline,qe=se.definition.macro,It;if(xt)It=xt.call(x,F,z,ye);else if(qe)It=qe.call(x,F,z,ye),L.validateSchema!==!1&&x.validateSchema(It,!0);else if(Oe)It=Oe.call(x,ye,se.keyword,F,z);else if(It=se.definition.validate,!It)return;if(It===void 0)throw new Error('custom keyword "'+se.keyword+'"failed to compile');var Ve=de.length;return de[Ve]=It,{code:"customRule"+Ve,validate:It}}}function c(T,C,A){var I=p.call(this,T,C,A);return I>=0?{index:I,compiling:!0}:(I=this._compilations.length,this._compilations[I]={schema:T,root:C,baseId:A},{index:I,compiling:!1})}function d(T,C,A){var I=p.call(this,T,C,A);I>=0&&this._compilations.splice(I,1)}function p(T,C,A){for(var I=0;I<this._compilations.length;I++){var x=this._compilations[I];if(x.schema==T&&x.root==C&&x.baseId==A)return I}return-1}function m(T,C){return"var pattern"+T+" = new RegExp("+e.toQuotedString(C[T])+");"}function y(T){return"var default"+T+" = defaults["+T+"];"}function b(T,C){return C[T]===void 0?"":"var refVal"+T+" = refVal["+T+"];"}function w(T){return"var customRule"+T+" = customRules["+T+"];"}function S(T,C){if(!T.length)return"";for(var A="",I=0;I<T.length;I++)A+=C(I,T);return A}return SS}var TS={exports:{}},t$;function FZ(){if(t$)return TS.exports;t$=1;var n=TS.exports=function(){this._cache={}};return n.prototype.put=function(t,r){this._cache[t]=r},n.prototype.get=function(t){return this._cache[t]},n.prototype.del=function(t){delete this._cache[t]},n.prototype.clear=function(){this._cache={}},TS.exports}var AS,n$;function BZ(){if(n$)return AS;n$=1;var n=md(),e=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,t=[0,31,28,31,30,31,30,31,31,30,31,30,31],r=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i,i=/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,a=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,s=/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,o=/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,u=/^(?:(?:http[s\u017F]?|ftp):\/\/)(?:(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+(?::(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?@)?(?:(?!10(?:\.[0-9]{1,3}){3})(?!127(?:\.[0-9]{1,3}){3})(?!169\.254(?:\.[0-9]{1,3}){2})(?!192\.168(?:\.[0-9]{1,3}){2})(?!172\.(?:1[6-9]|2[0-9]|3[01])(?:\.[0-9]{1,3}){2})(?:[1-9][0-9]?|1[0-9][0-9]|2[01][0-9]|22[0-3])(?:\.(?:1?[0-9]{1,2}|2[0-4][0-9]|25[0-5])){2}(?:\.(?:[1-9][0-9]?|1[0-9][0-9]|2[0-4][0-9]|25[0-4]))|(?:(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)(?:\.(?:(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+-)*(?:[0-9a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])+)*(?:\.(?:(?:[a-z\xA1-\uD7FF\uE000-\uFFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF]){2,})))(?::[0-9]{2,5})?(?:\/(?:[\0-\x08\x0E-\x1F!-\x9F\xA1-\u167F\u1681-\u1FFF\u200B-\u2027\u202A-\u202E\u2030-\u205E\u2060-\u2FFF\u3001-\uD7FF\uE000-\uFEFE\uFF00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]|[\uD800-\uDBFF](?![\uDC00-\uDFFF])|(?:[^\uD800-\uDBFF]|^)[\uDC00-\uDFFF])*)?$/i,c=/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,d=/^(?:\/(?:[^~/]|~0|~1)*)*$/,p=/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,m=/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/;AS=y;function y(U){return U=U=="full"?"full":"fast",n.copy(y[U])}y.fast={date:/^\d\d\d\d-[0-1]\d-[0-3]\d$/,time:/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,"date-time":/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,"uri-template":o,url:u,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i,hostname:i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:L,uuid:c,"json-pointer":d,"json-pointer-uri-fragment":p,"relative-json-pointer":m},y.full={date:w,time:S,"date-time":C,uri:I,"uri-reference":s,"uri-template":o,url:u,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^\s*(?:(?:(?:[0-9a-f]{1,4}:){7}(?:[0-9a-f]{1,4}|:))|(?:(?:[0-9a-f]{1,4}:){6}(?::[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){5}(?:(?:(?::[0-9a-f]{1,4}){1,2})|:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(?:(?:[0-9a-f]{1,4}:){4}(?:(?:(?::[0-9a-f]{1,4}){1,3})|(?:(?::[0-9a-f]{1,4})?:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){3}(?:(?:(?::[0-9a-f]{1,4}){1,4})|(?:(?::[0-9a-f]{1,4}){0,2}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){2}(?:(?:(?::[0-9a-f]{1,4}){1,5})|(?:(?::[0-9a-f]{1,4}){0,3}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?:(?:[0-9a-f]{1,4}:){1}(?:(?:(?::[0-9a-f]{1,4}){1,6})|(?:(?::[0-9a-f]{1,4}){0,4}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(?::(?:(?:(?::[0-9a-f]{1,4}){1,7})|(?:(?::[0-9a-f]{1,4}){0,5}:(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(?:\.(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(?:%.+)?\s*$/i,regex:L,uuid:c,"json-pointer":d,"json-pointer-uri-fragment":p,"relative-json-pointer":m};function b(U){return U%4===0&&(U%100!==0||U%400===0)}function w(U){var N=U.match(e);if(!N)return!1;var B=+N[1],q=+N[2],J=+N[3];return q>=1&&q<=12&&J>=1&&J<=(q==2&&b(B)?29:t[q])}function S(U,N){var B=U.match(r);if(!B)return!1;var q=B[1],J=B[2],V=B[3],de=B[5];return(q<=23&&J<=59&&V<=59||q==23&&J==59&&V==60)&&(!N||de)}var T=/t|\s/i;function C(U){var N=U.split(T);return N.length==2&&w(N[0])&&S(N[1],!0)}var A=/\/|:/;function I(U){return A.test(U)&&a.test(U)}var x=/[^\\]\\Z/;function L(U){if(x.test(U))return!1;try{return new RegExp(U),!0}catch{return!1}}return AS}var CS,r$;function qZ(){return r$||(r$=1,CS=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.errSchemaPath+"/"+t,c=!e.opts.allErrors,d="data"+(s||""),p="valid"+a,m,y;if(o=="#"||o=="#/")e.isRoot?(m=e.async,y="validate"):(m=e.root.schema.$async===!0,y="root.refVal[0]");else{var b=e.resolveRef(e.baseId,o,e.isRoot);if(b===void 0){var w=e.MissingRefError.message(e.baseId,o);if(e.opts.missingRefs=="fail"){e.logger.error(w);var S=S||[];S.push(i),i="",e.createErrors!==!1?(i+=" { keyword: '$ref' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(u)+" , params: { ref: '"+e.util.escapeQuotes(o)+"' } ",e.opts.messages!==!1&&(i+=" , message: 'can\\'t resolve reference "+e.util.escapeQuotes(o)+"' "),e.opts.verbose&&(i+=" , schema: "+e.util.toQuotedString(o)+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+d+" "),i+=" } "):i+=" {} ";var T=i;i=S.pop(),!e.compositeRule&&c?e.async?i+=" throw new ValidationError(["+T+"]); ":i+=" validate.errors = ["+T+"]; return false; ":i+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c&&(i+=" if (false) { ")}else if(e.opts.missingRefs=="ignore")e.logger.warn(w),c&&(i+=" if (true) { ");else throw new e.MissingRefError(e.baseId,o,w)}else if(b.inline){var C=e.util.copy(e);C.level++;var A="valid"+C.level;C.schema=b.schema,C.schemaPath="",C.errSchemaPath=o;var I=e.validate(C).replace(/validate\.schema/g,b.code);i+=" "+I+" ",c&&(i+=" if ("+A+") { ")}else m=b.$async===!0||e.async&&b.$async!==!1,y=b.code}if(y){var S=S||[];S.push(i),i="",e.opts.passContext?i+=" "+y+".call(this, ":i+=" "+y+"( ",i+=" "+d+", (dataPath || '')",e.errorPath!='""'&&(i+=" + "+e.errorPath);var x=s?"data"+(s-1||""):"parentData",L=s?e.dataPathArr[s]:"parentDataProperty";i+=" , "+x+" , "+L+", rootData)  ";var U=i;if(i=S.pop(),m){if(!e.async)throw new Error("async schema referenced by sync schema");c&&(i+=" var "+p+"; "),i+=" try { await "+U+"; ",c&&(i+=" "+p+" = true; "),i+=" } catch (e) { if (!(e instanceof ValidationError)) throw e; if (vErrors === null) vErrors = e.errors; else vErrors = vErrors.concat(e.errors); errors = vErrors.length; ",c&&(i+=" "+p+" = false; "),i+=" } ",c&&(i+=" if ("+p+") { ")}else i+=" if (!"+U+") { if (vErrors === null) vErrors = "+y+".errors; else vErrors = vErrors.concat("+y+".errors); errors = vErrors.length; } ",c&&(i+=" else { ")}return i}),CS}var RS,i$;function VZ(){return i$||(i$=1,RS=function(e,t,r){var i=" ",a=e.schema[t],s=e.schemaPath+e.util.getProperty(t),o=e.errSchemaPath+"/"+t,u=!e.opts.allErrors,c=e.util.copy(e),d="";c.level++;var p="valid"+c.level,m=c.baseId,y=!0,b=a;if(b)for(var w,S=-1,T=b.length-1;S<T;)w=b[S+=1],(e.opts.strictKeywords?typeof w=="object"&&Object.keys(w).length>0||w===!1:e.util.schemaHasRules(w,e.RULES.all))&&(y=!1,c.schema=w,c.schemaPath=s+"["+S+"]",c.errSchemaPath=o+"/"+S,i+="  "+e.validate(c)+" ",c.baseId=m,u&&(i+=" if ("+p+") { ",d+="}"));return u&&(y?i+=" if (true) { ":i+=" "+d.slice(0,-1)+" "),i}),RS}var IS,a$;function zZ(){return a$||(a$=1,IS=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,p="data"+(s||""),m="valid"+a,y="errs__"+a,b=e.util.copy(e),w="";b.level++;var S="valid"+b.level,T=o.every(function(N){return e.opts.strictKeywords?typeof N=="object"&&Object.keys(N).length>0||N===!1:e.util.schemaHasRules(N,e.RULES.all)});if(T){var C=b.baseId;i+=" var "+y+" = errors; var "+m+" = false;  ";var A=e.compositeRule;e.compositeRule=b.compositeRule=!0;var I=o;if(I)for(var x,L=-1,U=I.length-1;L<U;)x=I[L+=1],b.schema=x,b.schemaPath=u+"["+L+"]",b.errSchemaPath=c+"/"+L,i+="  "+e.validate(b)+" ",b.baseId=C,i+=" "+m+" = "+m+" || "+S+"; if (!"+m+") { ",w+="}";e.compositeRule=b.compositeRule=A,i+=" "+w+" if (!"+m+") {   var err =   ",e.createErrors!==!1?(i+=" { keyword: 'anyOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",e.opts.messages!==!1&&(i+=" , message: 'should match some schema in anyOf' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(e.async?i+=" throw new ValidationError(vErrors); ":i+=" validate.errors = vErrors; return false; "),i+=" } else {  errors = "+y+"; if (vErrors !== null) { if ("+y+") vErrors.length = "+y+"; else vErrors = null; } ",e.opts.allErrors&&(i+=" } ")}else d&&(i+=" if (true) { ");return i}),IS}var PS,s$;function HZ(){return s$||(s$=1,PS=function(e,t,r){var i=" ",a=e.schema[t],s=e.errSchemaPath+"/"+t;e.opts.allErrors;var o=e.util.toQuotedString(a);return e.opts.$comment===!0?i+=" console.log("+o+");":typeof e.opts.$comment=="function"&&(i+=" self._opts.$comment("+o+", "+e.util.toQuotedString(s)+", validate.root.schema);"),i}),PS}var xS,o$;function GZ(){return o$||(o$=1,xS=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,p="data"+(s||""),m="valid"+a,y=e.opts.$data&&o&&o.$data;y&&(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; "),y||(i+=" var schema"+a+" = validate.schema"+u+";"),i+="var "+m+" = equal("+p+", schema"+a+"); if (!"+m+") {   ";var b=b||[];b.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'const' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { allowedValue: schema"+a+" } ",e.opts.messages!==!1&&(i+=" , message: 'should be equal to constant' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ";var w=i;return i=b.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+w+"]); ":i+=" validate.errors = ["+w+"]; return false; ":i+=" var err = "+w+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" }",d&&(i+=" else { "),i}),xS}var OS,l$;function WZ(){return l$||(l$=1,OS=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,p="data"+(s||""),m="valid"+a,y="errs__"+a,b=e.util.copy(e),w="";b.level++;var S="valid"+b.level,T="i"+a,C=b.dataLevel=e.dataLevel+1,A="data"+C,I=e.baseId,x=e.opts.strictKeywords?typeof o=="object"&&Object.keys(o).length>0||o===!1:e.util.schemaHasRules(o,e.RULES.all);if(i+="var "+y+" = errors;var "+m+";",x){var L=e.compositeRule;e.compositeRule=b.compositeRule=!0,b.schema=o,b.schemaPath=u,b.errSchemaPath=c,i+=" var "+S+" = false; for (var "+T+" = 0; "+T+" < "+p+".length; "+T+"++) { ",b.errorPath=e.util.getPathExpr(e.errorPath,T,e.opts.jsonPointers,!0);var U=p+"["+T+"]";b.dataPathArr[C]=T;var N=e.validate(b);b.baseId=I,e.util.varOccurences(N,A)<2?i+=" "+e.util.varReplace(N,A,U)+" ":i+=" var "+A+" = "+U+"; "+N+" ",i+=" if ("+S+") break; }  ",e.compositeRule=b.compositeRule=L,i+=" "+w+" if (!"+S+") {"}else i+=" if ("+p+".length == 0) {";var B=B||[];B.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'contains' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",e.opts.messages!==!1&&(i+=" , message: 'should contain a valid item' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ";var q=i;return i=B.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+q+"]); ":i+=" validate.errors = ["+q+"]; return false; ":i+=" var err = "+q+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else { ",x&&(i+="  errors = "+y+"; if (vErrors !== null) { if ("+y+") vErrors.length = "+y+"; else vErrors = null; } "),e.opts.allErrors&&(i+=" } "),i}),OS}var NS,u$;function KZ(){return u$||(u$=1,NS=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,p="data"+(s||""),m="errs__"+a,y=e.util.copy(e),b="";y.level++;var w="valid"+y.level,S={},T={},C=e.opts.ownProperties;for(L in o)if(L!="__proto__"){var A=o[L],I=Array.isArray(A)?T:S;I[L]=A}i+="var "+m+" = errors;";var x=e.errorPath;i+="var missing"+a+";";for(var L in T)if(I=T[L],I.length){if(i+=" if ( "+p+e.util.getProperty(L)+" !== undefined ",C&&(i+=" && Object.prototype.hasOwnProperty.call("+p+", '"+e.util.escapeQuotes(L)+"') "),d){i+=" && ( ";var U=I;if(U)for(var N,B=-1,q=U.length-1;B<q;){N=U[B+=1],B&&(i+=" || ");var J=e.util.getProperty(N),V=p+J;i+=" ( ( "+V+" === undefined ",C&&(i+=" || ! Object.prototype.hasOwnProperty.call("+p+", '"+e.util.escapeQuotes(N)+"') "),i+=") && (missing"+a+" = "+e.util.toQuotedString(e.opts.jsonPointers?N:J)+") ) "}i+=")) {  ";var de="missing"+a,ae="' + "+de+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(x,de,!0):x+" + "+de);var ue=ue||[];ue.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { property: '"+e.util.escapeQuotes(L)+"', missingProperty: '"+ae+"', depsCount: "+I.length+", deps: '"+e.util.escapeQuotes(I.length==1?I[0]:I.join(", "))+"' } ",e.opts.messages!==!1&&(i+=" , message: 'should have ",I.length==1?i+="property "+e.util.escapeQuotes(I[0]):i+="properties "+e.util.escapeQuotes(I.join(", ")),i+=" when property "+e.util.escapeQuotes(L)+" is present' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ";var te=i;i=ue.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+te+"]); ":i+=" validate.errors = ["+te+"]; return false; ":i+=" var err = "+te+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else{i+=" ) { ";var oe=I;if(oe)for(var N,ge=-1,Ee=oe.length-1;ge<Ee;){N=oe[ge+=1];var J=e.util.getProperty(N),ae=e.util.escapeQuotes(N),V=p+J;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(x,N,e.opts.jsonPointers)),i+=" if ( "+V+" === undefined ",C&&(i+=" || ! Object.prototype.hasOwnProperty.call("+p+", '"+e.util.escapeQuotes(N)+"') "),i+=") {  var err =   ",e.createErrors!==!1?(i+=" { keyword: 'dependencies' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { property: '"+e.util.escapeQuotes(L)+"', missingProperty: '"+ae+"', depsCount: "+I.length+", deps: '"+e.util.escapeQuotes(I.length==1?I[0]:I.join(", "))+"' } ",e.opts.messages!==!1&&(i+=" , message: 'should have ",I.length==1?i+="property "+e.util.escapeQuotes(I[0]):i+="properties "+e.util.escapeQuotes(I.join(", ")),i+=" when property "+e.util.escapeQuotes(L)+" is present' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}i+=" }   ",d&&(b+="}",i+=" else { ")}e.errorPath=x;var Y=y.baseId;for(var L in S){var A=S[L];(e.opts.strictKeywords?typeof A=="object"&&Object.keys(A).length>0||A===!1:e.util.schemaHasRules(A,e.RULES.all))&&(i+=" "+w+" = true; if ( "+p+e.util.getProperty(L)+" !== undefined ",C&&(i+=" && Object.prototype.hasOwnProperty.call("+p+", '"+e.util.escapeQuotes(L)+"') "),i+=") { ",y.schema=A,y.schemaPath=u+e.util.getProperty(L),y.errSchemaPath=c+"/"+e.util.escapeFragment(L),i+="  "+e.validate(y)+" ",y.baseId=Y,i+=" }  ",d&&(i+=" if ("+w+") { ",b+="}"))}return d&&(i+="   "+b+" if ("+m+" == errors) {"),i}),NS}var kS,c$;function JZ(){return c$||(c$=1,kS=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,p="data"+(s||""),m="valid"+a,y=e.opts.$data&&o&&o.$data;y&&(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ");var b="i"+a,w="schema"+a;y||(i+=" var "+w+" = validate.schema"+u+";"),i+="var "+m+";",y&&(i+=" if (schema"+a+" === undefined) "+m+" = true; else if (!Array.isArray(schema"+a+")) "+m+" = false; else {"),i+=""+m+" = false;for (var "+b+"=0; "+b+"<"+w+".length; "+b+"++) if (equal("+p+", "+w+"["+b+"])) { "+m+" = true; break; }",y&&(i+="  }  "),i+=" if (!"+m+") {   ";var S=S||[];S.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'enum' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { allowedValues: schema"+a+" } ",e.opts.messages!==!1&&(i+=" , message: 'should be equal to one of the allowed values' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ";var T=i;return i=S.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+T+"]); ":i+=" validate.errors = ["+T+"]; return false; ":i+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" }",d&&(i+=" else { "),i}),kS}var MS,f$;function YZ(){return f$||(f$=1,MS=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,p="data"+(s||"");if(e.opts.format===!1)return d&&(i+=" if (true) { "),i;var m=e.opts.$data&&o&&o.$data,y;m?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",y="schema"+a):y=o;var b=e.opts.unknownFormats,w=Array.isArray(b);if(m){var S="format"+a,T="isObject"+a,C="formatType"+a;i+=" var "+S+" = formats["+y+"]; var "+T+" = typeof "+S+" == 'object' && !("+S+" instanceof RegExp) && "+S+".validate; var "+C+" = "+T+" && "+S+".type || 'string'; if ("+T+") { ",e.async&&(i+=" var async"+a+" = "+S+".async; "),i+=" "+S+" = "+S+".validate; } if (  ",m&&(i+=" ("+y+" !== undefined && typeof "+y+" != 'string') || "),i+=" (",b!="ignore"&&(i+=" ("+y+" && !"+S+" ",w&&(i+=" && self._opts.unknownFormats.indexOf("+y+") == -1 "),i+=") || "),i+=" ("+S+" && "+C+" == '"+r+"' && !(typeof "+S+" == 'function' ? ",e.async?i+=" (async"+a+" ? await "+S+"("+p+") : "+S+"("+p+")) ":i+=" "+S+"("+p+") ",i+=" : "+S+".test("+p+"))))) {"}else{var S=e.formats[o];if(!S){if(b=="ignore")return e.logger.warn('unknown format "'+o+'" ignored in schema at path "'+e.errSchemaPath+'"'),d&&(i+=" if (true) { "),i;if(w&&b.indexOf(o)>=0)return d&&(i+=" if (true) { "),i;throw new Error('unknown format "'+o+'" is used in schema at path "'+e.errSchemaPath+'"')}var T=typeof S=="object"&&!(S instanceof RegExp)&&S.validate,C=T&&S.type||"string";if(T){var A=S.async===!0;S=S.validate}if(C!=r)return d&&(i+=" if (true) { "),i;if(A){if(!e.async)throw new Error("async format in sync schema");var I="formats"+e.util.getProperty(o)+".validate";i+=" if (!(await "+I+"("+p+"))) { "}else{i+=" if (! ";var I="formats"+e.util.getProperty(o);T&&(I+=".validate"),typeof S=="function"?i+=" "+I+"("+p+") ":i+=" "+I+".test("+p+") ",i+=") { "}}var x=x||[];x.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'format' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { format:  ",m?i+=""+y:i+=""+e.util.toQuotedString(o),i+="  } ",e.opts.messages!==!1&&(i+=` , message: 'should match format "`,m?i+="' + "+y+" + '":i+=""+e.util.escapeQuotes(o),i+=`"' `),e.opts.verbose&&(i+=" , schema:  ",m?i+="validate.schema"+u:i+=""+e.util.toQuotedString(o),i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ";var L=i;return i=x.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+L+"]); ":i+=" validate.errors = ["+L+"]; return false; ":i+=" var err = "+L+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",d&&(i+=" else { "),i}),MS}var DS,d$;function ZZ(){return d$||(d$=1,DS=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,p="data"+(s||""),m="valid"+a,y="errs__"+a,b=e.util.copy(e);b.level++;var w="valid"+b.level,S=e.schema.then,T=e.schema.else,C=S!==void 0&&(e.opts.strictKeywords?typeof S=="object"&&Object.keys(S).length>0||S===!1:e.util.schemaHasRules(S,e.RULES.all)),A=T!==void 0&&(e.opts.strictKeywords?typeof T=="object"&&Object.keys(T).length>0||T===!1:e.util.schemaHasRules(T,e.RULES.all)),I=b.baseId;if(C||A){var x;b.createErrors=!1,b.schema=o,b.schemaPath=u,b.errSchemaPath=c,i+=" var "+y+" = errors; var "+m+" = true;  ";var L=e.compositeRule;e.compositeRule=b.compositeRule=!0,i+="  "+e.validate(b)+" ",b.baseId=I,b.createErrors=!0,i+="  errors = "+y+"; if (vErrors !== null) { if ("+y+") vErrors.length = "+y+"; else vErrors = null; }  ",e.compositeRule=b.compositeRule=L,C?(i+=" if ("+w+") {  ",b.schema=e.schema.then,b.schemaPath=e.schemaPath+".then",b.errSchemaPath=e.errSchemaPath+"/then",i+="  "+e.validate(b)+" ",b.baseId=I,i+=" "+m+" = "+w+"; ",C&&A?(x="ifClause"+a,i+=" var "+x+" = 'then'; "):x="'then'",i+=" } ",A&&(i+=" else { ")):i+=" if (!"+w+") { ",A&&(b.schema=e.schema.else,b.schemaPath=e.schemaPath+".else",b.errSchemaPath=e.errSchemaPath+"/else",i+="  "+e.validate(b)+" ",b.baseId=I,i+=" "+m+" = "+w+"; ",C&&A?(x="ifClause"+a,i+=" var "+x+" = 'else'; "):x="'else'",i+=" } "),i+=" if (!"+m+") {   var err =   ",e.createErrors!==!1?(i+=" { keyword: 'if' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { failingKeyword: "+x+" } ",e.opts.messages!==!1&&(i+=` , message: 'should match "' + `+x+` + '" schema' `),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(e.async?i+=" throw new ValidationError(vErrors); ":i+=" validate.errors = vErrors; return false; "),i+=" }   ",d&&(i+=" else { ")}else d&&(i+=" if (true) { ");return i}),DS}var $S,h$;function XZ(){return h$||(h$=1,$S=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,p="data"+(s||""),m="valid"+a,y="errs__"+a,b=e.util.copy(e),w="";b.level++;var S="valid"+b.level,T="i"+a,C=b.dataLevel=e.dataLevel+1,A="data"+C,I=e.baseId;if(i+="var "+y+" = errors;var "+m+";",Array.isArray(o)){var x=e.schema.additionalItems;if(x===!1){i+=" "+m+" = "+p+".length <= "+o.length+"; ";var L=c;c=e.errSchemaPath+"/additionalItems",i+="  if (!"+m+") {   ";var U=U||[];U.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'additionalItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+o.length+" } ",e.opts.messages!==!1&&(i+=" , message: 'should NOT have more than "+o.length+" items' "),e.opts.verbose&&(i+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ";var N=i;i=U.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+N+"]); ":i+=" validate.errors = ["+N+"]; return false; ":i+=" var err = "+N+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",c=L,d&&(w+="}",i+=" else { ")}var B=o;if(B){for(var q,J=-1,V=B.length-1;J<V;)if(q=B[J+=1],e.opts.strictKeywords?typeof q=="object"&&Object.keys(q).length>0||q===!1:e.util.schemaHasRules(q,e.RULES.all)){i+=" "+S+" = true; if ("+p+".length > "+J+") { ";var de=p+"["+J+"]";b.schema=q,b.schemaPath=u+"["+J+"]",b.errSchemaPath=c+"/"+J,b.errorPath=e.util.getPathExpr(e.errorPath,J,e.opts.jsonPointers,!0),b.dataPathArr[C]=J;var ae=e.validate(b);b.baseId=I,e.util.varOccurences(ae,A)<2?i+=" "+e.util.varReplace(ae,A,de)+" ":i+=" var "+A+" = "+de+"; "+ae+" ",i+=" }  ",d&&(i+=" if ("+S+") { ",w+="}")}}if(typeof x=="object"&&(e.opts.strictKeywords?typeof x=="object"&&Object.keys(x).length>0||x===!1:e.util.schemaHasRules(x,e.RULES.all))){b.schema=x,b.schemaPath=e.schemaPath+".additionalItems",b.errSchemaPath=e.errSchemaPath+"/additionalItems",i+=" "+S+" = true; if ("+p+".length > "+o.length+") {  for (var "+T+" = "+o.length+"; "+T+" < "+p+".length; "+T+"++) { ",b.errorPath=e.util.getPathExpr(e.errorPath,T,e.opts.jsonPointers,!0);var de=p+"["+T+"]";b.dataPathArr[C]=T;var ae=e.validate(b);b.baseId=I,e.util.varOccurences(ae,A)<2?i+=" "+e.util.varReplace(ae,A,de)+" ":i+=" var "+A+" = "+de+"; "+ae+" ",d&&(i+=" if (!"+S+") break; "),i+=" } }  ",d&&(i+=" if ("+S+") { ",w+="}")}}else if(e.opts.strictKeywords?typeof o=="object"&&Object.keys(o).length>0||o===!1:e.util.schemaHasRules(o,e.RULES.all)){b.schema=o,b.schemaPath=u,b.errSchemaPath=c,i+="  for (var "+T+" = 0; "+T+" < "+p+".length; "+T+"++) { ",b.errorPath=e.util.getPathExpr(e.errorPath,T,e.opts.jsonPointers,!0);var de=p+"["+T+"]";b.dataPathArr[C]=T;var ae=e.validate(b);b.baseId=I,e.util.varOccurences(ae,A)<2?i+=" "+e.util.varReplace(ae,A,de)+" ":i+=" var "+A+" = "+de+"; "+ae+" ",d&&(i+=" if (!"+S+") break; "),i+=" }"}return d&&(i+=" "+w+" if ("+y+" == errors) {"),i}),$S}var LS,p$;function m$(){return p$||(p$=1,LS=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,I,p="data"+(s||""),m=e.opts.$data&&o&&o.$data,y;m?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",y="schema"+a):y=o;var b=t=="maximum",w=b?"exclusiveMaximum":"exclusiveMinimum",S=e.schema[w],T=e.opts.$data&&S&&S.$data,C=b?"<":">",A=b?">":"<",I=void 0;if(!(m||typeof o=="number"||o===void 0))throw new Error(t+" must be number");if(!(T||S===void 0||typeof S=="number"||typeof S=="boolean"))throw new Error(w+" must be number or boolean");if(T){var x=e.util.getData(S.$data,s,e.dataPathArr),L="exclusive"+a,U="exclType"+a,N="exclIsNumber"+a,B="op"+a,q="' + "+B+" + '";i+=" var schemaExcl"+a+" = "+x+"; ",x="schemaExcl"+a,i+=" var "+L+"; var "+U+" = typeof "+x+"; if ("+U+" != 'boolean' && "+U+" != 'undefined' && "+U+" != 'number') { ";var I=w,J=J||[];J.push(i),i="",e.createErrors!==!1?(i+=" { keyword: '"+(I||"_exclusiveLimit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",e.opts.messages!==!1&&(i+=" , message: '"+w+" should be boolean' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ";var V=i;i=J.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+V+"]); ":i+=" validate.errors = ["+V+"]; return false; ":i+=" var err = "+V+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else if ( ",m&&(i+=" ("+y+" !== undefined && typeof "+y+" != 'number') || "),i+=" "+U+" == 'number' ? ( ("+L+" = "+y+" === undefined || "+x+" "+C+"= "+y+") ? "+p+" "+A+"= "+x+" : "+p+" "+A+" "+y+" ) : ( ("+L+" = "+x+" === true) ? "+p+" "+A+"= "+y+" : "+p+" "+A+" "+y+" ) || "+p+" !== "+p+") { var op"+a+" = "+L+" ? '"+C+"' : '"+C+"='; ",o===void 0&&(I=w,c=e.errSchemaPath+"/"+w,y=x,m=T)}else{var N=typeof S=="number",q=C;if(N&&m){var B="'"+q+"'";i+=" if ( ",m&&(i+=" ("+y+" !== undefined && typeof "+y+" != 'number') || "),i+=" ( "+y+" === undefined || "+S+" "+C+"= "+y+" ? "+p+" "+A+"= "+S+" : "+p+" "+A+" "+y+" ) || "+p+" !== "+p+") { "}else{N&&o===void 0?(L=!0,I=w,c=e.errSchemaPath+"/"+w,y=S,A+="="):(N&&(y=Math[b?"min":"max"](S,o)),S===(N?y:!0)?(L=!0,I=w,c=e.errSchemaPath+"/"+w,A+="="):(L=!1,q+="="));var B="'"+q+"'";i+=" if ( ",m&&(i+=" ("+y+" !== undefined && typeof "+y+" != 'number') || "),i+=" "+p+" "+A+" "+y+" || "+p+" !== "+p+") { "}}I=I||t;var J=J||[];J.push(i),i="",e.createErrors!==!1?(i+=" { keyword: '"+(I||"_limit")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { comparison: "+B+", limit: "+y+", exclusive: "+L+" } ",e.opts.messages!==!1&&(i+=" , message: 'should be "+q+" ",m?i+="' + "+y:i+=""+y+"'"),e.opts.verbose&&(i+=" , schema:  ",m?i+="validate.schema"+u:i+=""+o,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ";var V=i;return i=J.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+V+"]); ":i+=" validate.errors = ["+V+"]; return false; ":i+=" var err = "+V+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",d&&(i+=" else { "),i}),LS}var US,g$;function y$(){return g$||(g$=1,US=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,w,p="data"+(s||""),m=e.opts.$data&&o&&o.$data,y;if(m?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",y="schema"+a):y=o,!(m||typeof o=="number"))throw new Error(t+" must be number");var b=t=="maxItems"?">":"<";i+="if ( ",m&&(i+=" ("+y+" !== undefined && typeof "+y+" != 'number') || "),i+=" "+p+".length "+b+" "+y+") { ";var w=t,S=S||[];S.push(i),i="",e.createErrors!==!1?(i+=" { keyword: '"+(w||"_limitItems")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+y+" } ",e.opts.messages!==!1&&(i+=" , message: 'should NOT have ",t=="maxItems"?i+="more":i+="fewer",i+=" than ",m?i+="' + "+y+" + '":i+=""+o,i+=" items' "),e.opts.verbose&&(i+=" , schema:  ",m?i+="validate.schema"+u:i+=""+o,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ";var T=i;return i=S.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+T+"]); ":i+=" validate.errors = ["+T+"]; return false; ":i+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",d&&(i+=" else { "),i}),US}var jS,v$;function _$(){return v$||(v$=1,jS=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,w,p="data"+(s||""),m=e.opts.$data&&o&&o.$data,y;if(m?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",y="schema"+a):y=o,!(m||typeof o=="number"))throw new Error(t+" must be number");var b=t=="maxLength"?">":"<";i+="if ( ",m&&(i+=" ("+y+" !== undefined && typeof "+y+" != 'number') || "),e.opts.unicode===!1?i+=" "+p+".length ":i+=" ucs2length("+p+") ",i+=" "+b+" "+y+") { ";var w=t,S=S||[];S.push(i),i="",e.createErrors!==!1?(i+=" { keyword: '"+(w||"_limitLength")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+y+" } ",e.opts.messages!==!1&&(i+=" , message: 'should NOT be ",t=="maxLength"?i+="longer":i+="shorter",i+=" than ",m?i+="' + "+y+" + '":i+=""+o,i+=" characters' "),e.opts.verbose&&(i+=" , schema:  ",m?i+="validate.schema"+u:i+=""+o,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ";var T=i;return i=S.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+T+"]); ":i+=" validate.errors = ["+T+"]; return false; ":i+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",d&&(i+=" else { "),i}),jS}var FS,b$;function w$(){return b$||(b$=1,FS=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,w,p="data"+(s||""),m=e.opts.$data&&o&&o.$data,y;if(m?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",y="schema"+a):y=o,!(m||typeof o=="number"))throw new Error(t+" must be number");var b=t=="maxProperties"?">":"<";i+="if ( ",m&&(i+=" ("+y+" !== undefined && typeof "+y+" != 'number') || "),i+=" Object.keys("+p+").length "+b+" "+y+") { ";var w=t,S=S||[];S.push(i),i="",e.createErrors!==!1?(i+=" { keyword: '"+(w||"_limitProperties")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { limit: "+y+" } ",e.opts.messages!==!1&&(i+=" , message: 'should NOT have ",t=="maxProperties"?i+="more":i+="fewer",i+=" than ",m?i+="' + "+y+" + '":i+=""+o,i+=" properties' "),e.opts.verbose&&(i+=" , schema:  ",m?i+="validate.schema"+u:i+=""+o,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ";var T=i;return i=S.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+T+"]); ":i+=" validate.errors = ["+T+"]; return false; ":i+=" var err = "+T+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",d&&(i+=" else { "),i}),FS}var BS,E$;function QZ(){return E$||(E$=1,BS=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,p="data"+(s||""),m=e.opts.$data&&o&&o.$data,y;if(m?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",y="schema"+a):y=o,!(m||typeof o=="number"))throw new Error(t+" must be number");i+="var division"+a+";if (",m&&(i+=" "+y+" !== undefined && ( typeof "+y+" != 'number' || "),i+=" (division"+a+" = "+p+" / "+y+", ",e.opts.multipleOfPrecision?i+=" Math.abs(Math.round(division"+a+") - division"+a+") > 1e-"+e.opts.multipleOfPrecision+" ":i+=" division"+a+" !== parseInt(division"+a+") ",i+=" ) ",m&&(i+="  )  "),i+=" ) {   ";var b=b||[];b.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'multipleOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { multipleOf: "+y+" } ",e.opts.messages!==!1&&(i+=" , message: 'should be multiple of ",m?i+="' + "+y:i+=""+y+"'"),e.opts.verbose&&(i+=" , schema:  ",m?i+="validate.schema"+u:i+=""+o,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ";var w=i;return i=b.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+w+"]); ":i+=" validate.errors = ["+w+"]; return false; ":i+=" var err = "+w+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",d&&(i+=" else { "),i}),BS}var qS,S$;function eX(){return S$||(S$=1,qS=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,p="data"+(s||""),m="errs__"+a,y=e.util.copy(e);y.level++;var b="valid"+y.level;if(e.opts.strictKeywords?typeof o=="object"&&Object.keys(o).length>0||o===!1:e.util.schemaHasRules(o,e.RULES.all)){y.schema=o,y.schemaPath=u,y.errSchemaPath=c,i+=" var "+m+" = errors;  ";var w=e.compositeRule;e.compositeRule=y.compositeRule=!0,y.createErrors=!1;var S;y.opts.allErrors&&(S=y.opts.allErrors,y.opts.allErrors=!1),i+=" "+e.validate(y)+" ",y.createErrors=!0,S&&(y.opts.allErrors=S),e.compositeRule=y.compositeRule=w,i+=" if ("+b+") {   ";var T=T||[];T.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",e.opts.messages!==!1&&(i+=" , message: 'should NOT be valid' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ";var C=i;i=T.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+C+"]); ":i+=" validate.errors = ["+C+"]; return false; ":i+=" var err = "+C+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else {  errors = "+m+"; if (vErrors !== null) { if ("+m+") vErrors.length = "+m+"; else vErrors = null; } ",e.opts.allErrors&&(i+=" } ")}else i+="  var err =   ",e.createErrors!==!1?(i+=" { keyword: 'not' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: {} ",e.opts.messages!==!1&&(i+=" , message: 'should NOT be valid' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",d&&(i+=" if (false) { ");return i}),qS}var VS,T$;function tX(){return T$||(T$=1,VS=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,p="data"+(s||""),m="valid"+a,y="errs__"+a,b=e.util.copy(e),w="";b.level++;var S="valid"+b.level,T=b.baseId,C="prevValid"+a,A="passingSchemas"+a;i+="var "+y+" = errors , "+C+" = false , "+m+" = false , "+A+" = null; ";var I=e.compositeRule;e.compositeRule=b.compositeRule=!0;var x=o;if(x)for(var L,U=-1,N=x.length-1;U<N;)L=x[U+=1],(e.opts.strictKeywords?typeof L=="object"&&Object.keys(L).length>0||L===!1:e.util.schemaHasRules(L,e.RULES.all))?(b.schema=L,b.schemaPath=u+"["+U+"]",b.errSchemaPath=c+"/"+U,i+="  "+e.validate(b)+" ",b.baseId=T):i+=" var "+S+" = true; ",U&&(i+=" if ("+S+" && "+C+") { "+m+" = false; "+A+" = ["+A+", "+U+"]; } else { ",w+="}"),i+=" if ("+S+") { "+m+" = "+C+" = true; "+A+" = "+U+"; }";return e.compositeRule=b.compositeRule=I,i+=""+w+"if (!"+m+") {   var err =   ",e.createErrors!==!1?(i+=" { keyword: 'oneOf' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { passingSchemas: "+A+" } ",e.opts.messages!==!1&&(i+=" , message: 'should match exactly one schema in oneOf' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(e.async?i+=" throw new ValidationError(vErrors); ":i+=" validate.errors = vErrors; return false; "),i+="} else {  errors = "+y+"; if (vErrors !== null) { if ("+y+") vErrors.length = "+y+"; else vErrors = null; }",e.opts.allErrors&&(i+=" } "),i}),VS}var zS,A$;function nX(){return A$||(A$=1,zS=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,p="data"+(s||""),m=e.opts.$data&&o&&o.$data,y;m?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",y="schema"+a):y=o;var b=m?"(new RegExp("+y+"))":e.usePattern(o);i+="if ( ",m&&(i+=" ("+y+" !== undefined && typeof "+y+" != 'string') || "),i+=" !"+b+".test("+p+") ) {   ";var w=w||[];w.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'pattern' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { pattern:  ",m?i+=""+y:i+=""+e.util.toQuotedString(o),i+="  } ",e.opts.messages!==!1&&(i+=` , message: 'should match pattern "`,m?i+="' + "+y+" + '":i+=""+e.util.escapeQuotes(o),i+=`"' `),e.opts.verbose&&(i+=" , schema:  ",m?i+="validate.schema"+u:i+=""+e.util.toQuotedString(o),i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ";var S=i;return i=w.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+S+"]); ":i+=" validate.errors = ["+S+"]; return false; ":i+=" var err = "+S+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+="} ",d&&(i+=" else { "),i}),zS}var HS,C$;function rX(){return C$||(C$=1,HS=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,p="data"+(s||""),m="errs__"+a,y=e.util.copy(e),b="";y.level++;var w="valid"+y.level,S="key"+a,T="idx"+a,C=y.dataLevel=e.dataLevel+1,A="data"+C,I="dataProperties"+a,x=Object.keys(o||{}).filter(ge),L=e.schema.patternProperties||{},U=Object.keys(L).filter(ge),N=e.schema.additionalProperties,B=x.length||U.length,q=N===!1,J=typeof N=="object"&&Object.keys(N).length,V=e.opts.removeAdditional,de=q||J||V,ae=e.opts.ownProperties,ue=e.baseId,te=e.schema.required;if(te&&!(e.opts.$data&&te.$data)&&te.length<e.opts.loopRequired)var oe=e.util.toHash(te);function ge(rt){return rt!=="__proto__"}if(i+="var "+m+" = errors;var "+w+" = true;",ae&&(i+=" var "+I+" = undefined;"),de){if(ae?i+=" "+I+" = "+I+" || Object.keys("+p+"); for (var "+T+"=0; "+T+"<"+I+".length; "+T+"++) { var "+S+" = "+I+"["+T+"]; ":i+=" for (var "+S+" in "+p+") { ",B){if(i+=" var isAdditional"+a+" = !(false ",x.length)if(x.length>8)i+=" || validate.schema"+u+".hasOwnProperty("+S+") ";else{var Ee=x;if(Ee)for(var Y,ve=-1,Re=Ee.length-1;ve<Re;)Y=Ee[ve+=1],i+=" || "+S+" == "+e.util.toQuotedString(Y)+" "}if(U.length){var Q=U;if(Q)for(var ie,ce=-1,P=Q.length-1;ce<P;)ie=Q[ce+=1],i+=" || "+e.usePattern(ie)+".test("+S+") "}i+=" ); if (isAdditional"+a+") { "}if(V=="all")i+=" delete "+p+"["+S+"]; ";else{var O=e.errorPath,K="' + "+S+" + '";if(e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(e.errorPath,S,e.opts.jsonPointers)),q)if(V)i+=" delete "+p+"["+S+"]; ";else{i+=" "+w+" = false; ";var X=c;c=e.errSchemaPath+"/additionalProperties";var se=se||[];se.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'additionalProperties' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { additionalProperty: '"+K+"' } ",e.opts.messages!==!1&&(i+=" , message: '",e.opts._errorDataPathProperty?i+="is an invalid additional property":i+="should NOT have additional properties",i+="' "),e.opts.verbose&&(i+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ";var F=i;i=se.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+F+"]); ":i+=" validate.errors = ["+F+"]; return false; ":i+=" var err = "+F+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c=X,d&&(i+=" break; ")}else if(J)if(V=="failing"){i+=" var "+m+" = errors;  ";var z=e.compositeRule;e.compositeRule=y.compositeRule=!0,y.schema=N,y.schemaPath=e.schemaPath+".additionalProperties",y.errSchemaPath=e.errSchemaPath+"/additionalProperties",y.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,S,e.opts.jsonPointers);var ye=p+"["+S+"]";y.dataPathArr[C]=S;var ke=e.validate(y);y.baseId=ue,e.util.varOccurences(ke,A)<2?i+=" "+e.util.varReplace(ke,A,ye)+" ":i+=" var "+A+" = "+ye+"; "+ke+" ",i+=" if (!"+w+") { errors = "+m+"; if (validate.errors !== null) { if (errors) validate.errors.length = errors; else validate.errors = null; } delete "+p+"["+S+"]; }  ",e.compositeRule=y.compositeRule=z}else{y.schema=N,y.schemaPath=e.schemaPath+".additionalProperties",y.errSchemaPath=e.errSchemaPath+"/additionalProperties",y.errorPath=e.opts._errorDataPathProperty?e.errorPath:e.util.getPathExpr(e.errorPath,S,e.opts.jsonPointers);var ye=p+"["+S+"]";y.dataPathArr[C]=S;var ke=e.validate(y);y.baseId=ue,e.util.varOccurences(ke,A)<2?i+=" "+e.util.varReplace(ke,A,ye)+" ":i+=" var "+A+" = "+ye+"; "+ke+" ",d&&(i+=" if (!"+w+") break; ")}e.errorPath=O}B&&(i+=" } "),i+=" }  ",d&&(i+=" if ("+w+") { ",b+="}")}var Qe=e.opts.useDefaults&&!e.compositeRule;if(x.length){var $e=x;if($e)for(var Y,ze=-1,xt=$e.length-1;ze<xt;){Y=$e[ze+=1];var Oe=o[Y];if(e.opts.strictKeywords?typeof Oe=="object"&&Object.keys(Oe).length>0||Oe===!1:e.util.schemaHasRules(Oe,e.RULES.all)){var qe=e.util.getProperty(Y),ye=p+qe,It=Qe&&Oe.default!==void 0;y.schema=Oe,y.schemaPath=u+qe,y.errSchemaPath=c+"/"+e.util.escapeFragment(Y),y.errorPath=e.util.getPath(e.errorPath,Y,e.opts.jsonPointers),y.dataPathArr[C]=e.util.toQuotedString(Y);var ke=e.validate(y);if(y.baseId=ue,e.util.varOccurences(ke,A)<2){ke=e.util.varReplace(ke,A,ye);var Ve=ye}else{var Ve=A;i+=" var "+A+" = "+ye+"; "}if(It)i+=" "+ke+" ";else{if(oe&&oe[Y]){i+=" if ( "+Ve+" === undefined ",ae&&(i+=" || ! Object.prototype.hasOwnProperty.call("+p+", '"+e.util.escapeQuotes(Y)+"') "),i+=") { "+w+" = false; ";var O=e.errorPath,X=c,Be=e.util.escapeQuotes(Y);e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(O,Y,e.opts.jsonPointers)),c=e.errSchemaPath+"/required";var se=se||[];se.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+Be+"' } ",e.opts.messages!==!1&&(i+=" , message: '",e.opts._errorDataPathProperty?i+="is a required property":i+="should have required property \\'"+Be+"\\'",i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ";var F=i;i=se.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+F+"]); ":i+=" validate.errors = ["+F+"]; return false; ":i+=" var err = "+F+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",c=X,e.errorPath=O,i+=" } else { "}else d?(i+=" if ( "+Ve+" === undefined ",ae&&(i+=" || ! Object.prototype.hasOwnProperty.call("+p+", '"+e.util.escapeQuotes(Y)+"') "),i+=") { "+w+" = true; } else { "):(i+=" if ("+Ve+" !== undefined ",ae&&(i+=" &&   Object.prototype.hasOwnProperty.call("+p+", '"+e.util.escapeQuotes(Y)+"') "),i+=" ) { ");i+=" "+ke+" } "}}d&&(i+=" if ("+w+") { ",b+="}")}}if(U.length){var et=U;if(et)for(var ie,Ye=-1,We=et.length-1;Ye<We;){ie=et[Ye+=1];var Oe=L[ie];if(e.opts.strictKeywords?typeof Oe=="object"&&Object.keys(Oe).length>0||Oe===!1:e.util.schemaHasRules(Oe,e.RULES.all)){y.schema=Oe,y.schemaPath=e.schemaPath+".patternProperties"+e.util.getProperty(ie),y.errSchemaPath=e.errSchemaPath+"/patternProperties/"+e.util.escapeFragment(ie),ae?i+=" "+I+" = "+I+" || Object.keys("+p+"); for (var "+T+"=0; "+T+"<"+I+".length; "+T+"++) { var "+S+" = "+I+"["+T+"]; ":i+=" for (var "+S+" in "+p+") { ",i+=" if ("+e.usePattern(ie)+".test("+S+")) { ",y.errorPath=e.util.getPathExpr(e.errorPath,S,e.opts.jsonPointers);var ye=p+"["+S+"]";y.dataPathArr[C]=S;var ke=e.validate(y);y.baseId=ue,e.util.varOccurences(ke,A)<2?i+=" "+e.util.varReplace(ke,A,ye)+" ":i+=" var "+A+" = "+ye+"; "+ke+" ",d&&(i+=" if (!"+w+") break; "),i+=" } ",d&&(i+=" else "+w+" = true; "),i+=" }  ",d&&(i+=" if ("+w+") { ",b+="}")}}}return d&&(i+=" "+b+" if ("+m+" == errors) {"),i}),HS}var GS,R$;function iX(){return R$||(R$=1,GS=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,p="data"+(s||""),m="errs__"+a,y=e.util.copy(e),b="";y.level++;var w="valid"+y.level;if(i+="var "+m+" = errors;",e.opts.strictKeywords?typeof o=="object"&&Object.keys(o).length>0||o===!1:e.util.schemaHasRules(o,e.RULES.all)){y.schema=o,y.schemaPath=u,y.errSchemaPath=c;var S="key"+a,T="idx"+a,C="i"+a,A="' + "+S+" + '",I=y.dataLevel=e.dataLevel+1,x="data"+I,L="dataProperties"+a,U=e.opts.ownProperties,N=e.baseId;U&&(i+=" var "+L+" = undefined; "),U?i+=" "+L+" = "+L+" || Object.keys("+p+"); for (var "+T+"=0; "+T+"<"+L+".length; "+T+"++) { var "+S+" = "+L+"["+T+"]; ":i+=" for (var "+S+" in "+p+") { ",i+=" var startErrs"+a+" = errors; ";var B=S,q=e.compositeRule;e.compositeRule=y.compositeRule=!0;var J=e.validate(y);y.baseId=N,e.util.varOccurences(J,x)<2?i+=" "+e.util.varReplace(J,x,B)+" ":i+=" var "+x+" = "+B+"; "+J+" ",e.compositeRule=y.compositeRule=q,i+=" if (!"+w+") { for (var "+C+"=startErrs"+a+"; "+C+"<errors; "+C+"++) { vErrors["+C+"].propertyName = "+S+"; }   var err =   ",e.createErrors!==!1?(i+=" { keyword: 'propertyNames' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { propertyName: '"+A+"' } ",e.opts.messages!==!1&&(i+=" , message: 'property name \\'"+A+"\\' is invalid' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(e.async?i+=" throw new ValidationError(vErrors); ":i+=" validate.errors = vErrors; return false; "),d&&(i+=" break; "),i+=" } }"}return d&&(i+=" "+b+" if ("+m+" == errors) {"),i}),GS}var WS,I$;function aX(){return I$||(I$=1,WS=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,p="data"+(s||""),m="valid"+a,y=e.opts.$data&&o&&o.$data;y&&(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ");var b="schema"+a;if(!y)if(o.length<e.opts.loopRequired&&e.schema.properties&&Object.keys(e.schema.properties).length){var w=[],S=o;if(S)for(var T,C=-1,A=S.length-1;C<A;){T=S[C+=1];var I=e.schema.properties[T];I&&(e.opts.strictKeywords?typeof I=="object"&&Object.keys(I).length>0||I===!1:e.util.schemaHasRules(I,e.RULES.all))||(w[w.length]=T)}}else var w=o;if(y||w.length){var x=e.errorPath,L=y||w.length>=e.opts.loopRequired,U=e.opts.ownProperties;if(d)if(i+=" var missing"+a+"; ",L){y||(i+=" var "+b+" = validate.schema"+u+"; ");var N="i"+a,B="schema"+a+"["+N+"]",q="' + "+B+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(x,B,e.opts.jsonPointers)),i+=" var "+m+" = true; ",y&&(i+=" if (schema"+a+" === undefined) "+m+" = true; else if (!Array.isArray(schema"+a+")) "+m+" = false; else {"),i+=" for (var "+N+" = 0; "+N+" < "+b+".length; "+N+"++) { "+m+" = "+p+"["+b+"["+N+"]] !== undefined ",U&&(i+=" &&   Object.prototype.hasOwnProperty.call("+p+", "+b+"["+N+"]) "),i+="; if (!"+m+") break; } ",y&&(i+="  }  "),i+="  if (!"+m+") {   ";var J=J||[];J.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+q+"' } ",e.opts.messages!==!1&&(i+=" , message: '",e.opts._errorDataPathProperty?i+="is a required property":i+="should have required property \\'"+q+"\\'",i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ";var V=i;i=J.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+V+"]); ":i+=" validate.errors = ["+V+"]; return false; ":i+=" var err = "+V+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else { "}else{i+=" if ( ";var de=w;if(de)for(var ae,N=-1,ue=de.length-1;N<ue;){ae=de[N+=1],N&&(i+=" || ");var te=e.util.getProperty(ae),oe=p+te;i+=" ( ( "+oe+" === undefined ",U&&(i+=" || ! Object.prototype.hasOwnProperty.call("+p+", '"+e.util.escapeQuotes(ae)+"') "),i+=") && (missing"+a+" = "+e.util.toQuotedString(e.opts.jsonPointers?ae:te)+") ) "}i+=") {  ";var B="missing"+a,q="' + "+B+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.opts.jsonPointers?e.util.getPathExpr(x,B,!0):x+" + "+B);var J=J||[];J.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+q+"' } ",e.opts.messages!==!1&&(i+=" , message: '",e.opts._errorDataPathProperty?i+="is a required property":i+="should have required property \\'"+q+"\\'",i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ";var V=i;i=J.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+V+"]); ":i+=" validate.errors = ["+V+"]; return false; ":i+=" var err = "+V+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } else { "}else if(L){y||(i+=" var "+b+" = validate.schema"+u+"; ");var N="i"+a,B="schema"+a+"["+N+"]",q="' + "+B+" + '";e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPathExpr(x,B,e.opts.jsonPointers)),y&&(i+=" if ("+b+" && !Array.isArray("+b+")) {  var err =   ",e.createErrors!==!1?(i+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+q+"' } ",e.opts.messages!==!1&&(i+=" , message: '",e.opts._errorDataPathProperty?i+="is a required property":i+="should have required property \\'"+q+"\\'",i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } else if ("+b+" !== undefined) { "),i+=" for (var "+N+" = 0; "+N+" < "+b+".length; "+N+"++) { if ("+p+"["+b+"["+N+"]] === undefined ",U&&(i+=" || ! Object.prototype.hasOwnProperty.call("+p+", "+b+"["+N+"]) "),i+=") {  var err =   ",e.createErrors!==!1?(i+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+q+"' } ",e.opts.messages!==!1&&(i+=" , message: '",e.opts._errorDataPathProperty?i+="is a required property":i+="should have required property \\'"+q+"\\'",i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } } ",y&&(i+="  }  ")}else{var ge=w;if(ge)for(var ae,Ee=-1,Y=ge.length-1;Ee<Y;){ae=ge[Ee+=1];var te=e.util.getProperty(ae),q=e.util.escapeQuotes(ae),oe=p+te;e.opts._errorDataPathProperty&&(e.errorPath=e.util.getPath(x,ae,e.opts.jsonPointers)),i+=" if ( "+oe+" === undefined ",U&&(i+=" || ! Object.prototype.hasOwnProperty.call("+p+", '"+e.util.escapeQuotes(ae)+"') "),i+=") {  var err =   ",e.createErrors!==!1?(i+=" { keyword: 'required' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { missingProperty: '"+q+"' } ",e.opts.messages!==!1&&(i+=" , message: '",e.opts._errorDataPathProperty?i+="is a required property":i+="should have required property \\'"+q+"\\'",i+="' "),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; } "}}e.errorPath=x}else d&&(i+=" if (true) {");return i}),WS}var KS,P$;function sX(){return P$||(P$=1,KS=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,p="data"+(s||""),m="valid"+a,y=e.opts.$data&&o&&o.$data,b;if(y?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",b="schema"+a):b=o,(o||y)&&e.opts.uniqueItems!==!1){y&&(i+=" var "+m+"; if ("+b+" === false || "+b+" === undefined) "+m+" = true; else if (typeof "+b+" != 'boolean') "+m+" = false; else { "),i+=" var i = "+p+".length , "+m+" = true , j; if (i > 1) { ";var w=e.schema.items&&e.schema.items.type,S=Array.isArray(w);if(!w||w=="object"||w=="array"||S&&(w.indexOf("object")>=0||w.indexOf("array")>=0))i+=" outer: for (;i--;) { for (j = i; j--;) { if (equal("+p+"[i], "+p+"[j])) { "+m+" = false; break outer; } } } ";else{i+=" var itemIndices = {}, item; for (;i--;) { var item = "+p+"[i]; ";var T="checkDataType"+(S?"s":"");i+=" if ("+e.util[T](w,"item",e.opts.strictNumbers,!0)+") continue; ",S&&(i+=` if (typeof item == 'string') item = '"' + item; `),i+=" if (typeof itemIndices[item] == 'number') { "+m+" = false; j = itemIndices[item]; break; } itemIndices[item] = i; } "}i+=" } ",y&&(i+="  }  "),i+=" if (!"+m+") {   ";var C=C||[];C.push(i),i="",e.createErrors!==!1?(i+=" { keyword: 'uniqueItems' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { i: i, j: j } ",e.opts.messages!==!1&&(i+=" , message: 'should NOT have duplicate items (items ## ' + j + ' and ' + i + ' are identical)' "),e.opts.verbose&&(i+=" , schema:  ",y?i+="validate.schema"+u:i+=""+o,i+="         , parentSchema: validate.schema"+e.schemaPath+" , data: "+p+" "),i+=" } "):i+=" {} ";var A=i;i=C.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+A+"]); ":i+=" validate.errors = ["+A+"]; return false; ":i+=" var err = "+A+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",i+=" } ",d&&(i+=" else { ")}else d&&(i+=" if (true) { ");return i}),KS}var JS,x$;function oX(){return x$||(x$=1,JS={$ref:qZ(),allOf:VZ(),anyOf:zZ(),$comment:HZ(),const:GZ(),contains:WZ(),dependencies:KZ(),enum:JZ(),format:YZ(),if:ZZ(),items:XZ(),maximum:m$(),minimum:m$(),maxItems:y$(),minItems:y$(),maxLength:_$(),minLength:_$(),maxProperties:w$(),minProperties:w$(),multipleOf:QZ(),not:eX(),oneOf:tX(),pattern:nX(),properties:rX(),propertyNames:iX(),required:aX(),uniqueItems:sX(),validate:T3()}),JS}var YS,O$;function lX(){if(O$)return YS;O$=1;var n=oX(),e=md().toHash;return YS=function(){var r=[{type:"number",rules:[{maximum:["exclusiveMaximum"]},{minimum:["exclusiveMinimum"]},"multipleOf","format"]},{type:"string",rules:["maxLength","minLength","pattern","format"]},{type:"array",rules:["maxItems","minItems","items","contains","uniqueItems"]},{type:"object",rules:["maxProperties","minProperties","required","dependencies","propertyNames",{properties:["additionalProperties","patternProperties"]}]},{rules:["$ref","const","enum","not","anyOf","oneOf","allOf","if"]}],i=["type","$comment"],a=["$schema","$id","id","$data","$async","title","description","default","definitions","examples","readOnly","writeOnly","contentMediaType","contentEncoding","additionalItems","then","else"],s=["number","integer","string","array","object","boolean","null"];return r.all=e(i),r.types=e(s),r.forEach(function(o){o.rules=o.rules.map(function(u){var c;if(typeof u=="object"){var d=Object.keys(u)[0];c=u[d],u=d,c.forEach(function(m){i.push(m),r.all[m]=!0})}i.push(u);var p=r.all[u]={keyword:u,code:n[u],implements:c};return p}),r.all.$comment={keyword:"$comment",code:n.$comment},o.type&&(r.types[o.type]=o)}),r.keywords=e(i.concat(a)),r.custom={},r},YS}var ZS,N$;function uX(){if(N$)return ZS;N$=1;var n=["multipleOf","maximum","exclusiveMaximum","minimum","exclusiveMinimum","maxLength","minLength","pattern","additionalItems","maxItems","minItems","uniqueItems","maxProperties","minProperties","required","additionalProperties","enum","format","const"];return ZS=function(e,t){for(var r=0;r<t.length;r++){e=JSON.parse(JSON.stringify(e));var i=t[r].split("/"),a=e,s;for(s=1;s<i.length;s++)a=a[i[s]];for(s=0;s<n.length;s++){var o=n[s],u=a[o];u&&(a[o]={anyOf:[u,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]})}}return e},ZS}var XS,k$;function cX(){if(k$)return XS;k$=1;var n=SI().MissingRef;XS=e;function e(t,r,i){var a=this;if(typeof this._opts.loadSchema!="function")throw new Error("options.loadSchema should be a function");typeof r=="function"&&(i=r,r=void 0);var s=o(t).then(function(){var c=a._addSchema(t,void 0,r);return c.validate||u(c)});return i&&s.then(function(c){i(null,c)},i),s;function o(c){var d=c.$schema;return d&&!a.getSchema(d)?e.call(a,{$ref:d},!0):Promise.resolve()}function u(c){try{return a._compile(c)}catch(p){if(p instanceof n)return d(p);throw p}function d(p){var m=p.missingSchema;if(w(m))throw new Error("Schema "+m+" is loaded but "+p.missingRef+" cannot be resolved");var y=a._loadingSchemas[m];return y||(y=a._loadingSchemas[m]=a._opts.loadSchema(m),y.then(b,b)),y.then(function(S){if(!w(m))return o(S).then(function(){w(m)||a.addSchema(S,m,void 0,r)})}).then(function(){return u(c)});function b(){delete a._loadingSchemas[m]}function w(S){return a._refs[S]||a._schemas[S]}}}}return XS}var QS,M$;function fX(){return M$||(M$=1,QS=function(e,t,r){var i=" ",a=e.level,s=e.dataLevel,o=e.schema[t],u=e.schemaPath+e.util.getProperty(t),c=e.errSchemaPath+"/"+t,d=!e.opts.allErrors,p,m="data"+(s||""),y="valid"+a,b="errs__"+a,w=e.opts.$data&&o&&o.$data,S;w?(i+=" var schema"+a+" = "+e.util.getData(o.$data,s,e.dataPathArr)+"; ",S="schema"+a):S=o;var T=this,C="definition"+a,A=T.definition,I="",x,L,U,N,B;if(w&&A.$data){B="keywordValidate"+a;var q=A.validateSchema;i+=" var "+C+" = RULES.custom['"+t+"'].definition; var "+B+" = "+C+".validate;"}else{if(N=e.useCustomRule(T,o,e.schema,e),!N)return;S="validate.schema"+u,B=N.code,x=A.compile,L=A.inline,U=A.macro}var J=B+".errors",V="i"+a,de="ruleErr"+a,ae=A.async;if(ae&&!e.async)throw new Error("async keyword in sync schema");if(L||U||(i+=""+J+" = null;"),i+="var "+b+" = errors;var "+y+";",w&&A.$data&&(I+="}",i+=" if ("+S+" === undefined) { "+y+" = true; } else { ",q&&(I+="}",i+=" "+y+" = "+C+".validateSchema("+S+"); if ("+y+") { ")),L)A.statements?i+=" "+N.validate+" ":i+=" "+y+" = "+N.validate+"; ";else if(U){var ue=e.util.copy(e),I="";ue.level++;var te="valid"+ue.level;ue.schema=N.validate,ue.schemaPath="";var oe=e.compositeRule;e.compositeRule=ue.compositeRule=!0;var ge=e.validate(ue).replace(/validate\.schema/g,B);e.compositeRule=ue.compositeRule=oe,i+=" "+ge}else{var Ee=Ee||[];Ee.push(i),i="",i+="  "+B+".call( ",e.opts.passContext?i+="this":i+="self",x||A.schema===!1?i+=" , "+m+" ":i+=" , "+S+" , "+m+" , validate.schema"+e.schemaPath+" ",i+=" , (dataPath || '')",e.errorPath!='""'&&(i+=" + "+e.errorPath);var Y=s?"data"+(s-1||""):"parentData",ve=s?e.dataPathArr[s]:"parentDataProperty";i+=" , "+Y+" , "+ve+" , rootData )  ";var Re=i;i=Ee.pop(),A.errors===!1?(i+=" "+y+" = ",ae&&(i+="await "),i+=""+Re+"; "):ae?(J="customErrors"+a,i+=" var "+J+" = null; try { "+y+" = await "+Re+"; } catch (e) { "+y+" = false; if (e instanceof ValidationError) "+J+" = e.errors; else throw e; } "):i+=" "+J+" = null; "+y+" = "+Re+"; "}if(A.modifying&&(i+=" if ("+Y+") "+m+" = "+Y+"["+ve+"];"),i+=""+I,A.valid)d&&(i+=" if (true) { ");else{i+=" if ( ",A.valid===void 0?(i+=" !",U?i+=""+te:i+=""+y):i+=" "+!A.valid+" ",i+=") { ",p=T.keyword;var Ee=Ee||[];Ee.push(i),i="";var Ee=Ee||[];Ee.push(i),i="",e.createErrors!==!1?(i+=" { keyword: '"+(p||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { keyword: '"+T.keyword+"' } ",e.opts.messages!==!1&&(i+=` , message: 'should pass "`+T.keyword+`" keyword validation' `),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),i+=" } "):i+=" {} ";var Q=i;i=Ee.pop(),!e.compositeRule&&d?e.async?i+=" throw new ValidationError(["+Q+"]); ":i+=" validate.errors = ["+Q+"]; return false; ":i+=" var err = "+Q+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ";var ie=i;i=Ee.pop(),L?A.errors?A.errors!="full"&&(i+="  for (var "+V+"="+b+"; "+V+"<errors; "+V+"++) { var "+de+" = vErrors["+V+"]; if ("+de+".dataPath === undefined) "+de+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+de+".schemaPath === undefined) { "+de+'.schemaPath = "'+c+'"; } ',e.opts.verbose&&(i+=" "+de+".schema = "+S+"; "+de+".data = "+m+"; "),i+=" } "):A.errors===!1?i+=" "+ie+" ":(i+=" if ("+b+" == errors) { "+ie+" } else {  for (var "+V+"="+b+"; "+V+"<errors; "+V+"++) { var "+de+" = vErrors["+V+"]; if ("+de+".dataPath === undefined) "+de+".dataPath = (dataPath || '') + "+e.errorPath+"; if ("+de+".schemaPath === undefined) { "+de+'.schemaPath = "'+c+'"; } ',e.opts.verbose&&(i+=" "+de+".schema = "+S+"; "+de+".data = "+m+"; "),i+=" } } "):U?(i+="   var err =   ",e.createErrors!==!1?(i+=" { keyword: '"+(p||"custom")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(c)+" , params: { keyword: '"+T.keyword+"' } ",e.opts.messages!==!1&&(i+=` , message: 'should pass "`+T.keyword+`" keyword validation' `),e.opts.verbose&&(i+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+m+" "),i+=" } "):i+=" {} ",i+=";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",!e.compositeRule&&d&&(e.async?i+=" throw new ValidationError(vErrors); ":i+=" validate.errors = vErrors; return false; ")):A.errors===!1?i+=" "+ie+" ":(i+=" if (Array.isArray("+J+")) { if (vErrors === null) vErrors = "+J+"; else vErrors = vErrors.concat("+J+"); errors = vErrors.length;  for (var "+V+"="+b+"; "+V+"<errors; "+V+"++) { var "+de+" = vErrors["+V+"]; if ("+de+".dataPath === undefined) "+de+".dataPath = (dataPath || '') + "+e.errorPath+";  "+de+'.schemaPath = "'+c+'";  ',e.opts.verbose&&(i+=" "+de+".schema = "+S+"; "+de+".data = "+m+"; "),i+=" } } else { "+ie+" } "),i+=" } ",d&&(i+=" else { ")}return i}),QS}const dX="http://json-schema.org/draft-07/schema#",hX="http://json-schema.org/draft-07/schema#",pX="Core schema meta-schema",mX={schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},gX=["object","boolean"],yX={$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},A3={$schema:dX,$id:hX,title:pX,definitions:mX,type:gX,properties:yX,default:!0};var eT,D$;function vX(){if(D$)return eT;D$=1;var n=A3;return eT={$id:"https://github.com/ajv-validator/ajv/blob/master/lib/definition_schema.js",definitions:{simpleTypes:n.definitions.simpleTypes},type:"object",dependencies:{schema:["validate"],$data:["validate"],statements:["inline"],valid:{not:{required:["macro"]}}},properties:{type:n.properties.type,schema:{type:"boolean"},statements:{type:"boolean"},dependencies:{type:"array",items:{type:"string"}},metaSchema:{type:"object"},modifying:{type:"boolean"},valid:{type:"boolean"},$data:{type:"boolean"},async:{type:"boolean"},errors:{anyOf:[{type:"boolean"},{const:"full"}]}}},eT}var tT,$$;function _X(){if($$)return tT;$$=1;var n=/^[a-z_$][a-z0-9_$-]*$/i,e=fX(),t=vX();tT={add:r,get:i,remove:a,validate:s};function r(o,u){var c=this.RULES;if(c.keywords[o])throw new Error("Keyword "+o+" is already defined");if(!n.test(o))throw new Error("Keyword "+o+" is not a valid identifier");if(u){this.validateKeyword(u,!0);var d=u.type;if(Array.isArray(d))for(var p=0;p<d.length;p++)y(o,d[p],u);else y(o,d,u);var m=u.metaSchema;m&&(u.$data&&this._opts.$data&&(m={anyOf:[m,{$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"}]}),u.validateSchema=this.compile(m,!0))}c.keywords[o]=c.all[o]=!0;function y(b,w,S){for(var T,C=0;C<c.length;C++){var A=c[C];if(A.type==w){T=A;break}}T||(T={type:w,rules:[]},c.push(T));var I={keyword:b,definition:S,custom:!0,code:e,implements:S.implements};T.rules.push(I),c.custom[b]=I}return this}function i(o){var u=this.RULES.custom[o];return u?u.definition:this.RULES.keywords[o]||!1}function a(o){var u=this.RULES;delete u.keywords[o],delete u.all[o],delete u.custom[o];for(var c=0;c<u.length;c++)for(var d=u[c].rules,p=0;p<d.length;p++)if(d[p].keyword==o){d.splice(p,1);break}return this}function s(o,u){s.errors=null;var c=this._validateKeyword=this._validateKeyword||this.compile(t,!0);if(c(o))return!0;if(s.errors=c.errors,u)throw new Error("custom keyword definition is invalid: "+this.errorsText(c.errors));return!1}return tT}const bX="http://json-schema.org/draft-07/schema#",wX="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",EX="Meta-schema for $data reference (JSON Schema extension proposal)",SX="object",TX=["$data"],AX={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},CX=!1,RX={$schema:bX,$id:wX,description:EX,type:SX,required:TX,properties:AX,additionalProperties:CX};var nT,L$;function IX(){if(L$)return nT;L$=1;var n=jZ(),e=EI(),t=FZ(),r=E3(),i=S3(),a=BZ(),s=lX(),o=uX(),u=md();nT=b,b.prototype.validate=w,b.prototype.compile=S,b.prototype.addSchema=T,b.prototype.addMetaSchema=C,b.prototype.validateSchema=A,b.prototype.getSchema=x,b.prototype.removeSchema=N,b.prototype.addFormat=oe,b.prototype.errorsText=te,b.prototype._addSchema=q,b.prototype._compile=J,b.prototype.compileAsync=cX();var c=_X();b.prototype.addKeyword=c.add,b.prototype.getKeyword=c.get,b.prototype.removeKeyword=c.remove,b.prototype.validateKeyword=c.validate;var d=SI();b.ValidationError=d.Validation,b.MissingRefError=d.MissingRef,b.$dataMetaSchema=o;var p="http://json-schema.org/draft-07/schema",m=["removeAdditional","useDefaults","coerceTypes","strictDefaults"],y=["/properties"];function b(P){if(!(this instanceof b))return new b(P);P=this._opts=u.copy(P)||{},ie(this),this._schemas={},this._refs={},this._fragments={},this._formats=a(P.format),this._cache=P.cache||new t,this._loadingSchemas={},this._compilations=[],this.RULES=s(),this._getId=V(P),P.loopRequired=P.loopRequired||1/0,P.errorDataPath=="property"&&(P._errorDataPathProperty=!0),P.serialize===void 0&&(P.serialize=i),this._metaOpts=Q(this),P.formats&&Y(this),P.keywords&&ve(this),ge(this),typeof P.meta=="object"&&this.addMetaSchema(P.meta),P.nullable&&this.addKeyword("nullable",{metaSchema:{type:"boolean"}}),Ee(this)}function w(P,O){var K;if(typeof P=="string"){if(K=this.getSchema(P),!K)throw new Error('no schema with key or ref "'+P+'"')}else{var X=this._addSchema(P);K=X.validate||this._compile(X)}var se=K(O);return K.$async!==!0&&(this.errors=K.errors),se}function S(P,O){var K=this._addSchema(P,void 0,O);return K.validate||this._compile(K)}function T(P,O,K,X){if(Array.isArray(P)){for(var se=0;se<P.length;se++)this.addSchema(P[se],void 0,K,X);return this}var F=this._getId(P);if(F!==void 0&&typeof F!="string")throw new Error("schema id must be string");return O=e.normalizeId(O||F),Re(this,O),this._schemas[O]=this._addSchema(P,K,X,!0),this}function C(P,O,K){return this.addSchema(P,O,K,!0),this}function A(P,O){var K=P.$schema;if(K!==void 0&&typeof K!="string")throw new Error("$schema must be a string");if(K=K||this._opts.defaultMeta||I(this),!K)return this.logger.warn("meta-schema not available"),this.errors=null,!0;var X=this.validate(K,P);if(!X&&O){var se="schema is invalid: "+this.errorsText();if(this._opts.validateSchema=="log")this.logger.error(se);else throw new Error(se)}return X}function I(P){var O=P._opts.meta;return P._opts.defaultMeta=typeof O=="object"?P._getId(O)||O:P.getSchema(p)?p:void 0,P._opts.defaultMeta}function x(P){var O=U(this,P);switch(typeof O){case"object":return O.validate||this._compile(O);case"string":return this.getSchema(O);case"undefined":return L(this,P)}}function L(P,O){var K=e.schema.call(P,{schema:{}},O);if(K){var X=K.schema,se=K.root,F=K.baseId,z=n.call(P,X,se,void 0,F);return P._fragments[O]=new r({ref:O,fragment:!0,schema:X,root:se,baseId:F,validate:z}),z}}function U(P,O){return O=e.normalizeId(O),P._schemas[O]||P._refs[O]||P._fragments[O]}function N(P){if(P instanceof RegExp)return B(this,this._schemas,P),B(this,this._refs,P),this;switch(typeof P){case"undefined":return B(this,this._schemas),B(this,this._refs),this._cache.clear(),this;case"string":var O=U(this,P);return O&&this._cache.del(O.cacheKey),delete this._schemas[P],delete this._refs[P],this;case"object":var K=this._opts.serialize,X=K?K(P):P;this._cache.del(X);var se=this._getId(P);se&&(se=e.normalizeId(se),delete this._schemas[se],delete this._refs[se])}return this}function B(P,O,K){for(var X in O){var se=O[X];!se.meta&&(!K||K.test(X))&&(P._cache.del(se.cacheKey),delete O[X])}}function q(P,O,K,X){if(typeof P!="object"&&typeof P!="boolean")throw new Error("schema should be object or boolean");var se=this._opts.serialize,F=se?se(P):P,z=this._cache.get(F);if(z)return z;X=X||this._opts.addUsedSchema!==!1;var ye=e.normalizeId(this._getId(P));ye&&X&&Re(this,ye);var ke=this._opts.validateSchema!==!1&&!O,Qe;ke&&!(Qe=ye&&ye==e.normalizeId(P.$schema))&&this.validateSchema(P,!0);var $e=e.ids.call(this,P),ze=new r({id:ye,schema:P,localRefs:$e,cacheKey:F,meta:K});return ye[0]!="#"&&X&&(this._refs[ye]=ze),this._cache.put(F,ze),ke&&Qe&&this.validateSchema(P,!0),ze}function J(P,O){if(P.compiling)return P.validate=se,se.schema=P.schema,se.errors=null,se.root=O||se,P.schema.$async===!0&&(se.$async=!0),se;P.compiling=!0;var K;P.meta&&(K=this._opts,this._opts=this._metaOpts);var X;try{X=n.call(this,P.schema,O,P.localRefs)}catch(F){throw delete P.validate,F}finally{P.compiling=!1,P.meta&&(this._opts=K)}return P.validate=X,P.refs=X.refs,P.refVal=X.refVal,P.root=X.root,X;function se(){var F=P.validate,z=F.apply(this,arguments);return se.errors=F.errors,z}}function V(P){switch(P.schemaId){case"auto":return ue;case"id":return de;default:return ae}}function de(P){return P.$id&&this.logger.warn("schema $id ignored",P.$id),P.id}function ae(P){return P.id&&this.logger.warn("schema id ignored",P.id),P.$id}function ue(P){if(P.$id&&P.id&&P.$id!=P.id)throw new Error("schema $id is different from id");return P.$id||P.id}function te(P,O){if(P=P||this.errors,!P)return"No errors";O=O||{};for(var K=O.separator===void 0?", ":O.separator,X=O.dataVar===void 0?"data":O.dataVar,se="",F=0;F<P.length;F++){var z=P[F];z&&(se+=X+z.dataPath+" "+z.message+K)}return se.slice(0,-K.length)}function oe(P,O){return typeof O=="string"&&(O=new RegExp(O)),this._formats[P]=O,this}function ge(P){var O;if(P._opts.$data&&(O=RX,P.addMetaSchema(O,O.$id,!0)),P._opts.meta!==!1){var K=A3;P._opts.$data&&(K=o(K,y)),P.addMetaSchema(K,p,!0),P._refs["http://json-schema.org/schema"]=p}}function Ee(P){var O=P._opts.schemas;if(O)if(Array.isArray(O))P.addSchema(O);else for(var K in O)P.addSchema(O[K],K)}function Y(P){for(var O in P._opts.formats){var K=P._opts.formats[O];P.addFormat(O,K)}}function ve(P){for(var O in P._opts.keywords){var K=P._opts.keywords[O];P.addKeyword(O,K)}}function Re(P,O){if(P._schemas[O]||P._refs[O])throw new Error('schema with key or id "'+O+'" already exists')}function Q(P){for(var O=u.copy(P._opts),K=0;K<m.length;K++)delete O[m[K]];return O}function ie(P){var O=P._opts.logger;if(O===!1)P.logger={log:ce,warn:ce,error:ce};else{if(O===void 0&&(O=console),!(typeof O=="object"&&O.log&&O.warn&&O.error))throw new Error("logger must implement log, warn and error methods");P.logger=O}}function ce(){}return nT}var PX=IX();const xX=Js(PX);class v1 extends kZ{constructor(e,t){var r;super(t),this._clientInfo=e,this._cachedToolOutputValidators=new Map,this._capabilities=(r=t==null?void 0:t.capabilities)!==null&&r!==void 0?r:{},this._ajv=new xX}registerCapabilities(e){if(this.transport)throw new Error("Cannot register capabilities after connecting to transport");this._capabilities=MZ(this._capabilities,e)}assertCapability(e,t){var r;if(!(!((r=this._serverCapabilities)===null||r===void 0)&&r[e]))throw new Error(`Server does not support ${e} (required for ${t})`)}async connect(e,t){if(await super.connect(e),e.sessionId===void 0)try{const r=await this.request({method:"initialize",params:{protocolVersion:X_,capabilities:this._capabilities,clientInfo:this._clientInfo}},l3,t);if(r===void 0)throw new Error(`Server sent invalid initialize result: ${r}`);if(!DY.includes(r.protocolVersion))throw new Error(`Server's protocol version is not supported: ${r.protocolVersion}`);this._serverCapabilities=r.capabilities,this._serverVersion=r.serverInfo,e.setProtocolVersion&&e.setProtocolVersion(r.protocolVersion),this._instructions=r.instructions,await this.notification({method:"notifications/initialized"})}catch(r){throw this.close(),r}}getServerCapabilities(){return this._serverCapabilities}getServerVersion(){return this._serverVersion}getInstructions(){return this._instructions}assertCapabilityForMethod(e){var t,r,i,a,s;switch(e){case"logging/setLevel":if(!(!((t=this._serverCapabilities)===null||t===void 0)&&t.logging))throw new Error(`Server does not support logging (required for ${e})`);break;case"prompts/get":case"prompts/list":if(!(!((r=this._serverCapabilities)===null||r===void 0)&&r.prompts))throw new Error(`Server does not support prompts (required for ${e})`);break;case"resources/list":case"resources/templates/list":case"resources/read":case"resources/subscribe":case"resources/unsubscribe":if(!(!((i=this._serverCapabilities)===null||i===void 0)&&i.resources))throw new Error(`Server does not support resources (required for ${e})`);if(e==="resources/subscribe"&&!this._serverCapabilities.resources.subscribe)throw new Error(`Server does not support resource subscriptions (required for ${e})`);break;case"tools/call":case"tools/list":if(!(!((a=this._serverCapabilities)===null||a===void 0)&&a.tools))throw new Error(`Server does not support tools (required for ${e})`);break;case"completion/complete":if(!(!((s=this._serverCapabilities)===null||s===void 0)&&s.completions))throw new Error(`Server does not support completions (required for ${e})`);break}}assertNotificationCapability(e){var t;switch(e){case"notifications/roots/list_changed":if(!(!((t=this._capabilities.roots)===null||t===void 0)&&t.listChanged))throw new Error(`Client does not support roots list changed notifications (required for ${e})`);break}}assertRequestHandlerCapability(e){switch(e){case"sampling/createMessage":if(!this._capabilities.sampling)throw new Error(`Client does not support sampling capability (required for ${e})`);break;case"elicitation/create":if(!this._capabilities.elicitation)throw new Error(`Client does not support elicitation capability (required for ${e})`);break;case"roots/list":if(!this._capabilities.roots)throw new Error(`Client does not support roots capability (required for ${e})`);break}}async ping(e){return this.request({method:"ping"},Cf,e)}async complete(e,t){return this.request({method:"completion/complete",params:e},w3,t)}async setLoggingLevel(e,t){return this.request({method:"logging/setLevel",params:{level:e}},Cf,t)}async getPrompt(e,t){return this.request({method:"prompts/get",params:e},_3,t)}async listPrompts(e,t){return this.request({method:"prompts/list",params:e},y3,t)}async listResources(e,t){return this.request({method:"resources/list",params:e},p3,t)}async listResourceTemplates(e,t){return this.request({method:"resources/templates/list",params:e},m3,t)}async readResource(e,t){return this.request({method:"resources/read",params:e},g3,t)}async subscribeResource(e,t){return this.request({method:"resources/subscribe",params:e},Cf,t)}async unsubscribeResource(e,t){return this.request({method:"resources/unsubscribe",params:e},Cf,t)}async callTool(e,t=rb,r){const i=await this.request({method:"tools/call",params:e},t,r),a=this.getToolOutputValidator(e.name);if(a){if(!i.structuredContent&&!i.isError)throw new Rl(xs.InvalidRequest,`Tool ${e.name} has an output schema but did not return structured content`);if(i.structuredContent)try{if(!a(i.structuredContent))throw new Rl(xs.InvalidParams,`Structured content does not match the tool's output schema: ${this._ajv.errorsText(a.errors)}`)}catch(s){throw s instanceof Rl?s:new Rl(xs.InvalidParams,`Failed to validate structured content: ${s instanceof Error?s.message:String(s)}`)}}return i}cacheToolOutputSchemas(e){this._cachedToolOutputValidators.clear();for(const t of e)if(t.outputSchema)try{const r=this._ajv.compile(t.outputSchema);this._cachedToolOutputValidators.set(t.name,r)}catch{}}getToolOutputValidator(e){return this._cachedToolOutputValidators.get(e)}async listTools(e,t){const r=await this.request({method:"tools/list",params:e},bI,t);return this.cacheToolOutputSchemas(r.tools),r}async sendRootsListChanged(){return this.notification({method:"notifications/roots/list_changed"})}}class U$ extends Error{constructor(e,t){super(e),this.name="ParseError",this.type=t.type,this.field=t.field,this.value=t.value,this.line=t.line}}function rT(n){}function C3(n){if(typeof n=="function")throw new TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");const{onEvent:e=rT,onError:t=rT,onRetry:r=rT,onComment:i}=n;let a="",s=!0,o,u="",c="";function d(w){const S=s?w.replace(/^\xEF\xBB\xBF/,""):w,[T,C]=OX(`${a}${S}`);for(const A of T)p(A);a=C,s=!1}function p(w){if(w===""){y();return}if(w.startsWith(":")){i&&i(w.slice(w.startsWith(": ")?2:1));return}const S=w.indexOf(":");if(S!==-1){const T=w.slice(0,S),C=w[S+1]===" "?2:1,A=w.slice(S+C);m(T,A,w);return}m(w,"",w)}function m(w,S,T){switch(w){case"event":c=S;break;case"data":u=`${u}${S}
`;break;case"id":o=S.includes("\0")?void 0:S;break;case"retry":/^\d+$/.test(S)?r(parseInt(S,10)):t(new U$(`Invalid \`retry\` value: "${S}"`,{type:"invalid-retry",value:S,line:T}));break;default:t(new U$(`Unknown field "${w.length>20?`${w.slice(0,20)}…`:w}"`,{type:"unknown-field",field:w,value:S,line:T}));break}}function y(){u.length>0&&e({id:o,event:c||void 0,data:u.endsWith(`
`)?u.slice(0,-1):u}),o=void 0,u="",c=""}function b(w={}){a&&w.consume&&p(a),s=!0,o=void 0,u="",c="",a=""}return{feed:d,reset:b}}function OX(n){const e=[];let t="",r=0;for(;r<n.length;){const i=n.indexOf("\r",r),a=n.indexOf(`
`,r);let s=-1;if(i!==-1&&a!==-1?s=Math.min(i,a):i!==-1?s=i:a!==-1&&(s=a),s===-1){t=n.slice(r);break}else{const o=n.slice(r,s);e.push(o),r=s+1,n[r-1]==="\r"&&n[r]===`
`&&r++}}return[e,t]}class j$ extends Event{constructor(e,t){var r,i;super(e),this.code=(r=t==null?void 0:t.code)!=null?r:void 0,this.message=(i=t==null?void 0:t.message)!=null?i:void 0}[Symbol.for("nodejs.util.inspect.custom")](e,t,r){return r(F$(this),t)}[Symbol.for("Deno.customInspect")](e,t){return e(F$(this),t)}}function NX(n){const e=globalThis.DOMException;return typeof e=="function"?new e(n,"SyntaxError"):new SyntaxError(n)}function _1(n){return n instanceof Error?"errors"in n&&Array.isArray(n.errors)?n.errors.map(_1).join(", "):"cause"in n&&n.cause instanceof Error?`${n}: ${_1(n.cause)}`:n.message:`${n}`}function F$(n){return{type:n.type,message:n.message,code:n.code,defaultPrevented:n.defaultPrevented,cancelable:n.cancelable,timeStamp:n.timeStamp}}var R3=n=>{throw TypeError(n)},TI=(n,e,t)=>e.has(n)||R3("Cannot "+t),Ht=(n,e,t)=>(TI(n,e,"read from private field"),t?t.call(n):e.get(n)),cr=(n,e,t)=>e.has(n)?R3("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(n):e.set(n,t),Nn=(n,e,t,r)=>(TI(n,e,"write to private field"),e.set(n,t),t),bo=(n,e,t)=>(TI(n,e,"access private method"),t),Ci,_u,mf,Yy,Jv,dp,Rf,hp,Tl,gf,Ff,yf,Hh,Qa,b1,w1,E1,B$,S1,T1,Gh,A1,C1;class Zy extends EventTarget{constructor(e,t){var r,i;super(),cr(this,Qa),this.CONNECTING=0,this.OPEN=1,this.CLOSED=2,cr(this,Ci),cr(this,_u),cr(this,mf),cr(this,Yy),cr(this,Jv),cr(this,dp),cr(this,Rf),cr(this,hp,null),cr(this,Tl),cr(this,gf),cr(this,Ff,null),cr(this,yf,null),cr(this,Hh,null),cr(this,w1,async a=>{var s;Ht(this,gf).reset();const{body:o,redirected:u,status:c,headers:d}=a;if(c===204){bo(this,Qa,Gh).call(this,"Server sent HTTP 204, not reconnecting",204),this.close();return}if(u?Nn(this,mf,new URL(a.url)):Nn(this,mf,void 0),c!==200){bo(this,Qa,Gh).call(this,`Non-200 status code (${c})`,c);return}if(!(d.get("content-type")||"").startsWith("text/event-stream")){bo(this,Qa,Gh).call(this,'Invalid content type, expected "text/event-stream"',c);return}if(Ht(this,Ci)===this.CLOSED)return;Nn(this,Ci,this.OPEN);const p=new Event("open");if((s=Ht(this,Hh))==null||s.call(this,p),this.dispatchEvent(p),typeof o!="object"||!o||!("getReader"in o)){bo(this,Qa,Gh).call(this,"Invalid response body, expected a web ReadableStream",c),this.close();return}const m=new TextDecoder,y=o.getReader();let b=!0;do{const{done:w,value:S}=await y.read();S&&Ht(this,gf).feed(m.decode(S,{stream:!w})),w&&(b=!1,Ht(this,gf).reset(),bo(this,Qa,A1).call(this))}while(b)}),cr(this,E1,a=>{Nn(this,Tl,void 0),!(a.name==="AbortError"||a.type==="aborted")&&bo(this,Qa,A1).call(this,_1(a))}),cr(this,S1,a=>{typeof a.id=="string"&&Nn(this,hp,a.id);const s=new MessageEvent(a.event||"message",{data:a.data,origin:Ht(this,mf)?Ht(this,mf).origin:Ht(this,_u).origin,lastEventId:a.id||""});Ht(this,yf)&&(!a.event||a.event==="message")&&Ht(this,yf).call(this,s),this.dispatchEvent(s)}),cr(this,T1,a=>{Nn(this,dp,a)}),cr(this,C1,()=>{Nn(this,Rf,void 0),Ht(this,Ci)===this.CONNECTING&&bo(this,Qa,b1).call(this)});try{if(e instanceof URL)Nn(this,_u,e);else if(typeof e=="string")Nn(this,_u,new URL(e,kX()));else throw new Error("Invalid URL")}catch{throw NX("An invalid or illegal string was specified")}Nn(this,gf,C3({onEvent:Ht(this,S1),onRetry:Ht(this,T1)})),Nn(this,Ci,this.CONNECTING),Nn(this,dp,3e3),Nn(this,Jv,(r=t==null?void 0:t.fetch)!=null?r:globalThis.fetch),Nn(this,Yy,(i=t==null?void 0:t.withCredentials)!=null?i:!1),bo(this,Qa,b1).call(this)}get readyState(){return Ht(this,Ci)}get url(){return Ht(this,_u).href}get withCredentials(){return Ht(this,Yy)}get onerror(){return Ht(this,Ff)}set onerror(e){Nn(this,Ff,e)}get onmessage(){return Ht(this,yf)}set onmessage(e){Nn(this,yf,e)}get onopen(){return Ht(this,Hh)}set onopen(e){Nn(this,Hh,e)}addEventListener(e,t,r){const i=t;super.addEventListener(e,i,r)}removeEventListener(e,t,r){const i=t;super.removeEventListener(e,i,r)}close(){Ht(this,Rf)&&clearTimeout(Ht(this,Rf)),Ht(this,Ci)!==this.CLOSED&&(Ht(this,Tl)&&Ht(this,Tl).abort(),Nn(this,Ci,this.CLOSED),Nn(this,Tl,void 0))}}Ci=new WeakMap,_u=new WeakMap,mf=new WeakMap,Yy=new WeakMap,Jv=new WeakMap,dp=new WeakMap,Rf=new WeakMap,hp=new WeakMap,Tl=new WeakMap,gf=new WeakMap,Ff=new WeakMap,yf=new WeakMap,Hh=new WeakMap,Qa=new WeakSet,b1=function(){Nn(this,Ci,this.CONNECTING),Nn(this,Tl,new AbortController),Ht(this,Jv)(Ht(this,_u),bo(this,Qa,B$).call(this)).then(Ht(this,w1)).catch(Ht(this,E1))},w1=new WeakMap,E1=new WeakMap,B$=function(){var n;const e={mode:"cors",redirect:"follow",headers:{Accept:"text/event-stream",...Ht(this,hp)?{"Last-Event-ID":Ht(this,hp)}:void 0},cache:"no-store",signal:(n=Ht(this,Tl))==null?void 0:n.signal};return"window"in globalThis&&(e.credentials=this.withCredentials?"include":"same-origin"),e},S1=new WeakMap,T1=new WeakMap,Gh=function(n,e){var t;Ht(this,Ci)!==this.CLOSED&&Nn(this,Ci,this.CLOSED);const r=new j$("error",{code:e,message:n});(t=Ht(this,Ff))==null||t.call(this,r),this.dispatchEvent(r)},A1=function(n,e){var t;if(Ht(this,Ci)===this.CLOSED)return;Nn(this,Ci,this.CONNECTING);const r=new j$("error",{code:e,message:n});(t=Ht(this,Ff))==null||t.call(this,r),this.dispatchEvent(r),Nn(this,Rf,setTimeout(Ht(this,C1),Ht(this,dp)))},C1=new WeakMap,Zy.CONNECTING=0,Zy.OPEN=1,Zy.CLOSED=2;function kX(){const n="document"in globalThis?globalThis.document:void 0;return n&&typeof n=="object"&&"baseURI"in n&&typeof n.baseURI=="string"?n.baseURI:void 0}let AI;AI=globalThis.crypto;async function MX(n){return(await AI).getRandomValues(new Uint8Array(n))}async function DX(n){const e="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-._~";let t="";const r=await MX(n);for(let i=0;i<n;i++){const a=r[i]%e.length;t+=e[a]}return t}async function $X(n){return await DX(n)}async function LX(n){const e=await(await AI).subtle.digest("SHA-256",new TextEncoder().encode(n));return btoa(String.fromCharCode(...new Uint8Array(e))).replace(/\//g,"_").replace(/\+/g,"-").replace(/=/g,"")}async function UX(n){if(n||(n=43),n<43||n>128)throw`Expected a length between 43 and 128. Received ${n}.`;const e=await $X(n),t=await LX(e);return{code_verifier:e,code_challenge:t}}const jX=Xe({resource:Me().url(),authorization_servers:Pt(Me().url()).optional(),jwks_uri:Me().url().optional(),scopes_supported:Pt(Me()).optional(),bearer_methods_supported:Pt(Me()).optional(),resource_signing_alg_values_supported:Pt(Me()).optional(),resource_name:Me().optional(),resource_documentation:Me().optional(),resource_policy_uri:Me().url().optional(),resource_tos_uri:Me().url().optional(),tls_client_certificate_bound_access_tokens:qr().optional(),authorization_details_types_supported:Pt(Me()).optional(),dpop_signing_alg_values_supported:Pt(Me()).optional(),dpop_bound_access_tokens_required:qr().optional()}).passthrough(),FX=Xe({issuer:Me(),authorization_endpoint:Me(),token_endpoint:Me(),registration_endpoint:Me().optional(),scopes_supported:Pt(Me()).optional(),response_types_supported:Pt(Me()),response_modes_supported:Pt(Me()).optional(),grant_types_supported:Pt(Me()).optional(),token_endpoint_auth_methods_supported:Pt(Me()).optional(),token_endpoint_auth_signing_alg_values_supported:Pt(Me()).optional(),service_documentation:Me().optional(),revocation_endpoint:Me().optional(),revocation_endpoint_auth_methods_supported:Pt(Me()).optional(),revocation_endpoint_auth_signing_alg_values_supported:Pt(Me()).optional(),introspection_endpoint:Me().optional(),introspection_endpoint_auth_methods_supported:Pt(Me()).optional(),introspection_endpoint_auth_signing_alg_values_supported:Pt(Me()).optional(),code_challenge_methods_supported:Pt(Me()).optional()}).passthrough(),I3=Xe({access_token:Me(),token_type:Me(),expires_in:zn().optional(),scope:Me().optional(),refresh_token:Me().optional()}).strip();Xe({error:Me(),error_description:Me().optional(),error_uri:Me().optional()});const BX=Xe({redirect_uris:Pt(Me()).refine(n=>n.every(e=>URL.canParse(e)),{message:"redirect_uris must contain valid URLs"}),token_endpoint_auth_method:Me().optional(),grant_types:Pt(Me()).optional(),response_types:Pt(Me()).optional(),client_name:Me().optional(),client_uri:Me().optional(),logo_uri:Me().optional(),scope:Me().optional(),contacts:Pt(Me()).optional(),tos_uri:Me().optional(),policy_uri:Me().optional(),jwks_uri:Me().optional(),jwks:Pa().optional(),software_id:Me().optional(),software_version:Me().optional(),software_statement:Me().optional()}).strip(),qX=Xe({client_id:Me(),client_secret:Me().optional(),client_id_issued_at:zn().optional(),client_secret_expires_at:zn().optional()}).strip(),VX=BX.merge(qX);Xe({error:Me(),error_description:Me().optional()}).strip();Xe({token:Me(),token_type_hint:Me().optional()}).strip();function zX(n){const e=typeof n=="string"?new URL(n):new URL(n.href);return e.hash="",e}function HX({requestedResource:n,configuredResource:e}){const t=typeof n=="string"?new URL(n):new URL(n.href),r=typeof e=="string"?new URL(e):new URL(e.href);if(t.origin!==r.origin||t.pathname.length<r.pathname.length)return!1;const i=t.pathname.endsWith("/")?t.pathname:t.pathname+"/",a=r.pathname.endsWith("/")?r.pathname:r.pathname+"/";return i.startsWith(a)}class Os extends Error{constructor(e){super(e??"Unauthorized")}}async function Bf(n,{serverUrl:e,authorizationCode:t,scope:r,resourceMetadataUrl:i}){let a,s=e;try{a=await WX(e,{resourceMetadataUrl:i}),a.authorization_servers&&a.authorization_servers.length>0&&(s=a.authorization_servers[0])}catch{}const o=await GX(e,n,a),u=await ZX(s);let c=await Promise.resolve(n.clientInformation());if(!c){if(t!==void 0)throw new Error("Existing OAuth client information is required when exchanging an authorization code");if(!n.saveClientInformation)throw new Error("OAuth client information must be saveable for dynamic registration");const b=await tQ(s,{metadata:u,clientMetadata:n.clientMetadata});await n.saveClientInformation(b),c=b}if(t!==void 0){const b=await n.codeVerifier(),w=await QX(s,{metadata:u,clientInformation:c,authorizationCode:t,codeVerifier:b,redirectUri:n.redirectUrl,resource:o});return await n.saveTokens(w),"AUTHORIZED"}const d=await n.tokens();if(d!=null&&d.refresh_token)try{const b=await eQ(s,{metadata:u,clientInformation:c,refreshToken:d.refresh_token,resource:o});return await n.saveTokens(b),"AUTHORIZED"}catch{}const p=n.state?await n.state():void 0,{authorizationUrl:m,codeVerifier:y}=await XX(s,{metadata:u,clientInformation:c,state:p,redirectUrl:n.redirectUrl,scope:r||n.clientMetadata.scope,resource:o});return await n.saveCodeVerifier(y),await n.redirectToAuthorization(m),"REDIRECT"}async function GX(n,e,t){const r=zX(n);if(e.validateResourceURL)return await e.validateResourceURL(r,t==null?void 0:t.resource);if(t){if(!HX({requestedResource:r,configuredResource:t.resource}))throw new Error(`Protected resource ${t.resource} does not match expected ${r} (or origin)`);return new URL(t.resource)}}function R1(n){const e=n.headers.get("WWW-Authenticate");if(!e)return;const[t,r]=e.split(" ");if(t.toLowerCase()!=="bearer"||!r)return;const a=/resource_metadata="([^"]*)"/.exec(e);if(a)try{return new URL(a[1])}catch{return}}async function WX(n,e){var t;let r;e!=null&&e.resourceMetadataUrl?r=new URL(e==null?void 0:e.resourceMetadataUrl):r=new URL("/.well-known/oauth-protected-resource",n);let i;try{i=await fetch(r,{headers:{"MCP-Protocol-Version":(t=e==null?void 0:e.protocolVersion)!==null&&t!==void 0?t:X_}})}catch(a){if(a instanceof TypeError)i=await fetch(r);else throw a}if(i.status===404)throw new Error("Resource server does not implement OAuth 2.0 Protected Resource Metadata.");if(!i.ok)throw new Error(`HTTP ${i.status} trying to load well-known OAuth protected resource metadata.`);return jX.parse(await i.json())}async function KX(n,e){try{return await fetch(n,{headers:e})}catch(t){if(t instanceof TypeError)return await fetch(n);throw t}}function JX(n){let e=`/.well-known/oauth-authorization-server${n}`;return n.endsWith("/")&&(e=e.slice(0,-1)),e}async function q$(n,e){return await KX(n,{"MCP-Protocol-Version":e})}function YX(n,e){return n.status===404&&e!=="/"}async function ZX(n,e){var t;const r=new URL(n),i=(t=void 0)!==null&&t!==void 0?t:X_,a=JX(r.pathname),s=new URL(a,r);let o=await q$(s,i);if(YX(o,r.pathname))try{const u=new URL("/.well-known/oauth-authorization-server",r);if(o=await q$(u,i),o.status===404)return}catch{return}else if(o.status===404)return;if(!o.ok)throw new Error(`HTTP ${o.status} trying to load well-known OAuth metadata`);return FX.parse(await o.json())}async function XX(n,{metadata:e,clientInformation:t,redirectUrl:r,scope:i,state:a,resource:s}){const o="code",u="S256";let c;if(e){if(c=new URL(e.authorization_endpoint),!e.response_types_supported.includes(o))throw new Error(`Incompatible auth server: does not support response type ${o}`);if(!e.code_challenge_methods_supported||!e.code_challenge_methods_supported.includes(u))throw new Error(`Incompatible auth server: does not support code challenge method ${u}`)}else c=new URL("/authorize",n);const d=await UX(),p=d.code_verifier,m=d.code_challenge;return c.searchParams.set("response_type",o),c.searchParams.set("client_id",t.client_id),c.searchParams.set("code_challenge",m),c.searchParams.set("code_challenge_method",u),c.searchParams.set("redirect_uri",String(r)),a&&c.searchParams.set("state",a),i&&c.searchParams.set("scope",i),s&&c.searchParams.set("resource",s.href),{authorizationUrl:c,codeVerifier:p}}async function QX(n,{metadata:e,clientInformation:t,authorizationCode:r,codeVerifier:i,redirectUri:a,resource:s}){const o="authorization_code";let u;if(e){if(u=new URL(e.token_endpoint),e.grant_types_supported&&!e.grant_types_supported.includes(o))throw new Error(`Incompatible auth server: does not support grant type ${o}`)}else u=new URL("/token",n);const c=new URLSearchParams({grant_type:o,client_id:t.client_id,code:r,code_verifier:i,redirect_uri:String(a)});t.client_secret&&c.set("client_secret",t.client_secret),s&&c.set("resource",s.href);const d=await fetch(u,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c});if(!d.ok)throw new Error(`Token exchange failed: HTTP ${d.status}`);return I3.parse(await d.json())}async function eQ(n,{metadata:e,clientInformation:t,refreshToken:r,resource:i}){const a="refresh_token";let s;if(e){if(s=new URL(e.token_endpoint),e.grant_types_supported&&!e.grant_types_supported.includes(a))throw new Error(`Incompatible auth server: does not support grant type ${a}`)}else s=new URL("/token",n);const o=new URLSearchParams({grant_type:a,client_id:t.client_id,refresh_token:r});t.client_secret&&o.set("client_secret",t.client_secret),i&&o.set("resource",i.href);const u=await fetch(s,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o});if(!u.ok)throw new Error(`Token refresh failed: HTTP ${u.status}`);return I3.parse({refresh_token:r,...await u.json()})}async function tQ(n,{metadata:e,clientMetadata:t}){let r;if(e){if(!e.registration_endpoint)throw new Error("Incompatible auth server: does not support dynamic client registration");r=new URL(e.registration_endpoint)}else r=new URL("/register",n);const i=await fetch(r,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!i.ok)throw new Error(`Dynamic client registration failed: HTTP ${i.status}`);return VX.parse(await i.json())}class nQ extends Error{constructor(e,t,r){super(`SSE error: ${t}`),this.code=e,this.event=r}}class V${constructor(e,t){this._url=e,this._resourceMetadataUrl=void 0,this._eventSourceInit=t==null?void 0:t.eventSourceInit,this._requestInit=t==null?void 0:t.requestInit,this._authProvider=t==null?void 0:t.authProvider}async _authThenStart(){var e;if(!this._authProvider)throw new Os("No auth provider");let t;try{t=await Bf(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl})}catch(r){throw(e=this.onerror)===null||e===void 0||e.call(this,r),r}if(t!=="AUTHORIZED")throw new Os;return await this._startOrAuth()}async _commonHeaders(){var e;const t={...(e=this._requestInit)===null||e===void 0?void 0:e.headers};if(this._authProvider){const r=await this._authProvider.tokens();r&&(t.Authorization=`Bearer ${r.access_token}`)}return this._protocolVersion&&(t["mcp-protocol-version"]=this._protocolVersion),t}_startOrAuth(){var e;const t=((e=this===null||this===void 0?void 0:this._eventSourceInit)===null||e===void 0?void 0:e.fetch)||fetch;return new Promise((r,i)=>{this._eventSource=new Zy(this._url.href,{...this._eventSourceInit,fetch:async(a,s)=>{const o=await this._commonHeaders(),u=await t(a,{...s,headers:new Headers({...o,Accept:"text/event-stream"})});return u.status===401&&u.headers.has("www-authenticate")&&(this._resourceMetadataUrl=R1(u)),u}}),this._abortController=new AbortController,this._eventSource.onerror=a=>{var s;if(a.code===401&&this._authProvider){this._authThenStart().then(r,i);return}const o=new nQ(a.code,a.message,a);i(o),(s=this.onerror)===null||s===void 0||s.call(this,o)},this._eventSource.onopen=()=>{},this._eventSource.addEventListener("endpoint",a=>{var s;const o=a;try{if(this._endpoint=new URL(o.data,this._url),this._endpoint.origin!==this._url.origin)throw new Error(`Endpoint origin does not match connection origin: ${this._endpoint.origin}`)}catch(u){i(u),(s=this.onerror)===null||s===void 0||s.call(this,u),this.close();return}r()}),this._eventSource.onmessage=a=>{var s,o;const u=a;let c;try{c=jf.parse(JSON.parse(u.data))}catch(d){(s=this.onerror)===null||s===void 0||s.call(this,d);return}(o=this.onmessage)===null||o===void 0||o.call(this,c)}})}async start(){if(this._eventSource)throw new Error("SSEClientTransport already started! If using Client class, note that connect() calls start() automatically.");return await this._startOrAuth()}async finishAuth(e){if(!this._authProvider)throw new Os("No auth provider");if(await Bf(this._authProvider,{serverUrl:this._url,authorizationCode:e,resourceMetadataUrl:this._resourceMetadataUrl})!=="AUTHORIZED")throw new Os("Failed to authorize")}async close(){var e,t,r;(e=this._abortController)===null||e===void 0||e.abort(),(t=this._eventSource)===null||t===void 0||t.close(),(r=this.onclose)===null||r===void 0||r.call(this)}async send(e){var t,r;if(!this._endpoint)throw new Error("Not connected");try{const i=await this._commonHeaders(),a=new Headers(i);a.set("content-type","application/json");const s={...this._requestInit,method:"POST",headers:a,body:JSON.stringify(e),signal:(t=this._abortController)===null||t===void 0?void 0:t.signal},o=await fetch(this._endpoint,s);if(!o.ok){if(o.status===401&&this._authProvider){if(this._resourceMetadataUrl=R1(o),await Bf(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl})!=="AUTHORIZED")throw new Os;return this.send(e)}const u=await o.text().catch(()=>null);throw new Error(`Error POSTing to endpoint (HTTP ${o.status}): ${u}`)}}catch(i){throw(r=this.onerror)===null||r===void 0||r.call(this,i),i}}setProtocolVersion(e){this._protocolVersion=e}}class rQ extends TransformStream{constructor({onError:e,onRetry:t,onComment:r}={}){let i;super({start(a){i=C3({onEvent:s=>{a.enqueue(s)},onError(s){e==="terminate"?a.error(s):typeof e=="function"&&e(s)},onRetry:t,onComment:r})},transform(a){i.feed(a)}})}}const iQ={initialReconnectionDelay:1e3,maxReconnectionDelay:3e4,reconnectionDelayGrowFactor:1.5,maxRetries:2};class iT extends Error{constructor(e,t){super(`Streamable HTTP error: ${t}`),this.code=e}}class I1{constructor(e,t){var r;this._url=e,this._resourceMetadataUrl=void 0,this._requestInit=t==null?void 0:t.requestInit,this._authProvider=t==null?void 0:t.authProvider,this._sessionId=t==null?void 0:t.sessionId,this._reconnectionOptions=(r=t==null?void 0:t.reconnectionOptions)!==null&&r!==void 0?r:iQ}async _authThenStart(){var e;if(!this._authProvider)throw new Os("No auth provider");let t;try{t=await Bf(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl})}catch(r){throw(e=this.onerror)===null||e===void 0||e.call(this,r),r}if(t!=="AUTHORIZED")throw new Os;return await this._startOrAuthSse({resumptionToken:void 0})}async _commonHeaders(){var e;const t={};if(this._authProvider){const r=await this._authProvider.tokens();r&&(t.Authorization=`Bearer ${r.access_token}`)}return this._sessionId&&(t["mcp-session-id"]=this._sessionId),this._protocolVersion&&(t["mcp-protocol-version"]=this._protocolVersion),new Headers({...t,...(e=this._requestInit)===null||e===void 0?void 0:e.headers})}async _startOrAuthSse(e){var t,r;const{resumptionToken:i}=e;try{const a=await this._commonHeaders();a.set("Accept","text/event-stream"),i&&a.set("last-event-id",i);const s=await fetch(this._url,{method:"GET",headers:a,signal:(t=this._abortController)===null||t===void 0?void 0:t.signal});if(!s.ok){if(s.status===401&&this._authProvider)return await this._authThenStart();if(s.status===405)return;throw new iT(s.status,`Failed to open SSE stream: ${s.statusText}`)}this._handleSseStream(s.body,e)}catch(a){throw(r=this.onerror)===null||r===void 0||r.call(this,a),a}}_getNextReconnectionDelay(e){const t=this._reconnectionOptions.initialReconnectionDelay,r=this._reconnectionOptions.reconnectionDelayGrowFactor,i=this._reconnectionOptions.maxReconnectionDelay;return Math.min(t*Math.pow(r,e),i)}_scheduleReconnection(e,t=0){var r;const i=this._reconnectionOptions.maxRetries;if(i>0&&t>=i){(r=this.onerror)===null||r===void 0||r.call(this,new Error(`Maximum reconnection attempts (${i}) exceeded.`));return}const a=this._getNextReconnectionDelay(t);setTimeout(()=>{this._startOrAuthSse(e).catch(s=>{var o;(o=this.onerror)===null||o===void 0||o.call(this,new Error(`Failed to reconnect SSE stream: ${s instanceof Error?s.message:String(s)}`)),this._scheduleReconnection(e,t+1)})},a)}_handleSseStream(e,t){if(!e)return;const{onresumptiontoken:r,replayMessageId:i}=t;let a;(async()=>{var o,u,c,d;try{const p=e.pipeThrough(new TextDecoderStream).pipeThrough(new rQ).getReader();for(;;){const{value:m,done:y}=await p.read();if(y)break;if(m.id&&(a=m.id,r==null||r(m.id)),!m.event||m.event==="message")try{const b=jf.parse(JSON.parse(m.data));i!==void 0&&y1(b)&&(b.id=i),(o=this.onmessage)===null||o===void 0||o.call(this,b)}catch(b){(u=this.onerror)===null||u===void 0||u.call(this,b)}}}catch(p){if((c=this.onerror)===null||c===void 0||c.call(this,new Error(`SSE stream disconnected: ${p}`)),this._abortController&&!this._abortController.signal.aborted&&a!==void 0)try{this._scheduleReconnection({resumptionToken:a,onresumptiontoken:r,replayMessageId:i},0)}catch(m){(d=this.onerror)===null||d===void 0||d.call(this,new Error(`Failed to reconnect: ${m instanceof Error?m.message:String(m)}`))}}})()}async start(){if(this._abortController)throw new Error("StreamableHTTPClientTransport already started! If using Client class, note that connect() calls start() automatically.");this._abortController=new AbortController}async finishAuth(e){if(!this._authProvider)throw new Os("No auth provider");if(await Bf(this._authProvider,{serverUrl:this._url,authorizationCode:e,resourceMetadataUrl:this._resourceMetadataUrl})!=="AUTHORIZED")throw new Os("Failed to authorize")}async close(){var e,t;(e=this._abortController)===null||e===void 0||e.abort(),(t=this.onclose)===null||t===void 0||t.call(this)}async send(e,t){var r,i,a;try{const{resumptionToken:s,onresumptiontoken:o}=t||{};if(s){this._startOrAuthSse({resumptionToken:s,replayMessageId:r3(e)?e.id:void 0}).catch(w=>{var S;return(S=this.onerror)===null||S===void 0?void 0:S.call(this,w)});return}const u=await this._commonHeaders();u.set("content-type","application/json"),u.set("accept","application/json, text/event-stream");const c={...this._requestInit,method:"POST",headers:u,body:JSON.stringify(e),signal:(r=this._abortController)===null||r===void 0?void 0:r.signal},d=await fetch(this._url,c),p=d.headers.get("mcp-session-id");if(p&&(this._sessionId=p),!d.ok){if(d.status===401&&this._authProvider){if(this._resourceMetadataUrl=R1(d),await Bf(this._authProvider,{serverUrl:this._url,resourceMetadataUrl:this._resourceMetadataUrl})!=="AUTHORIZED")throw new Os;return this.send(e)}const w=await d.text().catch(()=>null);throw new Error(`Error POSTing to endpoint (HTTP ${d.status}): ${w}`)}if(d.status===202){qY(e)&&this._startOrAuthSse({resumptionToken:void 0}).catch(w=>{var S;return(S=this.onerror)===null||S===void 0?void 0:S.call(this,w)});return}const y=(Array.isArray(e)?e:[e]).filter(w=>"method"in w&&"id"in w&&w.id!==void 0).length>0,b=d.headers.get("content-type");if(y)if(b!=null&&b.includes("text/event-stream"))this._handleSseStream(d.body,{onresumptiontoken:o});else if(b!=null&&b.includes("application/json")){const w=await d.json(),S=Array.isArray(w)?w.map(T=>jf.parse(T)):[jf.parse(w)];for(const T of S)(i=this.onmessage)===null||i===void 0||i.call(this,T)}else throw new iT(-1,`Unexpected content type: ${b}`)}catch(s){throw(a=this.onerror)===null||a===void 0||a.call(this,s),s}}get sessionId(){return this._sessionId}async terminateSession(){var e,t;if(this._sessionId)try{const r=await this._commonHeaders(),i={...this._requestInit,method:"DELETE",headers:r,signal:(e=this._abortController)===null||e===void 0?void 0:e.signal},a=await fetch(this._url,i);if(!a.ok&&a.status!==405)throw new iT(a.status,`Failed to terminate session: ${a.statusText}`);this._sessionId=void 0}catch(r){throw(t=this.onerror)===null||t===void 0||t.call(this,r),r}}setProtocolVersion(e){this._protocolVersion=e}get protocolVersion(){return this._protocolVersion}}var du={exports:{}},aQ=null;const sQ=Object.freeze(Object.defineProperty({__proto__:null,default:aQ},Symbol.toStringTag,{value:"Module"})),ib=Kz(sQ);var aT,z$;function CI(){if(z$)return aT;z$=1;function n(i){if(typeof i!="string")throw new TypeError("Path must be a string. Received "+JSON.stringify(i))}function e(i,a){for(var s="",o=0,u=-1,c=0,d,p=0;p<=i.length;++p){if(p<i.length)d=i.charCodeAt(p);else{if(d===47)break;d=47}if(d===47){if(!(u===p-1||c===1))if(u!==p-1&&c===2){if(s.length<2||o!==2||s.charCodeAt(s.length-1)!==46||s.charCodeAt(s.length-2)!==46){if(s.length>2){var m=s.lastIndexOf("/");if(m!==s.length-1){m===-1?(s="",o=0):(s=s.slice(0,m),o=s.length-1-s.lastIndexOf("/")),u=p,c=0;continue}}else if(s.length===2||s.length===1){s="",o=0,u=p,c=0;continue}}a&&(s.length>0?s+="/..":s="..",o=2)}else s.length>0?s+="/"+i.slice(u+1,p):s=i.slice(u+1,p),o=p-u-1;u=p,c=0}else d===46&&c!==-1?++c:c=-1}return s}function t(i,a){var s=a.dir||a.root,o=a.base||(a.name||"")+(a.ext||"");return s?s===a.root?s+o:s+i+o:o}var r={resolve:function(){for(var a="",s=!1,o,u=arguments.length-1;u>=-1&&!s;u--){var c;u>=0?c=arguments[u]:(o===void 0&&(o=at.cwd()),c=o),n(c),c.length!==0&&(a=c+"/"+a,s=c.charCodeAt(0)===47)}return a=e(a,!s),s?a.length>0?"/"+a:"/":a.length>0?a:"."},normalize:function(a){if(n(a),a.length===0)return".";var s=a.charCodeAt(0)===47,o=a.charCodeAt(a.length-1)===47;return a=e(a,!s),a.length===0&&!s&&(a="."),a.length>0&&o&&(a+="/"),s?"/"+a:a},isAbsolute:function(a){return n(a),a.length>0&&a.charCodeAt(0)===47},join:function(){if(arguments.length===0)return".";for(var a,s=0;s<arguments.length;++s){var o=arguments[s];n(o),o.length>0&&(a===void 0?a=o:a+="/"+o)}return a===void 0?".":r.normalize(a)},relative:function(a,s){if(n(a),n(s),a===s||(a=r.resolve(a),s=r.resolve(s),a===s))return"";for(var o=1;o<a.length&&a.charCodeAt(o)===47;++o);for(var u=a.length,c=u-o,d=1;d<s.length&&s.charCodeAt(d)===47;++d);for(var p=s.length,m=p-d,y=c<m?c:m,b=-1,w=0;w<=y;++w){if(w===y){if(m>y){if(s.charCodeAt(d+w)===47)return s.slice(d+w+1);if(w===0)return s.slice(d+w)}else c>y&&(a.charCodeAt(o+w)===47?b=w:w===0&&(b=0));break}var S=a.charCodeAt(o+w),T=s.charCodeAt(d+w);if(S!==T)break;S===47&&(b=w)}var C="";for(w=o+b+1;w<=u;++w)(w===u||a.charCodeAt(w)===47)&&(C.length===0?C+="..":C+="/..");return C.length>0?C+s.slice(d+b):(d+=b,s.charCodeAt(d)===47&&++d,s.slice(d))},_makeLong:function(a){return a},dirname:function(a){if(n(a),a.length===0)return".";for(var s=a.charCodeAt(0),o=s===47,u=-1,c=!0,d=a.length-1;d>=1;--d)if(s=a.charCodeAt(d),s===47){if(!c){u=d;break}}else c=!1;return u===-1?o?"/":".":o&&u===1?"//":a.slice(0,u)},basename:function(a,s){if(s!==void 0&&typeof s!="string")throw new TypeError('"ext" argument must be a string');n(a);var o=0,u=-1,c=!0,d;if(s!==void 0&&s.length>0&&s.length<=a.length){if(s.length===a.length&&s===a)return"";var p=s.length-1,m=-1;for(d=a.length-1;d>=0;--d){var y=a.charCodeAt(d);if(y===47){if(!c){o=d+1;break}}else m===-1&&(c=!1,m=d+1),p>=0&&(y===s.charCodeAt(p)?--p===-1&&(u=d):(p=-1,u=m))}return o===u?u=m:u===-1&&(u=a.length),a.slice(o,u)}else{for(d=a.length-1;d>=0;--d)if(a.charCodeAt(d)===47){if(!c){o=d+1;break}}else u===-1&&(c=!1,u=d+1);return u===-1?"":a.slice(o,u)}},extname:function(a){n(a);for(var s=-1,o=0,u=-1,c=!0,d=0,p=a.length-1;p>=0;--p){var m=a.charCodeAt(p);if(m===47){if(!c){o=p+1;break}continue}u===-1&&(c=!1,u=p+1),m===46?s===-1?s=p:d!==1&&(d=1):s!==-1&&(d=-1)}return s===-1||u===-1||d===0||d===1&&s===u-1&&s===o+1?"":a.slice(s,u)},format:function(a){if(a===null||typeof a!="object")throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof a);return t("/",a)},parse:function(a){n(a);var s={root:"",dir:"",base:"",ext:"",name:""};if(a.length===0)return s;var o=a.charCodeAt(0),u=o===47,c;u?(s.root="/",c=1):c=0;for(var d=-1,p=0,m=-1,y=!0,b=a.length-1,w=0;b>=c;--b){if(o=a.charCodeAt(b),o===47){if(!y){p=b+1;break}continue}m===-1&&(y=!1,m=b+1),o===46?d===-1?d=b:w!==1&&(w=1):d!==-1&&(w=-1)}return d===-1||m===-1||w===0||w===1&&d===m-1&&d===p+1?m!==-1&&(p===0&&u?s.base=s.name=a.slice(1,m):s.base=s.name=a.slice(p,m)):(p===0&&u?(s.name=a.slice(1,d),s.base=a.slice(1,m)):(s.name=a.slice(p,d),s.base=a.slice(p,m)),s.ext=a.slice(d,m)),p>0?s.dir=a.slice(0,p-1):u&&(s.dir="/"),s},sep:"/",delimiter:":",win32:null,posix:null};return r.posix=r,aT=r,aT}var sT,H$;function oQ(){if(H$)return sT;H$=1;var n={};sT=i,i.sync=a;var e=ib;function t(s,o){var u=o.pathExt!==void 0?o.pathExt:n.PATHEXT;if(!u||(u=u.split(";"),u.indexOf("")!==-1))return!0;for(var c=0;c<u.length;c++){var d=u[c].toLowerCase();if(d&&s.substr(-d.length).toLowerCase()===d)return!0}return!1}function r(s,o,u){return!s.isSymbolicLink()&&!s.isFile()?!1:t(o,u)}function i(s,o,u){e.stat(s,function(c,d){u(c,c?!1:r(d,s,o))})}function a(s,o){return r(e.statSync(s),s,o)}return sT}var oT,G$;function lQ(){if(G$)return oT;G$=1,oT=e,e.sync=t;var n=ib;function e(a,s,o){n.stat(a,function(u,c){o(u,u?!1:r(c,s))})}function t(a,s){return r(n.statSync(a),s)}function r(a,s){return a.isFile()&&i(a,s)}function i(a,s){var o=a.mode,u=a.uid,c=a.gid,d=s.uid!==void 0?s.uid:at.getuid&&at.getuid(),p=s.gid!==void 0?s.gid:at.getgid&&at.getgid(),m=parseInt("100",8),y=parseInt("010",8),b=parseInt("001",8),w=m|y,S=o&b||o&y&&c===p||o&m&&u===d||o&w&&d===0;return S}return oT}var lT,W$;function uQ(){if(W$)return lT;W$=1;var n;at.platform==="win32"||window.TESTING_WINDOWS?n=oQ():n=lQ(),lT=e,e.sync=t;function e(r,i,a){if(typeof i=="function"&&(a=i,i={}),!a){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(s,o){e(r,i||{},function(u,c){u?o(u):s(c)})})}n(r,i||{},function(s,o){s&&(s.code==="EACCES"||i&&i.ignoreErrors)&&(s=null,o=!1),a(s,o)})}function t(r,i){try{return n.sync(r,i||{})}catch(a){if(i&&i.ignoreErrors||a.code==="EACCES")return!1;throw a}}return lT}var uT,K$;function cQ(){if(K$)return uT;K$=1;var n={};const e=at.platform==="win32"||n.OSTYPE==="cygwin"||n.OSTYPE==="msys",t=CI(),r=e?";":":",i=uQ(),a=c=>Object.assign(new Error(`not found: ${c}`),{code:"ENOENT"}),s=(c,d)=>{const p=d.colon||r,m=c.match(/\//)||e&&c.match(/\\/)?[""]:[...e?[at.cwd()]:[],...(d.path||n.PATH||"").split(p)],y=e?d.pathExt||n.PATHEXT||".EXE;.CMD;.BAT;.COM":"",b=e?y.split(p):[""];return e&&c.indexOf(".")!==-1&&b[0]!==""&&b.unshift(""),{pathEnv:m,pathExt:b,pathExtExe:y}},o=(c,d,p)=>{typeof d=="function"&&(p=d,d={}),d||(d={});const{pathEnv:m,pathExt:y,pathExtExe:b}=s(c,d),w=[],S=C=>new Promise((A,I)=>{if(C===m.length)return d.all&&w.length?A(w):I(a(c));const x=m[C],L=/^".*"$/.test(x)?x.slice(1,-1):x,U=t.join(L,c),N=!L&&/^\.[\\\/]/.test(c)?c.slice(0,2)+U:U;A(T(N,C,0))}),T=(C,A,I)=>new Promise((x,L)=>{if(I===y.length)return x(S(A+1));const U=y[I];i(C+U,{pathExt:b},(N,B)=>{if(!N&&B)if(d.all)w.push(C+U);else return x(C+U);return x(T(C,A,I+1))})});return p?S(0).then(C=>p(null,C),p):S(0)},u=(c,d)=>{d=d||{};const{pathEnv:p,pathExt:m,pathExtExe:y}=s(c,d),b=[];for(let w=0;w<p.length;w++){const S=p[w],T=/^".*"$/.test(S)?S.slice(1,-1):S,C=t.join(T,c),A=!T&&/^\.[\\\/]/.test(c)?c.slice(0,2)+C:C;for(let I=0;I<m.length;I++){const x=A+m[I];try{if(i.sync(x,{pathExt:y}))if(d.all)b.push(x);else return x}catch{}}}if(d.all&&b.length)return b;if(d.nothrow)return null;throw a(c)};return uT=o,o.sync=u,uT}var ay={exports:{}},J$;function fQ(){if(J$)return ay.exports;J$=1;var n={};const e=(t={})=>{const r=t.env||n;return(t.platform||at.platform)!=="win32"?"PATH":Object.keys(r).reverse().find(a=>a.toUpperCase()==="PATH")||"Path"};return ay.exports=e,ay.exports.default=e,ay.exports}var cT,Y$;function dQ(){if(Y$)return cT;Y$=1;var n={};const e=CI(),t=cQ(),r=fQ();function i(s,o){const u=s.options.env||n,c=at.cwd(),d=s.options.cwd!=null,p=d&&at.chdir!==void 0&&!at.chdir.disabled;if(p)try{at.chdir(s.options.cwd)}catch{}let m;try{m=t.sync(s.command,{path:u[r({env:u})],pathExt:o?e.delimiter:void 0})}catch{}finally{p&&at.chdir(c)}return m&&(m=e.resolve(d?s.options.cwd:"",m)),m}function a(s){return i(s)||i(s,!0)}return cT=a,cT}var sy={},Z$;function hQ(){if(Z$)return sy;Z$=1;const n=/([()\][%!^"`<>&|;, *?])/g;function e(r){return r=r.replace(n,"^$1"),r}function t(r,i){return r=`${r}`,r=r.replace(/(?=(\\+?)?)\1"/g,'$1$1\\"'),r=r.replace(/(?=(\\+?)?)\1$/,"$1$1"),r=`"${r}"`,r=r.replace(n,"^$1"),i&&(r=r.replace(n,"^$1")),r}return sy.command=e,sy.argument=t,sy}var P3={},ab={};ab.byteLength=gQ;ab.toByteArray=vQ;ab.fromByteArray=wQ;var Ns=[],Aa=[],pQ=typeof Uint8Array<"u"?Uint8Array:Array,fT="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var ef=0,mQ=fT.length;ef<mQ;++ef)Ns[ef]=fT[ef],Aa[fT.charCodeAt(ef)]=ef;Aa[45]=62;Aa[95]=63;function x3(n){var e=n.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var t=n.indexOf("=");t===-1&&(t=e);var r=t===e?0:4-t%4;return[t,r]}function gQ(n){var e=x3(n),t=e[0],r=e[1];return(t+r)*3/4-r}function yQ(n,e,t){return(e+t)*3/4-t}function vQ(n){var e,t=x3(n),r=t[0],i=t[1],a=new pQ(yQ(n,r,i)),s=0,o=i>0?r-4:r,u;for(u=0;u<o;u+=4)e=Aa[n.charCodeAt(u)]<<18|Aa[n.charCodeAt(u+1)]<<12|Aa[n.charCodeAt(u+2)]<<6|Aa[n.charCodeAt(u+3)],a[s++]=e>>16&255,a[s++]=e>>8&255,a[s++]=e&255;return i===2&&(e=Aa[n.charCodeAt(u)]<<2|Aa[n.charCodeAt(u+1)]>>4,a[s++]=e&255),i===1&&(e=Aa[n.charCodeAt(u)]<<10|Aa[n.charCodeAt(u+1)]<<4|Aa[n.charCodeAt(u+2)]>>2,a[s++]=e>>8&255,a[s++]=e&255),a}function _Q(n){return Ns[n>>18&63]+Ns[n>>12&63]+Ns[n>>6&63]+Ns[n&63]}function bQ(n,e,t){for(var r,i=[],a=e;a<t;a+=3)r=(n[a]<<16&16711680)+(n[a+1]<<8&65280)+(n[a+2]&255),i.push(_Q(r));return i.join("")}function wQ(n){for(var e,t=n.length,r=t%3,i=[],a=16383,s=0,o=t-r;s<o;s+=a)i.push(bQ(n,s,s+a>o?o:s+a));return r===1?(e=n[t-1],i.push(Ns[e>>2]+Ns[e<<4&63]+"==")):r===2&&(e=(n[t-2]<<8)+n[t-1],i.push(Ns[e>>10]+Ns[e>>4&63]+Ns[e<<2&63]+"=")),i.join("")}var RI={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */RI.read=function(n,e,t,r,i){var a,s,o=i*8-r-1,u=(1<<o)-1,c=u>>1,d=-7,p=t?i-1:0,m=t?-1:1,y=n[e+p];for(p+=m,a=y&(1<<-d)-1,y>>=-d,d+=o;d>0;a=a*256+n[e+p],p+=m,d-=8);for(s=a&(1<<-d)-1,a>>=-d,d+=r;d>0;s=s*256+n[e+p],p+=m,d-=8);if(a===0)a=1-c;else{if(a===u)return s?NaN:(y?-1:1)*(1/0);s=s+Math.pow(2,r),a=a-c}return(y?-1:1)*s*Math.pow(2,a-r)};RI.write=function(n,e,t,r,i,a){var s,o,u,c=a*8-i-1,d=(1<<c)-1,p=d>>1,m=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,y=r?0:a-1,b=r?1:-1,w=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,s=d):(s=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-s))<1&&(s--,u*=2),s+p>=1?e+=m/u:e+=m*Math.pow(2,1-p),e*u>=2&&(s++,u/=2),s+p>=d?(o=0,s=d):s+p>=1?(o=(e*u-1)*Math.pow(2,i),s=s+p):(o=e*Math.pow(2,p-1)*Math.pow(2,i),s=0));i>=8;n[t+y]=o&255,y+=b,o/=256,i-=8);for(s=s<<i|o,c+=i;c>0;n[t+y]=s&255,y+=b,s/=256,c-=8);n[t+y-b]|=w*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(n){const e=ab,t=RI,r=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;n.Buffer=d,n.SlowBuffer=x,n.INSPECT_MAX_BYTES=50;const i=2147483647;n.kMaxLength=i;const{Uint8Array:a,ArrayBuffer:s,SharedArrayBuffer:o}=globalThis;d.TYPED_ARRAY_SUPPORT=u(),!d.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function u(){try{const H=new a(1),k={foo:function(){return 42}};return Object.setPrototypeOf(k,a.prototype),Object.setPrototypeOf(H,k),H.foo()===42}catch{return!1}}Object.defineProperty(d.prototype,"parent",{enumerable:!0,get:function(){if(d.isBuffer(this))return this.buffer}}),Object.defineProperty(d.prototype,"offset",{enumerable:!0,get:function(){if(d.isBuffer(this))return this.byteOffset}});function c(H){if(H>i)throw new RangeError('The value "'+H+'" is invalid for option "size"');const k=new a(H);return Object.setPrototypeOf(k,d.prototype),k}function d(H,k,$){if(typeof H=="number"){if(typeof k=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return b(H)}return p(H,k,$)}d.poolSize=8192;function p(H,k,$){if(typeof H=="string")return w(H,k);if(s.isView(H))return T(H);if(H==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof H);if(Ye(H,s)||H&&Ye(H.buffer,s)||typeof o<"u"&&(Ye(H,o)||H&&Ye(H.buffer,o)))return C(H,k,$);if(typeof H=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const re=H.valueOf&&H.valueOf();if(re!=null&&re!==H)return d.from(re,k,$);const pe=A(H);if(pe)return pe;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof H[Symbol.toPrimitive]=="function")return d.from(H[Symbol.toPrimitive]("string"),k,$);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof H)}d.from=function(H,k,$){return p(H,k,$)},Object.setPrototypeOf(d.prototype,a.prototype),Object.setPrototypeOf(d,a);function m(H){if(typeof H!="number")throw new TypeError('"size" argument must be of type number');if(H<0)throw new RangeError('The value "'+H+'" is invalid for option "size"')}function y(H,k,$){return m(H),H<=0?c(H):k!==void 0?typeof $=="string"?c(H).fill(k,$):c(H).fill(k):c(H)}d.alloc=function(H,k,$){return y(H,k,$)};function b(H){return m(H),c(H<0?0:I(H)|0)}d.allocUnsafe=function(H){return b(H)},d.allocUnsafeSlow=function(H){return b(H)};function w(H,k){if((typeof k!="string"||k==="")&&(k="utf8"),!d.isEncoding(k))throw new TypeError("Unknown encoding: "+k);const $=L(H,k)|0;let re=c($);const pe=re.write(H,k);return pe!==$&&(re=re.slice(0,pe)),re}function S(H){const k=H.length<0?0:I(H.length)|0,$=c(k);for(let re=0;re<k;re+=1)$[re]=H[re]&255;return $}function T(H){if(Ye(H,a)){const k=new a(H);return C(k.buffer,k.byteOffset,k.byteLength)}return S(H)}function C(H,k,$){if(k<0||H.byteLength<k)throw new RangeError('"offset" is outside of buffer bounds');if(H.byteLength<k+($||0))throw new RangeError('"length" is outside of buffer bounds');let re;return k===void 0&&$===void 0?re=new a(H):$===void 0?re=new a(H,k):re=new a(H,k,$),Object.setPrototypeOf(re,d.prototype),re}function A(H){if(d.isBuffer(H)){const k=I(H.length)|0,$=c(k);return $.length===0||H.copy($,0,0,k),$}if(H.length!==void 0)return typeof H.length!="number"||We(H.length)?c(0):S(H);if(H.type==="Buffer"&&Array.isArray(H.data))return S(H.data)}function I(H){if(H>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return H|0}function x(H){return+H!=H&&(H=0),d.alloc(+H)}d.isBuffer=function(k){return k!=null&&k._isBuffer===!0&&k!==d.prototype},d.compare=function(k,$){if(Ye(k,a)&&(k=d.from(k,k.offset,k.byteLength)),Ye($,a)&&($=d.from($,$.offset,$.byteLength)),!d.isBuffer(k)||!d.isBuffer($))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(k===$)return 0;let re=k.length,pe=$.length;for(let Ce=0,Le=Math.min(re,pe);Ce<Le;++Ce)if(k[Ce]!==$[Ce]){re=k[Ce],pe=$[Ce];break}return re<pe?-1:pe<re?1:0},d.isEncoding=function(k){switch(String(k).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},d.concat=function(k,$){if(!Array.isArray(k))throw new TypeError('"list" argument must be an Array of Buffers');if(k.length===0)return d.alloc(0);let re;if($===void 0)for($=0,re=0;re<k.length;++re)$+=k[re].length;const pe=d.allocUnsafe($);let Ce=0;for(re=0;re<k.length;++re){let Le=k[re];if(Ye(Le,a))Ce+Le.length>pe.length?(d.isBuffer(Le)||(Le=d.from(Le)),Le.copy(pe,Ce)):a.prototype.set.call(pe,Le,Ce);else if(d.isBuffer(Le))Le.copy(pe,Ce);else throw new TypeError('"list" argument must be an Array of Buffers');Ce+=Le.length}return pe};function L(H,k){if(d.isBuffer(H))return H.length;if(s.isView(H)||Ye(H,s))return H.byteLength;if(typeof H!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof H);const $=H.length,re=arguments.length>2&&arguments[2]===!0;if(!re&&$===0)return 0;let pe=!1;for(;;)switch(k){case"ascii":case"latin1":case"binary":return $;case"utf8":case"utf-8":return qe(H).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $*2;case"hex":return $>>>1;case"base64":return Be(H).length;default:if(pe)return re?-1:qe(H).length;k=(""+k).toLowerCase(),pe=!0}}d.byteLength=L;function U(H,k,$){let re=!1;if((k===void 0||k<0)&&(k=0),k>this.length||(($===void 0||$>this.length)&&($=this.length),$<=0)||($>>>=0,k>>>=0,$<=k))return"";for(H||(H="utf8");;)switch(H){case"hex":return Re(this,k,$);case"utf8":case"utf-8":return oe(this,k,$);case"ascii":return Y(this,k,$);case"latin1":case"binary":return ve(this,k,$);case"base64":return te(this,k,$);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Q(this,k,$);default:if(re)throw new TypeError("Unknown encoding: "+H);H=(H+"").toLowerCase(),re=!0}}d.prototype._isBuffer=!0;function N(H,k,$){const re=H[k];H[k]=H[$],H[$]=re}d.prototype.swap16=function(){const k=this.length;if(k%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let $=0;$<k;$+=2)N(this,$,$+1);return this},d.prototype.swap32=function(){const k=this.length;if(k%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let $=0;$<k;$+=4)N(this,$,$+3),N(this,$+1,$+2);return this},d.prototype.swap64=function(){const k=this.length;if(k%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let $=0;$<k;$+=8)N(this,$,$+7),N(this,$+1,$+6),N(this,$+2,$+5),N(this,$+3,$+4);return this},d.prototype.toString=function(){const k=this.length;return k===0?"":arguments.length===0?oe(this,0,k):U.apply(this,arguments)},d.prototype.toLocaleString=d.prototype.toString,d.prototype.equals=function(k){if(!d.isBuffer(k))throw new TypeError("Argument must be a Buffer");return this===k?!0:d.compare(this,k)===0},d.prototype.inspect=function(){let k="";const $=n.INSPECT_MAX_BYTES;return k=this.toString("hex",0,$).replace(/(.{2})/g,"$1 ").trim(),this.length>$&&(k+=" ... "),"<Buffer "+k+">"},r&&(d.prototype[r]=d.prototype.inspect),d.prototype.compare=function(k,$,re,pe,Ce){if(Ye(k,a)&&(k=d.from(k,k.offset,k.byteLength)),!d.isBuffer(k))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof k);if($===void 0&&($=0),re===void 0&&(re=k?k.length:0),pe===void 0&&(pe=0),Ce===void 0&&(Ce=this.length),$<0||re>k.length||pe<0||Ce>this.length)throw new RangeError("out of range index");if(pe>=Ce&&$>=re)return 0;if(pe>=Ce)return-1;if($>=re)return 1;if($>>>=0,re>>>=0,pe>>>=0,Ce>>>=0,this===k)return 0;let Le=Ce-pe,ht=re-$;const sn=Math.min(Le,ht),tn=this.slice(pe,Ce),un=k.slice($,re);for(let Kt=0;Kt<sn;++Kt)if(tn[Kt]!==un[Kt]){Le=tn[Kt],ht=un[Kt];break}return Le<ht?-1:ht<Le?1:0};function B(H,k,$,re,pe){if(H.length===0)return-1;if(typeof $=="string"?(re=$,$=0):$>2147483647?$=2147483647:$<-2147483648&&($=-2147483648),$=+$,We($)&&($=pe?0:H.length-1),$<0&&($=H.length+$),$>=H.length){if(pe)return-1;$=H.length-1}else if($<0)if(pe)$=0;else return-1;if(typeof k=="string"&&(k=d.from(k,re)),d.isBuffer(k))return k.length===0?-1:q(H,k,$,re,pe);if(typeof k=="number")return k=k&255,typeof a.prototype.indexOf=="function"?pe?a.prototype.indexOf.call(H,k,$):a.prototype.lastIndexOf.call(H,k,$):q(H,[k],$,re,pe);throw new TypeError("val must be string, number or Buffer")}function q(H,k,$,re,pe){let Ce=1,Le=H.length,ht=k.length;if(re!==void 0&&(re=String(re).toLowerCase(),re==="ucs2"||re==="ucs-2"||re==="utf16le"||re==="utf-16le")){if(H.length<2||k.length<2)return-1;Ce=2,Le/=2,ht/=2,$/=2}function sn(un,Kt){return Ce===1?un[Kt]:un.readUInt16BE(Kt*Ce)}let tn;if(pe){let un=-1;for(tn=$;tn<Le;tn++)if(sn(H,tn)===sn(k,un===-1?0:tn-un)){if(un===-1&&(un=tn),tn-un+1===ht)return un*Ce}else un!==-1&&(tn-=tn-un),un=-1}else for($+ht>Le&&($=Le-ht),tn=$;tn>=0;tn--){let un=!0;for(let Kt=0;Kt<ht;Kt++)if(sn(H,tn+Kt)!==sn(k,Kt)){un=!1;break}if(un)return tn}return-1}d.prototype.includes=function(k,$,re){return this.indexOf(k,$,re)!==-1},d.prototype.indexOf=function(k,$,re){return B(this,k,$,re,!0)},d.prototype.lastIndexOf=function(k,$,re){return B(this,k,$,re,!1)};function J(H,k,$,re){$=Number($)||0;const pe=H.length-$;re?(re=Number(re),re>pe&&(re=pe)):re=pe;const Ce=k.length;re>Ce/2&&(re=Ce/2);let Le;for(Le=0;Le<re;++Le){const ht=parseInt(k.substr(Le*2,2),16);if(We(ht))return Le;H[$+Le]=ht}return Le}function V(H,k,$,re){return et(qe(k,H.length-$),H,$,re)}function de(H,k,$,re){return et(It(k),H,$,re)}function ae(H,k,$,re){return et(Be(k),H,$,re)}function ue(H,k,$,re){return et(Ve(k,H.length-$),H,$,re)}d.prototype.write=function(k,$,re,pe){if($===void 0)pe="utf8",re=this.length,$=0;else if(re===void 0&&typeof $=="string")pe=$,re=this.length,$=0;else if(isFinite($))$=$>>>0,isFinite(re)?(re=re>>>0,pe===void 0&&(pe="utf8")):(pe=re,re=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Ce=this.length-$;if((re===void 0||re>Ce)&&(re=Ce),k.length>0&&(re<0||$<0)||$>this.length)throw new RangeError("Attempt to write outside buffer bounds");pe||(pe="utf8");let Le=!1;for(;;)switch(pe){case"hex":return J(this,k,$,re);case"utf8":case"utf-8":return V(this,k,$,re);case"ascii":case"latin1":case"binary":return de(this,k,$,re);case"base64":return ae(this,k,$,re);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ue(this,k,$,re);default:if(Le)throw new TypeError("Unknown encoding: "+pe);pe=(""+pe).toLowerCase(),Le=!0}},d.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function te(H,k,$){return k===0&&$===H.length?e.fromByteArray(H):e.fromByteArray(H.slice(k,$))}function oe(H,k,$){$=Math.min(H.length,$);const re=[];let pe=k;for(;pe<$;){const Ce=H[pe];let Le=null,ht=Ce>239?4:Ce>223?3:Ce>191?2:1;if(pe+ht<=$){let sn,tn,un,Kt;switch(ht){case 1:Ce<128&&(Le=Ce);break;case 2:sn=H[pe+1],(sn&192)===128&&(Kt=(Ce&31)<<6|sn&63,Kt>127&&(Le=Kt));break;case 3:sn=H[pe+1],tn=H[pe+2],(sn&192)===128&&(tn&192)===128&&(Kt=(Ce&15)<<12|(sn&63)<<6|tn&63,Kt>2047&&(Kt<55296||Kt>57343)&&(Le=Kt));break;case 4:sn=H[pe+1],tn=H[pe+2],un=H[pe+3],(sn&192)===128&&(tn&192)===128&&(un&192)===128&&(Kt=(Ce&15)<<18|(sn&63)<<12|(tn&63)<<6|un&63,Kt>65535&&Kt<1114112&&(Le=Kt))}}Le===null?(Le=65533,ht=1):Le>65535&&(Le-=65536,re.push(Le>>>10&1023|55296),Le=56320|Le&1023),re.push(Le),pe+=ht}return Ee(re)}const ge=4096;function Ee(H){const k=H.length;if(k<=ge)return String.fromCharCode.apply(String,H);let $="",re=0;for(;re<k;)$+=String.fromCharCode.apply(String,H.slice(re,re+=ge));return $}function Y(H,k,$){let re="";$=Math.min(H.length,$);for(let pe=k;pe<$;++pe)re+=String.fromCharCode(H[pe]&127);return re}function ve(H,k,$){let re="";$=Math.min(H.length,$);for(let pe=k;pe<$;++pe)re+=String.fromCharCode(H[pe]);return re}function Re(H,k,$){const re=H.length;(!k||k<0)&&(k=0),(!$||$<0||$>re)&&($=re);let pe="";for(let Ce=k;Ce<$;++Ce)pe+=rt[H[Ce]];return pe}function Q(H,k,$){const re=H.slice(k,$);let pe="";for(let Ce=0;Ce<re.length-1;Ce+=2)pe+=String.fromCharCode(re[Ce]+re[Ce+1]*256);return pe}d.prototype.slice=function(k,$){const re=this.length;k=~~k,$=$===void 0?re:~~$,k<0?(k+=re,k<0&&(k=0)):k>re&&(k=re),$<0?($+=re,$<0&&($=0)):$>re&&($=re),$<k&&($=k);const pe=this.subarray(k,$);return Object.setPrototypeOf(pe,d.prototype),pe};function ie(H,k,$){if(H%1!==0||H<0)throw new RangeError("offset is not uint");if(H+k>$)throw new RangeError("Trying to access beyond buffer length")}d.prototype.readUintLE=d.prototype.readUIntLE=function(k,$,re){k=k>>>0,$=$>>>0,re||ie(k,$,this.length);let pe=this[k],Ce=1,Le=0;for(;++Le<$&&(Ce*=256);)pe+=this[k+Le]*Ce;return pe},d.prototype.readUintBE=d.prototype.readUIntBE=function(k,$,re){k=k>>>0,$=$>>>0,re||ie(k,$,this.length);let pe=this[k+--$],Ce=1;for(;$>0&&(Ce*=256);)pe+=this[k+--$]*Ce;return pe},d.prototype.readUint8=d.prototype.readUInt8=function(k,$){return k=k>>>0,$||ie(k,1,this.length),this[k]},d.prototype.readUint16LE=d.prototype.readUInt16LE=function(k,$){return k=k>>>0,$||ie(k,2,this.length),this[k]|this[k+1]<<8},d.prototype.readUint16BE=d.prototype.readUInt16BE=function(k,$){return k=k>>>0,$||ie(k,2,this.length),this[k]<<8|this[k+1]},d.prototype.readUint32LE=d.prototype.readUInt32LE=function(k,$){return k=k>>>0,$||ie(k,4,this.length),(this[k]|this[k+1]<<8|this[k+2]<<16)+this[k+3]*16777216},d.prototype.readUint32BE=d.prototype.readUInt32BE=function(k,$){return k=k>>>0,$||ie(k,4,this.length),this[k]*16777216+(this[k+1]<<16|this[k+2]<<8|this[k+3])},d.prototype.readBigUInt64LE=tt(function(k){k=k>>>0,$e(k,"offset");const $=this[k],re=this[k+7];($===void 0||re===void 0)&&ze(k,this.length-8);const pe=$+this[++k]*2**8+this[++k]*2**16+this[++k]*2**24,Ce=this[++k]+this[++k]*2**8+this[++k]*2**16+re*2**24;return BigInt(pe)+(BigInt(Ce)<<BigInt(32))}),d.prototype.readBigUInt64BE=tt(function(k){k=k>>>0,$e(k,"offset");const $=this[k],re=this[k+7];($===void 0||re===void 0)&&ze(k,this.length-8);const pe=$*2**24+this[++k]*2**16+this[++k]*2**8+this[++k],Ce=this[++k]*2**24+this[++k]*2**16+this[++k]*2**8+re;return(BigInt(pe)<<BigInt(32))+BigInt(Ce)}),d.prototype.readIntLE=function(k,$,re){k=k>>>0,$=$>>>0,re||ie(k,$,this.length);let pe=this[k],Ce=1,Le=0;for(;++Le<$&&(Ce*=256);)pe+=this[k+Le]*Ce;return Ce*=128,pe>=Ce&&(pe-=Math.pow(2,8*$)),pe},d.prototype.readIntBE=function(k,$,re){k=k>>>0,$=$>>>0,re||ie(k,$,this.length);let pe=$,Ce=1,Le=this[k+--pe];for(;pe>0&&(Ce*=256);)Le+=this[k+--pe]*Ce;return Ce*=128,Le>=Ce&&(Le-=Math.pow(2,8*$)),Le},d.prototype.readInt8=function(k,$){return k=k>>>0,$||ie(k,1,this.length),this[k]&128?(255-this[k]+1)*-1:this[k]},d.prototype.readInt16LE=function(k,$){k=k>>>0,$||ie(k,2,this.length);const re=this[k]|this[k+1]<<8;return re&32768?re|4294901760:re},d.prototype.readInt16BE=function(k,$){k=k>>>0,$||ie(k,2,this.length);const re=this[k+1]|this[k]<<8;return re&32768?re|4294901760:re},d.prototype.readInt32LE=function(k,$){return k=k>>>0,$||ie(k,4,this.length),this[k]|this[k+1]<<8|this[k+2]<<16|this[k+3]<<24},d.prototype.readInt32BE=function(k,$){return k=k>>>0,$||ie(k,4,this.length),this[k]<<24|this[k+1]<<16|this[k+2]<<8|this[k+3]},d.prototype.readBigInt64LE=tt(function(k){k=k>>>0,$e(k,"offset");const $=this[k],re=this[k+7];($===void 0||re===void 0)&&ze(k,this.length-8);const pe=this[k+4]+this[k+5]*2**8+this[k+6]*2**16+(re<<24);return(BigInt(pe)<<BigInt(32))+BigInt($+this[++k]*2**8+this[++k]*2**16+this[++k]*2**24)}),d.prototype.readBigInt64BE=tt(function(k){k=k>>>0,$e(k,"offset");const $=this[k],re=this[k+7];($===void 0||re===void 0)&&ze(k,this.length-8);const pe=($<<24)+this[++k]*2**16+this[++k]*2**8+this[++k];return(BigInt(pe)<<BigInt(32))+BigInt(this[++k]*2**24+this[++k]*2**16+this[++k]*2**8+re)}),d.prototype.readFloatLE=function(k,$){return k=k>>>0,$||ie(k,4,this.length),t.read(this,k,!0,23,4)},d.prototype.readFloatBE=function(k,$){return k=k>>>0,$||ie(k,4,this.length),t.read(this,k,!1,23,4)},d.prototype.readDoubleLE=function(k,$){return k=k>>>0,$||ie(k,8,this.length),t.read(this,k,!0,52,8)},d.prototype.readDoubleBE=function(k,$){return k=k>>>0,$||ie(k,8,this.length),t.read(this,k,!1,52,8)};function ce(H,k,$,re,pe,Ce){if(!d.isBuffer(H))throw new TypeError('"buffer" argument must be a Buffer instance');if(k>pe||k<Ce)throw new RangeError('"value" argument is out of bounds');if($+re>H.length)throw new RangeError("Index out of range")}d.prototype.writeUintLE=d.prototype.writeUIntLE=function(k,$,re,pe){if(k=+k,$=$>>>0,re=re>>>0,!pe){const ht=Math.pow(2,8*re)-1;ce(this,k,$,re,ht,0)}let Ce=1,Le=0;for(this[$]=k&255;++Le<re&&(Ce*=256);)this[$+Le]=k/Ce&255;return $+re},d.prototype.writeUintBE=d.prototype.writeUIntBE=function(k,$,re,pe){if(k=+k,$=$>>>0,re=re>>>0,!pe){const ht=Math.pow(2,8*re)-1;ce(this,k,$,re,ht,0)}let Ce=re-1,Le=1;for(this[$+Ce]=k&255;--Ce>=0&&(Le*=256);)this[$+Ce]=k/Le&255;return $+re},d.prototype.writeUint8=d.prototype.writeUInt8=function(k,$,re){return k=+k,$=$>>>0,re||ce(this,k,$,1,255,0),this[$]=k&255,$+1},d.prototype.writeUint16LE=d.prototype.writeUInt16LE=function(k,$,re){return k=+k,$=$>>>0,re||ce(this,k,$,2,65535,0),this[$]=k&255,this[$+1]=k>>>8,$+2},d.prototype.writeUint16BE=d.prototype.writeUInt16BE=function(k,$,re){return k=+k,$=$>>>0,re||ce(this,k,$,2,65535,0),this[$]=k>>>8,this[$+1]=k&255,$+2},d.prototype.writeUint32LE=d.prototype.writeUInt32LE=function(k,$,re){return k=+k,$=$>>>0,re||ce(this,k,$,4,4294967295,0),this[$+3]=k>>>24,this[$+2]=k>>>16,this[$+1]=k>>>8,this[$]=k&255,$+4},d.prototype.writeUint32BE=d.prototype.writeUInt32BE=function(k,$,re){return k=+k,$=$>>>0,re||ce(this,k,$,4,4294967295,0),this[$]=k>>>24,this[$+1]=k>>>16,this[$+2]=k>>>8,this[$+3]=k&255,$+4};function P(H,k,$,re,pe){Qe(k,re,pe,H,$,7);let Ce=Number(k&BigInt(4294967295));H[$++]=Ce,Ce=Ce>>8,H[$++]=Ce,Ce=Ce>>8,H[$++]=Ce,Ce=Ce>>8,H[$++]=Ce;let Le=Number(k>>BigInt(32)&BigInt(4294967295));return H[$++]=Le,Le=Le>>8,H[$++]=Le,Le=Le>>8,H[$++]=Le,Le=Le>>8,H[$++]=Le,$}function O(H,k,$,re,pe){Qe(k,re,pe,H,$,7);let Ce=Number(k&BigInt(4294967295));H[$+7]=Ce,Ce=Ce>>8,H[$+6]=Ce,Ce=Ce>>8,H[$+5]=Ce,Ce=Ce>>8,H[$+4]=Ce;let Le=Number(k>>BigInt(32)&BigInt(4294967295));return H[$+3]=Le,Le=Le>>8,H[$+2]=Le,Le=Le>>8,H[$+1]=Le,Le=Le>>8,H[$]=Le,$+8}d.prototype.writeBigUInt64LE=tt(function(k,$=0){return P(this,k,$,BigInt(0),BigInt("0xffffffffffffffff"))}),d.prototype.writeBigUInt64BE=tt(function(k,$=0){return O(this,k,$,BigInt(0),BigInt("0xffffffffffffffff"))}),d.prototype.writeIntLE=function(k,$,re,pe){if(k=+k,$=$>>>0,!pe){const sn=Math.pow(2,8*re-1);ce(this,k,$,re,sn-1,-sn)}let Ce=0,Le=1,ht=0;for(this[$]=k&255;++Ce<re&&(Le*=256);)k<0&&ht===0&&this[$+Ce-1]!==0&&(ht=1),this[$+Ce]=(k/Le>>0)-ht&255;return $+re},d.prototype.writeIntBE=function(k,$,re,pe){if(k=+k,$=$>>>0,!pe){const sn=Math.pow(2,8*re-1);ce(this,k,$,re,sn-1,-sn)}let Ce=re-1,Le=1,ht=0;for(this[$+Ce]=k&255;--Ce>=0&&(Le*=256);)k<0&&ht===0&&this[$+Ce+1]!==0&&(ht=1),this[$+Ce]=(k/Le>>0)-ht&255;return $+re},d.prototype.writeInt8=function(k,$,re){return k=+k,$=$>>>0,re||ce(this,k,$,1,127,-128),k<0&&(k=255+k+1),this[$]=k&255,$+1},d.prototype.writeInt16LE=function(k,$,re){return k=+k,$=$>>>0,re||ce(this,k,$,2,32767,-32768),this[$]=k&255,this[$+1]=k>>>8,$+2},d.prototype.writeInt16BE=function(k,$,re){return k=+k,$=$>>>0,re||ce(this,k,$,2,32767,-32768),this[$]=k>>>8,this[$+1]=k&255,$+2},d.prototype.writeInt32LE=function(k,$,re){return k=+k,$=$>>>0,re||ce(this,k,$,4,2147483647,-2147483648),this[$]=k&255,this[$+1]=k>>>8,this[$+2]=k>>>16,this[$+3]=k>>>24,$+4},d.prototype.writeInt32BE=function(k,$,re){return k=+k,$=$>>>0,re||ce(this,k,$,4,2147483647,-2147483648),k<0&&(k=4294967295+k+1),this[$]=k>>>24,this[$+1]=k>>>16,this[$+2]=k>>>8,this[$+3]=k&255,$+4},d.prototype.writeBigInt64LE=tt(function(k,$=0){return P(this,k,$,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),d.prototype.writeBigInt64BE=tt(function(k,$=0){return O(this,k,$,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function K(H,k,$,re,pe,Ce){if($+re>H.length)throw new RangeError("Index out of range");if($<0)throw new RangeError("Index out of range")}function X(H,k,$,re,pe){return k=+k,$=$>>>0,pe||K(H,k,$,4),t.write(H,k,$,re,23,4),$+4}d.prototype.writeFloatLE=function(k,$,re){return X(this,k,$,!0,re)},d.prototype.writeFloatBE=function(k,$,re){return X(this,k,$,!1,re)};function se(H,k,$,re,pe){return k=+k,$=$>>>0,pe||K(H,k,$,8),t.write(H,k,$,re,52,8),$+8}d.prototype.writeDoubleLE=function(k,$,re){return se(this,k,$,!0,re)},d.prototype.writeDoubleBE=function(k,$,re){return se(this,k,$,!1,re)},d.prototype.copy=function(k,$,re,pe){if(!d.isBuffer(k))throw new TypeError("argument should be a Buffer");if(re||(re=0),!pe&&pe!==0&&(pe=this.length),$>=k.length&&($=k.length),$||($=0),pe>0&&pe<re&&(pe=re),pe===re||k.length===0||this.length===0)return 0;if($<0)throw new RangeError("targetStart out of bounds");if(re<0||re>=this.length)throw new RangeError("Index out of range");if(pe<0)throw new RangeError("sourceEnd out of bounds");pe>this.length&&(pe=this.length),k.length-$<pe-re&&(pe=k.length-$+re);const Ce=pe-re;return this===k&&typeof a.prototype.copyWithin=="function"?this.copyWithin($,re,pe):a.prototype.set.call(k,this.subarray(re,pe),$),Ce},d.prototype.fill=function(k,$,re,pe){if(typeof k=="string"){if(typeof $=="string"?(pe=$,$=0,re=this.length):typeof re=="string"&&(pe=re,re=this.length),pe!==void 0&&typeof pe!="string")throw new TypeError("encoding must be a string");if(typeof pe=="string"&&!d.isEncoding(pe))throw new TypeError("Unknown encoding: "+pe);if(k.length===1){const Le=k.charCodeAt(0);(pe==="utf8"&&Le<128||pe==="latin1")&&(k=Le)}}else typeof k=="number"?k=k&255:typeof k=="boolean"&&(k=Number(k));if($<0||this.length<$||this.length<re)throw new RangeError("Out of range index");if(re<=$)return this;$=$>>>0,re=re===void 0?this.length:re>>>0,k||(k=0);let Ce;if(typeof k=="number")for(Ce=$;Ce<re;++Ce)this[Ce]=k;else{const Le=d.isBuffer(k)?k:d.from(k,pe),ht=Le.length;if(ht===0)throw new TypeError('The value "'+k+'" is invalid for argument "value"');for(Ce=0;Ce<re-$;++Ce)this[Ce+$]=Le[Ce%ht]}return this};const F={};function z(H,k,$){F[H]=class extends ${constructor(){super(),Object.defineProperty(this,"message",{value:k.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${H}]`,this.stack,delete this.name}get code(){return H}set code(pe){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:pe,writable:!0})}toString(){return`${this.name} [${H}]: ${this.message}`}}}z("ERR_BUFFER_OUT_OF_BOUNDS",function(H){return H?`${H} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),z("ERR_INVALID_ARG_TYPE",function(H,k){return`The "${H}" argument must be of type number. Received type ${typeof k}`},TypeError),z("ERR_OUT_OF_RANGE",function(H,k,$){let re=`The value of "${H}" is out of range.`,pe=$;return Number.isInteger($)&&Math.abs($)>2**32?pe=ye(String($)):typeof $=="bigint"&&(pe=String($),($>BigInt(2)**BigInt(32)||$<-(BigInt(2)**BigInt(32)))&&(pe=ye(pe)),pe+="n"),re+=` It must be ${k}. Received ${pe}`,re},RangeError);function ye(H){let k="",$=H.length;const re=H[0]==="-"?1:0;for(;$>=re+4;$-=3)k=`_${H.slice($-3,$)}${k}`;return`${H.slice(0,$)}${k}`}function ke(H,k,$){$e(k,"offset"),(H[k]===void 0||H[k+$]===void 0)&&ze(k,H.length-($+1))}function Qe(H,k,$,re,pe,Ce){if(H>$||H<k){const Le=typeof k=="bigint"?"n":"";let ht;throw k===0||k===BigInt(0)?ht=`>= 0${Le} and < 2${Le} ** ${(Ce+1)*8}${Le}`:ht=`>= -(2${Le} ** ${(Ce+1)*8-1}${Le}) and < 2 ** ${(Ce+1)*8-1}${Le}`,new F.ERR_OUT_OF_RANGE("value",ht,H)}ke(re,pe,Ce)}function $e(H,k){if(typeof H!="number")throw new F.ERR_INVALID_ARG_TYPE(k,"number",H)}function ze(H,k,$){throw Math.floor(H)!==H?($e(H,$),new F.ERR_OUT_OF_RANGE("offset","an integer",H)):k<0?new F.ERR_BUFFER_OUT_OF_BOUNDS:new F.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${k}`,H)}const xt=/[^+/0-9A-Za-z-_]/g;function Oe(H){if(H=H.split("=")[0],H=H.trim().replace(xt,""),H.length<2)return"";for(;H.length%4!==0;)H=H+"=";return H}function qe(H,k){k=k||1/0;let $;const re=H.length;let pe=null;const Ce=[];for(let Le=0;Le<re;++Le){if($=H.charCodeAt(Le),$>55295&&$<57344){if(!pe){if($>56319){(k-=3)>-1&&Ce.push(239,191,189);continue}else if(Le+1===re){(k-=3)>-1&&Ce.push(239,191,189);continue}pe=$;continue}if($<56320){(k-=3)>-1&&Ce.push(239,191,189),pe=$;continue}$=(pe-55296<<10|$-56320)+65536}else pe&&(k-=3)>-1&&Ce.push(239,191,189);if(pe=null,$<128){if((k-=1)<0)break;Ce.push($)}else if($<2048){if((k-=2)<0)break;Ce.push($>>6|192,$&63|128)}else if($<65536){if((k-=3)<0)break;Ce.push($>>12|224,$>>6&63|128,$&63|128)}else if($<1114112){if((k-=4)<0)break;Ce.push($>>18|240,$>>12&63|128,$>>6&63|128,$&63|128)}else throw new Error("Invalid code point")}return Ce}function It(H){const k=[];for(let $=0;$<H.length;++$)k.push(H.charCodeAt($)&255);return k}function Ve(H,k){let $,re,pe;const Ce=[];for(let Le=0;Le<H.length&&!((k-=2)<0);++Le)$=H.charCodeAt(Le),re=$>>8,pe=$%256,Ce.push(pe),Ce.push(re);return Ce}function Be(H){return e.toByteArray(Oe(H))}function et(H,k,$,re){let pe;for(pe=0;pe<re&&!(pe+$>=k.length||pe>=H.length);++pe)k[pe+$]=H[pe];return pe}function Ye(H,k){return H instanceof k||H!=null&&H.constructor!=null&&H.constructor.name!=null&&H.constructor.name===k.name}function We(H){return H!==H}const rt=function(){const H="0123456789abcdef",k=new Array(256);for(let $=0;$<16;++$){const re=$*16;for(let pe=0;pe<16;++pe)k[re+pe]=H[$]+H[pe]}return k}();function tt(H){return typeof BigInt>"u"?St:H}function St(){throw new Error("BigInt not supported")}})(P3);const Ou=P3.Buffer;var dT,X$;function EQ(){return X$||(X$=1,dT=/^#!(.*)/),dT}var hT,Q$;function SQ(){if(Q$)return hT;Q$=1;const n=EQ();return hT=(e="")=>{const t=e.match(n);if(!t)return null;const[r,i]=t[0].replace(/#! ?/,"").split(" "),a=r.split("/").pop();return a==="env"?i:i?`${a} ${i}`:a},hT}var pT,eL;function TQ(){if(eL)return pT;eL=1;const n=ib,e=SQ();function t(r){const a=Ou.alloc(150);let s;try{s=n.openSync(r,"r"),n.readSync(s,a,0,150,0),n.closeSync(s)}catch{}return e(a.toString())}return pT=t,pT}var mT,tL;function AQ(){if(tL)return mT;tL=1;var n={};const e=CI(),t=dQ(),r=hQ(),i=TQ(),a=at.platform==="win32",s=/\.(?:com|exe)$/i,o=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function u(p){p.file=t(p);const m=p.file&&i(p.file);return m?(p.args.unshift(p.file),p.command=m,t(p)):p.file}function c(p){if(!a)return p;const m=u(p),y=!s.test(m);if(p.options.forceShell||y){const b=o.test(m);p.command=e.normalize(p.command),p.command=r.command(p.command),p.args=p.args.map(S=>r.argument(S,b));const w=[p.command].concat(p.args).join(" ");p.args=["/d","/s","/c",`"${w}"`],p.command=n.comspec||"cmd.exe",p.options.windowsVerbatimArguments=!0}return p}function d(p,m,y){m&&!Array.isArray(m)&&(y=m,m=null),m=m?m.slice(0):[],y=Object.assign({},y);const b={command:p,args:m,options:y,file:void 0,original:{command:p,args:m}};return y.shell?b:c(b)}return mT=d,mT}var gT,nL;function CQ(){if(nL)return gT;nL=1;const n=at.platform==="win32";function e(a,s){return Object.assign(new Error(`${s} ${a.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${s} ${a.command}`,path:a.command,spawnargs:a.args})}function t(a,s){if(!n)return;const o=a.emit;a.emit=function(u,c){if(u==="exit"){const d=r(c,s);if(d)return o.call(a,"error",d)}return o.apply(a,arguments)}}function r(a,s){return n&&a===1&&!s.file?e(s.original,"spawn"):null}function i(a,s){return n&&a===1&&!s.file?e(s.original,"spawnSync"):null}return gT={hookChildProcess:t,verifyENOENT:r,verifyENOENTSync:i,notFoundError:e},gT}var rL;function RQ(){if(rL)return du.exports;rL=1;const n=ib,e=AQ(),t=CQ();function r(a,s,o){const u=e(a,s,o),c=n.spawn(u.command,u.args,u.options);return t.hookChildProcess(c,u),c}function i(a,s,o){const u=e(a,s,o),c=n.spawnSync(u.command,u.args,u.options);return c.error=c.error||t.verifyENOENTSync(c.status,u),c}return du.exports=r,du.exports.spawn=r,du.exports.sync=i,du.exports._parse=e,du.exports._enoent=t,du.exports}var IQ=RQ();const PQ=Js(IQ);var oy={exports:{}},iL;function II(){if(iL)return oy.exports;iL=1;var n=typeof Reflect=="object"?Reflect:null,e=n&&typeof n.apply=="function"?n.apply:function(x,L,U){return Function.prototype.apply.call(x,L,U)},t;n&&typeof n.ownKeys=="function"?t=n.ownKeys:Object.getOwnPropertySymbols?t=function(x){return Object.getOwnPropertyNames(x).concat(Object.getOwnPropertySymbols(x))}:t=function(x){return Object.getOwnPropertyNames(x)};function r(I){console&&console.warn&&console.warn(I)}var i=Number.isNaN||function(x){return x!==x};function a(){a.init.call(this)}oy.exports=a,oy.exports.once=T,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var s=10;function o(I){if(typeof I!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof I)}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(I){if(typeof I!="number"||I<0||i(I))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+I+".");s=I}}),a.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(x){if(typeof x!="number"||x<0||i(x))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+x+".");return this._maxListeners=x,this};function u(I){return I._maxListeners===void 0?a.defaultMaxListeners:I._maxListeners}a.prototype.getMaxListeners=function(){return u(this)},a.prototype.emit=function(x){for(var L=[],U=1;U<arguments.length;U++)L.push(arguments[U]);var N=x==="error",B=this._events;if(B!==void 0)N=N&&B.error===void 0;else if(!N)return!1;if(N){var q;if(L.length>0&&(q=L[0]),q instanceof Error)throw q;var J=new Error("Unhandled error."+(q?" ("+q.message+")":""));throw J.context=q,J}var V=B[x];if(V===void 0)return!1;if(typeof V=="function")e(V,this,L);else for(var de=V.length,ae=b(V,de),U=0;U<de;++U)e(ae[U],this,L);return!0};function c(I,x,L,U){var N,B,q;if(o(L),B=I._events,B===void 0?(B=I._events=Object.create(null),I._eventsCount=0):(B.newListener!==void 0&&(I.emit("newListener",x,L.listener?L.listener:L),B=I._events),q=B[x]),q===void 0)q=B[x]=L,++I._eventsCount;else if(typeof q=="function"?q=B[x]=U?[L,q]:[q,L]:U?q.unshift(L):q.push(L),N=u(I),N>0&&q.length>N&&!q.warned){q.warned=!0;var J=new Error("Possible EventEmitter memory leak detected. "+q.length+" "+String(x)+" listeners added. Use emitter.setMaxListeners() to increase limit");J.name="MaxListenersExceededWarning",J.emitter=I,J.type=x,J.count=q.length,r(J)}return I}a.prototype.addListener=function(x,L){return c(this,x,L,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(x,L){return c(this,x,L,!0)};function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(I,x,L){var U={fired:!1,wrapFn:void 0,target:I,type:x,listener:L},N=d.bind(U);return N.listener=L,U.wrapFn=N,N}a.prototype.once=function(x,L){return o(L),this.on(x,p(this,x,L)),this},a.prototype.prependOnceListener=function(x,L){return o(L),this.prependListener(x,p(this,x,L)),this},a.prototype.removeListener=function(x,L){var U,N,B,q,J;if(o(L),N=this._events,N===void 0)return this;if(U=N[x],U===void 0)return this;if(U===L||U.listener===L)--this._eventsCount===0?this._events=Object.create(null):(delete N[x],N.removeListener&&this.emit("removeListener",x,U.listener||L));else if(typeof U!="function"){for(B=-1,q=U.length-1;q>=0;q--)if(U[q]===L||U[q].listener===L){J=U[q].listener,B=q;break}if(B<0)return this;B===0?U.shift():w(U,B),U.length===1&&(N[x]=U[0]),N.removeListener!==void 0&&this.emit("removeListener",x,J||L)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(x){var L,U,N;if(U=this._events,U===void 0)return this;if(U.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):U[x]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete U[x]),this;if(arguments.length===0){var B=Object.keys(U),q;for(N=0;N<B.length;++N)q=B[N],q!=="removeListener"&&this.removeAllListeners(q);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(L=U[x],typeof L=="function")this.removeListener(x,L);else if(L!==void 0)for(N=L.length-1;N>=0;N--)this.removeListener(x,L[N]);return this};function m(I,x,L){var U=I._events;if(U===void 0)return[];var N=U[x];return N===void 0?[]:typeof N=="function"?L?[N.listener||N]:[N]:L?S(N):b(N,N.length)}a.prototype.listeners=function(x){return m(this,x,!0)},a.prototype.rawListeners=function(x){return m(this,x,!1)},a.listenerCount=function(I,x){return typeof I.listenerCount=="function"?I.listenerCount(x):y.call(I,x)},a.prototype.listenerCount=y;function y(I){var x=this._events;if(x!==void 0){var L=x[I];if(typeof L=="function")return 1;if(L!==void 0)return L.length}return 0}a.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function b(I,x){for(var L=new Array(x),U=0;U<x;++U)L[U]=I[U];return L}function w(I,x){for(;x+1<I.length;x++)I[x]=I[x+1];I.pop()}function S(I){for(var x=new Array(I.length),L=0;L<x.length;++L)x[L]=I[L].listener||I[L];return x}function T(I,x){return new Promise(function(L,U){function N(q){I.removeListener(x,B),U(q)}function B(){typeof I.removeListener=="function"&&I.removeListener("error",N),L([].slice.call(arguments))}A(I,x,B,{once:!0}),x!=="error"&&C(I,N,{once:!0})})}function C(I,x,L){typeof I.on=="function"&&A(I,"error",x,L)}function A(I,x,L,U){if(typeof I.on=="function")U.once?I.once(x,L):I.on(x,L);else if(typeof I.addEventListener=="function")I.addEventListener(x,function N(B){U.once&&I.removeEventListener(x,N),L(B)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof I)}return oy.exports}var ly={exports:{}},aL;function fc(){return aL||(aL=1,typeof Object.create=="function"?ly.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:ly.exports=function(e,t){if(t){e.super_=t;var r=function(){};r.prototype=t.prototype,e.prototype=new r,e.prototype.constructor=e}}),ly.exports}var yT,sL;function O3(){return sL||(sL=1,yT=II().EventEmitter),yT}var vT={},oL;function sb(){return oL||(oL=1,function(n){Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var e={},t={};t.byteLength=d,t.toByteArray=m,t.fromByteArray=w;for(var r=[],i=[],a=typeof Uint8Array<"u"?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,u=s.length;o<u;++o)r[o]=s[o],i[s.charCodeAt(o)]=o;i[45]=62,i[95]=63;function c(C){var A=C.length;if(A%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var I=C.indexOf("=");I===-1&&(I=A);var x=I===A?0:4-I%4;return[I,x]}function d(C){var A=c(C),I=A[0],x=A[1];return(I+x)*3/4-x}function p(C,A,I){return(A+I)*3/4-I}function m(C){var A,I=c(C),x=I[0],L=I[1],U=new a(p(C,x,L)),N=0,B=L>0?x-4:x,q;for(q=0;q<B;q+=4)A=i[C.charCodeAt(q)]<<18|i[C.charCodeAt(q+1)]<<12|i[C.charCodeAt(q+2)]<<6|i[C.charCodeAt(q+3)],U[N++]=A>>16&255,U[N++]=A>>8&255,U[N++]=A&255;return L===2&&(A=i[C.charCodeAt(q)]<<2|i[C.charCodeAt(q+1)]>>4,U[N++]=A&255),L===1&&(A=i[C.charCodeAt(q)]<<10|i[C.charCodeAt(q+1)]<<4|i[C.charCodeAt(q+2)]>>2,U[N++]=A>>8&255,U[N++]=A&255),U}function y(C){return r[C>>18&63]+r[C>>12&63]+r[C>>6&63]+r[C&63]}function b(C,A,I){for(var x,L=[],U=A;U<I;U+=3)x=(C[U]<<16&16711680)+(C[U+1]<<8&65280)+(C[U+2]&255),L.push(y(x));return L.join("")}function w(C){for(var A,I=C.length,x=I%3,L=[],U=16383,N=0,B=I-x;N<B;N+=U)L.push(b(C,N,N+U>B?B:N+U));return x===1?(A=C[I-1],L.push(r[A>>2]+r[A<<4&63]+"==")):x===2&&(A=(C[I-2]<<8)+C[I-1],L.push(r[A>>10]+r[A>>4&63]+r[A<<2&63]+"=")),L.join("")}var S={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */S.read=function(C,A,I,x,L){var U,N,B=L*8-x-1,q=(1<<B)-1,J=q>>1,V=-7,de=I?L-1:0,ae=I?-1:1,ue=C[A+de];for(de+=ae,U=ue&(1<<-V)-1,ue>>=-V,V+=B;V>0;U=U*256+C[A+de],de+=ae,V-=8);for(N=U&(1<<-V)-1,U>>=-V,V+=x;V>0;N=N*256+C[A+de],de+=ae,V-=8);if(U===0)U=1-J;else{if(U===q)return N?NaN:(ue?-1:1)*(1/0);N=N+Math.pow(2,x),U=U-J}return(ue?-1:1)*N*Math.pow(2,U-x)},S.write=function(C,A,I,x,L,U){var N,B,q,J=U*8-L-1,V=(1<<J)-1,de=V>>1,ae=L===23?Math.pow(2,-24)-Math.pow(2,-77):0,ue=x?0:U-1,te=x?1:-1,oe=A<0||A===0&&1/A<0?1:0;for(A=Math.abs(A),isNaN(A)||A===1/0?(B=isNaN(A)?1:0,N=V):(N=Math.floor(Math.log(A)/Math.LN2),A*(q=Math.pow(2,-N))<1&&(N--,q*=2),N+de>=1?A+=ae/q:A+=ae*Math.pow(2,1-de),A*q>=2&&(N++,q/=2),N+de>=V?(B=0,N=V):N+de>=1?(B=(A*q-1)*Math.pow(2,L),N=N+de):(B=A*Math.pow(2,de-1)*Math.pow(2,L),N=0));L>=8;C[I+ue]=B&255,ue+=te,B/=256,L-=8);for(N=N<<L|B,J+=L;J>0;C[I+ue]=N&255,ue+=te,N/=256,J-=8);C[I+ue-te]|=oe*128};/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */(function(C){const A=t,I=S,x=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;C.Buffer=V,C.SlowBuffer=Q,C.INSPECT_MAX_BYTES=50;const L=2147483647;C.kMaxLength=L;const{Uint8Array:U,ArrayBuffer:N,SharedArrayBuffer:B}=globalThis;V.TYPED_ARRAY_SUPPORT=q(),!V.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function q(){try{const G=new U(1),M={foo:function(){return 42}};return Object.setPrototypeOf(M,U.prototype),Object.setPrototypeOf(G,M),G.foo()===42}catch{return!1}}Object.defineProperty(V.prototype,"parent",{enumerable:!0,get:function(){if(V.isBuffer(this))return this.buffer}}),Object.defineProperty(V.prototype,"offset",{enumerable:!0,get:function(){if(V.isBuffer(this))return this.byteOffset}});function J(G){if(G>L)throw new RangeError('The value "'+G+'" is invalid for option "size"');const M=new U(G);return Object.setPrototypeOf(M,V.prototype),M}function V(G,M,D){if(typeof G=="number"){if(typeof M=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return te(G)}return de(G,M,D)}V.poolSize=8192;function de(G,M,D){if(typeof G=="string")return oe(G,M);if(N.isView(G))return Ee(G);if(G==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof G);if(yi(G,N)||G&&yi(G.buffer,N)||typeof B<"u"&&(yi(G,B)||G&&yi(G.buffer,B)))return Y(G,M,D);if(typeof G=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const ne=G.valueOf&&G.valueOf();if(ne!=null&&ne!==G)return V.from(ne,M,D);const he=ve(G);if(he)return he;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof G[Symbol.toPrimitive]=="function")return V.from(G[Symbol.toPrimitive]("string"),M,D);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof G)}V.from=function(G,M,D){return de(G,M,D)},Object.setPrototypeOf(V.prototype,U.prototype),Object.setPrototypeOf(V,U);function ae(G){if(typeof G!="number")throw new TypeError('"size" argument must be of type number');if(G<0)throw new RangeError('The value "'+G+'" is invalid for option "size"')}function ue(G,M,D){return ae(G),G<=0?J(G):M!==void 0?typeof D=="string"?J(G).fill(M,D):J(G).fill(M):J(G)}V.alloc=function(G,M,D){return ue(G,M,D)};function te(G){return ae(G),J(G<0?0:Re(G)|0)}V.allocUnsafe=function(G){return te(G)},V.allocUnsafeSlow=function(G){return te(G)};function oe(G,M){if((typeof M!="string"||M==="")&&(M="utf8"),!V.isEncoding(M))throw new TypeError("Unknown encoding: "+M);const D=ie(G,M)|0;let ne=J(D);const he=ne.write(G,M);return he!==D&&(ne=ne.slice(0,he)),ne}function ge(G){const M=G.length<0?0:Re(G.length)|0,D=J(M);for(let ne=0;ne<M;ne+=1)D[ne]=G[ne]&255;return D}function Ee(G){if(yi(G,U)){const M=new U(G);return Y(M.buffer,M.byteOffset,M.byteLength)}return ge(G)}function Y(G,M,D){if(M<0||G.byteLength<M)throw new RangeError('"offset" is outside of buffer bounds');if(G.byteLength<M+(D||0))throw new RangeError('"length" is outside of buffer bounds');let ne;return M===void 0&&D===void 0?ne=new U(G):D===void 0?ne=new U(G,M):ne=new U(G,M,D),Object.setPrototypeOf(ne,V.prototype),ne}function ve(G){if(V.isBuffer(G)){const M=Re(G.length)|0,D=J(M);return D.length===0||G.copy(D,0,0,M),D}if(G.length!==void 0)return typeof G.length!="number"||qi(G.length)?J(0):ge(G);if(G.type==="Buffer"&&Array.isArray(G.data))return ge(G.data)}function Re(G){if(G>=L)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+L.toString(16)+" bytes");return G|0}function Q(G){return+G!=G&&(G=0),V.alloc(+G)}V.isBuffer=function(M){return M!=null&&M._isBuffer===!0&&M!==V.prototype},V.compare=function(M,D){if(yi(M,U)&&(M=V.from(M,M.offset,M.byteLength)),yi(D,U)&&(D=V.from(D,D.offset,D.byteLength)),!V.isBuffer(M)||!V.isBuffer(D))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(M===D)return 0;let ne=M.length,he=D.length;for(let Ie=0,Z=Math.min(ne,he);Ie<Z;++Ie)if(M[Ie]!==D[Ie]){ne=M[Ie],he=D[Ie];break}return ne<he?-1:he<ne?1:0},V.isEncoding=function(M){switch(String(M).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},V.concat=function(M,D){if(!Array.isArray(M))throw new TypeError('"list" argument must be an Array of Buffers');if(M.length===0)return V.alloc(0);let ne;if(D===void 0)for(D=0,ne=0;ne<M.length;++ne)D+=M[ne].length;const he=V.allocUnsafe(D);let Ie=0;for(ne=0;ne<M.length;++ne){let Z=M[ne];if(yi(Z,U))Ie+Z.length>he.length?(V.isBuffer(Z)||(Z=V.from(Z)),Z.copy(he,Ie)):U.prototype.set.call(he,Z,Ie);else if(V.isBuffer(Z))Z.copy(he,Ie);else throw new TypeError('"list" argument must be an Array of Buffers');Ie+=Z.length}return he};function ie(G,M){if(V.isBuffer(G))return G.length;if(N.isView(G)||yi(G,N))return G.byteLength;if(typeof G!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof G);const D=G.length,ne=arguments.length>2&&arguments[2]===!0;if(!ne&&D===0)return 0;let he=!1;for(;;)switch(M){case"ascii":case"latin1":case"binary":return D;case"utf8":case"utf-8":return sn(G).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return D*2;case"hex":return D>>>1;case"base64":return Kt(G).length;default:if(he)return ne?-1:sn(G).length;M=(""+M).toLowerCase(),he=!0}}V.byteLength=ie;function ce(G,M,D){let ne=!1;if((M===void 0||M<0)&&(M=0),M>this.length||((D===void 0||D>this.length)&&(D=this.length),D<=0)||(D>>>=0,M>>>=0,D<=M))return"";for(G||(G="utf8");;)switch(G){case"hex":return qe(this,M,D);case"utf8":case"utf-8":return Qe(this,M,D);case"ascii":return xt(this,M,D);case"latin1":case"binary":return Oe(this,M,D);case"base64":return ke(this,M,D);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return It(this,M,D);default:if(ne)throw new TypeError("Unknown encoding: "+G);G=(G+"").toLowerCase(),ne=!0}}V.prototype._isBuffer=!0;function P(G,M,D){const ne=G[M];G[M]=G[D],G[D]=ne}V.prototype.swap16=function(){const M=this.length;if(M%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let D=0;D<M;D+=2)P(this,D,D+1);return this},V.prototype.swap32=function(){const M=this.length;if(M%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let D=0;D<M;D+=4)P(this,D,D+3),P(this,D+1,D+2);return this},V.prototype.swap64=function(){const M=this.length;if(M%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let D=0;D<M;D+=8)P(this,D,D+7),P(this,D+1,D+6),P(this,D+2,D+5),P(this,D+3,D+4);return this},V.prototype.toString=function(){const M=this.length;return M===0?"":arguments.length===0?Qe(this,0,M):ce.apply(this,arguments)},V.prototype.toLocaleString=V.prototype.toString,V.prototype.equals=function(M){if(!V.isBuffer(M))throw new TypeError("Argument must be a Buffer");return this===M?!0:V.compare(this,M)===0},V.prototype.inspect=function(){let M="";const D=C.INSPECT_MAX_BYTES;return M=this.toString("hex",0,D).replace(/(.{2})/g,"$1 ").trim(),this.length>D&&(M+=" ... "),"<Buffer "+M+">"},x&&(V.prototype[x]=V.prototype.inspect),V.prototype.compare=function(M,D,ne,he,Ie){if(yi(M,U)&&(M=V.from(M,M.offset,M.byteLength)),!V.isBuffer(M))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof M);if(D===void 0&&(D=0),ne===void 0&&(ne=M?M.length:0),he===void 0&&(he=0),Ie===void 0&&(Ie=this.length),D<0||ne>M.length||he<0||Ie>this.length)throw new RangeError("out of range index");if(he>=Ie&&D>=ne)return 0;if(he>=Ie)return-1;if(D>=ne)return 1;if(D>>>=0,ne>>>=0,he>>>=0,Ie>>>=0,this===M)return 0;let Z=Ie-he,ee=ne-D;const fe=Math.min(Z,ee),we=this.slice(he,Ie),be=M.slice(D,ne);for(let Ze=0;Ze<fe;++Ze)if(we[Ze]!==be[Ze]){Z=we[Ze],ee=be[Ze];break}return Z<ee?-1:ee<Z?1:0};function O(G,M,D,ne,he){if(G.length===0)return-1;if(typeof D=="string"?(ne=D,D=0):D>2147483647?D=2147483647:D<-2147483648&&(D=-2147483648),D=+D,qi(D)&&(D=he?0:G.length-1),D<0&&(D=G.length+D),D>=G.length){if(he)return-1;D=G.length-1}else if(D<0)if(he)D=0;else return-1;if(typeof M=="string"&&(M=V.from(M,ne)),V.isBuffer(M))return M.length===0?-1:K(G,M,D,ne,he);if(typeof M=="number")return M=M&255,typeof U.prototype.indexOf=="function"?he?U.prototype.indexOf.call(G,M,D):U.prototype.lastIndexOf.call(G,M,D):K(G,[M],D,ne,he);throw new TypeError("val must be string, number or Buffer")}function K(G,M,D,ne,he){let Ie=1,Z=G.length,ee=M.length;if(ne!==void 0&&(ne=String(ne).toLowerCase(),ne==="ucs2"||ne==="ucs-2"||ne==="utf16le"||ne==="utf-16le")){if(G.length<2||M.length<2)return-1;Ie=2,Z/=2,ee/=2,D/=2}function fe(be,Ze){return Ie===1?be[Ze]:be.readUInt16BE(Ze*Ie)}let we;if(he){let be=-1;for(we=D;we<Z;we++)if(fe(G,we)===fe(M,be===-1?0:we-be)){if(be===-1&&(be=we),we-be+1===ee)return be*Ie}else be!==-1&&(we-=we-be),be=-1}else for(D+ee>Z&&(D=Z-ee),we=D;we>=0;we--){let be=!0;for(let Ze=0;Ze<ee;Ze++)if(fe(G,we+Ze)!==fe(M,Ze)){be=!1;break}if(be)return we}return-1}V.prototype.includes=function(M,D,ne){return this.indexOf(M,D,ne)!==-1},V.prototype.indexOf=function(M,D,ne){return O(this,M,D,ne,!0)},V.prototype.lastIndexOf=function(M,D,ne){return O(this,M,D,ne,!1)};function X(G,M,D,ne){D=Number(D)||0;const he=G.length-D;ne?(ne=Number(ne),ne>he&&(ne=he)):ne=he;const Ie=M.length;ne>Ie/2&&(ne=Ie/2);let Z;for(Z=0;Z<ne;++Z){const ee=parseInt(M.substr(Z*2,2),16);if(qi(ee))return Z;G[D+Z]=ee}return Z}function se(G,M,D,ne){return da(sn(M,G.length-D),G,D,ne)}function F(G,M,D,ne){return da(tn(M),G,D,ne)}function z(G,M,D,ne){return da(Kt(M),G,D,ne)}function ye(G,M,D,ne){return da(un(M,G.length-D),G,D,ne)}V.prototype.write=function(M,D,ne,he){if(D===void 0)he="utf8",ne=this.length,D=0;else if(ne===void 0&&typeof D=="string")he=D,ne=this.length,D=0;else if(isFinite(D))D=D>>>0,isFinite(ne)?(ne=ne>>>0,he===void 0&&(he="utf8")):(he=ne,ne=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const Ie=this.length-D;if((ne===void 0||ne>Ie)&&(ne=Ie),M.length>0&&(ne<0||D<0)||D>this.length)throw new RangeError("Attempt to write outside buffer bounds");he||(he="utf8");let Z=!1;for(;;)switch(he){case"hex":return X(this,M,D,ne);case"utf8":case"utf-8":return se(this,M,D,ne);case"ascii":case"latin1":case"binary":return F(this,M,D,ne);case"base64":return z(this,M,D,ne);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ye(this,M,D,ne);default:if(Z)throw new TypeError("Unknown encoding: "+he);he=(""+he).toLowerCase(),Z=!0}},V.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ke(G,M,D){return M===0&&D===G.length?A.fromByteArray(G):A.fromByteArray(G.slice(M,D))}function Qe(G,M,D){D=Math.min(G.length,D);const ne=[];let he=M;for(;he<D;){const Ie=G[he];let Z=null,ee=Ie>239?4:Ie>223?3:Ie>191?2:1;if(he+ee<=D){let fe,we,be,Ze;switch(ee){case 1:Ie<128&&(Z=Ie);break;case 2:fe=G[he+1],(fe&192)===128&&(Ze=(Ie&31)<<6|fe&63,Ze>127&&(Z=Ze));break;case 3:fe=G[he+1],we=G[he+2],(fe&192)===128&&(we&192)===128&&(Ze=(Ie&15)<<12|(fe&63)<<6|we&63,Ze>2047&&(Ze<55296||Ze>57343)&&(Z=Ze));break;case 4:fe=G[he+1],we=G[he+2],be=G[he+3],(fe&192)===128&&(we&192)===128&&(be&192)===128&&(Ze=(Ie&15)<<18|(fe&63)<<12|(we&63)<<6|be&63,Ze>65535&&Ze<1114112&&(Z=Ze))}}Z===null?(Z=65533,ee=1):Z>65535&&(Z-=65536,ne.push(Z>>>10&1023|55296),Z=56320|Z&1023),ne.push(Z),he+=ee}return ze(ne)}const $e=4096;function ze(G){const M=G.length;if(M<=$e)return String.fromCharCode.apply(String,G);let D="",ne=0;for(;ne<M;)D+=String.fromCharCode.apply(String,G.slice(ne,ne+=$e));return D}function xt(G,M,D){let ne="";D=Math.min(G.length,D);for(let he=M;he<D;++he)ne+=String.fromCharCode(G[he]&127);return ne}function Oe(G,M,D){let ne="";D=Math.min(G.length,D);for(let he=M;he<D;++he)ne+=String.fromCharCode(G[he]);return ne}function qe(G,M,D){const ne=G.length;(!M||M<0)&&(M=0),(!D||D<0||D>ne)&&(D=ne);let he="";for(let Ie=M;Ie<D;++Ie)he+=yc[G[Ie]];return he}function It(G,M,D){const ne=G.slice(M,D);let he="";for(let Ie=0;Ie<ne.length-1;Ie+=2)he+=String.fromCharCode(ne[Ie]+ne[Ie+1]*256);return he}V.prototype.slice=function(M,D){const ne=this.length;M=~~M,D=D===void 0?ne:~~D,M<0?(M+=ne,M<0&&(M=0)):M>ne&&(M=ne),D<0?(D+=ne,D<0&&(D=0)):D>ne&&(D=ne),D<M&&(D=M);const he=this.subarray(M,D);return Object.setPrototypeOf(he,V.prototype),he};function Ve(G,M,D){if(G%1!==0||G<0)throw new RangeError("offset is not uint");if(G+M>D)throw new RangeError("Trying to access beyond buffer length")}V.prototype.readUintLE=V.prototype.readUIntLE=function(M,D,ne){M=M>>>0,D=D>>>0,ne||Ve(M,D,this.length);let he=this[M],Ie=1,Z=0;for(;++Z<D&&(Ie*=256);)he+=this[M+Z]*Ie;return he},V.prototype.readUintBE=V.prototype.readUIntBE=function(M,D,ne){M=M>>>0,D=D>>>0,ne||Ve(M,D,this.length);let he=this[M+--D],Ie=1;for(;D>0&&(Ie*=256);)he+=this[M+--D]*Ie;return he},V.prototype.readUint8=V.prototype.readUInt8=function(M,D){return M=M>>>0,D||Ve(M,1,this.length),this[M]},V.prototype.readUint16LE=V.prototype.readUInt16LE=function(M,D){return M=M>>>0,D||Ve(M,2,this.length),this[M]|this[M+1]<<8},V.prototype.readUint16BE=V.prototype.readUInt16BE=function(M,D){return M=M>>>0,D||Ve(M,2,this.length),this[M]<<8|this[M+1]},V.prototype.readUint32LE=V.prototype.readUInt32LE=function(M,D){return M=M>>>0,D||Ve(M,4,this.length),(this[M]|this[M+1]<<8|this[M+2]<<16)+this[M+3]*16777216},V.prototype.readUint32BE=V.prototype.readUInt32BE=function(M,D){return M=M>>>0,D||Ve(M,4,this.length),this[M]*16777216+(this[M+1]<<16|this[M+2]<<8|this[M+3])},V.prototype.readBigUInt64LE=ri(function(M){M=M>>>0,pe(M,"offset");const D=this[M],ne=this[M+7];(D===void 0||ne===void 0)&&Ce(M,this.length-8);const he=D+this[++M]*2**8+this[++M]*2**16+this[++M]*2**24,Ie=this[++M]+this[++M]*2**8+this[++M]*2**16+ne*2**24;return BigInt(he)+(BigInt(Ie)<<BigInt(32))}),V.prototype.readBigUInt64BE=ri(function(M){M=M>>>0,pe(M,"offset");const D=this[M],ne=this[M+7];(D===void 0||ne===void 0)&&Ce(M,this.length-8);const he=D*2**24+this[++M]*2**16+this[++M]*2**8+this[++M],Ie=this[++M]*2**24+this[++M]*2**16+this[++M]*2**8+ne;return(BigInt(he)<<BigInt(32))+BigInt(Ie)}),V.prototype.readIntLE=function(M,D,ne){M=M>>>0,D=D>>>0,ne||Ve(M,D,this.length);let he=this[M],Ie=1,Z=0;for(;++Z<D&&(Ie*=256);)he+=this[M+Z]*Ie;return Ie*=128,he>=Ie&&(he-=Math.pow(2,8*D)),he},V.prototype.readIntBE=function(M,D,ne){M=M>>>0,D=D>>>0,ne||Ve(M,D,this.length);let he=D,Ie=1,Z=this[M+--he];for(;he>0&&(Ie*=256);)Z+=this[M+--he]*Ie;return Ie*=128,Z>=Ie&&(Z-=Math.pow(2,8*D)),Z},V.prototype.readInt8=function(M,D){return M=M>>>0,D||Ve(M,1,this.length),this[M]&128?(255-this[M]+1)*-1:this[M]},V.prototype.readInt16LE=function(M,D){M=M>>>0,D||Ve(M,2,this.length);const ne=this[M]|this[M+1]<<8;return ne&32768?ne|4294901760:ne},V.prototype.readInt16BE=function(M,D){M=M>>>0,D||Ve(M,2,this.length);const ne=this[M+1]|this[M]<<8;return ne&32768?ne|4294901760:ne},V.prototype.readInt32LE=function(M,D){return M=M>>>0,D||Ve(M,4,this.length),this[M]|this[M+1]<<8|this[M+2]<<16|this[M+3]<<24},V.prototype.readInt32BE=function(M,D){return M=M>>>0,D||Ve(M,4,this.length),this[M]<<24|this[M+1]<<16|this[M+2]<<8|this[M+3]},V.prototype.readBigInt64LE=ri(function(M){M=M>>>0,pe(M,"offset");const D=this[M],ne=this[M+7];(D===void 0||ne===void 0)&&Ce(M,this.length-8);const he=this[M+4]+this[M+5]*2**8+this[M+6]*2**16+(ne<<24);return(BigInt(he)<<BigInt(32))+BigInt(D+this[++M]*2**8+this[++M]*2**16+this[++M]*2**24)}),V.prototype.readBigInt64BE=ri(function(M){M=M>>>0,pe(M,"offset");const D=this[M],ne=this[M+7];(D===void 0||ne===void 0)&&Ce(M,this.length-8);const he=(D<<24)+this[++M]*2**16+this[++M]*2**8+this[++M];return(BigInt(he)<<BigInt(32))+BigInt(this[++M]*2**24+this[++M]*2**16+this[++M]*2**8+ne)}),V.prototype.readFloatLE=function(M,D){return M=M>>>0,D||Ve(M,4,this.length),I.read(this,M,!0,23,4)},V.prototype.readFloatBE=function(M,D){return M=M>>>0,D||Ve(M,4,this.length),I.read(this,M,!1,23,4)},V.prototype.readDoubleLE=function(M,D){return M=M>>>0,D||Ve(M,8,this.length),I.read(this,M,!0,52,8)},V.prototype.readDoubleBE=function(M,D){return M=M>>>0,D||Ve(M,8,this.length),I.read(this,M,!1,52,8)};function Be(G,M,D,ne,he,Ie){if(!V.isBuffer(G))throw new TypeError('"buffer" argument must be a Buffer instance');if(M>he||M<Ie)throw new RangeError('"value" argument is out of bounds');if(D+ne>G.length)throw new RangeError("Index out of range")}V.prototype.writeUintLE=V.prototype.writeUIntLE=function(M,D,ne,he){if(M=+M,D=D>>>0,ne=ne>>>0,!he){const ee=Math.pow(2,8*ne)-1;Be(this,M,D,ne,ee,0)}let Ie=1,Z=0;for(this[D]=M&255;++Z<ne&&(Ie*=256);)this[D+Z]=M/Ie&255;return D+ne},V.prototype.writeUintBE=V.prototype.writeUIntBE=function(M,D,ne,he){if(M=+M,D=D>>>0,ne=ne>>>0,!he){const ee=Math.pow(2,8*ne)-1;Be(this,M,D,ne,ee,0)}let Ie=ne-1,Z=1;for(this[D+Ie]=M&255;--Ie>=0&&(Z*=256);)this[D+Ie]=M/Z&255;return D+ne},V.prototype.writeUint8=V.prototype.writeUInt8=function(M,D,ne){return M=+M,D=D>>>0,ne||Be(this,M,D,1,255,0),this[D]=M&255,D+1},V.prototype.writeUint16LE=V.prototype.writeUInt16LE=function(M,D,ne){return M=+M,D=D>>>0,ne||Be(this,M,D,2,65535,0),this[D]=M&255,this[D+1]=M>>>8,D+2},V.prototype.writeUint16BE=V.prototype.writeUInt16BE=function(M,D,ne){return M=+M,D=D>>>0,ne||Be(this,M,D,2,65535,0),this[D]=M>>>8,this[D+1]=M&255,D+2},V.prototype.writeUint32LE=V.prototype.writeUInt32LE=function(M,D,ne){return M=+M,D=D>>>0,ne||Be(this,M,D,4,4294967295,0),this[D+3]=M>>>24,this[D+2]=M>>>16,this[D+1]=M>>>8,this[D]=M&255,D+4},V.prototype.writeUint32BE=V.prototype.writeUInt32BE=function(M,D,ne){return M=+M,D=D>>>0,ne||Be(this,M,D,4,4294967295,0),this[D]=M>>>24,this[D+1]=M>>>16,this[D+2]=M>>>8,this[D+3]=M&255,D+4};function et(G,M,D,ne,he){re(M,ne,he,G,D,7);let Ie=Number(M&BigInt(4294967295));G[D++]=Ie,Ie=Ie>>8,G[D++]=Ie,Ie=Ie>>8,G[D++]=Ie,Ie=Ie>>8,G[D++]=Ie;let Z=Number(M>>BigInt(32)&BigInt(4294967295));return G[D++]=Z,Z=Z>>8,G[D++]=Z,Z=Z>>8,G[D++]=Z,Z=Z>>8,G[D++]=Z,D}function Ye(G,M,D,ne,he){re(M,ne,he,G,D,7);let Ie=Number(M&BigInt(4294967295));G[D+7]=Ie,Ie=Ie>>8,G[D+6]=Ie,Ie=Ie>>8,G[D+5]=Ie,Ie=Ie>>8,G[D+4]=Ie;let Z=Number(M>>BigInt(32)&BigInt(4294967295));return G[D+3]=Z,Z=Z>>8,G[D+2]=Z,Z=Z>>8,G[D+1]=Z,Z=Z>>8,G[D]=Z,D+8}V.prototype.writeBigUInt64LE=ri(function(M,D=0){return et(this,M,D,BigInt(0),BigInt("0xffffffffffffffff"))}),V.prototype.writeBigUInt64BE=ri(function(M,D=0){return Ye(this,M,D,BigInt(0),BigInt("0xffffffffffffffff"))}),V.prototype.writeIntLE=function(M,D,ne,he){if(M=+M,D=D>>>0,!he){const fe=Math.pow(2,8*ne-1);Be(this,M,D,ne,fe-1,-fe)}let Ie=0,Z=1,ee=0;for(this[D]=M&255;++Ie<ne&&(Z*=256);)M<0&&ee===0&&this[D+Ie-1]!==0&&(ee=1),this[D+Ie]=(M/Z>>0)-ee&255;return D+ne},V.prototype.writeIntBE=function(M,D,ne,he){if(M=+M,D=D>>>0,!he){const fe=Math.pow(2,8*ne-1);Be(this,M,D,ne,fe-1,-fe)}let Ie=ne-1,Z=1,ee=0;for(this[D+Ie]=M&255;--Ie>=0&&(Z*=256);)M<0&&ee===0&&this[D+Ie+1]!==0&&(ee=1),this[D+Ie]=(M/Z>>0)-ee&255;return D+ne},V.prototype.writeInt8=function(M,D,ne){return M=+M,D=D>>>0,ne||Be(this,M,D,1,127,-128),M<0&&(M=255+M+1),this[D]=M&255,D+1},V.prototype.writeInt16LE=function(M,D,ne){return M=+M,D=D>>>0,ne||Be(this,M,D,2,32767,-32768),this[D]=M&255,this[D+1]=M>>>8,D+2},V.prototype.writeInt16BE=function(M,D,ne){return M=+M,D=D>>>0,ne||Be(this,M,D,2,32767,-32768),this[D]=M>>>8,this[D+1]=M&255,D+2},V.prototype.writeInt32LE=function(M,D,ne){return M=+M,D=D>>>0,ne||Be(this,M,D,4,2147483647,-2147483648),this[D]=M&255,this[D+1]=M>>>8,this[D+2]=M>>>16,this[D+3]=M>>>24,D+4},V.prototype.writeInt32BE=function(M,D,ne){return M=+M,D=D>>>0,ne||Be(this,M,D,4,2147483647,-2147483648),M<0&&(M=4294967295+M+1),this[D]=M>>>24,this[D+1]=M>>>16,this[D+2]=M>>>8,this[D+3]=M&255,D+4},V.prototype.writeBigInt64LE=ri(function(M,D=0){return et(this,M,D,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),V.prototype.writeBigInt64BE=ri(function(M,D=0){return Ye(this,M,D,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function We(G,M,D,ne,he,Ie){if(D+ne>G.length)throw new RangeError("Index out of range");if(D<0)throw new RangeError("Index out of range")}function rt(G,M,D,ne,he){return M=+M,D=D>>>0,he||We(G,M,D,4),I.write(G,M,D,ne,23,4),D+4}V.prototype.writeFloatLE=function(M,D,ne){return rt(this,M,D,!0,ne)},V.prototype.writeFloatBE=function(M,D,ne){return rt(this,M,D,!1,ne)};function tt(G,M,D,ne,he){return M=+M,D=D>>>0,he||We(G,M,D,8),I.write(G,M,D,ne,52,8),D+8}V.prototype.writeDoubleLE=function(M,D,ne){return tt(this,M,D,!0,ne)},V.prototype.writeDoubleBE=function(M,D,ne){return tt(this,M,D,!1,ne)},V.prototype.copy=function(M,D,ne,he){if(!V.isBuffer(M))throw new TypeError("argument should be a Buffer");if(ne||(ne=0),!he&&he!==0&&(he=this.length),D>=M.length&&(D=M.length),D||(D=0),he>0&&he<ne&&(he=ne),he===ne||M.length===0||this.length===0)return 0;if(D<0)throw new RangeError("targetStart out of bounds");if(ne<0||ne>=this.length)throw new RangeError("Index out of range");if(he<0)throw new RangeError("sourceEnd out of bounds");he>this.length&&(he=this.length),M.length-D<he-ne&&(he=M.length-D+ne);const Ie=he-ne;return this===M&&typeof U.prototype.copyWithin=="function"?this.copyWithin(D,ne,he):U.prototype.set.call(M,this.subarray(ne,he),D),Ie},V.prototype.fill=function(M,D,ne,he){if(typeof M=="string"){if(typeof D=="string"?(he=D,D=0,ne=this.length):typeof ne=="string"&&(he=ne,ne=this.length),he!==void 0&&typeof he!="string")throw new TypeError("encoding must be a string");if(typeof he=="string"&&!V.isEncoding(he))throw new TypeError("Unknown encoding: "+he);if(M.length===1){const Z=M.charCodeAt(0);(he==="utf8"&&Z<128||he==="latin1")&&(M=Z)}}else typeof M=="number"?M=M&255:typeof M=="boolean"&&(M=Number(M));if(D<0||this.length<D||this.length<ne)throw new RangeError("Out of range index");if(ne<=D)return this;D=D>>>0,ne=ne===void 0?this.length:ne>>>0,M||(M=0);let Ie;if(typeof M=="number")for(Ie=D;Ie<ne;++Ie)this[Ie]=M;else{const Z=V.isBuffer(M)?M:V.from(M,he),ee=Z.length;if(ee===0)throw new TypeError('The value "'+M+'" is invalid for argument "value"');for(Ie=0;Ie<ne-D;++Ie)this[Ie+D]=Z[Ie%ee]}return this};const St={};function H(G,M,D){St[G]=class extends D{constructor(){super(),Object.defineProperty(this,"message",{value:M.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${G}]`,this.stack,delete this.name}get code(){return G}set code(he){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:he,writable:!0})}toString(){return`${this.name} [${G}]: ${this.message}`}}}H("ERR_BUFFER_OUT_OF_BOUNDS",function(G){return G?`${G} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),H("ERR_INVALID_ARG_TYPE",function(G,M){return`The "${G}" argument must be of type number. Received type ${typeof M}`},TypeError),H("ERR_OUT_OF_RANGE",function(G,M,D){let ne=`The value of "${G}" is out of range.`,he=D;return Number.isInteger(D)&&Math.abs(D)>2**32?he=k(String(D)):typeof D=="bigint"&&(he=String(D),(D>BigInt(2)**BigInt(32)||D<-(BigInt(2)**BigInt(32)))&&(he=k(he)),he+="n"),ne+=` It must be ${M}. Received ${he}`,ne},RangeError);function k(G){let M="",D=G.length;const ne=G[0]==="-"?1:0;for(;D>=ne+4;D-=3)M=`_${G.slice(D-3,D)}${M}`;return`${G.slice(0,D)}${M}`}function $(G,M,D){pe(M,"offset"),(G[M]===void 0||G[M+D]===void 0)&&Ce(M,G.length-(D+1))}function re(G,M,D,ne,he,Ie){if(G>D||G<M){const Z=typeof M=="bigint"?"n":"";let ee;throw M===0||M===BigInt(0)?ee=`>= 0${Z} and < 2${Z} ** ${(Ie+1)*8}${Z}`:ee=`>= -(2${Z} ** ${(Ie+1)*8-1}${Z}) and < 2 ** ${(Ie+1)*8-1}${Z}`,new St.ERR_OUT_OF_RANGE("value",ee,G)}$(ne,he,Ie)}function pe(G,M){if(typeof G!="number")throw new St.ERR_INVALID_ARG_TYPE(M,"number",G)}function Ce(G,M,D){throw Math.floor(G)!==G?(pe(G,D),new St.ERR_OUT_OF_RANGE("offset","an integer",G)):M<0?new St.ERR_BUFFER_OUT_OF_BOUNDS:new St.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${M}`,G)}const Le=/[^+/0-9A-Za-z-_]/g;function ht(G){if(G=G.split("=")[0],G=G.trim().replace(Le,""),G.length<2)return"";for(;G.length%4!==0;)G=G+"=";return G}function sn(G,M){M=M||1/0;let D;const ne=G.length;let he=null;const Ie=[];for(let Z=0;Z<ne;++Z){if(D=G.charCodeAt(Z),D>55295&&D<57344){if(!he){if(D>56319){(M-=3)>-1&&Ie.push(239,191,189);continue}else if(Z+1===ne){(M-=3)>-1&&Ie.push(239,191,189);continue}he=D;continue}if(D<56320){(M-=3)>-1&&Ie.push(239,191,189),he=D;continue}D=(he-55296<<10|D-56320)+65536}else he&&(M-=3)>-1&&Ie.push(239,191,189);if(he=null,D<128){if((M-=1)<0)break;Ie.push(D)}else if(D<2048){if((M-=2)<0)break;Ie.push(D>>6|192,D&63|128)}else if(D<65536){if((M-=3)<0)break;Ie.push(D>>12|224,D>>6&63|128,D&63|128)}else if(D<1114112){if((M-=4)<0)break;Ie.push(D>>18|240,D>>12&63|128,D>>6&63|128,D&63|128)}else throw new Error("Invalid code point")}return Ie}function tn(G){const M=[];for(let D=0;D<G.length;++D)M.push(G.charCodeAt(D)&255);return M}function un(G,M){let D,ne,he;const Ie=[];for(let Z=0;Z<G.length&&!((M-=2)<0);++Z)D=G.charCodeAt(Z),ne=D>>8,he=D%256,Ie.push(he),Ie.push(ne);return Ie}function Kt(G){return A.toByteArray(ht(G))}function da(G,M,D,ne){let he;for(he=0;he<ne&&!(he+D>=M.length||he>=G.length);++he)M[he+D]=G[he];return he}function yi(G,M){return G instanceof M||G!=null&&G.constructor!=null&&G.constructor.name!=null&&G.constructor.name===M.name}function qi(G){return G!==G}const yc=function(){const G="0123456789abcdef",M=new Array(256);for(let D=0;D<16;++D){const ne=D*16;for(let he=0;he<16;++he)M[ne+he]=G[D]+G[he]}return M}();function ri(G){return typeof BigInt>"u"?Wl:G}function Wl(){throw new Error("BigInt not supported")}})(e);const T=e.Buffer;n.Blob=e.Blob,n.BlobOptions=e.BlobOptions,n.Buffer=e.Buffer,n.File=e.File,n.FileOptions=e.FileOptions,n.INSPECT_MAX_BYTES=e.INSPECT_MAX_BYTES,n.SlowBuffer=e.SlowBuffer,n.TranscodeEncoding=e.TranscodeEncoding,n.atob=e.atob,n.btoa=e.btoa,n.constants=e.constants,n.default=T,n.isAscii=e.isAscii,n.isUtf8=e.isUtf8,n.kMaxLength=e.kMaxLength,n.kStringMaxLength=e.kStringMaxLength,n.resolveObjectURL=e.resolveObjectURL,n.transcode=e.transcode}(vT)),vT}var _T={},bT={},wT,lL;function N3(){return lL||(lL=1,wT=function(){if(typeof Symbol!="function"||typeof Object.getOwnPropertySymbols!="function")return!1;if(typeof Symbol.iterator=="symbol")return!0;var e={},t=Symbol("test"),r=Object(t);if(typeof t=="string"||Object.prototype.toString.call(t)!=="[object Symbol]"||Object.prototype.toString.call(r)!=="[object Symbol]")return!1;var i=42;e[t]=i;for(var a in e)return!1;if(typeof Object.keys=="function"&&Object.keys(e).length!==0||typeof Object.getOwnPropertyNames=="function"&&Object.getOwnPropertyNames(e).length!==0)return!1;var s=Object.getOwnPropertySymbols(e);if(s.length!==1||s[0]!==t||!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if(typeof Object.getOwnPropertyDescriptor=="function"){var o=Object.getOwnPropertyDescriptor(e,t);if(o.value!==i||o.enumerable!==!0)return!1}return!0}),wT}var ET,uL;function ob(){if(uL)return ET;uL=1;var n=N3();return ET=function(){return n()&&!!Symbol.toStringTag},ET}var ST,cL;function k3(){return cL||(cL=1,ST=Object),ST}var TT,fL;function xQ(){return fL||(fL=1,TT=Error),TT}var AT,dL;function OQ(){return dL||(dL=1,AT=EvalError),AT}var CT,hL;function NQ(){return hL||(hL=1,CT=RangeError),CT}var RT,pL;function kQ(){return pL||(pL=1,RT=ReferenceError),RT}var IT,mL;function M3(){return mL||(mL=1,IT=SyntaxError),IT}var PT,gL;function hm(){return gL||(gL=1,PT=TypeError),PT}var xT,yL;function MQ(){return yL||(yL=1,xT=URIError),xT}var OT,vL;function DQ(){return vL||(vL=1,OT=Math.abs),OT}var NT,_L;function $Q(){return _L||(_L=1,NT=Math.floor),NT}var kT,bL;function LQ(){return bL||(bL=1,kT=Math.max),kT}var MT,wL;function UQ(){return wL||(wL=1,MT=Math.min),MT}var DT,EL;function jQ(){return EL||(EL=1,DT=Math.pow),DT}var $T,SL;function FQ(){return SL||(SL=1,$T=Math.round),$T}var LT,TL;function BQ(){return TL||(TL=1,LT=Number.isNaN||function(e){return e!==e}),LT}var UT,AL;function qQ(){if(AL)return UT;AL=1;var n=BQ();return UT=function(t){return n(t)||t===0?t:t<0?-1:1},UT}var jT,CL;function VQ(){return CL||(CL=1,jT=Object.getOwnPropertyDescriptor),jT}var FT,RL;function gd(){if(RL)return FT;RL=1;var n=VQ();if(n)try{n([],"length")}catch{n=null}return FT=n,FT}var BT,IL;function lb(){if(IL)return BT;IL=1;var n=Object.defineProperty||!1;if(n)try{n({},"a",{value:1})}catch{n=!1}return BT=n,BT}var qT,PL;function zQ(){if(PL)return qT;PL=1;var n=typeof Symbol<"u"&&Symbol,e=N3();return qT=function(){return typeof n!="function"||typeof Symbol!="function"||typeof n("foo")!="symbol"||typeof Symbol("bar")!="symbol"?!1:e()},qT}var VT,xL;function D3(){return xL||(xL=1,VT=typeof Reflect<"u"&&Reflect.getPrototypeOf||null),VT}var zT,OL;function $3(){if(OL)return zT;OL=1;var n=k3();return zT=n.getPrototypeOf||null,zT}var HT,NL;function HQ(){if(NL)return HT;NL=1;var n="Function.prototype.bind called on incompatible ",e=Object.prototype.toString,t=Math.max,r="[object Function]",i=function(u,c){for(var d=[],p=0;p<u.length;p+=1)d[p]=u[p];for(var m=0;m<c.length;m+=1)d[m+u.length]=c[m];return d},a=function(u,c){for(var d=[],p=c,m=0;p<u.length;p+=1,m+=1)d[m]=u[p];return d},s=function(o,u){for(var c="",d=0;d<o.length;d+=1)c+=o[d],d+1<o.length&&(c+=u);return c};return HT=function(u){var c=this;if(typeof c!="function"||e.apply(c)!==r)throw new TypeError(n+c);for(var d=a(arguments,1),p,m=function(){if(this instanceof p){var T=c.apply(this,i(d,arguments));return Object(T)===T?T:this}return c.apply(u,i(d,arguments))},y=t(0,c.length-d.length),b=[],w=0;w<y;w++)b[w]="$"+w;if(p=Function("binder","return function ("+s(b,",")+"){ return binder.apply(this,arguments); }")(m),c.prototype){var S=function(){};S.prototype=c.prototype,p.prototype=new S,S.prototype=null}return p},HT}var GT,kL;function pm(){if(kL)return GT;kL=1;var n=HQ();return GT=Function.prototype.bind||n,GT}var WT,ML;function PI(){return ML||(ML=1,WT=Function.prototype.call),WT}var KT,DL;function xI(){return DL||(DL=1,KT=Function.prototype.apply),KT}var JT,$L;function GQ(){return $L||($L=1,JT=typeof Reflect<"u"&&Reflect&&Reflect.apply),JT}var YT,LL;function L3(){if(LL)return YT;LL=1;var n=pm(),e=xI(),t=PI(),r=GQ();return YT=r||n.call(t,e),YT}var ZT,UL;function OI(){if(UL)return ZT;UL=1;var n=pm(),e=hm(),t=PI(),r=L3();return ZT=function(a){if(a.length<1||typeof a[0]!="function")throw new e("a function is required");return r(n,t,a)},ZT}var XT,jL;function WQ(){if(jL)return XT;jL=1;var n=OI(),e=gd(),t;try{t=[].__proto__===Array.prototype}catch(s){if(!s||typeof s!="object"||!("code"in s)||s.code!=="ERR_PROTO_ACCESS")throw s}var r=!!t&&e&&e(Object.prototype,"__proto__"),i=Object,a=i.getPrototypeOf;return XT=r&&typeof r.get=="function"?n([r.get]):typeof a=="function"?function(o){return a(o==null?o:i(o))}:!1,XT}var QT,FL;function NI(){if(FL)return QT;FL=1;var n=D3(),e=$3(),t=WQ();return QT=n?function(i){return n(i)}:e?function(i){if(!i||typeof i!="object"&&typeof i!="function")throw new TypeError("getProto: not an object");return e(i)}:t?function(i){return t(i)}:null,QT}var eA,BL;function U3(){if(BL)return eA;BL=1;var n=Function.prototype.call,e=Object.prototype.hasOwnProperty,t=pm();return eA=t.call(n,e),eA}var tA,qL;function j3(){if(qL)return tA;qL=1;var n,e=k3(),t=xQ(),r=OQ(),i=NQ(),a=kQ(),s=M3(),o=hm(),u=MQ(),c=DQ(),d=$Q(),p=LQ(),m=UQ(),y=jQ(),b=FQ(),w=qQ(),S=Function,T=function(X){try{return S('"use strict"; return ('+X+").constructor;")()}catch{}},C=gd(),A=lb(),I=function(){throw new o},x=C?function(){try{return arguments.callee,I}catch{try{return C(arguments,"callee").get}catch{return I}}}():I,L=zQ()(),U=NI(),N=$3(),B=D3(),q=xI(),J=PI(),V={},de=typeof Uint8Array>"u"||!U?n:U(Uint8Array),ae={__proto__:null,"%AggregateError%":typeof AggregateError>"u"?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer>"u"?n:ArrayBuffer,"%ArrayIteratorPrototype%":L&&U?U([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":V,"%AsyncGenerator%":V,"%AsyncGeneratorFunction%":V,"%AsyncIteratorPrototype%":V,"%Atomics%":typeof Atomics>"u"?n:Atomics,"%BigInt%":typeof BigInt>"u"?n:BigInt,"%BigInt64Array%":typeof BigInt64Array>"u"?n:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array>"u"?n:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView>"u"?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":t,"%eval%":eval,"%EvalError%":r,"%Float16Array%":typeof Float16Array>"u"?n:Float16Array,"%Float32Array%":typeof Float32Array>"u"?n:Float32Array,"%Float64Array%":typeof Float64Array>"u"?n:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry>"u"?n:FinalizationRegistry,"%Function%":S,"%GeneratorFunction%":V,"%Int8Array%":typeof Int8Array>"u"?n:Int8Array,"%Int16Array%":typeof Int16Array>"u"?n:Int16Array,"%Int32Array%":typeof Int32Array>"u"?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":L&&U?U(U([][Symbol.iterator]())):n,"%JSON%":typeof JSON=="object"?JSON:n,"%Map%":typeof Map>"u"?n:Map,"%MapIteratorPrototype%":typeof Map>"u"||!L||!U?n:U(new Map()[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":e,"%Object.getOwnPropertyDescriptor%":C,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise>"u"?n:Promise,"%Proxy%":typeof Proxy>"u"?n:Proxy,"%RangeError%":i,"%ReferenceError%":a,"%Reflect%":typeof Reflect>"u"?n:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set>"u"?n:Set,"%SetIteratorPrototype%":typeof Set>"u"||!L||!U?n:U(new Set()[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer>"u"?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":L&&U?U(""[Symbol.iterator]()):n,"%Symbol%":L?Symbol:n,"%SyntaxError%":s,"%ThrowTypeError%":x,"%TypedArray%":de,"%TypeError%":o,"%Uint8Array%":typeof Uint8Array>"u"?n:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray>"u"?n:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array>"u"?n:Uint16Array,"%Uint32Array%":typeof Uint32Array>"u"?n:Uint32Array,"%URIError%":u,"%WeakMap%":typeof WeakMap>"u"?n:WeakMap,"%WeakRef%":typeof WeakRef>"u"?n:WeakRef,"%WeakSet%":typeof WeakSet>"u"?n:WeakSet,"%Function.prototype.call%":J,"%Function.prototype.apply%":q,"%Object.defineProperty%":A,"%Object.getPrototypeOf%":N,"%Math.abs%":c,"%Math.floor%":d,"%Math.max%":p,"%Math.min%":m,"%Math.pow%":y,"%Math.round%":b,"%Math.sign%":w,"%Reflect.getPrototypeOf%":B};if(U)try{null.error}catch(X){var ue=U(U(X));ae["%Error.prototype%"]=ue}var te=function X(se){var F;if(se==="%AsyncFunction%")F=T("async function () {}");else if(se==="%GeneratorFunction%")F=T("function* () {}");else if(se==="%AsyncGeneratorFunction%")F=T("async function* () {}");else if(se==="%AsyncGenerator%"){var z=X("%AsyncGeneratorFunction%");z&&(F=z.prototype)}else if(se==="%AsyncIteratorPrototype%"){var ye=X("%AsyncGenerator%");ye&&U&&(F=U(ye.prototype))}return ae[se]=F,F},oe={__proto__:null,"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},ge=pm(),Ee=U3(),Y=ge.call(J,Array.prototype.concat),ve=ge.call(q,Array.prototype.splice),Re=ge.call(J,String.prototype.replace),Q=ge.call(J,String.prototype.slice),ie=ge.call(J,RegExp.prototype.exec),ce=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,P=/\\(\\)?/g,O=function(se){var F=Q(se,0,1),z=Q(se,-1);if(F==="%"&&z!=="%")throw new s("invalid intrinsic syntax, expected closing `%`");if(z==="%"&&F!=="%")throw new s("invalid intrinsic syntax, expected opening `%`");var ye=[];return Re(se,ce,function(ke,Qe,$e,ze){ye[ye.length]=$e?Re(ze,P,"$1"):Qe||ke}),ye},K=function(se,F){var z=se,ye;if(Ee(oe,z)&&(ye=oe[z],z="%"+ye[0]+"%"),Ee(ae,z)){var ke=ae[z];if(ke===V&&(ke=te(z)),typeof ke>"u"&&!F)throw new o("intrinsic "+se+" exists, but is not available. Please file an issue!");return{alias:ye,name:z,value:ke}}throw new s("intrinsic "+se+" does not exist!")};return tA=function(se,F){if(typeof se!="string"||se.length===0)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&typeof F!="boolean")throw new o('"allowMissing" argument must be a boolean');if(ie(/^%?[^%]*%?$/,se)===null)throw new s("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var z=O(se),ye=z.length>0?z[0]:"",ke=K("%"+ye+"%",F),Qe=ke.name,$e=ke.value,ze=!1,xt=ke.alias;xt&&(ye=xt[0],ve(z,Y([0,1],xt)));for(var Oe=1,qe=!0;Oe<z.length;Oe+=1){var It=z[Oe],Ve=Q(It,0,1),Be=Q(It,-1);if((Ve==='"'||Ve==="'"||Ve==="`"||Be==='"'||Be==="'"||Be==="`")&&Ve!==Be)throw new s("property names with quotes must have matching quotes");if((It==="constructor"||!qe)&&(ze=!0),ye+="."+It,Qe="%"+ye+"%",Ee(ae,Qe))$e=ae[Qe];else if($e!=null){if(!(It in $e)){if(!F)throw new o("base intrinsic for "+se+" exists, but the property is not available.");return}if(C&&Oe+1>=z.length){var et=C($e,It);qe=!!et,qe&&"get"in et&&!("originalValue"in et.get)?$e=et.get:$e=$e[It]}else qe=Ee($e,It),$e=$e[It];qe&&!ze&&(ae[Qe]=$e)}}return $e},tA}var nA,VL;function mm(){if(VL)return nA;VL=1;var n=j3(),e=OI(),t=e([n("%String.prototype.indexOf%")]);return nA=function(i,a){var s=n(i,!!a);return typeof s=="function"&&t(i,".prototype.")>-1?e([s]):s},nA}var rA,zL;function KQ(){if(zL)return rA;zL=1;var n=ob()(),e=mm(),t=e("Object.prototype.toString"),r=function(o){return n&&o&&typeof o=="object"&&Symbol.toStringTag in o?!1:t(o)==="[object Arguments]"},i=function(o){return r(o)?!0:o!==null&&typeof o=="object"&&"length"in o&&typeof o.length=="number"&&o.length>=0&&t(o)!=="[object Array]"&&"callee"in o&&t(o.callee)==="[object Function]"},a=function(){return r(arguments)}();return r.isLegacyArguments=i,rA=a?r:i,rA}var iA,HL;function JQ(){if(HL)return iA;HL=1;var n=mm(),e=ob()(),t=U3(),r=gd(),i;if(e){var a=n("RegExp.prototype.exec"),s={},o=function(){throw s},u={toString:o,valueOf:o};typeof Symbol.toPrimitive=="symbol"&&(u[Symbol.toPrimitive]=o),i=function(m){if(!m||typeof m!="object")return!1;var y=r(m,"lastIndex"),b=y&&t(y,"value");if(!b)return!1;try{a(m,u)}catch(w){return w===s}}}else{var c=n("Object.prototype.toString"),d="[object RegExp]";i=function(m){return!m||typeof m!="object"&&typeof m!="function"?!1:c(m)===d}}return iA=i,iA}var aA,GL;function YQ(){if(GL)return aA;GL=1;var n=mm(),e=JQ(),t=n("RegExp.prototype.exec"),r=hm();return aA=function(a){if(!e(a))throw new r("`regex` must be a RegExp");return function(o){return t(a,o)!==null}},aA}var sA,WL;function ZQ(){if(WL)return sA;WL=1;var n=mm(),e=YQ(),t=e(/^\s*(?:function)?\*/),r=ob()(),i=NI(),a=n("Object.prototype.toString"),s=n("Function.prototype.toString"),o=function(){if(!r)return!1;try{return Function("return function*() {}")()}catch{}},u;return sA=function(d){if(typeof d!="function")return!1;if(t(s(d)))return!0;if(!r){var p=a(d);return p==="[object GeneratorFunction]"}if(!i)return!1;if(typeof u>"u"){var m=o();u=m?i(m):!1}return i(d)===u},sA}var oA,KL;function XQ(){if(KL)return oA;KL=1;var n=Function.prototype.toString,e=typeof Reflect=="object"&&Reflect!==null&&Reflect.apply,t,r;if(typeof e=="function"&&typeof Object.defineProperty=="function")try{t=Object.defineProperty({},"length",{get:function(){throw r}}),r={},e(function(){throw 42},null,t)}catch(C){C!==r&&(e=null)}else e=null;var i=/^\s*class\b/,a=function(A){try{var I=n.call(A);return i.test(I)}catch{return!1}},s=function(A){try{return a(A)?!1:(n.call(A),!0)}catch{return!1}},o=Object.prototype.toString,u="[object Object]",c="[object Function]",d="[object GeneratorFunction]",p="[object HTMLAllCollection]",m="[object HTML document.all class]",y="[object HTMLCollection]",b=typeof Symbol=="function"&&!!Symbol.toStringTag,w=!(0 in[,]),S=function(){return!1};if(typeof document=="object"){var T=document.all;o.call(T)===o.call(document.all)&&(S=function(A){if((w||!A)&&(typeof A>"u"||typeof A=="object"))try{var I=o.call(A);return(I===p||I===m||I===y||I===u)&&A("")==null}catch{}return!1})}return oA=e?function(A){if(S(A))return!0;if(!A||typeof A!="function"&&typeof A!="object")return!1;try{e(A,null,t)}catch(I){if(I!==r)return!1}return!a(A)&&s(A)}:function(A){if(S(A))return!0;if(!A||typeof A!="function"&&typeof A!="object")return!1;if(b)return s(A);if(a(A))return!1;var I=o.call(A);return I!==c&&I!==d&&!/^\[object HTML/.test(I)?!1:s(A)},oA}var lA,JL;function QQ(){if(JL)return lA;JL=1;var n=XQ(),e=Object.prototype.toString,t=Object.prototype.hasOwnProperty,r=function(u,c,d){for(var p=0,m=u.length;p<m;p++)t.call(u,p)&&(d==null?c(u[p],p,u):c.call(d,u[p],p,u))},i=function(u,c,d){for(var p=0,m=u.length;p<m;p++)d==null?c(u.charAt(p),p,u):c.call(d,u.charAt(p),p,u)},a=function(u,c,d){for(var p in u)t.call(u,p)&&(d==null?c(u[p],p,u):c.call(d,u[p],p,u))};function s(o){return e.call(o)==="[object Array]"}return lA=function(u,c,d){if(!n(c))throw new TypeError("iterator must be a function");var p;arguments.length>=3&&(p=d),s(u)?r(u,c,p):typeof u=="string"?i(u,c,p):a(u,c,p)},lA}var uA,YL;function eee(){return YL||(YL=1,uA=["Float16Array","Float32Array","Float64Array","Int8Array","Int16Array","Int32Array","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","BigInt64Array","BigUint64Array"]),uA}var cA,ZL;function tee(){if(ZL)return cA;ZL=1;var n=eee(),e=typeof globalThis>"u"?window:globalThis;return cA=function(){for(var r=[],i=0;i<n.length;i++)typeof e[n[i]]=="function"&&(r[r.length]=n[i]);return r},cA}var fA={exports:{}},dA,XL;function nee(){if(XL)return dA;XL=1;var n=lb(),e=M3(),t=hm(),r=gd();return dA=function(a,s,o){if(!a||typeof a!="object"&&typeof a!="function")throw new t("`obj` must be an object or a function`");if(typeof s!="string"&&typeof s!="symbol")throw new t("`property` must be a string or a symbol`");if(arguments.length>3&&typeof arguments[3]!="boolean"&&arguments[3]!==null)throw new t("`nonEnumerable`, if provided, must be a boolean or null");if(arguments.length>4&&typeof arguments[4]!="boolean"&&arguments[4]!==null)throw new t("`nonWritable`, if provided, must be a boolean or null");if(arguments.length>5&&typeof arguments[5]!="boolean"&&arguments[5]!==null)throw new t("`nonConfigurable`, if provided, must be a boolean or null");if(arguments.length>6&&typeof arguments[6]!="boolean")throw new t("`loose`, if provided, must be a boolean");var u=arguments.length>3?arguments[3]:null,c=arguments.length>4?arguments[4]:null,d=arguments.length>5?arguments[5]:null,p=arguments.length>6?arguments[6]:!1,m=!!r&&r(a,s);if(n)n(a,s,{configurable:d===null&&m?m.configurable:!d,enumerable:u===null&&m?m.enumerable:!u,value:o,writable:c===null&&m?m.writable:!c});else if(p||!u&&!c&&!d)a[s]=o;else throw new e("This environment does not support defining a property as non-configurable, non-writable, or non-enumerable.")},dA}var hA,QL;function ree(){if(QL)return hA;QL=1;var n=lb(),e=function(){return!!n};return e.hasArrayLengthDefineBug=function(){if(!n)return null;try{return n([],"length",{value:1}).length!==1}catch{return!0}},hA=e,hA}var pA,eU;function iee(){if(eU)return pA;eU=1;var n=j3(),e=nee(),t=ree()(),r=gd(),i=hm(),a=n("%Math.floor%");return pA=function(o,u){if(typeof o!="function")throw new i("`fn` is not a function");if(typeof u!="number"||u<0||u>4294967295||a(u)!==u)throw new i("`length` must be a positive 32-bit integer");var c=arguments.length>2&&!!arguments[2],d=!0,p=!0;if("length"in o&&r){var m=r(o,"length");m&&!m.configurable&&(d=!1),m&&!m.writable&&(p=!1)}return(d||p||!c)&&(t?e(o,"length",u,!0,!0):e(o,"length",u)),o},pA}var mA,tU;function aee(){if(tU)return mA;tU=1;var n=pm(),e=xI(),t=L3();return mA=function(){return t(n,e,arguments)},mA}var nU;function see(){return nU||(nU=1,function(n){var e=iee(),t=lb(),r=OI(),i=aee();n.exports=function(s){var o=r(arguments),u=s.length-(arguments.length-1);return e(o,1+(u>0?u:0),!0)},t?t(n.exports,"apply",{value:i}):n.exports.apply=i}(fA)),fA.exports}var gA,rU;function F3(){if(rU)return gA;rU=1;var n=QQ(),e=tee(),t=see(),r=mm(),i=gd(),a=NI(),s=r("Object.prototype.toString"),o=ob()(),u=typeof globalThis>"u"?window:globalThis,c=e(),d=r("String.prototype.slice"),p=r("Array.prototype.indexOf",!0)||function(S,T){for(var C=0;C<S.length;C+=1)if(S[C]===T)return C;return-1},m={__proto__:null};o&&i&&a?n(c,function(w){var S=new u[w];if(Symbol.toStringTag in S&&a){var T=a(S),C=i(T,Symbol.toStringTag);if(!C&&T){var A=a(T);C=i(A,Symbol.toStringTag)}m["$"+w]=t(C.get)}}):n(c,function(w){var S=new u[w],T=S.slice||S.set;T&&(m["$"+w]=t(T))});var y=function(S){var T=!1;return n(m,function(C,A){if(!T)try{"$"+C(S)===A&&(T=d(A,1))}catch{}}),T},b=function(S){var T=!1;return n(m,function(C,A){if(!T)try{C(S),T=d(A,1)}catch{}}),T};return gA=function(S){if(!S||typeof S!="object")return!1;if(!o){var T=d(s(S),8,-1);return p(c,T)>-1?T:T!=="Object"?!1:b(S)}return i?y(S):null},gA}var yA,iU;function oee(){if(iU)return yA;iU=1;var n=F3();return yA=function(t){return!!n(t)},yA}var aU;function lee(){return aU||(aU=1,function(n){var e=KQ(),t=ZQ(),r=F3(),i=oee();function a(Oe){return Oe.call.bind(Oe)}var s=typeof BigInt<"u",o=typeof Symbol<"u",u=a(Object.prototype.toString),c=a(Number.prototype.valueOf),d=a(String.prototype.valueOf),p=a(Boolean.prototype.valueOf);if(s)var m=a(BigInt.prototype.valueOf);if(o)var y=a(Symbol.prototype.valueOf);function b(Oe,qe){if(typeof Oe!="object")return!1;try{return qe(Oe),!0}catch{return!1}}n.isArgumentsObject=e,n.isGeneratorFunction=t,n.isTypedArray=i;function w(Oe){return typeof Promise<"u"&&Oe instanceof Promise||Oe!==null&&typeof Oe=="object"&&typeof Oe.then=="function"&&typeof Oe.catch=="function"}n.isPromise=w;function S(Oe){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(Oe):i(Oe)||Q(Oe)}n.isArrayBufferView=S;function T(Oe){return r(Oe)==="Uint8Array"}n.isUint8Array=T;function C(Oe){return r(Oe)==="Uint8ClampedArray"}n.isUint8ClampedArray=C;function A(Oe){return r(Oe)==="Uint16Array"}n.isUint16Array=A;function I(Oe){return r(Oe)==="Uint32Array"}n.isUint32Array=I;function x(Oe){return r(Oe)==="Int8Array"}n.isInt8Array=x;function L(Oe){return r(Oe)==="Int16Array"}n.isInt16Array=L;function U(Oe){return r(Oe)==="Int32Array"}n.isInt32Array=U;function N(Oe){return r(Oe)==="Float32Array"}n.isFloat32Array=N;function B(Oe){return r(Oe)==="Float64Array"}n.isFloat64Array=B;function q(Oe){return r(Oe)==="BigInt64Array"}n.isBigInt64Array=q;function J(Oe){return r(Oe)==="BigUint64Array"}n.isBigUint64Array=J;function V(Oe){return u(Oe)==="[object Map]"}V.working=typeof Map<"u"&&V(new Map);function de(Oe){return typeof Map>"u"?!1:V.working?V(Oe):Oe instanceof Map}n.isMap=de;function ae(Oe){return u(Oe)==="[object Set]"}ae.working=typeof Set<"u"&&ae(new Set);function ue(Oe){return typeof Set>"u"?!1:ae.working?ae(Oe):Oe instanceof Set}n.isSet=ue;function te(Oe){return u(Oe)==="[object WeakMap]"}te.working=typeof WeakMap<"u"&&te(new WeakMap);function oe(Oe){return typeof WeakMap>"u"?!1:te.working?te(Oe):Oe instanceof WeakMap}n.isWeakMap=oe;function ge(Oe){return u(Oe)==="[object WeakSet]"}ge.working=typeof WeakSet<"u"&&ge(new WeakSet);function Ee(Oe){return ge(Oe)}n.isWeakSet=Ee;function Y(Oe){return u(Oe)==="[object ArrayBuffer]"}Y.working=typeof ArrayBuffer<"u"&&Y(new ArrayBuffer);function ve(Oe){return typeof ArrayBuffer>"u"?!1:Y.working?Y(Oe):Oe instanceof ArrayBuffer}n.isArrayBuffer=ve;function Re(Oe){return u(Oe)==="[object DataView]"}Re.working=typeof ArrayBuffer<"u"&&typeof DataView<"u"&&Re(new DataView(new ArrayBuffer(1),0,1));function Q(Oe){return typeof DataView>"u"?!1:Re.working?Re(Oe):Oe instanceof DataView}n.isDataView=Q;var ie=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:void 0;function ce(Oe){return u(Oe)==="[object SharedArrayBuffer]"}function P(Oe){return typeof ie>"u"?!1:(typeof ce.working>"u"&&(ce.working=ce(new ie)),ce.working?ce(Oe):Oe instanceof ie)}n.isSharedArrayBuffer=P;function O(Oe){return u(Oe)==="[object AsyncFunction]"}n.isAsyncFunction=O;function K(Oe){return u(Oe)==="[object Map Iterator]"}n.isMapIterator=K;function X(Oe){return u(Oe)==="[object Set Iterator]"}n.isSetIterator=X;function se(Oe){return u(Oe)==="[object Generator]"}n.isGeneratorObject=se;function F(Oe){return u(Oe)==="[object WebAssembly.Module]"}n.isWebAssemblyCompiledModule=F;function z(Oe){return b(Oe,c)}n.isNumberObject=z;function ye(Oe){return b(Oe,d)}n.isStringObject=ye;function ke(Oe){return b(Oe,p)}n.isBooleanObject=ke;function Qe(Oe){return s&&b(Oe,m)}n.isBigIntObject=Qe;function $e(Oe){return o&&b(Oe,y)}n.isSymbolObject=$e;function ze(Oe){return z(Oe)||ye(Oe)||ke(Oe)||Qe(Oe)||$e(Oe)}n.isBoxedPrimitive=ze;function xt(Oe){return typeof Uint8Array<"u"&&(ve(Oe)||P(Oe))}n.isAnyArrayBuffer=xt,["isProxy","isExternal","isModuleNamespaceObject"].forEach(function(Oe){Object.defineProperty(n,Oe,{enumerable:!1,value:function(){throw new Error(Oe+" is not supported in userland")}})})}(bT)),bT}var vA,sU;function uee(){return sU||(sU=1,vA=function(e){return e&&typeof e=="object"&&typeof e.copy=="function"&&typeof e.fill=="function"&&typeof e.readUInt8=="function"}),vA}var oU;function B3(){return oU||(oU=1,function(n){var e={},t=Object.getOwnPropertyDescriptors||function(ie){for(var ce=Object.keys(ie),P={},O=0;O<ce.length;O++)P[ce[O]]=Object.getOwnPropertyDescriptor(ie,ce[O]);return P},r=/%[sdj%]/g;n.format=function(Q){if(!L(Q)){for(var ie=[],ce=0;ce<arguments.length;ce++)ie.push(o(arguments[ce]));return ie.join(" ")}for(var ce=1,P=arguments,O=P.length,K=String(Q).replace(r,function(se){if(se==="%%")return"%";if(ce>=O)return se;switch(se){case"%s":return String(P[ce++]);case"%d":return Number(P[ce++]);case"%j":try{return JSON.stringify(P[ce++])}catch{return"[Circular]"}default:return se}}),X=P[ce];ce<O;X=P[++ce])A(X)||!q(X)?K+=" "+X:K+=" "+o(X);return K},n.deprecate=function(Q,ie){if(typeof at<"u"&&at.noDeprecation===!0)return Q;if(typeof at>"u")return function(){return n.deprecate(Q,ie).apply(this,arguments)};var ce=!1;function P(){if(!ce){if(at.throwDeprecation)throw new Error(ie);at.traceDeprecation?console.trace(ie):console.error(ie),ce=!0}return Q.apply(this,arguments)}return P};var i={},a=/^$/;if(e.NODE_DEBUG){var s=e.NODE_DEBUG;s=s.replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^").toUpperCase(),a=new RegExp("^"+s+"$","i")}n.debuglog=function(Q){if(Q=Q.toUpperCase(),!i[Q])if(a.test(Q)){var ie=at.pid;i[Q]=function(){var ce=n.format.apply(n,arguments);console.error("%s %d: %s",Q,ie,ce)}}else i[Q]=function(){};return i[Q]};function o(Q,ie){var ce={seen:[],stylize:c};return arguments.length>=3&&(ce.depth=arguments[2]),arguments.length>=4&&(ce.colors=arguments[3]),C(ie)?ce.showHidden=ie:ie&&n._extend(ce,ie),N(ce.showHidden)&&(ce.showHidden=!1),N(ce.depth)&&(ce.depth=2),N(ce.colors)&&(ce.colors=!1),N(ce.customInspect)&&(ce.customInspect=!0),ce.colors&&(ce.stylize=u),p(ce,Q,ce.depth)}n.inspect=o,o.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},o.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"};function u(Q,ie){var ce=o.styles[ie];return ce?"\x1B["+o.colors[ce][0]+"m"+Q+"\x1B["+o.colors[ce][1]+"m":Q}function c(Q,ie){return Q}function d(Q){var ie={};return Q.forEach(function(ce,P){ie[ce]=!0}),ie}function p(Q,ie,ce){if(Q.customInspect&&ie&&de(ie.inspect)&&ie.inspect!==n.inspect&&!(ie.constructor&&ie.constructor.prototype===ie)){var P=ie.inspect(ce,Q);return L(P)||(P=p(Q,P,ce)),P}var O=m(Q,ie);if(O)return O;var K=Object.keys(ie),X=d(K);if(Q.showHidden&&(K=Object.getOwnPropertyNames(ie)),V(ie)&&(K.indexOf("message")>=0||K.indexOf("description")>=0))return y(ie);if(K.length===0){if(de(ie)){var se=ie.name?": "+ie.name:"";return Q.stylize("[Function"+se+"]","special")}if(B(ie))return Q.stylize(RegExp.prototype.toString.call(ie),"regexp");if(J(ie))return Q.stylize(Date.prototype.toString.call(ie),"date");if(V(ie))return y(ie)}var F="",z=!1,ye=["{","}"];if(T(ie)&&(z=!0,ye=["[","]"]),de(ie)){var ke=ie.name?": "+ie.name:"";F=" [Function"+ke+"]"}if(B(ie)&&(F=" "+RegExp.prototype.toString.call(ie)),J(ie)&&(F=" "+Date.prototype.toUTCString.call(ie)),V(ie)&&(F=" "+y(ie)),K.length===0&&(!z||ie.length==0))return ye[0]+F+ye[1];if(ce<0)return B(ie)?Q.stylize(RegExp.prototype.toString.call(ie),"regexp"):Q.stylize("[Object]","special");Q.seen.push(ie);var Qe;return z?Qe=b(Q,ie,ce,X,K):Qe=K.map(function($e){return w(Q,ie,ce,X,$e,z)}),Q.seen.pop(),S(Qe,F,ye)}function m(Q,ie){if(N(ie))return Q.stylize("undefined","undefined");if(L(ie)){var ce="'"+JSON.stringify(ie).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return Q.stylize(ce,"string")}if(x(ie))return Q.stylize(""+ie,"number");if(C(ie))return Q.stylize(""+ie,"boolean");if(A(ie))return Q.stylize("null","null")}function y(Q){return"["+Error.prototype.toString.call(Q)+"]"}function b(Q,ie,ce,P,O){for(var K=[],X=0,se=ie.length;X<se;++X)Ee(ie,String(X))?K.push(w(Q,ie,ce,P,String(X),!0)):K.push("");return O.forEach(function(F){F.match(/^\d+$/)||K.push(w(Q,ie,ce,P,F,!0))}),K}function w(Q,ie,ce,P,O,K){var X,se,F;if(F=Object.getOwnPropertyDescriptor(ie,O)||{value:ie[O]},F.get?F.set?se=Q.stylize("[Getter/Setter]","special"):se=Q.stylize("[Getter]","special"):F.set&&(se=Q.stylize("[Setter]","special")),Ee(P,O)||(X="["+O+"]"),se||(Q.seen.indexOf(F.value)<0?(A(ce)?se=p(Q,F.value,null):se=p(Q,F.value,ce-1),se.indexOf(`
`)>-1&&(K?se=se.split(`
`).map(function(z){return"  "+z}).join(`
`).slice(2):se=`
`+se.split(`
`).map(function(z){return"   "+z}).join(`
`))):se=Q.stylize("[Circular]","special")),N(X)){if(K&&O.match(/^\d+$/))return se;X=JSON.stringify(""+O),X.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(X=X.slice(1,-1),X=Q.stylize(X,"name")):(X=X.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),X=Q.stylize(X,"string"))}return X+": "+se}function S(Q,ie,ce){var P=Q.reduce(function(O,K){return K.indexOf(`
`)>=0,O+K.replace(/\u001b\[\d\d?m/g,"").length+1},0);return P>60?ce[0]+(ie===""?"":ie+`
 `)+" "+Q.join(`,
  `)+" "+ce[1]:ce[0]+ie+" "+Q.join(", ")+" "+ce[1]}n.types=lee();function T(Q){return Array.isArray(Q)}n.isArray=T;function C(Q){return typeof Q=="boolean"}n.isBoolean=C;function A(Q){return Q===null}n.isNull=A;function I(Q){return Q==null}n.isNullOrUndefined=I;function x(Q){return typeof Q=="number"}n.isNumber=x;function L(Q){return typeof Q=="string"}n.isString=L;function U(Q){return typeof Q=="symbol"}n.isSymbol=U;function N(Q){return Q===void 0}n.isUndefined=N;function B(Q){return q(Q)&&ue(Q)==="[object RegExp]"}n.isRegExp=B,n.types.isRegExp=B;function q(Q){return typeof Q=="object"&&Q!==null}n.isObject=q;function J(Q){return q(Q)&&ue(Q)==="[object Date]"}n.isDate=J,n.types.isDate=J;function V(Q){return q(Q)&&(ue(Q)==="[object Error]"||Q instanceof Error)}n.isError=V,n.types.isNativeError=V;function de(Q){return typeof Q=="function"}n.isFunction=de;function ae(Q){return Q===null||typeof Q=="boolean"||typeof Q=="number"||typeof Q=="string"||typeof Q=="symbol"||typeof Q>"u"}n.isPrimitive=ae,n.isBuffer=uee();function ue(Q){return Object.prototype.toString.call(Q)}function te(Q){return Q<10?"0"+Q.toString(10):Q.toString(10)}var oe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function ge(){var Q=new Date,ie=[te(Q.getHours()),te(Q.getMinutes()),te(Q.getSeconds())].join(":");return[Q.getDate(),oe[Q.getMonth()],ie].join(" ")}n.log=function(){console.log("%s - %s",ge(),n.format.apply(n,arguments))},n.inherits=fc(),n._extend=function(Q,ie){if(!ie||!q(ie))return Q;for(var ce=Object.keys(ie),P=ce.length;P--;)Q[ce[P]]=ie[ce[P]];return Q};function Ee(Q,ie){return Object.prototype.hasOwnProperty.call(Q,ie)}var Y=typeof Symbol<"u"?Symbol("util.promisify.custom"):void 0;n.promisify=function(ie){if(typeof ie!="function")throw new TypeError('The "original" argument must be of type Function');if(Y&&ie[Y]){var ce=ie[Y];if(typeof ce!="function")throw new TypeError('The "util.promisify.custom" argument must be of type Function');return Object.defineProperty(ce,Y,{value:ce,enumerable:!1,writable:!1,configurable:!0}),ce}function ce(){for(var P,O,K=new Promise(function(F,z){P=F,O=z}),X=[],se=0;se<arguments.length;se++)X.push(arguments[se]);X.push(function(F,z){F?O(F):P(z)});try{ie.apply(this,X)}catch(F){O(F)}return K}return Object.setPrototypeOf(ce,Object.getPrototypeOf(ie)),Y&&Object.defineProperty(ce,Y,{value:ce,enumerable:!1,writable:!1,configurable:!0}),Object.defineProperties(ce,t(ie))},n.promisify.custom=Y;function ve(Q,ie){if(!Q){var ce=new Error("Promise was rejected with a falsy value");ce.reason=Q,Q=ce}return ie(Q)}function Re(Q){if(typeof Q!="function")throw new TypeError('The "original" argument must be of type Function');function ie(){for(var ce=[],P=0;P<arguments.length;P++)ce.push(arguments[P]);var O=ce.pop();if(typeof O!="function")throw new TypeError("The last argument must be of type Function");var K=this,X=function(){return O.apply(K,arguments)};Q.apply(this,ce).then(function(se){at.nextTick(X.bind(null,null,se))},function(se){at.nextTick(ve.bind(null,se,X))})}return Object.setPrototypeOf(ie,Object.getPrototypeOf(Q)),Object.defineProperties(ie,t(Q)),ie}n.callbackify=Re}(_T)),_T}var _A,lU;function cee(){if(lU)return _A;lU=1;function n(b,w){var S=Object.keys(b);if(Object.getOwnPropertySymbols){var T=Object.getOwnPropertySymbols(b);w&&(T=T.filter(function(C){return Object.getOwnPropertyDescriptor(b,C).enumerable})),S.push.apply(S,T)}return S}function e(b){for(var w=1;w<arguments.length;w++){var S=arguments[w]!=null?arguments[w]:{};w%2?n(Object(S),!0).forEach(function(T){t(b,T,S[T])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(S)):n(Object(S)).forEach(function(T){Object.defineProperty(b,T,Object.getOwnPropertyDescriptor(S,T))})}return b}function t(b,w,S){return w=s(w),w in b?Object.defineProperty(b,w,{value:S,enumerable:!0,configurable:!0,writable:!0}):b[w]=S,b}function r(b,w){if(!(b instanceof w))throw new TypeError("Cannot call a class as a function")}function i(b,w){for(var S=0;S<w.length;S++){var T=w[S];T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(b,s(T.key),T)}}function a(b,w,S){return w&&i(b.prototype,w),Object.defineProperty(b,"prototype",{writable:!1}),b}function s(b){var w=o(b,"string");return typeof w=="symbol"?w:String(w)}function o(b,w){if(typeof b!="object"||b===null)return b;var S=b[Symbol.toPrimitive];if(S!==void 0){var T=S.call(b,w);if(typeof T!="object")return T;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(b)}var u=sb(),c=u.Buffer,d=B3(),p=d.inspect,m=p&&p.custom||"inspect";function y(b,w,S){c.prototype.copy.call(b,w,S)}return _A=function(){function b(){r(this,b),this.head=null,this.tail=null,this.length=0}return a(b,[{key:"push",value:function(S){var T={data:S,next:null};this.length>0?this.tail.next=T:this.head=T,this.tail=T,++this.length}},{key:"unshift",value:function(S){var T={data:S,next:this.head};this.length===0&&(this.tail=T),this.head=T,++this.length}},{key:"shift",value:function(){if(this.length!==0){var S=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,S}}},{key:"clear",value:function(){this.head=this.tail=null,this.length=0}},{key:"join",value:function(S){if(this.length===0)return"";for(var T=this.head,C=""+T.data;T=T.next;)C+=S+T.data;return C}},{key:"concat",value:function(S){if(this.length===0)return c.alloc(0);for(var T=c.allocUnsafe(S>>>0),C=this.head,A=0;C;)y(C.data,T,A),A+=C.data.length,C=C.next;return T}},{key:"consume",value:function(S,T){var C;return S<this.head.data.length?(C=this.head.data.slice(0,S),this.head.data=this.head.data.slice(S)):S===this.head.data.length?C=this.shift():C=T?this._getString(S):this._getBuffer(S),C}},{key:"first",value:function(){return this.head.data}},{key:"_getString",value:function(S){var T=this.head,C=1,A=T.data;for(S-=A.length;T=T.next;){var I=T.data,x=S>I.length?I.length:S;if(x===I.length?A+=I:A+=I.slice(0,S),S-=x,S===0){x===I.length?(++C,T.next?this.head=T.next:this.head=this.tail=null):(this.head=T,T.data=I.slice(x));break}++C}return this.length-=C,A}},{key:"_getBuffer",value:function(S){var T=c.allocUnsafe(S),C=this.head,A=1;for(C.data.copy(T),S-=C.data.length;C=C.next;){var I=C.data,x=S>I.length?I.length:S;if(I.copy(T,T.length-S,0,x),S-=x,S===0){x===I.length?(++A,C.next?this.head=C.next:this.head=this.tail=null):(this.head=C,C.data=I.slice(x));break}++A}return this.length-=A,T}},{key:m,value:function(S,T){return p(this,e(e({},T),{},{depth:0,customInspect:!1}))}}]),b}(),_A}var bA,uU;function q3(){if(uU)return bA;uU=1;function n(s,o){var u=this,c=this._readableState&&this._readableState.destroyed,d=this._writableState&&this._writableState.destroyed;return c||d?(o?o(s):s&&(this._writableState?this._writableState.errorEmitted||(this._writableState.errorEmitted=!0,at.nextTick(i,this,s)):at.nextTick(i,this,s)),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(s||null,function(p){!o&&p?u._writableState?u._writableState.errorEmitted?at.nextTick(t,u):(u._writableState.errorEmitted=!0,at.nextTick(e,u,p)):at.nextTick(e,u,p):o?(at.nextTick(t,u),o(p)):at.nextTick(t,u)}),this)}function e(s,o){i(s,o),t(s)}function t(s){s._writableState&&!s._writableState.emitClose||s._readableState&&!s._readableState.emitClose||s.emit("close")}function r(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}function i(s,o){s.emit("error",o)}function a(s,o){var u=s._readableState,c=s._writableState;u&&u.autoDestroy||c&&c.autoDestroy?s.destroy(o):s.emit("error",o)}return bA={destroy:n,undestroy:r,errorOrDestroy:a},bA}var wA={},cU;function yd(){if(cU)return wA;cU=1;function n(o,u){o.prototype=Object.create(u.prototype),o.prototype.constructor=o,o.__proto__=u}var e={};function t(o,u,c){c||(c=Error);function d(m,y,b){return typeof u=="string"?u:u(m,y,b)}var p=function(m){n(y,m);function y(b,w,S){return m.call(this,d(b,w,S))||this}return y}(c);p.prototype.name=c.name,p.prototype.code=o,e[o]=p}function r(o,u){if(Array.isArray(o)){var c=o.length;return o=o.map(function(d){return String(d)}),c>2?"one of ".concat(u," ").concat(o.slice(0,c-1).join(", "),", or ")+o[c-1]:c===2?"one of ".concat(u," ").concat(o[0]," or ").concat(o[1]):"of ".concat(u," ").concat(o[0])}else return"of ".concat(u," ").concat(String(o))}function i(o,u,c){return o.substr(0,u.length)===u}function a(o,u,c){return(c===void 0||c>o.length)&&(c=o.length),o.substring(c-u.length,c)===u}function s(o,u,c){return typeof c!="number"&&(c=0),c+u.length>o.length?!1:o.indexOf(u,c)!==-1}return t("ERR_INVALID_OPT_VALUE",function(o,u){return'The value "'+u+'" is invalid for option "'+o+'"'},TypeError),t("ERR_INVALID_ARG_TYPE",function(o,u,c){var d;typeof u=="string"&&i(u,"not ")?(d="must not be",u=u.replace(/^not /,"")):d="must be";var p;if(a(o," argument"))p="The ".concat(o," ").concat(d," ").concat(r(u,"type"));else{var m=s(o,".")?"property":"argument";p='The "'.concat(o,'" ').concat(m," ").concat(d," ").concat(r(u,"type"))}return p+=". Received type ".concat(typeof c),p},TypeError),t("ERR_STREAM_PUSH_AFTER_EOF","stream.push() after EOF"),t("ERR_METHOD_NOT_IMPLEMENTED",function(o){return"The "+o+" method is not implemented"}),t("ERR_STREAM_PREMATURE_CLOSE","Premature close"),t("ERR_STREAM_DESTROYED",function(o){return"Cannot call "+o+" after a stream was destroyed"}),t("ERR_MULTIPLE_CALLBACK","Callback called multiple times"),t("ERR_STREAM_CANNOT_PIPE","Cannot pipe, not readable"),t("ERR_STREAM_WRITE_AFTER_END","write after end"),t("ERR_STREAM_NULL_VALUES","May not write null values to stream",TypeError),t("ERR_UNKNOWN_ENCODING",function(o){return"Unknown encoding: "+o},TypeError),t("ERR_STREAM_UNSHIFT_AFTER_END_EVENT","stream.unshift() after end event"),wA.codes=e,wA}var EA,fU;function V3(){if(fU)return EA;fU=1;var n=yd().codes.ERR_INVALID_OPT_VALUE;function e(r,i,a){return r.highWaterMark!=null?r.highWaterMark:i?r[a]:null}function t(r,i,a,s){var o=e(i,s,a);if(o!=null){if(!(isFinite(o)&&Math.floor(o)===o)||o<0){var u=s?a:"highWaterMark";throw new n(u,o)}return Math.floor(o)}return r.objectMode?16:16*1024}return EA={getHighWaterMark:t},EA}var SA,dU;function fee(){if(dU)return SA;dU=1,SA=n;function n(t,r){if(e("noDeprecation"))return t;var i=!1;function a(){if(!i){if(e("throwDeprecation"))throw new Error(r);e("traceDeprecation")?console.trace(r):console.warn(r),i=!0}return t.apply(this,arguments)}return a}function e(t){try{if(!window.localStorage)return!1}catch{return!1}var r=window.localStorage[t];return r==null?!1:String(r).toLowerCase()==="true"}return SA}var TA,hU;function z3(){if(hU)return TA;hU=1,TA=N;function n(P){var O=this;this.next=null,this.entry=null,this.finish=function(){ce(O,P)}}var e;N.WritableState=L;var t={deprecate:fee()},r=O3(),i=sb().Buffer,a=(typeof window<"u"||typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function s(P){return i.from(P)}function o(P){return i.isBuffer(P)||P instanceof a}var u=q3(),c=V3(),d=c.getHighWaterMark,p=yd().codes,m=p.ERR_INVALID_ARG_TYPE,y=p.ERR_METHOD_NOT_IMPLEMENTED,b=p.ERR_MULTIPLE_CALLBACK,w=p.ERR_STREAM_CANNOT_PIPE,S=p.ERR_STREAM_DESTROYED,T=p.ERR_STREAM_NULL_VALUES,C=p.ERR_STREAM_WRITE_AFTER_END,A=p.ERR_UNKNOWN_ENCODING,I=u.errorOrDestroy;fc()(N,r);function x(){}function L(P,O,K){e=e||nd(),P=P||{},typeof K!="boolean"&&(K=O instanceof e),this.objectMode=!!P.objectMode,K&&(this.objectMode=this.objectMode||!!P.writableObjectMode),this.highWaterMark=d(this,P,"writableHighWaterMark",K),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var X=P.decodeStrings===!1;this.decodeStrings=!X,this.defaultEncoding=P.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(se){te(O,se)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=P.emitClose!==!1,this.autoDestroy=!!P.autoDestroy,this.bufferedRequestCount=0,this.corkedRequestsFree=new n(this)}L.prototype.getBuffer=function(){for(var O=this.bufferedRequest,K=[];O;)K.push(O),O=O.next;return K},function(){try{Object.defineProperty(L.prototype,"buffer",{get:t.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch{}}();var U;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(U=Function.prototype[Symbol.hasInstance],Object.defineProperty(N,Symbol.hasInstance,{value:function(O){return U.call(this,O)?!0:this!==N?!1:O&&O._writableState instanceof L}})):U=function(O){return O instanceof this};function N(P){e=e||nd();var O=this instanceof e;if(!O&&!U.call(N,this))return new N(P);this._writableState=new L(P,this,O),this.writable=!0,P&&(typeof P.write=="function"&&(this._write=P.write),typeof P.writev=="function"&&(this._writev=P.writev),typeof P.destroy=="function"&&(this._destroy=P.destroy),typeof P.final=="function"&&(this._final=P.final)),r.call(this)}N.prototype.pipe=function(){I(this,new w)};function B(P,O){var K=new C;I(P,K),at.nextTick(O,K)}function q(P,O,K,X){var se;return K===null?se=new T:typeof K!="string"&&!O.objectMode&&(se=new m("chunk",["string","Buffer"],K)),se?(I(P,se),at.nextTick(X,se),!1):!0}N.prototype.write=function(P,O,K){var X=this._writableState,se=!1,F=!X.objectMode&&o(P);return F&&!i.isBuffer(P)&&(P=s(P)),typeof O=="function"&&(K=O,O=null),F?O="buffer":O||(O=X.defaultEncoding),typeof K!="function"&&(K=x),X.ending?B(this,K):(F||q(this,X,P,K))&&(X.pendingcb++,se=V(this,X,F,P,O,K)),se},N.prototype.cork=function(){this._writableState.corked++},N.prototype.uncork=function(){var P=this._writableState;P.corked&&(P.corked--,!P.writing&&!P.corked&&!P.bufferProcessing&&P.bufferedRequest&&Ee(this,P))},N.prototype.setDefaultEncoding=function(O){if(typeof O=="string"&&(O=O.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((O+"").toLowerCase())>-1))throw new A(O);return this._writableState.defaultEncoding=O,this},Object.defineProperty(N.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}});function J(P,O,K){return!P.objectMode&&P.decodeStrings!==!1&&typeof O=="string"&&(O=i.from(O,K)),O}Object.defineProperty(N.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}});function V(P,O,K,X,se,F){if(!K){var z=J(O,X,se);X!==z&&(K=!0,se="buffer",X=z)}var ye=O.objectMode?1:X.length;O.length+=ye;var ke=O.length<O.highWaterMark;if(ke||(O.needDrain=!0),O.writing||O.corked){var Qe=O.lastBufferedRequest;O.lastBufferedRequest={chunk:X,encoding:se,isBuf:K,callback:F,next:null},Qe?Qe.next=O.lastBufferedRequest:O.bufferedRequest=O.lastBufferedRequest,O.bufferedRequestCount+=1}else de(P,O,!1,ye,X,se,F);return ke}function de(P,O,K,X,se,F,z){O.writelen=X,O.writecb=z,O.writing=!0,O.sync=!0,O.destroyed?O.onwrite(new S("write")):K?P._writev(se,O.onwrite):P._write(se,F,O.onwrite),O.sync=!1}function ae(P,O,K,X,se){--O.pendingcb,K?(at.nextTick(se,X),at.nextTick(Q,P,O),P._writableState.errorEmitted=!0,I(P,X)):(se(X),P._writableState.errorEmitted=!0,I(P,X),Q(P,O))}function ue(P){P.writing=!1,P.writecb=null,P.length-=P.writelen,P.writelen=0}function te(P,O){var K=P._writableState,X=K.sync,se=K.writecb;if(typeof se!="function")throw new b;if(ue(K),O)ae(P,K,X,O,se);else{var F=Y(K)||P.destroyed;!F&&!K.corked&&!K.bufferProcessing&&K.bufferedRequest&&Ee(P,K),X?at.nextTick(oe,P,K,F,se):oe(P,K,F,se)}}function oe(P,O,K,X){K||ge(P,O),O.pendingcb--,X(),Q(P,O)}function ge(P,O){O.length===0&&O.needDrain&&(O.needDrain=!1,P.emit("drain"))}function Ee(P,O){O.bufferProcessing=!0;var K=O.bufferedRequest;if(P._writev&&K&&K.next){var X=O.bufferedRequestCount,se=new Array(X),F=O.corkedRequestsFree;F.entry=K;for(var z=0,ye=!0;K;)se[z]=K,K.isBuf||(ye=!1),K=K.next,z+=1;se.allBuffers=ye,de(P,O,!0,O.length,se,"",F.finish),O.pendingcb++,O.lastBufferedRequest=null,F.next?(O.corkedRequestsFree=F.next,F.next=null):O.corkedRequestsFree=new n(O),O.bufferedRequestCount=0}else{for(;K;){var ke=K.chunk,Qe=K.encoding,$e=K.callback,ze=O.objectMode?1:ke.length;if(de(P,O,!1,ze,ke,Qe,$e),K=K.next,O.bufferedRequestCount--,O.writing)break}K===null&&(O.lastBufferedRequest=null)}O.bufferedRequest=K,O.bufferProcessing=!1}N.prototype._write=function(P,O,K){K(new y("_write()"))},N.prototype._writev=null,N.prototype.end=function(P,O,K){var X=this._writableState;return typeof P=="function"?(K=P,P=null,O=null):typeof O=="function"&&(K=O,O=null),P!=null&&this.write(P,O),X.corked&&(X.corked=1,this.uncork()),X.ending||ie(this,X,K),this},Object.defineProperty(N.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function Y(P){return P.ending&&P.length===0&&P.bufferedRequest===null&&!P.finished&&!P.writing}function ve(P,O){P._final(function(K){O.pendingcb--,K&&I(P,K),O.prefinished=!0,P.emit("prefinish"),Q(P,O)})}function Re(P,O){!O.prefinished&&!O.finalCalled&&(typeof P._final=="function"&&!O.destroyed?(O.pendingcb++,O.finalCalled=!0,at.nextTick(ve,P,O)):(O.prefinished=!0,P.emit("prefinish")))}function Q(P,O){var K=Y(O);if(K&&(Re(P,O),O.pendingcb===0&&(O.finished=!0,P.emit("finish"),O.autoDestroy))){var X=P._readableState;(!X||X.autoDestroy&&X.endEmitted)&&P.destroy()}return K}function ie(P,O,K){O.ending=!0,Q(P,O),K&&(O.finished?at.nextTick(K):P.once("finish",K)),O.ended=!0,P.writable=!1}function ce(P,O,K){var X=P.entry;for(P.entry=null;X;){var se=X.callback;O.pendingcb--,se(K),X=X.next}O.corkedRequestsFree.next=P}return Object.defineProperty(N.prototype,"destroyed",{enumerable:!1,get:function(){return this._writableState===void 0?!1:this._writableState.destroyed},set:function(O){this._writableState&&(this._writableState.destroyed=O)}}),N.prototype.destroy=u.destroy,N.prototype._undestroy=u.undestroy,N.prototype._destroy=function(P,O){O(P)},TA}var AA,pU;function nd(){if(pU)return AA;pU=1;var n=Object.keys||function(c){var d=[];for(var p in c)d.push(p);return d};AA=s;var e=H3(),t=z3();fc()(s,e);for(var r=n(t.prototype),i=0;i<r.length;i++){var a=r[i];s.prototype[a]||(s.prototype[a]=t.prototype[a])}function s(c){if(!(this instanceof s))return new s(c);e.call(this,c),t.call(this,c),this.allowHalfOpen=!0,c&&(c.readable===!1&&(this.readable=!1),c.writable===!1&&(this.writable=!1),c.allowHalfOpen===!1&&(this.allowHalfOpen=!1,this.once("end",o)))}Object.defineProperty(s.prototype,"writableHighWaterMark",{enumerable:!1,get:function(){return this._writableState.highWaterMark}}),Object.defineProperty(s.prototype,"writableBuffer",{enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()}}),Object.defineProperty(s.prototype,"writableLength",{enumerable:!1,get:function(){return this._writableState.length}});function o(){this._writableState.ended||at.nextTick(u,this)}function u(c){c.end()}return Object.defineProperty(s.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0||this._writableState===void 0?!1:this._readableState.destroyed&&this._writableState.destroyed},set:function(d){this._readableState===void 0||this._writableState===void 0||(this._readableState.destroyed=d,this._writableState.destroyed=d)}}),AA}var CA={},uy={exports:{}};/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */var mU;function dee(){return mU||(mU=1,function(n,e){var t=sb(),r=t.Buffer;function i(s,o){for(var u in s)o[u]=s[u]}r.from&&r.alloc&&r.allocUnsafe&&r.allocUnsafeSlow?n.exports=t:(i(t,e),e.Buffer=a);function a(s,o,u){return r(s,o,u)}a.prototype=Object.create(r.prototype),i(r,a),a.from=function(s,o,u){if(typeof s=="number")throw new TypeError("Argument must not be a number");return r(s,o,u)},a.alloc=function(s,o,u){if(typeof s!="number")throw new TypeError("Argument must be a number");var c=r(s);return o!==void 0?typeof u=="string"?c.fill(o,u):c.fill(o):c.fill(0),c},a.allocUnsafe=function(s){if(typeof s!="number")throw new TypeError("Argument must be a number");return r(s)},a.allocUnsafeSlow=function(s){if(typeof s!="number")throw new TypeError("Argument must be a number");return t.SlowBuffer(s)}}(uy,uy.exports)),uy.exports}var gU;function yU(){if(gU)return CA;gU=1;var n=dee().Buffer,e=n.isEncoding||function(T){switch(T=""+T,T&&T.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function t(T){if(!T)return"utf8";for(var C;;)switch(T){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return T;default:if(C)return;T=(""+T).toLowerCase(),C=!0}}function r(T){var C=t(T);if(typeof C!="string"&&(n.isEncoding===e||!e(T)))throw new Error("Unknown encoding: "+T);return C||T}CA.StringDecoder=i;function i(T){this.encoding=r(T);var C;switch(this.encoding){case"utf16le":this.text=p,this.end=m,C=4;break;case"utf8":this.fillLast=u,C=4;break;case"base64":this.text=y,this.end=b,C=3;break;default:this.write=w,this.end=S;return}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(C)}i.prototype.write=function(T){if(T.length===0)return"";var C,A;if(this.lastNeed){if(C=this.fillLast(T),C===void 0)return"";A=this.lastNeed,this.lastNeed=0}else A=0;return A<T.length?C?C+this.text(T,A):this.text(T,A):C||""},i.prototype.end=d,i.prototype.text=c,i.prototype.fillLast=function(T){if(this.lastNeed<=T.length)return T.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);T.copy(this.lastChar,this.lastTotal-this.lastNeed,0,T.length),this.lastNeed-=T.length};function a(T){return T<=127?0:T>>5===6?2:T>>4===14?3:T>>3===30?4:T>>6===2?-1:-2}function s(T,C,A){var I=C.length-1;if(I<A)return 0;var x=a(C[I]);return x>=0?(x>0&&(T.lastNeed=x-1),x):--I<A||x===-2?0:(x=a(C[I]),x>=0?(x>0&&(T.lastNeed=x-2),x):--I<A||x===-2?0:(x=a(C[I]),x>=0?(x>0&&(x===2?x=0:T.lastNeed=x-3),x):0))}function o(T,C,A){if((C[0]&192)!==128)return T.lastNeed=0,"�";if(T.lastNeed>1&&C.length>1){if((C[1]&192)!==128)return T.lastNeed=1,"�";if(T.lastNeed>2&&C.length>2&&(C[2]&192)!==128)return T.lastNeed=2,"�"}}function u(T){var C=this.lastTotal-this.lastNeed,A=o(this,T);if(A!==void 0)return A;if(this.lastNeed<=T.length)return T.copy(this.lastChar,C,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);T.copy(this.lastChar,C,0,T.length),this.lastNeed-=T.length}function c(T,C){var A=s(this,T,C);if(!this.lastNeed)return T.toString("utf8",C);this.lastTotal=A;var I=T.length-(A-this.lastNeed);return T.copy(this.lastChar,0,I),T.toString("utf8",C,I)}function d(T){var C=T&&T.length?this.write(T):"";return this.lastNeed?C+"�":C}function p(T,C){if((T.length-C)%2===0){var A=T.toString("utf16le",C);if(A){var I=A.charCodeAt(A.length-1);if(I>=55296&&I<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=T[T.length-2],this.lastChar[1]=T[T.length-1],A.slice(0,-1)}return A}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=T[T.length-1],T.toString("utf16le",C,T.length-1)}function m(T){var C=T&&T.length?this.write(T):"";if(this.lastNeed){var A=this.lastTotal-this.lastNeed;return C+this.lastChar.toString("utf16le",0,A)}return C}function y(T,C){var A=(T.length-C)%3;return A===0?T.toString("base64",C):(this.lastNeed=3-A,this.lastTotal=3,A===1?this.lastChar[0]=T[T.length-1]:(this.lastChar[0]=T[T.length-2],this.lastChar[1]=T[T.length-1]),T.toString("base64",C,T.length-A))}function b(T){var C=T&&T.length?this.write(T):"";return this.lastNeed?C+this.lastChar.toString("base64",0,3-this.lastNeed):C}function w(T){return T.toString(this.encoding)}function S(T){return T&&T.length?this.write(T):""}return CA}var RA,vU;function kI(){if(vU)return RA;vU=1;var n=yd().codes.ERR_STREAM_PREMATURE_CLOSE;function e(a){var s=!1;return function(){if(!s){s=!0;for(var o=arguments.length,u=new Array(o),c=0;c<o;c++)u[c]=arguments[c];a.apply(this,u)}}}function t(){}function r(a){return a.setHeader&&typeof a.abort=="function"}function i(a,s,o){if(typeof s=="function")return i(a,null,s);s||(s={}),o=e(o||t);var u=s.readable||s.readable!==!1&&a.readable,c=s.writable||s.writable!==!1&&a.writable,d=function(){a.writable||m()},p=a._writableState&&a._writableState.finished,m=function(){c=!1,p=!0,u||o.call(a)},y=a._readableState&&a._readableState.endEmitted,b=function(){u=!1,y=!0,c||o.call(a)},w=function(A){o.call(a,A)},S=function(){var A;if(u&&!y)return(!a._readableState||!a._readableState.ended)&&(A=new n),o.call(a,A);if(c&&!p)return(!a._writableState||!a._writableState.ended)&&(A=new n),o.call(a,A)},T=function(){a.req.on("finish",m)};return r(a)?(a.on("complete",m),a.on("abort",S),a.req?T():a.on("request",T)):c&&!a._writableState&&(a.on("end",d),a.on("close",d)),a.on("end",b),a.on("finish",m),s.error!==!1&&a.on("error",w),a.on("close",S),function(){a.removeListener("complete",m),a.removeListener("abort",S),a.removeListener("request",T),a.req&&a.req.removeListener("finish",m),a.removeListener("end",d),a.removeListener("close",d),a.removeListener("finish",m),a.removeListener("end",b),a.removeListener("error",w),a.removeListener("close",S)}}return RA=i,RA}var IA,_U;function hee(){if(_U)return IA;_U=1;var n;function e(A,I,x){return I=t(I),I in A?Object.defineProperty(A,I,{value:x,enumerable:!0,configurable:!0,writable:!0}):A[I]=x,A}function t(A){var I=r(A,"string");return typeof I=="symbol"?I:String(I)}function r(A,I){if(typeof A!="object"||A===null)return A;var x=A[Symbol.toPrimitive];if(x!==void 0){var L=x.call(A,I);if(typeof L!="object")return L;throw new TypeError("@@toPrimitive must return a primitive value.")}return(I==="string"?String:Number)(A)}var i=kI(),a=Symbol("lastResolve"),s=Symbol("lastReject"),o=Symbol("error"),u=Symbol("ended"),c=Symbol("lastPromise"),d=Symbol("handlePromise"),p=Symbol("stream");function m(A,I){return{value:A,done:I}}function y(A){var I=A[a];if(I!==null){var x=A[p].read();x!==null&&(A[c]=null,A[a]=null,A[s]=null,I(m(x,!1)))}}function b(A){at.nextTick(y,A)}function w(A,I){return function(x,L){A.then(function(){if(I[u]){x(m(void 0,!0));return}I[d](x,L)},L)}}var S=Object.getPrototypeOf(function(){}),T=Object.setPrototypeOf((n={get stream(){return this[p]},next:function(){var I=this,x=this[o];if(x!==null)return Promise.reject(x);if(this[u])return Promise.resolve(m(void 0,!0));if(this[p].destroyed)return new Promise(function(B,q){at.nextTick(function(){I[o]?q(I[o]):B(m(void 0,!0))})});var L=this[c],U;if(L)U=new Promise(w(L,this));else{var N=this[p].read();if(N!==null)return Promise.resolve(m(N,!1));U=new Promise(this[d])}return this[c]=U,U}},e(n,Symbol.asyncIterator,function(){return this}),e(n,"return",function(){var I=this;return new Promise(function(x,L){I[p].destroy(null,function(U){if(U){L(U);return}x(m(void 0,!0))})})}),n),S),C=function(I){var x,L=Object.create(T,(x={},e(x,p,{value:I,writable:!0}),e(x,a,{value:null,writable:!0}),e(x,s,{value:null,writable:!0}),e(x,o,{value:null,writable:!0}),e(x,u,{value:I._readableState.endEmitted,writable:!0}),e(x,d,{value:function(N,B){var q=L[p].read();q?(L[c]=null,L[a]=null,L[s]=null,N(m(q,!1))):(L[a]=N,L[s]=B)},writable:!0}),x));return L[c]=null,i(I,function(U){if(U&&U.code!=="ERR_STREAM_PREMATURE_CLOSE"){var N=L[s];N!==null&&(L[c]=null,L[a]=null,L[s]=null,N(U)),L[o]=U;return}var B=L[a];B!==null&&(L[c]=null,L[a]=null,L[s]=null,B(m(void 0,!0))),L[u]=!0}),I.on("readable",b.bind(null,L)),L};return IA=C,IA}var PA,bU;function pee(){return bU||(bU=1,PA=function(){throw new Error("Readable.from is not available in the browser")}),PA}var xA,wU;function H3(){if(wU)return xA;wU=1,xA=B;var n;B.ReadableState=N,II().EventEmitter;var e=function(z,ye){return z.listeners(ye).length},t=O3(),r=sb().Buffer,i=(typeof window<"u"||typeof window<"u"?window:typeof self<"u"?self:{}).Uint8Array||function(){};function a(F){return r.from(F)}function s(F){return r.isBuffer(F)||F instanceof i}var o=B3(),u;o&&o.debuglog?u=o.debuglog("stream"):u=function(){};var c=cee(),d=q3(),p=V3(),m=p.getHighWaterMark,y=yd().codes,b=y.ERR_INVALID_ARG_TYPE,w=y.ERR_STREAM_PUSH_AFTER_EOF,S=y.ERR_METHOD_NOT_IMPLEMENTED,T=y.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,C,A,I;fc()(B,t);var x=d.errorOrDestroy,L=["error","close","destroy","pause","resume"];function U(F,z,ye){if(typeof F.prependListener=="function")return F.prependListener(z,ye);!F._events||!F._events[z]?F.on(z,ye):Array.isArray(F._events[z])?F._events[z].unshift(ye):F._events[z]=[ye,F._events[z]]}function N(F,z,ye){n=n||nd(),F=F||{},typeof ye!="boolean"&&(ye=z instanceof n),this.objectMode=!!F.objectMode,ye&&(this.objectMode=this.objectMode||!!F.readableObjectMode),this.highWaterMark=m(this,F,"readableHighWaterMark",ye),this.buffer=new c,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=F.emitClose!==!1,this.autoDestroy=!!F.autoDestroy,this.destroyed=!1,this.defaultEncoding=F.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,F.encoding&&(C||(C=yU().StringDecoder),this.decoder=new C(F.encoding),this.encoding=F.encoding)}function B(F){if(n=n||nd(),!(this instanceof B))return new B(F);var z=this instanceof n;this._readableState=new N(F,this,z),this.readable=!0,F&&(typeof F.read=="function"&&(this._read=F.read),typeof F.destroy=="function"&&(this._destroy=F.destroy)),t.call(this)}Object.defineProperty(B.prototype,"destroyed",{enumerable:!1,get:function(){return this._readableState===void 0?!1:this._readableState.destroyed},set:function(z){this._readableState&&(this._readableState.destroyed=z)}}),B.prototype.destroy=d.destroy,B.prototype._undestroy=d.undestroy,B.prototype._destroy=function(F,z){z(F)},B.prototype.push=function(F,z){var ye=this._readableState,ke;return ye.objectMode?ke=!0:typeof F=="string"&&(z=z||ye.defaultEncoding,z!==ye.encoding&&(F=r.from(F,z),z=""),ke=!0),q(this,F,z,!1,ke)},B.prototype.unshift=function(F){return q(this,F,null,!0,!1)};function q(F,z,ye,ke,Qe){u("readableAddChunk",z);var $e=F._readableState;if(z===null)$e.reading=!1,te(F,$e);else{var ze;if(Qe||(ze=V($e,z)),ze)x(F,ze);else if($e.objectMode||z&&z.length>0)if(typeof z!="string"&&!$e.objectMode&&Object.getPrototypeOf(z)!==r.prototype&&(z=a(z)),ke)$e.endEmitted?x(F,new T):J(F,$e,z,!0);else if($e.ended)x(F,new w);else{if($e.destroyed)return!1;$e.reading=!1,$e.decoder&&!ye?(z=$e.decoder.write(z),$e.objectMode||z.length!==0?J(F,$e,z,!1):Ee(F,$e)):J(F,$e,z,!1)}else ke||($e.reading=!1,Ee(F,$e))}return!$e.ended&&($e.length<$e.highWaterMark||$e.length===0)}function J(F,z,ye,ke){z.flowing&&z.length===0&&!z.sync?(z.awaitDrain=0,F.emit("data",ye)):(z.length+=z.objectMode?1:ye.length,ke?z.buffer.unshift(ye):z.buffer.push(ye),z.needReadable&&oe(F)),Ee(F,z)}function V(F,z){var ye;return!s(z)&&typeof z!="string"&&z!==void 0&&!F.objectMode&&(ye=new b("chunk",["string","Buffer","Uint8Array"],z)),ye}B.prototype.isPaused=function(){return this._readableState.flowing===!1},B.prototype.setEncoding=function(F){C||(C=yU().StringDecoder);var z=new C(F);this._readableState.decoder=z,this._readableState.encoding=this._readableState.decoder.encoding;for(var ye=this._readableState.buffer.head,ke="";ye!==null;)ke+=z.write(ye.data),ye=ye.next;return this._readableState.buffer.clear(),ke!==""&&this._readableState.buffer.push(ke),this._readableState.length=ke.length,this};var de=1073741824;function ae(F){return F>=de?F=de:(F--,F|=F>>>1,F|=F>>>2,F|=F>>>4,F|=F>>>8,F|=F>>>16,F++),F}function ue(F,z){return F<=0||z.length===0&&z.ended?0:z.objectMode?1:F!==F?z.flowing&&z.length?z.buffer.head.data.length:z.length:(F>z.highWaterMark&&(z.highWaterMark=ae(F)),F<=z.length?F:z.ended?z.length:(z.needReadable=!0,0))}B.prototype.read=function(F){u("read",F),F=parseInt(F,10);var z=this._readableState,ye=F;if(F!==0&&(z.emittedReadable=!1),F===0&&z.needReadable&&((z.highWaterMark!==0?z.length>=z.highWaterMark:z.length>0)||z.ended))return u("read: emitReadable",z.length,z.ended),z.length===0&&z.ended?K(this):oe(this),null;if(F=ue(F,z),F===0&&z.ended)return z.length===0&&K(this),null;var ke=z.needReadable;u("need readable",ke),(z.length===0||z.length-F<z.highWaterMark)&&(ke=!0,u("length less than watermark",ke)),z.ended||z.reading?(ke=!1,u("reading or ended",ke)):ke&&(u("do read"),z.reading=!0,z.sync=!0,z.length===0&&(z.needReadable=!0),this._read(z.highWaterMark),z.sync=!1,z.reading||(F=ue(ye,z)));var Qe;return F>0?Qe=O(F,z):Qe=null,Qe===null?(z.needReadable=z.length<=z.highWaterMark,F=0):(z.length-=F,z.awaitDrain=0),z.length===0&&(z.ended||(z.needReadable=!0),ye!==F&&z.ended&&K(this)),Qe!==null&&this.emit("data",Qe),Qe};function te(F,z){if(u("onEofChunk"),!z.ended){if(z.decoder){var ye=z.decoder.end();ye&&ye.length&&(z.buffer.push(ye),z.length+=z.objectMode?1:ye.length)}z.ended=!0,z.sync?oe(F):(z.needReadable=!1,z.emittedReadable||(z.emittedReadable=!0,ge(F)))}}function oe(F){var z=F._readableState;u("emitReadable",z.needReadable,z.emittedReadable),z.needReadable=!1,z.emittedReadable||(u("emitReadable",z.flowing),z.emittedReadable=!0,at.nextTick(ge,F))}function ge(F){var z=F._readableState;u("emitReadable_",z.destroyed,z.length,z.ended),!z.destroyed&&(z.length||z.ended)&&(F.emit("readable"),z.emittedReadable=!1),z.needReadable=!z.flowing&&!z.ended&&z.length<=z.highWaterMark,P(F)}function Ee(F,z){z.readingMore||(z.readingMore=!0,at.nextTick(Y,F,z))}function Y(F,z){for(;!z.reading&&!z.ended&&(z.length<z.highWaterMark||z.flowing&&z.length===0);){var ye=z.length;if(u("maybeReadMore read 0"),F.read(0),ye===z.length)break}z.readingMore=!1}B.prototype._read=function(F){x(this,new S("_read()"))},B.prototype.pipe=function(F,z){var ye=this,ke=this._readableState;switch(ke.pipesCount){case 0:ke.pipes=F;break;case 1:ke.pipes=[ke.pipes,F];break;default:ke.pipes.push(F);break}ke.pipesCount+=1,u("pipe count=%d opts=%j",ke.pipesCount,z);var Qe=(!z||z.end!==!1)&&F!==at.stdout&&F!==at.stderr,$e=Qe?xt:We;ke.endEmitted?at.nextTick($e):ye.once("end",$e),F.on("unpipe",ze);function ze(rt,tt){u("onunpipe"),rt===ye&&tt&&tt.hasUnpiped===!1&&(tt.hasUnpiped=!0,It())}function xt(){u("onend"),F.end()}var Oe=ve(ye);F.on("drain",Oe);var qe=!1;function It(){u("cleanup"),F.removeListener("close",et),F.removeListener("finish",Ye),F.removeListener("drain",Oe),F.removeListener("error",Be),F.removeListener("unpipe",ze),ye.removeListener("end",xt),ye.removeListener("end",We),ye.removeListener("data",Ve),qe=!0,ke.awaitDrain&&(!F._writableState||F._writableState.needDrain)&&Oe()}ye.on("data",Ve);function Ve(rt){u("ondata");var tt=F.write(rt);u("dest.write",tt),tt===!1&&((ke.pipesCount===1&&ke.pipes===F||ke.pipesCount>1&&se(ke.pipes,F)!==-1)&&!qe&&(u("false write response, pause",ke.awaitDrain),ke.awaitDrain++),ye.pause())}function Be(rt){u("onerror",rt),We(),F.removeListener("error",Be),e(F,"error")===0&&x(F,rt)}U(F,"error",Be);function et(){F.removeListener("finish",Ye),We()}F.once("close",et);function Ye(){u("onfinish"),F.removeListener("close",et),We()}F.once("finish",Ye);function We(){u("unpipe"),ye.unpipe(F)}return F.emit("pipe",ye),ke.flowing||(u("pipe resume"),ye.resume()),F};function ve(F){return function(){var ye=F._readableState;u("pipeOnDrain",ye.awaitDrain),ye.awaitDrain&&ye.awaitDrain--,ye.awaitDrain===0&&e(F,"data")&&(ye.flowing=!0,P(F))}}B.prototype.unpipe=function(F){var z=this._readableState,ye={hasUnpiped:!1};if(z.pipesCount===0)return this;if(z.pipesCount===1)return F&&F!==z.pipes?this:(F||(F=z.pipes),z.pipes=null,z.pipesCount=0,z.flowing=!1,F&&F.emit("unpipe",this,ye),this);if(!F){var ke=z.pipes,Qe=z.pipesCount;z.pipes=null,z.pipesCount=0,z.flowing=!1;for(var $e=0;$e<Qe;$e++)ke[$e].emit("unpipe",this,{hasUnpiped:!1});return this}var ze=se(z.pipes,F);return ze===-1?this:(z.pipes.splice(ze,1),z.pipesCount-=1,z.pipesCount===1&&(z.pipes=z.pipes[0]),F.emit("unpipe",this,ye),this)},B.prototype.on=function(F,z){var ye=t.prototype.on.call(this,F,z),ke=this._readableState;return F==="data"?(ke.readableListening=this.listenerCount("readable")>0,ke.flowing!==!1&&this.resume()):F==="readable"&&!ke.endEmitted&&!ke.readableListening&&(ke.readableListening=ke.needReadable=!0,ke.flowing=!1,ke.emittedReadable=!1,u("on readable",ke.length,ke.reading),ke.length?oe(this):ke.reading||at.nextTick(Q,this)),ye},B.prototype.addListener=B.prototype.on,B.prototype.removeListener=function(F,z){var ye=t.prototype.removeListener.call(this,F,z);return F==="readable"&&at.nextTick(Re,this),ye},B.prototype.removeAllListeners=function(F){var z=t.prototype.removeAllListeners.apply(this,arguments);return(F==="readable"||F===void 0)&&at.nextTick(Re,this),z};function Re(F){var z=F._readableState;z.readableListening=F.listenerCount("readable")>0,z.resumeScheduled&&!z.paused?z.flowing=!0:F.listenerCount("data")>0&&F.resume()}function Q(F){u("readable nexttick read 0"),F.read(0)}B.prototype.resume=function(){var F=this._readableState;return F.flowing||(u("resume"),F.flowing=!F.readableListening,ie(this,F)),F.paused=!1,this};function ie(F,z){z.resumeScheduled||(z.resumeScheduled=!0,at.nextTick(ce,F,z))}function ce(F,z){u("resume",z.reading),z.reading||F.read(0),z.resumeScheduled=!1,F.emit("resume"),P(F),z.flowing&&!z.reading&&F.read(0)}B.prototype.pause=function(){return u("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(u("pause"),this._readableState.flowing=!1,this.emit("pause")),this._readableState.paused=!0,this};function P(F){var z=F._readableState;for(u("flow",z.flowing);z.flowing&&F.read()!==null;);}B.prototype.wrap=function(F){var z=this,ye=this._readableState,ke=!1;F.on("end",function(){if(u("wrapped end"),ye.decoder&&!ye.ended){var ze=ye.decoder.end();ze&&ze.length&&z.push(ze)}z.push(null)}),F.on("data",function(ze){if(u("wrapped data"),ye.decoder&&(ze=ye.decoder.write(ze)),!(ye.objectMode&&ze==null)&&!(!ye.objectMode&&(!ze||!ze.length))){var xt=z.push(ze);xt||(ke=!0,F.pause())}});for(var Qe in F)this[Qe]===void 0&&typeof F[Qe]=="function"&&(this[Qe]=function(xt){return function(){return F[xt].apply(F,arguments)}}(Qe));for(var $e=0;$e<L.length;$e++)F.on(L[$e],this.emit.bind(this,L[$e]));return this._read=function(ze){u("wrapped _read",ze),ke&&(ke=!1,F.resume())},this},typeof Symbol=="function"&&(B.prototype[Symbol.asyncIterator]=function(){return A===void 0&&(A=hee()),A(this)}),Object.defineProperty(B.prototype,"readableHighWaterMark",{enumerable:!1,get:function(){return this._readableState.highWaterMark}}),Object.defineProperty(B.prototype,"readableBuffer",{enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer}}),Object.defineProperty(B.prototype,"readableFlowing",{enumerable:!1,get:function(){return this._readableState.flowing},set:function(z){this._readableState&&(this._readableState.flowing=z)}}),B._fromList=O,Object.defineProperty(B.prototype,"readableLength",{enumerable:!1,get:function(){return this._readableState.length}});function O(F,z){if(z.length===0)return null;var ye;return z.objectMode?ye=z.buffer.shift():!F||F>=z.length?(z.decoder?ye=z.buffer.join(""):z.buffer.length===1?ye=z.buffer.first():ye=z.buffer.concat(z.length),z.buffer.clear()):ye=z.buffer.consume(F,z.decoder),ye}function K(F){var z=F._readableState;u("endReadable",z.endEmitted),z.endEmitted||(z.ended=!0,at.nextTick(X,z,F))}function X(F,z){if(u("endReadableNT",F.endEmitted,F.length),!F.endEmitted&&F.length===0&&(F.endEmitted=!0,z.readable=!1,z.emit("end"),F.autoDestroy)){var ye=z._writableState;(!ye||ye.autoDestroy&&ye.finished)&&z.destroy()}}typeof Symbol=="function"&&(B.from=function(F,z){return I===void 0&&(I=pee()),I(B,F,z)});function se(F,z){for(var ye=0,ke=F.length;ye<ke;ye++)if(F[ye]===z)return ye;return-1}return xA}var OA,EU;function G3(){if(EU)return OA;EU=1,OA=o;var n=yd().codes,e=n.ERR_METHOD_NOT_IMPLEMENTED,t=n.ERR_MULTIPLE_CALLBACK,r=n.ERR_TRANSFORM_ALREADY_TRANSFORMING,i=n.ERR_TRANSFORM_WITH_LENGTH_0,a=nd();fc()(o,a);function s(d,p){var m=this._transformState;m.transforming=!1;var y=m.writecb;if(y===null)return this.emit("error",new t);m.writechunk=null,m.writecb=null,p!=null&&this.push(p),y(d);var b=this._readableState;b.reading=!1,(b.needReadable||b.length<b.highWaterMark)&&this._read(b.highWaterMark)}function o(d){if(!(this instanceof o))return new o(d);a.call(this,d),this._transformState={afterTransform:s.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,d&&(typeof d.transform=="function"&&(this._transform=d.transform),typeof d.flush=="function"&&(this._flush=d.flush)),this.on("prefinish",u)}function u(){var d=this;typeof this._flush=="function"&&!this._readableState.destroyed?this._flush(function(p,m){c(d,p,m)}):c(this,null,null)}o.prototype.push=function(d,p){return this._transformState.needTransform=!1,a.prototype.push.call(this,d,p)},o.prototype._transform=function(d,p,m){m(new e("_transform()"))},o.prototype._write=function(d,p,m){var y=this._transformState;if(y.writecb=m,y.writechunk=d,y.writeencoding=p,!y.transforming){var b=this._readableState;(y.needTransform||b.needReadable||b.length<b.highWaterMark)&&this._read(b.highWaterMark)}},o.prototype._read=function(d){var p=this._transformState;p.writechunk!==null&&!p.transforming?(p.transforming=!0,this._transform(p.writechunk,p.writeencoding,p.afterTransform)):p.needTransform=!0},o.prototype._destroy=function(d,p){a.prototype._destroy.call(this,d,function(m){p(m)})};function c(d,p,m){if(p)return d.emit("error",p);if(m!=null&&d.push(m),d._writableState.length)throw new i;if(d._transformState.transforming)throw new r;return d.push(null)}return OA}var NA,SU;function mee(){if(SU)return NA;SU=1,NA=e;var n=G3();fc()(e,n);function e(t){if(!(this instanceof e))return new e(t);n.call(this,t)}return e.prototype._transform=function(t,r,i){i(null,t)},NA}var kA,TU;function gee(){if(TU)return kA;TU=1;var n;function e(m){var y=!1;return function(){y||(y=!0,m.apply(void 0,arguments))}}var t=yd().codes,r=t.ERR_MISSING_ARGS,i=t.ERR_STREAM_DESTROYED;function a(m){if(m)throw m}function s(m){return m.setHeader&&typeof m.abort=="function"}function o(m,y,b,w){w=e(w);var S=!1;m.on("close",function(){S=!0}),n===void 0&&(n=kI()),n(m,{readable:y,writable:b},function(C){if(C)return w(C);S=!0,w()});var T=!1;return function(C){if(!S&&!T){if(T=!0,s(m))return m.abort();if(typeof m.destroy=="function")return m.destroy();w(C||new i("pipe"))}}}function u(m){m()}function c(m,y){return m.pipe(y)}function d(m){return!m.length||typeof m[m.length-1]!="function"?a:m.pop()}function p(){for(var m=arguments.length,y=new Array(m),b=0;b<m;b++)y[b]=arguments[b];var w=d(y);if(Array.isArray(y[0])&&(y=y[0]),y.length<2)throw new r("streams");var S,T=y.map(function(C,A){var I=A<y.length-1,x=A>0;return o(C,I,x,function(L){S||(S=L),L&&T.forEach(u),!I&&(T.forEach(u),w(S))})});return y.reduce(c)}return kA=p,kA}var MA,AU;function yee(){if(AU)return MA;AU=1,MA=t;var n=II().EventEmitter,e=fc();e(t,n),t.Readable=H3(),t.Writable=z3(),t.Duplex=nd(),t.Transform=G3(),t.PassThrough=mee(),t.finished=kI(),t.pipeline=gee(),t.Stream=t;function t(){n.call(this)}return t.prototype.pipe=function(r,i){var a=this;function s(y){r.writable&&r.write(y)===!1&&a.pause&&a.pause()}a.on("data",s);function o(){a.readable&&a.resume&&a.resume()}r.on("drain",o),!r._isStdio&&(!i||i.end!==!1)&&(a.on("end",c),a.on("close",d));var u=!1;function c(){u||(u=!0,r.end())}function d(){u||(u=!0,typeof r.destroy=="function"&&r.destroy())}function p(y){if(m(),n.listenerCount(this,"error")===0)throw y}a.on("error",p),r.on("error",p);function m(){a.removeListener("data",s),r.removeListener("drain",o),a.removeListener("end",c),a.removeListener("close",d),a.removeListener("error",p),r.removeListener("error",p),a.removeListener("end",m),a.removeListener("close",m),r.removeListener("close",m)}return a.on("end",m),a.on("close",m),r.on("close",m),r.emit("pipe",a),r},MA}var vee=yee();class _ee{append(e){this._buffer=this._buffer?Ou.concat([this._buffer,e]):e}readMessage(){if(!this._buffer)return null;const e=this._buffer.indexOf(`
`);if(e===-1)return null;const t=this._buffer.toString("utf8",0,e).replace(/\r$/,"");return this._buffer=this._buffer.subarray(e+1),bee(t)}clear(){this._buffer=void 0}}function bee(n){return jf.parse(JSON.parse(n))}function wee(n){return JSON.stringify(n)+`
`}const Eee=at.platform==="win32"?["APPDATA","HOMEDRIVE","HOMEPATH","LOCALAPPDATA","PATH","PROCESSOR_ARCHITECTURE","SYSTEMDRIVE","SYSTEMROOT","TEMP","USERNAME","USERPROFILE"]:["HOME","LOGNAME","PATH","SHELL","TERM","USER"];function See(){const n={};for(const e of Eee){const t=at.env[e];t!==void 0&&(t.startsWith("()")||(n[e]=t))}return n}class Tee{constructor(e){this._abortController=new AbortController,this._readBuffer=new _ee,this._stderrStream=null,this._serverParams=e,(e.stderr==="pipe"||e.stderr==="overlapped")&&(this._stderrStream=new vee.PassThrough)}async start(){if(this._process)throw new Error("StdioClientTransport already started! If using Client class, note that connect() calls start() automatically.");return new Promise((e,t)=>{var r,i,a,s,o,u;this._process=PQ(this._serverParams.command,(r=this._serverParams.args)!==null&&r!==void 0?r:[],{env:(i=this._serverParams.env)!==null&&i!==void 0?i:See(),stdio:["pipe","pipe",(a=this._serverParams.stderr)!==null&&a!==void 0?a:"inherit"],shell:!1,signal:this._abortController.signal,windowsHide:at.platform==="win32"&&Aee(),cwd:this._serverParams.cwd}),this._process.on("error",c=>{var d,p;if(c.name==="AbortError"){(d=this.onclose)===null||d===void 0||d.call(this);return}t(c),(p=this.onerror)===null||p===void 0||p.call(this,c)}),this._process.on("spawn",()=>{e()}),this._process.on("close",c=>{var d;this._process=void 0,(d=this.onclose)===null||d===void 0||d.call(this)}),(s=this._process.stdin)===null||s===void 0||s.on("error",c=>{var d;(d=this.onerror)===null||d===void 0||d.call(this,c)}),(o=this._process.stdout)===null||o===void 0||o.on("data",c=>{this._readBuffer.append(c),this.processReadBuffer()}),(u=this._process.stdout)===null||u===void 0||u.on("error",c=>{var d;(d=this.onerror)===null||d===void 0||d.call(this,c)}),this._stderrStream&&this._process.stderr&&this._process.stderr.pipe(this._stderrStream)})}get stderr(){var e,t;return this._stderrStream?this._stderrStream:(t=(e=this._process)===null||e===void 0?void 0:e.stderr)!==null&&t!==void 0?t:null}processReadBuffer(){for(var e,t;;)try{const r=this._readBuffer.readMessage();if(r===null)break;(e=this.onmessage)===null||e===void 0||e.call(this,r)}catch(r){(t=this.onerror)===null||t===void 0||t.call(this,r)}}async close(){this._abortController.abort(),this._process=void 0,this._readBuffer.clear()}send(e){return new Promise(t=>{var r;if(!(!((r=this._process)===null||r===void 0)&&r.stdin))throw new Error("Not connected");const i=wee(e);this._process.stdin.write(i)?t():this._process.stdin.once("drain",t)})}}function Aee(){return"type"in at}const Cee="mcp";class Ree{constructor(e){this._url=e}start(){if(this._socket)throw new Error("WebSocketClientTransport already started! If using Client class, note that connect() calls start() automatically.");return new Promise((e,t)=>{this._socket=new WebSocket(this._url,Cee),this._socket.onerror=r=>{var i;const a="error"in r?r.error:new Error(`WebSocket error: ${JSON.stringify(r)}`);t(a),(i=this.onerror)===null||i===void 0||i.call(this,a)},this._socket.onopen=()=>{e()},this._socket.onclose=()=>{var r;(r=this.onclose)===null||r===void 0||r.call(this)},this._socket.onmessage=r=>{var i,a;let s;try{s=jf.parse(JSON.parse(r.data))}catch(o){(i=this.onerror)===null||i===void 0||i.call(this,o);return}(a=this.onmessage)===null||a===void 0||a.call(this,s)}})}async close(){var e;(e=this._socket)===null||e===void 0||e.close()}send(e){return new Promise((t,r)=>{var i;if(!this._socket){r(new Error("Not connected"));return}(i=this._socket)===null||i===void 0||i.send(JSON.stringify(e)),t()})}}const W3=(n,e)=>n.allOf.map((r,i)=>hi(r,{...e,path:[...e.path,"allOf",i]})).reduce((r,i)=>r.and(i)),K3=(n,e)=>{const t=n.anyOf.map((r,i)=>hi(r,{...e,path:[...e.path,"anyOf",i]}));return An(t)};function rs(n,e,t,r){var a;const i=e[t];if(i!==void 0){const s=(a=e.errorMessage)==null?void 0:a[t];return r(n,i,s)}return n}const Iee=(n,e)=>{const t=n.items;let r;if(Array.isArray(t)){const a=t.map((s,o)=>hi(s,{...e,path:[...e.path,"items",o]}));if(r=SG(a),n.additionalItems!==void 0&&n.additionalItems!==!1){const s=hi(n.additionalItems,{...e,path:[...e.path,"additionalItems"]});r=r.rest(s)}}else{const a=hi(t??!0,{...e,path:[...e.path,"items"]});r=Pt(a)}const i=r;return r=rs(r,n,"minItems",(a,s,o)=>i.min(s,o)),r=rs(r,n,"maxItems",(a,s,o)=>i.max(s,o)),n.uniqueItems&&(r=r.refine(a=>new Set(a.map(s=>JSON.stringify(s))).size===a.length,{message:"Array items must be unique"})),r},Pee=n=>qr(),xee=n=>{const e=n.const;return Rt(e)},Oee=n=>Pa(),Nee=n=>{if(n.enum.length===0)return WF();if(n.enum.length===1)return Rt(n.enum[0]);const e=typeof n.enum[0];if(n.enum.every(r=>typeof r===e)){if(e==="string")return ds(n.enum);if(e==="number"||e==="boolean")return An(n.enum.map(r=>Rt(r)))}return An(n.enum.map(r=>Rt(r)))},kee=(n,e)=>{hi(n.if,{...e,path:[...e.path,"if"]});const t=hi(n.then,{...e,path:[...e.path,"then"]}),r=hi(n.else,{...e,path:[...e.path,"else"]});return An([t,r])},Mee=(n,e)=>{const r=n.type.map(i=>hi({...n,type:i},e));return An(r)},Dee=(n,e)=>{const t=hi(n.not,{...e,path:[...e.path,"not"]});return Pa().refine(r=>!t.safeParse(r).success,{message:"Value must not match the forbidden schema"})},$ee=n=>GF(),Lee=(n,e)=>{const{parseSchema:t}=require("./parse-schema"),{nullable:r,...i}=n,a=t(i,e);return An([a,GF()])},Uee=n=>{var r;let e=zn();n.type==="integer"&&(e=e.int());const t=e;return e=rs(e,n,"minimum",(i,a,s)=>t.gte(a,s)),e=rs(e,n,"exclusiveMinimum",(i,a,s)=>{if(typeof a=="boolean"){const o=n.minimum;return a&&o!==void 0?t.gt(o,s):i}return t.gt(a,s)}),e=rs(e,n,"maximum",(i,a,s)=>t.lte(a,s)),e=rs(e,n,"exclusiveMaximum",(i,a,s)=>{if(typeof a=="boolean"){const o=n.maximum;return a&&o!==void 0?t.lt(o,s):i}return t.lt(a,s)}),n.multipleOf!==void 0?zn().refine(i=>i%n.multipleOf===0,{message:((r=n.errorMessage)==null?void 0:r.multipleOf)??`value must be a multiple of ${n.multipleOf}`}):e},J3=(n,e)=>{const t=n.oneOf.map((r,i)=>hi(r,{...e,path:[...e.path,"oneOf",i]}));return An(t)},hr={an:{object:n=>n.type==="object",array:n=>n.type==="array",anyOf:n=>n.anyOf!==void 0,allOf:n=>n.allOf!==void 0,enum:n=>n.enum!==void 0},a:{nullable:n=>n.nullable===!0,multipleType:n=>Array.isArray(n.type),not:n=>n.not!==void 0,const:n=>n.const!==void 0,primitive:(n,e)=>n.type===e,conditional:n=>!!("if"in n&&n.if&&"then"in n&&"else"in n&&n.then&&n.else),oneOf:n=>n.oneOf!==void 0}};function jee(n,e){if(!n.properties)return;const t=Object.keys(n.properties);if(t.length===0)return Xe({});const r={};for(const i of t){const a=n.properties[i],s=hi(a,{...e,path:[...e.path,"properties",i]}),o=typeof a=="object"&&a.default!==void 0,u=Array.isArray(n.required)?n.required.includes(i):typeof a=="object"&&a.required===!0,c=!o&&!u;r[i]=c?s.optional():s}return Xe(r)}function Fee(n,e){const t=Object.keys(n.patternProperties??{}).length>0,r=jee(n,e);let i=r;const a=n.additionalProperties!==void 0?hi(n.additionalProperties,{...e,path:[...e.path,"additionalProperties"]}):void 0;if(n.patternProperties){const o=Object.fromEntries(Object.entries(n.patternProperties).map(([d,p])=>[d,hi(p,{...e,path:[...e.path,"patternProperties",d]})])),u=Object.values(o);r?a?i=r.catchall(An([...u,a])):Object.keys(o).length>1?i=r.catchall(An(u)):i=r.catchall(u[0]):a?i=ts(An([...u,a])):u.length>1?i=ts(An(u)):i=ts(u[0]);const c=new Set(Object.keys(n.properties??{}));i=i.superRefine((d,p)=>{for(const m in d){let y=c.has(m);for(const b in n.patternProperties){const w=new RegExp(b);if(m.match(w)){y=!0;const S=o[b].safeParse(d[m]);S.success||p.addIssue({path:[...p.path,m],code:"custom",message:`Invalid input: Key matching regex /${m}/ must match schema`,params:{issues:S.error.issues}})}}if(!y&&a){const b=a.safeParse(d[m]);b.success||p.addIssue({path:[...p.path,m],code:"custom",message:"Invalid input: must match catchall schema",params:{issues:b.error.issues}})}}})}let s;return r?t?s=i:a?a instanceof Do?s=r.strict():s=r.catchall(a):s=i:t?s=i:a?s=ts(a):s=ts(Pa()),hr.an.anyOf(n)&&(s=s.and(K3({...n,anyOf:n.anyOf.map(o=>typeof o=="object"&&!o.type&&(o.properties??o.additionalProperties??o.patternProperties)?{...o,type:"object"}:o)},e))),hr.a.oneOf(n)&&(s=s.and(J3({...n,oneOf:n.oneOf.map(o=>typeof o=="object"&&!o.type&&(o.properties??o.additionalProperties??o.patternProperties)?{...o,type:"object"}:o)},e))),hr.an.allOf(n)&&(s=s.and(W3({...n,allOf:n.allOf.map(o=>typeof o=="object"&&!o.type&&(o.properties??o.additionalProperties??o.patternProperties)?{...o,type:"object"}:o)},e))),s}const Bee=n=>{let e=Me();return e=rs(e,n,"format",(t,r,i)=>{switch(r){case"email":return t.email(i);case"ip":return t.ip(i);case"ipv4":return t.ip({version:"v4",message:i});case"ipv6":return t.ip({version:"v6",message:i});case"uri":return t.url(i);case"uuid":return t.uuid(i);case"date-time":return t.datetime({offset:!0,message:i});case"time":return t.time(i);case"date":return t.date(i);case"binary":return t.base64(i);case"duration":return t.duration(i);default:return t}}),e=rs(e,n,"contentEncoding",(t,r,i)=>t.base64(i)),e=rs(e,n,"pattern",(t,r,i)=>t.regex(new RegExp(r),i)),e=rs(e,n,"minLength",(t,r,i)=>t.min(r,i)),e=rs(e,n,"maxLength",(t,r,i)=>t.max(r,i)),e},qee=(n,e)=>(n.description&&(e=e.describe(n.description)),e),Vee=(n,e)=>(n.default!==void 0&&(e=e.default(n.default)),e),zee=(n,e)=>(n.readOnly&&(e=e.readonly()),e),Hee=(n,e)=>hr.a.nullable(n)?Lee(n,e):hr.an.object(n)?Fee(n,e):hr.an.array(n)?Iee(n,e):hr.an.anyOf(n)?K3(n,e):hr.an.allOf(n)?W3(n,e):hr.a.oneOf(n)?J3(n,e):hr.a.not(n)?Dee(n,e):hr.an.enum(n)?Nee(n):hr.a.const(n)?xee(n):hr.a.multipleType(n)?Mee(n,e):hr.a.primitive(n,"string")?Bee(n):hr.a.primitive(n,"number")||hr.a.primitive(n,"integer")?Uee(n):hr.a.primitive(n,"boolean")?Pee():hr.a.primitive(n,"null")?$ee():hr.a.conditional(n)?kee(n,e):Oee(),hi=(n,e={seen:new Map,path:[]},t)=>{if(typeof n!="object")return n?Pa():WF();if(e.parserOverride){const a=e.parserOverride(n,e);if(a instanceof Gt)return a}let r=e.seen.get(n);if(r){if(r.r!==void 0)return r.r;if(e.depth===void 0||r.n>=e.depth)return Pa();r.n+=1}else r={r:void 0,n:0},e.seen.set(n,r);let i=Hee(n,e);return e.withoutDescribes||(i=qee(n,i)),e.withoutDefaults||(i=Vee(n,i)),i=zee(n,i),r.r=i,i},Gee=(n,e={})=>hi(n,{path:[],seen:new Map,...e});var Vn;(function(n){n[n.TRACE=0]="TRACE",n[n.DEBUG=1]="DEBUG",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.FATAL=5]="FATAL"})(Vn||(Vn={}));const Wee={[Vn.TRACE]:"\x1B[90m",[Vn.DEBUG]:"\x1B[90m",[Vn.INFO]:"\x1B[90m",[Vn.WARN]:"\x1B[1;93m",[Vn.ERROR]:"\x1B[1;91m",[Vn.FATAL]:"\x1B[1;101m"},Kee={trace:Vn.TRACE,debug:Vn.DEBUG,info:Vn.INFO,warn:Vn.WARN,error:Vn.ERROR,fatal:Vn.FATAL};var Iu;let Jee=(Iu=class{constructor({level:e=Vn.INFO}={}){Kr(this,"level");this.level=this.parseLogLevel(e)}parseLogLevel(e){return typeof e=="number"?e:Kee[e.toLowerCase()]}log(e,...t){if(e<this.level)return;const r=Wee[e],i=`[${Vn[e].toLowerCase()}]`;console.log(`${r}${i}${Iu.RESET}`,...t.map(this.formatValue))}formatValue(e){return e===null?"null":e===void 0?"undefined":typeof e=="object"?JSON.stringify(e,null,2):String(e)}trace(...e){this.log(Vn.TRACE,...e)}debug(...e){this.log(Vn.DEBUG,...e)}info(...e){this.log(Vn.INFO,...e)}warn(...e){this.log(Vn.WARN,...e)}error(...e){this.log(Vn.ERROR,...e)}fatal(...e){this.log(Vn.FATAL,...e)}},Kr(Iu,"RESET","\x1B[0m"),Iu);var Yee={};class hu extends Error{constructor(t,r,i){super(r);Kr(this,"serverName");Kr(this,"details");this.serverName=t,this.details=i,this.name="McpInitializationError"}}async function Zee(n,e){const t=[],r=[],i=(e==null?void 0:e.logger)||new Jee({level:e==null?void 0:e.logLevel}),a=Object.entries(n).map(async([c,d])=>{const p=await nte(c,d,i);return{name:c,result:p}}),s=Object.keys(n);(await Promise.allSettled(a)).forEach((c,d)=>{if(c.status==="fulfilled"){const{result:{tools:p,cleanup:m}}=c.value;t.push(...p),r.push(m)}else throw i.error(`MCP server "${s[d]}": failed to initialize: ${c.reason.details}`),c.reason});async function u(){(await Promise.allSettled(r.map(p=>p()))).filter(p=>p.status==="rejected").forEach((p,m)=>{i.error(`MCP server "${s[m]}": failed to close: ${p.reason}`)})}return i.info(`MCP servers initialized: ${t.length} tool(s) available in total`),t.forEach(c=>i.debug(`- ${c.name}`)),{tools:t,cleanup:u}}function mu(n,e,t){if(typeof n!="object"||n===null)return n;const r={...n},i=[],a=[];if(r.exclusiveMinimum!==void 0&&(i.push("exclusiveMinimum"),delete r.exclusiveMinimum),r.exclusiveMaximum!==void 0&&(i.push("exclusiveMaximum"),delete r.exclusiveMaximum),n.exclusiveMinimum!==void 0&&(r.minimum=n.exclusiveMinimum,a.push("exclusiveMinimum → minimum")),n.exclusiveMaximum!==void 0&&(r.maximum=n.exclusiveMaximum,a.push("exclusiveMaximum → maximum")),r.type==="string"&&r.format&&(["enum","date-time"].includes(r.format)||(i.push(`format: ${r.format}`),delete r.format)),e&&t&&(i.length>0||a.length>0)){const s=[];i.length>0&&s.push(`removed: ${i.join(", ")}`),a.length>0&&s.push(`converted: ${a.join(", ")}`),e.warn(`MCP tool "${t}": schema sanitized for Gemini compatibility (${s.join("; ")})`)}return r.properties&&(r.properties=Object.fromEntries(Object.entries(r.properties).map(([s,o])=>[s,mu(o,e,t)]))),r.anyOf&&(r.anyOf=r.anyOf.map(s=>mu(s,e,t))),r.oneOf&&(r.oneOf=r.oneOf.map(s=>mu(s,e,t))),r.allOf&&(r.allOf=r.allOf.map(s=>mu(s,e,t))),r.items&&(r.items=mu(r.items,e,t)),r.additionalProperties&&typeof r.additionalProperties=="object"&&(r.additionalProperties=mu(r.additionalProperties,e,t)),r}function CU(n,e,t){const r={};return n.streamableHTTPOptions?(n.streamableHTTPOptions.authProvider&&(r.authProvider=n.streamableHTTPOptions.authProvider,e.info(`MCP server "${t}": configuring Streamable HTTP with authentication provider`)),n.streamableHTTPOptions.requestInit&&(r.requestInit=n.streamableHTTPOptions.requestInit),n.streamableHTTPOptions.reconnectionOptions&&(r.reconnectionOptions=n.streamableHTTPOptions.reconnectionOptions),n.streamableHTTPOptions.sessionId&&(r.sessionId=n.streamableHTTPOptions.sessionId)):n.headers&&(r.requestInit={headers:n.headers}),Object.keys(r).length>0?r:void 0}function RU(n,e,t){const r={};return n.sseOptions&&(n.sseOptions.authProvider&&(r.authProvider=n.sseOptions.authProvider,e.info(`MCP server "${t}": configuring SSE with authentication provider`)),n.sseOptions.eventSourceInit&&(r.eventSourceInit=n.sseOptions.eventSourceInit),n.sseOptions.requestInit?r.requestInit=n.sseOptions.requestInit:n.headers&&(r.requestInit={headers:n.headers})),Object.keys(r).length>0?r:void 0}function Xee(n){if(!n||typeof n!="object")return!1;const e=n;if(e.status&&typeof e.status=="number")return e.status>=400&&e.status<500;if(e.response&&e.response.status&&typeof e.response.status=="number")return e.response.status>=400&&e.response.status<500;const t=e.message||e.toString();return typeof t=="string"?/4[0-9]{2}/.test(t)||t.includes("Bad Request")||t.includes("Unauthorized")||t.includes("Forbidden")||t.includes("Not Found")||t.includes("Method Not Allowed"):!1}async function Qee(n,e,t,r){var s,o,u,c,d,p;t.debug(`MCP server "${r}": testing Streamable HTTP suppor`);const i={jsonrpc:"2.0",id:`transport-test-${Date.now()}`,method:"initialize",params:{protocolVersion:"2024-11-05",capabilities:{},clientInfo:{name:"mcp-transport-test",version:"1.0.0"}}},a={"Content-Type":"application/json",Accept:"application/json, text/event-stream"};if((s=e.streamableHTTPOptions)!=null&&s.authProvider)try{const m=await e.streamableHTTPOptions.authProvider.tokens();m!=null&&m.access_token&&(a.Authorization=`${m.token_type||"Bearer"} ${m.access_token}`,t.debug(`MCP server "${r}": added authentication to transport test`))}catch(m){t.debug(`MCP server "${r}": authentication setup failed for transport test:`,m)}(u=(o=e.streamableHTTPOptions)==null?void 0:o.requestInit)!=null&&u.headers&&Object.assign(a,e.streamableHTTPOptions.requestInit.headers),(d=(c=e.sseOptions)==null?void 0:c.requestInit)!=null&&d.headers&&Object.assign(a,e.sseOptions.requestInit.headers),e.headers&&Object.assign(a,e.headers);try{t.debug(`MCP server "${r}": POST InitializeRequest to test Streamable HTTP support`);const m=await fetch(n.toString(),{method:"POST",headers:a,body:JSON.stringify(i),...(p=e.streamableHTTPOptions)==null?void 0:p.requestInit});if(t.debug(`MCP server "${r}": transport test response: ${m.status} ${m.statusText}`),m.ok)return t.info(`MCP server "${r}": detected Streamable HTTP transport support`),"streamable_http";if(m.status>=400&&m.status<500)return t.info(`MCP server "${r}": received ${m.status}, falling back to SSE transport`),"sse";throw new Error(`HTTP ${m.status}: ${m.statusText}`)}catch(m){if(t.debug(`MCP server "${r}": transport test failed:`,m),Xee(m))return t.info(`MCP server "${r}": transport test failed with 4xx-like error, falling back to SSE`),"sse";throw m}}async function ete(n,e,t,r){const i=e.transport||e.type;if(i==="streamable_http"||i==="http"){t.debug(`MCP server "${r}": using explicitly configured Streamable HTTP transport`);const a=CU(e,t,r);return new I1(n,a)}if(i==="sse"){t.debug(`MCP server "${r}": using explicitly configured SSE transport`);const a=RU(e,t,r);return new V$(n,a)}t.debug(`MCP server "${r}": auto-detecting transport using MCP specification method`);try{if(await Qee(n,e,t,r)==="streamable_http"){const s=CU(e,t,r);return new I1(n,s)}else{const s=RU(e,t,r);return new V$(n,s)}}catch(a){throw t.error(`MCP server "${r}": transport detection failed:`,a),a}}function tte(n){const e=n.shape,t={};if(!e)return Xe(t);for(const[r,i]of Object.entries(e))i instanceof zs&&!(i instanceof $o)||i instanceof Op&&!(i instanceof $o)?t[r]=i.nullable():t[r]=i;return Xe(t)}async function nte(n,e,t){let r=null;try{let i=null;t.info(`MCP server "${n}": initializing with: ${JSON.stringify(e)}`);let a;try{a=new URL(e.url)}catch{}if(!(e!=null&&e.command)&&!a)throw new hu(n,`Failed to initialize MCP server: ${n}: Either a command or a valid URL must be specified`);if(e!=null&&e.command&&a)throw new hu(n,`Configuration error: Cannot specify both 'command' (${e.command}) and 'url' (${a.href}). Use 'command' for local servers or 'url' for remote servers.`);const s=(e==null?void 0:e.transport)||(e==null?void 0:e.type);if(s==="http"||s==="streamable_http"||!s&&((a==null?void 0:a.protocol)==="http:"||(a==null?void 0:a.protocol)==="https:")){if(!((a==null?void 0:a.protocol)==="http:"||(a==null?void 0:a.protocol)==="https:"))throw new hu(n,`Failed to initialize MCP server: ${n}: URL protocol to be http: or https: : ${a}`);const d=e;let p=!1;r=await ete(a,d,t,n),t.info(`MCP server "${n}": created transport, attempting connection`)}else if(s==="ws"||s==="websocket"||!s&&((a==null?void 0:a.protocol)==="ws:"||(a==null?void 0:a.protocol)==="wss:")){if(!((a==null?void 0:a.protocol)==="ws:"||(a==null?void 0:a.protocol)==="wss:"))throw new hu(n,`Failed to initialize MCP server: ${n}: URL protocol to be ws: or wss: : ${a}`);r=new Ree(a)}else if(s==="stdio"||!s&&(e!=null&&e.command)){if(!(e!=null&&e.command))throw new hu(n,`Failed to initialize MCP server: ${n}: Command to be specified`);const d=e,p={...d.env};p.PATH||(p.PATH=Yee.PATH||""),r=new Tee({command:d.command,args:d.args,env:p,stderr:d.stderr,cwd:d.cwd})}else throw new hu(n,`Failed to initialize MCP server: ${n}: Unknown transport type: ${e==null?void 0:e.transport}`);i||(i=new v1({name:"mcp-client",version:"0.0.1"},{capabilities:{}}),await i.connect(r),t.info(`MCP server "${n}": connected`));const u=(await i.request({method:"tools/list"},bI)).tools.map(d=>{const p=mu(d.inputSchema,t,`${n}/${d.name}`),m=Gee(p),y=tte(m);return new hI({name:d.name,description:d.description||"",schema:y,func:async function(b){t.info(`MCP tool "${n}"/"${d.name}" received input:`,b);try{const w=await(i==null?void 0:i.request({method:"tools/call",params:{name:d.name,arguments:b}},rb));if(!(w!=null&&w.content))return t.info(`MCP tool "${n}"/"${d.name}" received null/undefined result`),"";const S=w.content.filter(C=>C.type==="text").map(C=>C.text).join(`

`),T=new TextEncoder().encode(S).length;return t.info(`MCP tool "${n}"/"${d.name}" received result (size: ${T})`),S||"No text content available in response"}catch(w){return t.warn(`MCP tool "${n}"/"${d.name}" caused error: ${w}`),`Error executing MCP tool: ${w}`}}})});t.info(`MCP server "${n}": ${u.length} tool(s) available:`),u.forEach(d=>t.info(`- ${d.name}`));async function c(){r&&(await r.close(),t.info(`MCP server "${n}": session closed`))}return{tools:u,cleanup:c}}catch(i){if(r)try{await r.close()}catch(a){t.error(`Failed to cleanup during initialization error: ${a}`)}throw new hu(n,`Failed to initialize MCP server: ${n}: ${i instanceof Error?i.message:String(i)}`,i)}}function Tt(n,e,t,r,i){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}function xe(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)}let Y3=function(){const{crypto:n}=globalThis;if(n!=null&&n.randomUUID)return Y3=n.randomUUID.bind(n),n.randomUUID();const e=new Uint8Array(1),t=n?()=>n.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^t()&15>>+r/4).toString(16))};function P1(n){return typeof n=="object"&&n!==null&&("name"in n&&n.name==="AbortError"||"message"in n&&String(n.message).includes("FetchRequestCanceledException"))}const x1=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null){try{if(Object.prototype.toString.call(n)==="[object Error]"){const e=new Error(n.message,n.cause?{cause:n.cause}:{});return n.stack&&(e.stack=n.stack),n.cause&&!e.cause&&(e.cause=n.cause),n.name&&(e.name=n.name),e}}catch{}try{return new Error(JSON.stringify(n))}catch{}}return new Error(n)};class Et extends Error{}let Ui=class O1 extends Et{constructor(e,t,r,i){super(`${O1.makeMessage(e,t,r)}`),this.status=e,this.headers=i,this.requestID=i==null?void 0:i.get("x-request-id"),this.error=t;const a=t;this.code=a==null?void 0:a.code,this.param=a==null?void 0:a.param,this.type=a==null?void 0:a.type}static makeMessage(e,t,r){const i=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,t,r,i){if(!e||!i)return new ub({message:r,cause:x1(t)});const a=t==null?void 0:t.error;return e===400?new Z3(e,a,r,i):e===401?new X3(e,a,r,i):e===403?new Q3(e,a,r,i):e===404?new e6(e,a,r,i):e===409?new t6(e,a,r,i):e===422?new n6(e,a,r,i):e===429?new r6(e,a,r,i):e>=500?new i6(e,a,r,i):new O1(e,a,r,i)}},sa=class extends Ui{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}},ub=class extends Ui{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}},cb=class extends ub{constructor({message:e}={}){super({message:e??"Request timed out."})}},Z3=class extends Ui{},X3=class extends Ui{},Q3=class extends Ui{},e6=class extends Ui{},t6=class extends Ui{},n6=class extends Ui{},r6=class extends Ui{},i6=class extends Ui{};class a6 extends Et{constructor(){super("Could not parse response content as the length limit was reached")}}class s6 extends Et{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class Wh extends Error{constructor(e){super(e)}}const rte=/^[a-z][a-z0-9+.-]*:/i,ite=n=>rte.test(n);let Ii=n=>(Ii=Array.isArray,Ii(n)),IU=Ii;function ate(n){return typeof n!="object"?{}:n??{}}function ste(n){if(!n)return!0;for(const e in n)return!1;return!0}function ote(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function DA(n){return n!=null&&typeof n=="object"&&!Array.isArray(n)}const lte=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Et(`${n} must be an integer`);if(e<0)throw new Et(`${n} must be a positive integer`);return e},ute=n=>{try{return JSON.parse(n)}catch{return}},gm=n=>new Promise(e=>setTimeout(e,n)),vf="5.8.1",cte=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function fte(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const dte=()=>{var t;const n=fte();if(n==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":vf,"X-Stainless-OS":xU(Deno.build.os),"X-Stainless-Arch":PU(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((t=Deno.version)==null?void 0:t.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":vf,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(n==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":vf,"X-Stainless-OS":xU(globalThis.process.platform??"unknown"),"X-Stainless-Arch":PU(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};const e=hte();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":vf,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":vf,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function hte(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const i=r[1]||0,a=r[2]||0,s=r[3]||0;return{browser:e,version:`${i}.${a}.${s}`}}}return null}const PU=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",xU=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let OU;const pte=()=>OU??(OU=dte());function mte(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function o6(...n){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...n)}function l6(n){let e=Symbol.asyncIterator in n?n[Symbol.asyncIterator]():n[Symbol.iterator]();return o6({start(){},async pull(t){const{done:r,value:i}=await e.next();r?t.close():t.enqueue(i)},async cancel(){var t;await((t=e.return)==null?void 0:t.call(e))}})}function u6(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function gte(n){var r,i;if(n===null||typeof n!="object")return;if(n[Symbol.asyncIterator]){await((i=(r=n[Symbol.asyncIterator]()).return)==null?void 0:i.call(r));return}const e=n.getReader(),t=e.cancel();e.releaseLock(),await t}const yte=({headers:n,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)}),c6="RFC3986",f6=n=>String(n),NU={RFC1738:n=>String(n).replace(/%20/g,"+"),RFC3986:f6},vte="RFC1738";let N1=(n,e)=>(N1=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),N1(n,e));const Cs=(()=>{const n=[];for(let e=0;e<256;++e)n.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return n})(),$A=1024,_te=(n,e,t,r,i)=>{if(n.length===0)return n;let a=n;if(typeof n=="symbol"?a=Symbol.prototype.toString.call(n):typeof n!="string"&&(a=String(n)),t==="iso-8859-1")return escape(a).replace(/%u[0-9a-f]{4}/gi,function(o){return"%26%23"+parseInt(o.slice(2),16)+"%3B"});let s="";for(let o=0;o<a.length;o+=$A){const u=a.length>=$A?a.slice(o,o+$A):a,c=[];for(let d=0;d<u.length;++d){let p=u.charCodeAt(d);if(p===45||p===46||p===95||p===126||p>=48&&p<=57||p>=65&&p<=90||p>=97&&p<=122||i===vte&&(p===40||p===41)){c[c.length]=u.charAt(d);continue}if(p<128){c[c.length]=Cs[p];continue}if(p<2048){c[c.length]=Cs[192|p>>6]+Cs[128|p&63];continue}if(p<55296||p>=57344){c[c.length]=Cs[224|p>>12]+Cs[128|p>>6&63]+Cs[128|p&63];continue}d+=1,p=65536+((p&1023)<<10|u.charCodeAt(d)&1023),c[c.length]=Cs[240|p>>18]+Cs[128|p>>12&63]+Cs[128|p>>6&63]+Cs[128|p&63]}s+=c.join("")}return s};function bte(n){return!n||typeof n!="object"?!1:!!(n.constructor&&n.constructor.isBuffer&&n.constructor.isBuffer(n))}function kU(n,e){if(Ii(n)){const t=[];for(let r=0;r<n.length;r+=1)t.push(e(n[r]));return t}return e(n)}const d6={brackets(n){return String(n)+"[]"},comma:"comma",indices(n,e){return String(n)+"["+e+"]"},repeat(n){return String(n)}},h6=function(n,e){Array.prototype.push.apply(n,Ii(e)?e:[e])};let MU;const pr={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:_te,encodeValuesOnly:!1,format:c6,formatter:f6,indices:!1,serializeDate(n){return(MU??(MU=Function.prototype.call.bind(Date.prototype.toISOString)))(n)},skipNulls:!1,strictNullHandling:!1};function wte(n){return typeof n=="string"||typeof n=="number"||typeof n=="boolean"||typeof n=="symbol"||typeof n=="bigint"}const LA={};function p6(n,e,t,r,i,a,s,o,u,c,d,p,m,y,b,w,S,T){let C=n,A=T,I=0,x=!1;for(;(A=A.get(LA))!==void 0&&!x;){const q=A.get(n);if(I+=1,typeof q<"u"){if(q===I)throw new RangeError("Cyclic object value");x=!0}typeof A.get(LA)>"u"&&(I=0)}if(typeof c=="function"?C=c(e,C):C instanceof Date?C=m==null?void 0:m(C):t==="comma"&&Ii(C)&&(C=kU(C,function(q){return q instanceof Date?m==null?void 0:m(q):q})),C===null){if(a)return u&&!w?u(e,pr.encoder,S,"key",y):e;C=""}if(wte(C)||bte(C)){if(u){const q=w?e:u(e,pr.encoder,S,"key",y);return[(b==null?void 0:b(q))+"="+(b==null?void 0:b(u(C,pr.encoder,S,"value",y)))]}return[(b==null?void 0:b(e))+"="+(b==null?void 0:b(String(C)))]}const L=[];if(typeof C>"u")return L;let U;if(t==="comma"&&Ii(C))w&&u&&(C=kU(C,u)),U=[{value:C.length>0?C.join(",")||null:void 0}];else if(Ii(c))U=c;else{const q=Object.keys(C);U=d?q.sort(d):q}const N=o?String(e).replace(/\./g,"%2E"):String(e),B=r&&Ii(C)&&C.length===1?N+"[]":N;if(i&&Ii(C)&&C.length===0)return B+"[]";for(let q=0;q<U.length;++q){const J=U[q],V=typeof J=="object"&&typeof J.value<"u"?J.value:C[J];if(s&&V===null)continue;const de=p&&o?J.replace(/\./g,"%2E"):J,ae=Ii(C)?typeof t=="function"?t(B,de):B:B+(p?"."+de:"["+de+"]");T.set(n,I);const ue=new WeakMap;ue.set(LA,T),h6(L,p6(V,ae,t,r,i,a,s,o,t==="comma"&&w&&Ii(C)?null:u,c,d,p,m,y,b,w,S,ue))}return L}function Ete(n=pr){if(typeof n.allowEmptyArrays<"u"&&typeof n.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof n.encodeDotInKeys<"u"&&typeof n.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(n.encoder!==null&&typeof n.encoder<"u"&&typeof n.encoder!="function")throw new TypeError("Encoder has to be a function.");const e=n.charset||pr.charset;if(typeof n.charset<"u"&&n.charset!=="utf-8"&&n.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=c6;if(typeof n.format<"u"){if(!N1(NU,n.format))throw new TypeError("Unknown format option provided.");t=n.format}const r=NU[t];let i=pr.filter;(typeof n.filter=="function"||Ii(n.filter))&&(i=n.filter);let a;if(n.arrayFormat&&n.arrayFormat in d6?a=n.arrayFormat:"indices"in n?a=n.indices?"indices":"repeat":a=pr.arrayFormat,"commaRoundTrip"in n&&typeof n.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const s=typeof n.allowDots>"u"?n.encodeDotInKeys?!0:pr.allowDots:!!n.allowDots;return{addQueryPrefix:typeof n.addQueryPrefix=="boolean"?n.addQueryPrefix:pr.addQueryPrefix,allowDots:s,allowEmptyArrays:typeof n.allowEmptyArrays=="boolean"?!!n.allowEmptyArrays:pr.allowEmptyArrays,arrayFormat:a,charset:e,charsetSentinel:typeof n.charsetSentinel=="boolean"?n.charsetSentinel:pr.charsetSentinel,commaRoundTrip:!!n.commaRoundTrip,delimiter:typeof n.delimiter>"u"?pr.delimiter:n.delimiter,encode:typeof n.encode=="boolean"?n.encode:pr.encode,encodeDotInKeys:typeof n.encodeDotInKeys=="boolean"?n.encodeDotInKeys:pr.encodeDotInKeys,encoder:typeof n.encoder=="function"?n.encoder:pr.encoder,encodeValuesOnly:typeof n.encodeValuesOnly=="boolean"?n.encodeValuesOnly:pr.encodeValuesOnly,filter:i,format:t,formatter:r,serializeDate:typeof n.serializeDate=="function"?n.serializeDate:pr.serializeDate,skipNulls:typeof n.skipNulls=="boolean"?n.skipNulls:pr.skipNulls,sort:typeof n.sort=="function"?n.sort:null,strictNullHandling:typeof n.strictNullHandling=="boolean"?n.strictNullHandling:pr.strictNullHandling}}function Ste(n,e={}){let t=n;const r=Ete(e);let i,a;typeof r.filter=="function"?(a=r.filter,t=a("",t)):Ii(r.filter)&&(a=r.filter,i=a);const s=[];if(typeof t!="object"||t===null)return"";const o=d6[r.arrayFormat],u=o==="comma"&&r.commaRoundTrip;i||(i=Object.keys(t)),r.sort&&i.sort(r.sort);const c=new WeakMap;for(let m=0;m<i.length;++m){const y=i[m];r.skipNulls&&t[y]===null||h6(s,p6(t[y],y,o,u,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,c))}const d=s.join(r.delimiter);let p=r.addQueryPrefix===!0?"?":"";return r.charsetSentinel&&(r.charset==="iso-8859-1"?p+="utf8=%26%2310003%3B&":p+="utf8=%E2%9C%93&"),d.length>0?p+d:""}function Tte(n){let e=0;for(const i of n)e+=i.length;const t=new Uint8Array(e);let r=0;for(const i of n)t.set(i,r),r+=i.length;return t}let DU;function MI(n){let e;return(DU??(e=new globalThis.TextEncoder,DU=e.encode.bind(e)))(n)}let $U;function LU(n){let e;return($U??(e=new globalThis.TextDecoder,$U=e.decode.bind(e)))(n)}var Qi,ea;let fb=class{constructor(){Qi.set(this,void 0),ea.set(this,void 0),Tt(this,Qi,new Uint8Array),Tt(this,ea,null)}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?MI(e):e;Tt(this,Qi,Tte([xe(this,Qi,"f"),t]));const r=[];let i;for(;(i=Ate(xe(this,Qi,"f"),xe(this,ea,"f")))!=null;){if(i.carriage&&xe(this,ea,"f")==null){Tt(this,ea,i.index);continue}if(xe(this,ea,"f")!=null&&(i.index!==xe(this,ea,"f")+1||i.carriage)){r.push(LU(xe(this,Qi,"f").subarray(0,xe(this,ea,"f")-1))),Tt(this,Qi,xe(this,Qi,"f").subarray(xe(this,ea,"f"))),Tt(this,ea,null);continue}const a=xe(this,ea,"f")!==null?i.preceding-1:i.preceding,s=LU(xe(this,Qi,"f").subarray(0,a));r.push(s),Tt(this,Qi,xe(this,Qi,"f").subarray(i.index)),Tt(this,ea,null)}return r}flush(){return xe(this,Qi,"f").length?this.decode(`
`):[]}};Qi=new WeakMap,ea=new WeakMap;fb.NEWLINE_CHARS=new Set([`
`,"\r"]);fb.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function Ate(n,e){for(let i=e??0;i<n.length;i++){if(n[i]===10)return{preceding:i,index:i+1,carriage:!1};if(n[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function Cte(n){for(let r=0;r<n.length-1;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}let Lp=class Kh{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*i(){if(r)throw new Et("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const s of Rte(e,t))if(!a){if(s.data.startsWith("[DONE]")){a=!0;continue}if(s.event===null||s.event.startsWith("response.")||s.event.startsWith("transcript.")){let o;try{o=JSON.parse(s.data)}catch(u){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),u}if(o&&o.error)throw new Ui(void 0,o.error,void 0,e.headers);yield o}else{let o;try{o=JSON.parse(s.data)}catch(u){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),u}if(s.event=="error")throw new Ui(void 0,o.error,o.message,void 0);yield{event:s.event,data:o}}}a=!0}catch(s){if(P1(s))return;throw s}finally{a||t.abort()}}return new Kh(i,t)}static fromReadableStream(e,t){let r=!1;async function*i(){const s=new fb,o=u6(e);for await(const u of o)for(const c of s.decode(u))yield c;for(const u of s.flush())yield u}async function*a(){if(r)throw new Et("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(const o of i())s||o&&(yield JSON.parse(o));s=!0}catch(o){if(P1(o))return;throw o}finally{s||t.abort()}}return new Kh(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),i=a=>({next:()=>{if(a.length===0){const s=r.next();e.push(s),t.push(s)}return a.shift()}});return[new Kh(()=>i(e),this.controller),new Kh(()=>i(t),this.controller)]}toReadableStream(){const e=this;let t;return o6({async start(){t=e[Symbol.asyncIterator]()},async pull(r){try{const{value:i,done:a}=await t.next();if(a)return r.close();const s=MI(JSON.stringify(i)+`
`);r.enqueue(s)}catch(i){r.error(i)}},async cancel(){var r;await((r=t.return)==null?void 0:r.call(t))}})}};async function*Rte(n,e){if(!n.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new Et("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Et("Attempted to iterate over a response with no body");const t=new Pte,r=new fb,i=u6(n.body);for await(const a of Ite(i))for(const s of r.decode(a)){const o=t.decode(s);o&&(yield o)}for(const a of r.flush()){const s=t.decode(a);s&&(yield s)}}async function*Ite(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?MI(t):t;let i=new Uint8Array(e.length+r.length);i.set(e),i.set(r,e.length),e=i;let a;for(;(a=Cte(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}let Pte=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,i]=xte(e,":");return i.startsWith(" ")&&(i=i.substring(1)),t==="event"?this.event=i:t==="data"&&this.data.push(i),null}};function xte(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}const Yv={off:0,error:200,warn:300,info:400,debug:500},UU=(n,e,t)=>{if(n){if(ote(Yv,n))return n;Zr(t).warn(`${e} was set to ${JSON.stringify(n)}, expected one of ${JSON.stringify(Object.keys(Yv))}`)}};function Jh(){}function cy(n,e,t){return!e||Yv[n]>Yv[t]?Jh:e[n].bind(e)}const Ote={error:Jh,warn:Jh,info:Jh,debug:Jh};let jU=new WeakMap;function Zr(n){const e=n.logger,t=n.logLevel??"off";if(!e)return Ote;const r=jU.get(e);if(r&&r[0]===t)return r[1];const i={error:cy("error",e,t),warn:cy("warn",e,t),info:cy("info",e,t),debug:cy("debug",e,t)};return jU.set(e,[t,i]),i}const gu=n=>(n.options&&(n.options={...n.options},delete n.options.headers),n.headers&&(n.headers=Object.fromEntries((n.headers instanceof Headers?[...n.headers]:Object.entries(n.headers)).map(([e,t])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in n&&(n.retryOfRequestLogID&&(n.retryOf=n.retryOfRequestLogID),delete n.retryOfRequestLogID),n);async function m6(n,e){const{response:t,requestLogID:r,retryOfRequestLogID:i,startTime:a}=e,s=await(async()=>{var p;if(e.options.stream)return Zr(n).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):Lp.fromSSEResponse(t,e.controller);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const o=t.headers.get("content-type"),u=(p=o==null?void 0:o.split(";")[0])==null?void 0:p.trim();if((u==null?void 0:u.includes("application/json"))||(u==null?void 0:u.endsWith("+json"))){const m=await t.json();return g6(m,t)}return await t.text()})();return Zr(n).debug(`[${r}] response parsed`,gu({retryOfRequestLogID:i,url:t.url,status:t.status,body:s,durationMs:Date.now()-a})),s}function g6(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}var Yh;let y6=class v6 extends Promise{constructor(e,t,r=m6){super(i=>{i(null)}),this.responsePromise=t,this.parseResponse=r,Yh.set(this,void 0),Tt(this,Yh,e)}_thenUnwrap(e){return new v6(xe(this,Yh,"f"),this.responsePromise,async(t,r)=>g6(e(await this.parseResponse(t,r),r),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(xe(this,Yh,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};Yh=new WeakMap;var fy;let _6=class{constructor(e,t,r,i){fy.set(this,void 0),Tt(this,fy,e),this.options=i,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new Et("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await xe(this,fy,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(fy=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}},Nte=class extends y6{constructor(e,t,r){super(e,t,async(i,a)=>new r(i,a.response,await m6(i,a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}},db=class extends _6{constructor(e,t,r,i){super(e,t,r,i),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}};class ir extends _6{constructor(e,t,r,i){super(e,t,r,i),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){var r;const e=this.getPaginatedItems(),t=(r=e[e.length-1])==null?void 0:r.id;return t?{...this.options,query:{...ate(this.options.query),after:t}}:null}}const b6=()=>{var n;if(typeof File>"u"){const{process:e}=globalThis,t=typeof((n=e==null?void 0:e.versions)==null?void 0:n.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function pp(n,e,t){return b6(),new File(n,e??"unknown_file",t)}function Xy(n){return(typeof n=="object"&&n!==null&&("name"in n&&n.name&&String(n.name)||"url"in n&&n.url&&String(n.url)||"filename"in n&&n.filename&&String(n.filename)||"path"in n&&n.path&&String(n.path))||"").split(/[\\/]/).pop()||void 0}const w6=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",Ku=async(n,e)=>({...n,body:await Mte(n.body,e)}),FU=new WeakMap;function kte(n){const e=typeof n=="function"?n:n.fetch,t=FU.get(e);if(t)return t;const r=(async()=>{try{const i="Response"in e?e.Response:(await e("data:,")).constructor,a=new FormData;return a.toString()!==await new i(a).text()}catch{return!0}})();return FU.set(e,r),r}const Mte=async(n,e)=>{if(!await kte(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const t=new FormData;return await Promise.all(Object.entries(n||{}).map(([r,i])=>k1(t,r,i))),t},Dte=n=>n instanceof Blob&&"name"in n,k1=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(t instanceof Response)n.append(e,pp([await t.blob()],Xy(t)));else if(w6(t))n.append(e,pp([await new Response(l6(t)).blob()],Xy(t)));else if(Dte(t))n.append(e,t,Xy(t));else if(Array.isArray(t))await Promise.all(t.map(r=>k1(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,i])=>k1(n,`${e}[${r}]`,i)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}},E6=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",$te=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&E6(n),Lte=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function";async function Ute(n,e,t){if(b6(),n=await n,$te(n))return n instanceof File?n:pp([await n.arrayBuffer()],n.name);if(Lte(n)){const i=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()),pp(await M1(i),e,t)}const r=await M1(n);if(e||(e=Xy(n)),!(t!=null&&t.type)){const i=r.find(a=>typeof a=="object"&&"type"in a&&a.type);typeof i=="string"&&(t={...t,type:i})}return pp(r,e,t)}async function M1(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(E6(n))e.push(n instanceof Blob?n:await n.arrayBuffer());else if(w6(n))for await(const r of n)e.push(...await M1(r));else{const r=(t=n==null?void 0:n.constructor)==null?void 0:t.name;throw new Error(`Unexpected data type: ${typeof n}${r?`; constructor: ${r}`:""}${jte(n)}`)}return e}function jte(n){return typeof n!="object"||n===null?"":`; props: [${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}let Ct=class{constructor(e){this._client=e}};function S6(n){return n.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const Fte=(n=S6)=>function(t,...r){if(t.length===1)return t[0];let i=!1;const a=t.reduce((d,p,m)=>(/[?#]/.test(p)&&(i=!0),d+p+(m===r.length?"":(i?encodeURIComponent:n)(String(r[m])))),""),s=a.split(/[?#]/,1)[0],o=[],u=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let c;for(;(c=u.exec(s))!==null;)o.push({start:c.index,length:c[0].length});if(o.length>0){let d=0;const p=o.reduce((m,y)=>{const b=" ".repeat(y.start-d),w="^".repeat(y.length);return d=y.start+y.length,m+b+w},"");throw new Et(`Path parameters result in path with invalid segments:
${a}
${p}`)}return a},nt=Fte(S6);let T6=class extends Ct{list(e,t={},r){return this._client.getAPIList(nt`/chat/completions/${e}/messages`,ir,{query:t,...r})}};function Bte(n){return typeof n.parse=="function"}const Zv=n=>(n==null?void 0:n.role)==="assistant",A6=n=>(n==null?void 0:n.role)==="tool";var D1,Qy,ev,Zh,Xh,tv,Qh,wo,ep,Xv,Qv,_f,C6;class DI{constructor(){D1.add(this),this.controller=new AbortController,Qy.set(this,void 0),ev.set(this,()=>{}),Zh.set(this,()=>{}),Xh.set(this,void 0),tv.set(this,()=>{}),Qh.set(this,()=>{}),wo.set(this,{}),ep.set(this,!1),Xv.set(this,!1),Qv.set(this,!1),_f.set(this,!1),Tt(this,Qy,new Promise((e,t)=>{Tt(this,ev,e,"f"),Tt(this,Zh,t,"f")})),Tt(this,Xh,new Promise((e,t)=>{Tt(this,tv,e,"f"),Tt(this,Qh,t,"f")})),xe(this,Qy,"f").catch(()=>{}),xe(this,Xh,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},xe(this,D1,"m",C6).bind(this))},0)}_connected(){this.ended||(xe(this,ev,"f").call(this),this._emit("connect"))}get ended(){return xe(this,ep,"f")}get errored(){return xe(this,Xv,"f")}get aborted(){return xe(this,Qv,"f")}abort(){this.controller.abort()}on(e,t){return(xe(this,wo,"f")[e]||(xe(this,wo,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=xe(this,wo,"f")[e];if(!r)return this;const i=r.findIndex(a=>a.listener===t);return i>=0&&r.splice(i,1),this}once(e,t){return(xe(this,wo,"f")[e]||(xe(this,wo,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{Tt(this,_f,!0),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){Tt(this,_f,!0),await xe(this,Xh,"f")}_emit(e,...t){if(xe(this,ep,"f"))return;e==="end"&&(Tt(this,ep,!0),xe(this,tv,"f").call(this));const r=xe(this,wo,"f")[e];if(r&&(xe(this,wo,"f")[e]=r.filter(i=>!i.once),r.forEach(({listener:i})=>i(...t))),e==="abort"){const i=t[0];!xe(this,_f,"f")&&!(r!=null&&r.length)&&Promise.reject(i),xe(this,Zh,"f").call(this,i),xe(this,Qh,"f").call(this,i),this._emit("end");return}if(e==="error"){const i=t[0];!xe(this,_f,"f")&&!(r!=null&&r.length)&&Promise.reject(i),xe(this,Zh,"f").call(this,i),xe(this,Qh,"f").call(this,i),this._emit("end")}}_emitFinal(){}}Qy=new WeakMap,ev=new WeakMap,Zh=new WeakMap,Xh=new WeakMap,tv=new WeakMap,Qh=new WeakMap,wo=new WeakMap,ep=new WeakMap,Xv=new WeakMap,Qv=new WeakMap,_f=new WeakMap,D1=new WeakSet,C6=function(e){if(Tt(this,Xv,!0),e instanceof Error&&e.name==="AbortError"&&(e=new sa),e instanceof sa)return Tt(this,Qv,!0),this._emit("abort",e);if(e instanceof Et)return this._emit("error",e);if(e instanceof Error){const t=new Et(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new Et(String(e)))};function qte(n,e){const t={...n};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function $I(n){return(n==null?void 0:n.$brand)==="auto-parseable-response-format"}function ym(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function Vte(n,e){return!e||!R6(e)?{...n,choices:n.choices.map(t=>({...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:LI(n,e)}function LI(n,e){const t=n.choices.map(r=>{var i;if(r.finish_reason==="length")throw new a6;if(r.finish_reason==="content_filter")throw new s6;return{...r,message:{...r.message,...r.message.tool_calls?{tool_calls:((i=r.message.tool_calls)==null?void 0:i.map(a=>Hte(e,a)))??void 0}:void 0,parsed:r.message.content&&!r.message.refusal?zte(e,r.message.content):null}}});return{...n,choices:t}}function zte(n,e){var t,r;return((t=n.response_format)==null?void 0:t.type)!=="json_schema"?null:((r=n.response_format)==null?void 0:r.type)==="json_schema"?"$parseRaw"in n.response_format?n.response_format.$parseRaw(e):JSON.parse(e):null}function Hte(n,e){var r;const t=(r=n.tools)==null?void 0:r.find(i=>{var a;return((a=i.function)==null?void 0:a.name)===e.function.name});return{...e,function:{...e.function,parsed_arguments:ym(t)?t.$parseRaw(e.function.arguments):t!=null&&t.function.strict?JSON.parse(e.function.arguments):null}}}function Gte(n,e){var r;if(!n)return!1;const t=(r=n.tools)==null?void 0:r.find(i=>{var a;return((a=i.function)==null?void 0:a.name)===e.function.name});return ym(t)||(t==null?void 0:t.function.strict)||!1}function R6(n){var e;return $I(n.response_format)?!0:((e=n.tools)==null?void 0:e.some(t=>ym(t)||t.type==="function"&&t.function.strict===!0))??!1}function Wte(n){for(const e of n??[]){if(e.type!=="function")throw new Et(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new Et(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}var li,$1,e_,L1,U1,j1,I6,P6;const Kte=10;class x6 extends DI{constructor(){super(...arguments),li.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){var r;this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=(r=e.choices[0])==null?void 0:r.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),A6(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(Zv(e)&&e.tool_calls)for(const r of e.tool_calls)r.type==="function"&&this._emit("functionToolCall",r.function)}}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new Et("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),xe(this,li,"m",$1).call(this)}async finalMessage(){return await this.done(),xe(this,li,"m",e_).call(this)}async finalFunctionToolCall(){return await this.done(),xe(this,li,"m",L1).call(this)}async finalFunctionToolCallResult(){return await this.done(),xe(this,li,"m",U1).call(this)}async totalUsage(){return await this.done(),xe(this,li,"m",j1).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=xe(this,li,"m",e_).call(this);t&&this._emit("finalMessage",t);const r=xe(this,li,"m",$1).call(this);r&&this._emit("finalContent",r);const i=xe(this,li,"m",L1).call(this);i&&this._emit("finalFunctionToolCall",i);const a=xe(this,li,"m",U1).call(this);a!=null&&this._emit("finalFunctionToolCallResult",a),this._chatCompletions.some(s=>s.usage)&&this._emit("totalUsage",xe(this,li,"m",j1).call(this))}async _createChatCompletion(e,t,r){const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),xe(this,li,"m",I6).call(this,t);const a=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(LI(a,t))}async _runChatCompletion(e,t,r){for(const i of t.messages)this._addMessage(i,!1);return await this._createChatCompletion(e,t,r)}async _runTools(e,t,r){var y,b,w;const i="tool",{tool_choice:a="auto",stream:s,...o}=t,u=typeof a!="string"&&((y=a==null?void 0:a.function)==null?void 0:y.name),{maxChatCompletions:c=Kte}=r||{},d=t.tools.map(S=>{if(ym(S)){if(!S.$callback)throw new Et("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:S.$callback,name:S.function.name,description:S.function.description||"",parameters:S.function.parameters,parse:S.$parseRaw,strict:!0}}}return S}),p={};for(const S of d)S.type==="function"&&(p[S.function.name||S.function.function.name]=S.function);const m="tools"in t?d.map(S=>S.type==="function"?{type:"function",function:{name:S.function.name||S.function.function.name,parameters:S.function.parameters,description:S.function.description,strict:S.function.strict}}:S):void 0;for(const S of t.messages)this._addMessage(S,!1);for(let S=0;S<c;++S){const C=(b=(await this._createChatCompletion(e,{...o,tool_choice:a,tools:m,messages:[...this.messages]},r)).choices[0])==null?void 0:b.message;if(!C)throw new Et("missing message in ChatCompletion response");if(!((w=C.tool_calls)!=null&&w.length))return;for(const A of C.tool_calls){if(A.type!=="function")continue;const I=A.id,{name:x,arguments:L}=A.function,U=p[x];if(U){if(u&&u!==x){const J=`Invalid tool_call: ${JSON.stringify(x)}. ${JSON.stringify(u)} requested. Please try again`;this._addMessage({role:i,tool_call_id:I,content:J});continue}}else{const J=`Invalid tool_call: ${JSON.stringify(x)}. Available options are: ${Object.keys(p).map(V=>JSON.stringify(V)).join(", ")}. Please try again`;this._addMessage({role:i,tool_call_id:I,content:J});continue}let N;try{N=Bte(U)?await U.parse(L):L}catch(J){const V=J instanceof Error?J.message:String(J);this._addMessage({role:i,tool_call_id:I,content:V});continue}const B=await U.function(N,this),q=xe(this,li,"m",P6).call(this,B);if(this._addMessage({role:i,tool_call_id:I,content:q}),u)return}}}}li=new WeakSet,$1=function(){return xe(this,li,"m",e_).call(this).content??null},e_=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Zv(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new Et("stream ended without producing a ChatCompletionMessage with role=assistant")},L1=function(){var e,t;for(let r=this.messages.length-1;r>=0;r--){const i=this.messages[r];if(Zv(i)&&((e=i==null?void 0:i.tool_calls)!=null&&e.length))return(t=i.tool_calls.at(-1))==null?void 0:t.function}},U1=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(A6(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(r=>{var i;return r.role==="assistant"&&((i=r.tool_calls)==null?void 0:i.some(a=>a.type==="function"&&a.id===t.tool_call_id))}))return t.content}},j1=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},I6=function(e){if(e.n!=null&&e.n>1)throw new Et("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},P6=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)};class UI extends x6{static runTools(e,t,r){const i=new UI,a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,t,a)),i}_addMessage(e,t=!0){super._addMessage(e,t),Zv(e)&&e.content&&this._emit("content",e.content)}}const O6=1,N6=2,k6=4,M6=8,D6=16,$6=32,L6=64,U6=128,j6=256,F6=U6|j6,B6=D6|$6|F6|L6,q6=O6|N6|B6,V6=k6|M6,Jte=q6|V6,Rr={STR:O6,NUM:N6,ARR:k6,OBJ:M6,NULL:D6,BOOL:$6,NAN:L6,INFINITY:U6,MINUS_INFINITY:j6,INF:F6,SPECIAL:B6,ATOM:q6,COLLECTION:V6,ALL:Jte};class Yte extends Error{}class Zte extends Error{}function Xte(n,e=Rr.ALL){if(typeof n!="string")throw new TypeError(`expecting str, got ${typeof n}`);if(!n.trim())throw new Error(`${n} is empty`);return Qte(n.trim(),e)}const Qte=(n,e)=>{const t=n.length;let r=0;const i=m=>{throw new Yte(`${m} at position ${r}`)},a=m=>{throw new Zte(`${m} at position ${r}`)},s=()=>(p(),r>=t&&i("Unexpected end of input"),n[r]==='"'?o():n[r]==="{"?u():n[r]==="["?c():n.substring(r,r+4)==="null"||Rr.NULL&e&&t-r<4&&"null".startsWith(n.substring(r))?(r+=4,null):n.substring(r,r+4)==="true"||Rr.BOOL&e&&t-r<4&&"true".startsWith(n.substring(r))?(r+=4,!0):n.substring(r,r+5)==="false"||Rr.BOOL&e&&t-r<5&&"false".startsWith(n.substring(r))?(r+=5,!1):n.substring(r,r+8)==="Infinity"||Rr.INFINITY&e&&t-r<8&&"Infinity".startsWith(n.substring(r))?(r+=8,1/0):n.substring(r,r+9)==="-Infinity"||Rr.MINUS_INFINITY&e&&1<t-r&&t-r<9&&"-Infinity".startsWith(n.substring(r))?(r+=9,-1/0):n.substring(r,r+3)==="NaN"||Rr.NAN&e&&t-r<3&&"NaN".startsWith(n.substring(r))?(r+=3,NaN):d()),o=()=>{const m=r;let y=!1;for(r++;r<t&&(n[r]!=='"'||y&&n[r-1]==="\\");)y=n[r]==="\\"?!y:!1,r++;if(n.charAt(r)=='"')try{return JSON.parse(n.substring(m,++r-Number(y)))}catch(b){a(String(b))}else if(Rr.STR&e)try{return JSON.parse(n.substring(m,r-Number(y))+'"')}catch{return JSON.parse(n.substring(m,n.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},u=()=>{r++,p();const m={};try{for(;n[r]!=="}";){if(p(),r>=t&&Rr.OBJ&e)return m;const y=o();p(),r++;try{const b=s();Object.defineProperty(m,y,{value:b,writable:!0,enumerable:!0,configurable:!0})}catch(b){if(Rr.OBJ&e)return m;throw b}p(),n[r]===","&&r++}}catch{if(Rr.OBJ&e)return m;i("Expected '}' at end of object")}return r++,m},c=()=>{r++;const m=[];try{for(;n[r]!=="]";)m.push(s()),p(),n[r]===","&&r++}catch{if(Rr.ARR&e)return m;i("Expected ']' at end of array")}return r++,m},d=()=>{if(r===0){n==="-"&&Rr.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(n)}catch(y){if(Rr.NUM&e)try{return n[n.length-1]==="."?JSON.parse(n.substring(0,n.lastIndexOf("."))):JSON.parse(n.substring(0,n.lastIndexOf("e")))}catch{}a(String(y))}}const m=r;for(n[r]==="-"&&r++;n[r]&&!",]}".includes(n[r]);)r++;r==t&&!(Rr.NUM&e)&&i("Unterminated number literal");try{return JSON.parse(n.substring(m,r))}catch{n.substring(m,r)==="-"&&Rr.NUM&e&&i("Not sure what '-' is");try{return JSON.parse(n.substring(m,n.lastIndexOf("e")))}catch(b){a(String(b))}}},p=()=>{for(;r<t&&` 
\r	`.includes(n[r]);)r++};return s()},BU=n=>Xte(n,Rr.ALL^Rr.NUM);var fr,mo,tf,ml,UA,dy,jA,FA,BA,hy,qA,qU;class Up extends x6{constructor(e){super(),fr.add(this),mo.set(this,void 0),tf.set(this,void 0),ml.set(this,void 0),Tt(this,mo,e),Tt(this,tf,[])}get currentChatCompletionSnapshot(){return xe(this,ml,"f")}static fromReadableStream(e){const t=new Up(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){const i=new Up(t);return i._run(()=>i._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createChatCompletion(e,t,r){var s;super._createChatCompletion;const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),xe(this,fr,"m",UA).call(this);const a=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});this._connected();for await(const o of a)xe(this,fr,"m",jA).call(this,o);if((s=a.controller.signal)!=null&&s.aborted)throw new sa;return this._addChatCompletion(xe(this,fr,"m",hy).call(this))}async _fromReadableStream(e,t){var s;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),xe(this,fr,"m",UA).call(this),this._connected();const i=Lp.fromReadableStream(e,this.controller);let a;for await(const o of i)a&&a!==o.id&&this._addChatCompletion(xe(this,fr,"m",hy).call(this)),xe(this,fr,"m",jA).call(this,o),a=o.id;if((s=i.controller.signal)!=null&&s.aborted)throw new sa;return this._addChatCompletion(xe(this,fr,"m",hy).call(this))}[(mo=new WeakMap,tf=new WeakMap,ml=new WeakMap,fr=new WeakSet,UA=function(){this.ended||Tt(this,ml,void 0)},dy=function(t){let r=xe(this,tf,"f")[t.index];return r||(r={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},xe(this,tf,"f")[t.index]=r,r)},jA=function(t){var i,a,s,o,u,c,d,p,m,y,b,w,S,T,C;if(this.ended)return;const r=xe(this,fr,"m",qU).call(this,t);this._emit("chunk",t,r);for(const A of t.choices){const I=r.choices[A.index];A.delta.content!=null&&((i=I.message)==null?void 0:i.role)==="assistant"&&((a=I.message)!=null&&a.content)&&(this._emit("content",A.delta.content,I.message.content),this._emit("content.delta",{delta:A.delta.content,snapshot:I.message.content,parsed:I.message.parsed})),A.delta.refusal!=null&&((s=I.message)==null?void 0:s.role)==="assistant"&&((o=I.message)!=null&&o.refusal)&&this._emit("refusal.delta",{delta:A.delta.refusal,snapshot:I.message.refusal}),((u=A.logprobs)==null?void 0:u.content)!=null&&((c=I.message)==null?void 0:c.role)==="assistant"&&this._emit("logprobs.content.delta",{content:(d=A.logprobs)==null?void 0:d.content,snapshot:((p=I.logprobs)==null?void 0:p.content)??[]}),((m=A.logprobs)==null?void 0:m.refusal)!=null&&((y=I.message)==null?void 0:y.role)==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:(b=A.logprobs)==null?void 0:b.refusal,snapshot:((w=I.logprobs)==null?void 0:w.refusal)??[]});const x=xe(this,fr,"m",dy).call(this,I);I.finish_reason&&(xe(this,fr,"m",BA).call(this,I),x.current_tool_call_index!=null&&xe(this,fr,"m",FA).call(this,I,x.current_tool_call_index));for(const L of A.delta.tool_calls??[])x.current_tool_call_index!==L.index&&(xe(this,fr,"m",BA).call(this,I),x.current_tool_call_index!=null&&xe(this,fr,"m",FA).call(this,I,x.current_tool_call_index)),x.current_tool_call_index=L.index;for(const L of A.delta.tool_calls??[]){const U=(S=I.message.tool_calls)==null?void 0:S[L.index];U!=null&&U.type&&((U==null?void 0:U.type)==="function"?this._emit("tool_calls.function.arguments.delta",{name:(T=U.function)==null?void 0:T.name,index:L.index,arguments:U.function.arguments,parsed_arguments:U.function.parsed_arguments,arguments_delta:((C=L.function)==null?void 0:C.arguments)??""}):(U==null||U.type,void 0))}}},FA=function(t,r){var s,o,u;if(xe(this,fr,"m",dy).call(this,t).done_tool_calls.has(r))return;const a=(s=t.message.tool_calls)==null?void 0:s[r];if(!a)throw new Error("no tool call snapshot");if(!a.type)throw new Error("tool call snapshot missing `type`");if(a.type==="function"){const c=(u=(o=xe(this,mo,"f"))==null?void 0:o.tools)==null?void 0:u.find(d=>d.type==="function"&&d.function.name===a.function.name);this._emit("tool_calls.function.arguments.done",{name:a.function.name,index:r,arguments:a.function.arguments,parsed_arguments:ym(c)?c.$parseRaw(a.function.arguments):c!=null&&c.function.strict?JSON.parse(a.function.arguments):null})}else a.type},BA=function(t){var i,a;const r=xe(this,fr,"m",dy).call(this,t);if(t.message.content&&!r.content_done){r.content_done=!0;const s=xe(this,fr,"m",qA).call(this);this._emit("content.done",{content:t.message.content,parsed:s?s.$parseRaw(t.message.content):null})}t.message.refusal&&!r.refusal_done&&(r.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),(i=t.logprobs)!=null&&i.content&&!r.logprobs_content_done&&(r.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),(a=t.logprobs)!=null&&a.refusal&&!r.logprobs_refusal_done&&(r.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},hy=function(){if(this.ended)throw new Et("stream has ended, this shouldn't happen");const t=xe(this,ml,"f");if(!t)throw new Et("request ended without sending any chunks");return Tt(this,ml,void 0),Tt(this,tf,[]),ene(t,xe(this,mo,"f"))},qA=function(){var r;const t=(r=xe(this,mo,"f"))==null?void 0:r.response_format;return $I(t)?t:null},qU=function(t){var r,i,a,s;let o=xe(this,ml,"f");const{choices:u,...c}=t;o?Object.assign(o,c):o=Tt(this,ml,{...c,choices:[]});for(const{delta:d,finish_reason:p,index:m,logprobs:y=null,...b}of t.choices){let w=o.choices[m];if(w||(w=o.choices[m]={finish_reason:p,index:m,message:{},logprobs:y,...b}),y)if(!w.logprobs)w.logprobs=Object.assign({},y);else{const{content:L,refusal:U,...N}=y;Object.assign(w.logprobs,N),L&&((r=w.logprobs).content??(r.content=[]),w.logprobs.content.push(...L)),U&&((i=w.logprobs).refusal??(i.refusal=[]),w.logprobs.refusal.push(...U))}if(p&&(w.finish_reason=p,xe(this,mo,"f")&&R6(xe(this,mo,"f")))){if(p==="length")throw new a6;if(p==="content_filter")throw new s6}if(Object.assign(w,b),!d)continue;const{content:S,refusal:T,function_call:C,role:A,tool_calls:I,...x}=d;if(Object.assign(w.message,x),T&&(w.message.refusal=(w.message.refusal||"")+T),A&&(w.message.role=A),C&&(w.message.function_call?(C.name&&(w.message.function_call.name=C.name),C.arguments&&((a=w.message.function_call).arguments??(a.arguments=""),w.message.function_call.arguments+=C.arguments)):w.message.function_call=C),S&&(w.message.content=(w.message.content||"")+S,!w.message.refusal&&xe(this,fr,"m",qA).call(this)&&(w.message.parsed=BU(w.message.content))),I){w.message.tool_calls||(w.message.tool_calls=[]);for(const{index:L,id:U,type:N,function:B,...q}of I){const J=(s=w.message.tool_calls)[L]??(s[L]={});Object.assign(J,q),U&&(J.id=U),N&&(J.type=N),B&&(J.function??(J.function={name:B.name??"",arguments:""})),B!=null&&B.name&&(J.function.name=B.name),B!=null&&B.arguments&&(J.function.arguments+=B.arguments,Gte(xe(this,mo,"f"),J)&&(J.function.parsed_arguments=BU(J.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("chunk",i=>{const a=t.shift();a?a.resolve(i):e.push(i)}),this.on("end",()=>{r=!0;for(const i of t)i.resolve(void 0);t.length=0}),this.on("abort",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),this.on("error",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,s)=>t.push({resolve:a,reject:s})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Lp(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function ene(n,e){const{id:t,choices:r,created:i,model:a,system_fingerprint:s,...o}=n,u={...o,id:t,choices:r.map(({message:c,finish_reason:d,index:p,logprobs:m,...y})=>{if(!d)throw new Et(`missing finish_reason for choice ${p}`);const{content:b=null,function_call:w,tool_calls:S,...T}=c,C=c.role;if(!C)throw new Et(`missing role for choice ${p}`);if(w){const{arguments:A,name:I}=w;if(A==null)throw new Et(`missing function_call.arguments for choice ${p}`);if(!I)throw new Et(`missing function_call.name for choice ${p}`);return{...y,message:{content:b,function_call:{arguments:A,name:I},role:C,refusal:c.refusal??null},finish_reason:d,index:p,logprobs:m}}return S?{...y,index:p,finish_reason:d,logprobs:m,message:{...T,role:C,content:b,refusal:c.refusal??null,tool_calls:S.map((A,I)=>{const{function:x,type:L,id:U,...N}=A,{arguments:B,name:q,...J}=x||{};if(U==null)throw new Et(`missing choices[${p}].tool_calls[${I}].id
${py(n)}`);if(L==null)throw new Et(`missing choices[${p}].tool_calls[${I}].type
${py(n)}`);if(q==null)throw new Et(`missing choices[${p}].tool_calls[${I}].function.name
${py(n)}`);if(B==null)throw new Et(`missing choices[${p}].tool_calls[${I}].function.arguments
${py(n)}`);return{...N,id:U,type:L,function:{...J,name:q,arguments:B}}})}}:{...y,message:{...T,content:b,role:C,refusal:c.refusal??null},finish_reason:d,index:p,logprobs:m}}),created:i,model:a,object:"chat.completion",...s?{system_fingerprint:s}:{}};return Vte(u,e)}function py(n){return JSON.stringify(n)}class t_ extends Up{static fromReadableStream(e){const t=new t_(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,r){const i=new t_(t),a={...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"runTools"}};return i._run(()=>i._runTools(e,t,a)),i}}let jI=class extends Ct{constructor(){super(...arguments),this.messages=new T6(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(nt`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(nt`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/chat/completions",ir,{query:e,...t})}delete(e,t){return this._client.delete(nt`/chat/completions/${e}`,t)}parse(e,t){return Wte(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t==null?void 0:t.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(r=>LI(r,e))}runTools(e,t){return e.stream?t_.runTools(this._client,e,t):UI.runTools(this._client,e,t)}stream(e,t){return Up.createChatCompletion(this._client,e,t)}};jI.Messages=T6;let FI=class extends Ct{constructor(){super(...arguments),this.completions=new jI(this._client)}};FI.Completions=jI;const z6=Symbol("brand.privateNullableHeaders");function*tne(n){if(!n)return;if(z6 in n){const{values:r,nulls:i}=n;yield*r.entries();for(const a of i)yield[a,null];return}let e=!1,t;n instanceof Headers?t=n.entries():IU(n)?t=n:(e=!0,t=Object.entries(n??{}));for(let r of t){const i=r[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");const a=IU(r[1])?r[1]:[r[1]];let s=!1;for(const o of a)o!==void 0&&(e&&!s&&(s=!0,yield[i,null]),yield[i,o])}}const mt=n=>{const e=new Headers,t=new Set;for(const r of n){const i=new Set;for(const[a,s]of tne(r)){const o=a.toLowerCase();i.has(o)||(e.delete(a),i.add(o)),s===null?(e.delete(a),t.add(o)):(e.append(a,s),t.delete(o))}}return{[z6]:!0,values:e,nulls:t}};class H6 extends Ct{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:mt([{Accept:"application/octet-stream"},t==null?void 0:t.headers]),__binaryResponse:!0})}}class G6 extends Ct{create(e,t){return this._client.post("/audio/transcriptions",Ku({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class W6 extends Ct{create(e,t){return this._client.post("/audio/translations",Ku({body:e,...t,__metadata:{model:e.model}},this._client))}}class vm extends Ct{constructor(){super(...arguments),this.transcriptions=new G6(this._client),this.translations=new W6(this._client),this.speech=new H6(this._client)}}vm.Transcriptions=G6;vm.Translations=W6;vm.Speech=H6;let K6=class extends Ct{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(nt`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",ir,{query:e,...t})}cancel(e,t){return this._client.post(nt`/batches/${e}/cancel`,t)}};class J6 extends Ct{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:mt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(nt`/assistants/${e}`,{...t,headers:mt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,r){return this._client.post(nt`/assistants/${e}`,{body:t,...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e={},t){return this._client.getAPIList("/assistants",ir,{query:e,...t,headers:mt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete(nt`/assistants/${e}`,{...t,headers:mt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}class Y6 extends Ct{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:mt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}class Z6 extends Ct{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:mt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}}class hb extends Ct{constructor(){super(...arguments),this.sessions=new Y6(this._client),this.transcriptionSessions=new Z6(this._client)}}hb.Sessions=Y6;hb.TranscriptionSessions=Z6;let X6=class extends Ct{create(e,t,r){return this._client.post(nt`/threads/${e}/messages`,{body:t,...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}retrieve(e,t,r){const{thread_id:i}=t;return this._client.get(nt`/threads/${i}/messages/${e}`,{...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}update(e,t,r){const{thread_id:i,...a}=t;return this._client.post(nt`/threads/${i}/messages/${e}`,{body:a,...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e,t={},r){return this._client.getAPIList(nt`/threads/${e}/messages`,ir,{query:t,...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}delete(e,t,r){const{thread_id:i}=t;return this._client.delete(nt`/threads/${i}/messages/${e}`,{...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}};class Q6 extends Ct{retrieve(e,t,r){const{thread_id:i,run_id:a,...s}=t;return this._client.get(nt`/threads/${i}/runs/${a}/steps/${e}`,{query:s,...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e,t,r){const{thread_id:i,...a}=t;return this._client.getAPIList(nt`/threads/${i}/runs/${e}/steps`,ir,{query:a,...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}}const nne=n=>{if(typeof Ou<"u"){const e=Ou.from(n,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{const e=atob(n),t=e.length,r=new Uint8Array(t);for(let i=0;i<t;i++)r[i]=e.charCodeAt(i);return Array.from(new Float32Array(r.buffer))}};var VA={};const nf=n=>{var e,t,r,i;if(typeof globalThis.process<"u")return((e=VA==null?void 0:VA[n])==null?void 0:e.trim())??void 0;if(typeof globalThis.Deno<"u")return(i=(r=(t=globalThis.Deno.env)==null?void 0:t.get)==null?void 0:r.call(t,n))==null?void 0:i.trim()};var Fr,Su,F1,Ps,nv,es,Tu,If,bu,n_,ra,rv,iv,mp,tp,np,VU,zU,HU,GU,WU,KU,JU;class gp extends DI{constructor(){super(...arguments),Fr.add(this),F1.set(this,[]),Ps.set(this,{}),nv.set(this,{}),es.set(this,void 0),Tu.set(this,void 0),If.set(this,void 0),bu.set(this,void 0),n_.set(this,void 0),ra.set(this,void 0),rv.set(this,void 0),iv.set(this,void 0),mp.set(this,void 0)}[(F1=new WeakMap,Ps=new WeakMap,nv=new WeakMap,es=new WeakMap,Tu=new WeakMap,If=new WeakMap,bu=new WeakMap,n_=new WeakMap,ra=new WeakMap,rv=new WeakMap,iv=new WeakMap,mp=new WeakMap,Fr=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",i=>{const a=t.shift();a?a.resolve(i):e.push(i)}),this.on("end",()=>{r=!0;for(const i of t)i.resolve(void 0);t.length=0}),this.on("abort",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),this.on("error",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,s)=>t.push({resolve:a,reject:s})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new Su;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){var a;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();const i=Lp.fromReadableStream(e,this.controller);for await(const s of i)xe(this,Fr,"m",tp).call(this,s);if((a=i.controller.signal)!=null&&a.aborted)throw new sa;return this._addRun(xe(this,Fr,"m",np).call(this))}toReadableStream(){return new Lp(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,r,i){const a=new Su;return a._run(()=>a._runToolAssistantStream(e,t,r,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,r,i){var u;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const s={...r,stream:!0},o=await e.submitToolOutputs(t,s,{...i,signal:this.controller.signal});this._connected();for await(const c of o)xe(this,Fr,"m",tp).call(this,c);if((u=o.controller.signal)!=null&&u.aborted)throw new sa;return this._addRun(xe(this,Fr,"m",np).call(this))}static createThreadAssistantStream(e,t,r){const i=new Su;return i._run(()=>i._threadAssistantStream(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}static createAssistantStream(e,t,r,i){const a=new Su;return a._run(()=>a._runAssistantStream(e,t,r,{...i,headers:{...i==null?void 0:i.headers,"X-Stainless-Helper-Method":"stream"}})),a}currentEvent(){return xe(this,rv,"f")}currentRun(){return xe(this,iv,"f")}currentMessageSnapshot(){return xe(this,es,"f")}currentRunStepSnapshot(){return xe(this,mp,"f")}async finalRunSteps(){return await this.done(),Object.values(xe(this,Ps,"f"))}async finalMessages(){return await this.done(),Object.values(xe(this,nv,"f"))}async finalRun(){if(await this.done(),!xe(this,Tu,"f"))throw Error("Final run was not received.");return xe(this,Tu,"f")}async _createThreadAssistantStream(e,t,r){var o;const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));const a={...t,stream:!0},s=await e.createAndRun(a,{...r,signal:this.controller.signal});this._connected();for await(const u of s)xe(this,Fr,"m",tp).call(this,u);if((o=s.controller.signal)!=null&&o.aborted)throw new sa;return this._addRun(xe(this,Fr,"m",np).call(this))}async _createAssistantStream(e,t,r,i){var u;const a=i==null?void 0:i.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));const s={...r,stream:!0},o=await e.create(t,s,{...i,signal:this.controller.signal});this._connected();for await(const c of o)xe(this,Fr,"m",tp).call(this,c);if((u=o.controller.signal)!=null&&u.aborted)throw new sa;return this._addRun(xe(this,Fr,"m",np).call(this))}static accumulateDelta(e,t){for(const[r,i]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=i;continue}let a=e[r];if(a==null){e[r]=i;continue}if(r==="index"||r==="type"){e[r]=i;continue}if(typeof a=="string"&&typeof i=="string")a+=i;else if(typeof a=="number"&&typeof i=="number")a+=i;else if(DA(a)&&DA(i))a=this.accumulateDelta(a,i);else if(Array.isArray(a)&&Array.isArray(i)){if(a.every(s=>typeof s=="string"||typeof s=="number")){a.push(...i);continue}for(const s of i){if(!DA(s))throw new Error(`Expected array delta entry to be an object but got: ${s}`);const o=s.index;if(o==null)throw console.error(s),new Error("Expected array delta entry to have an `index` property");if(typeof o!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${o}`);const u=a[o];u==null?a.push(s):a[o]=this.accumulateDelta(u,s)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${i}, accValue: ${a}`);e[r]=a}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,i){return await this._createAssistantStream(t,e,r,i)}async _runToolAssistantStream(e,t,r,i){return await this._createToolAssistantStream(t,e,r,i)}}Su=gp,tp=function(e){if(!this.ended)switch(Tt(this,rv,e),xe(this,Fr,"m",HU).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":xe(this,Fr,"m",JU).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":xe(this,Fr,"m",zU).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":xe(this,Fr,"m",VU).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},np=function(){if(this.ended)throw new Et("stream has ended, this shouldn't happen");if(!xe(this,Tu,"f"))throw Error("Final run has not been received");return xe(this,Tu,"f")},VU=function(e){const[t,r]=xe(this,Fr,"m",WU).call(this,e,xe(this,es,"f"));Tt(this,es,t),xe(this,nv,"f")[t.id]=t;for(const i of r){const a=t.content[i.index];(a==null?void 0:a.type)=="text"&&this._emit("textCreated",a.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const i of e.data.delta.content){if(i.type=="text"&&i.text){let a=i.text,s=t.content[i.index];if(s&&s.type=="text")this._emit("textDelta",a,s.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(i.index!=xe(this,If,"f")){if(xe(this,bu,"f"))switch(xe(this,bu,"f").type){case"text":this._emit("textDone",xe(this,bu,"f").text,xe(this,es,"f"));break;case"image_file":this._emit("imageFileDone",xe(this,bu,"f").image_file,xe(this,es,"f"));break}Tt(this,If,i.index)}Tt(this,bu,t.content[i.index])}break;case"thread.message.completed":case"thread.message.incomplete":if(xe(this,If,"f")!==void 0){const i=e.data.content[xe(this,If,"f")];if(i)switch(i.type){case"image_file":this._emit("imageFileDone",i.image_file,xe(this,es,"f"));break;case"text":this._emit("textDone",i.text,xe(this,es,"f"));break}}xe(this,es,"f")&&this._emit("messageDone",e.data),Tt(this,es,void 0)}},zU=function(e){const t=xe(this,Fr,"m",GU).call(this,e);switch(Tt(this,mp,t),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const r=e.data.delta;if(r.step_details&&r.step_details.type=="tool_calls"&&r.step_details.tool_calls&&t.step_details.type=="tool_calls")for(const a of r.step_details.tool_calls)a.index==xe(this,n_,"f")?this._emit("toolCallDelta",a,t.step_details.tool_calls[a.index]):(xe(this,ra,"f")&&this._emit("toolCallDone",xe(this,ra,"f")),Tt(this,n_,a.index),Tt(this,ra,t.step_details.tool_calls[a.index]),xe(this,ra,"f")&&this._emit("toolCallCreated",xe(this,ra,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":Tt(this,mp,void 0),e.data.step_details.type=="tool_calls"&&xe(this,ra,"f")&&(this._emit("toolCallDone",xe(this,ra,"f")),Tt(this,ra,void 0)),this._emit("runStepDone",e.data,t);break}},HU=function(e){xe(this,F1,"f").push(e),this._emit("event",e)},GU=function(e){switch(e.event){case"thread.run.step.created":return xe(this,Ps,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=xe(this,Ps,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){const i=Su.accumulateDelta(t,r.delta);xe(this,Ps,"f")[e.data.id]=i}return xe(this,Ps,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":xe(this,Ps,"f")[e.data.id]=e.data;break}if(xe(this,Ps,"f")[e.data.id])return xe(this,Ps,"f")[e.data.id];throw new Error("No snapshot available")},WU=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let i=e.data;if(i.delta.content)for(const a of i.delta.content)if(a.index in t.content){let s=t.content[a.index];t.content[a.index]=xe(this,Fr,"m",KU).call(this,a,s)}else t.content[a.index]=a,r.push(a);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},KU=function(e,t){return Su.accumulateDelta(t,e)},JU=function(e){switch(Tt(this,iv,e.data),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":Tt(this,Tu,e.data),xe(this,ra,"f")&&(this._emit("toolCallDone",xe(this,ra,"f")),Tt(this,ra,void 0));break}};let BI=class extends Ct{constructor(){super(...arguments),this.steps=new Q6(this._client)}create(e,t,r){const{include:i,...a}=t;return this._client.post(nt`/threads/${e}/runs`,{query:{include:i},body:a,...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers]),stream:t.stream??!1})}retrieve(e,t,r){const{thread_id:i}=t;return this._client.get(nt`/threads/${i}/runs/${e}`,{...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}update(e,t,r){const{thread_id:i,...a}=t;return this._client.post(nt`/threads/${i}/runs/${e}`,{body:a,...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e,t={},r){return this._client.getAPIList(nt`/threads/${e}/runs`,ir,{query:t,...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}cancel(e,t,r){const{thread_id:i}=t;return this._client.post(nt`/threads/${i}/runs/${e}/cancel`,{...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async createAndPoll(e,t,r){const i=await this.create(e,t,r);return await this.poll(i.id,{thread_id:e},r)}createAndStream(e,t,r){return gp.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){var a;const i=mt([r==null?void 0:r.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((a=r==null?void 0:r.pollIntervalMs)==null?void 0:a.toString())??void 0}]);for(;;){const{data:s,response:o}=await this.retrieve(e,t,{...r,headers:{...r==null?void 0:r.headers,...i}}).withResponse();switch(s.status){case"queued":case"in_progress":case"cancelling":let u=5e3;if(r!=null&&r.pollIntervalMs)u=r.pollIntervalMs;else{const c=o.headers.get("openai-poll-after-ms");if(c){const d=parseInt(c);isNaN(d)||(u=d)}}await gm(u);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return s}}}stream(e,t,r){return gp.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r){const{thread_id:i,...a}=t;return this._client.post(nt`/threads/${i}/runs/${e}/submit_tool_outputs`,{body:a,...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,r){const i=await this.submitToolOutputs(e,t,r);return await this.poll(i.id,t,r)}submitToolOutputsStream(e,t,r){return gp.createToolAssistantStream(e,this._client.beta.threads.runs,t,r)}};BI.Steps=Q6;class pb extends Ct{constructor(){super(...arguments),this.runs=new BI(this._client),this.messages=new X6(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:mt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(nt`/threads/${e}`,{...t,headers:mt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,r){return this._client.post(nt`/threads/${e}`,{body:t,...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}delete(e,t){return this._client.delete(nt`/threads/${e}`,{...t,headers:mt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:mt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){const r=await this.createAndRun(e,t);return await this.runs.poll(r.id,{thread_id:r.thread_id},t)}createAndRunStream(e,t){return gp.createThreadAssistantStream(e,this._client.beta.threads,t)}}pb.Runs=BI;pb.Messages=X6;let _m=class extends Ct{constructor(){super(...arguments),this.realtime=new hb(this._client),this.assistants=new J6(this._client),this.threads=new pb(this._client)}};_m.Realtime=hb;_m.Assistants=J6;_m.Threads=pb;let e5=class extends Ct{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};class t5 extends Ct{retrieve(e,t,r){const{container_id:i}=t;return this._client.get(nt`/containers/${i}/files/${e}/content`,{...r,headers:mt([{Accept:"application/binary"},r==null?void 0:r.headers]),__binaryResponse:!0})}}let qI=class extends Ct{constructor(){super(...arguments),this.content=new t5(this._client)}create(e,t,r){return this._client.post(nt`/containers/${e}/files`,Ku({body:t,...r},this._client))}retrieve(e,t,r){const{container_id:i}=t;return this._client.get(nt`/containers/${i}/files/${e}`,r)}list(e,t={},r){return this._client.getAPIList(nt`/containers/${e}/files`,ir,{query:t,...r})}delete(e,t,r){const{container_id:i}=t;return this._client.delete(nt`/containers/${i}/files/${e}`,{...r,headers:mt([{Accept:"*/*"},r==null?void 0:r.headers])})}};qI.Content=t5;class VI extends Ct{constructor(){super(...arguments),this.files=new qI(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(nt`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",ir,{query:e,...t})}delete(e,t){return this._client.delete(nt`/containers/${e}`,{...t,headers:mt([{Accept:"*/*"},t==null?void 0:t.headers])})}}VI.Files=qI;let n5=class extends Ct{create(e,t){const r=!!e.encoding_format;let i=r?e.encoding_format:"base64";r&&Zr(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);const a=this._client.post("/embeddings",{body:{...e,encoding_format:i},...t});return r?a:(Zr(this._client).debug("embeddings/decoding base64 embeddings from base64"),a._thenUnwrap(s=>(s&&s.data&&s.data.forEach(o=>{const u=o.embedding;o.embedding=nne(u)}),s)))}};class r5 extends Ct{retrieve(e,t,r){const{eval_id:i,run_id:a}=t;return this._client.get(nt`/evals/${i}/runs/${a}/output_items/${e}`,r)}list(e,t,r){const{eval_id:i,...a}=t;return this._client.getAPIList(nt`/evals/${i}/runs/${e}/output_items`,ir,{query:a,...r})}}class zI extends Ct{constructor(){super(...arguments),this.outputItems=new r5(this._client)}create(e,t,r){return this._client.post(nt`/evals/${e}/runs`,{body:t,...r})}retrieve(e,t,r){const{eval_id:i}=t;return this._client.get(nt`/evals/${i}/runs/${e}`,r)}list(e,t={},r){return this._client.getAPIList(nt`/evals/${e}/runs`,ir,{query:t,...r})}delete(e,t,r){const{eval_id:i}=t;return this._client.delete(nt`/evals/${i}/runs/${e}`,r)}cancel(e,t,r){const{eval_id:i}=t;return this._client.post(nt`/evals/${i}/runs/${e}`,r)}}zI.OutputItems=r5;class HI extends Ct{constructor(){super(...arguments),this.runs=new zI(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(nt`/evals/${e}`,t)}update(e,t,r){return this._client.post(nt`/evals/${e}`,{body:t,...r})}list(e={},t){return this._client.getAPIList("/evals",ir,{query:e,...t})}delete(e,t){return this._client.delete(nt`/evals/${e}`,t)}}HI.Runs=zI;let i5=class extends Ct{create(e,t){return this._client.post("/files",Ku({body:e,...t},this._client))}retrieve(e,t){return this._client.get(nt`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",ir,{query:e,...t})}delete(e,t){return this._client.delete(nt`/files/${e}`,t)}content(e,t){return this._client.get(nt`/files/${e}/content`,{...t,headers:mt([{Accept:"application/binary"},t==null?void 0:t.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=30*60*1e3}={}){const i=new Set(["processed","error","deleted"]),a=Date.now();let s=await this.retrieve(e);for(;!s.status||!i.has(s.status);)if(await gm(t),s=await this.retrieve(e),Date.now()-a>r)throw new cb({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return s}};class a5 extends Ct{}let s5=class extends Ct{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};class GI extends Ct{constructor(){super(...arguments),this.graders=new s5(this._client)}}GI.Graders=s5;class o5 extends Ct{create(e,t,r){return this._client.getAPIList(nt`/fine_tuning/checkpoints/${e}/permissions`,db,{body:t,method:"post",...r})}retrieve(e,t={},r){return this._client.get(nt`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...r})}delete(e,t,r){const{fine_tuned_model_checkpoint:i}=t;return this._client.delete(nt`/fine_tuning/checkpoints/${i}/permissions/${e}`,r)}}let WI=class extends Ct{constructor(){super(...arguments),this.permissions=new o5(this._client)}};WI.Permissions=o5;class l5 extends Ct{list(e,t={},r){return this._client.getAPIList(nt`/fine_tuning/jobs/${e}/checkpoints`,ir,{query:t,...r})}}class KI extends Ct{constructor(){super(...arguments),this.checkpoints=new l5(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(nt`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",ir,{query:e,...t})}cancel(e,t){return this._client.post(nt`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return this._client.getAPIList(nt`/fine_tuning/jobs/${e}/events`,ir,{query:t,...r})}pause(e,t){return this._client.post(nt`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(nt`/fine_tuning/jobs/${e}/resume`,t)}}KI.Checkpoints=l5;class vd extends Ct{constructor(){super(...arguments),this.methods=new a5(this._client),this.jobs=new KI(this._client),this.checkpoints=new WI(this._client),this.alpha=new GI(this._client)}}vd.Methods=a5;vd.Jobs=KI;vd.Checkpoints=WI;vd.Alpha=GI;class u5 extends Ct{}class JI extends Ct{constructor(){super(...arguments),this.graderModels=new u5(this._client)}}JI.GraderModels=u5;class c5 extends Ct{createVariation(e,t){return this._client.post("/images/variations",Ku({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",Ku({body:e,...t},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}let f5=class extends Ct{retrieve(e,t){return this._client.get(nt`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",db,e)}delete(e,t){return this._client.delete(nt`/models/${e}`,t)}};class d5 extends Ct{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function rne(n,e){return!e||!ane(e)?{...n,output_parsed:null,output:n.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(r=>({...r,parsed:null}))}:t)}:h5(n,e)}function h5(n,e){const t=n.output.map(i=>{if(i.type==="function_call")return{...i,parsed_arguments:lne(e,i)};if(i.type==="message"){const a=i.content.map(s=>s.type==="output_text"?{...s,parsed:ine(e,s.text)}:s);return{...i,content:a}}return i}),r=Object.assign({},n,{output:t});return Object.getOwnPropertyDescriptor(n,"output_text")||B1(r),Object.defineProperty(r,"output_parsed",{enumerable:!0,get(){for(const i of r.output)if(i.type==="message"){for(const a of i.content)if(a.type==="output_text"&&a.parsed!==null)return a.parsed}return null}}),r}function ine(n,e){var t,r,i,a;return((r=(t=n.text)==null?void 0:t.format)==null?void 0:r.type)!=="json_schema"?null:"$parseRaw"in((i=n.text)==null?void 0:i.format)?((a=n.text)==null?void 0:a.format).$parseRaw(e):JSON.parse(e)}function ane(n){var e;return!!$I((e=n.text)==null?void 0:e.format)}function sne(n){return(n==null?void 0:n.$brand)==="auto-parseable-tool"}function one(n,e){return n.find(t=>t.type==="function"&&t.name===e)}function lne(n,e){const t=one(n.tools??[],e.name);return{...e,...e,parsed_arguments:sne(t)?t.$parseRaw(e.arguments):t!=null&&t.strict?JSON.parse(e.arguments):null}}function B1(n){const e=[];for(const t of n.output)if(t.type==="message")for(const r of t.content)r.type==="output_text"&&e.push(r.text);n.output_text=e.join("")}var rf,my,gl,gy,YU,ZU,XU,QU;class YI extends DI{constructor(e){super(),rf.add(this),my.set(this,void 0),gl.set(this,void 0),gy.set(this,void 0),Tt(this,my,e)}static createResponse(e,t,r){const i=new YI(t);return i._run(()=>i._createOrRetrieveResponse(e,t,{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createOrRetrieveResponse(e,t,r){var o;const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),xe(this,rf,"m",YU).call(this);let a,s=null;"response_id"in t?(a=await e.responses.retrieve(t.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),s=t.starting_after??null):a=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal}),this._connected();for await(const u of a)xe(this,rf,"m",ZU).call(this,u,s);if((o=a.controller.signal)!=null&&o.aborted)throw new sa;return xe(this,rf,"m",XU).call(this)}[(my=new WeakMap,gl=new WeakMap,gy=new WeakMap,rf=new WeakSet,YU=function(){this.ended||Tt(this,gl,void 0)},ZU=function(t,r){if(this.ended)return;const i=(s,o)=>{(r==null||o.sequence_number>r)&&this._emit(s,o)},a=xe(this,rf,"m",QU).call(this,t);switch(i("event",t),t.type){case"response.output_text.delta":{const s=a.output[t.output_index];if(!s)throw new Et(`missing output at index ${t.output_index}`);if(s.type==="message"){const o=s.content[t.content_index];if(!o)throw new Et(`missing content at index ${t.content_index}`);if(o.type!=="output_text")throw new Et(`expected content to be 'output_text', got ${o.type}`);i("response.output_text.delta",{...t,snapshot:o.text})}break}case"response.function_call_arguments.delta":{const s=a.output[t.output_index];if(!s)throw new Et(`missing output at index ${t.output_index}`);s.type==="function_call"&&i("response.function_call_arguments.delta",{...t,snapshot:s.arguments});break}default:i(t.type,t);break}},XU=function(){if(this.ended)throw new Et("stream has ended, this shouldn't happen");const t=xe(this,gl,"f");if(!t)throw new Et("request ended without sending any events");Tt(this,gl,void 0);const r=une(t,xe(this,my,"f"));return Tt(this,gy,r),r},QU=function(t){let r=xe(this,gl,"f");if(!r){if(t.type!=="response.created")throw new Et(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return r=Tt(this,gl,t.response),r}switch(t.type){case"response.output_item.added":{r.output.push(t.item);break}case"response.content_part.added":{const i=r.output[t.output_index];if(!i)throw new Et(`missing output at index ${t.output_index}`);i.type==="message"&&i.content.push(t.part);break}case"response.output_text.delta":{const i=r.output[t.output_index];if(!i)throw new Et(`missing output at index ${t.output_index}`);if(i.type==="message"){const a=i.content[t.content_index];if(!a)throw new Et(`missing content at index ${t.content_index}`);if(a.type!=="output_text")throw new Et(`expected content to be 'output_text', got ${a.type}`);a.text+=t.delta}break}case"response.function_call_arguments.delta":{const i=r.output[t.output_index];if(!i)throw new Et(`missing output at index ${t.output_index}`);i.type==="function_call"&&(i.arguments+=t.delta);break}case"response.completed":{Tt(this,gl,t.response);break}}return r},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("event",i=>{const a=t.shift();a?a.resolve(i):e.push(i)}),this.on("end",()=>{r=!0;for(const i of t)i.resolve(void 0);t.length=0}),this.on("abort",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),this.on("error",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,s)=>t.push({resolve:a,reject:s})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();const e=xe(this,gy,"f");if(!e)throw new Et("stream ended without producing a ChatCompletion");return e}}function une(n,e){return rne(n,e)}class p5 extends Ct{list(e,t={},r){return this._client.getAPIList(nt`/responses/${e}/input_items`,ir,{query:t,...r})}}class ZI extends Ct{constructor(){super(...arguments),this.inputItems=new p5(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(r=>("object"in r&&r.object==="response"&&B1(r),r))}retrieve(e,t={},r){return this._client.get(nt`/responses/${e}`,{query:t,...r,stream:(t==null?void 0:t.stream)??!1})._thenUnwrap(i=>("object"in i&&i.object==="response"&&B1(i),i))}delete(e,t){return this._client.delete(nt`/responses/${e}`,{...t,headers:mt([{Accept:"*/*"},t==null?void 0:t.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(r=>h5(r,e))}stream(e,t){return YI.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(nt`/responses/${e}/cancel`,t)}}ZI.InputItems=p5;class m5 extends Ct{create(e,t,r){return this._client.post(nt`/uploads/${e}/parts`,Ku({body:t,...r},this._client))}}class XI extends Ct{constructor(){super(...arguments),this.parts=new m5(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(nt`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(nt`/uploads/${e}/complete`,{body:t,...r})}}XI.Parts=m5;const cne=async n=>{const e=await Promise.allSettled(n),t=e.filter(i=>i.status==="rejected");if(t.length){for(const i of t)console.error(i.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}const r=[];for(const i of e)i.status==="fulfilled"&&r.push(i.value);return r};class g5 extends Ct{create(e,t,r){return this._client.post(nt`/vector_stores/${e}/file_batches`,{body:t,...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}retrieve(e,t,r){const{vector_store_id:i}=t;return this._client.get(nt`/vector_stores/${i}/file_batches/${e}`,{...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}cancel(e,t,r){const{vector_store_id:i}=t;return this._client.post(nt`/vector_stores/${i}/file_batches/${e}/cancel`,{...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async createAndPoll(e,t,r){const i=await this.create(e,t);return await this.poll(e,i.id,r)}listFiles(e,t,r){const{vector_store_id:i,...a}=t;return this._client.getAPIList(nt`/vector_stores/${i}/file_batches/${e}/files`,ir,{query:a,...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async poll(e,t,r){var a;const i=mt([r==null?void 0:r.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((a=r==null?void 0:r.pollIntervalMs)==null?void 0:a.toString())??void 0}]);for(;;){const{data:s,response:o}=await this.retrieve(t,{vector_store_id:e},{...r,headers:i}).withResponse();switch(s.status){case"in_progress":let u=5e3;if(r!=null&&r.pollIntervalMs)u=r.pollIntervalMs;else{const c=o.headers.get("openai-poll-after-ms");if(c){const d=parseInt(c);isNaN(d)||(u=d)}}await gm(u);break;case"failed":case"cancelled":case"completed":return s}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},i){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const a=(i==null?void 0:i.maxConcurrency)??5,s=Math.min(a,t.length),o=this._client,u=t.values(),c=[...r];async function d(m){for(let y of m){const b=await o.files.create({file:y,purpose:"assistants"},i);c.push(b.id)}}const p=Array(s).fill(u).map(d);return await cne(p),await this.createAndPoll(e,{file_ids:c})}}let y5=class extends Ct{create(e,t,r){return this._client.post(nt`/vector_stores/${e}/files`,{body:t,...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}retrieve(e,t,r){const{vector_store_id:i}=t;return this._client.get(nt`/vector_stores/${i}/files/${e}`,{...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}update(e,t,r){const{vector_store_id:i,...a}=t;return this._client.post(nt`/vector_stores/${i}/files/${e}`,{body:a,...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e,t={},r){return this._client.getAPIList(nt`/vector_stores/${e}/files`,ir,{query:t,...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}delete(e,t,r){const{vector_store_id:i}=t;return this._client.delete(nt`/vector_stores/${i}/files/${e}`,{...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}async createAndPoll(e,t,r){const i=await this.create(e,t,r);return await this.poll(e,i.id,r)}async poll(e,t,r){var a;const i=mt([r==null?void 0:r.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":((a=r==null?void 0:r.pollIntervalMs)==null?void 0:a.toString())??void 0}]);for(;;){const s=await this.retrieve(t,{vector_store_id:e},{...r,headers:i}).withResponse(),o=s.data;switch(o.status){case"in_progress":let u=5e3;if(r!=null&&r.pollIntervalMs)u=r.pollIntervalMs;else{const c=s.response.headers.get("openai-poll-after-ms");if(c){const d=parseInt(c);isNaN(d)||(u=d)}}await gm(u);break;case"failed":case"completed":return o}}}async upload(e,t,r){const i=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:i.id},r)}async uploadAndPoll(e,t,r){const i=await this.upload(e,t,r);return await this.poll(e,i.id,r)}content(e,t,r){const{vector_store_id:i}=t;return this._client.getAPIList(nt`/vector_stores/${i}/files/${e}/content`,db,{...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}};class mb extends Ct{constructor(){super(...arguments),this.files=new y5(this._client),this.fileBatches=new g5(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:mt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}retrieve(e,t){return this._client.get(nt`/vector_stores/${e}`,{...t,headers:mt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}update(e,t,r){return this._client.post(nt`/vector_stores/${e}`,{body:t,...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",ir,{query:e,...t,headers:mt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}delete(e,t){return this._client.delete(nt`/vector_stores/${e}`,{...t,headers:mt([{"OpenAI-Beta":"assistants=v2"},t==null?void 0:t.headers])})}search(e,t,r){return this._client.getAPIList(nt`/vector_stores/${e}/search`,db,{body:t,method:"post",...r,headers:mt([{"OpenAI-Beta":"assistants=v2"},r==null?void 0:r.headers])})}}mb.Files=y5;mb.FileBatches=g5;var bf,v5,av;class _5 extends Ct{constructor(){super(...arguments),bf.add(this)}async unwrap(e,t,r=this._client.webhookSecret,i=300){return await this.verifySignature(e,t,r,i),JSON.parse(e)}async verifySignature(e,t,r=this._client.webhookSecret,i=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");xe(this,bf,"m",v5).call(this,r);const a=mt([t]).values,s=xe(this,bf,"m",av).call(this,a,"webhook-signature"),o=xe(this,bf,"m",av).call(this,a,"webhook-timestamp"),u=xe(this,bf,"m",av).call(this,a,"webhook-id"),c=parseInt(o,10);if(isNaN(c))throw new Wh("Invalid webhook timestamp format");const d=Math.floor(Date.now()/1e3);if(d-c>i)throw new Wh("Webhook timestamp is too old");if(c>d+i)throw new Wh("Webhook timestamp is too new");const p=s.split(" ").map(w=>w.startsWith("v1,")?w.substring(3):w),m=r.startsWith("whsec_")?Ou.from(r.replace("whsec_",""),"base64"):Ou.from(r,"utf-8"),y=u?`${u}.${o}.${e}`:`${o}.${e}`,b=await crypto.subtle.importKey("raw",m,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(const w of p)try{const S=Ou.from(w,"base64");if(await crypto.subtle.verify("HMAC",b,S,new TextEncoder().encode(y)))return}catch{continue}throw new Wh("The given webhook signature does not match the expected signature")}}bf=new WeakSet,v5=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},av=function(e,t){if(!e)throw new Error("Headers are required");const r=e.get(t);if(r==null)throw new Error(`Missing required header: ${t}`);return r};var q1,QI,sv,b5;let Wt=class{constructor({baseURL:e=nf("OPENAI_BASE_URL"),apiKey:t=nf("OPENAI_API_KEY"),organization:r=nf("OPENAI_ORG_ID")??null,project:i=nf("OPENAI_PROJECT_ID")??null,webhookSecret:a=nf("OPENAI_WEBHOOK_SECRET")??null,...s}={}){if(q1.add(this),sv.set(this,void 0),this.completions=new e5(this),this.chat=new FI(this),this.embeddings=new n5(this),this.files=new i5(this),this.images=new c5(this),this.audio=new vm(this),this.moderations=new d5(this),this.models=new f5(this),this.fineTuning=new vd(this),this.graders=new JI(this),this.vectorStores=new mb(this),this.webhooks=new _5(this),this.beta=new _m(this),this.batches=new K6(this),this.uploads=new XI(this),this.responses=new ZI(this),this.evals=new HI(this),this.containers=new VI(this),t===void 0)throw new Et("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const o={apiKey:t,organization:r,project:i,webhookSecret:a,...s,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&cte())throw new Et(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=o.baseURL,this.timeout=o.timeout??QI.DEFAULT_TIMEOUT,this.logger=o.logger??console;const u="warn";this.logLevel=u,this.logLevel=UU(o.logLevel,"ClientOptions.logLevel",this)??UU(nf("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??u,this.fetchOptions=o.fetchOptions,this.maxRetries=o.maxRetries??2,this.fetch=o.fetch??mte(),Tt(this,sv,yte),this._options=o,this.apiKey=t,this.organization=r,this.project=i,this.webhookSecret=a}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}authHeaders(e){return mt([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return Ste(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${vf}`}defaultIdempotencyKey(){return`stainless-node-retry-${Y3()}`}makeStatusError(e,t,r,i){return Ui.generate(e,t,r,i)}buildURL(e,t,r){const i=!xe(this,q1,"m",b5).call(this)&&r||this.baseURL,a=ite(e)?new URL(e):new URL(i+(i.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return ste(s)||(t={...s,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(a.search=this.stringifyQuery(t)),a.toString()}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(i=>({method:e,path:t,...i})))}request(e,t=null){return new y6(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,r){var T,C;const i=await e,a=i.maxRetries??this.maxRetries;t==null&&(t=a),await this.prepareOptions(i);const{req:s,url:o,timeout:u}=this.buildRequest(i,{retryCount:a-t});await this.prepareRequest(s,{url:o,options:i});const c="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),d=r===void 0?"":`, retryOf: ${r}`,p=Date.now();if(Zr(this).debug(`[${c}] sending request`,gu({retryOfRequestLogID:r,method:i.method,url:o,options:i,headers:s.headers})),(T=i.signal)!=null&&T.aborted)throw new sa;const m=new AbortController,y=await this.fetchWithTimeout(o,s,u,m).catch(x1),b=Date.now();if(y instanceof Error){const A=`retrying, ${t} attempts remaining`;if((C=i.signal)!=null&&C.aborted)throw new sa;const I=P1(y)||/timed? ?out/i.test(String(y)+("cause"in y?String(y.cause):""));if(t)return Zr(this).info(`[${c}] connection ${I?"timed out":"failed"} - ${A}`),Zr(this).debug(`[${c}] connection ${I?"timed out":"failed"} (${A})`,gu({retryOfRequestLogID:r,url:o,durationMs:b-p,message:y.message})),this.retryRequest(i,t,r??c);throw Zr(this).info(`[${c}] connection ${I?"timed out":"failed"} - error; no more retries left`),Zr(this).debug(`[${c}] connection ${I?"timed out":"failed"} (error; no more retries left)`,gu({retryOfRequestLogID:r,url:o,durationMs:b-p,message:y.message})),I?new cb:new ub({cause:y})}const w=[...y.headers.entries()].filter(([A])=>A==="x-request-id").map(([A,I])=>", "+A+": "+JSON.stringify(I)).join(""),S=`[${c}${d}${w}] ${s.method} ${o} ${y.ok?"succeeded":"failed"} with status ${y.status} in ${b-p}ms`;if(!y.ok){const A=this.shouldRetry(y);if(t&&A){const B=`retrying, ${t} attempts remaining`;return await gte(y.body),Zr(this).info(`${S} - ${B}`),Zr(this).debug(`[${c}] response error (${B})`,gu({retryOfRequestLogID:r,url:y.url,status:y.status,headers:y.headers,durationMs:b-p})),this.retryRequest(i,t,r??c,y.headers)}const I=A?"error; no more retries left":"error; not retryable";Zr(this).info(`${S} - ${I}`);const x=await y.text().catch(B=>x1(B).message),L=ute(x),U=L?void 0:x;throw Zr(this).debug(`[${c}] response error (${I})`,gu({retryOfRequestLogID:r,url:y.url,status:y.status,headers:y.headers,message:U,durationMs:Date.now()-p})),this.makeStatusError(y.status,L,U,y.headers)}return Zr(this).info(S),Zr(this).debug(`[${c}] response start`,gu({retryOfRequestLogID:r,url:y.url,status:y.status,headers:y.headers,durationMs:b-p})),{response:y,options:i,controller:m,requestLogID:c,retryOfRequestLogID:r,startTime:p}}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}requestAPIList(e,t){const r=this.makeRequest(t,null,void 0);return new Nte(this,r,e)}async fetchWithTimeout(e,t,r,i){const{signal:a,method:s,...o}=t||{};a&&a.addEventListener("abort",()=>i.abort());const u=setTimeout(()=>i.abort(),r),c=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||typeof o.body=="object"&&o.body!==null&&Symbol.asyncIterator in o.body,d={signal:i.signal,...c?{duplex:"half"}:{},method:"GET",...o};s&&(d.method=s.toUpperCase());try{return await this.fetch.call(void 0,e,d)}finally{clearTimeout(u)}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r,i){let a;const s=i==null?void 0:i.get("retry-after-ms");if(s){const u=parseFloat(s);Number.isNaN(u)||(a=u)}const o=i==null?void 0:i.get("retry-after");if(o&&!a){const u=parseFloat(o);Number.isNaN(u)?a=Date.parse(o)-Date.now():a=u*1e3}if(!(a&&0<=a&&a<60*1e3)){const u=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,u)}return await gm(a),this.makeRequest(e,t-1,r)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,s=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return s*o*1e3}buildRequest(e,{retryCount:t=0}={}){const r={...e},{method:i,path:a,query:s,defaultBaseURL:o}=r,u=this.buildURL(a,s,o);"timeout"in r&&lte("timeout",r.timeout),r.timeout=r.timeout??this.timeout;const{bodyHeaders:c,body:d}=this.buildBody({options:r}),p=this.buildHeaders({options:e,method:i,bodyHeaders:c,retryCount:t});return{req:{method:i,headers:p,...r.signal&&{signal:r.signal},...globalThis.ReadableStream&&d instanceof globalThis.ReadableStream&&{duplex:"half"},...d&&{body:d},...this.fetchOptions??{},...r.fetchOptions??{}},url:u,timeout:r.timeout}}buildHeaders({options:e,method:t,bodyHeaders:r,retryCount:i}){let a={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const s=mt([a,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...pte(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},this.authHeaders(e),this._options.defaultHeaders,r,e.headers]);return this.validateHeaders(s),s.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const r=mt([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&r.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:l6(e)}:xe(this,sv,"f").call(this,{body:e,headers:r})}};QI=Wt,sv=new WeakMap,q1=new WeakSet,b5=function(){return this.baseURL!=="https://api.openai.com/v1"};Wt.OpenAI=QI;Wt.DEFAULT_TIMEOUT=6e5;Wt.OpenAIError=Et;Wt.APIError=Ui;Wt.APIConnectionError=ub;Wt.APIConnectionTimeoutError=cb;Wt.APIUserAbortError=sa;Wt.NotFoundError=e6;Wt.ConflictError=t6;Wt.RateLimitError=r6;Wt.BadRequestError=Z3;Wt.AuthenticationError=X3;Wt.InternalServerError=i6;Wt.PermissionDeniedError=Q3;Wt.UnprocessableEntityError=n6;Wt.InvalidWebhookSignatureError=Wh;Wt.toFile=Ute;Wt.Completions=e5;Wt.Chat=FI;Wt.Embeddings=n5;Wt.Files=i5;Wt.Images=c5;Wt.Audio=vm;Wt.Moderations=d5;Wt.Models=f5;Wt.FineTuning=vd;Wt.Graders=JI;Wt.VectorStores=mb;Wt.Webhooks=_5;Wt.Beta=_m;Wt.Batches=K6;Wt.Uploads=XI;Wt.Responses=ZI;Wt.Evals=HI;Wt.Containers=VI;class ms extends qt{static lc_name(){return"RunnablePassthrough"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e&&(this.func=e.func)}async invoke(e,t){const r=Jt(t);return this.func&&await this.func(e,r),this._callWithConfig(i=>Promise.resolve(i),e,r)}async*transform(e,t){const r=Jt(t);let i,a=!0;for await(const s of this._transformStreamWithConfig(e,o=>o,r))if(yield s,a)if(i===void 0)i=s;else try{i=fi(i,s)}catch{i=void 0,a=!1}this.func&&i!==void 0&&await this.func(i,r)}static assign(e){return new rI(new Vl({steps:e}))}}function fne(){const n=new TextEncoder;return new TransformStream({transform(e,t){t.enqueue(n.encode(typeof e.content=="string"?e.content:JSON.stringify(e.content)))}})}function zA(n){const e=[];for(const t of n){let r=t;if(Array.isArray(t.content))for(let i=0;i<t.content.length;i++){const a=t.content[i];($F(a)||LF(a))&&r===t&&(r=new t.constructor({...r,content:[...t.content.slice(0,i),UF(a),...t.content.slice(i+1)]}))}e.push(r)}return e}class ui extends uI{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]}),Object.defineProperty(this,"disableStreaming",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_separateRunnableConfigFromCallOptionsCompat(e){const[t,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=t.signal,[t,r]}async invoke(e,t){const r=ui._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t==null?void 0:t.callbacks)).generations[0][0].message}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}async*_streamIterator(e,t){var r;if(this._streamResponseChunks===ui.prototype._streamResponseChunks||this.disableStreaming)yield this.invoke(e,t);else{const a=ui._convertInputToPromptValue(e).toChatMessages(),[s,o]=this._separateRunnableConfigFromCallOptionsCompat(t),u={...s.metadata,...this.getLsParams(o)},c=await Jn.configure(s.callbacks,this.callbacks,s.tags,this.tags,u,this.metadata,{verbose:this.verbose}),d={options:o,invocation_params:this==null?void 0:this.invocationParams(o),batch_size:1},p=await(c==null?void 0:c.handleChatModelStart(this.toJSON(),[zA(a)],s.runId,void 0,d,void 0,void 0,s.runName));let m,y;try{for await(const b of this._streamResponseChunks(a,o,p==null?void 0:p[0])){if(b.message.id==null){const w=(r=p==null?void 0:p.at(0))==null?void 0:r.runId;w!=null&&b.message._updateId(`run-${w}`)}b.message.response_metadata={...b.generationInfo,...b.message.response_metadata},yield b.message,m?m=m.concat(b):m=b,Cv(b.message)&&b.message.usage_metadata!==void 0&&(y={tokenUsage:{promptTokens:b.message.usage_metadata.input_tokens,completionTokens:b.message.usage_metadata.output_tokens,totalTokens:b.message.usage_metadata.total_tokens}})}}catch(b){throw await Promise.all((p??[]).map(w=>w==null?void 0:w.handleLLMError(b))),b}await Promise.all((p??[]).map(b=>b==null?void 0:b.handleLLMEnd({generations:[[m]],llmOutput:y})))}}getLsParams(e){const t=this.getName().startsWith("Chat")?this.getName().replace("Chat",""):this.getName();return{ls_model_type:"chat",ls_stop:e.stop,ls_provider:t}}async _generateUncached(e,t,r,i){var p,m;const a=e.map(y=>y.map(is));let s;if(i!==void 0&&i.length===a.length)s=i;else{const y={...r.metadata,...this.getLsParams(t)},b=await Jn.configure(r.callbacks,this.callbacks,r.tags,this.tags,y,this.metadata,{verbose:this.verbose}),w={options:t,invocation_params:this==null?void 0:this.invocationParams(t),batch_size:1};s=await(b==null?void 0:b.handleChatModelStart(this.toJSON(),a.map(zA),r.runId,void 0,w,void 0,void 0,r.runName))}const o=[],u=[];if(!!(s!=null&&s[0].handlers.find(KR))&&!this.disableStreaming&&a.length===1&&this._streamResponseChunks!==ui.prototype._streamResponseChunks)try{const y=await this._streamResponseChunks(a[0],t,s==null?void 0:s[0]);let b,w;for await(const S of y){if(S.message.id==null){const T=(p=s==null?void 0:s.at(0))==null?void 0:p.runId;T!=null&&S.message._updateId(`run-${T}`)}b===void 0?b=S:b=fi(b,S),Cv(S.message)&&S.message.usage_metadata!==void 0&&(w={tokenUsage:{promptTokens:S.message.usage_metadata.input_tokens,completionTokens:S.message.usage_metadata.output_tokens,totalTokens:S.message.usage_metadata.total_tokens}})}if(b===void 0)throw new Error("Received empty response from chat model call.");o.push([b]),await(s==null?void 0:s[0].handleLLMEnd({generations:o,llmOutput:w}))}catch(y){throw await(s==null?void 0:s[0].handleLLMError(y)),y}else{const y=await Promise.allSettled(a.map((b,w)=>this._generate(b,{...t,promptIndex:w},s==null?void 0:s[w])));await Promise.all(y.map(async(b,w)=>{var S,T,C;if(b.status==="fulfilled"){const A=b.value;for(const I of A.generations){if(I.message.id==null){const x=(S=s==null?void 0:s.at(0))==null?void 0:S.runId;x!=null&&I.message._updateId(`run-${x}`)}I.message.response_metadata={...I.generationInfo,...I.message.response_metadata}}return A.generations.length===1&&(A.generations[0].message.response_metadata={...A.llmOutput,...A.generations[0].message.response_metadata}),o[w]=A.generations,u[w]=A.llmOutput,(T=s==null?void 0:s[w])==null?void 0:T.handleLLMEnd({generations:[A.generations],llmOutput:A.llmOutput})}else return await((C=s==null?void 0:s[w])==null?void 0:C.handleLLMError(b.reason)),Promise.reject(b.reason)}))}const d={generations:o,llmOutput:u.length?(m=this._combineLLMOutput)==null?void 0:m.call(this,...u):void 0};return Object.defineProperty(d,Dp,{value:s?{runIds:s==null?void 0:s.map(y=>y.runId)}:void 0,configurable:!0}),d}async _generateCached({messages:e,cache:t,llmStringKey:r,parsedOptions:i,handledOptions:a}){const s=e.map(S=>S.map(is)),o={...a.metadata,...this.getLsParams(i)},u=await Jn.configure(a.callbacks,this.callbacks,a.tags,this.tags,o,this.metadata,{verbose:this.verbose}),c={options:i,invocation_params:this==null?void 0:this.invocationParams(i),batch_size:1},d=await(u==null?void 0:u.handleChatModelStart(this.toJSON(),s.map(zA),a.runId,void 0,c,void 0,void 0,a.runName)),p=[],y=(await Promise.allSettled(s.map(async(S,T)=>{const C=ui._convertInputToPromptValue(S).toString(),A=await t.lookup(C,r);return A==null&&p.push(T),A}))).map((S,T)=>({result:S,runManager:d==null?void 0:d[T]})).filter(({result:S})=>S.status==="fulfilled"&&S.value!=null||S.status==="rejected"),b=[];await Promise.all(y.map(async({result:S,runManager:T},C)=>{if(S.status==="fulfilled"){const A=S.value;return b[C]=A.map(I=>("message"in I&&Ln(I.message)&&ua(I.message)&&(I.message.usage_metadata={input_tokens:0,output_tokens:0,total_tokens:0}),I.generationInfo={...I.generationInfo,tokenUsage:{}},I)),A.length&&await(T==null?void 0:T.handleLLMNewToken(A[0].text)),T==null?void 0:T.handleLLMEnd({generations:[A]},void 0,void 0,void 0,{cached:!0})}else return await(T==null?void 0:T.handleLLMError(S.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(S.reason)}));const w={generations:b,missingPromptIndices:p,startedRunManagers:d};return Object.defineProperty(w,Dp,{value:d?{runIds:d==null?void 0:d.map(S=>S.runId)}:void 0,configurable:!0}),w}async generate(e,t,r){let i;Array.isArray(t)?i={stop:t}:i=t;const a=e.map(b=>b.map(is)),[s,o]=this._separateRunnableConfigFromCallOptionsCompat(i);if(s.callbacks=s.callbacks??r,!this.cache)return this._generateUncached(a,o,s);const{cache:u}=this,c=this._getSerializedCacheKeyParametersForCall(o),{generations:d,missingPromptIndices:p,startedRunManagers:m}=await this._generateCached({messages:a,cache:u,llmStringKey:c,parsedOptions:o,handledOptions:s});let y={};if(p.length>0){const b=await this._generateUncached(p.map(w=>a[w]),o,s,m!==void 0?p.map(w=>m==null?void 0:m[w]):void 0);await Promise.all(b.generations.map(async(w,S)=>{const T=p[S];d[T]=w;const C=ui._convertInputToPromptValue(a[T]).toString();return u.update(C,c,w)})),y=b.llmOutput??{}}return{generations:d,llmOutput:y}}invocationParams(e){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(e,t,r){const i=e.map(a=>a.toChatMessages());return this.generate(i,t,r)}async call(e,t,r){return(await this.generate([e.map(is)],t,r)).generations[0][0].message}async callPrompt(e,t,r){const i=e.toChatMessages();return this.call(i,t,r)}async predictMessages(e,t,r){return this.call(e,t,r)}async predict(e,t,r){const i=new ei(e),a=await this.call([i],t,r);if(typeof a.content!="string")throw new Error("Cannot use predict when output is not a string.");return a.content}withStructuredOutput(e,t){if(typeof this.bindTools!="function")throw new Error('Chat model must implement ".bindTools()" to use withStructuredOutput.');if(t!=null&&t.strict)throw new Error('"strict" mode is not supported for this model by default.');const r=e,i=t==null?void 0:t.name,a=td(r)??"A function available to call.",s=t==null?void 0:t.method,o=t==null?void 0:t.includeRaw;if(s==="jsonMode")throw new Error('Base withStructuredOutput implementation only supports "functionCalling" as a method.');let u=i??"extract",c;Pi(r)?c=[{type:"function",function:{name:u,description:a,parameters:yr(r)}}]:("name"in r&&(u=r.name),c=[{type:"function",function:{name:u,description:a,parameters:r}}]);const d=this.bindTools(c),p=_r.from(w=>{if(!w.tool_calls||w.tool_calls.length===0)throw new Error("No tool calls found in the response.");const S=w.tool_calls.find(T=>T.name===u);if(!S)throw new Error(`No tool call found with name ${u}.`);return S.args});if(!o)return d.pipe(p).withConfig({runName:"StructuredOutput"});const m=ms.assign({parsed:(w,S)=>p.invoke(w.raw,S)}),y=ms.assign({parsed:()=>null}),b=m.withFallbacks({fallbacks:[y]});return vr.from([{raw:d},b]).withConfig({runName:"StructuredOutputRunnable"})}}class dne extends ui{async _generate(e,t,r){const i=await this._call(e,t,r),a=new bn(i);if(typeof a.content!="string")throw new Error("Cannot generate with a simple chat model when output is not a string.");return{generations:[{text:a.content,message:a}]}}}const hne=Object.freeze(Object.defineProperty({__proto__:null,BaseChatModel:ui,SimpleChatModel:dne,createChatMessageChunkEncoderStream:fne},Symbol.toStringTag,{value:"Module"}));class pne extends qt{static lc_name(){return"RouterRunnable"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnables=e.runnables}async invoke(e,t){const{key:r,input:i}=e,a=this.runnables[r];if(a===void 0)throw new Error(`No runnable associated with key "${r}".`);return a.invoke(i,Jt(t))}async batch(e,t,r){var m;const i=e.map(y=>y.key),a=e.map(y=>y.input);if(i.find(y=>this.runnables[y]===void 0)!==void 0)throw new Error("One or more keys do not have a corresponding runnable.");const o=i.map(y=>this.runnables[y]),u=this._getOptionsList(t??{},e.length),c=((m=u[0])==null?void 0:m.maxConcurrency)??(r==null?void 0:r.maxConcurrency),d=c&&c>0?c:e.length,p=[];for(let y=0;y<a.length;y+=d){const b=a.slice(y,y+d).map((S,T)=>o[T].invoke(S,u[T])),w=await Promise.all(b);p.push(w)}return p.flat()}async stream(e,t){const{key:r,input:i}=e,a=this.runnables[r];if(a===void 0)throw new Error(`No runnable associated with key "${r}".`);return a.stream(i,t)}}class mne extends qt{static lc_name(){return"RunnableBranch"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"default",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"branches",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.branches=e.branches,this.default=e.default}static from(e){if(e.length<1)throw new Error("RunnableBranch requires at least one branch");const r=e.slice(0,-1).map(([a,s])=>[Vr(a),Vr(s)]),i=Vr(e[e.length-1]);return new this({branches:r,default:i})}async _invoke(e,t,r){let i;for(let a=0;a<this.branches.length;a+=1){const[s,o]=this.branches[a];if(await s.invoke(e,on(t,{callbacks:r==null?void 0:r.getChild(`condition:${a+1}`)}))){i=await o.invoke(e,on(t,{callbacks:r==null?void 0:r.getChild(`branch:${a+1}`)}));break}}return i||(i=await this.default.invoke(e,on(t,{callbacks:r==null?void 0:r.getChild("branch:default")}))),i}async invoke(e,t={}){return this._callWithConfig(this._invoke,e,t)}async*_streamIterator(e,t){const r=await $i(t),i=await(r==null?void 0:r.handleChainStart(this.toJSON(),gr(e,"input"),t==null?void 0:t.runId,void 0,void 0,void 0,t==null?void 0:t.runName));let a,s=!0,o;try{for(let u=0;u<this.branches.length;u+=1){const[c,d]=this.branches[u];if(await c.invoke(e,on(t,{callbacks:i==null?void 0:i.getChild(`condition:${u+1}`)}))){o=await d.stream(e,on(t,{callbacks:i==null?void 0:i.getChild(`branch:${u+1}`)}));for await(const m of o)if(yield m,s)if(a===void 0)a=m;else try{a=fi(a,m)}catch{a=void 0,s=!1}break}}if(o===void 0){o=await this.default.stream(e,on(t,{callbacks:i==null?void 0:i.getChild("branch:default")}));for await(const u of o)if(yield u,s)if(a===void 0)a=u;else try{a=fi(a,u)}catch{a=void 0,s=!1}}}catch(u){throw await(i==null?void 0:i.handleChainError(u)),u}await(i==null?void 0:i.handleChainEnd(a??{}))}}class gne extends di{constructor(e){let t=_r.from((s,o)=>this._enterHistory(s,o??{})).withConfig({runName:"loadHistory"});const r=e.historyMessagesKey??e.inputMessagesKey;r&&(t=ms.assign({[r]:t}).withConfig({runName:"insertHistory"}));const i=t.pipe(e.runnable.withListeners({onEnd:(s,o)=>this._exitHistory(s,o??{})})).withConfig({runName:"RunnableWithMessageHistory"}),a=e.config??{};super({...e,config:a,bound:i}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"historyMessagesKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getMessageHistory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.getMessageHistory=e.getMessageHistory,this.inputMessagesKey=e.inputMessagesKey,this.outputMessagesKey=e.outputMessagesKey,this.historyMessagesKey=e.historyMessagesKey}_getInputMessages(e){let t;if(typeof e=="object"&&!Array.isArray(e)&&!Ln(e)){let r;this.inputMessagesKey?r=this.inputMessagesKey:Object.keys(e).length===1?r=Object.keys(e)[0]:r="input",Array.isArray(e[r])&&Array.isArray(e[r][0])?t=e[r][0]:t=e[r]}else t=e;if(typeof t=="string")return[new ei(t)];if(Array.isArray(t))return t;if(Ln(t))return[t];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages.
Got ${JSON.stringify(t,null,2)}`)}_getOutputMessages(e){let t;if(!Array.isArray(e)&&!Ln(e)&&typeof e!="string"){let r;this.outputMessagesKey!==void 0?r=this.outputMessagesKey:Object.keys(e).length===1?r=Object.keys(e)[0]:r="output",e.generations!==void 0?t=e.generations[0][0].message:t=e[r]}else t=e;if(typeof t=="string")return[new bn(t)];if(Array.isArray(t))return t;if(Ln(t))return[t];throw new Error(`Expected a string, BaseMessage, or array of BaseMessages. Received: ${JSON.stringify(t,null,2)}`)}async _enterHistory(e,t){var a;const i=await((a=t==null?void 0:t.configurable)==null?void 0:a.messageHistory).getMessages();return this.historyMessagesKey===void 0?i.concat(this._getInputMessages(e)):i}async _exitHistory(e,t){var u;const r=(u=t.configurable)==null?void 0:u.messageHistory;let i;Array.isArray(e.inputs)&&Array.isArray(e.inputs[0])?i=e.inputs[0]:i=e.inputs;let a=this._getInputMessages(i);if(this.historyMessagesKey===void 0){const c=await r.getMessages();a=a.slice(c.length)}const s=e.outputs;if(!s)throw new Error(`Output values from 'Run' undefined. Run: ${JSON.stringify(e,null,2)}`);const o=this._getOutputMessages(s);await r.addMessages([...a,...o])}async _mergeConfig(...e){const t=await super._mergeConfig(...e);if(!t.configurable||!t.configurable.sessionId){const i={[this.inputMessagesKey??"input"]:"foo"},a={configurable:{sessionId:"123"}};throw new Error(`sessionId is required. Pass it in as part of the config argument to .invoke() or .stream()
eg. chain.invoke(${JSON.stringify(i)}, ${JSON.stringify(a)})`)}const{sessionId:r}=t.configurable;return t.configurable.messageHistory=await this.getMessageHistory(r),t}}const yne=Object.freeze(Object.defineProperty({__proto__:null,RouterRunnable:pne,Runnable:qt,RunnableAssign:rI,RunnableBinding:di,RunnableBranch:mne,RunnableEach:$p,RunnableLambda:_r,RunnableMap:Vl,RunnableParallel:KJ,RunnablePassthrough:ms,RunnablePick:qB,RunnableRetry:tI,RunnableSequence:vr,RunnableToolLike:p1,RunnableWithFallbacks:BB,RunnableWithMessageHistory:gne,_coerceToRunnable:Vr,ensureConfig:Jt,getCallbackManagerForConfig:$i,mergeConfigs:as,patchConfig:on,pickRunnableConfigKeys:Lo},Symbol.toStringTag,{value:"Module"}));class gb extends qt{parseResultWithPrompt(e,t,r){return this.parseResult(e,r)}_baseMessageToString(e){return typeof e.content=="string"?e.content:this._baseMessageContentToString(e.content)}_baseMessageContentToString(e){return JSON.stringify(e)}async invoke(e,t){return typeof e=="string"?this._callWithConfig(async(r,i)=>this.parseResult([{text:r}],i==null?void 0:i.callbacks),e,{...t,runType:"parser"}):this._callWithConfig(async(r,i)=>this.parseResult([{message:r,text:this._baseMessageToString(r)}],i==null?void 0:i.callbacks),e,{...t,runType:"parser"})}}class bm extends gb{parseResult(e,t){return this.parse(e[0].text,t)}async parseWithPrompt(e,t,r){return this.parse(e,r)}_type(){throw new Error("_type not implemented")}}class Na extends Error{constructor(e,t,r,i=!1){if(super(e),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=t,this.observation=r,this.sendToLLM=i,i&&(r===void 0||t===void 0))throw new Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true");D_(this,"OUTPUT_PARSING_FAILURE")}}class wm extends bm{async*_transform(e){for await(const t of e)typeof t=="string"?yield this.parseResult([{text:t}]):yield this.parseResult([{message:t,text:this._baseMessageToString(t)}])}async*transform(e,t){yield*this._transformStreamWithConfig(e,this._transform.bind(this),{...t,runType:"parser"})}}class yb extends wm{constructor(e){super(e),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=(e==null?void 0:e.diff)??this.diff}async*_transform(e){let t,r;for await(const i of e){if(typeof i!="string"&&typeof i.content!="string")throw new Error("Cannot handle non-string output.");let a;if(Zf(i)){if(typeof i.content!="string")throw new Error("Cannot handle non-string message output.");a=new ca({message:i,text:i.content})}else if(Ln(i)){if(typeof i.content!="string")throw new Error("Cannot handle non-string message output.");a=new ca({message:Iv(i),text:i.content})}else a=new Ll({text:i});r===void 0?r=a:r=r.concat(a);const s=await this.parsePartialResult([r]);s!=null&&!xu(s,t)&&(this.diff?yield this._diff(t,s):yield s,t=s)}}getFormatInstructions(){return""}}class vne extends wm{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","bytes"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"textEncoder",{enumerable:!0,configurable:!0,writable:!0,value:new TextEncoder})}static lc_name(){return"BytesOutputParser"}parse(e){return Promise.resolve(this.textEncoder.encode(e))}getFormatInstructions(){return""}}class Em extends wm{constructor(){super(...arguments),Object.defineProperty(this,"re",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}async*_transform(e){let t="";for await(const r of e)if(typeof r=="string"?t+=r:t+=r.content,this.re){const i=[...t.matchAll(this.re)];if(i.length>1){let a=0;for(const s of i.slice(0,-1))yield[s[1]],a+=(s.index??0)+s[0].length;t=t.slice(a)}}else{const i=await this.parse(t);if(i.length>1){for(const a of i.slice(0,-1))yield[a];t=i[i.length-1]}}for(const r of await this.parse(t))yield[r]}}class _ne extends Em{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","list"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"CommaSeparatedListOutputParser"}async parse(e){try{return e.trim().split(",").map(t=>t.trim())}catch{throw new Na(`Could not parse output: ${e}`,e)}}getFormatInstructions(){return"Your response should be a list of comma separated values, eg: `foo, bar, baz`"}}class bne extends Em{constructor({length:e,separator:t}){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","list"]}),Object.defineProperty(this,"length",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"separator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.length=e,this.separator=t||","}async parse(e){try{const t=e.trim().split(this.separator).map(r=>r.trim());if(this.length!==void 0&&t.length!==this.length)throw new Na(`Incorrect number of items. Expected ${this.length}, got ${t.length}.`);return t}catch(t){throw Object.getPrototypeOf(t)===Na.prototype?t:new Na(`Could not parse output: ${e}`)}}getFormatInstructions(){return`Your response should be a list of ${this.length===void 0?"":`${this.length} `}items separated by "${this.separator}" (eg: \`foo${this.separator} bar${this.separator} baz\`)`}}class wne extends Em{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","list"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"re",{enumerable:!0,configurable:!0,writable:!0,value:/\d+\.\s([^\n]+)/g})}static lc_name(){return"NumberedListOutputParser"}getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}async parse(e){return[...e.matchAll(this.re)??[]].map(t=>t[1])}}class Ene extends Em{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","list"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"re",{enumerable:!0,configurable:!0,writable:!0,value:/^\s*[-*]\s([^\n]+)$/gm})}static lc_name(){return"NumberedListOutputParser"}getFormatInstructions(){return`Your response should be a numbered list with each item on a new line. For example: 

1. foo

2. bar

3. baz`}async parse(e){return[...e.matchAll(this.re)??[]].map(t=>t[1])}}class Sne extends wm{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers","string"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"StrOutputParser"}parse(e){return Promise.resolve(e)}getFormatInstructions(){return""}_textContentToString(e){return e.text}_imageUrlContentToString(e){throw new Error('Cannot coerce a multimodal "image_url" message part into a string.')}_messageContentComplexToString(e){switch(e.type){case"text":case"text_delta":if("text"in e)return this._textContentToString(e);break;case"image_url":if("image_url"in e)return this._imageUrlContentToString(e);break;default:throw new Error(`Cannot coerce "${e.type}" message part into a string.`)}throw new Error(`Invalid content type: ${e.type}`)}_baseMessageContentToString(e){return e.reduce((t,r)=>t+this._messageContentComplexToString(r),"")}}class r_ extends bm{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const t=Xe(Object.fromEntries(Object.entries(e).map(([r,i])=>[r,Me().describe(i)])));return new this(t)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify(yr(this.schema))}
\`\`\`
`}async parse(e){try{const r=(e.includes("```")?e.trim().split(/```(?:json)?/)[1]:e.trim()).replace(/"([^"\\]*(\\.[^"\\]*)*)"/g,(i,a)=>`"${a.replace(/\n/g,"\\n")}"`).replace(/\n/g,"");return await G_(this.schema,JSON.parse(r))}catch(t){throw new Na(`Failed to parse. Text: "${e}". Error: ${t}`,e)}}}class w5 extends r_{static lc_name(){return"JsonMarkdownStructuredOutputParser"}getFormatInstructions(e){const t=(e==null?void 0:e.interpolationDepth)??1;if(t<1)throw new Error("f string interpolation depth must be at least 1");return`Return a markdown code snippet with a JSON object formatted to look like:
\`\`\`json
${this._schemaToInstruction(yr(this.schema)).replaceAll("{","{".repeat(t)).replaceAll("}","}".repeat(t))}
\`\`\``}_schemaToInstruction(e,t=2){const r=e;if("type"in r){let i=!1,a;if(Array.isArray(r.type)){const u=r.type.findIndex(c=>c==="null");u!==-1&&(i=!0,r.type.splice(u,1)),a=r.type.join(" | ")}else a=r.type;if(r.type==="object"&&r.properties){const u=r.description?` // ${r.description}`:"";return`{
${Object.entries(r.properties).map(([d,p])=>{var y;const m=(y=r.required)!=null&&y.includes(d)?"":" (optional)";return`${" ".repeat(t)}"${d}": ${this._schemaToInstruction(p,t+2)}${m}`}).join(`
`)}
${" ".repeat(t-2)}}${u}`}if(r.type==="array"&&r.items){const u=r.description?` // ${r.description}`:"";return`array[
${" ".repeat(t)}${this._schemaToInstruction(r.items,t+2)}
${" ".repeat(t-2)}] ${u}`}const s=i?" (nullable)":"",o=r.description?` // ${r.description}`:"";return`${a}${o}${s}`}if("anyOf"in r)return r.anyOf.map(i=>this._schemaToInstruction(i,t)).join(`
${" ".repeat(t-2)}`);throw new Error("unsupported schema type")}static fromZodSchema(e){return new this(e)}static fromNamesAndDescriptions(e){const t=Xe(Object.fromEntries(Object.entries(e).map(([r,i])=>[r,Me().describe(i)])));return new this(t)}}class Tne extends bm{constructor({inputSchema:e}){super(...arguments),Object.defineProperty(this,"structuredInputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.structuredInputParser=new w5(e)}async parse(e){let t;try{t=await this.structuredInputParser.parse(e)}catch(r){throw new Na(`Failed to parse. Text: "${e}". Error: ${r}`,e)}return this.outputProcessor(t)}getFormatInstructions(){return this.structuredInputParser.getFormatInstructions()}}const Ane=Object.freeze(Object.defineProperty({__proto__:null,applyPatch:Np,compare:GR},Symbol.toStringTag,{value:"Module"}));class i_ extends yb{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(e,t){if(t)return e?GR(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return qC(e[0].text)}async parse(e){return qC(e,JSON.parse)}getFormatInstructions(){return""}}const Cne=function(){const n={};n.parser=function(P,O){return new t(P,O)},n.SAXParser=t,n.SAXStream=c,n.createStream=u,n.MAX_BUFFER_LENGTH=64*1024;const e=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];n.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"];function t(P,O){if(!(this instanceof t))return new t(P,O);var K=this;i(K),K.q=K.c="",K.bufferCheckPosition=n.MAX_BUFFER_LENGTH,K.opt=O||{},K.opt.lowercase=K.opt.lowercase||K.opt.lowercasetags,K.looseCase=K.opt.lowercase?"toLowerCase":"toUpperCase",K.tags=[],K.closed=K.closedRoot=K.sawRoot=!1,K.tag=K.error=null,K.strict=!!P,K.noscript=!!(P||K.opt.noscript),K.state=N.BEGIN,K.strictEntities=K.opt.strictEntities,K.ENTITIES=K.strictEntities?Object.create(n.XML_ENTITIES):Object.create(n.ENTITIES),K.attribList=[],K.opt.xmlns&&(K.ns=Object.create(b)),K.trackPosition=K.opt.position!==!1,K.trackPosition&&(K.position=K.line=K.column=0),q(K,"onready")}Object.create||(Object.create=function(P){function O(){}O.prototype=P;var K=new O;return K}),Object.keys||(Object.keys=function(P){var O=[];for(var K in P)P.hasOwnProperty(K)&&O.push(K);return O});function r(P){for(var O=Math.max(n.MAX_BUFFER_LENGTH,10),K=0,X=0,se=e.length;X<se;X++){var F=P[e[X]].length;if(F>O)switch(e[X]){case"textNode":V(P);break;case"cdata":J(P,"oncdata",P.cdata),P.cdata="";break;case"script":J(P,"onscript",P.script),P.script="";break;default:ae(P,"Max buffer length exceeded: "+e[X])}K=Math.max(K,F)}var z=n.MAX_BUFFER_LENGTH-K;P.bufferCheckPosition=z+P.position}function i(P){for(var O=0,K=e.length;O<K;O++)P[e[O]]=""}function a(P){V(P),P.cdata!==""&&(J(P,"oncdata",P.cdata),P.cdata=""),P.script!==""&&(J(P,"onscript",P.script),P.script="")}t.prototype={end:function(){ue(this)},write:ce,resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){a(this)}};var s=ReadableStream;s||(s=function(){});var o=n.EVENTS.filter(function(P){return P!=="error"&&P!=="end"});function u(P,O){return new c(P,O)}function c(P,O){if(!(this instanceof c))return new c(P,O);s.apply(this),this._parser=new t(P,O),this.writable=!0,this.readable=!0;var K=this;this._parser.onend=function(){K.emit("end")},this._parser.onerror=function(X){K.emit("error",X),K._parser.error=null},this._decoder=null,o.forEach(function(X){Object.defineProperty(K,"on"+X,{get:function(){return K._parser["on"+X]},set:function(se){if(!se)return K.removeAllListeners(X),K._parser["on"+X]=se,se;K.on(X,se)},enumerable:!0,configurable:!1})})}c.prototype=Object.create(s.prototype,{constructor:{value:c}}),c.prototype.write=function(P){return this._parser.write(P.toString()),this.emit("data",P),!0},c.prototype.end=function(P){return P&&P.length&&this.write(P),this._parser.end(),!0},c.prototype.on=function(P,O){var K=this;return!K._parser["on"+P]&&o.indexOf(P)!==-1&&(K._parser["on"+P]=function(){var X=arguments.length===1?[arguments[0]]:Array.apply(null,arguments);X.splice(0,0,P),K.emit.apply(K,X)}),s.prototype.on.call(K,P,O)};var d="[CDATA[",p="DOCTYPE",m="http://www.w3.org/XML/1998/namespace",y="http://www.w3.org/2000/xmlns/",b={xml:m,xmlns:y},w=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,S=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,T=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,C=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function A(P){return P===" "||P===`
`||P==="\r"||P==="	"}function I(P){return P==='"'||P==="'"}function x(P){return P===">"||A(P)}function L(P,O){return P.test(O)}function U(P,O){return!L(P,O)}var N=0;n.STATE={BEGIN:N++,BEGIN_WHITESPACE:N++,TEXT:N++,TEXT_ENTITY:N++,OPEN_WAKA:N++,SGML_DECL:N++,SGML_DECL_QUOTED:N++,DOCTYPE:N++,DOCTYPE_QUOTED:N++,DOCTYPE_DTD:N++,DOCTYPE_DTD_QUOTED:N++,COMMENT_STARTING:N++,COMMENT:N++,COMMENT_ENDING:N++,COMMENT_ENDED:N++,CDATA:N++,CDATA_ENDING:N++,CDATA_ENDING_2:N++,PROC_INST:N++,PROC_INST_BODY:N++,PROC_INST_ENDING:N++,OPEN_TAG:N++,OPEN_TAG_SLASH:N++,ATTRIB:N++,ATTRIB_NAME:N++,ATTRIB_NAME_SAW_WHITE:N++,ATTRIB_VALUE:N++,ATTRIB_VALUE_QUOTED:N++,ATTRIB_VALUE_CLOSED:N++,ATTRIB_VALUE_UNQUOTED:N++,ATTRIB_VALUE_ENTITY_Q:N++,ATTRIB_VALUE_ENTITY_U:N++,CLOSE_TAG:N++,CLOSE_TAG_SAW_WHITE:N++,SCRIPT:N++,SCRIPT_ENDING:N++},n.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},n.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(n.ENTITIES).forEach(function(P){var O=n.ENTITIES[P],K=typeof O=="number"?String.fromCharCode(O):O;n.ENTITIES[P]=K});for(var B in n.STATE)n.STATE[n.STATE[B]]=B;N=n.STATE;function q(P,O,K){P[O]&&P[O](K)}function J(P,O,K){P.textNode&&V(P),q(P,O,K)}function V(P){P.textNode=de(P.opt,P.textNode),P.textNode&&q(P,"ontext",P.textNode),P.textNode=""}function de(P,O){return P.trim&&(O=O.trim()),P.normalize&&(O=O.replace(/\s+/g," ")),O}function ae(P,O){return V(P),P.trackPosition&&(O+=`
Line: `+P.line+`
Column: `+P.column+`
Char: `+P.c),O=new Error(O),P.error=O,q(P,"onerror",O),P}function ue(P){return P.sawRoot&&!P.closedRoot&&te(P,"Unclosed root tag"),P.state!==N.BEGIN&&P.state!==N.BEGIN_WHITESPACE&&P.state!==N.TEXT&&ae(P,"Unexpected end"),V(P),P.c="",P.closed=!0,q(P,"onend"),t.call(P,P.strict,P.opt),P}function te(P,O){if(typeof P!="object"||!(P instanceof t))throw new Error("bad call to strictFail");P.strict&&ae(P,O)}function oe(P){P.strict||(P.tagName=P.tagName[P.looseCase]());var O=P.tags[P.tags.length-1]||P,K=P.tag={name:P.tagName,attributes:{}};P.opt.xmlns&&(K.ns=O.ns),P.attribList.length=0,J(P,"onopentagstart",K)}function ge(P,O){var K=P.indexOf(":"),X=K<0?["",P]:P.split(":"),se=X[0],F=X[1];return O&&P==="xmlns"&&(se="xmlns",F=""),{prefix:se,local:F}}function Ee(P){if(P.strict||(P.attribName=P.attribName[P.looseCase]()),P.attribList.indexOf(P.attribName)!==-1||P.tag.attributes.hasOwnProperty(P.attribName)){P.attribName=P.attribValue="";return}if(P.opt.xmlns){var O=ge(P.attribName,!0),K=O.prefix,X=O.local;if(K==="xmlns")if(X==="xml"&&P.attribValue!==m)te(P,"xml: prefix must be bound to "+m+`
Actual: `+P.attribValue);else if(X==="xmlns"&&P.attribValue!==y)te(P,"xmlns: prefix must be bound to "+y+`
Actual: `+P.attribValue);else{var se=P.tag,F=P.tags[P.tags.length-1]||P;se.ns===F.ns&&(se.ns=Object.create(F.ns)),se.ns[X]=P.attribValue}P.attribList.push([P.attribName,P.attribValue])}else P.tag.attributes[P.attribName]=P.attribValue,J(P,"onattribute",{name:P.attribName,value:P.attribValue});P.attribName=P.attribValue=""}function Y(P,O){if(P.opt.xmlns){var K=P.tag,X=ge(P.tagName);K.prefix=X.prefix,K.local=X.local,K.uri=K.ns[X.prefix]||"",K.prefix&&!K.uri&&(te(P,"Unbound namespace prefix: "+JSON.stringify(P.tagName)),K.uri=X.prefix);var se=P.tags[P.tags.length-1]||P;K.ns&&se.ns!==K.ns&&Object.keys(K.ns).forEach(function(It){J(P,"onopennamespace",{prefix:It,uri:K.ns[It]})});for(var F=0,z=P.attribList.length;F<z;F++){var ye=P.attribList[F],ke=ye[0],Qe=ye[1],$e=ge(ke,!0),ze=$e.prefix,xt=$e.local,Oe=ze===""?"":K.ns[ze]||"",qe={name:ke,value:Qe,prefix:ze,local:xt,uri:Oe};ze&&ze!=="xmlns"&&!Oe&&(te(P,"Unbound namespace prefix: "+JSON.stringify(ze)),qe.uri=ze),P.tag.attributes[ke]=qe,J(P,"onattribute",qe)}P.attribList.length=0}P.tag.isSelfClosing=!!O,P.sawRoot=!0,P.tags.push(P.tag),J(P,"onopentag",P.tag),O||(!P.noscript&&P.tagName.toLowerCase()==="script"?P.state=N.SCRIPT:P.state=N.TEXT,P.tag=null,P.tagName=""),P.attribName=P.attribValue="",P.attribList.length=0}function ve(P){if(!P.tagName){te(P,"Weird empty close tag."),P.textNode+="</>",P.state=N.TEXT;return}if(P.script){if(P.tagName!=="script"){P.script+="</"+P.tagName+">",P.tagName="",P.state=N.SCRIPT;return}J(P,"onscript",P.script),P.script=""}var O=P.tags.length,K=P.tagName;P.strict||(K=K[P.looseCase]());for(var X=K;O--;){var se=P.tags[O];if(se.name!==X)te(P,"Unexpected close tag");else break}if(O<0){te(P,"Unmatched closing tag: "+P.tagName),P.textNode+="</"+P.tagName+">",P.state=N.TEXT;return}P.tagName=K;for(var F=P.tags.length;F-- >O;){var z=P.tag=P.tags.pop();P.tagName=P.tag.name,J(P,"onclosetag",P.tagName);var ye={};for(var ke in z.ns)ye[ke]=z.ns[ke];var Qe=P.tags[P.tags.length-1]||P;P.opt.xmlns&&z.ns!==Qe.ns&&Object.keys(z.ns).forEach(function($e){var ze=z.ns[$e];J(P,"onclosenamespace",{prefix:$e,uri:ze})})}O===0&&(P.closedRoot=!0),P.tagName=P.attribValue=P.attribName="",P.attribList.length=0,P.state=N.TEXT}function Re(P){var O=P.entity,K=O.toLowerCase(),X,se="";return P.ENTITIES[O]?P.ENTITIES[O]:P.ENTITIES[K]?P.ENTITIES[K]:(O=K,O.charAt(0)==="#"&&(O.charAt(1)==="x"?(O=O.slice(2),X=parseInt(O,16),se=X.toString(16)):(O=O.slice(1),X=parseInt(O,10),se=X.toString(10))),O=O.replace(/^0+/,""),isNaN(X)||se.toLowerCase()!==O?(te(P,"Invalid character entity"),"&"+P.entity+";"):String.fromCodePoint(X))}function Q(P,O){O==="<"?(P.state=N.OPEN_WAKA,P.startTagPosition=P.position):A(O)||(te(P,"Non-whitespace before first tag."),P.textNode=O,P.state=N.TEXT)}function ie(P,O){var K="";return O<P.length&&(K=P.charAt(O)),K}function ce(P){var O=this;if(this.error)throw this.error;if(O.closed)return ae(O,"Cannot write after close. Assign an onready handler.");if(P===null)return ue(O);typeof P=="object"&&(P=P.toString());for(var K=0,X="";X=ie(P,K++),O.c=X,!!X;)switch(O.trackPosition&&(O.position++,X===`
`?(O.line++,O.column=0):O.column++),O.state){case N.BEGIN:if(O.state=N.BEGIN_WHITESPACE,X==="\uFEFF")continue;Q(O,X);continue;case N.BEGIN_WHITESPACE:Q(O,X);continue;case N.TEXT:if(O.sawRoot&&!O.closedRoot){for(var se=K-1;X&&X!=="<"&&X!=="&";)X=ie(P,K++),X&&O.trackPosition&&(O.position++,X===`
`?(O.line++,O.column=0):O.column++);O.textNode+=P.substring(se,K-1)}X==="<"&&!(O.sawRoot&&O.closedRoot&&!O.strict)?(O.state=N.OPEN_WAKA,O.startTagPosition=O.position):(!A(X)&&(!O.sawRoot||O.closedRoot)&&te(O,"Text data outside of root node."),X==="&"?O.state=N.TEXT_ENTITY:O.textNode+=X);continue;case N.SCRIPT:X==="<"?O.state=N.SCRIPT_ENDING:O.script+=X;continue;case N.SCRIPT_ENDING:X==="/"?O.state=N.CLOSE_TAG:(O.script+="<"+X,O.state=N.SCRIPT);continue;case N.OPEN_WAKA:if(X==="!")O.state=N.SGML_DECL,O.sgmlDecl="";else if(!A(X))if(L(w,X))O.state=N.OPEN_TAG,O.tagName=X;else if(X==="/")O.state=N.CLOSE_TAG,O.tagName="";else if(X==="?")O.state=N.PROC_INST,O.procInstName=O.procInstBody="";else{if(te(O,"Unencoded <"),O.startTagPosition+1<O.position){var F=O.position-O.startTagPosition;X=new Array(F).join(" ")+X}O.textNode+="<"+X,O.state=N.TEXT}continue;case N.SGML_DECL:(O.sgmlDecl+X).toUpperCase()===d?(J(O,"onopencdata"),O.state=N.CDATA,O.sgmlDecl="",O.cdata=""):O.sgmlDecl+X==="--"?(O.state=N.COMMENT,O.comment="",O.sgmlDecl=""):(O.sgmlDecl+X).toUpperCase()===p?(O.state=N.DOCTYPE,(O.doctype||O.sawRoot)&&te(O,"Inappropriately located doctype declaration"),O.doctype="",O.sgmlDecl=""):X===">"?(J(O,"onsgmldeclaration",O.sgmlDecl),O.sgmlDecl="",O.state=N.TEXT):(I(X)&&(O.state=N.SGML_DECL_QUOTED),O.sgmlDecl+=X);continue;case N.SGML_DECL_QUOTED:X===O.q&&(O.state=N.SGML_DECL,O.q=""),O.sgmlDecl+=X;continue;case N.DOCTYPE:X===">"?(O.state=N.TEXT,J(O,"ondoctype",O.doctype),O.doctype=!0):(O.doctype+=X,X==="["?O.state=N.DOCTYPE_DTD:I(X)&&(O.state=N.DOCTYPE_QUOTED,O.q=X));continue;case N.DOCTYPE_QUOTED:O.doctype+=X,X===O.q&&(O.q="",O.state=N.DOCTYPE);continue;case N.DOCTYPE_DTD:O.doctype+=X,X==="]"?O.state=N.DOCTYPE:I(X)&&(O.state=N.DOCTYPE_DTD_QUOTED,O.q=X);continue;case N.DOCTYPE_DTD_QUOTED:O.doctype+=X,X===O.q&&(O.state=N.DOCTYPE_DTD,O.q="");continue;case N.COMMENT:X==="-"?O.state=N.COMMENT_ENDING:O.comment+=X;continue;case N.COMMENT_ENDING:X==="-"?(O.state=N.COMMENT_ENDED,O.comment=de(O.opt,O.comment),O.comment&&J(O,"oncomment",O.comment),O.comment=""):(O.comment+="-"+X,O.state=N.COMMENT);continue;case N.COMMENT_ENDED:X!==">"?(te(O,"Malformed comment"),O.comment+="--"+X,O.state=N.COMMENT):O.state=N.TEXT;continue;case N.CDATA:X==="]"?O.state=N.CDATA_ENDING:O.cdata+=X;continue;case N.CDATA_ENDING:X==="]"?O.state=N.CDATA_ENDING_2:(O.cdata+="]"+X,O.state=N.CDATA);continue;case N.CDATA_ENDING_2:X===">"?(O.cdata&&J(O,"oncdata",O.cdata),J(O,"onclosecdata"),O.cdata="",O.state=N.TEXT):X==="]"?O.cdata+="]":(O.cdata+="]]"+X,O.state=N.CDATA);continue;case N.PROC_INST:X==="?"?O.state=N.PROC_INST_ENDING:A(X)?O.state=N.PROC_INST_BODY:O.procInstName+=X;continue;case N.PROC_INST_BODY:if(!O.procInstBody&&A(X))continue;X==="?"?O.state=N.PROC_INST_ENDING:O.procInstBody+=X;continue;case N.PROC_INST_ENDING:X===">"?(J(O,"onprocessinginstruction",{name:O.procInstName,body:O.procInstBody}),O.procInstName=O.procInstBody="",O.state=N.TEXT):(O.procInstBody+="?"+X,O.state=N.PROC_INST_BODY);continue;case N.OPEN_TAG:L(S,X)?O.tagName+=X:(oe(O),X===">"?Y(O):X==="/"?O.state=N.OPEN_TAG_SLASH:(A(X)||te(O,"Invalid character in tag name"),O.state=N.ATTRIB));continue;case N.OPEN_TAG_SLASH:X===">"?(Y(O,!0),ve(O)):(te(O,"Forward-slash in opening tag not followed by >"),O.state=N.ATTRIB);continue;case N.ATTRIB:if(A(X))continue;X===">"?Y(O):X==="/"?O.state=N.OPEN_TAG_SLASH:L(w,X)?(O.attribName=X,O.attribValue="",O.state=N.ATTRIB_NAME):te(O,"Invalid attribute name");continue;case N.ATTRIB_NAME:X==="="?O.state=N.ATTRIB_VALUE:X===">"?(te(O,"Attribute without value"),O.attribValue=O.attribName,Ee(O),Y(O)):A(X)?O.state=N.ATTRIB_NAME_SAW_WHITE:L(S,X)?O.attribName+=X:te(O,"Invalid attribute name");continue;case N.ATTRIB_NAME_SAW_WHITE:if(X==="=")O.state=N.ATTRIB_VALUE;else{if(A(X))continue;te(O,"Attribute without value"),O.tag.attributes[O.attribName]="",O.attribValue="",J(O,"onattribute",{name:O.attribName,value:""}),O.attribName="",X===">"?Y(O):L(w,X)?(O.attribName=X,O.state=N.ATTRIB_NAME):(te(O,"Invalid attribute name"),O.state=N.ATTRIB)}continue;case N.ATTRIB_VALUE:if(A(X))continue;I(X)?(O.q=X,O.state=N.ATTRIB_VALUE_QUOTED):(te(O,"Unquoted attribute value"),O.state=N.ATTRIB_VALUE_UNQUOTED,O.attribValue=X);continue;case N.ATTRIB_VALUE_QUOTED:if(X!==O.q){X==="&"?O.state=N.ATTRIB_VALUE_ENTITY_Q:O.attribValue+=X;continue}Ee(O),O.q="",O.state=N.ATTRIB_VALUE_CLOSED;continue;case N.ATTRIB_VALUE_CLOSED:A(X)?O.state=N.ATTRIB:X===">"?Y(O):X==="/"?O.state=N.OPEN_TAG_SLASH:L(w,X)?(te(O,"No whitespace between attributes"),O.attribName=X,O.attribValue="",O.state=N.ATTRIB_NAME):te(O,"Invalid attribute name");continue;case N.ATTRIB_VALUE_UNQUOTED:if(!x(X)){X==="&"?O.state=N.ATTRIB_VALUE_ENTITY_U:O.attribValue+=X;continue}Ee(O),X===">"?Y(O):O.state=N.ATTRIB;continue;case N.CLOSE_TAG:if(O.tagName)X===">"?ve(O):L(S,X)?O.tagName+=X:O.script?(O.script+="</"+O.tagName,O.tagName="",O.state=N.SCRIPT):(A(X)||te(O,"Invalid tagname in closing tag"),O.state=N.CLOSE_TAG_SAW_WHITE);else{if(A(X))continue;U(w,X)?O.script?(O.script+="</"+X,O.state=N.SCRIPT):te(O,"Invalid tagname in closing tag."):O.tagName=X}continue;case N.CLOSE_TAG_SAW_WHITE:if(A(X))continue;X===">"?ve(O):te(O,"Invalid characters in closing tag");continue;case N.TEXT_ENTITY:case N.ATTRIB_VALUE_ENTITY_Q:case N.ATTRIB_VALUE_ENTITY_U:var z,ye;switch(O.state){case N.TEXT_ENTITY:z=N.TEXT,ye="textNode";break;case N.ATTRIB_VALUE_ENTITY_Q:z=N.ATTRIB_VALUE_QUOTED,ye="attribValue";break;case N.ATTRIB_VALUE_ENTITY_U:z=N.ATTRIB_VALUE_UNQUOTED,ye="attribValue";break}if(X===";")if(O.opt.unparsedEntities){var ke=Re(O);O.entity="",O.state=z,O.write(ke)}else O[ye]+=Re(O),O.entity="",O.state=z;else L(O.entity.length?C:T,X)?O.entity+=X:(te(O,"Invalid character in entity name"),O[ye]+="&"+O.entity+X,O.entity="",O.state=z);continue;default:throw new Error(O,"Unknown state: "+O.state)}return O.position>=O.bufferCheckPosition&&r(O),O}/*! http://mths.be/fromcodepoint v0.1.0 by @mathias */return String.fromCodePoint||function(){var P=String.fromCharCode,O=Math.floor,K=function(){var X=16384,se=[],F,z,ye=-1,ke=arguments.length;if(!ke)return"";for(var Qe="";++ye<ke;){var $e=Number(arguments[ye]);if(!isFinite($e)||$e<0||$e>1114111||O($e)!==$e)throw RangeError("Invalid code point: "+$e);$e<=65535?se.push($e):($e-=65536,F=($e>>10)+55296,z=$e%1024+56320,se.push(F,z)),(ye+1===ke||se.length>X)&&(Qe+=P.apply(null,se),se.length=0)}return Qe};Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:K,configurable:!0,writable:!0}):String.fromCodePoint=K}(),n},Rne=Cne(),V1=`The output should be formatted as a XML file.
1. Output should conform to the tags below. 
2. If tags are not given, make them on your own.
3. Remember to always open and close all the tags.

As an example, for the tags ["foo", "bar", "baz"]:
1. String "<foo>
   <bar>
      <baz></baz>
   </bar>
</foo>" is a well-formatted instance of the schema. 
2. String "<foo>
   <bar>
   </foo>" is a badly-formatted instance.
3. String "<foo>
   <tag>
   </tag>
</foo>" is a badly-formatted instance.

Here are the output tags:
\`\`\`
{tags}
\`\`\``;class Ine extends yb{constructor(e){super(e),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.tags=e==null?void 0:e.tags}static lc_name(){return"XMLOutputParser"}_diff(e,t){if(t)return e?GR(e,t):[{op:"replace",path:"",value:t}]}async parsePartialResult(e){return z1(e[0].text)}async parse(e){return z1(e)}getFormatInstructions(){var t;return!!(this.tags&&this.tags.length>0)?V1.replace("{tags}",((t=this.tags)==null?void 0:t.join(", "))??""):V1}}const Pne=n=>n.split(`
`).map(e=>e.replace(/^\s+/,"")).join(`
`).trim(),E5=n=>{if(Object.keys(n).length===0)return{};const e={};return n.children.length>0?(e[n.name]=n.children.map(E5),e):(e[n.name]=n.text??void 0,e)};function z1(n){const e=Pne(n),t=Rne.parser(!0);let r={};const i=[];t.onopentag=o=>{const u={name:o.name,attributes:o.attributes,children:[],text:"",isSelfClosing:o.isSelfClosing};i.length>0?i[i.length-1].children.push(u):r=u,o.isSelfClosing||i.push(u)},t.onclosetag=()=>{if(i.length>0){const o=i.pop();i.length===0&&o&&(r=o)}},t.ontext=o=>{if(i.length>0){const u=i[i.length-1];u.text+=o}},t.onattribute=o=>{if(i.length>0){const u=i[i.length-1];u.attributes[o.name]=o.value}};const a=/```(xml)?(.*)```/s.exec(e),s=a?a[2]:e;return t.write(s).close(),r&&r.name==="?xml"&&(r=r.children[0]),E5(r)}const xne=Object.freeze(Object.defineProperty({__proto__:null,AsymmetricStructuredOutputParser:Tne,BaseCumulativeTransformOutputParser:yb,BaseLLMOutputParser:gb,BaseOutputParser:bm,BaseTransformOutputParser:wm,BytesOutputParser:vne,CommaSeparatedListOutputParser:_ne,CustomListOutputParser:bne,JsonMarkdownStructuredOutputParser:w5,JsonOutputParser:i_,ListOutputParser:Em,MarkdownListOutputParser:Ene,NumberedListOutputParser:wne,OutputParserException:Na,StringOutputParser:Sne,StructuredOutputParser:r_,XMLOutputParser:Ine,XML_FORMAT_INSTRUCTIONS:V1,parseJsonMarkdown:qC,parsePartialJson:N_,parseXMLMarkdown:z1},Symbol.toStringTag,{value:"Module"}));function eP(n,e){if(n.function===void 0)return;let t;if(e!=null&&e.partial)try{t=N_(n.function.arguments??"{}")}catch{return}else try{t=JSON.parse(n.function.arguments)}catch(i){throw new Na([`Function "${n.function.name}" arguments:`,"",n.function.arguments,"","are not valid JSON.",`Error: ${i.message}`].join(`
`))}const r={name:n.function.name,args:t,type:"tool_call"};return e!=null&&e.returnId&&(r.id=n.id),r}function One(n){if(n.id===void 0)throw new Error('All OpenAI tool calls must have an "id" field.');return{id:n.id,type:"function",function:{name:n.name,arguments:JSON.stringify(n.args)}}}function S5(n,e){var t,r;return{name:(t=n.function)==null?void 0:t.name,args:(r=n.function)==null?void 0:r.arguments,id:n.id,error:e,type:"invalid_tool_call"}}class Nne extends yb{static lc_name(){return"JsonOutputToolsParser"}constructor(e){super(e),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=(e==null?void 0:e.returnId)??this.returnId}_diff(){throw new Error("Not supported.")}async parse(){throw new Error("Not implemented.")}async parseResult(e){return await this.parsePartialResult(e,!1)}async parsePartialResult(e,t=!0){var s;const r=e[0].message;let i;if(ua(r)&&((s=r.tool_calls)!=null&&s.length)?i=r.tool_calls.map(o=>{const{id:u,...c}=o;return this.returnId?{id:u,...c}:c}):r.additional_kwargs.tool_calls!==void 0&&(i=JSON.parse(JSON.stringify(r.additional_kwargs.tool_calls)).map(u=>eP(u,{returnId:this.returnId,partial:t}))),!i)return[];const a=[];for(const o of i)if(o!==void 0){const u={type:o.name,args:o.args,id:o.id};a.push(u)}return a}}class e4 extends Nne{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){var r;if(this.zodSchema===void 0)return e;const t=await H_(this.zodSchema,e);if(t.success)return t.data;throw new Na(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify((r=t.error)==null?void 0:r.issues)}`,JSON.stringify(e,null,2))}async parsePartialResult(e){const r=(await super.parsePartialResult(e)).filter(a=>a.type===this.keyName);let i=r;if(r.length)return this.returnId||(i=r.map(a=>a.args)),this.returnSingle?i[0]:i}async parseResult(e){const r=(await super.parsePartialResult(e,!1)).filter(s=>s.type===this.keyName);let i=r;return r.length?(this.returnId||(i=r.map(s=>s.args)),this.returnSingle?this._validateResult(i[0]):await Promise.all(i.map(s=>this._validateResult(s)))):void 0}}const kne=Symbol("Let zodToJsonSchema decide on which parser to use"),t4={name:void 0,$refStrategy:"root",effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",nullableStrategy:"from-target",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},Mne=n=>typeof n=="string"?{...t4,basePath:["#"],definitions:{},name:n}:{...t4,basePath:["#"],definitions:{},...n},H1=n=>"_def"in n?n._def:n;function Dne(n){if(!n)return!0;for(const e in n)return!1;return!0}const $ne=n=>{const e=Mne(n),t=e.name!==void 0?[...e.basePath,e.definitionPath,e.name]:e.basePath;return{...e,currentPath:t,propertyPath:void 0,seenRefs:new Set,seen:new Map(Object.entries(e.definitions).map(([r,i])=>[H1(i),{def:H1(i),path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}};function T5(n,e,t,r){r!=null&&r.errorMessages&&t&&(n.errorMessage={...n.errorMessage,[e]:t})}function pn(n,e,t,r,i){n[e]=t,T5(n,e,r,i)}function Lne(){return{}}function Une(n,e){var r,i;const t={type:"array"};return((i=(r=n.type)==null?void 0:r._def)==null?void 0:i.typeName)!==De.ZodAny&&(t.items=Qt(n.type._def,{...e,currentPath:[...e.currentPath,"items"]})),n.minLength&&pn(t,"minItems",n.minLength.value,n.minLength.message,e),n.maxLength&&pn(t,"maxItems",n.maxLength.value,n.maxLength.message,e),n.exactLength&&(pn(t,"minItems",n.exactLength.value,n.exactLength.message,e),pn(t,"maxItems",n.exactLength.value,n.exactLength.message,e)),t}function jne(n,e){const t={type:"integer",format:"int64"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"min":e.target==="jsonSchema7"?r.inclusive?pn(t,"minimum",r.value,r.message,e):pn(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),pn(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?pn(t,"maximum",r.value,r.message,e):pn(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),pn(t,"maximum",r.value,r.message,e));break;case"multipleOf":pn(t,"multipleOf",r.value,r.message,e);break}return t}function Fne(){return{type:"boolean"}}function Bne(n,e){return Qt(n.type._def,e)}const qne=(n,e)=>Qt(n.innerType._def,e);function A5(n,e,t){const r=t??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((i,a)=>A5(n,e,i))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return Vne(n,e)}}const Vne=(n,e)=>{const t={type:"integer",format:"unix-time"};if(e.target==="openApi3")return t;for(const r of n.checks)switch(r.kind){case"min":pn(t,"minimum",r.value,r.message,e);break;case"max":pn(t,"maximum",r.value,r.message,e);break}return t};function zne(n,e){return{...Qt(n.innerType._def,e),default:n.defaultValue()}}function Hne(n,e,t){return e.effectStrategy==="input"?Qt(n.schema._def,e,t):{}}function Gne(n){return{type:"string",enum:[...n.values]}}const Wne=n=>"type"in n&&n.type==="string"?!1:"allOf"in n;function Kne(n,e){const t=[Qt(n.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),Qt(n.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(a=>!!a);let r=e.target==="jsonSchema2019-09"?{unevaluatedProperties:!1}:void 0;const i=[];return t.forEach(a=>{if(Wne(a))i.push(...a.allOf),a.unevaluatedProperties===void 0&&(r=void 0);else{let s=a;if("additionalProperties"in a&&a.additionalProperties===!1){const{additionalProperties:o,...u}=a;s=u}else r=void 0;i.push(s)}}),i.length?{allOf:i,...r}:void 0}function Jne(n,e){const t=typeof n.value;return t!=="bigint"&&t!=="number"&&t!=="boolean"&&t!=="string"?{type:Array.isArray(n.value)?"array":"object"}:e.target==="openApi3"?{type:t==="bigint"?"integer":t,enum:[n.value]}:{type:t==="bigint"?"integer":t,const:n.value}}let HA;const pu={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(HA===void 0&&(HA=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),HA),base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/};function C5(n,e){const t={type:"string"};function r(i){return e.patternStrategy==="escape"?Yne(i):i}if(n.checks)for(const i of n.checks)switch(i.kind){case"min":pn(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,i.value):i.value,i.message,e);break;case"max":pn(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,i.value):i.value,i.message,e);break;case"email":switch(e.emailStrategy){case"format:email":Ya(t,"email",i.message,e);break;case"format:idn-email":Ya(t,"idn-email",i.message,e);break;case"pattern:zod":Za(t,pu.email,i.message,e);break}break;case"url":Ya(t,"uri",i.message,e);break;case"uuid":Ya(t,"uuid",i.message,e);break;case"regex":Za(t,i.regex,i.message,e);break;case"cuid":Za(t,pu.cuid,i.message,e);break;case"cuid2":Za(t,pu.cuid2,i.message,e);break;case"startsWith":Za(t,RegExp(`^${r(i.value)}`),i.message,e);break;case"endsWith":Za(t,RegExp(`${r(i.value)}$`),i.message,e);break;case"datetime":Ya(t,"date-time",i.message,e);break;case"date":Ya(t,"date",i.message,e);break;case"time":Ya(t,"time",i.message,e);break;case"duration":Ya(t,"duration",i.message,e);break;case"length":pn(t,"minLength",typeof t.minLength=="number"?Math.max(t.minLength,i.value):i.value,i.message,e),pn(t,"maxLength",typeof t.maxLength=="number"?Math.min(t.maxLength,i.value):i.value,i.message,e);break;case"includes":{Za(t,RegExp(r(i.value)),i.message,e);break}case"ip":{i.version!=="v6"&&Ya(t,"ipv4",i.message,e),i.version!=="v4"&&Ya(t,"ipv6",i.message,e);break}case"emoji":Za(t,pu.emoji,i.message,e);break;case"ulid":{Za(t,pu.ulid,i.message,e);break}case"base64":{switch(e.base64Strategy){case"format:binary":{Ya(t,"binary",i.message,e);break}case"contentEncoding:base64":{pn(t,"contentEncoding","base64",i.message,e);break}case"pattern:zod":{Za(t,pu.base64,i.message,e);break}}break}case"nanoid":Za(t,pu.nanoid,i.message,e)}return t}const Yne=n=>Array.from(n).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),Ya=(n,e,t,r)=>{var i;n.format||(i=n.anyOf)!=null&&i.some(a=>a.format)?(n.anyOf||(n.anyOf=[]),n.format&&(n.anyOf.push({format:n.format,...n.errorMessage&&r.errorMessages&&{errorMessage:{format:n.errorMessage.format}}}),delete n.format,n.errorMessage&&(delete n.errorMessage.format,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.anyOf.push({format:e,...t&&r.errorMessages&&{errorMessage:{format:t}}})):pn(n,"format",e,t,r)},Za=(n,e,t,r)=>{var i;n.pattern||(i=n.allOf)!=null&&i.some(a=>a.pattern)?(n.allOf||(n.allOf=[]),n.pattern&&(n.allOf.push({pattern:n.pattern,...n.errorMessage&&r.errorMessages&&{errorMessage:{pattern:n.errorMessage.pattern}}}),delete n.pattern,n.errorMessage&&(delete n.errorMessage.pattern,Object.keys(n.errorMessage).length===0&&delete n.errorMessage)),n.allOf.push({pattern:n4(e,r),...t&&r.errorMessages&&{errorMessage:{pattern:t}}})):pn(n,"pattern",n4(e,r),t,r)},n4=(n,e)=>{var c;const t=typeof n=="function"?n():n;if(!e.applyRegexFlags||!t.flags)return t.source;const r={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},i=r.i?t.source.toLowerCase():t.source;let a="",s=!1,o=!1,u=!1;for(let d=0;d<i.length;d++){if(s){a+=i[d],s=!1;continue}if(r.i){if(o){if(i[d].match(/[a-z]/)){u?(a+=i[d],a+=`${i[d-2]}-${i[d]}`.toUpperCase(),u=!1):i[d+1]==="-"&&((c=i[d+2])!=null&&c.match(/[a-z]/))?(a+=i[d],u=!0):a+=`${i[d]}${i[d].toUpperCase()}`;continue}}else if(i[d].match(/[a-z]/)){a+=`[${i[d]}${i[d].toUpperCase()}]`;continue}}if(r.m){if(i[d]==="^"){a+=`(^|(?<=[\r
]))`;continue}else if(i[d]==="$"){a+=`($|(?=[\r
]))`;continue}}if(r.s&&i[d]==="."){a+=o?`${i[d]}\r
`:`[${i[d]}\r
]`;continue}a+=i[d],i[d]==="\\"?s=!0:o&&i[d]==="]"?o=!1:!o&&i[d]==="["&&(o=!0)}try{const d=new RegExp(a)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return a};function R5(n,e){var r,i,a,s;if(e.target==="openApi3"&&((r=n.keyType)==null?void 0:r._def.typeName)===De.ZodEnum)return{type:"object",required:n.keyType._def.values,properties:n.keyType._def.values.reduce((o,u)=>({...o,[u]:Qt(n.valueType._def,{...e,currentPath:[...e.currentPath,"properties",u]})??{}}),{}),additionalProperties:!1};const t={type:"object",additionalProperties:Qt(n.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??{}};if(e.target==="openApi3")return t;if(((i=n.keyType)==null?void 0:i._def.typeName)===De.ZodString&&((a=n.keyType._def.checks)!=null&&a.length)){const o=Object.entries(C5(n.keyType._def,e)).reduce((u,[c,d])=>c==="type"?u:{...u,[c]:d},{});return{...t,propertyNames:o}}else if(((s=n.keyType)==null?void 0:s._def.typeName)===De.ZodEnum)return{...t,propertyNames:{enum:n.keyType._def.values}};return t}function Zne(n,e){if(e.mapStrategy==="record")return R5(n,e);const t=Qt(n.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||{},r=Qt(n.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[t,r],minItems:2,maxItems:2}}}function Xne(n){const e=n.values,r=Object.keys(n.values).filter(a=>typeof e[e[a]]!="number").map(a=>e[a]),i=Array.from(new Set(r.map(a=>typeof a)));return{type:i.length===1?i[0]==="string"?"string":"number":["string","number"],enum:r}}function Qne(){return{not:{}}}function ere(n){return n.target==="openApi3"?{enum:["null"],nullable:!0}:{type:"null"}}const a_={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function tre(n,e){if(e.target==="openApi3")return r4(n,e);const t=n.options instanceof Map?Array.from(n.options.values()):n.options;if(t.every(r=>r._def.typeName in a_&&(!r._def.checks||!r._def.checks.length))){const r=t.reduce((i,a)=>{const s=a_[a._def.typeName];return s&&!i.includes(s)?[...i,s]:i},[]);return{type:r.length>1?r:r[0]}}else if(t.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){const r=t.reduce((i,a)=>{const s=typeof a._def.value;switch(s){case"string":case"number":case"boolean":return[...i,s];case"bigint":return[...i,"integer"];case"object":if(a._def.value===null)return[...i,"null"];case"symbol":case"undefined":case"function":default:return i}},[]);if(r.length===t.length){const i=r.filter((a,s,o)=>o.indexOf(a)===s);return{type:i.length>1?i:i[0],enum:t.reduce((a,s)=>a.includes(s._def.value)?a:[...a,s._def.value],[])}}}else if(t.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:t.reduce((r,i)=>[...r,...i._def.values.filter(a=>!r.includes(a))],[])};return r4(n,e)}const r4=(n,e)=>{const t=(n.options instanceof Map?Array.from(n.options.values()):n.options).map((r,i)=>Qt(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${i}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return t.length?{anyOf:t}:void 0};function nre(n,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(n.innerType._def.typeName)&&(!n.innerType._def.checks||!n.innerType._def.checks.length))return e.target==="openApi3"||e.nullableStrategy==="property"?{type:a_[n.innerType._def.typeName],nullable:!0}:{type:[a_[n.innerType._def.typeName],"null"]};if(e.target==="openApi3"){const r=Qt(n.innerType._def,{...e,currentPath:[...e.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}const t=Qt(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return t&&{anyOf:[t,{type:"null"}]}}function rre(n,e){const t={type:"number"};if(!n.checks)return t;for(const r of n.checks)switch(r.kind){case"int":t.type="integer",T5(t,"type",r.message,e);break;case"min":e.target==="jsonSchema7"?r.inclusive?pn(t,"minimum",r.value,r.message,e):pn(t,"exclusiveMinimum",r.value,r.message,e):(r.inclusive||(t.exclusiveMinimum=!0),pn(t,"minimum",r.value,r.message,e));break;case"max":e.target==="jsonSchema7"?r.inclusive?pn(t,"maximum",r.value,r.message,e):pn(t,"exclusiveMaximum",r.value,r.message,e):(r.inclusive||(t.exclusiveMaximum=!0),pn(t,"maximum",r.value,r.message,e));break;case"multipleOf":pn(t,"multipleOf",r.value,r.message,e);break}return t}function ire(n,e){return e.removeAdditionalStrategy==="strict"?n.catchall._def.typeName==="ZodNever"?n.unknownKeys!=="strict":Qt(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0:n.catchall._def.typeName==="ZodNever"?n.unknownKeys==="passthrough":Qt(n.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??!0}function are(n,e){const t={type:"object",...Object.entries(n.shape()).reduce((r,[i,a])=>{var u;if(a===void 0||a._def===void 0)return r;const s=[...e.currentPath,"properties",i],o=Qt(a._def,{...e,currentPath:s,propertyPath:s});if(o===void 0)return r;if(e.openaiStrictMode&&a.isOptional()&&!a.isNullable()&&typeof((u=a._def)==null?void 0:u.defaultValue)>"u")throw new Error(`Zod field at \`${s.join("/")}\` uses \`.optional()\` without \`.nullable()\` which is not supported by the API. See: https://platform.openai.com/docs/guides/structured-outputs?api-mode=responses#all-fields-must-be-required`);return{properties:{...r.properties,[i]:o},required:a.isOptional()&&!e.openaiStrictMode?r.required:[...r.required,i]}},{properties:{},required:[]}),additionalProperties:ire(n,e)};return t.required.length||delete t.required,t}const sre=(n,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return Qt(n.innerType._def,e);const t=Qt(n.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return t?{anyOf:[{not:{}},t]}:{}},ore=(n,e)=>{if(e.pipeStrategy==="input")return Qt(n.in._def,e);if(e.pipeStrategy==="output")return Qt(n.out._def,e);const t=Qt(n.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),r=Qt(n.out._def,{...e,currentPath:[...e.currentPath,"allOf",t?"1":"0"]});return{allOf:[t,r].filter(i=>i!==void 0)}};function lre(n,e){return Qt(n.type._def,e)}function ure(n,e){const r={type:"array",uniqueItems:!0,items:Qt(n.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return n.minSize&&pn(r,"minItems",n.minSize.value,n.minSize.message,e),n.maxSize&&pn(r,"maxItems",n.maxSize.value,n.maxSize.message,e),r}function cre(n,e){return n.rest?{type:"array",minItems:n.items.length,items:n.items.map((t,r)=>Qt(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[]),additionalItems:Qt(n.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:n.items.length,maxItems:n.items.length,items:n.items.map((t,r)=>Qt(t._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((t,r)=>r===void 0?t:[...t,r],[])}}function fre(){return{not:{}}}function dre(){return{}}const hre=(n,e)=>Qt(n.innerType._def,e);function Qt(n,e,t=!1){var s;const r=e.seen.get(n);if(e.override){const o=(s=e.override)==null?void 0:s.call(e,n,e,r,t);if(o!==kne)return o}if(r&&!t){const o=pre(r,e);if(o!==void 0)return"$ref"in o&&e.seenRefs.add(o.$ref),o}const i={def:n,path:e.currentPath,jsonSchema:void 0};e.seen.set(n,i);const a=gre(n,n.typeName,e,t);return a&&yre(n,e,a),i.jsonSchema=a,a}const pre=(n,e)=>{switch(e.$refStrategy){case"root":return{$ref:n.path.join("/")};case"extract-to-root":const t=n.path.slice(e.basePath.length+1).join("_");return t!==e.name&&e.nameStrategy==="duplicate-ref"&&(e.definitions[t]=n.def),{$ref:[...e.basePath,e.definitionPath,t].join("/")};case"relative":return{$ref:mre(e.currentPath,n.path)};case"none":case"seen":return n.path.length<e.currentPath.length&&n.path.every((r,i)=>e.currentPath[i]===r)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),{}):e.$refStrategy==="seen"?{}:void 0}},mre=(n,e)=>{let t=0;for(;t<n.length&&t<e.length&&n[t]===e[t];t++);return[(n.length-t).toString(),...e.slice(t)].join("/")},gre=(n,e,t,r)=>{switch(e){case De.ZodString:return C5(n,t);case De.ZodNumber:return rre(n,t);case De.ZodObject:return are(n,t);case De.ZodBigInt:return jne(n,t);case De.ZodBoolean:return Fne();case De.ZodDate:return A5(n,t);case De.ZodUndefined:return fre();case De.ZodNull:return ere(t);case De.ZodArray:return Une(n,t);case De.ZodUnion:case De.ZodDiscriminatedUnion:return tre(n,t);case De.ZodIntersection:return Kne(n,t);case De.ZodTuple:return cre(n,t);case De.ZodRecord:return R5(n,t);case De.ZodLiteral:return Jne(n,t);case De.ZodEnum:return Gne(n);case De.ZodNativeEnum:return Xne(n);case De.ZodNullable:return nre(n,t);case De.ZodOptional:return sre(n,t);case De.ZodMap:return Zne(n,t);case De.ZodSet:return ure(n,t);case De.ZodLazy:return Qt(n.getter()._def,t);case De.ZodPromise:return lre(n,t);case De.ZodNaN:case De.ZodNever:return Qne();case De.ZodEffects:return Hne(n,t,r);case De.ZodAny:return Lne();case De.ZodUnknown:return dre();case De.ZodDefault:return zne(n,t);case De.ZodBranded:return Bne(n,t);case De.ZodReadonly:return hre(n,t);case De.ZodCatch:return qne(n,t);case De.ZodPipeline:return ore(n,t);case De.ZodFunction:case De.ZodVoid:case De.ZodSymbol:return;default:return(i=>{})()}},yre=(n,e,t)=>(n.description&&(t.description=n.description,e.markdownDescription&&(t.markdownDescription=n.description)),t),vre=(n,e)=>{const t=$ne(e),r=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,i=Qt(n._def,r===void 0?t:{...t,currentPath:[...t.basePath,t.definitionPath,r]},!1)??{},a=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;a!==void 0&&(i.title=a);const s=(()=>{if(Dne(t.definitions))return;const u={},c=new Set;for(let d=0;d<500;d++){const p=Object.entries(t.definitions).filter(([m])=>!c.has(m));if(p.length===0)break;for(const[m,y]of p)u[m]=Qt(H1(y),{...t,currentPath:[...t.basePath,t.definitionPath,m]},!0)??{},c.add(m)}return u})(),o=r===void 0?s?{...i,[t.definitionPath]:s}:i:t.nameStrategy==="duplicate-ref"?{...i,...s||t.seenRefs.size?{[t.definitionPath]:{...s,...t.seenRefs.size?{[r]:i}:void 0}}:void 0}:{$ref:[...t.$refStrategy==="relative"?[]:t.basePath,t.definitionPath,r].join("/"),[t.definitionPath]:{...s,[r]:i}};return t.target==="jsonSchema7"?o.$schema="http://json-schema.org/draft-07/schema#":t.target==="jsonSchema2019-09"&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),o};function _re(n,e){return vre(n,{openaiStrictMode:!0,name:e.name,nameStrategy:"duplicate-ref",$refStrategy:"extract-to-root",nullableStrategy:"property"})}function bre(n,e,t){return qte({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:_re(n,{name:e})}},r=>n.parse(JSON.parse(r)))}const wre=Object.freeze(Object.defineProperty({__proto__:null,extendInteropZodObject:jB,getInteropZodDefaultGetter:jJ,getInteropZodObjectShape:c1,getSchemaDescription:td,interopParse:Jy,interopParseAsync:G_,interopSafeParse:LJ,interopSafeParseAsync:H_,interopZodObjectPartial:eI,interopZodObjectPassthrough:f1,interopZodObjectStrict:Gv,interopZodTransformInputSchema:Af,isInteropZodObject:xo,isInteropZodSchema:Pi,isShapelessZodSchema:UJ,isSimpleStringZodSchema:XR,isZodArrayV4:W_,isZodObjectV3:QR,isZodObjectV4:Hs,isZodSchema:$J,isZodSchemaV3:sr,isZodSchemaV4:ar},Symbol.toStringTag,{value:"Module"}));function Ere(n){const{azureOpenAIApiDeploymentName:e,azureOpenAIApiInstanceName:t,azureOpenAIApiKey:r,azureOpenAIBasePath:i,baseURL:a,azureADTokenProvider:s,azureOpenAIEndpoint:o}=n;if((r||s)&&i&&e)return`${i}/${e}`;if((r||s)&&o&&e)return`${o}/openai/deployments/${e}`;if(r||s){if(!t)throw new Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!e)throw new Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${t}.openai.azure.com/openai/deployments/${e}`}return a}function I5(n,e){const t=typeof e=="number"?void 0:e;return{name:n.name,description:n.description,parameters:yr(n.schema),...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}}function P5(n,e){const t=typeof e=="number"?void 0:e;let r;return cc(n)?r={type:"function",function:I5(n)}:r=n,(t==null?void 0:t.strict)!==void 0&&(r.function.strict=t.strict),r}const Sre=Object.freeze(Object.defineProperty({__proto__:null,convertToOpenAIFunction:I5,convertToOpenAITool:P5,isLangChainTool:cc,isRunnableToolLike:fI,isStructuredTool:cI,isStructuredToolParams:dI},Symbol.toStringTag,{value:"Module"}));function yy(n,e){return n.lc_error_code=e,n.message=`${n.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,n}function GA(n){let e;return n.constructor.name===cb.name?(e=new Error(n.message),e.name="TimeoutError"):n.constructor.name===sa.name?(e=new Error(n.message),e.name="AbortError"):n.status===400&&n.message.includes("tool_calls")?e=yy(n,"INVALID_TOOL_RESULTS"):n.status===401?e=yy(n,"MODEL_AUTHENTICATION"):n.status===429?e=yy(n,"MODEL_RATE_LIMIT"):n.status===404?e=yy(n,"MODEL_NOT_FOUND"):e=n,e}function i4(n){if(n)return n==="any"||n==="required"?"required":n==="auto"?"auto":n==="none"?"none":typeof n=="string"?{type:"function",function:{name:n}}:n}function Tre(n){return n.anyOf!==void 0&&Array.isArray(n.anyOf)}function Are(n){const e=["namespace functions {",""];for(const t of n)t.description&&e.push(`// ${t.description}`),Object.keys(t.parameters.properties??{}).length>0?(e.push(`type ${t.name} = (_: {`),e.push(x5(t.parameters,0)),e.push("}) => any;")):e.push(`type ${t.name} = () => any;`),e.push("");return e.push("} // namespace functions"),e.join(`
`)}function x5(n,e){var r;const t=[];for(const[i,a]of Object.entries(n.properties??{}))a.description&&e<2&&t.push(`// ${a.description}`),(r=n.required)!=null&&r.includes(i)?t.push(`${i}: ${s_(a,e)},`):t.push(`${i}?: ${s_(a,e)},`);return t.map(i=>" ".repeat(e)+i).join(`
`)}function s_(n,e){if(Tre(n))return n.anyOf.map(t=>s_(t,e)).join(" | ");switch(n.type){case"string":return n.enum?n.enum.map(t=>`"${t}"`).join(" | "):"string";case"number":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"integer":return n.enum?n.enum.map(t=>`${t}`).join(" | "):"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",x5(n,e+2),"}"].join(`
`);case"array":return n.items?`${s_(n.items,e)}[]`:"any[]";default:return""}}function Cre(n,e){let t;return cc(n)?t=P5(n):t=n,(e==null?void 0:e.strict)!==void 0&&(t.function.strict=e.strict),t}function Rre(n){return n.role!=="system"&&n.role!=="developer"&&n.role!=="assistant"&&n.role!=="user"&&n.role!=="function"&&n.role!=="tool"&&console.warn(`Unknown message role: ${n.role}`),n.role}function tP(n){const e=n._getType();switch(e){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":{if(!La.isInstance(n))throw new Error("Invalid generic chat message");return Rre(n)}default:throw new Error(`Unknown message type: ${e}`)}}const O5={providerName:"ChatOpenAI",fromStandardTextBlock(n){return{type:"text",text:n.text}},fromStandardImageBlock(n){var e,t;if(n.source_type==="url")return{type:"image_url",image_url:{url:n.url,...(e=n.metadata)!=null&&e.detail?{detail:n.metadata.detail}:{}}};if(n.source_type==="base64")return{type:"image_url",image_url:{url:`data:${n.mime_type??""};base64,${n.data}`,...(t=n.metadata)!=null&&t.detail?{detail:n.metadata.detail}:{}}};throw new Error(`Image content blocks with source_type ${n.source_type} are not supported for ChatOpenAI`)},fromStandardAudioBlock(n){if(n.source_type==="url"){const e=xl({dataUrl:n.url});if(!e)throw new Error(`URL audio blocks with source_type ${n.source_type} must be formatted as a data URL for ChatOpenAI`);const t=e.mime_type||n.mime_type||"";let r;try{r=VC(t)}catch{throw new Error(`Audio blocks with source_type ${n.source_type} must have mime type of audio/wav or audio/mp3`)}if(r.type!=="audio"||r.subtype!=="wav"&&r.subtype!=="mp3")throw new Error(`Audio blocks with source_type ${n.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:r.subtype,data:e.data}}}if(n.source_type==="base64"){let e;try{e=VC(n.mime_type??"")}catch{throw new Error(`Audio blocks with source_type ${n.source_type} must have mime type of audio/wav or audio/mp3`)}if(e.type!=="audio"||e.subtype!=="wav"&&e.subtype!=="mp3")throw new Error(`Audio blocks with source_type ${n.source_type} must have mime type of audio/wav or audio/mp3`);return{type:"input_audio",input_audio:{format:e.subtype,data:n.data}}}throw new Error(`Audio content blocks with source_type ${n.source_type} are not supported for ChatOpenAI`)},fromStandardFileBlock(n){var e,t,r,i,a,s,o,u,c,d;if(n.source_type==="url"){if(!xl({dataUrl:n.url}))throw new Error(`URL file blocks with source_type ${n.source_type} must be formatted as a data URL for ChatOpenAI`);return{type:"file",file:{file_data:n.url,...(e=n.metadata)!=null&&e.filename||(t=n.metadata)!=null&&t.name?{filename:((r=n.metadata)==null?void 0:r.filename)||((i=n.metadata)==null?void 0:i.name)}:{}}}}if(n.source_type==="base64")return{type:"file",file:{file_data:`data:${n.mime_type??""};base64,${n.data}`,...(a=n.metadata)!=null&&a.filename||(s=n.metadata)!=null&&s.name||(o=n.metadata)!=null&&o.title?{filename:((u=n.metadata)==null?void 0:u.filename)||((c=n.metadata)==null?void 0:c.name)||((d=n.metadata)==null?void 0:d.title)}:{}}};if(n.source_type==="id")return{type:"file",file:{file_id:n.id}};throw new Error(`File content blocks with source_type ${n.source_type} are not supported for ChatOpenAI`)}};function a4(n,e){return n.flatMap(t=>{var s;let r=tP(t);r==="system"&&o_(e)&&(r="developer");const i=typeof t.content=="string"?t.content:t.content.map(o=>Da(o)?rm(o,O5):o),a={role:r,content:i};if(t.name!=null&&(a.name=t.name),t.additional_kwargs.function_call!=null&&(a.function_call=t.additional_kwargs.function_call,a.content=""),ua(t)&&((s=t.tool_calls)!=null&&s.length)?(a.tool_calls=t.tool_calls.map(One),a.content=""):(t.additional_kwargs.tool_calls!=null&&(a.tool_calls=t.additional_kwargs.tool_calls),t.tool_call_id!=null&&(a.tool_call_id=t.tool_call_id)),t.additional_kwargs.audio&&typeof t.additional_kwargs.audio=="object"&&"id"in t.additional_kwargs.audio){const o={role:"assistant",audio:{id:t.additional_kwargs.audio.id}};return[a,o]}return a})}const Pf="__openai_function_call_ids__";function Ire(n){const e=(n.summary.length>1?n.summary.reduce((t,r)=>{const i=t.at(-1);return i.index===r.index?i.text+=r.text:t.push(r),t},[{...n.summary[0]}]):n.summary).map(t=>Object.fromEntries(Object.entries(t).filter(([r])=>r!=="index")));return{...n,summary:e}}function s4(n,e,t){return n.flatMap(r=>{var s,o,u;const i=r.additional_kwargs;let a=tP(r);if(a==="system"&&o_(e)&&(a="developer"),a==="function")throw new Error("Function messages are not supported in Responses API");if(a==="tool"){const c=r;return(i==null?void 0:i.type)==="computer_call_output"?{type:"computer_call_output",output:(()=>{if(typeof c.content=="string")return{type:"computer_screenshot",image_url:c.content};if(Array.isArray(c.content)){const p=c.content.find(y=>y.type==="computer_screenshot");if(p)return p;const m=c.content.find(y=>y.type==="image_url");if(m)return{type:"computer_screenshot",image_url:typeof m.image_url=="string"?m.image_url:m.image_url.url}}throw new Error("Invalid computer call output")})(),call_id:c.tool_call_id}:{type:"function_call_output",call_id:c.tool_call_id,id:(s=c.id)!=null&&s.startsWith("fc_")?c.id:void 0,output:typeof c.content!="string"?JSON.stringify(c.content):c.content}}if(a==="assistant"){if(!t&&r.response_metadata.output!=null&&Array.isArray(r.response_metadata.output)&&r.response_metadata.output.length>0&&r.response_metadata.output.every(b=>"type"in b))return r.response_metadata.output;const c=[];if(i!=null&&i.reasoning&&!t){const b=Ire(i.reasoning);c.push(b)}let{content:d}=r;i!=null&&i.refusal&&(typeof d=="string"&&(d=[{type:"output_text",text:d,annotations:[]}]),d=[...d,{type:"refusal",refusal:i.refusal}]),c.push({type:"message",role:"assistant",...r.id&&!t?{id:r.id}:{},content:typeof d=="string"?d:d.flatMap(b=>b.type==="text"?{type:"output_text",text:b.text,annotations:b.annotations??[]}:b.type==="output_text"||b.type==="refusal"?b:[])});const p=i==null?void 0:i[Pf];ua(r)&&((o=r.tool_calls)!=null&&o.length)?c.push(...r.tool_calls.map(b=>({type:"function_call",name:b.name,arguments:JSON.stringify(b.args),call_id:b.id,...t?{id:p==null?void 0:p[b.id]}:{}}))):i!=null&&i.tool_calls&&c.push(...i.tool_calls.map(b=>({type:"function_call",name:b.function.name,call_id:b.id,arguments:b.function.arguments,...t?{id:p==null?void 0:p[b.id]}:{}})));const m=(u=r.response_metadata.output)!=null&&u.length?r.response_metadata.output:i.tool_outputs,y=["computer_call","mcp_call","code_interpreter_call","image_generation_call"];if(m!=null){const b=m,w=b==null?void 0:b.filter(S=>y.includes(S.type));w.length>0&&c.push(...w)}return c}if(a==="user"||a==="system"||a==="developer"){if(typeof r.content=="string")return{type:"message",role:a,content:r.content};const c=[],d=r.content.flatMap(p=>(p.type==="mcp_approval_response"&&c.push({type:"mcp_approval_response",approval_request_id:p.approval_request_id,approve:p.approve}),Da(p)?rm(p,O5):p.type==="text"?{type:"input_text",text:p.text}:p.type==="image_url"?{type:"input_image",image_url:typeof p.image_url=="string"?p.image_url:p.image_url.url,detail:typeof p.image_url=="string"?"auto":p.image_url.detail}:p.type==="input_text"||p.type==="input_image"||p.type==="input_file"?p:[]));return d.length>0&&c.push({type:"message",role:a,content:d}),c}return console.warn(`Unsupported role found when converting to OpenAI Responses API: ${a}`),[]})}function N5(n){if(n.error){const o=new Error(n.error.message);throw o.name=n.error.code,o}let e;const t=[],r=[],i=[],a={model:n.model,created_at:n.created_at,id:n.id,incomplete_details:n.incomplete_details,metadata:n.metadata,object:n.object,status:n.status,user:n.user,service_tier:n.service_tier,model_name:n.model},s={};for(const o of n.output)if(o.type==="message")e=o.id,t.push(...o.content.flatMap(u=>u.type==="output_text"?("parsed"in u&&u.parsed!=null&&(s.parsed=u.parsed),{type:"text",text:u.text,annotations:u.annotations}):u.type==="refusal"?(s.refusal=u.refusal,[]):u));else if(o.type==="function_call"){const u={function:{name:o.name,arguments:o.arguments},id:o.call_id};try{r.push(eP(u,{returnId:!0}))}catch(c){let d;typeof c=="object"&&c!=null&&"message"in c&&typeof c.message=="string"&&(d=c.message),i.push(S5(u,d))}s[Pf]??(s[Pf]={}),o.id&&(s[Pf][o.call_id]=o.id)}else o.type==="reasoning"?s.reasoning=o:(s.tool_outputs??(s.tool_outputs=[]),s.tool_outputs.push(o));return new bn({id:e,content:t,tool_calls:r,invalid_tool_calls:i,usage_metadata:n.usage,additional_kwargs:s,response_metadata:a})}function Pre(n){var u,c;const e=[];let t={},r;const i=[],a={},s={};let o;if(n.type==="response.output_text.delta")e.push({type:"text",text:n.delta,index:n.content_index});else if(n.type==="response.output_text_annotation.added")e.push({type:"text",text:"",annotations:[n.annotation],index:n.content_index});else if(n.type==="response.output_item.added"&&n.item.type==="message")o=n.item.id;else if(n.type==="response.output_item.added"&&n.item.type==="function_call")i.push({type:"tool_call_chunk",name:n.item.name,args:n.item.arguments,id:n.item.call_id,index:n.output_index}),s[Pf]={[n.item.call_id]:n.item.id};else if(n.type==="response.output_item.done"&&["web_search_call","file_search_call","computer_call","code_interpreter_call","mcp_call","mcp_list_tools","mcp_approval_request","image_generation_call"].includes(n.item.type))s.tool_outputs=[n.item];else if(n.type==="response.created")a.id=n.response.id,a.model_name=n.response.model,a.model=n.response.model;else if(n.type==="response.completed"){const d=N5(n.response);r=n.response.usage,((c=(u=n.response.text)==null?void 0:u.format)==null?void 0:c.type)==="json_schema"&&(s.parsed??(s.parsed=JSON.parse(d.text)));for(const[p,m]of Object.entries(n.response))p!=="id"&&(a[p]=m)}else if(n.type==="response.function_call_arguments.delta")i.push({type:"tool_call_chunk",args:n.delta,index:n.output_index});else if(n.type==="response.web_search_call.completed"||n.type==="response.file_search_call.completed")t={tool_outputs:{id:n.item_id,type:n.type.replace("response.","").replace(".completed",""),status:"completed"}};else if(n.type==="response.refusal.done")s.refusal=n.refusal;else if(n.type==="response.output_item.added"&&"item"in n&&n.item.type==="reasoning"){const d=n.item.summary?n.item.summary.map((p,m)=>({...p,index:m})):void 0;s.reasoning={id:n.item.id,type:n.item.type,...d?{summary:d}:{}}}else if(n.type==="response.reasoning_summary_part.added")s.reasoning={type:"reasoning",summary:[{...n.part,index:n.summary_index}]};else if(n.type==="response.reasoning_summary_text.delta")s.reasoning={type:"reasoning",summary:[{text:n.delta,type:"summary_text",index:n.summary_index}]};else return n.type==="response.image_generation_call.partial_image",null;return new ca({text:e.map(d=>d.text).join(""),message:new Sn({id:o,content:e,tool_call_chunks:i,usage_metadata:r,additional_kwargs:s,response_metadata:a}),generationInfo:t})}function G1(n){return"type"in n&&n.type!=="function"}function xre(n){return n!=null&&typeof n=="object"&&"type"in n&&n.type!=="function"}function Ore(n,e){const t=[];for(const r of n)G1(r)?(r.type==="image_generation"&&(e!=null&&e.stream)&&(r.partial_images=1),t.push(r)):pd(r)&&t.push({type:"function",name:r.function.name,parameters:r.function.parameters,description:r.function.description,strict:(e==null?void 0:e.strict)??null});return t}function o4(n,e){return pd(n)?(e==null?void 0:e.strict)!==void 0?{...n,function:{...n.function,strict:e.strict}}:n:Cre(n,e)}function o_(n){return n&&/^o\d/.test(n)}class Nre extends ui{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed","reasoning_effort","service_tier"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key"}}get lc_serializable_keys(){return["configuration","logprobs","topLogprobs","prefixMessages","supportsStrictToolCalling","modalities","audio","reasoningEffort","temperature","maxTokens","topP","frequencyPenalty","presencePenalty","n","logitBias","user","streaming","streamUsage","modelName","model","modelKwargs","stop","stopSequences","timeout","openAIApiKey","apiKey","cache","maxConcurrency","maxRetries","verbose","callbacks","tags","metadata","disableStreaming","useResponsesApi","zdrEnabled","reasoning"]}constructor(e){var t,r,i;super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__includeRawResponse",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"supportsStrictToolCalling",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"audio",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modalities",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoningEffort",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"reasoning",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"useResponsesApi",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zdrEnabled",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"service_tier",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.openAIApiKey)??((t=e==null?void 0:e.configuration)==null?void 0:t.apiKey)??Mi("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.organization=((r=e==null?void 0:e.configuration)==null?void 0:r.organization)??Mi("OPENAI_ORGANIZATION"),this.model=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.modelName=this.model,this.modelKwargs=(e==null?void 0:e.modelKwargs)??{},this.timeout=e==null?void 0:e.timeout,this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topP=(e==null?void 0:e.topP)??this.topP,this.frequencyPenalty=(e==null?void 0:e.frequencyPenalty)??this.frequencyPenalty,this.presencePenalty=(e==null?void 0:e.presencePenalty)??this.presencePenalty,this.logprobs=e==null?void 0:e.logprobs,this.topLogprobs=e==null?void 0:e.topLogprobs,this.n=(e==null?void 0:e.n)??this.n,this.logitBias=e==null?void 0:e.logitBias,this.stop=(e==null?void 0:e.stopSequences)??(e==null?void 0:e.stop),this.stopSequences=this.stop,this.user=e==null?void 0:e.user,this.__includeRawResponse=e==null?void 0:e.__includeRawResponse,this.audio=e==null?void 0:e.audio,this.modalities=e==null?void 0:e.modalities,this.reasoningEffort=(e==null?void 0:e.reasoningEffort)??((i=e==null?void 0:e.reasoning)==null?void 0:i.effort),this.reasoning=(e==null?void 0:e.reasoning)??(e!=null&&e.reasoningEffort?{effort:e.reasoningEffort}:void 0),this.maxTokens=(e==null?void 0:e.maxCompletionTokens)??(e==null?void 0:e.maxTokens),this.useResponsesApi=(e==null?void 0:e.useResponsesApi)??this.useResponsesApi,this.disableStreaming=(e==null?void 0:e.disableStreaming)??this.disableStreaming,this.streaming=(e==null?void 0:e.streaming)??!1,this.disableStreaming&&(this.streaming=!1),this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.disableStreaming&&(this.streamUsage=!1),this.clientConfig={apiKey:this.apiKey,organization:this.organization,dangerouslyAllowBrowser:!0,...e==null?void 0:e.configuration},(e==null?void 0:e.supportsStrictToolCalling)!==void 0&&(this.supportsStrictToolCalling=e.supportsStrictToolCalling),(e==null?void 0:e.service_tier)!==void 0&&(this.service_tier=e.service_tier),this.zdrEnabled=(e==null?void 0:e.zdrEnabled)??!1}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"openai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}bindTools(e,t){let r;return(t==null?void 0:t.strict)!==void 0?r=t.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling),this.withConfig({tools:e.map(i=>G1(i)?i:o4(i,{strict:r})),...t})}createResponseFormat(e){return e&&e.type==="json_schema"&&e.json_schema.schema&&Pi(e.json_schema.schema)?Dre(e.json_schema.schema,e.json_schema.name,{description:e.json_schema.description}):e}getReasoningParams(e){if(!o_(this.model))return;let t;return this.reasoningEffort!==void 0&&(t={effort:this.reasoningEffort}),this.reasoning!==void 0&&(t={...t,...this.reasoning}),(e==null?void 0:e.reasoning_effort)!==void 0&&(t={...t,effort:e.reasoning_effort}),(e==null?void 0:e.reasoning)!==void 0&&(t={...t,...e.reasoning}),t}invocationParams(e,t){var o,u;let r;if((e==null?void 0:e.strict)!==void 0?r=e.strict:this.supportsStrictToolCalling!==void 0&&(r=this.supportsStrictToolCalling),this._useResponseApi(e)){const c={model:this.model,temperature:this.temperature,top_p:this.topP,user:this.user,stream:this.streaming,previous_response_id:e==null?void 0:e.previous_response_id,truncation:e==null?void 0:e.truncation,include:e==null?void 0:e.include,tools:(o=e==null?void 0:e.tools)!=null&&o.length?Ore(e.tools,{stream:this.streaming,strict:r}):void 0,tool_choice:xre(e==null?void 0:e.tool_choice)?e==null?void 0:e.tool_choice:(()=>{const p=i4(e==null?void 0:e.tool_choice);if(typeof p=="object"&&"type"in p)return{type:"function",name:p.function.name}})(),text:(()=>{if(e!=null&&e.text)return e.text;const p=this.createResponseFormat(e==null?void 0:e.response_format);return(p==null?void 0:p.type)==="json_schema"?p.json_schema.schema!=null?{format:{type:"json_schema",schema:p.json_schema.schema,description:p.json_schema.description,name:p.json_schema.name,strict:p.json_schema.strict}}:void 0:{format:p}})(),parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,max_output_tokens:this.maxTokens===-1?void 0:this.maxTokens,...this.zdrEnabled?{store:!1}:{},...this.modelKwargs},d=this.getReasoningParams(e);return d!==void 0&&(c.reasoning=d),c}let i={};(e==null?void 0:e.stream_options)!==void 0?i={stream_options:e.stream_options}:this.streamUsage&&(this.streaming||t!=null&&t.streaming)&&(i={stream_options:{include_usage:!0}});const a={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:(e==null?void 0:e.stop)??this.stopSequences,user:this.user,stream:this.streaming,functions:e==null?void 0:e.functions,function_call:e==null?void 0:e.function_call,tools:(u=e==null?void 0:e.tools)!=null&&u.length?e.tools.map(c=>o4(c,{strict:r})):void 0,tool_choice:i4(e==null?void 0:e.tool_choice),response_format:this.createResponseFormat(e==null?void 0:e.response_format),seed:e==null?void 0:e.seed,...i,parallel_tool_calls:e==null?void 0:e.parallel_tool_calls,...this.audio||e!=null&&e.audio?{audio:this.audio||(e==null?void 0:e.audio)}:{},...this.modalities||e!=null&&e.modalities?{modalities:this.modalities||(e==null?void 0:e.modalities)}:{},...this.modelKwargs};(e==null?void 0:e.prediction)!==void 0&&(a.prediction=e.prediction),this.service_tier!==void 0&&(a.service_tier=this.service_tier),(e==null?void 0:e.service_tier)!==void 0&&(a.service_tier=e.service_tier);const s=this.getReasoningParams(e);return s!==void 0&&s.effort!==void 0&&(a.reasoning_effort=s.effort),o_(a.model)?a.max_completion_tokens=this.maxTokens===-1?void 0:this.maxTokens:a.max_tokens=this.maxTokens===-1?void 0:this.maxTokens,a}_convertOpenAIChatCompletionMessageToBaseMessage(e,t){const r=e.tool_calls;switch(e.role){case"assistant":{const i=[],a=[];for(const u of r??[])try{i.push(eP(u,{returnId:!0}))}catch(c){a.push(S5(u,c.message))}const s={function_call:e.function_call,tool_calls:r};this.__includeRawResponse!==void 0&&(s.__raw_response=t);const o={model_name:t.model,...t.system_fingerprint?{usage:{...t.usage},system_fingerprint:t.system_fingerprint}:{}};return e.audio&&(s.audio=e.audio),new bn({content:e.content||"",tool_calls:i,invalid_tool_calls:a,additional_kwargs:s,response_metadata:o,id:t.id})}default:return new La(e.content||"",e.role??"unknown")}}_convertOpenAIDeltaToBaseMessageChunk(e,t,r){var u,c;const i=e.role??r,a=e.content??"";let s;e.function_call?s={function_call:e.function_call}:e.tool_calls?s={tool_calls:e.tool_calls}:s={},this.__includeRawResponse&&(s.__raw_response=t),e.audio&&(s.audio={...e.audio,index:t.choices[0].index});const o={usage:{...t.usage}};if(i==="user")return new oc({content:a,response_metadata:o});if(i==="assistant"){const d=[];if(Array.isArray(e.tool_calls))for(const p of e.tool_calls)d.push({name:(u=p.function)==null?void 0:u.name,args:(c=p.function)==null?void 0:c.arguments,id:p.id,index:p.index,type:"tool_call_chunk"});return new Sn({content:a,tool_call_chunks:d,additional_kwargs:s,id:t.id,response_metadata:o})}else return i==="system"?new Gs({content:a,response_metadata:o}):i==="developer"?new Gs({content:a,response_metadata:o,additional_kwargs:{__openai_role__:"developer"}}):i==="function"?new sc({content:a,additional_kwargs:s,name:e.name,response_metadata:o}):i==="tool"?new fd({content:a,additional_kwargs:s,tool_call_id:e.tool_call_id,response_metadata:o}):new ac({content:a,role:i,response_metadata:o})}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async*_streamResponseChunks(e,t,r){var c,d,p,m,y,b,w,S,T,C;if(this._useResponseApi(t)){const A=await this.responseApiWithRetry({...this.invocationParams(t,{streaming:!0}),input:s4(e,this.model,this.zdrEnabled),stream:!0},t);for await(const I of A){const x=Pre(I);x!=null&&(yield x)}return}const i=a4(e,this.model),a={...this.invocationParams(t,{streaming:!0}),messages:i,stream:!0};let s;const o=await this.completionWithRetry(a,t);let u;for await(const A of o){const I=(c=A==null?void 0:A.choices)==null?void 0:c[0];if(A.usage&&(u=A.usage),!I)continue;const{delta:x}=I;if(!x)continue;const L=this._convertOpenAIDeltaToBaseMessageChunk(x,A,s);s=x.role??s;const U={prompt:t.promptIndex??0,completion:I.index??0};if(typeof L.content!="string"){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}const N={...U};I.finish_reason!=null&&(N.finish_reason=I.finish_reason,N.system_fingerprint=A.system_fingerprint,N.model_name=A.model,N.service_tier=A.service_tier),this.logprobs&&(N.logprobs=I.logprobs);const B=new ca({message:L,text:L.content,generationInfo:N});yield B,await(r==null?void 0:r.handleLLMNewToken(B.text??"",U,void 0,void 0,void 0,{chunk:B}))}if(u){const A={...((d=u.prompt_tokens_details)==null?void 0:d.audio_tokens)!==null&&{audio:(p=u.prompt_tokens_details)==null?void 0:p.audio_tokens},...((m=u.prompt_tokens_details)==null?void 0:m.cached_tokens)!==null&&{cache_read:(y=u.prompt_tokens_details)==null?void 0:y.cached_tokens}},I={...((b=u.completion_tokens_details)==null?void 0:b.audio_tokens)!==null&&{audio:(w=u.completion_tokens_details)==null?void 0:w.audio_tokens},...((S=u.completion_tokens_details)==null?void 0:S.reasoning_tokens)!==null&&{reasoning:(T=u.completion_tokens_details)==null?void 0:T.reasoning_tokens}};yield new ca({message:new Sn({content:"",response_metadata:{usage:{...u}},usage_metadata:{input_tokens:u.prompt_tokens,output_tokens:u.completion_tokens,total_tokens:u.total_tokens,...Object.keys(A).length>0&&{input_token_details:A},...Object.keys(I).length>0&&{output_token_details:I}}}),text:""})}if((C=t.signal)!=null&&C.aborted)throw new Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _responseApiGenerate(e,t,r){var o;const i=this.invocationParams(t);if(i.stream){const u=this._streamResponseChunks(e,t,r);let c;for await(const d of u)d.message.response_metadata={...d.generationInfo,...d.message.response_metadata},c=(c==null?void 0:c.concat(d))??d;return{generations:c?[c]:[],llmOutput:{estimatedTokenUsage:(o=c==null?void 0:c.message)==null?void 0:o.usage_metadata}}}const a=s4(e,this.model,this.zdrEnabled),s=await this.responseApiWithRetry({input:a,...i},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});return{generations:[{text:s.output_text,message:N5(s)}],llmOutput:{id:s.id,estimatedTokenUsage:s.usage?{promptTokens:s.usage.input_tokens,completionTokens:s.usage.output_tokens,totalTokens:s.usage.total_tokens}:void 0}}}_useResponseApi(e){var i,a,s;const t=(i=e==null?void 0:e.tools)==null?void 0:i.some(G1),r=(e==null?void 0:e.previous_response_id)!=null||(e==null?void 0:e.text)!=null||(e==null?void 0:e.truncation)!=null||(e==null?void 0:e.include)!=null||((a=e==null?void 0:e.reasoning)==null?void 0:a.summary)!=null||((s=this.reasoning)==null?void 0:s.summary)!=null;return this.useResponsesApi||t||r}async _generate(e,t,r){var o,u;if(this._useResponseApi(t))return this._responseApiGenerate(e,t,r);const i={},a=this.invocationParams(t),s=a4(e,this.model);if(a.stream){const c=this._streamResponseChunks(e,t,r),d={};for await(const S of c){S.message.response_metadata={...S.generationInfo,...S.message.response_metadata};const T=((o=S.generationInfo)==null?void 0:o.completion)??0;d[T]===void 0?d[T]=S:d[T]=d[T].concat(S)}const p=Object.entries(d).sort(([S],[T])=>parseInt(S,10)-parseInt(T,10)).map(([S,T])=>T),{functions:m,function_call:y}=this.invocationParams(t),b=await this.getEstimatedTokenCountFromPrompt(e,m,y),w=await this.getNumTokensFromGenerations(p);return i.input_tokens=b,i.output_tokens=w,i.total_tokens=b+w,{generations:p,llmOutput:{estimatedTokenUsage:{promptTokens:i.input_tokens,completionTokens:i.output_tokens,totalTokens:i.total_tokens}}}}else{let c;t.response_format&&t.response_format.type==="json_schema"?c=await this.betaParsedCompletionWithRetry({...a,stream:!1,messages:s},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options}):c=await this.completionWithRetry({...a,stream:!1,messages:s},{signal:t==null?void 0:t.signal,...t==null?void 0:t.options});const{completion_tokens:d,prompt_tokens:p,total_tokens:m,prompt_tokens_details:y,completion_tokens_details:b}=(c==null?void 0:c.usage)??{};d&&(i.output_tokens=(i.output_tokens??0)+d),p&&(i.input_tokens=(i.input_tokens??0)+p),m&&(i.total_tokens=(i.total_tokens??0)+m),((y==null?void 0:y.audio_tokens)!==null||(y==null?void 0:y.cached_tokens)!==null)&&(i.input_token_details={...(y==null?void 0:y.audio_tokens)!==null&&{audio:y==null?void 0:y.audio_tokens},...(y==null?void 0:y.cached_tokens)!==null&&{cache_read:y==null?void 0:y.cached_tokens}}),((b==null?void 0:b.audio_tokens)!==null||(b==null?void 0:b.reasoning_tokens)!==null)&&(i.output_token_details={...(b==null?void 0:b.audio_tokens)!==null&&{audio:b==null?void 0:b.audio_tokens},...(b==null?void 0:b.reasoning_tokens)!==null&&{reasoning:b==null?void 0:b.reasoning_tokens}});const w=[];for(const S of(c==null?void 0:c.choices)??[]){const C={text:((u=S.message)==null?void 0:u.content)??"",message:this._convertOpenAIChatCompletionMessageToBaseMessage(S.message??{role:"assistant"},c)};C.generationInfo={...S.finish_reason?{finish_reason:S.finish_reason}:{},...S.logprobs?{logprobs:S.logprobs}:{}},ua(C.message)&&(C.message.usage_metadata=i),C.message=new bn(Object.fromEntries(Object.entries(C.message).filter(([A])=>!A.startsWith("lc_")))),w.push(C)}return{generations:w,llmOutput:{tokenUsage:{promptTokens:i.input_tokens,completionTokens:i.output_tokens,totalTokens:i.total_tokens}}}}}async getEstimatedTokenCountFromPrompt(e,t,r){let i=(await this.getNumTokensFromMessages(e)).totalCount;if(t&&r!=="auto"){const a=Are(t);i+=await this.getNumTokens(a),i+=9}return t&&e.find(a=>a._getType()==="system")&&(i-=4),r==="none"?i+=1:typeof r=="object"&&(i+=await this.getNumTokens(r.name)+4),i}async getNumTokensFromGenerations(e){return(await Promise.all(e.map(async r=>{var i;return(i=r.message.additional_kwargs)!=null&&i.function_call?(await this.getNumTokensFromMessages([r.message])).countPerMessage[0]:await this.getNumTokens(r.message.content)}))).reduce((r,i)=>r+i,0)}async getNumTokensFromMessages(e){let t=0,r=0,i=0;this.model==="gpt-3.5-turbo-0301"?(r=4,i=-1):(r=3,i=1);const a=await Promise.all(e.map(async s=>{var m,y,b,w,S,T;const o=await this.getNumTokens(s.content),u=await this.getNumTokens(tP(s)),c=s.name!==void 0?i+await this.getNumTokens(s.name):0;let d=o+r+u+c;const p=s;if(p._getType()==="function"&&(d-=2),(m=p.additional_kwargs)!=null&&m.function_call&&(d+=3),(y=p==null?void 0:p.additional_kwargs.function_call)!=null&&y.name&&(d+=await this.getNumTokens((b=p.additional_kwargs.function_call)==null?void 0:b.name)),(w=p.additional_kwargs.function_call)!=null&&w.arguments)try{d+=await this.getNumTokens(JSON.stringify(JSON.parse((S=p.additional_kwargs.function_call)==null?void 0:S.arguments)))}catch(C){console.error("Error parsing function arguments",C,JSON.stringify(p.additional_kwargs.function_call)),d+=await this.getNumTokens((T=p.additional_kwargs.function_call)==null?void 0:T.arguments)}return t+=d,d}));return t+=3,{totalCount:t,countPerMessage:a}}async completionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.create(e,r)}catch(i){throw GA(i)}})}async responseApiWithRetry(e,t){return this.caller.call(async()=>{var i,a;const r=this._getClientOptions(t);try{return((a=(i=e.text)==null?void 0:i.format)==null?void 0:a.type)==="json_schema"&&!e.stream?await this.client.responses.parse(e,r):await this.client.responses.create(e,r)}catch(s){throw GA(s)}})}async betaParsedCompletionWithRetry(e,t){const r=this._getClientOptions(t);return this.caller.call(async()=>{try{return await this.client.chat.completions.parse(e,r)}catch(i){throw GA(i)}})}_getClientOptions(e){if(!this.client){const r={baseURL:this.clientConfig.baseURL},i=Ere(r),a={...this.clientConfig,baseURL:i,timeout:this.timeout,maxRetries:0};a.baseURL||delete a.baseURL,this.client=new Wt(a)}return{...this.clientConfig,...e}}_llmType(){return"openai"}_combineLLMOutput(...e){return e.reduce((t,r)=>(r&&r.tokenUsage&&(t.tokenUsage.completionTokens+=r.tokenUsage.completionTokens??0,t.tokenUsage.promptTokens+=r.tokenUsage.promptTokens??0,t.tokenUsage.totalTokens+=r.tokenUsage.totalTokens??0),t),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(e,t){let r,i,a,s;kre(e)?(r=e.schema,i=e.name,a=e.method,s=e.includeRaw):(r=e,i=t==null?void 0:t.name,a=t==null?void 0:t.method,s=t==null?void 0:t.includeRaw);let o,u;if((t==null?void 0:t.strict)!==void 0&&a==="jsonMode")throw new Error("Argument `strict` is only supported for `method` = 'function_calling'");if(!this.model.startsWith("gpt-3")&&!this.model.startsWith("gpt-4-")&&this.model!=="gpt-4"?a===void 0&&(a="jsonSchema"):a==="jsonSchema"&&console.warn(`[WARNING]: JSON Schema is not supported for model "${this.model}". Falling back to tool calling.`),a==="jsonMode"){let m;Pi(r)?(u=r_.fromZodSchema(r),m=yr(r)):u=new i_,o=this.withConfig({response_format:{type:"json_object"},ls_structured_output_format:{kwargs:{method:"jsonMode"},schema:m}})}else if(a==="jsonSchema")if(o=this.withConfig({response_format:{type:"json_schema",json_schema:{name:i??"extract",description:td(r),schema:r,strict:t==null?void 0:t.strict}},ls_structured_output_format:{kwargs:{method:"jsonSchema"},schema:yr(r)}}),Pi(r)){const m=r_.fromZodSchema(r);u=_r.from(y=>"parsed"in y.additional_kwargs?y.additional_kwargs.parsed:m)}else u=new i_;else{let m=i??"extract";if(Pi(r)){const y=yr(r);o=this.withConfig({tools:[{type:"function",function:{name:m,description:y.description,parameters:y}}],tool_choice:{type:"function",function:{name:m}},ls_structured_output_format:{kwargs:{method:"functionCalling"},schema:y},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),u=new e4({returnSingle:!0,keyName:m,zodSchema:r})}else{let y;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(y=r,m=r.name):(m=r.title??m,y={name:m,description:r.description??"",parameters:r}),o=this.withConfig({tools:[{type:"function",function:y}],tool_choice:{type:"function",function:{name:m}},ls_structured_output_format:{kwargs:{method:"functionCalling"},schema:yr(r)},...(t==null?void 0:t.strict)!==void 0?{strict:t.strict}:{}}),u=new e4({returnSingle:!0,keyName:m})}}if(!s)return o.pipe(u);const c=ms.assign({parsed:(m,y)=>u.invoke(m.raw,y)}),d=ms.assign({parsed:()=>null}),p=c.withFallbacks({fallbacks:[d]});return vr.from([{raw:o},p])}}function kre(n){return n!==void 0&&typeof n.schema=="object"}function Mre(n,e){const t={...n};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function Dre(n,e,t){if(sr(n))return bre(n,e,t);if(ar(n))return Mre({type:"json_schema",json_schema:{...t,name:e,strict:!0,schema:u1(n,{cycles:"ref",reused:"ref",override(r){r.jsonSchema.title=e}})}},r=>cm(n,JSON.parse(r)));throw new Error("Unsupported schema response format")}class Au extends uI{constructor({concurrency:e,...t}){super(e?{maxConcurrency:e,...t}:t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","llms",this._llmType()]})}async invoke(e,t){const r=Au._convertInputToPromptValue(e);return(await this.generatePrompt([r],t,t==null?void 0:t.callbacks)).generations[0][0].text}async*_streamResponseChunks(e,t,r){throw new Error("Not implemented.")}_separateRunnableConfigFromCallOptionsCompat(e){const[t,r]=super._separateRunnableConfigFromCallOptions(e);return r.signal=t.signal,[t,r]}async*_streamIterator(e,t){if(this._streamResponseChunks===Au.prototype._streamResponseChunks)yield this.invoke(e,t);else{const r=Au._convertInputToPromptValue(e),[i,a]=this._separateRunnableConfigFromCallOptionsCompat(t),s=await Jn.configure(i.callbacks,this.callbacks,i.tags,this.tags,i.metadata,this.metadata,{verbose:this.verbose}),o={options:a,invocation_params:this==null?void 0:this.invocationParams(a),batch_size:1},u=await(s==null?void 0:s.handleLLMStart(this.toJSON(),[r.toString()],i.runId,void 0,o,void 0,void 0,i.runName));let c=new Ll({text:""});try{for await(const d of this._streamResponseChunks(r.toString(),a,u==null?void 0:u[0]))c?c=c.concat(d):c=d,typeof d.text=="string"&&(yield d.text)}catch(d){throw await Promise.all((u??[]).map(p=>p==null?void 0:p.handleLLMError(d))),d}await Promise.all((u??[]).map(d=>d==null?void 0:d.handleLLMEnd({generations:[[c]]})))}}async generatePrompt(e,t,r){const i=e.map(a=>a.toString());return this.generate(i,t,r)}invocationParams(e){return{}}_flattenLLMResult(e){const t=[];for(let r=0;r<e.generations.length;r+=1){const i=e.generations[r];if(r===0)t.push({generations:[i],llmOutput:e.llmOutput});else{const a=e.llmOutput?{...e.llmOutput,tokenUsage:{}}:void 0;t.push({generations:[i],llmOutput:a})}}return t}async _generateUncached(e,t,r,i){let a;if(i!==void 0&&i.length===e.length)a=i;else{const c=await Jn.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),d={options:t,invocation_params:this==null?void 0:this.invocationParams(t),batch_size:e.length};a=await(c==null?void 0:c.handleLLMStart(this.toJSON(),e,r.runId,void 0,d,void 0,void 0,r==null?void 0:r.runName))}const s=!!(a!=null&&a[0].handlers.find(KR));let o;if(s&&e.length===1&&this._streamResponseChunks!==Au.prototype._streamResponseChunks)try{const c=await this._streamResponseChunks(e[0],t,a==null?void 0:a[0]);let d;for await(const p of c)d===void 0?d=p:d=fi(d,p);if(d===void 0)throw new Error("Received empty response from chat model call.");o={generations:[[d]],llmOutput:{}},await(a==null?void 0:a[0].handleLLMEnd(o))}catch(c){throw await(a==null?void 0:a[0].handleLLMError(c)),c}else{try{o=await this._generate(e,t,a==null?void 0:a[0])}catch(d){throw await Promise.all((a??[]).map(p=>p==null?void 0:p.handleLLMError(d))),d}const c=this._flattenLLMResult(o);await Promise.all((a??[]).map((d,p)=>d==null?void 0:d.handleLLMEnd(c[p])))}const u=(a==null?void 0:a.map(c=>c.runId))||void 0;return Object.defineProperty(o,Dp,{value:u?{runIds:u}:void 0,configurable:!0}),o}async _generateCached({prompts:e,cache:t,llmStringKey:r,parsedOptions:i,handledOptions:a,runId:s}){const o=await Jn.configure(a.callbacks,this.callbacks,a.tags,this.tags,a.metadata,this.metadata,{verbose:this.verbose}),u={options:i,invocation_params:this==null?void 0:this.invocationParams(i),batch_size:e.length},c=await(o==null?void 0:o.handleLLMStart(this.toJSON(),e,s,void 0,u,void 0,void 0,a==null?void 0:a.runName)),d=[],m=(await Promise.allSettled(e.map(async(w,S)=>{const T=await t.lookup(w,r);return T==null&&d.push(S),T}))).map((w,S)=>({result:w,runManager:c==null?void 0:c[S]})).filter(({result:w})=>w.status==="fulfilled"&&w.value!=null||w.status==="rejected"),y=[];await Promise.all(m.map(async({result:w,runManager:S},T)=>{if(w.status==="fulfilled"){const C=w.value;return y[T]=C.map(A=>(A.generationInfo={...A.generationInfo,tokenUsage:{}},A)),C.length&&await(S==null?void 0:S.handleLLMNewToken(C[0].text)),S==null?void 0:S.handleLLMEnd({generations:[C]},void 0,void 0,void 0,{cached:!0})}else return await(S==null?void 0:S.handleLLMError(w.reason,void 0,void 0,void 0,{cached:!0})),Promise.reject(w.reason)}));const b={generations:y,missingPromptIndices:d,startedRunManagers:c};return Object.defineProperty(b,Dp,{value:c?{runIds:c==null?void 0:c.map(w=>w.runId)}:void 0,configurable:!0}),b}async generate(e,t,r){if(!Array.isArray(e))throw new Error("Argument 'prompts' is expected to be a string[]");let i;Array.isArray(t)?i={stop:t}:i=t;const[a,s]=this._separateRunnableConfigFromCallOptionsCompat(i);if(a.callbacks=a.callbacks??r,!this.cache)return this._generateUncached(e,s,a);const{cache:o}=this,u=this._getSerializedCacheKeyParametersForCall(s),{generations:c,missingPromptIndices:d,startedRunManagers:p}=await this._generateCached({prompts:e,cache:o,llmStringKey:u,parsedOptions:s,handledOptions:a,runId:a.runId});let m={};if(d.length>0){const y=await this._generateUncached(d.map(b=>e[b]),s,a,p!==void 0?d.map(b=>p==null?void 0:p[b]):void 0);await Promise.all(y.generations.map(async(b,w)=>{const S=d[w];return c[S]=b,o.update(e[S],u,b)})),m=y.llmOutput??{}}return{generations:c,llmOutput:m}}async call(e,t,r){const{generations:i}=await this.generate([e],t,r);return i[0][0].text}async predict(e,t,r){return this.call(e,t,r)}async predictMessages(e,t,r){const i=am(e),a=await this.call(i,t,r);return new bn(a)}_identifyingParams(){return{}}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}_modelType(){return"base_llm"}}class nP extends Au{async _generate(e,t,r){return{generations:await Promise.all(e.map((a,s)=>this._call(a,{...t,promptIndex:s},r).then(o=>[{text:o}])))}}}const $re=Object.freeze(Object.defineProperty({__proto__:null,BaseLLM:Au,LLM:nP},Symbol.toStringTag,{value:"Module"})),Lre=(n,e)=>n.reduce((t,r,i)=>{const a=Math.floor(i/e),s=t[a]||[];return t[a]=s.concat([r]),t},[]),Ure=Object.freeze(Object.defineProperty({__proto__:null,chunkArray:Lre},Symbol.toStringTag,{value:"Module"}));class rP{constructor(e){Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.caller=new um(e??{})}}const jre=Object.freeze(Object.defineProperty({__proto__:null,Embeddings:rP},Symbol.toStringTag,{value:"Module"}));function Ot(n,e,t,r,i){if(typeof e=="function"?n!==e||!0:!e.has(n))throw new TypeError("Cannot write private member to an object whose class did not declare it");return e.set(n,t),t}function Ke(n,e,t,r){if(t==="a"&&!r)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?n!==e||!r:!e.has(n))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?r:t==="a"?r.call(n):r?r.value:e.get(n)}let k5=function(){const{crypto:n}=globalThis;if(n!=null&&n.randomUUID)return k5=n.randomUUID.bind(n),n.randomUUID();const e=new Uint8Array(1),t=n?()=>n.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,r=>(+r^t()&15>>+r/4).toString(16))};function jp(n){return typeof n=="object"&&n!==null&&("name"in n&&n.name==="AbortError"||"message"in n&&String(n.message).includes("FetchRequestCanceledException"))}const W1=n=>{if(n instanceof Error)return n;if(typeof n=="object"&&n!==null){try{if(Object.prototype.toString.call(n)==="[object Error]"){const e=new Error(n.message,n.cause?{cause:n.cause}:{});return n.stack&&(e.stack=n.stack),n.cause&&!e.cause&&(e.cause=n.cause),n.name&&(e.name=n.name),e}}catch{}try{return new Error(JSON.stringify(n))}catch{}}return new Error(n)};class Bt extends Error{}class ni extends Bt{constructor(e,t,r,i){super(`${ni.makeMessage(e,t,r)}`),this.status=e,this.headers=i,this.requestID=i==null?void 0:i.get("request-id"),this.error=t}static makeMessage(e,t,r){const i=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&i?`${e} ${i}`:e?`${e} status code (no body)`:i||"(no status code or body)"}static generate(e,t,r,i){if(!e||!i)return new vb({message:r,cause:W1(t)});const a=t;return e===400?new D5(e,a,r,i):e===401?new $5(e,a,r,i):e===403?new L5(e,a,r,i):e===404?new U5(e,a,r,i):e===409?new j5(e,a,r,i):e===422?new F5(e,a,r,i):e===429?new B5(e,a,r,i):e>=500?new q5(e,a,r,i):new ni(e,a,r,i)}}class ss extends ni{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class vb extends ni{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class M5 extends vb{constructor({message:e}={}){super({message:e??"Request timed out."})}}class D5 extends ni{}class $5 extends ni{}class L5 extends ni{}class U5 extends ni{}class j5 extends ni{}class F5 extends ni{}class B5 extends ni{}class q5 extends ni{}const Fre=/^[a-z][a-z0-9+.-]*:/i,Bre=n=>Fre.test(n);function l4(n){return typeof n!="object"?{}:n??{}}function qre(n){if(!n)return!0;for(const e in n)return!1;return!0}function Vre(n,e){return Object.prototype.hasOwnProperty.call(n,e)}const zre=(n,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new Bt(`${n} must be an integer`);if(e<0)throw new Bt(`${n} must be a positive integer`);return e},V5=n=>{try{return JSON.parse(n)}catch{return}},Hre=n=>new Promise(e=>setTimeout(e,n)),l_={off:0,error:200,warn:300,info:400,debug:500},u4=(n,e,t)=>{if(n){if(Vre(l_,n))return n;Ti(t).warn(`${e} was set to ${JSON.stringify(n)}, expected one of ${JSON.stringify(Object.keys(l_))}`)}};function rp(){}function vy(n,e,t){return!e||l_[n]>l_[t]?rp:e[n].bind(e)}const Gre={error:rp,warn:rp,info:rp,debug:rp};let c4=new WeakMap;function Ti(n){const e=n.logger,t=n.logLevel??"off";if(!e)return Gre;const r=c4.get(e);if(r&&r[0]===t)return r[1];const i={error:vy("error",e,t),warn:vy("warn",e,t),info:vy("info",e,t),debug:vy("debug",e,t)};return c4.set(e,[t,i]),i}const yu=n=>(n.options&&(n.options={...n.options},delete n.options.headers),n.headers&&(n.headers=Object.fromEntries((n.headers instanceof Headers?[...n.headers]:Object.entries(n.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in n&&(n.retryOfRequestLogID&&(n.retryOf=n.retryOfRequestLogID),delete n.retryOfRequestLogID),n),wf="0.52.0",Wre=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";function Kre(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const Jre=()=>{var t;const n=Kre();if(n==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":wf,"X-Stainless-OS":d4(Deno.build.os),"X-Stainless-Arch":f4(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:((t=Deno.version)==null?void 0:t.deno)??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":wf,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(n==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":wf,"X-Stainless-OS":d4(globalThis.process.platform),"X-Stainless-Arch":f4(globalThis.process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version};const e=Yre();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":wf,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":wf,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Yre(){if(typeof navigator>"u"||!navigator)return null;const n=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of n){const r=t.exec(navigator.userAgent);if(r){const i=r[1]||0,a=r[2]||0,s=r[3]||0;return{browser:e,version:`${i}.${a}.${s}`}}}return null}const f4=n=>n==="x32"?"x32":n==="x86_64"||n==="x64"?"x64":n==="arm"?"arm":n==="aarch64"||n==="arm64"?"arm64":n?`other:${n}`:"unknown",d4=n=>(n=n.toLowerCase(),n.includes("ios")?"iOS":n==="android"?"Android":n==="darwin"?"MacOS":n==="win32"?"Windows":n==="freebsd"?"FreeBSD":n==="openbsd"?"OpenBSD":n==="linux"?"Linux":n?`Other:${n}`:"Unknown");let h4;const Zre=()=>h4??(h4=Jre());function Xre(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new Anthropic({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function z5(...n){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...n)}function H5(n){let e=Symbol.asyncIterator in n?n[Symbol.asyncIterator]():n[Symbol.iterator]();return z5({start(){},async pull(t){const{done:r,value:i}=await e.next();r?t.close():t.enqueue(i)},async cancel(){var t;await((t=e.return)==null?void 0:t.call(e))}})}function iP(n){if(n[Symbol.asyncIterator])return n;const e=n.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Qre(n){var r,i;if(n===null||typeof n!="object")return;if(n[Symbol.asyncIterator]){await((i=(r=n[Symbol.asyncIterator]()).return)==null?void 0:i.call(r));return}const e=n.getReader(),t=e.cancel();e.releaseLock(),await t}const eie=({headers:n,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});function tie(n){let e=0;for(const i of n)e+=i.length;const t=new Uint8Array(e);let r=0;for(const i of n)t.set(i,r),r+=i.length;return t}let p4;function aP(n){let e;return(p4??(e=new globalThis.TextEncoder,p4=e.encode.bind(e)))(n)}let m4;function g4(n){let e;return(m4??(e=new globalThis.TextDecoder,m4=e.decode.bind(e)))(n)}var ta,na;class Sm{constructor(){ta.set(this,void 0),na.set(this,void 0),Ot(this,ta,new Uint8Array),Ot(this,na,null)}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?aP(e):e;Ot(this,ta,tie([Ke(this,ta,"f"),t]));const r=[];let i;for(;(i=nie(Ke(this,ta,"f"),Ke(this,na,"f")))!=null;){if(i.carriage&&Ke(this,na,"f")==null){Ot(this,na,i.index);continue}if(Ke(this,na,"f")!=null&&(i.index!==Ke(this,na,"f")+1||i.carriage)){r.push(g4(Ke(this,ta,"f").subarray(0,Ke(this,na,"f")-1))),Ot(this,ta,Ke(this,ta,"f").subarray(Ke(this,na,"f"))),Ot(this,na,null);continue}const a=Ke(this,na,"f")!==null?i.preceding-1:i.preceding,s=g4(Ke(this,ta,"f").subarray(0,a));r.push(s),Ot(this,ta,Ke(this,ta,"f").subarray(i.index)),Ot(this,na,null)}return r}flush(){return Ke(this,ta,"f").length?this.decode(`
`):[]}}ta=new WeakMap,na=new WeakMap;Sm.NEWLINE_CHARS=new Set([`
`,"\r"]);Sm.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function nie(n,e){for(let i=e??0;i<n.length;i++){if(n[i]===10)return{preceding:i,index:i+1,carriage:!1};if(n[i]===13)return{preceding:i,index:i+1,carriage:!0}}return null}function rie(n){for(let r=0;r<n.length-1;r++){if(n[r]===10&&n[r+1]===10||n[r]===13&&n[r+1]===13)return r+2;if(n[r]===13&&n[r+1]===10&&r+3<n.length&&n[r+2]===13&&n[r+3]===10)return r+4}return-1}class js{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;async function*i(){if(r)throw new Bt("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let a=!1;try{for await(const s of iie(e,t)){if(s.event==="completion")try{yield JSON.parse(s.data)}catch(o){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),o}if(s.event==="message_start"||s.event==="message_delta"||s.event==="message_stop"||s.event==="content_block_start"||s.event==="content_block_delta"||s.event==="content_block_stop")try{yield JSON.parse(s.data)}catch(o){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),o}if(s.event!=="ping"&&s.event==="error")throw new ni(void 0,V5(s.data)??s.data,void 0,e.headers)}a=!0}catch(s){if(jp(s))return;throw s}finally{a||t.abort()}}return new js(i,t)}static fromReadableStream(e,t){let r=!1;async function*i(){const s=new Sm,o=iP(e);for await(const u of o)for(const c of s.decode(u))yield c;for(const u of s.flush())yield u}async function*a(){if(r)throw new Bt("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let s=!1;try{for await(const o of i())s||o&&(yield JSON.parse(o));s=!0}catch(o){if(jp(o))return;throw o}finally{s||t.abort()}}return new js(a,t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],r=this.iterator(),i=a=>({next:()=>{if(a.length===0){const s=r.next();e.push(s),t.push(s)}return a.shift()}});return[new js(()=>i(e),this.controller),new js(()=>i(t),this.controller)]}toReadableStream(){const e=this;let t;return z5({async start(){t=e[Symbol.asyncIterator]()},async pull(r){try{const{value:i,done:a}=await t.next();if(a)return r.close();const s=aP(JSON.stringify(i)+`
`);r.enqueue(s)}catch(i){r.error(i)}},async cancel(){var r;await((r=t.return)==null?void 0:r.call(t))}})}}async function*iie(n,e){if(!n.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new Bt("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Bt("Attempted to iterate over a response with no body");const t=new sie,r=new Sm,i=iP(n.body);for await(const a of aie(i))for(const s of r.decode(a)){const o=t.decode(s);o&&(yield o)}for(const a of r.flush()){const s=t.decode(a);s&&(yield s)}}async function*aie(n){let e=new Uint8Array;for await(const t of n){if(t==null)continue;const r=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?aP(t):t;let i=new Uint8Array(e.length+r.length);i.set(e),i.set(r,e.length),e=i;let a;for(;(a=rie(e))!==-1;)yield e.slice(0,a),e=e.slice(a)}e.length>0&&(yield e)}class sie{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const a={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,i]=oie(e,":");return i.startsWith(" ")&&(i=i.substring(1)),t==="event"?this.event=i:t==="data"&&this.data.push(i),null}}function oie(n,e){const t=n.indexOf(e);return t!==-1?[n.substring(0,t),e,n.substring(t+e.length)]:[n,"",""]}async function G5(n,e){const{response:t,requestLogID:r,retryOfRequestLogID:i,startTime:a}=e,s=await(async()=>{var p;if(e.options.stream)return Ti(n).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):js.fromSSEResponse(t,e.controller);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const o=t.headers.get("content-type"),u=(p=o==null?void 0:o.split(";")[0])==null?void 0:p.trim();if((u==null?void 0:u.includes("application/json"))||(u==null?void 0:u.endsWith("+json"))){const m=await t.json();return W5(m,t)}return await t.text()})();return Ti(n).debug(`[${r}] response parsed`,yu({retryOfRequestLogID:i,url:t.url,status:t.status,body:s,durationMs:Date.now()-a})),s}function W5(n,e){return!n||typeof n!="object"||Array.isArray(n)?n:Object.defineProperty(n,"_request_id",{value:e.headers.get("request-id"),enumerable:!1})}var ip;class _b extends Promise{constructor(e,t,r=G5){super(i=>{i(null)}),this.responsePromise=t,this.parseResponse=r,ip.set(this,void 0),Ot(this,ip,e)}_thenUnwrap(e){return new _b(Ke(this,ip,"f"),this.responsePromise,async(t,r)=>W5(e(await this.parseResponse(t,r),r),r.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(Ke(this,ip,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}ip=new WeakMap;var _y;class lie{constructor(e,t,r,i){_y.set(this,void 0),Ot(this,_y,e),this.options=i,this.response=t,this.body=r}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){const e=this.nextPageRequestOptions();if(!e)throw new Bt("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await Ke(this,_y,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(_y=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class uie extends _b{constructor(e,t,r){super(e,t,async(i,a)=>new r(i,a.response,await G5(i,a),a.options))}async*[Symbol.asyncIterator](){const e=await this;for await(const t of e)yield t}}class Tm extends lie{constructor(e,t,r,i){super(e,t,r,i),this.data=r.data||[],this.has_more=r.has_more||!1,this.first_id=r.first_id||null,this.last_id=r.last_id||null}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){var t;if((t=this.options.query)!=null&&t.before_id){const r=this.first_id;return r?{...this.options,query:{...l4(this.options.query),before_id:r}}:null}const e=this.last_id;return e?{...this.options,query:{...l4(this.options.query),after_id:e}}:null}}const K5=()=>{var n;if(typeof File>"u"){const{process:e}=globalThis,t=typeof((n=e==null?void 0:e.versions)==null?void 0:n.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function qf(n,e,t){return K5(),new File(n,e??"unknown_file",t)}function ov(n){return(typeof n=="object"&&n!==null&&("name"in n&&n.name&&String(n.name)||"url"in n&&n.url&&String(n.url)||"filename"in n&&n.filename&&String(n.filename)||"path"in n&&n.path&&String(n.path))||"").split(/[\\/]/).pop()||void 0}const J5=n=>n!=null&&typeof n=="object"&&typeof n[Symbol.asyncIterator]=="function",cie=async(n,e)=>({...n,body:await die(n.body,e)}),y4=new WeakMap;function fie(n){const e=typeof n=="function"?n:n.fetch,t=y4.get(e);if(t)return t;const r=(async()=>{try{const i="Response"in e?e.Response:(await e("data:,")).constructor,a=new FormData;return a.toString()!==await new i(a).text()}catch{return!0}})();return y4.set(e,r),r}const die=async(n,e)=>{if(!await fie(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");const t=new FormData;return await Promise.all(Object.entries(n||{}).map(([r,i])=>K1(t,r,i))),t},hie=n=>n instanceof Blob&&"name"in n,K1=async(n,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")n.append(e,String(t));else if(t instanceof Response){let r={};const i=t.headers.get("Content-Type");i&&(r={type:i}),n.append(e,qf([await t.blob()],ov(t),r))}else if(J5(t))n.append(e,qf([await new Response(H5(t)).blob()],ov(t)));else if(hie(t))n.append(e,qf([t],ov(t),{type:t.type}));else if(Array.isArray(t))await Promise.all(t.map(r=>K1(n,e+"[]",r)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([r,i])=>K1(n,`${e}[${r}]`,i)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}},Y5=n=>n!=null&&typeof n=="object"&&typeof n.size=="number"&&typeof n.type=="string"&&typeof n.text=="function"&&typeof n.slice=="function"&&typeof n.arrayBuffer=="function",pie=n=>n!=null&&typeof n=="object"&&typeof n.name=="string"&&typeof n.lastModified=="number"&&Y5(n),mie=n=>n!=null&&typeof n=="object"&&typeof n.url=="string"&&typeof n.blob=="function";async function gie(n,e,t){if(K5(),n=await n,e||(e=ov(n)),pie(n))return n instanceof File&&e==null&&t==null?n:qf([await n.arrayBuffer()],e??n.name,{type:n.type,lastModified:n.lastModified,...t});if(mie(n)){const i=await n.blob();return e||(e=new URL(n.url).pathname.split(/[\\/]/).pop()),qf(await J1(i),e,t)}const r=await J1(n);if(!(t!=null&&t.type)){const i=r.find(a=>typeof a=="object"&&"type"in a&&a.type);typeof i=="string"&&(t={...t,type:i})}return qf(r,e,t)}async function J1(n){var t;let e=[];if(typeof n=="string"||ArrayBuffer.isView(n)||n instanceof ArrayBuffer)e.push(n);else if(Y5(n))e.push(n instanceof Blob?n:await n.arrayBuffer());else if(J5(n))for await(const r of n)e.push(...await J1(r));else{const r=(t=n==null?void 0:n.constructor)==null?void 0:t.name;throw new Error(`Unexpected data type: ${typeof n}${r?`; constructor: ${r}`:""}${yie(n)}`)}return e}function yie(n){return typeof n!="object"||n===null?"":`; props: [${Object.getOwnPropertyNames(n).map(t=>`"${t}"`).join(", ")}]`}class Bo{constructor(e){this._client=e}}const Z5=Symbol.for("brand.privateNullableHeaders"),v4=Array.isArray;function*vie(n){if(!n)return;if(Z5 in n){const{values:r,nulls:i}=n;yield*r.entries();for(const a of i)yield[a,null];return}let e=!1,t;n instanceof Headers?t=n.entries():v4(n)?t=n:(e=!0,t=Object.entries(n??{}));for(let r of t){const i=r[0];if(typeof i!="string")throw new TypeError("expected header name to be a string");const a=v4(r[1])?r[1]:[r[1]];let s=!1;for(const o of a)o!==void 0&&(e&&!s&&(s=!0,yield[i,null]),yield[i,o])}}const Mn=n=>{const e=new Headers,t=new Set;for(const r of n){const i=new Set;for(const[a,s]of vie(r)){const o=a.toLowerCase();i.has(o)||(e.delete(a),i.add(o)),s===null?(e.delete(a),t.add(o)):(e.append(a,s),t.delete(o))}}return{[Z5]:!0,values:e,nulls:t}};function X5(n){return n.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const _ie=(n=X5)=>function(t,...r){if(t.length===1)return t[0];let i=!1;const a=t.reduce((d,p,m)=>(/[?#]/.test(p)&&(i=!0),d+p+(m===r.length?"":(i?encodeURIComponent:n)(String(r[m])))),""),s=a.split(/[?#]/,1)[0],o=[],u=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let c;for(;(c=u.exec(s))!==null;)o.push({start:c.index,length:c[0].length});if(o.length>0){let d=0;const p=o.reduce((m,y)=>{const b=" ".repeat(y.start-d),w="^".repeat(y.length);return d=y.start+y.length,m+b+w},"");throw new Bt(`Path parameters result in path with invalid segments:
${a}
${p}`)}return a},us=_ie(X5);let Q5=class extends Bo{list(e={},t){const{betas:r,...i}=e??{};return this._client.getAPIList("/v1/files",Tm,{query:i,...t,headers:Mn([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},t==null?void 0:t.headers])})}delete(e,t={},r){const{betas:i}=t??{};return this._client.delete(us`/v1/files/${e}`,{...r,headers:Mn([{"anthropic-beta":[...i??[],"files-api-2025-04-14"].toString()},r==null?void 0:r.headers])})}download(e,t={},r){const{betas:i}=t??{};return this._client.get(us`/v1/files/${e}/content`,{...r,headers:Mn([{"anthropic-beta":[...i??[],"files-api-2025-04-14"].toString(),Accept:"application/binary"},r==null?void 0:r.headers]),__binaryResponse:!0})}retrieveMetadata(e,t={},r){const{betas:i}=t??{};return this._client.get(us`/v1/files/${e}`,{...r,headers:Mn([{"anthropic-beta":[...i??[],"files-api-2025-04-14"].toString()},r==null?void 0:r.headers])})}upload(e,t){const{betas:r,...i}=e;return this._client.post("/v1/files",cie({body:i,...t,headers:Mn([{"anthropic-beta":[...r??[],"files-api-2025-04-14"].toString()},t==null?void 0:t.headers])},this._client))}},eq=class extends Bo{retrieve(e,t={},r){const{betas:i}=t??{};return this._client.get(us`/v1/models/${e}?beta=true`,{...r,headers:Mn([{...(i==null?void 0:i.toString())!=null?{"anthropic-beta":i==null?void 0:i.toString()}:void 0},r==null?void 0:r.headers])})}list(e={},t){const{betas:r,...i}=e??{};return this._client.getAPIList("/v1/models?beta=true",Tm,{query:i,...t,headers:Mn([{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0},t==null?void 0:t.headers])})}};class bb{constructor(e,t){this.iterator=e,this.controller=t}async*decoder(){const e=new Sm;for await(const t of this.iterator)for(const r of e.decode(t))yield JSON.parse(r);for(const t of e.flush())yield JSON.parse(t)}[Symbol.asyncIterator](){return this.decoder()}static fromResponse(e,t){if(!e.body)throw t.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new Bt("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new Bt("Attempted to iterate over a response with no body");return new bb(iP(e.body),t)}}let tq=class extends Bo{create(e,t){const{betas:r,...i}=e;return this._client.post("/v1/messages/batches?beta=true",{body:i,...t,headers:Mn([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},t==null?void 0:t.headers])})}retrieve(e,t={},r){const{betas:i}=t??{};return this._client.get(us`/v1/messages/batches/${e}?beta=true`,{...r,headers:Mn([{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString()},r==null?void 0:r.headers])})}list(e={},t){const{betas:r,...i}=e??{};return this._client.getAPIList("/v1/messages/batches?beta=true",Tm,{query:i,...t,headers:Mn([{"anthropic-beta":[...r??[],"message-batches-2024-09-24"].toString()},t==null?void 0:t.headers])})}delete(e,t={},r){const{betas:i}=t??{};return this._client.delete(us`/v1/messages/batches/${e}?beta=true`,{...r,headers:Mn([{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString()},r==null?void 0:r.headers])})}cancel(e,t={},r){const{betas:i}=t??{};return this._client.post(us`/v1/messages/batches/${e}/cancel?beta=true`,{...r,headers:Mn([{"anthropic-beta":[...i??[],"message-batches-2024-09-24"].toString()},r==null?void 0:r.headers])})}async results(e,t={},r){const i=await this.retrieve(e);if(!i.results_url)throw new Bt(`No batch \`results_url\`; Has it finished processing? ${i.processing_status} - ${i.id}`);const{betas:a}=t??{};return this._client.get(i.results_url,{...r,headers:Mn([{"anthropic-beta":[...a??[],"message-batches-2024-09-24"].toString(),Accept:"application/binary"},r==null?void 0:r.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((s,o)=>bb.fromResponse(o.response,o.controller))}};const bie=n=>{let e=0,t=[];for(;e<n.length;){let r=n[e];if(r==="\\"){e++;continue}if(r==="{"){t.push({type:"brace",value:"{"}),e++;continue}if(r==="}"){t.push({type:"brace",value:"}"}),e++;continue}if(r==="["){t.push({type:"paren",value:"["}),e++;continue}if(r==="]"){t.push({type:"paren",value:"]"}),e++;continue}if(r===":"){t.push({type:"separator",value:":"}),e++;continue}if(r===","){t.push({type:"delimiter",value:","}),e++;continue}if(r==='"'){let o="",u=!1;for(r=n[++e];r!=='"';){if(e===n.length){u=!0;break}if(r==="\\"){if(e++,e===n.length){u=!0;break}o+=r+n[e],r=n[++e]}else o+=r,r=n[++e]}r=n[++e],u||t.push({type:"string",value:o});continue}if(r&&/\s/.test(r)){e++;continue}let a=/[0-9]/;if(r&&a.test(r)||r==="-"||r==="."){let o="";for(r==="-"&&(o+=r,r=n[++e]);r&&a.test(r)||r===".";)o+=r,r=n[++e];t.push({type:"number",value:o});continue}let s=/[a-z]/i;if(r&&s.test(r)){let o="";for(;r&&s.test(r)&&e!==n.length;)o+=r,r=n[++e];if(o=="true"||o=="false"||o==="null")t.push({type:"name",value:o});else{e++;continue}continue}e++}return t},Ef=n=>{if(n.length===0)return n;let e=n[n.length-1];switch(e.type){case"separator":return n=n.slice(0,n.length-1),Ef(n);case"number":let t=e.value[e.value.length-1];if(t==="."||t==="-")return n=n.slice(0,n.length-1),Ef(n);case"string":let r=n[n.length-2];if((r==null?void 0:r.type)==="delimiter")return n=n.slice(0,n.length-1),Ef(n);if((r==null?void 0:r.type)==="brace"&&r.value==="{")return n=n.slice(0,n.length-1),Ef(n);break;case"delimiter":return n=n.slice(0,n.length-1),Ef(n)}return n},wie=n=>{let e=[];return n.map(t=>{t.type==="brace"&&(t.value==="{"?e.push("}"):e.splice(e.lastIndexOf("}"),1)),t.type==="paren"&&(t.value==="["?e.push("]"):e.splice(e.lastIndexOf("]"),1))}),e.length>0&&e.reverse().map(t=>{t==="}"?n.push({type:"brace",value:"}"}):t==="]"&&n.push({type:"paren",value:"]"})}),n},Eie=n=>{let e="";return n.map(t=>{switch(t.type){case"string":e+='"'+t.value+'"';break;default:e+=t.value;break}}),e},nq=n=>JSON.parse(Eie(wie(Ef(bie(n)))));var Ea,yl,Ch,by,Rh,Ih,wy,Ph,go,xh,Ey,Sy,af,Ty,Ay,WA,_4,KA,JA,YA,ZA,b4;const w4="__json_buf";class u_{constructor(){Ea.add(this),this.messages=[],this.receivedMessages=[],yl.set(this,void 0),this.controller=new AbortController,Ch.set(this,void 0),by.set(this,()=>{}),Rh.set(this,()=>{}),Ih.set(this,void 0),wy.set(this,()=>{}),Ph.set(this,()=>{}),go.set(this,{}),xh.set(this,!1),Ey.set(this,!1),Sy.set(this,!1),af.set(this,!1),Ty.set(this,void 0),Ay.set(this,void 0),KA.set(this,e=>{if(Ot(this,Ey,!0),jp(e)&&(e=new ss),e instanceof ss)return Ot(this,Sy,!0),this._emit("abort",e);if(e instanceof Bt)return this._emit("error",e);if(e instanceof Error){const t=new Bt(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new Bt(String(e)))}),Ot(this,Ch,new Promise((e,t)=>{Ot(this,by,e,"f"),Ot(this,Rh,t,"f")})),Ot(this,Ih,new Promise((e,t)=>{Ot(this,wy,e,"f"),Ot(this,Ph,t,"f")})),Ke(this,Ch,"f").catch(()=>{}),Ke(this,Ih,"f").catch(()=>{})}get response(){return Ke(this,Ty,"f")}get request_id(){return Ke(this,Ay,"f")}async withResponse(){const e=await Ke(this,Ch,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new u_;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,r){const i=new u_;for(const a of t.messages)i._addMessageParam(a);return i._run(()=>i._createMessage(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},Ke(this,KA,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,r){var o;const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),Ke(this,Ea,"m",JA).call(this);const{response:a,data:s}=await e.create({...t,stream:!0},{...r,signal:this.controller.signal}).withResponse();this._connected(a);for await(const u of s)Ke(this,Ea,"m",YA).call(this,u);if((o=s.controller.signal)!=null&&o.aborted)throw new ss;Ke(this,Ea,"m",ZA).call(this)}_connected(e){this.ended||(Ot(this,Ty,e),Ot(this,Ay,e==null?void 0:e.headers.get("request-id")),Ke(this,by,"f").call(this,e),this._emit("connect"))}get ended(){return Ke(this,xh,"f")}get errored(){return Ke(this,Ey,"f")}get aborted(){return Ke(this,Sy,"f")}abort(){this.controller.abort()}on(e,t){return(Ke(this,go,"f")[e]||(Ke(this,go,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=Ke(this,go,"f")[e];if(!r)return this;const i=r.findIndex(a=>a.listener===t);return i>=0&&r.splice(i,1),this}once(e,t){return(Ke(this,go,"f")[e]||(Ke(this,go,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{Ot(this,af,!0),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){Ot(this,af,!0),await Ke(this,Ih,"f")}get currentMessage(){return Ke(this,yl,"f")}async finalMessage(){return await this.done(),Ke(this,Ea,"m",WA).call(this)}async finalText(){return await this.done(),Ke(this,Ea,"m",_4).call(this)}_emit(e,...t){if(Ke(this,xh,"f"))return;e==="end"&&(Ot(this,xh,!0),Ke(this,wy,"f").call(this));const r=Ke(this,go,"f")[e];if(r&&(Ke(this,go,"f")[e]=r.filter(i=>!i.once),r.forEach(({listener:i})=>i(...t))),e==="abort"){const i=t[0];!Ke(this,af,"f")&&!(r!=null&&r.length)&&Promise.reject(i),Ke(this,Rh,"f").call(this,i),Ke(this,Ph,"f").call(this,i),this._emit("end");return}if(e==="error"){const i=t[0];!Ke(this,af,"f")&&!(r!=null&&r.length)&&Promise.reject(i),Ke(this,Rh,"f").call(this,i),Ke(this,Ph,"f").call(this,i),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",Ke(this,Ea,"m",WA).call(this))}async _fromReadableStream(e,t){var a;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Ke(this,Ea,"m",JA).call(this),this._connected(null);const i=js.fromReadableStream(e,this.controller);for await(const s of i)Ke(this,Ea,"m",YA).call(this,s);if((a=i.controller.signal)!=null&&a.aborted)throw new ss;Ke(this,Ea,"m",ZA).call(this)}[(yl=new WeakMap,Ch=new WeakMap,by=new WeakMap,Rh=new WeakMap,Ih=new WeakMap,wy=new WeakMap,Ph=new WeakMap,go=new WeakMap,xh=new WeakMap,Ey=new WeakMap,Sy=new WeakMap,af=new WeakMap,Ty=new WeakMap,Ay=new WeakMap,KA=new WeakMap,Ea=new WeakSet,WA=function(){if(this.receivedMessages.length===0)throw new Bt("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},_4=function(){if(this.receivedMessages.length===0)throw new Bt("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(t.length===0)throw new Bt("stream ended without producing a content block with type=text");return t.join(" ")},JA=function(){this.ended||Ot(this,yl,void 0)},YA=function(t){if(this.ended)return;const r=Ke(this,Ea,"m",b4).call(this,t);switch(this._emit("streamEvent",t,r),t.type){case"content_block_delta":{const i=r.content.at(-1);switch(t.delta.type){case"text_delta":{i.type==="text"&&this._emit("text",t.delta.text,i.text||"");break}case"citations_delta":{i.type==="text"&&this._emit("citation",t.delta.citation,i.citations??[]);break}case"input_json_delta":{(i.type==="tool_use"||i.type==="mcp_tool_use")&&i.input&&this._emit("inputJson",t.delta.partial_json,i.input);break}case"thinking_delta":{i.type==="thinking"&&this._emit("thinking",t.delta.thinking,i.thinking);break}case"signature_delta":{i.type==="thinking"&&this._emit("signature",i.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(r),this._addMessage(r,!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{Ot(this,yl,r);break}}},ZA=function(){if(this.ended)throw new Bt("stream has ended, this shouldn't happen");const t=Ke(this,yl,"f");if(!t)throw new Bt("request ended without sending any chunks");return Ot(this,yl,void 0),t},b4=function(t){let r=Ke(this,yl,"f");if(t.type==="message_start"){if(r)throw new Bt(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!r)throw new Bt(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return r;case"message_delta":return r.container=t.delta.container,r.stop_reason=t.delta.stop_reason,r.stop_sequence=t.delta.stop_sequence,r.usage.output_tokens=t.usage.output_tokens,t.usage.input_tokens!=null&&(r.usage.input_tokens=t.usage.input_tokens),t.usage.cache_creation_input_tokens!=null&&(r.usage.cache_creation_input_tokens=t.usage.cache_creation_input_tokens),t.usage.cache_read_input_tokens!=null&&(r.usage.cache_read_input_tokens=t.usage.cache_read_input_tokens),t.usage.server_tool_use!=null&&(r.usage.server_tool_use=t.usage.server_tool_use),r;case"content_block_start":return r.content.push(t.content_block),r;case"content_block_delta":{const i=r.content.at(t.index);switch(t.delta.type){case"text_delta":{(i==null?void 0:i.type)==="text"&&(i.text+=t.delta.text);break}case"citations_delta":{(i==null?void 0:i.type)==="text"&&(i.citations??(i.citations=[]),i.citations.push(t.delta.citation));break}case"input_json_delta":{if((i==null?void 0:i.type)==="tool_use"||(i==null?void 0:i.type)==="mcp_tool_use"){let a=i[w4]||"";a+=t.delta.partial_json,Object.defineProperty(i,w4,{value:a,enumerable:!1,writable:!0}),a&&(i.input=nq(a))}break}case"thinking_delta":{(i==null?void 0:i.type)==="thinking"&&(i.thinking+=t.delta.thinking);break}case"signature_delta":{(i==null?void 0:i.type)==="thinking"&&(i.signature=t.delta.signature);break}default:t.delta}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("streamEvent",i=>{const a=t.shift();a?a.resolve(i):e.push(i)}),this.on("end",()=>{r=!0;for(const i of t)i.resolve(void 0);t.length=0}),this.on("abort",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),this.on("error",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,s)=>t.push({resolve:a,reject:s})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new js(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}const rq={"claude-opus-4-20250514":8192,"claude-opus-4-0":8192,"claude-4-opus-20250514":8192,"anthropic.claude-opus-4-20250514-v1:0":8192,"claude-opus-4@20250514":8192},E4={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};let sP=class extends Bo{constructor(){super(...arguments),this.batches=new tq(this._client)}create(e,t){const{betas:r,...i}=e;i.model in E4&&console.warn(`The model '${i.model}' is deprecated and will reach end-of-life on ${E4[i.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let a=this._client._options.timeout;if(!i.stream&&a==null){const s=rq[i.model]??void 0;a=this._client.calculateNonstreamingTimeout(i.max_tokens,s)}return this._client.post("/v1/messages?beta=true",{body:i,timeout:a??6e5,...t,headers:Mn([{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0},t==null?void 0:t.headers]),stream:e.stream??!1})}stream(e,t){return u_.createMessage(this,e,t)}countTokens(e,t){const{betas:r,...i}=e;return this._client.post("/v1/messages/count_tokens?beta=true",{body:i,...t,headers:Mn([{"anthropic-beta":[...r??[],"token-counting-2024-11-01"].toString()},t==null?void 0:t.headers])})}};sP.Batches=tq;class Am extends Bo{constructor(){super(...arguments),this.models=new eq(this._client),this.messages=new sP(this._client),this.files=new Q5(this._client)}}Am.Models=eq;Am.Messages=sP;Am.Files=Q5;class iq extends Bo{create(e,t){const{betas:r,...i}=e;return this._client.post("/v1/complete",{body:i,timeout:this._client._options.timeout??6e5,...t,headers:Mn([{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0},t==null?void 0:t.headers]),stream:e.stream??!1})}}var Sa,vl,Oh,Cy,Nh,kh,Ry,Mh,yo,Dh,Iy,Py,sf,xy,Oy,XA,S4,QA,eC,tC,nC,T4;const A4="__json_buf";class c_{constructor(){Sa.add(this),this.messages=[],this.receivedMessages=[],vl.set(this,void 0),this.controller=new AbortController,Oh.set(this,void 0),Cy.set(this,()=>{}),Nh.set(this,()=>{}),kh.set(this,void 0),Ry.set(this,()=>{}),Mh.set(this,()=>{}),yo.set(this,{}),Dh.set(this,!1),Iy.set(this,!1),Py.set(this,!1),sf.set(this,!1),xy.set(this,void 0),Oy.set(this,void 0),QA.set(this,e=>{if(Ot(this,Iy,!0),jp(e)&&(e=new ss),e instanceof ss)return Ot(this,Py,!0),this._emit("abort",e);if(e instanceof Bt)return this._emit("error",e);if(e instanceof Error){const t=new Bt(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new Bt(String(e)))}),Ot(this,Oh,new Promise((e,t)=>{Ot(this,Cy,e,"f"),Ot(this,Nh,t,"f")})),Ot(this,kh,new Promise((e,t)=>{Ot(this,Ry,e,"f"),Ot(this,Mh,t,"f")})),Ke(this,Oh,"f").catch(()=>{}),Ke(this,kh,"f").catch(()=>{})}get response(){return Ke(this,xy,"f")}get request_id(){return Ke(this,Oy,"f")}async withResponse(){const e=await Ke(this,Oh,"f");if(!e)throw new Error("Could not resolve a `Response` object");return{data:this,response:e,request_id:e.headers.get("request-id")}}static fromReadableStream(e){const t=new c_;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,r){const i=new c_;for(const a of t.messages)i._addMessageParam(a);return i._run(()=>i._createMessage(e,{...t,stream:!0},{...r,headers:{...r==null?void 0:r.headers,"X-Stainless-Helper-Method":"stream"}})),i}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},Ke(this,QA,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,r){var o;const i=r==null?void 0:r.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort())),Ke(this,Sa,"m",eC).call(this);const{response:a,data:s}=await e.create({...t,stream:!0},{...r,signal:this.controller.signal}).withResponse();this._connected(a);for await(const u of s)Ke(this,Sa,"m",tC).call(this,u);if((o=s.controller.signal)!=null&&o.aborted)throw new ss;Ke(this,Sa,"m",nC).call(this)}_connected(e){this.ended||(Ot(this,xy,e),Ot(this,Oy,e==null?void 0:e.headers.get("request-id")),Ke(this,Cy,"f").call(this,e),this._emit("connect"))}get ended(){return Ke(this,Dh,"f")}get errored(){return Ke(this,Iy,"f")}get aborted(){return Ke(this,Py,"f")}abort(){this.controller.abort()}on(e,t){return(Ke(this,yo,"f")[e]||(Ke(this,yo,"f")[e]=[])).push({listener:t}),this}off(e,t){const r=Ke(this,yo,"f")[e];if(!r)return this;const i=r.findIndex(a=>a.listener===t);return i>=0&&r.splice(i,1),this}once(e,t){return(Ke(this,yo,"f")[e]||(Ke(this,yo,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{Ot(this,sf,!0),e!=="error"&&this.once("error",r),this.once(e,t)})}async done(){Ot(this,sf,!0),await Ke(this,kh,"f")}get currentMessage(){return Ke(this,vl,"f")}async finalMessage(){return await this.done(),Ke(this,Sa,"m",XA).call(this)}async finalText(){return await this.done(),Ke(this,Sa,"m",S4).call(this)}_emit(e,...t){if(Ke(this,Dh,"f"))return;e==="end"&&(Ot(this,Dh,!0),Ke(this,Ry,"f").call(this));const r=Ke(this,yo,"f")[e];if(r&&(Ke(this,yo,"f")[e]=r.filter(i=>!i.once),r.forEach(({listener:i})=>i(...t))),e==="abort"){const i=t[0];!Ke(this,sf,"f")&&!(r!=null&&r.length)&&Promise.reject(i),Ke(this,Nh,"f").call(this,i),Ke(this,Mh,"f").call(this,i),this._emit("end");return}if(e==="error"){const i=t[0];!Ke(this,sf,"f")&&!(r!=null&&r.length)&&Promise.reject(i),Ke(this,Nh,"f").call(this,i),Ke(this,Mh,"f").call(this,i),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",Ke(this,Sa,"m",XA).call(this))}async _fromReadableStream(e,t){var a;const r=t==null?void 0:t.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),Ke(this,Sa,"m",eC).call(this),this._connected(null);const i=js.fromReadableStream(e,this.controller);for await(const s of i)Ke(this,Sa,"m",tC).call(this,s);if((a=i.controller.signal)!=null&&a.aborted)throw new ss;Ke(this,Sa,"m",nC).call(this)}[(vl=new WeakMap,Oh=new WeakMap,Cy=new WeakMap,Nh=new WeakMap,kh=new WeakMap,Ry=new WeakMap,Mh=new WeakMap,yo=new WeakMap,Dh=new WeakMap,Iy=new WeakMap,Py=new WeakMap,sf=new WeakMap,xy=new WeakMap,Oy=new WeakMap,QA=new WeakMap,Sa=new WeakSet,XA=function(){if(this.receivedMessages.length===0)throw new Bt("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},S4=function(){if(this.receivedMessages.length===0)throw new Bt("stream ended without producing a Message with role=assistant");const t=this.receivedMessages.at(-1).content.filter(r=>r.type==="text").map(r=>r.text);if(t.length===0)throw new Bt("stream ended without producing a content block with type=text");return t.join(" ")},eC=function(){this.ended||Ot(this,vl,void 0)},tC=function(t){if(this.ended)return;const r=Ke(this,Sa,"m",T4).call(this,t);switch(this._emit("streamEvent",t,r),t.type){case"content_block_delta":{const i=r.content.at(-1);switch(t.delta.type){case"text_delta":{i.type==="text"&&this._emit("text",t.delta.text,i.text||"");break}case"citations_delta":{i.type==="text"&&this._emit("citation",t.delta.citation,i.citations??[]);break}case"input_json_delta":{i.type==="tool_use"&&i.input&&this._emit("inputJson",t.delta.partial_json,i.input);break}case"thinking_delta":{i.type==="thinking"&&this._emit("thinking",t.delta.thinking,i.thinking);break}case"signature_delta":{i.type==="thinking"&&this._emit("signature",i.signature);break}default:t.delta}break}case"message_stop":{this._addMessageParam(r),this._addMessage(r,!0);break}case"content_block_stop":{this._emit("contentBlock",r.content.at(-1));break}case"message_start":{Ot(this,vl,r);break}}},nC=function(){if(this.ended)throw new Bt("stream has ended, this shouldn't happen");const t=Ke(this,vl,"f");if(!t)throw new Bt("request ended without sending any chunks");return Ot(this,vl,void 0),t},T4=function(t){let r=Ke(this,vl,"f");if(t.type==="message_start"){if(r)throw new Bt(`Unexpected event order, got ${t.type} before receiving "message_stop"`);return t.message}if(!r)throw new Bt(`Unexpected event order, got ${t.type} before "message_start"`);switch(t.type){case"message_stop":return r;case"message_delta":return r.stop_reason=t.delta.stop_reason,r.stop_sequence=t.delta.stop_sequence,r.usage.output_tokens=t.usage.output_tokens,t.usage.input_tokens!=null&&(r.usage.input_tokens=t.usage.input_tokens),t.usage.cache_creation_input_tokens!=null&&(r.usage.cache_creation_input_tokens=t.usage.cache_creation_input_tokens),t.usage.cache_read_input_tokens!=null&&(r.usage.cache_read_input_tokens=t.usage.cache_read_input_tokens),t.usage.server_tool_use!=null&&(r.usage.server_tool_use=t.usage.server_tool_use),r;case"content_block_start":return r.content.push(t.content_block),r;case"content_block_delta":{const i=r.content.at(t.index);switch(t.delta.type){case"text_delta":{(i==null?void 0:i.type)==="text"&&(i.text+=t.delta.text);break}case"citations_delta":{(i==null?void 0:i.type)==="text"&&(i.citations??(i.citations=[]),i.citations.push(t.delta.citation));break}case"input_json_delta":{if((i==null?void 0:i.type)==="tool_use"){let a=i[A4]||"";a+=t.delta.partial_json,Object.defineProperty(i,A4,{value:a,enumerable:!1,writable:!0}),a&&(i.input=nq(a))}break}case"thinking_delta":{(i==null?void 0:i.type)==="thinking"&&(i.thinking+=t.delta.thinking);break}case"signature_delta":{(i==null?void 0:i.type)==="thinking"&&(i.signature=t.delta.signature);break}default:t.delta}return r}case"content_block_stop":return r}},Symbol.asyncIterator)](){const e=[],t=[];let r=!1;return this.on("streamEvent",i=>{const a=t.shift();a?a.resolve(i):e.push(i)}),this.on("end",()=>{r=!0;for(const i of t)i.resolve(void 0);t.length=0}),this.on("abort",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),this.on("error",i=>{r=!0;for(const a of t)a.reject(i);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:r?{value:void 0,done:!0}:new Promise((a,s)=>t.push({resolve:a,reject:s})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new js(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class aq extends Bo{create(e,t){return this._client.post("/v1/messages/batches",{body:e,...t})}retrieve(e,t){return this._client.get(us`/v1/messages/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/v1/messages/batches",Tm,{query:e,...t})}delete(e,t){return this._client.delete(us`/v1/messages/batches/${e}`,t)}cancel(e,t){return this._client.post(us`/v1/messages/batches/${e}/cancel`,t)}async results(e,t){const r=await this.retrieve(e);if(!r.results_url)throw new Bt(`No batch \`results_url\`; Has it finished processing? ${r.processing_status} - ${r.id}`);return this._client.get(r.results_url,{...t,headers:Mn([{Accept:"application/binary"},t==null?void 0:t.headers]),stream:!0,__binaryResponse:!0})._thenUnwrap((i,a)=>bb.fromResponse(a.response,a.controller))}}class oP extends Bo{constructor(){super(...arguments),this.batches=new aq(this._client)}create(e,t){e.model in C4&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${C4[e.model]}
Please migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`);let r=this._client._options.timeout;if(!e.stream&&r==null){const i=rq[e.model]??void 0;r=this._client.calculateNonstreamingTimeout(e.max_tokens,i)}return this._client.post("/v1/messages",{body:e,timeout:r??6e5,...t,stream:e.stream??!1})}stream(e,t){return c_.createMessage(this,e,t)}countTokens(e,t){return this._client.post("/v1/messages/count_tokens",{body:e,...t})}}const C4={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024","claude-3-sonnet-20240229":"July 21st, 2025","claude-2.1":"July 21st, 2025","claude-2.0":"July 21st, 2025"};oP.Batches=aq;let sq=class extends Bo{retrieve(e,t={},r){const{betas:i}=t??{};return this._client.get(us`/v1/models/${e}`,{...r,headers:Mn([{...(i==null?void 0:i.toString())!=null?{"anthropic-beta":i==null?void 0:i.toString()}:void 0},r==null?void 0:r.headers])})}list(e={},t){const{betas:r,...i}=e??{};return this._client.getAPIList("/v1/models",Tm,{query:i,...t,headers:Mn([{...(r==null?void 0:r.toString())!=null?{"anthropic-beta":r==null?void 0:r.toString()}:void 0},t==null?void 0:t.headers])})}};var rC={};const Ny=n=>{var e,t,r,i;if(typeof globalThis.process<"u")return((e=rC==null?void 0:rC[n])==null?void 0:e.trim())??void 0;if(typeof globalThis.Deno<"u")return(i=(r=(t=globalThis.Deno.env)==null?void 0:t.get)==null?void 0:r.call(t,n))==null?void 0:i.trim()};var oq,lv;class or{constructor({baseURL:e=Ny("ANTHROPIC_BASE_URL"),apiKey:t=Ny("ANTHROPIC_API_KEY")??null,authToken:r=Ny("ANTHROPIC_AUTH_TOKEN")??null,...i}={}){lv.set(this,void 0);const a={apiKey:t,authToken:r,...i,baseURL:e||"https://api.anthropic.com"};if(!a.dangerouslyAllowBrowser&&Wre())throw new Bt(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new Anthropic({ apiKey, dangerouslyAllowBrowser: true });
`);this.baseURL=a.baseURL,this.timeout=a.timeout??dc.DEFAULT_TIMEOUT,this.logger=a.logger??console;const s="warn";this.logLevel=s,this.logLevel=u4(a.logLevel,"ClientOptions.logLevel",this)??u4(Ny("ANTHROPIC_LOG"),"process.env['ANTHROPIC_LOG']",this)??s,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??Xre(),Ot(this,lv,eie),this._options=a,this.apiKey=t,this.authToken=r}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetchOptions:this.fetchOptions,apiKey:this.apiKey,authToken:this.authToken,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(this.apiKey&&e.get("x-api-key"))&&!t.has("x-api-key")&&!(this.authToken&&e.get("authorization"))&&!t.has("authorization"))throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(e){return Mn([this.apiKeyAuth(e),this.bearerAuth(e)])}apiKeyAuth(e){if(this.apiKey!=null)return Mn([{"X-Api-Key":this.apiKey}])}bearerAuth(e){if(this.authToken!=null)return Mn([{Authorization:`Bearer ${this.authToken}`}])}stringifyQuery(e){return Object.entries(e).filter(([t,r])=>typeof r<"u").map(([t,r])=>{if(typeof r=="string"||typeof r=="number"||typeof r=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(r)}`;if(r===null)return`${encodeURIComponent(t)}=`;throw new Bt(`Cannot stringify type ${typeof r}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${wf}`}defaultIdempotencyKey(){return`stainless-node-retry-${k5()}`}makeStatusError(e,t,r,i){return ni.generate(e,t,r,i)}buildURL(e,t){const r=Bre(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return qre(i)||(t={...i,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}_calculateNonstreamingTimeout(e){if(3600*e/128e3>600)throw new Bt("Streaming is strongly recommended for operations that may take longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-python#streaming-responses for more details");return 600*1e3}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(i=>({method:e,path:t,...i})))}request(e,t=null){return new _b(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,r){var T,C;const i=await e,a=i.maxRetries??this.maxRetries;t==null&&(t=a),await this.prepareOptions(i);const{req:s,url:o,timeout:u}=this.buildRequest(i,{retryCount:a-t});await this.prepareRequest(s,{url:o,options:i});const c="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),d=r===void 0?"":`, retryOf: ${r}`,p=Date.now();if(Ti(this).debug(`[${c}] sending request`,yu({retryOfRequestLogID:r,method:i.method,url:o,options:i,headers:s.headers})),(T=i.signal)!=null&&T.aborted)throw new ss;const m=new AbortController,y=await this.fetchWithTimeout(o,s,u,m).catch(W1),b=Date.now();if(y instanceof Error){const A=`retrying, ${t} attempts remaining`;if((C=i.signal)!=null&&C.aborted)throw new ss;const I=jp(y)||/timed? ?out/i.test(String(y)+("cause"in y?String(y.cause):""));if(t)return Ti(this).info(`[${c}] connection ${I?"timed out":"failed"} - ${A}`),Ti(this).debug(`[${c}] connection ${I?"timed out":"failed"} (${A})`,yu({retryOfRequestLogID:r,url:o,durationMs:b-p,message:y.message})),this.retryRequest(i,t,r??c);throw Ti(this).info(`[${c}] connection ${I?"timed out":"failed"} - error; no more retries left`),Ti(this).debug(`[${c}] connection ${I?"timed out":"failed"} (error; no more retries left)`,yu({retryOfRequestLogID:r,url:o,durationMs:b-p,message:y.message})),I?new M5:new vb({cause:y})}const w=[...y.headers.entries()].filter(([A])=>A==="request-id").map(([A,I])=>", "+A+": "+JSON.stringify(I)).join(""),S=`[${c}${d}${w}] ${s.method} ${o} ${y.ok?"succeeded":"failed"} with status ${y.status} in ${b-p}ms`;if(!y.ok){const A=this.shouldRetry(y);if(t&&A){const B=`retrying, ${t} attempts remaining`;return await Qre(y.body),Ti(this).info(`${S} - ${B}`),Ti(this).debug(`[${c}] response error (${B})`,yu({retryOfRequestLogID:r,url:y.url,status:y.status,headers:y.headers,durationMs:b-p})),this.retryRequest(i,t,r??c,y.headers)}const I=A?"error; no more retries left":"error; not retryable";Ti(this).info(`${S} - ${I}`);const x=await y.text().catch(B=>W1(B).message),L=V5(x),U=L?void 0:x;throw Ti(this).debug(`[${c}] response error (${I})`,yu({retryOfRequestLogID:r,url:y.url,status:y.status,headers:y.headers,message:U,durationMs:Date.now()-p})),this.makeStatusError(y.status,L,U,y.headers)}return Ti(this).info(S),Ti(this).debug(`[${c}] response start`,yu({retryOfRequestLogID:r,url:y.url,status:y.status,headers:y.headers,durationMs:b-p})),{response:y,options:i,controller:m,requestLogID:c,retryOfRequestLogID:r,startTime:p}}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}requestAPIList(e,t){const r=this.makeRequest(t,null,void 0);return new uie(this,r,e)}async fetchWithTimeout(e,t,r,i){const{signal:a,method:s,...o}=t||{};a&&a.addEventListener("abort",()=>i.abort());const u=setTimeout(()=>i.abort(),r),c=globalThis.ReadableStream&&o.body instanceof globalThis.ReadableStream||typeof o.body=="object"&&o.body!==null&&Symbol.asyncIterator in o.body,d={signal:i.signal,...c?{duplex:"half"}:{},method:"GET",...o};s&&(d.method=s.toUpperCase());try{return await this.fetch.call(void 0,e,d)}finally{clearTimeout(u)}}shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,r,i){let a;const s=i==null?void 0:i.get("retry-after-ms");if(s){const u=parseFloat(s);Number.isNaN(u)||(a=u)}const o=i==null?void 0:i.get("retry-after");if(o&&!a){const u=parseFloat(o);Number.isNaN(u)?a=Date.parse(o)-Date.now():a=u*1e3}if(!(a&&0<=a&&a<60*1e3)){const u=e.maxRetries??this.maxRetries;a=this.calculateDefaultRetryTimeoutMillis(t,u)}return await Hre(a),this.makeRequest(e,t-1,r)}calculateDefaultRetryTimeoutMillis(e,t){const a=t-e,s=Math.min(.5*Math.pow(2,a),8),o=1-Math.random()*.25;return s*o*1e3}calculateNonstreamingTimeout(e,t){if(36e5*e/128e3>6e5||t!=null&&e>t)throw new Bt("Streaming is strongly recommended for operations that may token longer than 10 minutes. See https://github.com/anthropics/anthropic-sdk-typescript#long-requests for more details");return 6e5}buildRequest(e,{retryCount:t=0}={}){const r={...e},{method:i,path:a,query:s}=r,o=this.buildURL(a,s);"timeout"in r&&zre("timeout",r.timeout),r.timeout=r.timeout??this.timeout;const{bodyHeaders:u,body:c}=this.buildBody({options:r}),d=this.buildHeaders({options:e,method:i,bodyHeaders:u,retryCount:t});return{req:{method:i,headers:d,...r.signal&&{signal:r.signal},...globalThis.ReadableStream&&c instanceof globalThis.ReadableStream&&{duplex:"half"},...c&&{body:c},...this.fetchOptions??{},...r.fetchOptions??{}},url:o,timeout:r.timeout}}buildHeaders({options:e,method:t,bodyHeaders:r,retryCount:i}){let a={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),a[this.idempotencyHeader]=e.idempotencyKey);const s=Mn([a,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(i),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...Zre(),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01"},this.authHeaders(e),this._options.defaultHeaders,r,e.headers]);return this.validateHeaders(s),s.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const r=Mn([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&r.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:H5(e)}:Ke(this,lv,"f").call(this,{body:e,headers:r})}}oq=or,lv=new WeakMap;or.Anthropic=oq;or.HUMAN_PROMPT=`

Human:`;or.AI_PROMPT=`

Assistant:`;or.DEFAULT_TIMEOUT=6e5;or.AnthropicError=Bt;or.APIError=ni;or.APIConnectionError=vb;or.APIConnectionTimeoutError=M5;or.APIUserAbortError=ss;or.NotFoundError=U5;or.ConflictError=j5;or.RateLimitError=B5;or.BadRequestError=D5;or.AuthenticationError=$5;or.InternalServerError=q5;or.PermissionDeniedError=L5;or.UnprocessableEntityError=F5;or.toFile=gie;class dc extends or{constructor(){super(...arguments),this.completions=new iq(this),this.messages=new oP(this),this.models=new sq(this),this.beta=new Am(this)}}dc.Completions=iq;dc.Messages=oP;dc.Models=sq;dc.Beta=Am;const{HUMAN_PROMPT:sSe,AI_PROMPT:oSe}=dc;class R4 extends gb{static lc_name(){return"AnthropicToolsOutputParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","anthropic","output_parsers"]}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){let t=e;if(typeof e=="string")try{t=JSON.parse(e)}catch(i){throw new Na(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(i.message)}`,e)}else t=e;if(this.zodSchema===void 0)return t;const r=await H_(this.zodSchema,t);if(r.success)return r.data;throw new Na(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(r.error.issues)}`,JSON.stringify(t,null,2))}async parseResult(e){const t=e.flatMap(a=>{const{message:s}=a;return Array.isArray(s.content)?lq(s.content)[0]:[]});if(t[0]===void 0)throw new Error("No parseable tool calls provided to AnthropicToolsOutputParser.");const[r]=t;return await this._validateResult(r.args)}}function lq(n){const e=[];for(const t of n)t.type==="tool_use"?e.push({name:t.name,args:t.input,id:t.id,type:"tool_call"}):t.type==="server_tool_use"&&t.name==="web_search"&&e.push({name:t.name,args:t.input,id:t.id,type:"tool_call"});return e}function Sie(n){if(n)return n==="any"?{type:"any"}:n==="auto"?{type:"auto"}:typeof n=="string"?{type:"tool",name:n}:n}function Tie(n){return n==null||typeof n!="object"||!("type"in n)||n.type!=="image"||!("source"in n)||typeof n.source!="object"||n.source==null||!("type"in n.source)?!1:n.source.type==="base64"?!(!("media_type"in n.source)||typeof n.source.media_type!="string"||!("data"in n.source)||typeof n.source.data!="string"):n.source.type==="url"?!(!("url"in n.source)||typeof n.source.url!="string"):!1}function I4(n){const e=xl({dataUrl:n});if(e)return{type:"base64",media_type:e.mime_type,data:e.data};let t;try{t=new URL(n)}catch{throw new Error([`Malformed image URL: ${JSON.stringify(n)}. Content blocks of type 'image_url' must be a valid http, https, or base64-encoded data URL.`,"Example: data:image/png;base64,/9j/4AAQSk...","Example: https://example.com/image.jpg"].join(`

`))}if(t.protocol==="http:"||t.protocol==="https:")return{type:"url",url:n};throw new Error([`Invalid image URL protocol: ${JSON.stringify(t.protocol)}. Anthropic only supports images as http, https, or base64-encoded data URLs on 'image_url' content blocks.`,"Example: data:image/png;base64,/9j/4AAQSk...","Example: https://example.com/image.jpg"].join(`

`))}function Aie(n){const e=[];for(const t of n)if(t._getType()==="tool")if(typeof t.content=="string"){const r=e[e.length-1];(r==null?void 0:r._getType())==="human"&&Array.isArray(r.content)&&"type"in r.content[0]&&r.content[0].type==="tool_result"?r.content.push({type:"tool_result",content:t.content,tool_use_id:t.tool_call_id}):e.push(new ei({content:[{type:"tool_result",content:t.content,tool_use_id:t.tool_call_id}]}))}else e.push(new ei({content:[{type:"tool_result",...t.content!=null?{content:Y1(t.content)}:{},tool_use_id:t.tool_call_id}]}));else e.push(t);return e}function P4(n){if(n.id===void 0)throw new Error('Anthropic requires all tool calls to have an "id".');return{type:"tool_use",id:n.id,name:n.name,input:n.args}}const Cie={providerName:"anthropic",fromStandardTextBlock(n){return{type:"text",text:n.text,..."citations"in(n.metadata??{})?{citations:n.metadata.citations}:{},..."cache_control"in(n.metadata??{})?{cache_control:n.metadata.cache_control}:{}}},fromStandardImageBlock(n){if(n.source_type==="url"){const e=xl({dataUrl:n.url,asTypedArray:!1});return e?{type:"image",source:{type:"base64",data:e.data,media_type:e.mime_type},..."cache_control"in(n.metadata??{})?{cache_control:n.metadata.cache_control}:{}}:{type:"image",source:{type:"url",url:n.url,media_type:n.mime_type??""},..."cache_control"in(n.metadata??{})?{cache_control:n.metadata.cache_control}:{}}}else{if(n.source_type==="base64")return{type:"image",source:{type:"base64",data:n.data,media_type:n.mime_type??""},..."cache_control"in(n.metadata??{})?{cache_control:n.metadata.cache_control}:{}};throw new Error(`Unsupported image source type: ${n.source_type}`)}},fromStandardFileBlock(n){const e=(n.mime_type??"").split(";")[0];if(n.source_type==="url"){if(e==="application/pdf"||e==="")return{type:"document",source:{type:"url",url:n.url,media_type:n.mime_type??""},..."cache_control"in(n.metadata??{})?{cache_control:n.metadata.cache_control}:{},..."citations"in(n.metadata??{})?{citations:n.metadata.citations}:{},..."context"in(n.metadata??{})?{context:n.metadata.context}:{},..."title"in(n.metadata??{})?{title:n.metadata.title}:{}};throw new Error(`Unsupported file mime type for file url source: ${n.mime_type}`)}else if(n.source_type==="text"){if(e==="text/plain"||e==="")return{type:"document",source:{type:"text",data:n.text,media_type:n.mime_type??""},..."cache_control"in(n.metadata??{})?{cache_control:n.metadata.cache_control}:{},..."citations"in(n.metadata??{})?{citations:n.metadata.citations}:{},..."context"in(n.metadata??{})?{context:n.metadata.context}:{},..."title"in(n.metadata??{})?{title:n.metadata.title}:{}};throw new Error(`Unsupported file mime type for file text source: ${n.mime_type}`)}else if(n.source_type==="base64"){if(e==="application/pdf"||e==="")return{type:"document",source:{type:"base64",data:n.data,media_type:"application/pdf"},..."cache_control"in(n.metadata??{})?{cache_control:n.metadata.cache_control}:{},..."citations"in(n.metadata??{})?{citations:n.metadata.citations}:{},..."context"in(n.metadata??{})?{context:n.metadata.context}:{},..."title"in(n.metadata??{})?{title:n.metadata.title}:{}};if(["image/jpeg","image/png","image/gif","image/webp"].includes(e))return{type:"document",source:{type:"content",content:[{type:"image",source:{type:"base64",data:n.data,media_type:e}}]},..."cache_control"in(n.metadata??{})?{cache_control:n.metadata.cache_control}:{},..."citations"in(n.metadata??{})?{citations:n.metadata.citations}:{},..."context"in(n.metadata??{})?{context:n.metadata.context}:{},..."title"in(n.metadata??{})?{title:n.metadata.title}:{}};throw new Error(`Unsupported file mime type for file base64 source: ${n.mime_type}`)}else throw new Error(`Unsupported file source type: ${n.source_type}`)}};function Y1(n){const e=["tool_use","tool_result","input_json_delta","server_tool_use","web_search_tool_result","web_search_result"],t=["text","text_delta"];return typeof n=="string"?n:n.map(i=>{if(Da(i))return rm(i,Cie);const a="cache_control"in i?i.cache_control:void 0;if(i.type==="image_url"){let s;return typeof i.image_url=="string"?s=I4(i.image_url):s=I4(i.image_url.url),{type:"image",source:s,...a?{cache_control:a}:{}}}else{if(Tie(i))return i;if(i.type==="document")return{...i,...a?{cache_control:a}:{}};if(i.type==="thinking")return{type:"thinking",thinking:i.thinking,signature:i.signature,...a?{cache_control:a}:{}};if(i.type==="redacted_thinking")return{type:"redacted_thinking",data:i.data,...a?{cache_control:a}:{}};if(t.find(s=>s===i.type)&&"text"in i)return{type:"text",text:i.text,...a?{cache_control:a}:{},..."citations"in i&&i.citations?{citations:i.citations}:{}};if(e.find(s=>s===i.type)){const s={...i};if("index"in s&&delete s.index,s.type==="input_json_delta"&&(s.type="tool_use"),"input"in s&&typeof s.input=="string")try{s.input=JSON.parse(s.input)}catch{s.input={}}return{...s,...a?{cache_control:a}:{}}}else throw new Error("Unsupported message content format")}})}function x4(n){const e=Aie(n);let t;e.length>0&&e[0]._getType()==="system"&&(t=n[0].content);const i=(t!==void 0?e.slice(1):e).map(a=>{var o;let s;if(a._getType()==="human")s="user";else if(a._getType()==="ai")s="assistant";else if(a._getType()==="tool")s="user";else throw a._getType()==="system"?new Error("System messages are only permitted as the first passed message."):new Error(`Message type "${a._getType()}" is not supported.`);if(ua(a)&&((o=a.tool_calls)!=null&&o.length)){if(typeof a.content=="string")return a.content===""?{role:s,content:a.tool_calls.map(P4)}:{role:s,content:[{type:"text",text:a.content},...a.tool_calls.map(P4)]};{const{content:u}=a;return!a.tool_calls.every(d=>u.find(p=>(p.type==="tool_use"||p.type==="input_json_delta"||p.type==="server_tool_use")&&p.id===d.id))&&console.warn('The "tool_calls" field on a message is only respected if content is a string.'),{role:s,content:Y1(a.content)}}}else return{role:s,content:Y1(a.content)}});return{messages:Rie(i),system:t}}function Rie(n){if(!n||n.length<=1)return n;const e=[];let t=n[0];const r=a=>typeof a=="string"?[{type:"text",text:a}]:a,i=a=>a.role!=="user"||typeof a.content=="string"?!1:Array.isArray(a.content)&&a.content.every(s=>s.type==="tool_result");for(let a=1;a<n.length;a+=1){const s=n[a];i(t)&&i(s)?t={...t,content:[...r(t.content),...r(s.content)]}:(e.push(t),t=s)}return e.push(t),e}function Iie(n,e){var t;if(n.type==="message_start"){const{content:r,usage:i,...a}=n.message,s={};for(const[p,m]of Object.entries(a))m!=null&&(s[p]=m);const{input_tokens:o,output_tokens:u,...c}=i??{},d={input_tokens:o,output_tokens:u,total_tokens:o+u,input_token_details:{cache_creation:c.cache_creation_input_tokens,cache_read:c.cache_read_input_tokens}};return{chunk:new Sn({content:e.coerceContentToString?"":[],additional_kwargs:s,usage_metadata:e.streamUsage?d:void 0,response_metadata:{usage:{...c}},id:n.message.id})}}else if(n.type==="message_delta"){const r={input_tokens:0,output_tokens:n.usage.output_tokens,total_tokens:n.usage.output_tokens,input_token_details:{cache_creation:n.usage.cache_creation_input_tokens,cache_read:n.usage.cache_read_input_tokens}};return{chunk:new Sn({content:e.coerceContentToString?"":[],additional_kwargs:{...n.delta},usage_metadata:e.streamUsage?r:void 0})}}else if(n.type==="content_block_start"&&["tool_use","document","server_tool_use","web_search_tool_result"].includes(n.content_block.type)){const r=n.content_block;let i;return r.type==="tool_use"?i=[{id:r.id,index:n.index,name:r.name,args:""}]:r.type==="server_tool_use"?i=[{id:r.id,index:n.index,name:r.name,args:""}]:i=[],{chunk:new Sn({content:e.coerceContentToString?"":[{index:n.index,...n.content_block,input:r.type==="server_tool_use"||r.type==="tool_use"?"":void 0}],additional_kwargs:{},tool_call_chunks:i})}}else if(n.type==="content_block_delta"&&["text_delta","citations_delta","thinking_delta","signature_delta"].includes(n.delta.type)){if(e.coerceContentToString&&"text"in n.delta)return{chunk:new Sn({content:n.delta.text})};{const r=n.delta;return"citation"in r&&(r.citations=[r.citation],delete r.citation),r.type==="thinking_delta"||r.type==="signature_delta"?{chunk:new Sn({content:[{index:n.index,...r,type:"thinking"}]})}:{chunk:new Sn({content:[{index:n.index,...r,type:"text"}]})}}}else{if(n.type==="content_block_delta"&&n.delta.type==="input_json_delta")return{chunk:new Sn({content:e.coerceContentToString?"":[{index:n.index,input:n.delta.partial_json,type:n.delta.type}],additional_kwargs:{},tool_call_chunks:[{index:n.index,args:n.delta.partial_json}]})};if(n.type==="content_block_start"&&n.content_block.type==="text"){const r=(t=n.content_block)==null?void 0:t.text;if(r!==void 0)return{chunk:new Sn({content:e.coerceContentToString?r:[{index:n.index,...n.content_block}],additional_kwargs:{}})}}else{if(n.type==="content_block_start"&&n.content_block.type==="redacted_thinking")return{chunk:new Sn({content:e.coerceContentToString?"":[{index:n.index,...n.content_block}]})};if(n.type==="content_block_start"&&n.content_block.type==="thinking"){const r=n.content_block.thinking;return{chunk:new Sn({content:e.coerceContentToString?r:[{index:n.index,...n.content_block}]})}}}}return null}function Pie(n,e){const t=e.usage,r=t!=null?{input_tokens:t.input_tokens??0,output_tokens:t.output_tokens??0,total_tokens:(t.input_tokens??0)+(t.output_tokens??0),input_token_details:{cache_creation:t.cache_creation_input_tokens,cache_read:t.cache_read_input_tokens}}:void 0;if(n.length===1&&n[0].type==="text")return[{text:n[0].text,message:new bn({content:n[0].text,additional_kwargs:e,usage_metadata:r,response_metadata:e,id:e.id})}];{const i=lq(n);return[{text:"",message:new bn({content:n,additional_kwargs:e,tool_calls:i,usage_metadata:r,response_metadata:e,id:e.id})}]}}function ky(n,e){return n.lc_error_code=e,n.message=`${n.message}

Troubleshooting URL: https://js.langchain.com/docs/troubleshooting/errors/${e}/
`,n}function O4(n){let e;return n.status===400&&n.message.includes("tool")?e=ky(n,"INVALID_TOOL_RESULTS"):n.status===401?e=ky(n,"MODEL_AUTHENTICATION"):n.status===404?e=ky(n,"MODEL_NOT_FOUND"):n.status===429?e=ky(n,"MODEL_RATE_LIMIT"):e=n,e}function xie(n){return!!(n.tools&&n.tools.length>0)}function Oie(n){for(const e of n.messages??[])if(typeof e.content!="string"){for(const t of e.content??[])if(typeof t=="object"&&t!=null&&t.type==="document"&&typeof t.citations=="object"&&t.citations.enabled)return!0}return!1}function Nie(n){return!!(n.thinking&&n.thinking.type==="enabled")}function kie(n){return"input_schema"in n}function Mie(n){const e=["web_search"];return typeof n=="object"&&n!==null&&"type"in n&&"name"in n&&typeof n.type=="string"&&typeof n.name=="string"&&e.includes(n.name)}function Die(n){if(typeof n.content=="string")return n.content;if(Array.isArray(n.content)&&n.content.length>=1&&"input"in n.content[0])return typeof n.content[0].input=="string"?n.content[0].input:JSON.stringify(n.content[0].input);if(Array.isArray(n.content)&&n.content.length>=1&&"text"in n.content[0])return n.content[0].text}class $ie extends ui{static lc_name(){return"ChatAnthropic"}get lc_secrets(){return{anthropicApiKey:"ANTHROPIC_API_KEY",apiKey:"ANTHROPIC_API_KEY"}}get lc_aliases(){return{modelName:"model"}}constructor(e){if(super(e??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"anthropicApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:-1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:2048}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"claude-2.1"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"claude-2.1"}),Object.defineProperty(this,"invocationKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"clientOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"thinking",{enumerable:!0,configurable:!0,writable:!0,value:{type:"disabled"}}),Object.defineProperty(this,"batchClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamingClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"createClient",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.anthropicApiKey=(e==null?void 0:e.apiKey)??(e==null?void 0:e.anthropicApiKey)??Mi("ANTHROPIC_API_KEY"),!this.anthropicApiKey&&!(e!=null&&e.createClient))throw new Error("Anthropic API key not found");this.clientOptions=(e==null?void 0:e.clientOptions)??{},this.apiKey=this.anthropicApiKey,this.apiUrl=e==null?void 0:e.anthropicApiUrl,this.modelName=(e==null?void 0:e.model)??(e==null?void 0:e.modelName)??this.model,this.model=this.modelName,this.invocationKwargs=(e==null?void 0:e.invocationKwargs)??{},this.temperature=(e==null?void 0:e.temperature)??this.temperature,this.topK=(e==null?void 0:e.topK)??this.topK,this.topP=(e==null?void 0:e.topP)??this.topP,this.maxTokens=(e==null?void 0:e.maxTokensToSample)??(e==null?void 0:e.maxTokens)??this.maxTokens,this.stopSequences=(e==null?void 0:e.stopSequences)??this.stopSequences,this.streaming=(e==null?void 0:e.streaming)??!1,this.streamUsage=(e==null?void 0:e.streamUsage)??this.streamUsage,this.thinking=(e==null?void 0:e.thinking)??this.thinking,this.createClient=(e==null?void 0:e.createClient)??(t=>new dc(t))}getLsParams(e){const t=this.invocationParams(e);return{ls_provider:"anthropic",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:t.temperature??void 0,ls_max_tokens:t.max_tokens??void 0,ls_stop:e.stop}}formatStructuredToolToAnthropic(e){if(!(!e||!e.length))return e.map(t=>{if(Mie(t)||kie(t))return t;if(pd(t))return{name:t.function.name,description:t.function.description,input_schema:t.function.parameters};if(cc(t))return{name:t.name,description:t.description,input_schema:Pi(t.schema)?yr(t.schema):t.schema};throw new Error(`Unknown tool type passed to ChatAnthropic: ${JSON.stringify(t,null,2)}`)})}bindTools(e,t){return this.withConfig({tools:this.formatStructuredToolToAnthropic(e),...t})}invocationParams(e){const t=Sie(e==null?void 0:e.tool_choice);if(this.thinking.type==="enabled"){if(this.topK!==-1)throw new Error("topK is not supported when thinking is enabled");if(this.topP!==-1)throw new Error("topP is not supported when thinking is enabled");if(this.temperature!==1)throw new Error("temperature is not supported when thinking is enabled");return{model:this.model,stop_sequences:(e==null?void 0:e.stop)??this.stopSequences,stream:this.streaming,max_tokens:this.maxTokens,tools:this.formatStructuredToolToAnthropic(e==null?void 0:e.tools),tool_choice:t,thinking:this.thinking,...this.invocationKwargs}}return{model:this.model,temperature:this.temperature,top_k:this.topK,top_p:this.topP,stop_sequences:(e==null?void 0:e.stop)??this.stopSequences,stream:this.streaming,max_tokens:this.maxTokens,tools:this.formatStructuredToolToAnthropic(e==null?void 0:e.tools),tool_choice:t,thinking:this.thinking,...this.invocationKwargs}}_identifyingParams(){return{model_name:this.model,...this.invocationParams()}}identifyingParams(){return{model_name:this.model,...this.invocationParams()}}async*_streamResponseChunks(e,t,r){var c;const i=this.invocationParams(t),a=x4(e),s={...i,...a,stream:!0},o=!xie(s)&&!Oie(s)&&!Nie(s),u=await this.createStreamWithRetry(s,{headers:t.headers});for await(const d of u){if((c=t.signal)!=null&&c.aborted)throw u.controller.abort(),new Error("AbortError: User aborted the request.");const p=this.streamUsage??t.streamUsage,m=Iie(d,{streamUsage:p,coerceContentToString:o});if(!m)continue;const{chunk:y}=m,b=Die(y),w=new ca({message:new Sn({content:y.content,additional_kwargs:y.additional_kwargs,tool_call_chunks:y.tool_call_chunks,usage_metadata:p?y.usage_metadata:void 0,response_metadata:y.response_metadata,id:y.id}),text:b??""});yield w,await(r==null?void 0:r.handleLLMNewToken(b??"",void 0,void 0,void 0,void 0,{chunk:w}))}}async _generateNonStreaming(e,t,r){const i=await this.completionWithRetry({...t,stream:!1,...x4(e)},r),{content:a,...s}=i,o=Pie(a,s),{role:u,type:c,...d}=s;return{generations:o,llmOutput:d}}async _generate(e,t,r){if(this.stopSequences&&t.stop)throw new Error('"stopSequence" parameter found in input and default params');const i=this.invocationParams(t);if(i.stream){let a;const s=this._streamResponseChunks(e,t,r);for await(const o of s)a===void 0?a=o:a=a.concat(o);if(a===void 0)throw new Error("No chunks returned from Anthropic API.");return{generations:[{text:a.text,message:a.message}]}}else return this._generateNonStreaming(e,i,{signal:t.signal,headers:t.headers})}async createStreamWithRetry(e,t){if(!this.streamingClient){const i=this.apiUrl?{baseURL:this.apiUrl}:void 0;this.streamingClient=this.createClient({dangerouslyAllowBrowser:!0,...this.clientOptions,...i,apiKey:this.apiKey,maxRetries:0})}const r=async()=>{try{return await this.streamingClient.messages.create({...e,...this.invocationKwargs,stream:!0},t)}catch(i){throw O4(i)}};return this.caller.call(r)}async completionWithRetry(e,t){if(!this.batchClient){const i=this.apiUrl?{baseURL:this.apiUrl}:void 0;this.batchClient=this.createClient({dangerouslyAllowBrowser:!0,...this.clientOptions,...i,apiKey:this.apiKey,maxRetries:0})}const r=async()=>{try{return await this.batchClient.messages.create({...e,...this.invocationKwargs},t)}catch(i){throw O4(i)}};return this.caller.callWithOptions({signal:t.signal??void 0},r)}_llmType(){return"anthropic"}withStructuredOutput(e,t){var b;const r=e,i=t==null?void 0:t.name,a=t==null?void 0:t.method,s=t==null?void 0:t.includeRaw;if(a==="jsonMode")throw new Error('Anthropic only supports "functionCalling" as a method.');let o=i??"extract",u,c;if(Pi(r)){const w=yr(r);c=[{name:o,description:w.description??"A function available to call.",input_schema:w}],u=new R4({returnSingle:!0,keyName:o,zodSchema:r})}else{let w;typeof r.name=="string"&&typeof r.description=="string"&&typeof r.input_schema=="object"&&r.input_schema!=null?(w=r,o=r.name):w={name:o,description:r.description??"",input_schema:r},c=[w],u=new R4({returnSingle:!0,keyName:o})}let d;if(((b=this.thinking)==null?void 0:b.type)==="enabled"){const w="Anthropic structured output relies on forced tool calling, which is not supported when `thinking` is enabled. This method will raise OutputParserException if tool calls are not generated. Consider disabling `thinking` or adjust your prompt to ensure the tool is called.";console.warn(w),d=this.withConfig({tools:c,ls_structured_output_format:{kwargs:{method:"functionCalling"},schema:yr(r)}});const S=T=>{if(!T.tool_calls||T.tool_calls.length===0)throw new Error(w);return T};d=d.pipe(S)}else d=this.withConfig({tools:c,tool_choice:{type:"tool",name:o},ls_structured_output_format:{kwargs:{method:"functionCalling"},schema:yr(r)}});if(!s)return d.pipe(u).withConfig({runName:"ChatAnthropicStructuredOutput"});const p=ms.assign({parsed:(w,S)=>u.invoke(w.raw,S)}),m=ms.assign({parsed:()=>null}),y=p.withFallbacks({fallbacks:[m]});return vr.from([{raw:d},y]).withConfig({runName:"StructuredOutputRunnable"})}}class Lie extends $ie{}var N4;(function(n){n.STRING="string",n.NUMBER="number",n.INTEGER="integer",n.BOOLEAN="boolean",n.ARRAY="array",n.OBJECT="object"})(N4||(N4={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var k4;(function(n){n.LANGUAGE_UNSPECIFIED="language_unspecified",n.PYTHON="python"})(k4||(k4={}));var M4;(function(n){n.OUTCOME_UNSPECIFIED="outcome_unspecified",n.OUTCOME_OK="outcome_ok",n.OUTCOME_FAILED="outcome_failed",n.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"})(M4||(M4={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const D4=["user","model","function","system"];var $4;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})($4||($4={}));var L4;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(L4||(L4={}));var U4;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(U4||(U4={}));var j4;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER"})(j4||(j4={}));var yp;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.OTHER="OTHER"})(yp||(yp={}));var F4;(function(n){n.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",n.RETRIEVAL_QUERY="RETRIEVAL_QUERY",n.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",n.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",n.CLASSIFICATION="CLASSIFICATION",n.CLUSTERING="CLUSTERING"})(F4||(F4={}));var xf;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(xf||(xf={}));var B4;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(B4||(B4={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xr extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class of extends Xr{constructor(e,t){super(e),this.response=t}}class uq extends Xr{constructor(e,t,r,i){super(e),this.status=t,this.statusText=r,this.errorDetails=i}}class Nl extends Xr{}class cq extends Xr{}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uie="https://generativelanguage.googleapis.com",jie="v1beta",Fie="0.24.1",Bie="genai-js";var Ju;(function(n){n.GENERATE_CONTENT="generateContent",n.STREAM_GENERATE_CONTENT="streamGenerateContent",n.COUNT_TOKENS="countTokens",n.EMBED_CONTENT="embedContent",n.BATCH_EMBED_CONTENTS="batchEmbedContents"})(Ju||(Ju={}));class qie{constructor(e,t,r,i,a){this.model=e,this.task=t,this.apiKey=r,this.stream=i,this.requestOptions=a}toString(){var e,t;const r=((e=this.requestOptions)===null||e===void 0?void 0:e.apiVersion)||jie;let a=`${((t=this.requestOptions)===null||t===void 0?void 0:t.baseUrl)||Uie}/${r}/${this.model}:${this.task}`;return this.stream&&(a+="?alt=sse"),a}}function Vie(n){const e=[];return n!=null&&n.apiClient&&e.push(n.apiClient),e.push(`${Bie}/${Fie}`),e.join(" ")}async function zie(n){var e;const t=new Headers;t.append("Content-Type","application/json"),t.append("x-goog-api-client",Vie(n.requestOptions)),t.append("x-goog-api-key",n.apiKey);let r=(e=n.requestOptions)===null||e===void 0?void 0:e.customHeaders;if(r){if(!(r instanceof Headers))try{r=new Headers(r)}catch(i){throw new Nl(`unable to convert customHeaders value ${JSON.stringify(r)} to Headers: ${i.message}`)}for(const[i,a]of r.entries()){if(i==="x-goog-api-key")throw new Nl(`Cannot set reserved header name ${i}`);if(i==="x-goog-api-client")throw new Nl(`Header name ${i} can only be set using the apiClient field`);t.append(i,a)}}return t}async function Hie(n,e,t,r,i,a){const s=new qie(n,e,t,r,a);return{url:s.toString(),fetchOptions:Object.assign(Object.assign({},Jie(a)),{method:"POST",headers:await zie(s),body:i})}}async function Cm(n,e,t,r,i,a={},s=fetch){const{url:o,fetchOptions:u}=await Hie(n,e,t,r,i,a);return Gie(o,u,s)}async function Gie(n,e,t=fetch){let r;try{r=await t(n,e)}catch(i){Wie(i,n)}return r.ok||await Kie(r,n),r}function Wie(n,e){let t=n;throw t.name==="AbortError"?(t=new cq(`Request aborted when fetching ${e.toString()}: ${n.message}`),t.stack=n.stack):n instanceof uq||n instanceof Nl||(t=new Xr(`Error fetching from ${e.toString()}: ${n.message}`),t.stack=n.stack),t}async function Kie(n,e){let t="",r;try{const i=await n.json();t=i.error.message,i.error.details&&(t+=` ${JSON.stringify(i.error.details)}`,r=i.error.details)}catch{}throw new uq(`Error fetching from ${e.toString()}: [${n.status} ${n.statusText}] ${t}`,n.status,n.statusText,r)}function Jie(n){const e={};if((n==null?void 0:n.signal)!==void 0||(n==null?void 0:n.timeout)>=0){const t=new AbortController;(n==null?void 0:n.timeout)>=0&&setTimeout(()=>t.abort(),n.timeout),n!=null&&n.signal&&n.signal.addEventListener("abort",()=>{t.abort()}),e.signal=t.signal}return e}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lP(n){return n.text=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),uv(n.candidates[0]))throw new of(`${El(n)}`,n);return Yie(n)}else if(n.promptFeedback)throw new of(`Text not available. ${El(n)}`,n);return""},n.functionCall=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),uv(n.candidates[0]))throw new of(`${El(n)}`,n);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),q4(n)[0]}else if(n.promptFeedback)throw new of(`Function call not available. ${El(n)}`,n)},n.functionCalls=()=>{if(n.candidates&&n.candidates.length>0){if(n.candidates.length>1&&console.warn(`This response had ${n.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),uv(n.candidates[0]))throw new of(`${El(n)}`,n);return q4(n)}else if(n.promptFeedback)throw new of(`Function call not available. ${El(n)}`,n)},n}function Yie(n){var e,t,r,i;const a=[];if(!((t=(e=n.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const s of(i=(r=n.candidates)===null||r===void 0?void 0:r[0].content)===null||i===void 0?void 0:i.parts)s.text&&a.push(s.text),s.executableCode&&a.push("\n```"+s.executableCode.language+`
`+s.executableCode.code+"\n```\n"),s.codeExecutionResult&&a.push("\n```\n"+s.codeExecutionResult.output+"\n```\n");return a.length>0?a.join(""):""}function q4(n){var e,t,r,i;const a=[];if(!((t=(e=n.candidates)===null||e===void 0?void 0:e[0].content)===null||t===void 0)&&t.parts)for(const s of(i=(r=n.candidates)===null||r===void 0?void 0:r[0].content)===null||i===void 0?void 0:i.parts)s.functionCall&&a.push(s.functionCall);if(a.length>0)return a}const Zie=[yp.RECITATION,yp.SAFETY,yp.LANGUAGE];function uv(n){return!!n.finishReason&&Zie.includes(n.finishReason)}function El(n){var e,t,r;let i="";if((!n.candidates||n.candidates.length===0)&&n.promptFeedback)i+="Response was blocked",!((e=n.promptFeedback)===null||e===void 0)&&e.blockReason&&(i+=` due to ${n.promptFeedback.blockReason}`),!((t=n.promptFeedback)===null||t===void 0)&&t.blockReasonMessage&&(i+=`: ${n.promptFeedback.blockReasonMessage}`);else if(!((r=n.candidates)===null||r===void 0)&&r[0]){const a=n.candidates[0];uv(a)&&(i+=`Candidate was blocked due to ${a.finishReason}`,a.finishMessage&&(i+=`: ${a.finishMessage}`))}return i}function Fp(n){return this instanceof Fp?(this.v=n,this):new Fp(n)}function Xie(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,a=[];return i={},s("next"),s("throw"),s("return"),i[Symbol.asyncIterator]=function(){return this},i;function s(m){r[m]&&(i[m]=function(y){return new Promise(function(b,w){a.push([m,y,b,w])>1||o(m,y)})})}function o(m,y){try{u(r[m](y))}catch(b){p(a[0][3],b)}}function u(m){m.value instanceof Fp?Promise.resolve(m.value.v).then(c,d):p(a[0][2],m)}function c(m){o("next",m)}function d(m){o("throw",m)}function p(m,y){m(y),a.shift(),a.length&&o(a[0][0],a[0][1])}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const V4=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;function Qie(n){const e=n.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),t=nae(e),[r,i]=t.tee();return{stream:tae(r),response:eae(i)}}async function eae(n){const e=[],t=n.getReader();for(;;){const{done:r,value:i}=await t.read();if(r)return lP(rae(e));e.push(i)}}function tae(n){return Xie(this,arguments,function*(){const t=n.getReader();for(;;){const{value:r,done:i}=yield Fp(t.read());if(i)break;yield yield Fp(lP(r))}})}function nae(n){const e=n.getReader();return new ReadableStream({start(r){let i="";return a();function a(){return e.read().then(({value:s,done:o})=>{if(o){if(i.trim()){r.error(new Xr("Failed to parse stream"));return}r.close();return}i+=s;let u=i.match(V4),c;for(;u;){try{c=JSON.parse(u[1])}catch{r.error(new Xr(`Error parsing JSON response: "${u[1]}"`));return}r.enqueue(c),i=i.substring(u[0].length),u=i.match(V4)}return a()}).catch(s=>{let o=s;throw o.stack=s.stack,o.name==="AbortError"?o=new cq("Request aborted when reading from the stream"):o=new Xr("Error reading from the stream"),o})}}})}function rae(n){const e=n[n.length-1],t={promptFeedback:e==null?void 0:e.promptFeedback};for(const r of n){if(r.candidates){let i=0;for(const a of r.candidates)if(t.candidates||(t.candidates=[]),t.candidates[i]||(t.candidates[i]={index:i}),t.candidates[i].citationMetadata=a.citationMetadata,t.candidates[i].groundingMetadata=a.groundingMetadata,t.candidates[i].finishReason=a.finishReason,t.candidates[i].finishMessage=a.finishMessage,t.candidates[i].safetyRatings=a.safetyRatings,a.content&&a.content.parts){t.candidates[i].content||(t.candidates[i].content={role:a.content.role||"user",parts:[]});const s={};for(const o of a.content.parts)o.text&&(s.text=o.text),o.functionCall&&(s.functionCall=o.functionCall),o.executableCode&&(s.executableCode=o.executableCode),o.codeExecutionResult&&(s.codeExecutionResult=o.codeExecutionResult),Object.keys(s).length===0&&(s.text=""),t.candidates[i].content.parts.push(s)}i++}r.usageMetadata&&(t.usageMetadata=r.usageMetadata)}return t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fq(n,e,t,r){const i=await Cm(e,Ju.STREAM_GENERATE_CONTENT,n,!0,JSON.stringify(t),r);return Qie(i)}async function dq(n,e,t,r){const a=await(await Cm(e,Ju.GENERATE_CONTENT,n,!1,JSON.stringify(t),r)).json();return{response:lP(a)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hq(n){if(n!=null){if(typeof n=="string")return{role:"system",parts:[{text:n}]};if(n.text)return{role:"system",parts:[n]};if(n.parts)return n.role?n:{role:"system",parts:n.parts}}}function Bp(n){let e=[];if(typeof n=="string")e=[{text:n}];else for(const t of n)typeof t=="string"?e.push({text:t}):e.push(t);return iae(e)}function iae(n){const e={role:"user",parts:[]},t={role:"function",parts:[]};let r=!1,i=!1;for(const a of n)"functionResponse"in a?(t.parts.push(a),i=!0):(e.parts.push(a),r=!0);if(r&&i)throw new Xr("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!r&&!i)throw new Xr("No content is provided for sending chat message.");return r?e:t}function aae(n,e){var t;let r={model:e==null?void 0:e.model,generationConfig:e==null?void 0:e.generationConfig,safetySettings:e==null?void 0:e.safetySettings,tools:e==null?void 0:e.tools,toolConfig:e==null?void 0:e.toolConfig,systemInstruction:e==null?void 0:e.systemInstruction,cachedContent:(t=e==null?void 0:e.cachedContent)===null||t===void 0?void 0:t.name,contents:[]};const i=n.generateContentRequest!=null;if(n.contents){if(i)throw new Nl("CountTokensRequest must have one of contents or generateContentRequest, not both.");r.contents=n.contents}else if(i)r=Object.assign(Object.assign({},r),n.generateContentRequest);else{const a=Bp(n);r.contents=[a]}return{generateContentRequest:r}}function z4(n){let e;return n.contents?e=n:e={contents:[Bp(n)]},n.systemInstruction&&(e.systemInstruction=hq(n.systemInstruction)),e}function sae(n){return typeof n=="string"||Array.isArray(n)?{content:Bp(n)}:n}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const H4=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],oae={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]};function lae(n){let e=!1;for(const t of n){const{role:r,parts:i}=t;if(!e&&r!=="user")throw new Xr(`First content should be with role 'user', got ${r}`);if(!D4.includes(r))throw new Xr(`Each item should include role field. Got ${r} but valid roles are: ${JSON.stringify(D4)}`);if(!Array.isArray(i))throw new Xr("Content should have 'parts' property with an array of Parts");if(i.length===0)throw new Xr("Each Content should have at least one part");const a={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(const o of i)for(const u of H4)u in o&&(a[u]+=1);const s=oae[r];for(const o of H4)if(!s.includes(o)&&a[o]>0)throw new Xr(`Content with role '${r}' can't contain '${o}' part`);e=!0}}function G4(n){var e;if(n.candidates===void 0||n.candidates.length===0)return!1;const t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;if(t===void 0||t.parts===void 0||t.parts.length===0)return!1;for(const r of t.parts)if(r===void 0||Object.keys(r).length===0||r.text!==void 0&&r.text==="")return!1;return!0}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const W4="SILENT_ERROR";class uae{constructor(e,t,r,i={}){this.model=t,this.params=r,this._requestOptions=i,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,r!=null&&r.history&&(lae(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e,t={}){var r,i,a,s,o,u;await this._sendPromise;const c=Bp(e),d={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(s=this.params)===null||s===void 0?void 0:s.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,cachedContent:(u=this.params)===null||u===void 0?void 0:u.cachedContent,contents:[...this._history,c]},p=Object.assign(Object.assign({},this._requestOptions),t);let m;return this._sendPromise=this._sendPromise.then(()=>dq(this._apiKey,this.model,d,p)).then(y=>{var b;if(G4(y.response)){this._history.push(c);const w=Object.assign({parts:[],role:"model"},(b=y.response.candidates)===null||b===void 0?void 0:b[0].content);this._history.push(w)}else{const w=El(y.response);w&&console.warn(`sendMessage() was unsuccessful. ${w}. Inspect response object for details.`)}m=y}).catch(y=>{throw this._sendPromise=Promise.resolve(),y}),await this._sendPromise,m}async sendMessageStream(e,t={}){var r,i,a,s,o,u;await this._sendPromise;const c=Bp(e),d={safetySettings:(r=this.params)===null||r===void 0?void 0:r.safetySettings,generationConfig:(i=this.params)===null||i===void 0?void 0:i.generationConfig,tools:(a=this.params)===null||a===void 0?void 0:a.tools,toolConfig:(s=this.params)===null||s===void 0?void 0:s.toolConfig,systemInstruction:(o=this.params)===null||o===void 0?void 0:o.systemInstruction,cachedContent:(u=this.params)===null||u===void 0?void 0:u.cachedContent,contents:[...this._history,c]},p=Object.assign(Object.assign({},this._requestOptions),t),m=fq(this._apiKey,this.model,d,p);return this._sendPromise=this._sendPromise.then(()=>m).catch(y=>{throw new Error(W4)}).then(y=>y.response).then(y=>{if(G4(y)){this._history.push(c);const b=Object.assign({},y.candidates[0].content);b.role||(b.role="model"),this._history.push(b)}else{const b=El(y);b&&console.warn(`sendMessageStream() was unsuccessful. ${b}. Inspect response object for details.`)}}).catch(y=>{y.message!==W4&&console.error(y)}),m}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cae(n,e,t,r){return(await Cm(e,Ju.COUNT_TOKENS,n,!1,JSON.stringify(t),r)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fae(n,e,t,r){return(await Cm(e,Ju.EMBED_CONTENT,n,!1,JSON.stringify(t),r)).json()}async function dae(n,e,t,r){const i=t.requests.map(s=>Object.assign(Object.assign({},s),{model:e}));return(await Cm(e,Ju.BATCH_EMBED_CONTENTS,n,!1,JSON.stringify({requests:i}),r)).json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class K4{constructor(e,t,r={}){this.apiKey=e,this._requestOptions=r,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=hq(t.systemInstruction),this.cachedContent=t.cachedContent}async generateContent(e,t={}){var r;const i=z4(e),a=Object.assign(Object.assign({},this._requestOptions),t);return dq(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},i),a)}async generateContentStream(e,t={}){var r;const i=z4(e),a=Object.assign(Object.assign({},this._requestOptions),t);return fq(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(r=this.cachedContent)===null||r===void 0?void 0:r.name},i),a)}startChat(e){var t;return new uae(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:(t=this.cachedContent)===null||t===void 0?void 0:t.name},e),this._requestOptions)}async countTokens(e,t={}){const r=aae(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent}),i=Object.assign(Object.assign({},this._requestOptions),t);return cae(this.apiKey,this.model,r,i)}async embedContent(e,t={}){const r=sae(e),i=Object.assign(Object.assign({},this._requestOptions),t);return fae(this.apiKey,this.model,r,i)}async batchEmbedContents(e,t={}){const r=Object.assign(Object.assign({},this._requestOptions),t);return dae(this.apiKey,this.model,e,r)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class J4{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new Xr("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new K4(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t,r){if(!e.name)throw new Nl("Cached content must contain a `name` field.");if(!e.model)throw new Nl("Cached content must contain a `model` field.");const i=["model","systemInstruction"];for(const s of i)if(t!=null&&t[s]&&e[s]&&(t==null?void 0:t[s])!==e[s]){if(s==="model"){const o=t.model.startsWith("models/")?t.model.replace("models/",""):t.model,u=e.model.startsWith("models/")?e.model.replace("models/",""):e.model;if(o===u)continue}throw new Nl(`Different value for "${s}" specified in modelParams (${t[s]}) and cachedContent (${e[s]})`)}const a=Object.assign(Object.assign({},t),{model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e});return new K4(this.apiKey,a,r)}}function Yu(n){if(typeof n=="object"&&n!==null){const e={...n};"additionalProperties"in e&&delete e.additionalProperties,"$schema"in e&&delete e.$schema,"strict"in e&&delete e.strict;for(const t in e)t in e&&(Array.isArray(e[t])?e[t]=e[t].map(Yu):typeof e[t]=="object"&&e[t]!==null&&(e[t]=Yu(e[t])));return e}return n}function Z1(n){const e=Yu(Pi(n)?yr(n):n),{$schema:t,...r}=e;return r}function hae(n){const e=Yu(n),{$schema:t,...r}=e;return r}const Lr=[];for(let n=0;n<256;++n)Lr.push((n+256).toString(16).slice(1));function pae(n,e=0){return(Lr[n[e+0]]+Lr[n[e+1]]+Lr[n[e+2]]+Lr[n[e+3]]+"-"+Lr[n[e+4]]+Lr[n[e+5]]+"-"+Lr[n[e+6]]+Lr[n[e+7]]+"-"+Lr[n[e+8]]+Lr[n[e+9]]+"-"+Lr[n[e+10]]+Lr[n[e+11]]+Lr[n[e+12]]+Lr[n[e+13]]+Lr[n[e+14]]+Lr[n[e+15]]).toLowerCase()}let iC;const mae=new Uint8Array(16);function gae(){if(!iC){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");iC=crypto.getRandomValues.bind(crypto)}return iC(mae)}const yae=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),Y4={randomUUID:yae};function pq(n,e,t){var i;if(Y4.randomUUID&&!n)return Y4.randomUUID();n=n||{};const r=n.random??((i=n.rng)==null?void 0:i.call(n))??gae();if(r.length<16)throw new Error("Random bytes length must be >= 16");return r[6]=r[6]&15|64,r[8]=r[8]&63|128,pae(r)}function vae(n){const e=n._getType();return La.isInstance(n)?n.role:e==="tool"?e:n.name??e}function _ae(n){switch(n){case"supervisor":case"ai":case"model":return"model";case"system":return"system";case"human":return"user";case"tool":case"function":return"function";default:throw new Error(`Unknown / unsupported author: ${n}`)}}function bae(n){if("mimeType"in n&&"data"in n)return{inlineData:{mimeType:n.mimeType,data:n.data}};if("mimeType"in n&&"fileUri"in n)return{fileData:{mimeType:n.mimeType,fileUri:n.fileUri}};throw new Error("Invalid media content")}function wae(n,e){var t;return(t=e.map(r=>ua(r)?r.tool_calls??[]:[]).flat().find(r=>r.id===n.tool_call_id))==null?void 0:t.name}function Eae(n){return{providerName:"Google Gemini",fromStandardTextBlock(t){return{text:t.text}},fromStandardImageBlock(t){if(!n)throw new Error("This model does not support images");if(t.source_type==="url"){const r=xl({dataUrl:t.url});return r?{inlineData:{mimeType:r.mime_type,data:r.data}}:{fileData:{mimeType:t.mime_type??"",fileUri:t.url}}}if(t.source_type==="base64")return{inlineData:{mimeType:t.mime_type??"",data:t.data}};throw new Error(`Unsupported source type: ${t.source_type}`)},fromStandardAudioBlock(t){if(!n)throw new Error("This model does not support audio");if(t.source_type==="url"){const r=xl({dataUrl:t.url});return r?{inlineData:{mimeType:r.mime_type,data:r.data}}:{fileData:{mimeType:t.mime_type??"",fileUri:t.url}}}if(t.source_type==="base64")return{inlineData:{mimeType:t.mime_type??"",data:t.data}};throw new Error(`Unsupported source type: ${t.source_type}`)},fromStandardFileBlock(t){if(!n)throw new Error("This model does not support files");if(t.source_type==="text")return{text:t.text};if(t.source_type==="url"){const r=xl({dataUrl:t.url});return r?{inlineData:{mimeType:r.mime_type,data:r.data}}:{fileData:{mimeType:t.mime_type??"",fileUri:t.url}}}if(t.source_type==="base64")return{inlineData:{mimeType:t.mime_type??"",data:t.data}};throw new Error(`Unsupported source type: ${t.source_type}`)}}}function Z4(n,e){var t;if(Da(n))return rm(n,Eae(e));if(n.type==="text")return{text:n.text};if(n.type==="executableCode")return{executableCode:n.executableCode};if(n.type==="codeExecutionResult")return{codeExecutionResult:n.codeExecutionResult};if(n.type==="image_url"){if(!e)throw new Error("This model does not support images");let r;if(typeof n.image_url=="string")r=n.image_url;else if(typeof n.image_url=="object"&&"url"in n.image_url)r=n.image_url.url;else throw new Error("Please provide image as base64 encoded data URL");const[i,a]=r.split(",");if(!i.startsWith("data:"))throw new Error("Please provide image as base64 encoded data URL");const[s,o]=i.replace(/^data:/,"").split(";");if(o!=="base64")throw new Error("Please provide image as base64 encoded data URL");return{inlineData:{data:a,mimeType:s}}}else{if(n.type==="media")return bae(n);if(n.type==="tool_use")return{functionCall:{name:n.name,args:n.input}};if((t=n.type)!=null&&t.includes("/")&&n.type.split("/").length===2&&"data"in n&&typeof n.data=="string")return{inlineData:{mimeType:n.type,data:n.data}};if("functionCall"in n)return;throw"type"in n?new Error(`Unknown content type ${n.type}`):new Error(`Unknown content ${JSON.stringify(n)}`)}}function Sae(n,e,t){var a;if(Pp(n)){const s=n.name??wae(n,t);if(s===void 0)throw new Error(`Google requires a tool name for each tool call response, and we could not infer a called tool name for ToolMessage "${n.id}" from your passed messages. Please populate a "name" field on that ToolMessage explicitly.`);const o=Array.isArray(n.content)?n.content.map(u=>Z4(u,e)).filter(u=>u!==void 0):n.content;return n.status==="error"?[{functionResponse:{name:s,response:{error:{details:o}}}}]:[{functionResponse:{name:s,response:{result:o}}}]}let r=[];const i=[];return typeof n.content=="string"&&n.content&&i.push({text:n.content}),Array.isArray(n.content)&&i.push(...n.content.map(s=>Z4(s,e)).filter(s=>s!==void 0)),ua(n)&&((a=n.tool_calls)!=null&&a.length)&&(r=n.tool_calls.map(s=>({functionCall:{name:s.name,args:s.args}}))),[...i,...r]}function X4(n,e,t=!1){return n.reduce((r,i,a)=>{if(!Ln(i))throw new Error("Unsupported message input");const s=vae(i);if(s==="system"&&a!==0)throw new Error("System message should be the first one");const o=_ae(s),u=r.content[r.content.length];if(!r.mergeWithPreviousContent&&u&&u.role===o)throw new Error("Google Generative AI requires alternate messages between authors");const c=Sae(i,e,n.slice(0,a));if(r.mergeWithPreviousContent){const m=r.content[r.content.length-1];if(!m)throw new Error("There was a problem parsing your system message. Please try a prompt without one.");return m.parts.push(...c),{mergeWithPreviousContent:!1,content:r.content}}let d=o;(d==="function"||d==="system"&&!t)&&(d="user");const p={role:d,parts:c};return{mergeWithPreviousContent:s==="system"&&!t,content:[...r.content,p]}},{content:[],mergeWithPreviousContent:!1}).content}function Tae(n,e){var c,d,p;if(!n.candidates||n.candidates.length===0||!n.candidates[0])return{generations:[],llmOutput:{filters:n.promptFeedback}};const t=n.functionCalls(),[r]=n.candidates,{content:i,...a}=r;let s;Array.isArray(i==null?void 0:i.parts)&&i.parts.length===1&&i.parts[0].text?s=i.parts[0].text:Array.isArray(i==null?void 0:i.parts)&&i.parts.length>0?s=i.parts.map(m=>"text"in m?{type:"text",text:m.text}:"executableCode"in m?{type:"executableCode",executableCode:m.executableCode}:"codeExecutionResult"in m?{type:"codeExecutionResult",codeExecutionResult:m.codeExecutionResult}:m):s=[];let o="";if(typeof s=="string")o=s;else if(Array.isArray(s)&&s.length>0){const m=s.find(y=>"text"in y);o=(m==null?void 0:m.text)??o}return{generations:[{text:o,message:new bn({content:s??"",tool_calls:t==null?void 0:t.map(m=>({...m,type:"tool_call",id:"id"in m&&typeof m.id=="string"?m.id:pq()})),additional_kwargs:{...a},usage_metadata:e==null?void 0:e.usageMetadata}),generationInfo:a}],llmOutput:{tokenUsage:{promptTokens:(c=e==null?void 0:e.usageMetadata)==null?void 0:c.input_tokens,completionTokens:(d=e==null?void 0:e.usageMetadata)==null?void 0:d.output_tokens,totalTokens:(p=e==null?void 0:e.usageMetadata)==null?void 0:p.total_tokens}}}}function Aae(n,e){if(!n.candidates||n.candidates.length===0)return null;const t=n.functionCalls(),[r]=n.candidates,{content:i,...a}=r;let s;Array.isArray(i==null?void 0:i.parts)&&i.parts.every(c=>"text"in c)?s=i.parts.map(c=>c.text).join(""):Array.isArray(i==null?void 0:i.parts)?s=i.parts.map(c=>"text"in c?{type:"text",text:c.text}:"executableCode"in c?{type:"executableCode",executableCode:c.executableCode}:"codeExecutionResult"in c?{type:"codeExecutionResult",codeExecutionResult:c.codeExecutionResult}:c):s=[];let o="";if(s&&typeof s=="string")o=s;else if(Array.isArray(s)){const c=s.find(d=>"text"in d);o=(c==null?void 0:c.text)??""}const u=[];return t&&u.push(...t.map(c=>({...c,args:JSON.stringify(c.args),index:e.index,type:"tool_call_chunk",id:"id"in c&&typeof c.id=="string"?c.id:pq()}))),new ca({text:o,message:new Sn({content:s||"",name:i?i.role:void 0,tool_call_chunks:u,additional_kwargs:{},usage_metadata:e.usageMetadata}),generationInfo:a})}function Cae(n){return n.every(e=>"functionDeclarations"in e&&Array.isArray(e.functionDeclarations))?n:[{functionDeclarations:n.map(e=>{if(cc(e)){const t=Z1(e.schema);return t.type==="object"&&"properties"in t&&Object.keys(t.properties).length===0?{name:e.name,description:e.description}:{name:e.name,description:e.description,parameters:t}}return pd(e)?{name:e.function.name,description:e.function.description??"A function available to call.",parameters:hae(e.function.parameters)}:e})}]}class Q4 extends gb{static lc_name(){return"GoogleGenerativeAIToolsOutputParser"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","google_genai","output_parsers"]}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=e.keyName,this.returnSingle=e.returnSingle??this.returnSingle,this.zodSchema=e.zodSchema}async _validateResult(e){if(this.zodSchema===void 0)return e;const t=await H_(this.zodSchema,e);if(t.success)return t.data;throw new Na(`Failed to parse. Text: "${JSON.stringify(e,null,2)}". Error: ${JSON.stringify(t.error.issues)}`,JSON.stringify(e,null,2))}async parseResult(e){const t=e.flatMap(a=>{const{message:s}=a;return!("tool_calls"in s)||!Array.isArray(s.tool_calls)?[]:s.tool_calls});if(t[0]===void 0)throw new Error("No parseable tool calls provided to GoogleGenerativeAIToolsOutputParser.");const[r]=t;return await this._validateResult(r.args)}}function ej(n,e){const t=Rae(n),r=Pae(t,e);return{tools:t,toolConfig:r}}function Rae(n){let e=[];const t=[];return n.forEach(i=>{if(cc(i)){const[a]=Cae([i]);a.functionDeclarations&&e.push(...a.functionDeclarations)}else if(pd(i)){const{functionDeclarations:a}=Iae(i);if(a)e.push(...a);else throw new Error("Failed to convert OpenAI structured tool to GenerativeAI tool")}else t.push(i)}),t.find(i=>"functionDeclarations"in i)?t.map(i=>{if((e==null?void 0:e.length)>0&&"functionDeclarations"in i){const a={functionDeclarations:[...i.functionDeclarations||[],...e]};return e=[],a}return i}):[...t,...e.length>0?[{functionDeclarations:e}]:[]]}function Iae(n){return{functionDeclarations:[{name:n.function.name,description:n.function.description,parameters:Yu(n.function.parameters)}]}}function Pae(n,e){if(!n.length||!e)return;const{toolChoice:t,allowedFunctionNames:r}=e,i={any:xf.ANY,auto:xf.AUTO,none:xf.NONE};if(t&&["any","auto","none"].includes(t))return{functionCallingConfig:{mode:i[t]??"MODE_UNSPECIFIED",allowedFunctionNames:r}};if(typeof t=="string"||r)return{functionCallingConfig:{mode:xf.ANY,allowedFunctionNames:[...r??[],...t&&typeof t=="string"?[t]:[]]}}}class xae extends ui{static lc_name(){return"ChatGoogleGenerativeAI"}get lc_secrets(){return{apiKey:"GOOGLE_API_KEY"}}get lc_aliases(){return{apiKey:"google_api_key"}}get _isMultimodalModel(){return this.model.includes("vision")||this.model.startsWith("gemini-1.5")||this.model.startsWith("gemini-2")}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models","google_genai"]}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxOutputTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topK",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"safetySettings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"json",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamUsage",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"convertSystemMessageToHumanContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.model=e.model.replace(/^models\//,""),this.maxOutputTokens=e.maxOutputTokens??this.maxOutputTokens,this.maxOutputTokens&&this.maxOutputTokens<0)throw new Error("`maxOutputTokens` must be a positive integer");if(this.temperature=e.temperature??this.temperature,this.temperature&&(this.temperature<0||this.temperature>2))throw new Error("`temperature` must be in the range of [0.0,2.0]");if(this.topP=e.topP??this.topP,this.topP&&this.topP<0)throw new Error("`topP` must be a positive integer");if(this.topP&&this.topP>1)throw new Error("`topP` must be below 1.");if(this.topK=e.topK??this.topK,this.topK&&this.topK<0)throw new Error("`topK` must be a positive integer");if(this.stopSequences=e.stopSequences??this.stopSequences,this.apiKey=e.apiKey??Mi("GOOGLE_API_KEY"),!this.apiKey)throw new Error("Please set an API key for Google GenerativeAI in the environment variable GOOGLE_API_KEY or in the `apiKey` field of the ChatGoogleGenerativeAI constructor");if(this.safetySettings=e.safetySettings??this.safetySettings,this.safetySettings&&this.safetySettings.length>0&&new Set(this.safetySettings.map(r=>r.category)).size!==this.safetySettings.length)throw new Error("The categories in `safetySettings` array must be unique");this.streaming=e.streaming??this.streaming,this.json=e.json,this.client=new J4(this.apiKey).getGenerativeModel({model:this.model,safetySettings:this.safetySettings,generationConfig:{stopSequences:this.stopSequences,maxOutputTokens:this.maxOutputTokens,temperature:this.temperature,topP:this.topP,topK:this.topK,...this.json?{responseMimeType:"application/json"}:{}}},{apiVersion:e.apiVersion,baseUrl:e.baseUrl}),this.streamUsage=e.streamUsage??this.streamUsage}useCachedContent(e,t,r){this.apiKey&&(this.client=new J4(this.apiKey).getGenerativeModelFromCachedContent(e,t,r))}get useSystemInstruction(){return typeof this.convertSystemMessageToHumanContent=="boolean"?!this.convertSystemMessageToHumanContent:this.computeUseSystemInstruction}get computeUseSystemInstruction(){return this.model==="gemini-1.0-pro-001"||this.model.startsWith("gemini-pro-vision")||this.model.startsWith("gemini-1.0-pro-vision")?!1:this.model!=="gemini-pro"}getLsParams(e){return{ls_provider:"google_genai",ls_model_name:this.model,ls_model_type:"chat",ls_temperature:this.client.generationConfig.temperature,ls_max_tokens:this.client.generationConfig.maxOutputTokens,ls_stop:e.stop}}_combineLLMOutput(){return[]}_llmType(){return"googlegenerativeai"}bindTools(e,t){var r;return this.withConfig({tools:(r=ej(e))==null?void 0:r.tools,...t})}invocationParams(e){var r;const t=(r=e==null?void 0:e.tools)!=null&&r.length?ej(e.tools,{toolChoice:e.tool_choice,allowedFunctionNames:e.allowedFunctionNames}):void 0;return e!=null&&e.responseSchema?(this.client.generationConfig.responseSchema=e.responseSchema,this.client.generationConfig.responseMimeType="application/json"):(this.client.generationConfig.responseSchema=void 0,this.client.generationConfig.responseMimeType=this.json?"application/json":void 0),{...t!=null&&t.tools?{tools:t.tools}:{},...t!=null&&t.toolConfig?{toolConfig:t.toolConfig}:{}}}async _generate(e,t,r){var d,p,m;const i=X4(e,this._isMultimodalModel,this.useSystemInstruction);let a=i;if(i[0].role==="system"){const[y]=i;this.client.systemInstruction=y,a=i.slice(1)}const s=this.invocationParams(t);if(this.streaming){const y={},b=this._streamResponseChunks(e,t,r),w={};for await(const T of b){const C=((d=T.generationInfo)==null?void 0:d.completion)??0;w[C]===void 0?w[C]=T:w[C]=w[C].concat(T)}return{generations:Object.entries(w).sort(([T],[C])=>parseInt(T,10)-parseInt(C,10)).map(([T,C])=>C),llmOutput:{estimatedTokenUsage:y}}}const o=await this.completionWithRetry({...s,contents:a});let u;if("usageMetadata"in o.response){const y=o.response.usageMetadata;u={input_tokens:y.promptTokenCount??0,output_tokens:y.candidatesTokenCount??0,total_tokens:y.totalTokenCount??0}}const c=Tae(o.response,{usageMetadata:u});return((p=c.generations)==null?void 0:p.length)>0&&await(r==null?void 0:r.handleLLMNewToken(((m=c.generations[0])==null?void 0:m.text)??"")),c}async*_streamResponseChunks(e,t,r){const i=X4(e,this._isMultimodalModel,this.useSystemInstruction);let a=i;if(i[0].role==="system"){const[p]=i;this.client.systemInstruction=p,a=i.slice(1)}const o={...this.invocationParams(t),contents:a},u=await this.caller.callWithOptions({signal:t==null?void 0:t.signal},async()=>{const{stream:p}=await this.client.generateContentStream(o);return p});let c,d=0;for await(const p of u){if("usageMetadata"in p&&this.streamUsage!==!1&&t.streamUsage!==!1){const y=p.usageMetadata;if(!c)c={input_tokens:y.promptTokenCount??0,output_tokens:y.candidatesTokenCount??0,total_tokens:y.totalTokenCount??0};else{const b=(y.candidatesTokenCount??0)-c.output_tokens;c={input_tokens:0,output_tokens:b,total_tokens:b}}}const m=Aae(p,{usageMetadata:c,index:d});d+=1,m&&(yield m,await(r==null?void 0:r.handleLLMNewToken(m.text??"")))}}async completionWithRetry(e,t){return this.caller.callWithOptions({signal:t==null?void 0:t.signal},async()=>{var r;try{return await this.client.generateContent(e)}catch(i){throw(r=i.message)!=null&&r.includes("400 Bad Request")&&(i.status=400),i}})}withStructuredOutput(e,t){const r=e,i=t==null?void 0:t.name,a=t==null?void 0:t.method,s=t==null?void 0:t.includeRaw;if(a==="jsonMode")throw new Error('ChatGoogleGenerativeAI only supports "jsonSchema" or "functionCalling" as a method.');let o,u;if(a==="functionCalling"){let m=i??"extract",y;if(Pi(r)){const b=Z1(r);y=[{functionDeclarations:[{name:m,description:b.description??"A function available to call.",parameters:b}]}],u=new Q4({returnSingle:!0,keyName:m,zodSchema:r})}else{let b;typeof r.name=="string"&&typeof r.parameters=="object"&&r.parameters!=null?(b=r,b.parameters=Yu(r.parameters),m=r.name):b={name:m,description:r.description??"",parameters:Yu(r)},y=[{functionDeclarations:[b]}],u=new Q4({returnSingle:!0,keyName:m})}o=this.bindTools(y).withConfig({allowedFunctionNames:[m]})}else{const m=Z1(r);o=this.withConfig({responseSchema:m}),u=new i_}if(!s)return o.pipe(u).withConfig({runName:"ChatGoogleGenerativeAIStructuredOutput"});const c=ms.assign({parsed:(m,y)=>u.invoke(m.raw,y)}),d=ms.assign({parsed:()=>null}),p=c.withFallbacks({fallbacks:[d]});return vr.from([{raw:o},p]).withConfig({runName:"StructuredOutputRunnable"})}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let Oae,Nae;function kae(){return{geminiUrl:Oae,vertexUrl:Nae}}function Mae(n,e,t){var r,i,a;if(!(!((r=n.httpOptions)===null||r===void 0)&&r.baseUrl)){const s=kae();return n.vertexai?(i=s.vertexUrl)!==null&&i!==void 0?i:e:(a=s.geminiUrl)!==null&&a!==void 0?a:t}return n.httpOptions.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class _d{}function wt(n,e){const t=/\{([^}]+)\}/g;return n.replace(t,(r,i)=>{if(Object.prototype.hasOwnProperty.call(e,i)){const a=e[i];return a!=null?String(a):""}else throw new Error(`Key '${i}' not found in valueMap.`)})}function _(n,e,t){for(let a=0;a<e.length-1;a++){const s=e[a];if(s.endsWith("[]")){const o=s.slice(0,-2);if(!(o in n))if(Array.isArray(t))n[o]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${s}`);if(Array.isArray(n[o])){const u=n[o];if(Array.isArray(t))for(let c=0;c<u.length;c++){const d=u[c];_(d,e.slice(a+1),t[c])}else for(const c of u)_(c,e.slice(a+1),t)}return}else if(s.endsWith("[0]")){const o=s.slice(0,-3);o in n||(n[o]=[{}]);const u=n[o];_(u[0],e.slice(a+1),t);return}(!n[s]||typeof n[s]!="object")&&(n[s]={}),n=n[s]}const r=e[e.length-1],i=n[r];if(i!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===i)return;if(typeof i=="object"&&typeof t=="object"&&i!==null&&t!==null)Object.assign(i,t);else throw new Error(`Cannot set value for an existing key. Key: ${r}`)}else n[r]=t}function v(n,e){try{if(e.length===1&&e[0]==="_self")return n;for(let t=0;t<e.length;t++){if(typeof n!="object"||n===null)return;const r=e[t];if(r.endsWith("[]")){const i=r.slice(0,-2);if(i in n){const a=n[i];return Array.isArray(a)?a.map(s=>v(s,e.slice(t+1))):void 0}else return}else n=n[r]}return n}catch(t){if(t instanceof TypeError)return;throw t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var tj;(function(n){n.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",n.OUTCOME_OK="OUTCOME_OK",n.OUTCOME_FAILED="OUTCOME_FAILED",n.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(tj||(tj={}));var nj;(function(n){n.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",n.PYTHON="PYTHON"})(nj||(nj={}));var Fs;(function(n){n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT",n.NULL="NULL"})(Fs||(Fs={}));var rj;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY"})(rj||(rj={}));var ij;(function(n){n.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY"})(ij||(ij={}));var aj;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE",n.OFF="OFF"})(aj||(aj={}));var sj;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(sj||(sj={}));var oj;(function(n){n.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",n.NO_AUTH="NO_AUTH",n.API_KEY_AUTH="API_KEY_AUTH",n.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",n.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",n.OAUTH="OAUTH",n.OIDC_AUTH="OIDC_AUTH"})(oj||(oj={}));var lj;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.IMAGE_SAFETY="IMAGE_SAFETY",n.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL"})(lj||(lj={}));var uj;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(uj||(uj={}));var cj;(function(n){n.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",n.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",n.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",n.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",n.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(cj||(cj={}));var fj;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT"})(fj||(fj={}));var dj;(function(n){n.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",n.ON_DEMAND="ON_DEMAND",n.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(dj||(dj={}));var f_;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO"})(f_||(f_={}));var hj;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(hj||(hj={}));var X1;(function(n){n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(X1||(X1={}));var pj;(function(n){n.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",n.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",n.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",n.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",n.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",n.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",n.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(pj||(pj={}));var mj;(function(n){n.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",n.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",n.BALANCED="BALANCED",n.PRIORITIZE_COST="PRIORITIZE_COST"})(mj||(mj={}));var gj;(function(n){n.UNSPECIFIED="UNSPECIFIED",n.BLOCKING="BLOCKING",n.NON_BLOCKING="NON_BLOCKING"})(gj||(gj={}));var yj;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(yj||(yj={}));var vj;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE"})(vj||(vj={}));var _j;(function(n){n.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",n.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",n.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR"})(_j||(_j={}));var bj;(function(n){n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(bj||(bj={}));var wj;(function(n){n.DONT_ALLOW="DONT_ALLOW",n.ALLOW_ADULT="ALLOW_ADULT",n.ALLOW_ALL="ALLOW_ALL"})(wj||(wj={}));var Ej;(function(n){n.auto="auto",n.en="en",n.ja="ja",n.ko="ko",n.hi="hi"})(Ej||(Ej={}));var Sj;(function(n){n.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",n.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",n.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",n.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",n.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(Sj||(Sj={}));var Tj;(function(n){n.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",n.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",n.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",n.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(Tj||(Tj={}));var Aj;(function(n){n.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",n.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",n.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",n.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Aj||(Aj={}));var Cj;(function(n){n.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",n.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",n.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",n.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",n.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",n.EDIT_MODE_STYLE="EDIT_MODE_STYLE",n.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",n.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(Cj||(Cj={}));var Rj;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.PROCESSING="PROCESSING",n.ACTIVE="ACTIVE",n.FAILED="FAILED"})(Rj||(Rj={}));var Ij;(function(n){n.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",n.UPLOADED="UPLOADED",n.GENERATED="GENERATED"})(Ij||(Ij={}));var Pj;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.VIDEO="VIDEO",n.AUDIO="AUDIO",n.DOCUMENT="DOCUMENT"})(Pj||(Pj={}));var xj;(function(n){n.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",n.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",n.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(xj||(xj={}));var Oj;(function(n){n.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",n.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",n.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Oj||(Oj={}));var Nj;(function(n){n.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",n.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",n.NO_INTERRUPTION="NO_INTERRUPTION"})(Nj||(Nj={}));var kj;(function(n){n.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",n.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",n.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(kj||(kj={}));var Mj;(function(n){n.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",n.SILENT="SILENT",n.WHEN_IDLE="WHEN_IDLE",n.INTERRUPT="INTERRUPT"})(Mj||(Mj={}));var Dj;(function(n){n.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",n.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",n.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",n.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",n.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",n.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",n.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",n.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",n.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",n.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",n.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",n.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",n.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Dj||(Dj={}));var Of;(function(n){n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT"})(Of||(Of={}));class Q1{constructor(e){const t={};for(const r of e.headers.entries())t[r[0]]=r[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class $h{get text(){var e,t,r,i,a,s,o,u;if(((i=(r=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let c="",d=!1;const p=[];for(const m of(u=(o=(s=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||s===void 0?void 0:s.content)===null||o===void 0?void 0:o.parts)!==null&&u!==void 0?u:[]){for(const[y,b]of Object.entries(m))y!=="text"&&y!=="thought"&&(b!==null||b!==void 0)&&p.push(y);if(typeof m.text=="string"){if(typeof m.thought=="boolean"&&m.thought)continue;d=!0,c+=m.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),d?c:void 0}get data(){var e,t,r,i,a,s,o,u;if(((i=(r=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let c="";const d=[];for(const p of(u=(o=(s=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||s===void 0?void 0:s.content)===null||o===void 0?void 0:o.parts)!==null&&u!==void 0?u:[]){for(const[m,y]of Object.entries(p))m!=="inlineData"&&(y!==null||y!==void 0)&&d.push(m);p.inlineData&&typeof p.inlineData.data=="string"&&(c+=atob(p.inlineData.data))}return d.length>0&&console.warn(`there are non-data parts ${d} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),c.length>0?btoa(c):void 0}get functionCalls(){var e,t,r,i,a,s,o,u;if(((i=(r=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const c=(u=(o=(s=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||s===void 0?void 0:s.content)===null||o===void 0?void 0:o.parts)===null||u===void 0?void 0:u.filter(d=>d.functionCall).map(d=>d.functionCall).filter(d=>d!==void 0);if((c==null?void 0:c.length)!==0)return c}get executableCode(){var e,t,r,i,a,s,o,u,c;if(((i=(r=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const d=(u=(o=(s=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||s===void 0?void 0:s.content)===null||o===void 0?void 0:o.parts)===null||u===void 0?void 0:u.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if((d==null?void 0:d.length)!==0)return(c=d==null?void 0:d[0])===null||c===void 0?void 0:c.code}get codeExecutionResult(){var e,t,r,i,a,s,o,u,c;if(((i=(r=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||r===void 0?void 0:r.parts)===null||i===void 0?void 0:i.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const d=(u=(o=(s=(a=this.candidates)===null||a===void 0?void 0:a[0])===null||s===void 0?void 0:s.content)===null||o===void 0?void 0:o.parts)===null||u===void 0?void 0:u.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if((d==null?void 0:d.length)!==0)return(c=d==null?void 0:d[0])===null||c===void 0?void 0:c.output}}class $j{}class Lj{}class Dae{}class $ae{}class Uj{}class jj{}class Fj{}class Lae{}class Bj{}class qj{}class Vj{}class Uae{}class jae{}class Fae{}class Bae{get text(){var e,t,r;let i="",a=!1;const s=[];for(const o of(r=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&r!==void 0?r:[]){for(const[u,c]of Object.entries(o))u!=="text"&&u!=="thought"&&c!==null&&s.push(u);if(typeof o.text=="string"){if(typeof o.thought=="boolean"&&o.thought)continue;a=!0,i+=o.text}}return s.length>0&&console.warn(`there are non-text parts ${s} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),a?i:void 0}get data(){var e,t,r;let i="";const a=[];for(const s of(r=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&r!==void 0?r:[]){for(const[o,u]of Object.entries(s))o!=="inlineData"&&u!==null&&a.push(o);s.inlineData&&typeof s.inlineData.data=="string"&&(i+=atob(s.inlineData.data))}return a.length>0&&console.warn(`there are non-data parts ${a} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),i.length>0?btoa(i):void 0}}class qae{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Rn(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function mq(n,e){const t=Rn(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function gq(n){return Array.isArray(n)?n.map(e=>d_(e)):[d_(n)]}function d_(n){if(typeof n=="object"&&n!==null)return n;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof n}`)}function Vae(n){const e=d_(n);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function zae(n){const e=d_(n);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function zj(n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function yq(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(e=>zj(e)):[zj(n)]}function eR(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function Hj(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function Gj(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function ci(n){if(n==null)throw new Error("ContentUnion is required");return eR(n)?n:{role:"user",parts:yq(n)}}function vq(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const r=ci(t);return r.parts&&r.parts.length>0&&r.parts[0].text!==void 0?[r.parts[0].text]:[]});if(n.isVertexAI()){const t=ci(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>ci(t)):[ci(e)]}function cs(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n)){if(Hj(n)||Gj(n))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[ci(n)]}const e=[],t=[],r=eR(n[0]);for(const i of n){const a=eR(i);if(a!=r)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(a)e.push(i);else{if(Hj(i)||Gj(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(i)}}return r||e.push({role:"user",parts:yq(t)}),e}const Hae=new Set(["type","format","title","description","default","items","minItems","maxItems","enum","properties","required","minProperties","maxProperties","minimum","maximum","minLength","maxLength","pattern","anyOf","propertyOrdering"]),Wj=ds(["string","number","integer","object","array","boolean","null"]),Gae=An([Wj,Pt(Wj)]);function Wae(n=!0){const e=TG(()=>{const t=Xe({type:Gae.optional(),format:Me().optional(),title:Me().optional(),description:Me().optional(),default:Wu().optional(),items:e.optional(),minItems:Xc.string().optional(),maxItems:Xc.string().optional(),enum:Pt(Wu()).optional(),properties:ts(Me(),e).optional(),required:Pt(Me()).optional(),minProperties:Xc.string().optional(),maxProperties:Xc.string().optional(),propertyOrdering:Pt(Me()).optional(),minimum:zn().optional(),maximum:zn().optional(),minLength:Xc.string().optional(),maxLength:Xc.string().optional(),pattern:Me().optional(),anyOf:Pt(e).optional(),additionalProperties:qr().optional()});return n?t.strict():t});return e}function Kae(n,e){n.includes("null")&&(e.nullable=!0);const t=n.filter(r=>r!=="null");if(t.length===1)e.type=Object.values(Fs).includes(t[0].toUpperCase())?t[0].toUpperCase():Fs.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const r of t)e.anyOf.push({type:Object.values(Fs).includes(r.toUpperCase())?r.toUpperCase():Fs.TYPE_UNSPECIFIED})}}function Vf(n){const e={},t=["items"],r=["anyOf"],i=["properties"];if(n.type&&n.anyOf)throw new Error("type and anyOf cannot be both populated.");const a=n.anyOf;a!=null&&a.length==2&&(a[0].type==="null"?(e.nullable=!0,n=a[1]):a[1].type==="null"&&(e.nullable=!0,n=a[0])),n.type instanceof Array&&Kae(n.type,e);for(const[s,o]of Object.entries(n))if(o!=null)if(s=="type"){if(o==="null")throw new Error("type: null can not be the only possible type for the field.");if(o instanceof Array)continue;e.type=Object.values(Fs).includes(o.toUpperCase())?o.toUpperCase():Fs.TYPE_UNSPECIFIED}else if(t.includes(s))e[s]=Vf(o);else if(r.includes(s)){const u=[];for(const c of o){if(c.type=="null"){e.nullable=!0;continue}u.push(Vf(c))}e[s]=u}else if(i.includes(s)){const u={};for(const[c,d]of Object.entries(o))u[c]=Vf(d);e[s]=u}else{if(s==="additionalProperties")continue;e[s]=o}return e}function h_(n){if(Object.keys(n).includes("$schema")){delete n.$schema;const e=Wae().parse(n);return Vf(e)}else return Vf(n)}function _q(n){if(typeof n=="object")return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function uP(n){if("multiSpeakerVoiceConfig"in n)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return n}function Rm(n){if(n.functionDeclarations)for(const e of n.functionDeclarations)e.parameters&&(e.parameters=h_(e.parameters)),e.response&&(e.response=h_(e.response));return n}function Im(n){if(n==null)throw new Error("tools is required");if(!Array.isArray(n))throw new Error("tools is required and must be an array of Tools");const e=[];for(const t of n)e.push(t);return e}function Jae(n,e,t,r=1){const i=!e.startsWith(`${t}/`)&&e.split("/").length===r;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:i?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:i?`${t}/${e}`:e}function zl(n,e){if(typeof e!="string")throw new Error("name must be a string");return Jae(n,e,"cachedContents")}function bq(n){switch(n){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return n}}function qo(n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}function Yae(n){return n!=null&&typeof n=="object"&&"name"in n}function Zae(n){return n!=null&&typeof n=="object"&&"video"in n}function Xae(n){return n!=null&&typeof n=="object"&&"uri"in n}function wq(n){var e;let t;if(Yae(n)&&(t=n.name),!(Xae(n)&&(t=n.uri,t===void 0))&&!(Zae(n)&&(t=(e=n.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof n=="string"&&(t=n),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){const i=t.split("files/")[1].match(/[a-z0-9]+/);if(i===null)throw new Error(`Could not extract file name from URI ${t}`);t=i[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function Eq(n,e){let t;return n.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function Sq(n){for(const e of["models","tunedModels","publisherModels"])if(Qae(n,e))return n[e];return[]}function Qae(n,e){return n!==null&&typeof n=="object"&&e in n}function ese(n,e={}){const t=n,r={name:t.name,description:t.description,parameters:Vf(wb(t.inputSchema))};return e.behavior&&(r.behavior=e.behavior),{functionDeclarations:[r]}}function tse(n,e={}){const t=[],r=new Set;for(const i of n){const a=i.name;if(r.has(a))throw new Error(`Duplicate function name ${a} found in MCP tools. Please ensure function names are unique.`);r.add(a);const s=ese(i,e);s.functionDeclarations&&t.push(...s.functionDeclarations)}return{functionDeclarations:t}}function nse(n){const e=[];for(const t of n)e.push(wb(t));return e}function rse(n){const e={};for(const[t,r]of Object.entries(n)){const i=r;e[t]=wb(i)}return e}function wb(n){const e=new Set(["items"]),t=new Set(["anyOf"]),r=new Set(["properties"]),i={};for(const[a,s]of Object.entries(n))if(e.has(a))i[a]=wb(s);else if(t.has(a))i[a]=nse(s);else if(r.has(a))i[a]=rse(s);else if(a==="type"){const o=s.toUpperCase();i[a]=Object.values(Fs).includes(o)?o:Fs.TYPE_UNSPECIFIED}else Hae.has(a)&&(i[a]=s);return i}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ise(n){const e={},t=v(n,["fps"]);t!=null&&_(e,["fps"],t);const r=v(n,["endOffset"]);r!=null&&_(e,["endOffset"],r);const i=v(n,["startOffset"]);return i!=null&&_(e,["startOffset"],i),e}function ase(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["data"]);t!=null&&_(e,["data"],t);const r=v(n,["mimeType"]);return r!=null&&_(e,["mimeType"],r),e}function sse(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["fileUri"]);t!=null&&_(e,["fileUri"],t);const r=v(n,["mimeType"]);return r!=null&&_(e,["mimeType"],r),e}function ose(n){const e={},t=v(n,["videoMetadata"]);t!=null&&_(e,["videoMetadata"],ise(t));const r=v(n,["thought"]);r!=null&&_(e,["thought"],r);const i=v(n,["inlineData"]);i!=null&&_(e,["inlineData"],ase(i));const a=v(n,["fileData"]);a!=null&&_(e,["fileData"],sse(a));const s=v(n,["thoughtSignature"]);s!=null&&_(e,["thoughtSignature"],s);const o=v(n,["codeExecutionResult"]);o!=null&&_(e,["codeExecutionResult"],o);const u=v(n,["executableCode"]);u!=null&&_(e,["executableCode"],u);const c=v(n,["functionCall"]);c!=null&&_(e,["functionCall"],c);const d=v(n,["functionResponse"]);d!=null&&_(e,["functionResponse"],d);const p=v(n,["text"]);return p!=null&&_(e,["text"],p),e}function Kj(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>ose(a))),_(e,["parts"],i)}const r=v(n,["role"]);return r!=null&&_(e,["role"],r),e}function lse(n){const e={},t=v(n,["behavior"]);t!=null&&_(e,["behavior"],t);const r=v(n,["description"]);r!=null&&_(e,["description"],r);const i=v(n,["name"]);i!=null&&_(e,["name"],i);const a=v(n,["parameters"]);a!=null&&_(e,["parameters"],a);const s=v(n,["parametersJsonSchema"]);s!=null&&_(e,["parametersJsonSchema"],s);const o=v(n,["response"]);o!=null&&_(e,["response"],o);const u=v(n,["responseJsonSchema"]);return u!=null&&_(e,["responseJsonSchema"],u),e}function use(n){const e={},t=v(n,["startTime"]);t!=null&&_(e,["startTime"],t);const r=v(n,["endTime"]);return r!=null&&_(e,["endTime"],r),e}function cse(n){const e={},t=v(n,["timeRangeFilter"]);return t!=null&&_(e,["timeRangeFilter"],use(t)),e}function fse(n){const e={},t=v(n,["mode"]);t!=null&&_(e,["mode"],t);const r=v(n,["dynamicThreshold"]);return r!=null&&_(e,["dynamicThreshold"],r),e}function dse(n){const e={},t=v(n,["dynamicRetrievalConfig"]);return t!=null&&_(e,["dynamicRetrievalConfig"],fse(t)),e}function hse(){return{}}function pse(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(u=>lse(u))),_(e,["functionDeclarations"],o)}if(v(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=v(n,["googleSearch"]);r!=null&&_(e,["googleSearch"],cse(r));const i=v(n,["googleSearchRetrieval"]);if(i!=null&&_(e,["googleSearchRetrieval"],dse(i)),v(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(v(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");v(n,["urlContext"])!=null&&_(e,["urlContext"],hse());const s=v(n,["codeExecution"]);return s!=null&&_(e,["codeExecution"],s),e}function mse(n){const e={},t=v(n,["mode"]);t!=null&&_(e,["mode"],t);const r=v(n,["allowedFunctionNames"]);return r!=null&&_(e,["allowedFunctionNames"],r),e}function gse(n){const e={},t=v(n,["latitude"]);t!=null&&_(e,["latitude"],t);const r=v(n,["longitude"]);return r!=null&&_(e,["longitude"],r),e}function yse(n){const e={},t=v(n,["latLng"]);t!=null&&_(e,["latLng"],gse(t));const r=v(n,["languageCode"]);return r!=null&&_(e,["languageCode"],r),e}function vse(n){const e={},t=v(n,["functionCallingConfig"]);t!=null&&_(e,["functionCallingConfig"],mse(t));const r=v(n,["retrievalConfig"]);return r!=null&&_(e,["retrievalConfig"],yse(r)),e}function _se(n,e){const t={},r=v(n,["ttl"]);e!==void 0&&r!=null&&_(e,["ttl"],r);const i=v(n,["expireTime"]);e!==void 0&&i!=null&&_(e,["expireTime"],i);const a=v(n,["displayName"]);e!==void 0&&a!=null&&_(e,["displayName"],a);const s=v(n,["contents"]);if(e!==void 0&&s!=null){let d=cs(s);Array.isArray(d)&&(d=d.map(p=>Kj(p))),_(e,["contents"],d)}const o=v(n,["systemInstruction"]);e!==void 0&&o!=null&&_(e,["systemInstruction"],Kj(ci(o)));const u=v(n,["tools"]);if(e!==void 0&&u!=null){let d=u;Array.isArray(d)&&(d=d.map(p=>pse(p))),_(e,["tools"],d)}const c=v(n,["toolConfig"]);if(e!==void 0&&c!=null&&_(e,["toolConfig"],vse(c)),v(n,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function bse(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["model"],mq(n,r));const i=v(e,["config"]);return i!=null&&_(t,["config"],_se(i,t)),t}function wse(n,e){const t={},r=v(e,["name"]);r!=null&&_(t,["_url","name"],zl(n,r));const i=v(e,["config"]);return i!=null&&_(t,["config"],i),t}function Ese(n,e){const t={},r=v(e,["name"]);r!=null&&_(t,["_url","name"],zl(n,r));const i=v(e,["config"]);return i!=null&&_(t,["config"],i),t}function Sse(n,e){const t={},r=v(n,["ttl"]);e!==void 0&&r!=null&&_(e,["ttl"],r);const i=v(n,["expireTime"]);return e!==void 0&&i!=null&&_(e,["expireTime"],i),t}function Tse(n,e){const t={},r=v(e,["name"]);r!=null&&_(t,["_url","name"],zl(n,r));const i=v(e,["config"]);return i!=null&&_(t,["config"],Sse(i,t)),t}function Ase(n,e){const t={},r=v(n,["pageSize"]);e!==void 0&&r!=null&&_(e,["_query","pageSize"],r);const i=v(n,["pageToken"]);return e!==void 0&&i!=null&&_(e,["_query","pageToken"],i),t}function Cse(n){const e={},t=v(n,["config"]);return t!=null&&_(e,["config"],Ase(t,e)),e}function Rse(n){const e={},t=v(n,["fps"]);t!=null&&_(e,["fps"],t);const r=v(n,["endOffset"]);r!=null&&_(e,["endOffset"],r);const i=v(n,["startOffset"]);return i!=null&&_(e,["startOffset"],i),e}function Ise(n){const e={},t=v(n,["displayName"]);t!=null&&_(e,["displayName"],t);const r=v(n,["data"]);r!=null&&_(e,["data"],r);const i=v(n,["mimeType"]);return i!=null&&_(e,["mimeType"],i),e}function Pse(n){const e={},t=v(n,["displayName"]);t!=null&&_(e,["displayName"],t);const r=v(n,["fileUri"]);r!=null&&_(e,["fileUri"],r);const i=v(n,["mimeType"]);return i!=null&&_(e,["mimeType"],i),e}function xse(n){const e={},t=v(n,["videoMetadata"]);t!=null&&_(e,["videoMetadata"],Rse(t));const r=v(n,["thought"]);r!=null&&_(e,["thought"],r);const i=v(n,["inlineData"]);i!=null&&_(e,["inlineData"],Ise(i));const a=v(n,["fileData"]);a!=null&&_(e,["fileData"],Pse(a));const s=v(n,["thoughtSignature"]);s!=null&&_(e,["thoughtSignature"],s);const o=v(n,["codeExecutionResult"]);o!=null&&_(e,["codeExecutionResult"],o);const u=v(n,["executableCode"]);u!=null&&_(e,["executableCode"],u);const c=v(n,["functionCall"]);c!=null&&_(e,["functionCall"],c);const d=v(n,["functionResponse"]);d!=null&&_(e,["functionResponse"],d);const p=v(n,["text"]);return p!=null&&_(e,["text"],p),e}function Jj(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>xse(a))),_(e,["parts"],i)}const r=v(n,["role"]);return r!=null&&_(e,["role"],r),e}function Ose(n){const e={};if(v(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=v(n,["description"]);t!=null&&_(e,["description"],t);const r=v(n,["name"]);r!=null&&_(e,["name"],r);const i=v(n,["parameters"]);i!=null&&_(e,["parameters"],i);const a=v(n,["parametersJsonSchema"]);a!=null&&_(e,["parametersJsonSchema"],a);const s=v(n,["response"]);s!=null&&_(e,["response"],s);const o=v(n,["responseJsonSchema"]);return o!=null&&_(e,["responseJsonSchema"],o),e}function Nse(n){const e={},t=v(n,["startTime"]);t!=null&&_(e,["startTime"],t);const r=v(n,["endTime"]);return r!=null&&_(e,["endTime"],r),e}function kse(n){const e={},t=v(n,["timeRangeFilter"]);return t!=null&&_(e,["timeRangeFilter"],Nse(t)),e}function Mse(n){const e={},t=v(n,["mode"]);t!=null&&_(e,["mode"],t);const r=v(n,["dynamicThreshold"]);return r!=null&&_(e,["dynamicThreshold"],r),e}function Dse(n){const e={},t=v(n,["dynamicRetrievalConfig"]);return t!=null&&_(e,["dynamicRetrievalConfig"],Mse(t)),e}function $se(){return{}}function Lse(n){const e={},t=v(n,["apiKeyString"]);return t!=null&&_(e,["apiKeyString"],t),e}function Use(n){const e={},t=v(n,["apiKeyConfig"]);t!=null&&_(e,["apiKeyConfig"],Lse(t));const r=v(n,["authType"]);r!=null&&_(e,["authType"],r);const i=v(n,["googleServiceAccountConfig"]);i!=null&&_(e,["googleServiceAccountConfig"],i);const a=v(n,["httpBasicAuthConfig"]);a!=null&&_(e,["httpBasicAuthConfig"],a);const s=v(n,["oauthConfig"]);s!=null&&_(e,["oauthConfig"],s);const o=v(n,["oidcConfig"]);return o!=null&&_(e,["oidcConfig"],o),e}function jse(n){const e={},t=v(n,["authConfig"]);return t!=null&&_(e,["authConfig"],Use(t)),e}function Fse(){return{}}function Bse(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(p=>Ose(p))),_(e,["functionDeclarations"],d)}const r=v(n,["retrieval"]);r!=null&&_(e,["retrieval"],r);const i=v(n,["googleSearch"]);i!=null&&_(e,["googleSearch"],kse(i));const a=v(n,["googleSearchRetrieval"]);a!=null&&_(e,["googleSearchRetrieval"],Dse(a)),v(n,["enterpriseWebSearch"])!=null&&_(e,["enterpriseWebSearch"],$se());const o=v(n,["googleMaps"]);o!=null&&_(e,["googleMaps"],jse(o)),v(n,["urlContext"])!=null&&_(e,["urlContext"],Fse());const c=v(n,["codeExecution"]);return c!=null&&_(e,["codeExecution"],c),e}function qse(n){const e={},t=v(n,["mode"]);t!=null&&_(e,["mode"],t);const r=v(n,["allowedFunctionNames"]);return r!=null&&_(e,["allowedFunctionNames"],r),e}function Vse(n){const e={},t=v(n,["latitude"]);t!=null&&_(e,["latitude"],t);const r=v(n,["longitude"]);return r!=null&&_(e,["longitude"],r),e}function zse(n){const e={},t=v(n,["latLng"]);t!=null&&_(e,["latLng"],Vse(t));const r=v(n,["languageCode"]);return r!=null&&_(e,["languageCode"],r),e}function Hse(n){const e={},t=v(n,["functionCallingConfig"]);t!=null&&_(e,["functionCallingConfig"],qse(t));const r=v(n,["retrievalConfig"]);return r!=null&&_(e,["retrievalConfig"],zse(r)),e}function Gse(n,e){const t={},r=v(n,["ttl"]);e!==void 0&&r!=null&&_(e,["ttl"],r);const i=v(n,["expireTime"]);e!==void 0&&i!=null&&_(e,["expireTime"],i);const a=v(n,["displayName"]);e!==void 0&&a!=null&&_(e,["displayName"],a);const s=v(n,["contents"]);if(e!==void 0&&s!=null){let p=cs(s);Array.isArray(p)&&(p=p.map(m=>Jj(m))),_(e,["contents"],p)}const o=v(n,["systemInstruction"]);e!==void 0&&o!=null&&_(e,["systemInstruction"],Jj(ci(o)));const u=v(n,["tools"]);if(e!==void 0&&u!=null){let p=u;Array.isArray(p)&&(p=p.map(m=>Bse(m))),_(e,["tools"],p)}const c=v(n,["toolConfig"]);e!==void 0&&c!=null&&_(e,["toolConfig"],Hse(c));const d=v(n,["kmsKeyName"]);return e!==void 0&&d!=null&&_(e,["encryption_spec","kmsKeyName"],d),t}function Wse(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["model"],mq(n,r));const i=v(e,["config"]);return i!=null&&_(t,["config"],Gse(i,t)),t}function Kse(n,e){const t={},r=v(e,["name"]);r!=null&&_(t,["_url","name"],zl(n,r));const i=v(e,["config"]);return i!=null&&_(t,["config"],i),t}function Jse(n,e){const t={},r=v(e,["name"]);r!=null&&_(t,["_url","name"],zl(n,r));const i=v(e,["config"]);return i!=null&&_(t,["config"],i),t}function Yse(n,e){const t={},r=v(n,["ttl"]);e!==void 0&&r!=null&&_(e,["ttl"],r);const i=v(n,["expireTime"]);return e!==void 0&&i!=null&&_(e,["expireTime"],i),t}function Zse(n,e){const t={},r=v(e,["name"]);r!=null&&_(t,["_url","name"],zl(n,r));const i=v(e,["config"]);return i!=null&&_(t,["config"],Yse(i,t)),t}function Xse(n,e){const t={},r=v(n,["pageSize"]);e!==void 0&&r!=null&&_(e,["_query","pageSize"],r);const i=v(n,["pageToken"]);return e!==void 0&&i!=null&&_(e,["_query","pageToken"],i),t}function Qse(n){const e={},t=v(n,["config"]);return t!=null&&_(e,["config"],Xse(t,e)),e}function cv(n){const e={},t=v(n,["name"]);t!=null&&_(e,["name"],t);const r=v(n,["displayName"]);r!=null&&_(e,["displayName"],r);const i=v(n,["model"]);i!=null&&_(e,["model"],i);const a=v(n,["createTime"]);a!=null&&_(e,["createTime"],a);const s=v(n,["updateTime"]);s!=null&&_(e,["updateTime"],s);const o=v(n,["expireTime"]);o!=null&&_(e,["expireTime"],o);const u=v(n,["usageMetadata"]);return u!=null&&_(e,["usageMetadata"],u),e}function eoe(){return{}}function toe(n){const e={},t=v(n,["nextPageToken"]);t!=null&&_(e,["nextPageToken"],t);const r=v(n,["cachedContents"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(a=>cv(a))),_(e,["cachedContents"],i)}return e}function fv(n){const e={},t=v(n,["name"]);t!=null&&_(e,["name"],t);const r=v(n,["displayName"]);r!=null&&_(e,["displayName"],r);const i=v(n,["model"]);i!=null&&_(e,["model"],i);const a=v(n,["createTime"]);a!=null&&_(e,["createTime"],a);const s=v(n,["updateTime"]);s!=null&&_(e,["updateTime"],s);const o=v(n,["expireTime"]);o!=null&&_(e,["expireTime"],o);const u=v(n,["usageMetadata"]);return u!=null&&_(e,["usageMetadata"],u),e}function noe(){return{}}function roe(n){const e={},t=v(n,["nextPageToken"]);t!=null&&_(e,["nextPageToken"],t);const r=v(n,["cachedContents"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(a=>fv(a))),_(e,["cachedContents"],i)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var rd;(function(n){n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents"})(rd||(rd={}));class Eb{constructor(e,t,r,i){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,r,i)}init(e,t,r){var i,a;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.idxInternal=0;let s={config:{}};r?typeof r=="object"?s=Object.assign({},r):s=r:s={config:{}},s.config&&(s.config.pageToken=t.nextPageToken),this.paramsInternal=s,this.pageInternalSize=(a=(i=s.config)===null||i===void 0?void 0:i.pageSize)!==null&&a!==void 0?a:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ioe extends _d{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Eb(rd.PAGED_ITEM_CACHED_CONTENTS,r=>this.listInternal(r),await this.listInternal(t),t)}async create(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=Wse(this.apiClient,e);return o=wt("cachedContents",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>fv(d))}else{const c=bse(this.apiClient,e);return o=wt("cachedContents",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>cv(d))}}async get(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=Kse(this.apiClient,e);return o=wt("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>fv(d))}else{const c=wse(this.apiClient,e);return o=wt("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>cv(d))}}async delete(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=Jse(this.apiClient,e);return o=wt("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(()=>{const d=noe(),p=new qj;return Object.assign(p,d),p})}else{const c=Ese(this.apiClient,e);return o=wt("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(()=>{const d=eoe(),p=new qj;return Object.assign(p,d),p})}}async update(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=Zse(this.apiClient,e);return o=wt("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>fv(d))}else{const c=Tse(this.apiClient,e);return o=wt("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>cv(d))}}async listInternal(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=Qse(e);return o=wt("cachedContents",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>{const p=roe(d),m=new Vj;return Object.assign(m,p),m})}else{const c=Cse(e);return o=wt("cachedContents",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>{const p=toe(d),m=new Vj;return Object.assign(m,p),m})}}}function Yj(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],r=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&r>=n.length&&(n=void 0),{value:n&&n[r++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function In(n){return this instanceof In?(this.v=n,this):new In(n)}function zf(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),i,a=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),o("next"),o("throw"),o("return",s),i[Symbol.asyncIterator]=function(){return this},i;function s(y){return function(b){return Promise.resolve(b).then(y,p)}}function o(y,b){r[y]&&(i[y]=function(w){return new Promise(function(S,T){a.push([y,w,S,T])>1||u(y,w)})},b&&(i[y]=b(i[y])))}function u(y,b){try{c(r[y](b))}catch(w){m(a[0][3],w)}}function c(y){y.value instanceof In?Promise.resolve(y.value.v).then(d,p):m(a[0][2],y)}function d(y){u("next",y)}function p(y){u("throw",y)}function m(y,b){y(b),a.shift(),a.length&&u(a[0][0],a[0][1])}}function vp(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof Yj=="function"?Yj(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(a){t[a]=n[a]&&function(s){return new Promise(function(o,u){s=n[a](s),i(o,u,s.done,s.value)})}}function i(a,s,o,u){Promise.resolve(u).then(function(c){a({value:c,done:o})},s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function aoe(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;const t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:Tq(t)}function Tq(n){if(n.parts===void 0||n.parts.length===0)return!1;for(const e of n.parts)if(e===void 0||Object.keys(e).length===0||!e.thought&&e.text!==void 0&&e.text==="")return!1;return!0}function soe(n){if(n.length!==0){for(const e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function Zj(n){if(n===void 0||n.length===0)return[];const e=[],t=n.length;let r=0;for(;r<t;)if(n[r].role==="user")e.push(n[r]),r++;else{const i=[];let a=!0;for(;r<t&&n[r].role==="model";)i.push(n[r]),a&&!Tq(n[r])&&(a=!1),r++;a?e.push(...i):e.pop()}return e}class ooe{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new loe(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class loe{constructor(e,t,r,i={},a=[]){this.apiClient=e,this.modelsModule=t,this.model=r,this.config=i,this.history=a,this.sendPromise=Promise.resolve(),soe(a)}async sendMessage(e){var t;await this.sendPromise;const r=ci(e.message),i=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(r),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var a,s,o;const u=await i,c=(s=(a=u.candidates)===null||a===void 0?void 0:a[0])===null||s===void 0?void 0:s.content,d=u.automaticFunctionCallingHistory,p=this.getHistory(!0).length;let m=[];d!=null&&(m=(o=d.slice(p))!==null&&o!==void 0?o:[]);const y=c?[c]:[];this.recordHistory(r,y,m)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),i}async sendMessageStream(e){var t;await this.sendPromise;const r=ci(e.message),i=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(r),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=i.then(()=>{}).catch(()=>{});const a=await i;return this.processStreamResponse(a,r)}getHistory(e=!1){const t=e?Zj(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){var r,i;return zf(this,arguments,function*(){var s,o,u,c;const d=[];try{for(var p=!0,m=vp(e),y;y=yield In(m.next()),s=y.done,!s;p=!0){c=y.value,p=!1;const b=c;if(aoe(b)){const w=(i=(r=b.candidates)===null||r===void 0?void 0:r[0])===null||i===void 0?void 0:i.content;w!==void 0&&d.push(w)}yield yield In(b)}}catch(b){o={error:b}}finally{try{!p&&!s&&(u=m.return)&&(yield In(u.call(m)))}finally{if(o)throw o.error}}this.recordHistory(t,d)})}recordHistory(e,t,r){let i=[];t.length>0&&t.every(a=>a.role!==void 0)?i=t:i.push({role:"model",parts:[]}),r&&r.length>0?this.history.push(...Zj(r)):this.history.push(e),this.history.push(...i)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Sb extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Sb.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function uoe(n,e){const t={},r=v(n,["pageSize"]);e!==void 0&&r!=null&&_(e,["_query","pageSize"],r);const i=v(n,["pageToken"]);return e!==void 0&&i!=null&&_(e,["_query","pageToken"],i),t}function coe(n){const e={},t=v(n,["config"]);return t!=null&&_(e,["config"],uoe(t,e)),e}function foe(n){const e={},t=v(n,["details"]);t!=null&&_(e,["details"],t);const r=v(n,["message"]);r!=null&&_(e,["message"],r);const i=v(n,["code"]);return i!=null&&_(e,["code"],i),e}function doe(n){const e={},t=v(n,["name"]);t!=null&&_(e,["name"],t);const r=v(n,["displayName"]);r!=null&&_(e,["displayName"],r);const i=v(n,["mimeType"]);i!=null&&_(e,["mimeType"],i);const a=v(n,["sizeBytes"]);a!=null&&_(e,["sizeBytes"],a);const s=v(n,["createTime"]);s!=null&&_(e,["createTime"],s);const o=v(n,["expirationTime"]);o!=null&&_(e,["expirationTime"],o);const u=v(n,["updateTime"]);u!=null&&_(e,["updateTime"],u);const c=v(n,["sha256Hash"]);c!=null&&_(e,["sha256Hash"],c);const d=v(n,["uri"]);d!=null&&_(e,["uri"],d);const p=v(n,["downloadUri"]);p!=null&&_(e,["downloadUri"],p);const m=v(n,["state"]);m!=null&&_(e,["state"],m);const y=v(n,["source"]);y!=null&&_(e,["source"],y);const b=v(n,["videoMetadata"]);b!=null&&_(e,["videoMetadata"],b);const w=v(n,["error"]);return w!=null&&_(e,["error"],foe(w)),e}function hoe(n){const e={},t=v(n,["file"]);t!=null&&_(e,["file"],doe(t));const r=v(n,["config"]);return r!=null&&_(e,["config"],r),e}function poe(n){const e={},t=v(n,["name"]);t!=null&&_(e,["_url","file"],wq(t));const r=v(n,["config"]);return r!=null&&_(e,["config"],r),e}function moe(n){const e={},t=v(n,["name"]);t!=null&&_(e,["_url","file"],wq(t));const r=v(n,["config"]);return r!=null&&_(e,["config"],r),e}function goe(n){const e={},t=v(n,["details"]);t!=null&&_(e,["details"],t);const r=v(n,["message"]);r!=null&&_(e,["message"],r);const i=v(n,["code"]);return i!=null&&_(e,["code"],i),e}function tR(n){const e={},t=v(n,["name"]);t!=null&&_(e,["name"],t);const r=v(n,["displayName"]);r!=null&&_(e,["displayName"],r);const i=v(n,["mimeType"]);i!=null&&_(e,["mimeType"],i);const a=v(n,["sizeBytes"]);a!=null&&_(e,["sizeBytes"],a);const s=v(n,["createTime"]);s!=null&&_(e,["createTime"],s);const o=v(n,["expirationTime"]);o!=null&&_(e,["expirationTime"],o);const u=v(n,["updateTime"]);u!=null&&_(e,["updateTime"],u);const c=v(n,["sha256Hash"]);c!=null&&_(e,["sha256Hash"],c);const d=v(n,["uri"]);d!=null&&_(e,["uri"],d);const p=v(n,["downloadUri"]);p!=null&&_(e,["downloadUri"],p);const m=v(n,["state"]);m!=null&&_(e,["state"],m);const y=v(n,["source"]);y!=null&&_(e,["source"],y);const b=v(n,["videoMetadata"]);b!=null&&_(e,["videoMetadata"],b);const w=v(n,["error"]);return w!=null&&_(e,["error"],goe(w)),e}function yoe(n){const e={},t=v(n,["nextPageToken"]);t!=null&&_(e,["nextPageToken"],t);const r=v(n,["files"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(a=>tR(a))),_(e,["files"],i)}return e}function voe(){return{}}function _oe(){return{}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class boe extends _d{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Eb(rd.PAGED_ITEM_FILES,r=>this.listInternal(r),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>tR(t))}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,r;let i,a="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=coe(e);return a=wt("files",o._url),s=o._query,delete o.config,delete o._url,delete o._query,i=this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),i.then(u=>{const c=yoe(u),d=new Uae;return Object.assign(d,c),d})}}async createInternal(e){var t,r;let i,a="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=hoe(e);return a=wt("upload/v1beta/files",o._url),s=o._query,delete o.config,delete o._url,delete o._query,i=this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),i.then(()=>{const u=voe(),c=new jae;return Object.assign(c,u),c})}}async get(e){var t,r;let i,a="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=poe(e);return a=wt("files/{file}",o._url),s=o._query,delete o.config,delete o._url,delete o._query,i=this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),i.then(u=>tR(u))}}async delete(e){var t,r;let i,a="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=moe(e);return a=wt("files/{file}",o._url),s=o._query,delete o.config,delete o._url,delete o._query,i=this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),i.then(()=>{const u=_oe(),c=new Fae;return Object.assign(c,u),c})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function woe(n){const e={},t=v(n,["voiceName"]);return t!=null&&_(e,["voiceName"],t),e}function Eoe(n){const e={},t=v(n,["voiceName"]);return t!=null&&_(e,["voiceName"],t),e}function Aq(n){const e={},t=v(n,["prebuiltVoiceConfig"]);return t!=null&&_(e,["prebuiltVoiceConfig"],woe(t)),e}function Soe(n){const e={},t=v(n,["prebuiltVoiceConfig"]);return t!=null&&_(e,["prebuiltVoiceConfig"],Eoe(t)),e}function Toe(n){const e={},t=v(n,["speaker"]);t!=null&&_(e,["speaker"],t);const r=v(n,["voiceConfig"]);return r!=null&&_(e,["voiceConfig"],Aq(r)),e}function Aoe(n){const e={},t=v(n,["speakerVoiceConfigs"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>Toe(i))),_(e,["speakerVoiceConfigs"],r)}return e}function Coe(n){const e={},t=v(n,["voiceConfig"]);t!=null&&_(e,["voiceConfig"],Aq(t));const r=v(n,["multiSpeakerVoiceConfig"]);r!=null&&_(e,["multiSpeakerVoiceConfig"],Aoe(r));const i=v(n,["languageCode"]);return i!=null&&_(e,["languageCode"],i),e}function Roe(n){const e={},t=v(n,["voiceConfig"]);if(t!=null&&_(e,["voiceConfig"],Soe(t)),v(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const r=v(n,["languageCode"]);return r!=null&&_(e,["languageCode"],r),e}function Ioe(n){const e={},t=v(n,["fps"]);t!=null&&_(e,["fps"],t);const r=v(n,["endOffset"]);r!=null&&_(e,["endOffset"],r);const i=v(n,["startOffset"]);return i!=null&&_(e,["startOffset"],i),e}function Poe(n){const e={},t=v(n,["fps"]);t!=null&&_(e,["fps"],t);const r=v(n,["endOffset"]);r!=null&&_(e,["endOffset"],r);const i=v(n,["startOffset"]);return i!=null&&_(e,["startOffset"],i),e}function xoe(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["data"]);t!=null&&_(e,["data"],t);const r=v(n,["mimeType"]);return r!=null&&_(e,["mimeType"],r),e}function Ooe(n){const e={},t=v(n,["displayName"]);t!=null&&_(e,["displayName"],t);const r=v(n,["data"]);r!=null&&_(e,["data"],r);const i=v(n,["mimeType"]);return i!=null&&_(e,["mimeType"],i),e}function Noe(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["fileUri"]);t!=null&&_(e,["fileUri"],t);const r=v(n,["mimeType"]);return r!=null&&_(e,["mimeType"],r),e}function koe(n){const e={},t=v(n,["displayName"]);t!=null&&_(e,["displayName"],t);const r=v(n,["fileUri"]);r!=null&&_(e,["fileUri"],r);const i=v(n,["mimeType"]);return i!=null&&_(e,["mimeType"],i),e}function Moe(n){const e={},t=v(n,["videoMetadata"]);t!=null&&_(e,["videoMetadata"],Ioe(t));const r=v(n,["thought"]);r!=null&&_(e,["thought"],r);const i=v(n,["inlineData"]);i!=null&&_(e,["inlineData"],xoe(i));const a=v(n,["fileData"]);a!=null&&_(e,["fileData"],Noe(a));const s=v(n,["thoughtSignature"]);s!=null&&_(e,["thoughtSignature"],s);const o=v(n,["codeExecutionResult"]);o!=null&&_(e,["codeExecutionResult"],o);const u=v(n,["executableCode"]);u!=null&&_(e,["executableCode"],u);const c=v(n,["functionCall"]);c!=null&&_(e,["functionCall"],c);const d=v(n,["functionResponse"]);d!=null&&_(e,["functionResponse"],d);const p=v(n,["text"]);return p!=null&&_(e,["text"],p),e}function Doe(n){const e={},t=v(n,["videoMetadata"]);t!=null&&_(e,["videoMetadata"],Poe(t));const r=v(n,["thought"]);r!=null&&_(e,["thought"],r);const i=v(n,["inlineData"]);i!=null&&_(e,["inlineData"],Ooe(i));const a=v(n,["fileData"]);a!=null&&_(e,["fileData"],koe(a));const s=v(n,["thoughtSignature"]);s!=null&&_(e,["thoughtSignature"],s);const o=v(n,["codeExecutionResult"]);o!=null&&_(e,["codeExecutionResult"],o);const u=v(n,["executableCode"]);u!=null&&_(e,["executableCode"],u);const c=v(n,["functionCall"]);c!=null&&_(e,["functionCall"],c);const d=v(n,["functionResponse"]);d!=null&&_(e,["functionResponse"],d);const p=v(n,["text"]);return p!=null&&_(e,["text"],p),e}function $oe(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>Moe(a))),_(e,["parts"],i)}const r=v(n,["role"]);return r!=null&&_(e,["role"],r),e}function Loe(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>Doe(a))),_(e,["parts"],i)}const r=v(n,["role"]);return r!=null&&_(e,["role"],r),e}function Uoe(n){const e={},t=v(n,["behavior"]);t!=null&&_(e,["behavior"],t);const r=v(n,["description"]);r!=null&&_(e,["description"],r);const i=v(n,["name"]);i!=null&&_(e,["name"],i);const a=v(n,["parameters"]);a!=null&&_(e,["parameters"],a);const s=v(n,["parametersJsonSchema"]);s!=null&&_(e,["parametersJsonSchema"],s);const o=v(n,["response"]);o!=null&&_(e,["response"],o);const u=v(n,["responseJsonSchema"]);return u!=null&&_(e,["responseJsonSchema"],u),e}function joe(n){const e={};if(v(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=v(n,["description"]);t!=null&&_(e,["description"],t);const r=v(n,["name"]);r!=null&&_(e,["name"],r);const i=v(n,["parameters"]);i!=null&&_(e,["parameters"],i);const a=v(n,["parametersJsonSchema"]);a!=null&&_(e,["parametersJsonSchema"],a);const s=v(n,["response"]);s!=null&&_(e,["response"],s);const o=v(n,["responseJsonSchema"]);return o!=null&&_(e,["responseJsonSchema"],o),e}function Foe(n){const e={},t=v(n,["startTime"]);t!=null&&_(e,["startTime"],t);const r=v(n,["endTime"]);return r!=null&&_(e,["endTime"],r),e}function Boe(n){const e={},t=v(n,["startTime"]);t!=null&&_(e,["startTime"],t);const r=v(n,["endTime"]);return r!=null&&_(e,["endTime"],r),e}function qoe(n){const e={},t=v(n,["timeRangeFilter"]);return t!=null&&_(e,["timeRangeFilter"],Foe(t)),e}function Voe(n){const e={},t=v(n,["timeRangeFilter"]);return t!=null&&_(e,["timeRangeFilter"],Boe(t)),e}function zoe(n){const e={},t=v(n,["mode"]);t!=null&&_(e,["mode"],t);const r=v(n,["dynamicThreshold"]);return r!=null&&_(e,["dynamicThreshold"],r),e}function Hoe(n){const e={},t=v(n,["mode"]);t!=null&&_(e,["mode"],t);const r=v(n,["dynamicThreshold"]);return r!=null&&_(e,["dynamicThreshold"],r),e}function Goe(n){const e={},t=v(n,["dynamicRetrievalConfig"]);return t!=null&&_(e,["dynamicRetrievalConfig"],zoe(t)),e}function Woe(n){const e={},t=v(n,["dynamicRetrievalConfig"]);return t!=null&&_(e,["dynamicRetrievalConfig"],Hoe(t)),e}function Koe(){return{}}function Joe(n){const e={},t=v(n,["apiKeyString"]);return t!=null&&_(e,["apiKeyString"],t),e}function Yoe(n){const e={},t=v(n,["apiKeyConfig"]);t!=null&&_(e,["apiKeyConfig"],Joe(t));const r=v(n,["authType"]);r!=null&&_(e,["authType"],r);const i=v(n,["googleServiceAccountConfig"]);i!=null&&_(e,["googleServiceAccountConfig"],i);const a=v(n,["httpBasicAuthConfig"]);a!=null&&_(e,["httpBasicAuthConfig"],a);const s=v(n,["oauthConfig"]);s!=null&&_(e,["oauthConfig"],s);const o=v(n,["oidcConfig"]);return o!=null&&_(e,["oidcConfig"],o),e}function Zoe(n){const e={},t=v(n,["authConfig"]);return t!=null&&_(e,["authConfig"],Yoe(t)),e}function Xoe(){return{}}function Qoe(){return{}}function ele(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(u=>Uoe(u))),_(e,["functionDeclarations"],o)}if(v(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=v(n,["googleSearch"]);r!=null&&_(e,["googleSearch"],qoe(r));const i=v(n,["googleSearchRetrieval"]);if(i!=null&&_(e,["googleSearchRetrieval"],Goe(i)),v(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(v(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");v(n,["urlContext"])!=null&&_(e,["urlContext"],Xoe());const s=v(n,["codeExecution"]);return s!=null&&_(e,["codeExecution"],s),e}function tle(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(p=>joe(p))),_(e,["functionDeclarations"],d)}const r=v(n,["retrieval"]);r!=null&&_(e,["retrieval"],r);const i=v(n,["googleSearch"]);i!=null&&_(e,["googleSearch"],Voe(i));const a=v(n,["googleSearchRetrieval"]);a!=null&&_(e,["googleSearchRetrieval"],Woe(a)),v(n,["enterpriseWebSearch"])!=null&&_(e,["enterpriseWebSearch"],Koe());const o=v(n,["googleMaps"]);o!=null&&_(e,["googleMaps"],Zoe(o)),v(n,["urlContext"])!=null&&_(e,["urlContext"],Qoe());const c=v(n,["codeExecution"]);return c!=null&&_(e,["codeExecution"],c),e}function nle(n){const e={},t=v(n,["handle"]);if(t!=null&&_(e,["handle"],t),v(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function rle(n){const e={},t=v(n,["handle"]);t!=null&&_(e,["handle"],t);const r=v(n,["transparent"]);return r!=null&&_(e,["transparent"],r),e}function Xj(){return{}}function Qj(){return{}}function ile(n){const e={},t=v(n,["disabled"]);t!=null&&_(e,["disabled"],t);const r=v(n,["startOfSpeechSensitivity"]);r!=null&&_(e,["startOfSpeechSensitivity"],r);const i=v(n,["endOfSpeechSensitivity"]);i!=null&&_(e,["endOfSpeechSensitivity"],i);const a=v(n,["prefixPaddingMs"]);a!=null&&_(e,["prefixPaddingMs"],a);const s=v(n,["silenceDurationMs"]);return s!=null&&_(e,["silenceDurationMs"],s),e}function ale(n){const e={},t=v(n,["disabled"]);t!=null&&_(e,["disabled"],t);const r=v(n,["startOfSpeechSensitivity"]);r!=null&&_(e,["startOfSpeechSensitivity"],r);const i=v(n,["endOfSpeechSensitivity"]);i!=null&&_(e,["endOfSpeechSensitivity"],i);const a=v(n,["prefixPaddingMs"]);a!=null&&_(e,["prefixPaddingMs"],a);const s=v(n,["silenceDurationMs"]);return s!=null&&_(e,["silenceDurationMs"],s),e}function sle(n){const e={},t=v(n,["automaticActivityDetection"]);t!=null&&_(e,["automaticActivityDetection"],ile(t));const r=v(n,["activityHandling"]);r!=null&&_(e,["activityHandling"],r);const i=v(n,["turnCoverage"]);return i!=null&&_(e,["turnCoverage"],i),e}function ole(n){const e={},t=v(n,["automaticActivityDetection"]);t!=null&&_(e,["automaticActivityDetection"],ale(t));const r=v(n,["activityHandling"]);r!=null&&_(e,["activityHandling"],r);const i=v(n,["turnCoverage"]);return i!=null&&_(e,["turnCoverage"],i),e}function lle(n){const e={},t=v(n,["targetTokens"]);return t!=null&&_(e,["targetTokens"],t),e}function ule(n){const e={},t=v(n,["targetTokens"]);return t!=null&&_(e,["targetTokens"],t),e}function cle(n){const e={},t=v(n,["triggerTokens"]);t!=null&&_(e,["triggerTokens"],t);const r=v(n,["slidingWindow"]);return r!=null&&_(e,["slidingWindow"],lle(r)),e}function fle(n){const e={},t=v(n,["triggerTokens"]);t!=null&&_(e,["triggerTokens"],t);const r=v(n,["slidingWindow"]);return r!=null&&_(e,["slidingWindow"],ule(r)),e}function dle(n){const e={},t=v(n,["proactiveAudio"]);return t!=null&&_(e,["proactiveAudio"],t),e}function hle(n){const e={},t=v(n,["proactiveAudio"]);return t!=null&&_(e,["proactiveAudio"],t),e}function ple(n,e){const t={},r=v(n,["generationConfig"]);e!==void 0&&r!=null&&_(e,["setup","generationConfig"],r);const i=v(n,["responseModalities"]);e!==void 0&&i!=null&&_(e,["setup","generationConfig","responseModalities"],i);const a=v(n,["temperature"]);e!==void 0&&a!=null&&_(e,["setup","generationConfig","temperature"],a);const s=v(n,["topP"]);e!==void 0&&s!=null&&_(e,["setup","generationConfig","topP"],s);const o=v(n,["topK"]);e!==void 0&&o!=null&&_(e,["setup","generationConfig","topK"],o);const u=v(n,["maxOutputTokens"]);e!==void 0&&u!=null&&_(e,["setup","generationConfig","maxOutputTokens"],u);const c=v(n,["mediaResolution"]);e!==void 0&&c!=null&&_(e,["setup","generationConfig","mediaResolution"],c);const d=v(n,["seed"]);e!==void 0&&d!=null&&_(e,["setup","generationConfig","seed"],d);const p=v(n,["speechConfig"]);e!==void 0&&p!=null&&_(e,["setup","generationConfig","speechConfig"],Coe(uP(p)));const m=v(n,["enableAffectiveDialog"]);e!==void 0&&m!=null&&_(e,["setup","generationConfig","enableAffectiveDialog"],m);const y=v(n,["systemInstruction"]);e!==void 0&&y!=null&&_(e,["setup","systemInstruction"],$oe(ci(y)));const b=v(n,["tools"]);if(e!==void 0&&b!=null){let x=Im(b);Array.isArray(x)&&(x=x.map(L=>ele(Rm(L)))),_(e,["setup","tools"],x)}const w=v(n,["sessionResumption"]);e!==void 0&&w!=null&&_(e,["setup","sessionResumption"],nle(w));const S=v(n,["inputAudioTranscription"]);e!==void 0&&S!=null&&_(e,["setup","inputAudioTranscription"],Xj());const T=v(n,["outputAudioTranscription"]);e!==void 0&&T!=null&&_(e,["setup","outputAudioTranscription"],Xj());const C=v(n,["realtimeInputConfig"]);e!==void 0&&C!=null&&_(e,["setup","realtimeInputConfig"],sle(C));const A=v(n,["contextWindowCompression"]);e!==void 0&&A!=null&&_(e,["setup","contextWindowCompression"],cle(A));const I=v(n,["proactivity"]);return e!==void 0&&I!=null&&_(e,["setup","proactivity"],dle(I)),t}function mle(n,e){const t={},r=v(n,["generationConfig"]);e!==void 0&&r!=null&&_(e,["setup","generationConfig"],r);const i=v(n,["responseModalities"]);e!==void 0&&i!=null&&_(e,["setup","generationConfig","responseModalities"],i);const a=v(n,["temperature"]);e!==void 0&&a!=null&&_(e,["setup","generationConfig","temperature"],a);const s=v(n,["topP"]);e!==void 0&&s!=null&&_(e,["setup","generationConfig","topP"],s);const o=v(n,["topK"]);e!==void 0&&o!=null&&_(e,["setup","generationConfig","topK"],o);const u=v(n,["maxOutputTokens"]);e!==void 0&&u!=null&&_(e,["setup","generationConfig","maxOutputTokens"],u);const c=v(n,["mediaResolution"]);e!==void 0&&c!=null&&_(e,["setup","generationConfig","mediaResolution"],c);const d=v(n,["seed"]);e!==void 0&&d!=null&&_(e,["setup","generationConfig","seed"],d);const p=v(n,["speechConfig"]);e!==void 0&&p!=null&&_(e,["setup","generationConfig","speechConfig"],Roe(uP(p)));const m=v(n,["enableAffectiveDialog"]);e!==void 0&&m!=null&&_(e,["setup","generationConfig","enableAffectiveDialog"],m);const y=v(n,["systemInstruction"]);e!==void 0&&y!=null&&_(e,["setup","systemInstruction"],Loe(ci(y)));const b=v(n,["tools"]);if(e!==void 0&&b!=null){let x=Im(b);Array.isArray(x)&&(x=x.map(L=>tle(Rm(L)))),_(e,["setup","tools"],x)}const w=v(n,["sessionResumption"]);e!==void 0&&w!=null&&_(e,["setup","sessionResumption"],rle(w));const S=v(n,["inputAudioTranscription"]);e!==void 0&&S!=null&&_(e,["setup","inputAudioTranscription"],Qj());const T=v(n,["outputAudioTranscription"]);e!==void 0&&T!=null&&_(e,["setup","outputAudioTranscription"],Qj());const C=v(n,["realtimeInputConfig"]);e!==void 0&&C!=null&&_(e,["setup","realtimeInputConfig"],ole(C));const A=v(n,["contextWindowCompression"]);e!==void 0&&A!=null&&_(e,["setup","contextWindowCompression"],fle(A));const I=v(n,["proactivity"]);return e!==void 0&&I!=null&&_(e,["setup","proactivity"],hle(I)),t}function gle(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["setup","model"],Rn(n,r));const i=v(e,["config"]);return i!=null&&_(t,["config"],ple(i,t)),t}function yle(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["setup","model"],Rn(n,r));const i=v(e,["config"]);return i!=null&&_(t,["config"],mle(i,t)),t}function vle(){return{}}function _le(){return{}}function ble(){return{}}function wle(){return{}}function Ele(n){const e={},t=v(n,["media"]);t!=null&&_(e,["mediaChunks"],gq(t));const r=v(n,["audio"]);r!=null&&_(e,["audio"],zae(r));const i=v(n,["audioStreamEnd"]);i!=null&&_(e,["audioStreamEnd"],i);const a=v(n,["video"]);a!=null&&_(e,["video"],Vae(a));const s=v(n,["text"]);return s!=null&&_(e,["text"],s),v(n,["activityStart"])!=null&&_(e,["activityStart"],vle()),v(n,["activityEnd"])!=null&&_(e,["activityEnd"],ble()),e}function Sle(n){const e={},t=v(n,["media"]);if(t!=null&&_(e,["mediaChunks"],gq(t)),v(n,["audio"])!==void 0)throw new Error("audio parameter is not supported in Vertex AI.");const r=v(n,["audioStreamEnd"]);if(r!=null&&_(e,["audioStreamEnd"],r),v(n,["video"])!==void 0)throw new Error("video parameter is not supported in Vertex AI.");if(v(n,["text"])!==void 0)throw new Error("text parameter is not supported in Vertex AI.");return v(n,["activityStart"])!=null&&_(e,["activityStart"],_le()),v(n,["activityEnd"])!=null&&_(e,["activityEnd"],wle()),e}function Cq(n){const e={},t=v(n,["text"]);t!=null&&_(e,["text"],t);const r=v(n,["weight"]);return r!=null&&_(e,["weight"],r),e}function Tle(n){const e={},t=v(n,["weightedPrompts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>Cq(i))),_(e,["weightedPrompts"],r)}return e}function Rq(n){const e={},t=v(n,["temperature"]);t!=null&&_(e,["temperature"],t);const r=v(n,["topK"]);r!=null&&_(e,["topK"],r);const i=v(n,["seed"]);i!=null&&_(e,["seed"],i);const a=v(n,["guidance"]);a!=null&&_(e,["guidance"],a);const s=v(n,["bpm"]);s!=null&&_(e,["bpm"],s);const o=v(n,["density"]);o!=null&&_(e,["density"],o);const u=v(n,["brightness"]);u!=null&&_(e,["brightness"],u);const c=v(n,["scale"]);c!=null&&_(e,["scale"],c);const d=v(n,["muteBass"]);d!=null&&_(e,["muteBass"],d);const p=v(n,["muteDrums"]);p!=null&&_(e,["muteDrums"],p);const m=v(n,["onlyBassAndDrums"]);return m!=null&&_(e,["onlyBassAndDrums"],m),e}function Ale(n){const e={},t=v(n,["musicGenerationConfig"]);return t!=null&&_(e,["musicGenerationConfig"],Rq(t)),e}function Iq(n){const e={},t=v(n,["model"]);return t!=null&&_(e,["model"],t),e}function Pq(n){const e={},t=v(n,["weightedPrompts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>Cq(i))),_(e,["weightedPrompts"],r)}return e}function nR(n){const e={},t=v(n,["setup"]);t!=null&&_(e,["setup"],Iq(t));const r=v(n,["clientContent"]);r!=null&&_(e,["clientContent"],Pq(r));const i=v(n,["musicGenerationConfig"]);i!=null&&_(e,["musicGenerationConfig"],Rq(i));const a=v(n,["playbackControl"]);return a!=null&&_(e,["playbackControl"],a),e}function Cle(){return{}}function Rle(){return{}}function Ile(n){const e={},t=v(n,["fps"]);t!=null&&_(e,["fps"],t);const r=v(n,["endOffset"]);r!=null&&_(e,["endOffset"],r);const i=v(n,["startOffset"]);return i!=null&&_(e,["startOffset"],i),e}function Ple(n){const e={},t=v(n,["fps"]);t!=null&&_(e,["fps"],t);const r=v(n,["endOffset"]);r!=null&&_(e,["endOffset"],r);const i=v(n,["startOffset"]);return i!=null&&_(e,["startOffset"],i),e}function xle(n){const e={},t=v(n,["data"]);t!=null&&_(e,["data"],t);const r=v(n,["mimeType"]);return r!=null&&_(e,["mimeType"],r),e}function Ole(n){const e={},t=v(n,["displayName"]);t!=null&&_(e,["displayName"],t);const r=v(n,["data"]);r!=null&&_(e,["data"],r);const i=v(n,["mimeType"]);return i!=null&&_(e,["mimeType"],i),e}function Nle(n){const e={},t=v(n,["fileUri"]);t!=null&&_(e,["fileUri"],t);const r=v(n,["mimeType"]);return r!=null&&_(e,["mimeType"],r),e}function kle(n){const e={},t=v(n,["displayName"]);t!=null&&_(e,["displayName"],t);const r=v(n,["fileUri"]);r!=null&&_(e,["fileUri"],r);const i=v(n,["mimeType"]);return i!=null&&_(e,["mimeType"],i),e}function Mle(n){const e={},t=v(n,["videoMetadata"]);t!=null&&_(e,["videoMetadata"],Ile(t));const r=v(n,["thought"]);r!=null&&_(e,["thought"],r);const i=v(n,["inlineData"]);i!=null&&_(e,["inlineData"],xle(i));const a=v(n,["fileData"]);a!=null&&_(e,["fileData"],Nle(a));const s=v(n,["thoughtSignature"]);s!=null&&_(e,["thoughtSignature"],s);const o=v(n,["codeExecutionResult"]);o!=null&&_(e,["codeExecutionResult"],o);const u=v(n,["executableCode"]);u!=null&&_(e,["executableCode"],u);const c=v(n,["functionCall"]);c!=null&&_(e,["functionCall"],c);const d=v(n,["functionResponse"]);d!=null&&_(e,["functionResponse"],d);const p=v(n,["text"]);return p!=null&&_(e,["text"],p),e}function Dle(n){const e={},t=v(n,["videoMetadata"]);t!=null&&_(e,["videoMetadata"],Ple(t));const r=v(n,["thought"]);r!=null&&_(e,["thought"],r);const i=v(n,["inlineData"]);i!=null&&_(e,["inlineData"],Ole(i));const a=v(n,["fileData"]);a!=null&&_(e,["fileData"],kle(a));const s=v(n,["thoughtSignature"]);s!=null&&_(e,["thoughtSignature"],s);const o=v(n,["codeExecutionResult"]);o!=null&&_(e,["codeExecutionResult"],o);const u=v(n,["executableCode"]);u!=null&&_(e,["executableCode"],u);const c=v(n,["functionCall"]);c!=null&&_(e,["functionCall"],c);const d=v(n,["functionResponse"]);d!=null&&_(e,["functionResponse"],d);const p=v(n,["text"]);return p!=null&&_(e,["text"],p),e}function $le(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>Mle(a))),_(e,["parts"],i)}const r=v(n,["role"]);return r!=null&&_(e,["role"],r),e}function Lle(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>Dle(a))),_(e,["parts"],i)}const r=v(n,["role"]);return r!=null&&_(e,["role"],r),e}function e2(n){const e={},t=v(n,["text"]);t!=null&&_(e,["text"],t);const r=v(n,["finished"]);return r!=null&&_(e,["finished"],r),e}function t2(n){const e={},t=v(n,["text"]);t!=null&&_(e,["text"],t);const r=v(n,["finished"]);return r!=null&&_(e,["finished"],r),e}function Ule(n){const e={},t=v(n,["retrievedUrl"]);t!=null&&_(e,["retrievedUrl"],t);const r=v(n,["urlRetrievalStatus"]);return r!=null&&_(e,["urlRetrievalStatus"],r),e}function jle(n){const e={},t=v(n,["urlMetadata"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>Ule(i))),_(e,["urlMetadata"],r)}return e}function Fle(n){const e={},t=v(n,["modelTurn"]);t!=null&&_(e,["modelTurn"],$le(t));const r=v(n,["turnComplete"]);r!=null&&_(e,["turnComplete"],r);const i=v(n,["interrupted"]);i!=null&&_(e,["interrupted"],i);const a=v(n,["groundingMetadata"]);a!=null&&_(e,["groundingMetadata"],a);const s=v(n,["generationComplete"]);s!=null&&_(e,["generationComplete"],s);const o=v(n,["inputTranscription"]);o!=null&&_(e,["inputTranscription"],e2(o));const u=v(n,["outputTranscription"]);u!=null&&_(e,["outputTranscription"],e2(u));const c=v(n,["urlContextMetadata"]);return c!=null&&_(e,["urlContextMetadata"],jle(c)),e}function Ble(n){const e={},t=v(n,["modelTurn"]);t!=null&&_(e,["modelTurn"],Lle(t));const r=v(n,["turnComplete"]);r!=null&&_(e,["turnComplete"],r);const i=v(n,["interrupted"]);i!=null&&_(e,["interrupted"],i);const a=v(n,["groundingMetadata"]);a!=null&&_(e,["groundingMetadata"],a);const s=v(n,["generationComplete"]);s!=null&&_(e,["generationComplete"],s);const o=v(n,["inputTranscription"]);o!=null&&_(e,["inputTranscription"],t2(o));const u=v(n,["outputTranscription"]);return u!=null&&_(e,["outputTranscription"],t2(u)),e}function qle(n){const e={},t=v(n,["id"]);t!=null&&_(e,["id"],t);const r=v(n,["args"]);r!=null&&_(e,["args"],r);const i=v(n,["name"]);return i!=null&&_(e,["name"],i),e}function Vle(n){const e={},t=v(n,["args"]);t!=null&&_(e,["args"],t);const r=v(n,["name"]);return r!=null&&_(e,["name"],r),e}function zle(n){const e={},t=v(n,["functionCalls"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>qle(i))),_(e,["functionCalls"],r)}return e}function Hle(n){const e={},t=v(n,["functionCalls"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>Vle(i))),_(e,["functionCalls"],r)}return e}function Gle(n){const e={},t=v(n,["ids"]);return t!=null&&_(e,["ids"],t),e}function Wle(n){const e={},t=v(n,["ids"]);return t!=null&&_(e,["ids"],t),e}function My(n){const e={},t=v(n,["modality"]);t!=null&&_(e,["modality"],t);const r=v(n,["tokenCount"]);return r!=null&&_(e,["tokenCount"],r),e}function Dy(n){const e={},t=v(n,["modality"]);t!=null&&_(e,["modality"],t);const r=v(n,["tokenCount"]);return r!=null&&_(e,["tokenCount"],r),e}function Kle(n){const e={},t=v(n,["promptTokenCount"]);t!=null&&_(e,["promptTokenCount"],t);const r=v(n,["cachedContentTokenCount"]);r!=null&&_(e,["cachedContentTokenCount"],r);const i=v(n,["responseTokenCount"]);i!=null&&_(e,["responseTokenCount"],i);const a=v(n,["toolUsePromptTokenCount"]);a!=null&&_(e,["toolUsePromptTokenCount"],a);const s=v(n,["thoughtsTokenCount"]);s!=null&&_(e,["thoughtsTokenCount"],s);const o=v(n,["totalTokenCount"]);o!=null&&_(e,["totalTokenCount"],o);const u=v(n,["promptTokensDetails"]);if(u!=null){let m=u;Array.isArray(m)&&(m=m.map(y=>My(y))),_(e,["promptTokensDetails"],m)}const c=v(n,["cacheTokensDetails"]);if(c!=null){let m=c;Array.isArray(m)&&(m=m.map(y=>My(y))),_(e,["cacheTokensDetails"],m)}const d=v(n,["responseTokensDetails"]);if(d!=null){let m=d;Array.isArray(m)&&(m=m.map(y=>My(y))),_(e,["responseTokensDetails"],m)}const p=v(n,["toolUsePromptTokensDetails"]);if(p!=null){let m=p;Array.isArray(m)&&(m=m.map(y=>My(y))),_(e,["toolUsePromptTokensDetails"],m)}return e}function Jle(n){const e={},t=v(n,["promptTokenCount"]);t!=null&&_(e,["promptTokenCount"],t);const r=v(n,["cachedContentTokenCount"]);r!=null&&_(e,["cachedContentTokenCount"],r);const i=v(n,["candidatesTokenCount"]);i!=null&&_(e,["responseTokenCount"],i);const a=v(n,["toolUsePromptTokenCount"]);a!=null&&_(e,["toolUsePromptTokenCount"],a);const s=v(n,["thoughtsTokenCount"]);s!=null&&_(e,["thoughtsTokenCount"],s);const o=v(n,["totalTokenCount"]);o!=null&&_(e,["totalTokenCount"],o);const u=v(n,["promptTokensDetails"]);if(u!=null){let y=u;Array.isArray(y)&&(y=y.map(b=>Dy(b))),_(e,["promptTokensDetails"],y)}const c=v(n,["cacheTokensDetails"]);if(c!=null){let y=c;Array.isArray(y)&&(y=y.map(b=>Dy(b))),_(e,["cacheTokensDetails"],y)}const d=v(n,["candidatesTokensDetails"]);if(d!=null){let y=d;Array.isArray(y)&&(y=y.map(b=>Dy(b))),_(e,["responseTokensDetails"],y)}const p=v(n,["toolUsePromptTokensDetails"]);if(p!=null){let y=p;Array.isArray(y)&&(y=y.map(b=>Dy(b))),_(e,["toolUsePromptTokensDetails"],y)}const m=v(n,["trafficType"]);return m!=null&&_(e,["trafficType"],m),e}function Yle(n){const e={},t=v(n,["timeLeft"]);return t!=null&&_(e,["timeLeft"],t),e}function Zle(n){const e={},t=v(n,["timeLeft"]);return t!=null&&_(e,["timeLeft"],t),e}function Xle(n){const e={},t=v(n,["newHandle"]);t!=null&&_(e,["newHandle"],t);const r=v(n,["resumable"]);r!=null&&_(e,["resumable"],r);const i=v(n,["lastConsumedClientMessageIndex"]);return i!=null&&_(e,["lastConsumedClientMessageIndex"],i),e}function Qle(n){const e={},t=v(n,["newHandle"]);t!=null&&_(e,["newHandle"],t);const r=v(n,["resumable"]);r!=null&&_(e,["resumable"],r);const i=v(n,["lastConsumedClientMessageIndex"]);return i!=null&&_(e,["lastConsumedClientMessageIndex"],i),e}function eue(n){const e={};v(n,["setupComplete"])!=null&&_(e,["setupComplete"],Cle());const r=v(n,["serverContent"]);r!=null&&_(e,["serverContent"],Fle(r));const i=v(n,["toolCall"]);i!=null&&_(e,["toolCall"],zle(i));const a=v(n,["toolCallCancellation"]);a!=null&&_(e,["toolCallCancellation"],Gle(a));const s=v(n,["usageMetadata"]);s!=null&&_(e,["usageMetadata"],Kle(s));const o=v(n,["goAway"]);o!=null&&_(e,["goAway"],Yle(o));const u=v(n,["sessionResumptionUpdate"]);return u!=null&&_(e,["sessionResumptionUpdate"],Xle(u)),e}function tue(n){const e={};v(n,["setupComplete"])!=null&&_(e,["setupComplete"],Rle());const r=v(n,["serverContent"]);r!=null&&_(e,["serverContent"],Ble(r));const i=v(n,["toolCall"]);i!=null&&_(e,["toolCall"],Hle(i));const a=v(n,["toolCallCancellation"]);a!=null&&_(e,["toolCallCancellation"],Wle(a));const s=v(n,["usageMetadata"]);s!=null&&_(e,["usageMetadata"],Jle(s));const o=v(n,["goAway"]);o!=null&&_(e,["goAway"],Zle(o));const u=v(n,["sessionResumptionUpdate"]);return u!=null&&_(e,["sessionResumptionUpdate"],Qle(u)),e}function nue(){return{}}function rue(n){const e={},t=v(n,["text"]);t!=null&&_(e,["text"],t);const r=v(n,["weight"]);return r!=null&&_(e,["weight"],r),e}function iue(n){const e={},t=v(n,["weightedPrompts"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>rue(i))),_(e,["weightedPrompts"],r)}return e}function aue(n){const e={},t=v(n,["temperature"]);t!=null&&_(e,["temperature"],t);const r=v(n,["topK"]);r!=null&&_(e,["topK"],r);const i=v(n,["seed"]);i!=null&&_(e,["seed"],i);const a=v(n,["guidance"]);a!=null&&_(e,["guidance"],a);const s=v(n,["bpm"]);s!=null&&_(e,["bpm"],s);const o=v(n,["density"]);o!=null&&_(e,["density"],o);const u=v(n,["brightness"]);u!=null&&_(e,["brightness"],u);const c=v(n,["scale"]);c!=null&&_(e,["scale"],c);const d=v(n,["muteBass"]);d!=null&&_(e,["muteBass"],d);const p=v(n,["muteDrums"]);p!=null&&_(e,["muteDrums"],p);const m=v(n,["onlyBassAndDrums"]);return m!=null&&_(e,["onlyBassAndDrums"],m),e}function sue(n){const e={},t=v(n,["clientContent"]);t!=null&&_(e,["clientContent"],iue(t));const r=v(n,["musicGenerationConfig"]);return r!=null&&_(e,["musicGenerationConfig"],aue(r)),e}function oue(n){const e={},t=v(n,["data"]);t!=null&&_(e,["data"],t);const r=v(n,["mimeType"]);r!=null&&_(e,["mimeType"],r);const i=v(n,["sourceMetadata"]);return i!=null&&_(e,["sourceMetadata"],sue(i)),e}function lue(n){const e={},t=v(n,["audioChunks"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>oue(i))),_(e,["audioChunks"],r)}return e}function uue(n){const e={},t=v(n,["text"]);t!=null&&_(e,["text"],t);const r=v(n,["filteredReason"]);return r!=null&&_(e,["filteredReason"],r),e}function cue(n){const e={};v(n,["setupComplete"])!=null&&_(e,["setupComplete"],nue());const r=v(n,["serverContent"]);r!=null&&_(e,["serverContent"],lue(r));const i=v(n,["filteredPrompt"]);return i!=null&&_(e,["filteredPrompt"],uue(i)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function fue(n){const e={},t=v(n,["fps"]);t!=null&&_(e,["fps"],t);const r=v(n,["endOffset"]);r!=null&&_(e,["endOffset"],r);const i=v(n,["startOffset"]);return i!=null&&_(e,["startOffset"],i),e}function due(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["data"]);t!=null&&_(e,["data"],t);const r=v(n,["mimeType"]);return r!=null&&_(e,["mimeType"],r),e}function hue(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["fileUri"]);t!=null&&_(e,["fileUri"],t);const r=v(n,["mimeType"]);return r!=null&&_(e,["mimeType"],r),e}function pue(n){const e={},t=v(n,["videoMetadata"]);t!=null&&_(e,["videoMetadata"],fue(t));const r=v(n,["thought"]);r!=null&&_(e,["thought"],r);const i=v(n,["inlineData"]);i!=null&&_(e,["inlineData"],due(i));const a=v(n,["fileData"]);a!=null&&_(e,["fileData"],hue(a));const s=v(n,["thoughtSignature"]);s!=null&&_(e,["thoughtSignature"],s);const o=v(n,["codeExecutionResult"]);o!=null&&_(e,["codeExecutionResult"],o);const u=v(n,["executableCode"]);u!=null&&_(e,["executableCode"],u);const c=v(n,["functionCall"]);c!=null&&_(e,["functionCall"],c);const d=v(n,["functionResponse"]);d!=null&&_(e,["functionResponse"],d);const p=v(n,["text"]);return p!=null&&_(e,["text"],p),e}function Tb(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>pue(a))),_(e,["parts"],i)}const r=v(n,["role"]);return r!=null&&_(e,["role"],r),e}function mue(n){const e={},t=v(n,["anyOf"]);t!=null&&_(e,["anyOf"],t);const r=v(n,["default"]);r!=null&&_(e,["default"],r);const i=v(n,["description"]);i!=null&&_(e,["description"],i);const a=v(n,["enum"]);a!=null&&_(e,["enum"],a);const s=v(n,["example"]);s!=null&&_(e,["example"],s);const o=v(n,["format"]);o!=null&&_(e,["format"],o);const u=v(n,["items"]);u!=null&&_(e,["items"],u);const c=v(n,["maxItems"]);c!=null&&_(e,["maxItems"],c);const d=v(n,["maxLength"]);d!=null&&_(e,["maxLength"],d);const p=v(n,["maxProperties"]);p!=null&&_(e,["maxProperties"],p);const m=v(n,["maximum"]);m!=null&&_(e,["maximum"],m);const y=v(n,["minItems"]);y!=null&&_(e,["minItems"],y);const b=v(n,["minLength"]);b!=null&&_(e,["minLength"],b);const w=v(n,["minProperties"]);w!=null&&_(e,["minProperties"],w);const S=v(n,["minimum"]);S!=null&&_(e,["minimum"],S);const T=v(n,["nullable"]);T!=null&&_(e,["nullable"],T);const C=v(n,["pattern"]);C!=null&&_(e,["pattern"],C);const A=v(n,["properties"]);A!=null&&_(e,["properties"],A);const I=v(n,["propertyOrdering"]);I!=null&&_(e,["propertyOrdering"],I);const x=v(n,["required"]);x!=null&&_(e,["required"],x);const L=v(n,["title"]);L!=null&&_(e,["title"],L);const U=v(n,["type"]);return U!=null&&_(e,["type"],U),e}function gue(n){const e={};if(v(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const t=v(n,["category"]);t!=null&&_(e,["category"],t);const r=v(n,["threshold"]);return r!=null&&_(e,["threshold"],r),e}function yue(n){const e={},t=v(n,["behavior"]);t!=null&&_(e,["behavior"],t);const r=v(n,["description"]);r!=null&&_(e,["description"],r);const i=v(n,["name"]);i!=null&&_(e,["name"],i);const a=v(n,["parameters"]);a!=null&&_(e,["parameters"],a);const s=v(n,["parametersJsonSchema"]);s!=null&&_(e,["parametersJsonSchema"],s);const o=v(n,["response"]);o!=null&&_(e,["response"],o);const u=v(n,["responseJsonSchema"]);return u!=null&&_(e,["responseJsonSchema"],u),e}function vue(n){const e={},t=v(n,["startTime"]);t!=null&&_(e,["startTime"],t);const r=v(n,["endTime"]);return r!=null&&_(e,["endTime"],r),e}function _ue(n){const e={},t=v(n,["timeRangeFilter"]);return t!=null&&_(e,["timeRangeFilter"],vue(t)),e}function bue(n){const e={},t=v(n,["mode"]);t!=null&&_(e,["mode"],t);const r=v(n,["dynamicThreshold"]);return r!=null&&_(e,["dynamicThreshold"],r),e}function wue(n){const e={},t=v(n,["dynamicRetrievalConfig"]);return t!=null&&_(e,["dynamicRetrievalConfig"],bue(t)),e}function Eue(){return{}}function Sue(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(u=>yue(u))),_(e,["functionDeclarations"],o)}if(v(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=v(n,["googleSearch"]);r!=null&&_(e,["googleSearch"],_ue(r));const i=v(n,["googleSearchRetrieval"]);if(i!=null&&_(e,["googleSearchRetrieval"],wue(i)),v(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(v(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");v(n,["urlContext"])!=null&&_(e,["urlContext"],Eue());const s=v(n,["codeExecution"]);return s!=null&&_(e,["codeExecution"],s),e}function Tue(n){const e={},t=v(n,["mode"]);t!=null&&_(e,["mode"],t);const r=v(n,["allowedFunctionNames"]);return r!=null&&_(e,["allowedFunctionNames"],r),e}function Aue(n){const e={},t=v(n,["latitude"]);t!=null&&_(e,["latitude"],t);const r=v(n,["longitude"]);return r!=null&&_(e,["longitude"],r),e}function Cue(n){const e={},t=v(n,["latLng"]);t!=null&&_(e,["latLng"],Aue(t));const r=v(n,["languageCode"]);return r!=null&&_(e,["languageCode"],r),e}function Rue(n){const e={},t=v(n,["functionCallingConfig"]);t!=null&&_(e,["functionCallingConfig"],Tue(t));const r=v(n,["retrievalConfig"]);return r!=null&&_(e,["retrievalConfig"],Cue(r)),e}function Iue(n){const e={},t=v(n,["voiceName"]);return t!=null&&_(e,["voiceName"],t),e}function xq(n){const e={},t=v(n,["prebuiltVoiceConfig"]);return t!=null&&_(e,["prebuiltVoiceConfig"],Iue(t)),e}function Pue(n){const e={},t=v(n,["speaker"]);t!=null&&_(e,["speaker"],t);const r=v(n,["voiceConfig"]);return r!=null&&_(e,["voiceConfig"],xq(r)),e}function xue(n){const e={},t=v(n,["speakerVoiceConfigs"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>Pue(i))),_(e,["speakerVoiceConfigs"],r)}return e}function Oue(n){const e={},t=v(n,["voiceConfig"]);t!=null&&_(e,["voiceConfig"],xq(t));const r=v(n,["multiSpeakerVoiceConfig"]);r!=null&&_(e,["multiSpeakerVoiceConfig"],xue(r));const i=v(n,["languageCode"]);return i!=null&&_(e,["languageCode"],i),e}function Nue(n){const e={},t=v(n,["includeThoughts"]);t!=null&&_(e,["includeThoughts"],t);const r=v(n,["thinkingBudget"]);return r!=null&&_(e,["thinkingBudget"],r),e}function kue(n,e,t){const r={},i=v(e,["systemInstruction"]);t!==void 0&&i!=null&&_(t,["systemInstruction"],Tb(ci(i)));const a=v(e,["temperature"]);a!=null&&_(r,["temperature"],a);const s=v(e,["topP"]);s!=null&&_(r,["topP"],s);const o=v(e,["topK"]);o!=null&&_(r,["topK"],o);const u=v(e,["candidateCount"]);u!=null&&_(r,["candidateCount"],u);const c=v(e,["maxOutputTokens"]);c!=null&&_(r,["maxOutputTokens"],c);const d=v(e,["stopSequences"]);d!=null&&_(r,["stopSequences"],d);const p=v(e,["responseLogprobs"]);p!=null&&_(r,["responseLogprobs"],p);const m=v(e,["logprobs"]);m!=null&&_(r,["logprobs"],m);const y=v(e,["presencePenalty"]);y!=null&&_(r,["presencePenalty"],y);const b=v(e,["frequencyPenalty"]);b!=null&&_(r,["frequencyPenalty"],b);const w=v(e,["seed"]);w!=null&&_(r,["seed"],w);const S=v(e,["responseMimeType"]);S!=null&&_(r,["responseMimeType"],S);const T=v(e,["responseSchema"]);if(T!=null&&_(r,["responseSchema"],mue(h_(T))),v(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(v(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const C=v(e,["safetySettings"]);if(t!==void 0&&C!=null){let q=C;Array.isArray(q)&&(q=q.map(J=>gue(J))),_(t,["safetySettings"],q)}const A=v(e,["tools"]);if(t!==void 0&&A!=null){let q=Im(A);Array.isArray(q)&&(q=q.map(J=>Sue(Rm(J)))),_(t,["tools"],q)}const I=v(e,["toolConfig"]);if(t!==void 0&&I!=null&&_(t,["toolConfig"],Rue(I)),v(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const x=v(e,["cachedContent"]);t!==void 0&&x!=null&&_(t,["cachedContent"],zl(n,x));const L=v(e,["responseModalities"]);L!=null&&_(r,["responseModalities"],L);const U=v(e,["mediaResolution"]);U!=null&&_(r,["mediaResolution"],U);const N=v(e,["speechConfig"]);if(N!=null&&_(r,["speechConfig"],Oue(_q(N))),v(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const B=v(e,["thinkingConfig"]);return B!=null&&_(r,["thinkingConfig"],Nue(B)),r}function n2(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["_url","model"],Rn(n,r));const i=v(e,["contents"]);if(i!=null){let s=cs(i);Array.isArray(s)&&(s=s.map(o=>Tb(o))),_(t,["contents"],s)}const a=v(e,["config"]);return a!=null&&_(t,["generationConfig"],kue(n,a,t)),t}function Mue(n,e){const t={},r=v(n,["taskType"]);e!==void 0&&r!=null&&_(e,["requests[]","taskType"],r);const i=v(n,["title"]);e!==void 0&&i!=null&&_(e,["requests[]","title"],i);const a=v(n,["outputDimensionality"]);if(e!==void 0&&a!=null&&_(e,["requests[]","outputDimensionality"],a),v(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(v(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function Due(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["_url","model"],Rn(n,r));const i=v(e,["contents"]);i!=null&&_(t,["requests[]","content"],vq(n,i));const a=v(e,["config"]);a!=null&&_(t,["config"],Mue(a,t));const s=v(e,["model"]);return s!==void 0&&_(t,["requests[]","model"],Rn(n,s)),t}function $ue(n,e){const t={};if(v(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(v(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const r=v(n,["numberOfImages"]);e!==void 0&&r!=null&&_(e,["parameters","sampleCount"],r);const i=v(n,["aspectRatio"]);e!==void 0&&i!=null&&_(e,["parameters","aspectRatio"],i);const a=v(n,["guidanceScale"]);if(e!==void 0&&a!=null&&_(e,["parameters","guidanceScale"],a),v(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const s=v(n,["safetyFilterLevel"]);e!==void 0&&s!=null&&_(e,["parameters","safetySetting"],s);const o=v(n,["personGeneration"]);e!==void 0&&o!=null&&_(e,["parameters","personGeneration"],o);const u=v(n,["includeSafetyAttributes"]);e!==void 0&&u!=null&&_(e,["parameters","includeSafetyAttributes"],u);const c=v(n,["includeRaiReason"]);e!==void 0&&c!=null&&_(e,["parameters","includeRaiReason"],c);const d=v(n,["language"]);e!==void 0&&d!=null&&_(e,["parameters","language"],d);const p=v(n,["outputMimeType"]);e!==void 0&&p!=null&&_(e,["parameters","outputOptions","mimeType"],p);const m=v(n,["outputCompressionQuality"]);if(e!==void 0&&m!=null&&_(e,["parameters","outputOptions","compressionQuality"],m),v(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(v(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function Lue(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["_url","model"],Rn(n,r));const i=v(e,["prompt"]);i!=null&&_(t,["instances[0]","prompt"],i);const a=v(e,["config"]);return a!=null&&_(t,["config"],$ue(a,t)),t}function Uue(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["_url","name"],Rn(n,r));const i=v(e,["config"]);return i!=null&&_(t,["config"],i),t}function jue(n,e,t){const r={},i=v(e,["pageSize"]);t!==void 0&&i!=null&&_(t,["_query","pageSize"],i);const a=v(e,["pageToken"]);t!==void 0&&a!=null&&_(t,["_query","pageToken"],a);const s=v(e,["filter"]);t!==void 0&&s!=null&&_(t,["_query","filter"],s);const o=v(e,["queryBase"]);return t!==void 0&&o!=null&&_(t,["_url","models_url"],Eq(n,o)),r}function Fue(n,e){const t={},r=v(e,["config"]);return r!=null&&_(t,["config"],jue(n,r,t)),t}function Bue(n,e){const t={},r=v(n,["displayName"]);e!==void 0&&r!=null&&_(e,["displayName"],r);const i=v(n,["description"]);e!==void 0&&i!=null&&_(e,["description"],i);const a=v(n,["defaultCheckpointId"]);return e!==void 0&&a!=null&&_(e,["defaultCheckpointId"],a),t}function que(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["_url","name"],Rn(n,r));const i=v(e,["config"]);return i!=null&&_(t,["config"],Bue(i,t)),t}function Vue(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["_url","name"],Rn(n,r));const i=v(e,["config"]);return i!=null&&_(t,["config"],i),t}function zue(n){const e={};if(v(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(v(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(v(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function Hue(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["_url","model"],Rn(n,r));const i=v(e,["contents"]);if(i!=null){let s=cs(i);Array.isArray(s)&&(s=s.map(o=>Tb(o))),_(t,["contents"],s)}const a=v(e,["config"]);return a!=null&&_(t,["config"],zue(a)),t}function Gue(n){const e={};if(v(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const t=v(n,["imageBytes"]);t!=null&&_(e,["bytesBase64Encoded"],qo(t));const r=v(n,["mimeType"]);return r!=null&&_(e,["mimeType"],r),e}function Wue(n,e){const t={},r=v(n,["numberOfVideos"]);if(e!==void 0&&r!=null&&_(e,["parameters","sampleCount"],r),v(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(v(n,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const i=v(n,["durationSeconds"]);if(e!==void 0&&i!=null&&_(e,["parameters","durationSeconds"],i),v(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const a=v(n,["aspectRatio"]);if(e!==void 0&&a!=null&&_(e,["parameters","aspectRatio"],a),v(n,["resolution"])!==void 0)throw new Error("resolution parameter is not supported in Gemini API.");const s=v(n,["personGeneration"]);if(e!==void 0&&s!=null&&_(e,["parameters","personGeneration"],s),v(n,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const o=v(n,["negativePrompt"]);e!==void 0&&o!=null&&_(e,["parameters","negativePrompt"],o);const u=v(n,["enhancePrompt"]);if(e!==void 0&&u!=null&&_(e,["parameters","enhancePrompt"],u),v(n,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");if(v(n,["lastFrame"])!==void 0)throw new Error("lastFrame parameter is not supported in Gemini API.");return t}function Kue(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["_url","model"],Rn(n,r));const i=v(e,["prompt"]);i!=null&&_(t,["instances[0]","prompt"],i);const a=v(e,["image"]);if(a!=null&&_(t,["instances[0]","image"],Gue(a)),v(e,["video"])!==void 0)throw new Error("video parameter is not supported in Gemini API.");const s=v(e,["config"]);return s!=null&&_(t,["config"],Wue(s,t)),t}function Jue(n){const e={},t=v(n,["fps"]);t!=null&&_(e,["fps"],t);const r=v(n,["endOffset"]);r!=null&&_(e,["endOffset"],r);const i=v(n,["startOffset"]);return i!=null&&_(e,["startOffset"],i),e}function Yue(n){const e={},t=v(n,["displayName"]);t!=null&&_(e,["displayName"],t);const r=v(n,["data"]);r!=null&&_(e,["data"],r);const i=v(n,["mimeType"]);return i!=null&&_(e,["mimeType"],i),e}function Zue(n){const e={},t=v(n,["displayName"]);t!=null&&_(e,["displayName"],t);const r=v(n,["fileUri"]);r!=null&&_(e,["fileUri"],r);const i=v(n,["mimeType"]);return i!=null&&_(e,["mimeType"],i),e}function Xue(n){const e={},t=v(n,["videoMetadata"]);t!=null&&_(e,["videoMetadata"],Jue(t));const r=v(n,["thought"]);r!=null&&_(e,["thought"],r);const i=v(n,["inlineData"]);i!=null&&_(e,["inlineData"],Yue(i));const a=v(n,["fileData"]);a!=null&&_(e,["fileData"],Zue(a));const s=v(n,["thoughtSignature"]);s!=null&&_(e,["thoughtSignature"],s);const o=v(n,["codeExecutionResult"]);o!=null&&_(e,["codeExecutionResult"],o);const u=v(n,["executableCode"]);u!=null&&_(e,["executableCode"],u);const c=v(n,["functionCall"]);c!=null&&_(e,["functionCall"],c);const d=v(n,["functionResponse"]);d!=null&&_(e,["functionResponse"],d);const p=v(n,["text"]);return p!=null&&_(e,["text"],p),e}function bd(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>Xue(a))),_(e,["parts"],i)}const r=v(n,["role"]);return r!=null&&_(e,["role"],r),e}function Que(n){const e={},t=v(n,["anyOf"]);t!=null&&_(e,["anyOf"],t);const r=v(n,["default"]);r!=null&&_(e,["default"],r);const i=v(n,["description"]);i!=null&&_(e,["description"],i);const a=v(n,["enum"]);a!=null&&_(e,["enum"],a);const s=v(n,["example"]);s!=null&&_(e,["example"],s);const o=v(n,["format"]);o!=null&&_(e,["format"],o);const u=v(n,["items"]);u!=null&&_(e,["items"],u);const c=v(n,["maxItems"]);c!=null&&_(e,["maxItems"],c);const d=v(n,["maxLength"]);d!=null&&_(e,["maxLength"],d);const p=v(n,["maxProperties"]);p!=null&&_(e,["maxProperties"],p);const m=v(n,["maximum"]);m!=null&&_(e,["maximum"],m);const y=v(n,["minItems"]);y!=null&&_(e,["minItems"],y);const b=v(n,["minLength"]);b!=null&&_(e,["minLength"],b);const w=v(n,["minProperties"]);w!=null&&_(e,["minProperties"],w);const S=v(n,["minimum"]);S!=null&&_(e,["minimum"],S);const T=v(n,["nullable"]);T!=null&&_(e,["nullable"],T);const C=v(n,["pattern"]);C!=null&&_(e,["pattern"],C);const A=v(n,["properties"]);A!=null&&_(e,["properties"],A);const I=v(n,["propertyOrdering"]);I!=null&&_(e,["propertyOrdering"],I);const x=v(n,["required"]);x!=null&&_(e,["required"],x);const L=v(n,["title"]);L!=null&&_(e,["title"],L);const U=v(n,["type"]);return U!=null&&_(e,["type"],U),e}function ece(n){const e={},t=v(n,["featureSelectionPreference"]);return t!=null&&_(e,["featureSelectionPreference"],t),e}function tce(n){const e={},t=v(n,["method"]);t!=null&&_(e,["method"],t);const r=v(n,["category"]);r!=null&&_(e,["category"],r);const i=v(n,["threshold"]);return i!=null&&_(e,["threshold"],i),e}function nce(n){const e={};if(v(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=v(n,["description"]);t!=null&&_(e,["description"],t);const r=v(n,["name"]);r!=null&&_(e,["name"],r);const i=v(n,["parameters"]);i!=null&&_(e,["parameters"],i);const a=v(n,["parametersJsonSchema"]);a!=null&&_(e,["parametersJsonSchema"],a);const s=v(n,["response"]);s!=null&&_(e,["response"],s);const o=v(n,["responseJsonSchema"]);return o!=null&&_(e,["responseJsonSchema"],o),e}function rce(n){const e={},t=v(n,["startTime"]);t!=null&&_(e,["startTime"],t);const r=v(n,["endTime"]);return r!=null&&_(e,["endTime"],r),e}function ice(n){const e={},t=v(n,["timeRangeFilter"]);return t!=null&&_(e,["timeRangeFilter"],rce(t)),e}function ace(n){const e={},t=v(n,["mode"]);t!=null&&_(e,["mode"],t);const r=v(n,["dynamicThreshold"]);return r!=null&&_(e,["dynamicThreshold"],r),e}function sce(n){const e={},t=v(n,["dynamicRetrievalConfig"]);return t!=null&&_(e,["dynamicRetrievalConfig"],ace(t)),e}function oce(){return{}}function lce(n){const e={},t=v(n,["apiKeyString"]);return t!=null&&_(e,["apiKeyString"],t),e}function uce(n){const e={},t=v(n,["apiKeyConfig"]);t!=null&&_(e,["apiKeyConfig"],lce(t));const r=v(n,["authType"]);r!=null&&_(e,["authType"],r);const i=v(n,["googleServiceAccountConfig"]);i!=null&&_(e,["googleServiceAccountConfig"],i);const a=v(n,["httpBasicAuthConfig"]);a!=null&&_(e,["httpBasicAuthConfig"],a);const s=v(n,["oauthConfig"]);s!=null&&_(e,["oauthConfig"],s);const o=v(n,["oidcConfig"]);return o!=null&&_(e,["oidcConfig"],o),e}function cce(n){const e={},t=v(n,["authConfig"]);return t!=null&&_(e,["authConfig"],uce(t)),e}function fce(){return{}}function Oq(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let d=t;Array.isArray(d)&&(d=d.map(p=>nce(p))),_(e,["functionDeclarations"],d)}const r=v(n,["retrieval"]);r!=null&&_(e,["retrieval"],r);const i=v(n,["googleSearch"]);i!=null&&_(e,["googleSearch"],ice(i));const a=v(n,["googleSearchRetrieval"]);a!=null&&_(e,["googleSearchRetrieval"],sce(a)),v(n,["enterpriseWebSearch"])!=null&&_(e,["enterpriseWebSearch"],oce());const o=v(n,["googleMaps"]);o!=null&&_(e,["googleMaps"],cce(o)),v(n,["urlContext"])!=null&&_(e,["urlContext"],fce());const c=v(n,["codeExecution"]);return c!=null&&_(e,["codeExecution"],c),e}function dce(n){const e={},t=v(n,["mode"]);t!=null&&_(e,["mode"],t);const r=v(n,["allowedFunctionNames"]);return r!=null&&_(e,["allowedFunctionNames"],r),e}function hce(n){const e={},t=v(n,["latitude"]);t!=null&&_(e,["latitude"],t);const r=v(n,["longitude"]);return r!=null&&_(e,["longitude"],r),e}function pce(n){const e={},t=v(n,["latLng"]);t!=null&&_(e,["latLng"],hce(t));const r=v(n,["languageCode"]);return r!=null&&_(e,["languageCode"],r),e}function mce(n){const e={},t=v(n,["functionCallingConfig"]);t!=null&&_(e,["functionCallingConfig"],dce(t));const r=v(n,["retrievalConfig"]);return r!=null&&_(e,["retrievalConfig"],pce(r)),e}function gce(n){const e={},t=v(n,["voiceName"]);return t!=null&&_(e,["voiceName"],t),e}function yce(n){const e={},t=v(n,["prebuiltVoiceConfig"]);return t!=null&&_(e,["prebuiltVoiceConfig"],gce(t)),e}function vce(n){const e={},t=v(n,["voiceConfig"]);if(t!=null&&_(e,["voiceConfig"],yce(t)),v(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");const r=v(n,["languageCode"]);return r!=null&&_(e,["languageCode"],r),e}function _ce(n){const e={},t=v(n,["includeThoughts"]);t!=null&&_(e,["includeThoughts"],t);const r=v(n,["thinkingBudget"]);return r!=null&&_(e,["thinkingBudget"],r),e}function bce(n,e,t){const r={},i=v(e,["systemInstruction"]);t!==void 0&&i!=null&&_(t,["systemInstruction"],bd(ci(i)));const a=v(e,["temperature"]);a!=null&&_(r,["temperature"],a);const s=v(e,["topP"]);s!=null&&_(r,["topP"],s);const o=v(e,["topK"]);o!=null&&_(r,["topK"],o);const u=v(e,["candidateCount"]);u!=null&&_(r,["candidateCount"],u);const c=v(e,["maxOutputTokens"]);c!=null&&_(r,["maxOutputTokens"],c);const d=v(e,["stopSequences"]);d!=null&&_(r,["stopSequences"],d);const p=v(e,["responseLogprobs"]);p!=null&&_(r,["responseLogprobs"],p);const m=v(e,["logprobs"]);m!=null&&_(r,["logprobs"],m);const y=v(e,["presencePenalty"]);y!=null&&_(r,["presencePenalty"],y);const b=v(e,["frequencyPenalty"]);b!=null&&_(r,["frequencyPenalty"],b);const w=v(e,["seed"]);w!=null&&_(r,["seed"],w);const S=v(e,["responseMimeType"]);S!=null&&_(r,["responseMimeType"],S);const T=v(e,["responseSchema"]);T!=null&&_(r,["responseSchema"],Que(h_(T)));const C=v(e,["routingConfig"]);C!=null&&_(r,["routingConfig"],C);const A=v(e,["modelSelectionConfig"]);A!=null&&_(r,["modelConfig"],ece(A));const I=v(e,["safetySettings"]);if(t!==void 0&&I!=null){let ae=I;Array.isArray(ae)&&(ae=ae.map(ue=>tce(ue))),_(t,["safetySettings"],ae)}const x=v(e,["tools"]);if(t!==void 0&&x!=null){let ae=Im(x);Array.isArray(ae)&&(ae=ae.map(ue=>Oq(Rm(ue)))),_(t,["tools"],ae)}const L=v(e,["toolConfig"]);t!==void 0&&L!=null&&_(t,["toolConfig"],mce(L));const U=v(e,["labels"]);t!==void 0&&U!=null&&_(t,["labels"],U);const N=v(e,["cachedContent"]);t!==void 0&&N!=null&&_(t,["cachedContent"],zl(n,N));const B=v(e,["responseModalities"]);B!=null&&_(r,["responseModalities"],B);const q=v(e,["mediaResolution"]);q!=null&&_(r,["mediaResolution"],q);const J=v(e,["speechConfig"]);J!=null&&_(r,["speechConfig"],vce(_q(J)));const V=v(e,["audioTimestamp"]);V!=null&&_(r,["audioTimestamp"],V);const de=v(e,["thinkingConfig"]);return de!=null&&_(r,["thinkingConfig"],_ce(de)),r}function r2(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["_url","model"],Rn(n,r));const i=v(e,["contents"]);if(i!=null){let s=cs(i);Array.isArray(s)&&(s=s.map(o=>bd(o))),_(t,["contents"],s)}const a=v(e,["config"]);return a!=null&&_(t,["generationConfig"],bce(n,a,t)),t}function wce(n,e){const t={},r=v(n,["taskType"]);e!==void 0&&r!=null&&_(e,["instances[]","task_type"],r);const i=v(n,["title"]);e!==void 0&&i!=null&&_(e,["instances[]","title"],i);const a=v(n,["outputDimensionality"]);e!==void 0&&a!=null&&_(e,["parameters","outputDimensionality"],a);const s=v(n,["mimeType"]);e!==void 0&&s!=null&&_(e,["instances[]","mimeType"],s);const o=v(n,["autoTruncate"]);return e!==void 0&&o!=null&&_(e,["parameters","autoTruncate"],o),t}function Ece(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["_url","model"],Rn(n,r));const i=v(e,["contents"]);i!=null&&_(t,["instances[]","content"],vq(n,i));const a=v(e,["config"]);return a!=null&&_(t,["config"],wce(a,t)),t}function Sce(n,e){const t={},r=v(n,["outputGcsUri"]);e!==void 0&&r!=null&&_(e,["parameters","storageUri"],r);const i=v(n,["negativePrompt"]);e!==void 0&&i!=null&&_(e,["parameters","negativePrompt"],i);const a=v(n,["numberOfImages"]);e!==void 0&&a!=null&&_(e,["parameters","sampleCount"],a);const s=v(n,["aspectRatio"]);e!==void 0&&s!=null&&_(e,["parameters","aspectRatio"],s);const o=v(n,["guidanceScale"]);e!==void 0&&o!=null&&_(e,["parameters","guidanceScale"],o);const u=v(n,["seed"]);e!==void 0&&u!=null&&_(e,["parameters","seed"],u);const c=v(n,["safetyFilterLevel"]);e!==void 0&&c!=null&&_(e,["parameters","safetySetting"],c);const d=v(n,["personGeneration"]);e!==void 0&&d!=null&&_(e,["parameters","personGeneration"],d);const p=v(n,["includeSafetyAttributes"]);e!==void 0&&p!=null&&_(e,["parameters","includeSafetyAttributes"],p);const m=v(n,["includeRaiReason"]);e!==void 0&&m!=null&&_(e,["parameters","includeRaiReason"],m);const y=v(n,["language"]);e!==void 0&&y!=null&&_(e,["parameters","language"],y);const b=v(n,["outputMimeType"]);e!==void 0&&b!=null&&_(e,["parameters","outputOptions","mimeType"],b);const w=v(n,["outputCompressionQuality"]);e!==void 0&&w!=null&&_(e,["parameters","outputOptions","compressionQuality"],w);const S=v(n,["addWatermark"]);e!==void 0&&S!=null&&_(e,["parameters","addWatermark"],S);const T=v(n,["enhancePrompt"]);return e!==void 0&&T!=null&&_(e,["parameters","enhancePrompt"],T),t}function Tce(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["_url","model"],Rn(n,r));const i=v(e,["prompt"]);i!=null&&_(t,["instances[0]","prompt"],i);const a=v(e,["config"]);return a!=null&&_(t,["config"],Sce(a,t)),t}function Ab(n){const e={},t=v(n,["gcsUri"]);t!=null&&_(e,["gcsUri"],t);const r=v(n,["imageBytes"]);r!=null&&_(e,["bytesBase64Encoded"],qo(r));const i=v(n,["mimeType"]);return i!=null&&_(e,["mimeType"],i),e}function Ace(n){const e={},t=v(n,["maskMode"]);t!=null&&_(e,["maskMode"],t);const r=v(n,["segmentationClasses"]);r!=null&&_(e,["maskClasses"],r);const i=v(n,["maskDilation"]);return i!=null&&_(e,["dilation"],i),e}function Cce(n){const e={},t=v(n,["controlType"]);t!=null&&_(e,["controlType"],t);const r=v(n,["enableControlImageComputation"]);return r!=null&&_(e,["computeControl"],r),e}function Rce(n){const e={},t=v(n,["styleDescription"]);return t!=null&&_(e,["styleDescription"],t),e}function Ice(n){const e={},t=v(n,["subjectType"]);t!=null&&_(e,["subjectType"],t);const r=v(n,["subjectDescription"]);return r!=null&&_(e,["subjectDescription"],r),e}function Pce(n){const e={},t=v(n,["referenceImage"]);t!=null&&_(e,["referenceImage"],Ab(t));const r=v(n,["referenceId"]);r!=null&&_(e,["referenceId"],r);const i=v(n,["referenceType"]);i!=null&&_(e,["referenceType"],i);const a=v(n,["maskImageConfig"]);a!=null&&_(e,["maskImageConfig"],Ace(a));const s=v(n,["controlImageConfig"]);s!=null&&_(e,["controlImageConfig"],Cce(s));const o=v(n,["styleImageConfig"]);o!=null&&_(e,["styleImageConfig"],Rce(o));const u=v(n,["subjectImageConfig"]);return u!=null&&_(e,["subjectImageConfig"],Ice(u)),e}function xce(n,e){const t={},r=v(n,["outputGcsUri"]);e!==void 0&&r!=null&&_(e,["parameters","storageUri"],r);const i=v(n,["negativePrompt"]);e!==void 0&&i!=null&&_(e,["parameters","negativePrompt"],i);const a=v(n,["numberOfImages"]);e!==void 0&&a!=null&&_(e,["parameters","sampleCount"],a);const s=v(n,["aspectRatio"]);e!==void 0&&s!=null&&_(e,["parameters","aspectRatio"],s);const o=v(n,["guidanceScale"]);e!==void 0&&o!=null&&_(e,["parameters","guidanceScale"],o);const u=v(n,["seed"]);e!==void 0&&u!=null&&_(e,["parameters","seed"],u);const c=v(n,["safetyFilterLevel"]);e!==void 0&&c!=null&&_(e,["parameters","safetySetting"],c);const d=v(n,["personGeneration"]);e!==void 0&&d!=null&&_(e,["parameters","personGeneration"],d);const p=v(n,["includeSafetyAttributes"]);e!==void 0&&p!=null&&_(e,["parameters","includeSafetyAttributes"],p);const m=v(n,["includeRaiReason"]);e!==void 0&&m!=null&&_(e,["parameters","includeRaiReason"],m);const y=v(n,["language"]);e!==void 0&&y!=null&&_(e,["parameters","language"],y);const b=v(n,["outputMimeType"]);e!==void 0&&b!=null&&_(e,["parameters","outputOptions","mimeType"],b);const w=v(n,["outputCompressionQuality"]);e!==void 0&&w!=null&&_(e,["parameters","outputOptions","compressionQuality"],w);const S=v(n,["editMode"]);e!==void 0&&S!=null&&_(e,["parameters","editMode"],S);const T=v(n,["baseSteps"]);return e!==void 0&&T!=null&&_(e,["parameters","editConfig","baseSteps"],T),t}function Oce(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["_url","model"],Rn(n,r));const i=v(e,["prompt"]);i!=null&&_(t,["instances[0]","prompt"],i);const a=v(e,["referenceImages"]);if(a!=null){let o=a;Array.isArray(o)&&(o=o.map(u=>Pce(u))),_(t,["instances[0]","referenceImages"],o)}const s=v(e,["config"]);return s!=null&&_(t,["config"],xce(s,t)),t}function Nce(n,e){const t={},r=v(n,["includeRaiReason"]);e!==void 0&&r!=null&&_(e,["parameters","includeRaiReason"],r);const i=v(n,["outputMimeType"]);e!==void 0&&i!=null&&_(e,["parameters","outputOptions","mimeType"],i);const a=v(n,["outputCompressionQuality"]);e!==void 0&&a!=null&&_(e,["parameters","outputOptions","compressionQuality"],a);const s=v(n,["numberOfImages"]);e!==void 0&&s!=null&&_(e,["parameters","sampleCount"],s);const o=v(n,["mode"]);return e!==void 0&&o!=null&&_(e,["parameters","mode"],o),t}function kce(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["_url","model"],Rn(n,r));const i=v(e,["image"]);i!=null&&_(t,["instances[0]","image"],Ab(i));const a=v(e,["upscaleFactor"]);a!=null&&_(t,["parameters","upscaleConfig","upscaleFactor"],a);const s=v(e,["config"]);return s!=null&&_(t,["config"],Nce(s,t)),t}function Mce(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["_url","name"],Rn(n,r));const i=v(e,["config"]);return i!=null&&_(t,["config"],i),t}function Dce(n,e,t){const r={},i=v(e,["pageSize"]);t!==void 0&&i!=null&&_(t,["_query","pageSize"],i);const a=v(e,["pageToken"]);t!==void 0&&a!=null&&_(t,["_query","pageToken"],a);const s=v(e,["filter"]);t!==void 0&&s!=null&&_(t,["_query","filter"],s);const o=v(e,["queryBase"]);return t!==void 0&&o!=null&&_(t,["_url","models_url"],Eq(n,o)),r}function $ce(n,e){const t={},r=v(e,["config"]);return r!=null&&_(t,["config"],Dce(n,r,t)),t}function Lce(n,e){const t={},r=v(n,["displayName"]);e!==void 0&&r!=null&&_(e,["displayName"],r);const i=v(n,["description"]);e!==void 0&&i!=null&&_(e,["description"],i);const a=v(n,["defaultCheckpointId"]);return e!==void 0&&a!=null&&_(e,["defaultCheckpointId"],a),t}function Uce(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["_url","model"],Rn(n,r));const i=v(e,["config"]);return i!=null&&_(t,["config"],Lce(i,t)),t}function jce(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["_url","name"],Rn(n,r));const i=v(e,["config"]);return i!=null&&_(t,["config"],i),t}function Fce(n,e){const t={},r=v(n,["systemInstruction"]);e!==void 0&&r!=null&&_(e,["systemInstruction"],bd(ci(r)));const i=v(n,["tools"]);if(e!==void 0&&i!=null){let s=i;Array.isArray(s)&&(s=s.map(o=>Oq(o))),_(e,["tools"],s)}const a=v(n,["generationConfig"]);return e!==void 0&&a!=null&&_(e,["generationConfig"],a),t}function Bce(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["_url","model"],Rn(n,r));const i=v(e,["contents"]);if(i!=null){let s=cs(i);Array.isArray(s)&&(s=s.map(o=>bd(o))),_(t,["contents"],s)}const a=v(e,["config"]);return a!=null&&_(t,["config"],Fce(a,t)),t}function qce(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["_url","model"],Rn(n,r));const i=v(e,["contents"]);if(i!=null){let s=cs(i);Array.isArray(s)&&(s=s.map(o=>bd(o))),_(t,["contents"],s)}const a=v(e,["config"]);return a!=null&&_(t,["config"],a),t}function Vce(n){const e={},t=v(n,["uri"]);t!=null&&_(e,["gcsUri"],t);const r=v(n,["videoBytes"]);r!=null&&_(e,["bytesBase64Encoded"],qo(r));const i=v(n,["mimeType"]);return i!=null&&_(e,["mimeType"],i),e}function zce(n,e){const t={},r=v(n,["numberOfVideos"]);e!==void 0&&r!=null&&_(e,["parameters","sampleCount"],r);const i=v(n,["outputGcsUri"]);e!==void 0&&i!=null&&_(e,["parameters","storageUri"],i);const a=v(n,["fps"]);e!==void 0&&a!=null&&_(e,["parameters","fps"],a);const s=v(n,["durationSeconds"]);e!==void 0&&s!=null&&_(e,["parameters","durationSeconds"],s);const o=v(n,["seed"]);e!==void 0&&o!=null&&_(e,["parameters","seed"],o);const u=v(n,["aspectRatio"]);e!==void 0&&u!=null&&_(e,["parameters","aspectRatio"],u);const c=v(n,["resolution"]);e!==void 0&&c!=null&&_(e,["parameters","resolution"],c);const d=v(n,["personGeneration"]);e!==void 0&&d!=null&&_(e,["parameters","personGeneration"],d);const p=v(n,["pubsubTopic"]);e!==void 0&&p!=null&&_(e,["parameters","pubsubTopic"],p);const m=v(n,["negativePrompt"]);e!==void 0&&m!=null&&_(e,["parameters","negativePrompt"],m);const y=v(n,["enhancePrompt"]);e!==void 0&&y!=null&&_(e,["parameters","enhancePrompt"],y);const b=v(n,["generateAudio"]);e!==void 0&&b!=null&&_(e,["parameters","generateAudio"],b);const w=v(n,["lastFrame"]);return e!==void 0&&w!=null&&_(e,["instances[0]","lastFrame"],Ab(w)),t}function Hce(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["_url","model"],Rn(n,r));const i=v(e,["prompt"]);i!=null&&_(t,["instances[0]","prompt"],i);const a=v(e,["image"]);a!=null&&_(t,["instances[0]","image"],Ab(a));const s=v(e,["video"]);s!=null&&_(t,["instances[0]","video"],Vce(s));const o=v(e,["config"]);return o!=null&&_(t,["config"],zce(o,t)),t}function Gce(n){const e={},t=v(n,["fps"]);t!=null&&_(e,["fps"],t);const r=v(n,["endOffset"]);r!=null&&_(e,["endOffset"],r);const i=v(n,["startOffset"]);return i!=null&&_(e,["startOffset"],i),e}function Wce(n){const e={},t=v(n,["data"]);t!=null&&_(e,["data"],t);const r=v(n,["mimeType"]);return r!=null&&_(e,["mimeType"],r),e}function Kce(n){const e={},t=v(n,["fileUri"]);t!=null&&_(e,["fileUri"],t);const r=v(n,["mimeType"]);return r!=null&&_(e,["mimeType"],r),e}function Jce(n){const e={},t=v(n,["videoMetadata"]);t!=null&&_(e,["videoMetadata"],Gce(t));const r=v(n,["thought"]);r!=null&&_(e,["thought"],r);const i=v(n,["inlineData"]);i!=null&&_(e,["inlineData"],Wce(i));const a=v(n,["fileData"]);a!=null&&_(e,["fileData"],Kce(a));const s=v(n,["thoughtSignature"]);s!=null&&_(e,["thoughtSignature"],s);const o=v(n,["codeExecutionResult"]);o!=null&&_(e,["codeExecutionResult"],o);const u=v(n,["executableCode"]);u!=null&&_(e,["executableCode"],u);const c=v(n,["functionCall"]);c!=null&&_(e,["functionCall"],c);const d=v(n,["functionResponse"]);d!=null&&_(e,["functionResponse"],d);const p=v(n,["text"]);return p!=null&&_(e,["text"],p),e}function Yce(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>Jce(a))),_(e,["parts"],i)}const r=v(n,["role"]);return r!=null&&_(e,["role"],r),e}function Zce(n){const e={},t=v(n,["citationSources"]);return t!=null&&_(e,["citations"],t),e}function Xce(n){const e={},t=v(n,["retrievedUrl"]);t!=null&&_(e,["retrievedUrl"],t);const r=v(n,["urlRetrievalStatus"]);return r!=null&&_(e,["urlRetrievalStatus"],r),e}function Qce(n){const e={},t=v(n,["urlMetadata"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>Xce(i))),_(e,["urlMetadata"],r)}return e}function efe(n){const e={},t=v(n,["content"]);t!=null&&_(e,["content"],Yce(t));const r=v(n,["citationMetadata"]);r!=null&&_(e,["citationMetadata"],Zce(r));const i=v(n,["tokenCount"]);i!=null&&_(e,["tokenCount"],i);const a=v(n,["finishReason"]);a!=null&&_(e,["finishReason"],a);const s=v(n,["urlContextMetadata"]);s!=null&&_(e,["urlContextMetadata"],Qce(s));const o=v(n,["avgLogprobs"]);o!=null&&_(e,["avgLogprobs"],o);const u=v(n,["groundingMetadata"]);u!=null&&_(e,["groundingMetadata"],u);const c=v(n,["index"]);c!=null&&_(e,["index"],c);const d=v(n,["logprobsResult"]);d!=null&&_(e,["logprobsResult"],d);const p=v(n,["safetyRatings"]);return p!=null&&_(e,["safetyRatings"],p),e}function i2(n){const e={},t=v(n,["candidates"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>efe(o))),_(e,["candidates"],s)}const r=v(n,["modelVersion"]);r!=null&&_(e,["modelVersion"],r);const i=v(n,["promptFeedback"]);i!=null&&_(e,["promptFeedback"],i);const a=v(n,["usageMetadata"]);return a!=null&&_(e,["usageMetadata"],a),e}function tfe(n){const e={},t=v(n,["values"]);return t!=null&&_(e,["values"],t),e}function nfe(){return{}}function rfe(n){const e={},t=v(n,["embeddings"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>tfe(a))),_(e,["embeddings"],i)}return v(n,["metadata"])!=null&&_(e,["metadata"],nfe()),e}function ife(n){const e={},t=v(n,["bytesBase64Encoded"]);t!=null&&_(e,["imageBytes"],qo(t));const r=v(n,["mimeType"]);return r!=null&&_(e,["mimeType"],r),e}function Nq(n){const e={},t=v(n,["safetyAttributes","categories"]);t!=null&&_(e,["categories"],t);const r=v(n,["safetyAttributes","scores"]);r!=null&&_(e,["scores"],r);const i=v(n,["contentType"]);return i!=null&&_(e,["contentType"],i),e}function afe(n){const e={},t=v(n,["_self"]);t!=null&&_(e,["image"],ife(t));const r=v(n,["raiFilteredReason"]);r!=null&&_(e,["raiFilteredReason"],r);const i=v(n,["_self"]);return i!=null&&_(e,["safetyAttributes"],Nq(i)),e}function sfe(n){const e={},t=v(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>afe(a))),_(e,["generatedImages"],i)}const r=v(n,["positivePromptSafetyAttributes"]);return r!=null&&_(e,["positivePromptSafetyAttributes"],Nq(r)),e}function ofe(n){const e={},t=v(n,["baseModel"]);t!=null&&_(e,["baseModel"],t);const r=v(n,["createTime"]);r!=null&&_(e,["createTime"],r);const i=v(n,["updateTime"]);return i!=null&&_(e,["updateTime"],i),e}function rR(n){const e={},t=v(n,["name"]);t!=null&&_(e,["name"],t);const r=v(n,["displayName"]);r!=null&&_(e,["displayName"],r);const i=v(n,["description"]);i!=null&&_(e,["description"],i);const a=v(n,["version"]);a!=null&&_(e,["version"],a);const s=v(n,["_self"]);s!=null&&_(e,["tunedModelInfo"],ofe(s));const o=v(n,["inputTokenLimit"]);o!=null&&_(e,["inputTokenLimit"],o);const u=v(n,["outputTokenLimit"]);u!=null&&_(e,["outputTokenLimit"],u);const c=v(n,["supportedGenerationMethods"]);return c!=null&&_(e,["supportedActions"],c),e}function lfe(n,e){const t={},r=v(e,["nextPageToken"]);r!=null&&_(t,["nextPageToken"],r);const i=v(e,["_self"]);if(i!=null){let a=Sq(i);Array.isArray(a)&&(a=a.map(s=>rR(s))),_(t,["models"],a)}return t}function ufe(){return{}}function cfe(n){const e={},t=v(n,["totalTokens"]);t!=null&&_(e,["totalTokens"],t);const r=v(n,["cachedContentTokenCount"]);return r!=null&&_(e,["cachedContentTokenCount"],r),e}function ffe(n){const e={},t=v(n,["video","uri"]);t!=null&&_(e,["uri"],t);const r=v(n,["video","encodedVideo"]);r!=null&&_(e,["videoBytes"],qo(r));const i=v(n,["encoding"]);return i!=null&&_(e,["mimeType"],i),e}function dfe(n){const e={},t=v(n,["_self"]);return t!=null&&_(e,["video"],ffe(t)),e}function hfe(n){const e={},t=v(n,["generatedSamples"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(s=>dfe(s))),_(e,["generatedVideos"],a)}const r=v(n,["raiMediaFilteredCount"]);r!=null&&_(e,["raiMediaFilteredCount"],r);const i=v(n,["raiMediaFilteredReasons"]);return i!=null&&_(e,["raiMediaFilteredReasons"],i),e}function pfe(n){const e={},t=v(n,["name"]);t!=null&&_(e,["name"],t);const r=v(n,["metadata"]);r!=null&&_(e,["metadata"],r);const i=v(n,["done"]);i!=null&&_(e,["done"],i);const a=v(n,["error"]);a!=null&&_(e,["error"],a);const s=v(n,["response","generateVideoResponse"]);return s!=null&&_(e,["response"],hfe(s)),e}function mfe(n){const e={},t=v(n,["fps"]);t!=null&&_(e,["fps"],t);const r=v(n,["endOffset"]);r!=null&&_(e,["endOffset"],r);const i=v(n,["startOffset"]);return i!=null&&_(e,["startOffset"],i),e}function gfe(n){const e={},t=v(n,["displayName"]);t!=null&&_(e,["displayName"],t);const r=v(n,["data"]);r!=null&&_(e,["data"],r);const i=v(n,["mimeType"]);return i!=null&&_(e,["mimeType"],i),e}function yfe(n){const e={},t=v(n,["displayName"]);t!=null&&_(e,["displayName"],t);const r=v(n,["fileUri"]);r!=null&&_(e,["fileUri"],r);const i=v(n,["mimeType"]);return i!=null&&_(e,["mimeType"],i),e}function vfe(n){const e={},t=v(n,["videoMetadata"]);t!=null&&_(e,["videoMetadata"],mfe(t));const r=v(n,["thought"]);r!=null&&_(e,["thought"],r);const i=v(n,["inlineData"]);i!=null&&_(e,["inlineData"],gfe(i));const a=v(n,["fileData"]);a!=null&&_(e,["fileData"],yfe(a));const s=v(n,["thoughtSignature"]);s!=null&&_(e,["thoughtSignature"],s);const o=v(n,["codeExecutionResult"]);o!=null&&_(e,["codeExecutionResult"],o);const u=v(n,["executableCode"]);u!=null&&_(e,["executableCode"],u);const c=v(n,["functionCall"]);c!=null&&_(e,["functionCall"],c);const d=v(n,["functionResponse"]);d!=null&&_(e,["functionResponse"],d);const p=v(n,["text"]);return p!=null&&_(e,["text"],p),e}function _fe(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>vfe(a))),_(e,["parts"],i)}const r=v(n,["role"]);return r!=null&&_(e,["role"],r),e}function bfe(n){const e={},t=v(n,["citations"]);return t!=null&&_(e,["citations"],t),e}function wfe(n){const e={},t=v(n,["retrievedUrl"]);t!=null&&_(e,["retrievedUrl"],t);const r=v(n,["urlRetrievalStatus"]);return r!=null&&_(e,["urlRetrievalStatus"],r),e}function Efe(n){const e={},t=v(n,["urlMetadata"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>wfe(i))),_(e,["urlMetadata"],r)}return e}function Sfe(n){const e={},t=v(n,["content"]);t!=null&&_(e,["content"],_fe(t));const r=v(n,["citationMetadata"]);r!=null&&_(e,["citationMetadata"],bfe(r));const i=v(n,["finishMessage"]);i!=null&&_(e,["finishMessage"],i);const a=v(n,["finishReason"]);a!=null&&_(e,["finishReason"],a);const s=v(n,["urlContextMetadata"]);s!=null&&_(e,["urlContextMetadata"],Efe(s));const o=v(n,["avgLogprobs"]);o!=null&&_(e,["avgLogprobs"],o);const u=v(n,["groundingMetadata"]);u!=null&&_(e,["groundingMetadata"],u);const c=v(n,["index"]);c!=null&&_(e,["index"],c);const d=v(n,["logprobsResult"]);d!=null&&_(e,["logprobsResult"],d);const p=v(n,["safetyRatings"]);return p!=null&&_(e,["safetyRatings"],p),e}function a2(n){const e={},t=v(n,["candidates"]);if(t!=null){let u=t;Array.isArray(u)&&(u=u.map(c=>Sfe(c))),_(e,["candidates"],u)}const r=v(n,["createTime"]);r!=null&&_(e,["createTime"],r);const i=v(n,["responseId"]);i!=null&&_(e,["responseId"],i);const a=v(n,["modelVersion"]);a!=null&&_(e,["modelVersion"],a);const s=v(n,["promptFeedback"]);s!=null&&_(e,["promptFeedback"],s);const o=v(n,["usageMetadata"]);return o!=null&&_(e,["usageMetadata"],o),e}function Tfe(n){const e={},t=v(n,["truncated"]);t!=null&&_(e,["truncated"],t);const r=v(n,["token_count"]);return r!=null&&_(e,["tokenCount"],r),e}function Afe(n){const e={},t=v(n,["values"]);t!=null&&_(e,["values"],t);const r=v(n,["statistics"]);return r!=null&&_(e,["statistics"],Tfe(r)),e}function Cfe(n){const e={},t=v(n,["billableCharacterCount"]);return t!=null&&_(e,["billableCharacterCount"],t),e}function Rfe(n){const e={},t=v(n,["predictions[]","embeddings"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>Afe(a))),_(e,["embeddings"],i)}const r=v(n,["metadata"]);return r!=null&&_(e,["metadata"],Cfe(r)),e}function Ife(n){const e={},t=v(n,["gcsUri"]);t!=null&&_(e,["gcsUri"],t);const r=v(n,["bytesBase64Encoded"]);r!=null&&_(e,["imageBytes"],qo(r));const i=v(n,["mimeType"]);return i!=null&&_(e,["mimeType"],i),e}function kq(n){const e={},t=v(n,["safetyAttributes","categories"]);t!=null&&_(e,["categories"],t);const r=v(n,["safetyAttributes","scores"]);r!=null&&_(e,["scores"],r);const i=v(n,["contentType"]);return i!=null&&_(e,["contentType"],i),e}function cP(n){const e={},t=v(n,["_self"]);t!=null&&_(e,["image"],Ife(t));const r=v(n,["raiFilteredReason"]);r!=null&&_(e,["raiFilteredReason"],r);const i=v(n,["_self"]);i!=null&&_(e,["safetyAttributes"],kq(i));const a=v(n,["prompt"]);return a!=null&&_(e,["enhancedPrompt"],a),e}function Pfe(n){const e={},t=v(n,["predictions"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>cP(a))),_(e,["generatedImages"],i)}const r=v(n,["positivePromptSafetyAttributes"]);return r!=null&&_(e,["positivePromptSafetyAttributes"],kq(r)),e}function xfe(n){const e={},t=v(n,["predictions"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>cP(i))),_(e,["generatedImages"],r)}return e}function Ofe(n){const e={},t=v(n,["predictions"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>cP(i))),_(e,["generatedImages"],r)}return e}function Nfe(n){const e={},t=v(n,["endpoint"]);t!=null&&_(e,["name"],t);const r=v(n,["deployedModelId"]);return r!=null&&_(e,["deployedModelId"],r),e}function kfe(n){const e={},t=v(n,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&_(e,["baseModel"],t);const r=v(n,["createTime"]);r!=null&&_(e,["createTime"],r);const i=v(n,["updateTime"]);return i!=null&&_(e,["updateTime"],i),e}function Mfe(n){const e={},t=v(n,["checkpointId"]);t!=null&&_(e,["checkpointId"],t);const r=v(n,["epoch"]);r!=null&&_(e,["epoch"],r);const i=v(n,["step"]);return i!=null&&_(e,["step"],i),e}function iR(n){const e={},t=v(n,["name"]);t!=null&&_(e,["name"],t);const r=v(n,["displayName"]);r!=null&&_(e,["displayName"],r);const i=v(n,["description"]);i!=null&&_(e,["description"],i);const a=v(n,["versionId"]);a!=null&&_(e,["version"],a);const s=v(n,["deployedModels"]);if(s!=null){let p=s;Array.isArray(p)&&(p=p.map(m=>Nfe(m))),_(e,["endpoints"],p)}const o=v(n,["labels"]);o!=null&&_(e,["labels"],o);const u=v(n,["_self"]);u!=null&&_(e,["tunedModelInfo"],kfe(u));const c=v(n,["defaultCheckpointId"]);c!=null&&_(e,["defaultCheckpointId"],c);const d=v(n,["checkpoints"]);if(d!=null){let p=d;Array.isArray(p)&&(p=p.map(m=>Mfe(m))),_(e,["checkpoints"],p)}return e}function Dfe(n,e){const t={},r=v(e,["nextPageToken"]);r!=null&&_(t,["nextPageToken"],r);const i=v(e,["_self"]);if(i!=null){let a=Sq(i);Array.isArray(a)&&(a=a.map(s=>iR(s))),_(t,["models"],a)}return t}function $fe(){return{}}function Lfe(n){const e={},t=v(n,["totalTokens"]);return t!=null&&_(e,["totalTokens"],t),e}function Ufe(n){const e={},t=v(n,["tokensInfo"]);return t!=null&&_(e,["tokensInfo"],t),e}function jfe(n){const e={},t=v(n,["gcsUri"]);t!=null&&_(e,["uri"],t);const r=v(n,["bytesBase64Encoded"]);r!=null&&_(e,["videoBytes"],qo(r));const i=v(n,["mimeType"]);return i!=null&&_(e,["mimeType"],i),e}function Ffe(n){const e={},t=v(n,["_self"]);return t!=null&&_(e,["video"],jfe(t)),e}function Bfe(n){const e={},t=v(n,["videos"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(s=>Ffe(s))),_(e,["generatedVideos"],a)}const r=v(n,["raiMediaFilteredCount"]);r!=null&&_(e,["raiMediaFilteredCount"],r);const i=v(n,["raiMediaFilteredReasons"]);return i!=null&&_(e,["raiMediaFilteredReasons"],i),e}function qfe(n){const e={},t=v(n,["name"]);t!=null&&_(e,["name"],t);const r=v(n,["metadata"]);r!=null&&_(e,["metadata"],r);const i=v(n,["done"]);i!=null&&_(e,["done"],i);const a=v(n,["error"]);a!=null&&_(e,["error"],a);const s=v(n,["response"]);return s!=null&&_(e,["response"],Bfe(s)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Vfe="Content-Type",zfe="X-Server-Timeout",Hfe="User-Agent",aR="x-goog-api-client",Gfe="1.6.0",Wfe=`google-genai-sdk/${Gfe}`,Kfe="v1beta1",Jfe="v1beta",s2=/^data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class Yfe{constructor(e){var t,r;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const i={};this.clientOptions.vertexai?(i.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:Kfe,i.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(i.apiVersion=(r=this.clientOptions.apiVersion)!==null&&r!==void 0?r:Jfe,i.baseUrl="https://generativelanguage.googleapis.com/"),i.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=i,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(i,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const r=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&r.push(e.apiVersion),r.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,r){const i=[this.getRequestUrlInternal(t)];return r&&i.push(this.getBaseResourcePath()),e!==""&&i.push(e),new URL(`${i.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,r);if(e.queryParams)for(const[s,o]of Object.entries(e.queryParams))i.searchParams.append(s,String(o));let a={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else a.body=e.body;return a=await this.includeExtraHttpOptionsToRequestInit(a,t,e.abortSignal),this.unaryApiCall(i,a,e.httpMethod)}patchHttpOptions(e,t){const r=JSON.parse(JSON.stringify(e));for(const[i,a]of Object.entries(t))typeof a=="object"?r[i]=Object.assign(Object.assign({},r[i]),a):a!==void 0&&(r[i]=a);return r}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const r=this.shouldPrependVertexProjectPath(e),i=this.constructUrl(e.path,t,r);(!i.searchParams.has("alt")||i.searchParams.get("alt")!=="sse")&&i.searchParams.set("alt","sse");let a={};return a.body=e.body,a=await this.includeExtraHttpOptionsToRequestInit(a,t,e.abortSignal),this.streamApiCall(i,a,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,r){if(t&&t.timeout||r){const i=new AbortController,a=i.signal;t.timeout&&(t==null?void 0:t.timeout)>0&&setTimeout(()=>i.abort(),t.timeout),r&&r.addEventListener("abort",()=>{i.abort()}),e.signal=a}return t&&t.extraBody!==null&&Zfe(e,t.extraBody),e.headers=await this.getHeadersInternal(t),e}async unaryApiCall(e,t,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:r})).then(async i=>(await o2(i),new Q1(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}async streamApiCall(e,t,r){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:r})).then(async i=>(await o2(i),this.processStreamResponse(i))).catch(i=>{throw i instanceof Error?i:new Error(JSON.stringify(i))})}processStreamResponse(e){var t;return zf(this,arguments,function*(){const i=(t=e==null?void 0:e.body)===null||t===void 0?void 0:t.getReader(),a=new TextDecoder("utf-8");if(!i)throw new Error("Response body is empty");try{let s="";for(;;){const{done:o,value:u}=yield In(i.read());if(o){if(s.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const c=a.decode(u);try{const p=JSON.parse(c);if("error"in p){const m=JSON.parse(JSON.stringify(p.error)),y=m.status,b=m.code,w=`got status: ${y}. ${JSON.stringify(p)}`;if(b>=400&&b<600)throw new Sb({message:w,status:b})}}catch(p){if(p.name==="ApiError")throw p}s+=c;let d=s.match(s2);for(;d;){const p=d[1];try{const m=new Response(p,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield In(new Q1(m)),s=s.slice(d[0].length),d=s.match(s2)}catch(m){throw new Error(`exception parsing stream chunk ${p}. ${m}`)}}}}finally{i.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(r=>{throw new Error(`exception ${r} sending request`)})}getDefaultHeaders(){const e={},t=Wfe+" "+this.clientOptions.userAgentExtra;return e[Hfe]=t,e[aR]=t,e[Vfe]="application/json",e}async getHeadersInternal(e){const t=new Headers;if(e&&e.headers){for(const[r,i]of Object.entries(e.headers))t.append(r,i);e.timeout&&e.timeout>0&&t.append(zfe,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(t),t}async uploadFile(e,t){var r;const i={};t!=null&&(i.mimeType=t.mimeType,i.name=t.name,i.displayName=t.displayName),i.name&&!i.name.startsWith("files/")&&(i.name=`files/${i.name}`);const a=this.clientOptions.uploader,s=await a.stat(e);i.sizeBytes=String(s.size);const o=(r=t==null?void 0:t.mimeType)!==null&&r!==void 0?r:s.type;if(o===void 0||o==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");i.mimeType=o;const u=await this.fetchUploadUrl(i,t);return a.upload(e,u,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t){var r;let i={};t!=null&&t.httpOptions?i=t.httpOptions:i={apiVersion:"",headers:{"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${e.sizeBytes}`,"X-Goog-Upload-Header-Content-Type":`${e.mimeType}`}};const a={file:e},s=await this.request({path:wt("upload/v1beta/files",a._url),body:JSON.stringify(a),httpMethod:"POST",httpOptions:i});if(!s||!(s!=null&&s.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const o=(r=s==null?void 0:s.headers)===null||r===void 0?void 0:r["x-goog-upload-url"];if(o===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return o}}async function o2(n){var e;if(n===void 0)throw new Error("response is undefined");if(!n.ok){const t=n.status;let r;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?r=await n.json():r={error:{message:await n.text(),code:n.status,status:n.statusText}};const i=JSON.stringify(r);throw t>=400&&t<600?new Sb({message:i,status:t}):new Error(i)}}function Zfe(n,e){if(!e||Object.keys(e).length===0)return;if(n.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof n.body=="string"&&n.body.length>0)try{const a=JSON.parse(n.body);if(typeof a=="object"&&a!==null&&!Array.isArray(a))t=a;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function r(a,s){const o=Object.assign({},a);for(const u in s)if(Object.prototype.hasOwnProperty.call(s,u)){const c=s[u],d=o[u];c&&typeof c=="object"&&!Array.isArray(c)&&d&&typeof d=="object"&&!Array.isArray(d)?o[u]=r(d,c):(d&&c&&typeof d!=typeof c&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${u}". Original type: ${typeof d}, New type: ${typeof c}. Overwriting.`),o[u]=c)}return o}const i=r(t,e);n.body=JSON.stringify(i)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Xfe="mcp_used/unknown";function Mq(n){for(const e of n)if(fP(e)||typeof e=="object"&&"inputSchema"in e)return!0;return!1}function Dq(n){var e;const t=(e=n[aR])!==null&&e!==void 0?e:"";n[aR]=(t+` ${Xfe}`).trimStart()}function Qfe(n){var e,t,r;return(r=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(i=>fP(i)))!==null&&r!==void 0?r:!1}function ede(n){var e,t,r;return(r=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(i=>!fP(i)))!==null&&r!==void 0?r:!1}function fP(n){return n!==null&&typeof n=="object"&&n instanceof dP}function tde(n,e=100){return zf(this,arguments,function*(){let r,i=0;for(;i<e;){const a=yield In(n.listTools({cursor:r}));for(const s of a.tools)yield yield In(s),i++;if(!a.nextCursor)break;r=a.nextCursor}})}class dP{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new dP(e,t)}async initialize(){var e,t,r,i;if(this.mcpTools.length>0)return;const a={},s=[];for(const d of this.mcpClients)try{for(var o=!0,u=(t=void 0,vp(tde(d))),c;c=await u.next(),e=c.done,!e;o=!0){i=c.value,o=!1;const p=i;s.push(p);const m=p.name;if(a[m])throw new Error(`Duplicate function name ${m} found in MCP tools. Please ensure function names are unique.`);a[m]=d}}catch(p){t={error:p}}finally{try{!o&&!e&&(r=u.return)&&await r.call(u)}finally{if(t)throw t.error}}this.mcpTools=s,this.functionNameToMcpClient=a}async tool(){return await this.initialize(),tse(this.mcpTools,this.config)}async callTool(e){await this.initialize();const t=[];for(const r of e)if(r.name in this.functionNameToMcpClient){const i=this.functionNameToMcpClient[r.name];let a;this.config.timeout&&(a={timeout:this.config.timeout});const s=await i.callTool({name:r.name,arguments:r.args},void 0,a);t.push({functionResponse:{name:r.name,response:s.isError?{error:s}:s}})}return t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function nde(n,e,t){const r=new qae;let i;t.data instanceof Blob?i=JSON.parse(await t.data.text()):i=JSON.parse(t.data);const a=cue(i);Object.assign(r,a),e(r)}class rde{constructor(e,t,r){this.apiClient=e,this.auth=t,this.webSocketFactory=r}async connect(e){var t,r;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const i=this.apiClient.getWebsocketBaseUrl(),a=this.apiClient.getApiVersion(),s=sde(this.apiClient.getDefaultHeaders()),o=this.apiClient.getApiKey(),u=`${i}/ws/google.ai.generativelanguage.${a}.GenerativeService.BidiGenerateMusic?key=${o}`;let c=()=>{};const d=new Promise(A=>{c=A}),p=e.callbacks,m=function(){c({})},y=this.apiClient,b={onopen:m,onmessage:A=>{nde(y,p.onmessage,A)},onerror:(t=p==null?void 0:p.onerror)!==null&&t!==void 0?t:function(A){},onclose:(r=p==null?void 0:p.onclose)!==null&&r!==void 0?r:function(A){}},w=this.webSocketFactory.create(u,ade(s),b);w.connect(),await d;const S=Rn(this.apiClient,e.model),T=Iq({model:S}),C=nR({setup:T});return w.send(JSON.stringify(C)),new ide(w,this.apiClient)}}class ide{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=Tle(e),r=Pq(t);this.conn.send(JSON.stringify({clientContent:r}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=Ale(e),r=nR(t);this.conn.send(JSON.stringify(r))}sendPlaybackControl(e){const t=nR({playbackControl:e});this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(Of.PLAY)}pause(){this.sendPlaybackControl(Of.PAUSE)}stop(){this.sendPlaybackControl(Of.STOP)}resetContext(){this.sendPlaybackControl(Of.RESET_CONTEXT)}close(){this.conn.close()}}function ade(n){const e={};return n.forEach((t,r)=>{e[r]=t}),e}function sde(n){const e=new Headers;for(const[t,r]of Object.entries(n))e.append(t,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ode="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function lde(n,e,t){const r=new Bae;let i;if(t.data instanceof Blob?i=JSON.parse(await t.data.text()):i=JSON.parse(t.data),n.isVertexAI()){const a=tue(i);Object.assign(r,a)}else{const a=eue(i);Object.assign(r,a)}e(r)}class ude{constructor(e,t,r){this.apiClient=e,this.auth=t,this.webSocketFactory=r,this.music=new rde(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,r,i,a,s,o;const u=this.apiClient.getWebsocketBaseUrl(),c=this.apiClient.getApiVersion();let d;const p=this.apiClient.getDefaultHeaders();e.config&&e.config.tools&&Mq(e.config.tools)&&Dq(p);const m=hde(p);if(this.apiClient.isVertexAI())d=`${u}/ws/google.cloud.aiplatform.${c}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(m);else{const B=this.apiClient.getApiKey();let q="BidiGenerateContent",J="key";B!=null&&B.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),q="BidiGenerateContentConstrained",J="access_token"),d=`${u}/ws/google.ai.generativelanguage.${c}.GenerativeService.${q}?${J}=${B}`}let y=()=>{};const b=new Promise(B=>{y=B}),w=e.callbacks,S=function(){var B;(B=w==null?void 0:w.onopen)===null||B===void 0||B.call(w),y({})},T=this.apiClient,C={onopen:S,onmessage:B=>{lde(T,w.onmessage,B)},onerror:(t=w==null?void 0:w.onerror)!==null&&t!==void 0?t:function(B){},onclose:(r=w==null?void 0:w.onclose)!==null&&r!==void 0?r:function(B){}},A=this.webSocketFactory.create(d,dde(m),C);A.connect(),await b;let I=Rn(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&I.startsWith("publishers/")){const B=this.apiClient.getProject(),q=this.apiClient.getLocation();I=`projects/${B}/locations/${q}/`+I}let x={};this.apiClient.isVertexAI()&&((i=e.config)===null||i===void 0?void 0:i.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[f_.AUDIO]}:e.config.responseModalities=[f_.AUDIO]),!((a=e.config)===null||a===void 0)&&a.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const L=(o=(s=e.config)===null||s===void 0?void 0:s.tools)!==null&&o!==void 0?o:[],U=[];for(const B of L)if(this.isCallableTool(B)){const q=B;U.push(await q.tool())}else U.push(B);U.length>0&&(e.config.tools=U);const N={model:I,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?x=yle(this.apiClient,N):x=gle(this.apiClient,N),delete x.config,A.send(JSON.stringify(x)),new fde(A,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const cde={turnComplete:!0};class fde{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let r=[];try{r=cs(t.turns),e.isVertexAI()?r=r.map(i=>bd(i)):r=r.map(i=>Tb(i))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:r,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let r=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?r=t.functionResponses:r=[t.functionResponses],r.length===0)throw new Error("functionResponses is required.");for(const a of r){if(typeof a!="object"||a===null||!("name"in a)||!("response"in a))throw new Error(`Could not parse function response, type '${typeof a}'.`);if(!e.isVertexAI()&&!("id"in a))throw new Error(ode)}return{toolResponse:{functionResponses:r}}}sendClientContent(e){e=Object.assign(Object.assign({},cde),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:Sle(e)}:t={realtimeInput:Ele(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function dde(n){const e={};return n.forEach((t,r)=>{e[r]=t}),e}function hde(n){const e=new Headers;for(const[t,r]of Object.entries(n))e.append(t,r);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const l2=10;function u2(n){var e,t,r;if(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let i=!1;for(const s of(t=n==null?void 0:n.tools)!==null&&t!==void 0?t:[])if(dv(s)){i=!0;break}if(!i)return!0;const a=(r=n==null?void 0:n.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls;return a&&(a<0||!Number.isInteger(a))||a==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",a),!0):!1}function dv(n){return"callTool"in n&&typeof n.callTool=="function"}function c2(n){var e;return!(!((e=n==null?void 0:n.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class pde extends _d{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var r,i,a,s,o;const u=await this.processParamsForMcpUsage(t);if(!Qfe(t)||u2(t.config))return await this.generateContentInternal(u);if(ede(t))throw new Error("Automatic function calling with CallableTools and Tools is not yet supported.");let c,d;const p=cs(u.contents),m=(a=(i=(r=u.config)===null||r===void 0?void 0:r.automaticFunctionCalling)===null||i===void 0?void 0:i.maximumRemoteCalls)!==null&&a!==void 0?a:l2;let y=0;for(;y<m&&(c=await this.generateContentInternal(u),!(!c.functionCalls||c.functionCalls.length===0));){const b=c.candidates[0].content,w=[];for(const S of(o=(s=t.config)===null||s===void 0?void 0:s.tools)!==null&&o!==void 0?o:[])if(dv(S)){const C=await S.callTool(c.functionCalls);w.push(...C)}y++,d={role:"user",parts:w},u.contents=cs(u.contents),u.contents.push(b),u.contents.push(d),c2(u.config)&&(p.push(b),p.push(d))}return c2(u.config)&&(c.automaticFunctionCallingHistory=p),c},this.generateContentStream=async t=>{if(u2(t.config)){const r=await this.processParamsForMcpUsage(t);return await this.generateContentStreamInternal(r)}else return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(r=>{var i;let a;const s=[];if(r!=null&&r.generatedImages)for(const u of r.generatedImages)u&&(u!=null&&u.safetyAttributes)&&((i=u==null?void 0:u.safetyAttributes)===null||i===void 0?void 0:i.contentType)==="Positive Prompt"?a=u==null?void 0:u.safetyAttributes:s.push(u);let o;return a?o={generatedImages:s,positivePromptSafetyAttributes:a}:o={generatedImages:s},o}),this.list=async t=>{var r;const s={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!s.config.queryBase){if(!((r=s.config)===null||r===void 0)&&r.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");s.config.filter="labels.tune-type:*"}return new Eb(rd.PAGED_ITEM_MODELS,o=>this.listInternal(o),await this.listInternal(s),s)},this.editImage=async t=>{const r={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(r.referenceImages=t.referenceImages.map(i=>i.toReferenceImageAPI())),await this.editImageInternal(r)},this.upscaleImage=async t=>{let r={numberOfImages:1,mode:"upscale"};t.config&&(r=Object.assign(Object.assign({},r),t.config));const i={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:r};return await this.upscaleImageInternal(i)}}async processParamsForMcpUsage(e){var t,r,i;const a=(t=e.config)===null||t===void 0?void 0:t.tools;if(!a)return e;const s=await Promise.all(a.map(async u=>dv(u)?await u.tool():u)),o={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:s})};if(o.config.tools=s,e.config&&e.config.tools&&Mq(e.config.tools)){const u=(i=(r=e.config.httpOptions)===null||r===void 0?void 0:r.headers)!==null&&i!==void 0?i:{};let c=Object.assign({},u);Object.keys(c).length===0&&(c=this.apiClient.getDefaultHeaders()),Dq(c),o.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:c})}return o}async initAfcToolsMap(e){var t,r,i;const a=new Map;for(const s of(r=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&r!==void 0?r:[])if(dv(s)){const o=s,u=await o.tool();for(const c of(i=u.functionDeclarations)!==null&&i!==void 0?i:[]){if(!c.name)throw new Error("Function declaration name is required.");if(a.has(c.name))throw new Error(`Duplicate tool declaration name: ${c.name}`);a.set(c.name,o)}}return a}async processAfcStream(e){var t,r,i;const a=(i=(r=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||r===void 0?void 0:r.maximumRemoteCalls)!==null&&i!==void 0?i:l2;let s=!1,o=0;const u=await this.initAfcToolsMap(e);return function(c,d,p){var m,y;return zf(this,arguments,function*(){for(var b,w,S,T;o<a;){s&&(o++,s=!1);const x=yield In(c.processParamsForMcpUsage(p)),L=yield In(c.generateContentStreamInternal(x)),U=[],N=[];try{for(var C=!0,A=(w=void 0,vp(L)),I;I=yield In(A.next()),b=I.done,!b;C=!0){T=I.value,C=!1;const B=T;if(yield yield In(B),B.candidates&&(!((m=B.candidates[0])===null||m===void 0)&&m.content)){N.push(B.candidates[0].content);for(const q of(y=B.candidates[0].content.parts)!==null&&y!==void 0?y:[])if(o<a&&q.functionCall){if(!q.functionCall.name)throw new Error("Function call name was not returned by the model.");if(d.has(q.functionCall.name)){const J=yield In(d.get(q.functionCall.name).callTool([q.functionCall]));U.push(...J)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${d.keys()}, mising tool: ${q.functionCall.name}`)}}}}catch(B){w={error:B}}finally{try{!C&&!b&&(S=A.return)&&(yield In(S.call(A)))}finally{if(w)throw w.error}}if(U.length>0){s=!0;const B=new $h;B.candidates=[{content:{role:"user",parts:U}}],yield yield In(B);const q=[];q.push(...N),q.push({role:"user",parts:U});const J=cs(p.contents).concat(q);p.contents=J}else break}})}(this,u,e)}async generateContentInternal(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=r2(this.apiClient,e);return o=wt("{model}:generateContent",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>{const p=a2(d),m=new $h;return Object.assign(m,p),m})}else{const c=n2(this.apiClient,e);return o=wt("{model}:generateContent",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>{const p=i2(d),m=new $h;return Object.assign(m,p),m})}}async generateContentStreamInternal(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=r2(this.apiClient,e);return o=wt("{model}:streamGenerateContent?alt=sse",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.requestStream({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}),s.then(function(p){return zf(this,arguments,function*(){var m,y,b,w;try{for(var S=!0,T=vp(p),C;C=yield In(T.next()),m=C.done,!m;S=!0){w=C.value,S=!1;const I=a2(yield In(w.json())),x=new $h;Object.assign(x,I),yield yield In(x)}}catch(A){y={error:A}}finally{try{!S&&!m&&(b=T.return)&&(yield In(b.call(T)))}finally{if(y)throw y.error}}})})}else{const c=n2(this.apiClient,e);return o=wt("{model}:streamGenerateContent?alt=sse",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.requestStream({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}),s.then(function(p){return zf(this,arguments,function*(){var m,y,b,w;try{for(var S=!0,T=vp(p),C;C=yield In(T.next()),m=C.done,!m;S=!0){w=C.value,S=!1;const I=i2(yield In(w.json())),x=new $h;Object.assign(x,I),yield yield In(x)}}catch(A){y={error:A}}finally{try{!S&&!m&&(b=T.return)&&(yield In(b.call(T)))}finally{if(y)throw y.error}}})})}}async embedContent(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=Ece(this.apiClient,e);return o=wt("{model}:predict",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>{const p=Rfe(d),m=new $j;return Object.assign(m,p),m})}else{const c=Due(this.apiClient,e);return o=wt("{model}:batchEmbedContents",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>{const p=rfe(d),m=new $j;return Object.assign(m,p),m})}}async generateImagesInternal(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=Tce(this.apiClient,e);return o=wt("{model}:predict",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>{const p=Pfe(d),m=new Lj;return Object.assign(m,p),m})}else{const c=Lue(this.apiClient,e);return o=wt("{model}:predict",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>{const p=sfe(d),m=new Lj;return Object.assign(m,p),m})}}async editImageInternal(e){var t,r;let i,a="",s={};if(this.apiClient.isVertexAI()){const o=Oce(this.apiClient,e);return a=wt("{model}:predict",o._url),s=o._query,delete o.config,delete o._url,delete o._query,i=this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),i.then(u=>{const c=xfe(u),d=new Dae;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,r;let i,a="",s={};if(this.apiClient.isVertexAI()){const o=kce(this.apiClient,e);return a=wt("{model}:predict",o._url),s=o._query,delete o.config,delete o._url,delete o._query,i=this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),i.then(u=>{const c=Ofe(u),d=new $ae;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=Mce(this.apiClient,e);return o=wt("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>iR(d))}else{const c=Uue(this.apiClient,e);return o=wt("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>rR(d))}}async listInternal(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=$ce(this.apiClient,e);return o=wt("{models_url}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>{const p=Dfe(this.apiClient,d),m=new Uj;return Object.assign(m,p),m})}else{const c=Fue(this.apiClient,e);return o=wt("{models_url}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>{const p=lfe(this.apiClient,d),m=new Uj;return Object.assign(m,p),m})}}async update(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=Uce(this.apiClient,e);return o=wt("{model}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>iR(d))}else{const c=que(this.apiClient,e);return o=wt("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"PATCH",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>rR(d))}}async delete(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=jce(this.apiClient,e);return o=wt("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(()=>{const d=$fe(),p=new jj;return Object.assign(p,d),p})}else{const c=Vue(this.apiClient,e);return o=wt("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(()=>{const d=ufe(),p=new jj;return Object.assign(p,d),p})}}async countTokens(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=Bce(this.apiClient,e);return o=wt("{model}:countTokens",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>{const p=Lfe(d),m=new Fj;return Object.assign(m,p),m})}else{const c=Hue(this.apiClient,e);return o=wt("{model}:countTokens",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>{const p=cfe(d),m=new Fj;return Object.assign(m,p),m})}}async computeTokens(e){var t,r;let i,a="",s={};if(this.apiClient.isVertexAI()){const o=qce(this.apiClient,e);return a=wt("{model}:computeTokens",o._url),s=o._query,delete o.config,delete o._url,delete o._query,i=this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),i.then(u=>{const c=Ufe(u),d=new Lae;return Object.assign(d,c),d})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideos(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=Hce(this.apiClient,e);return o=wt("{model}:predictLongRunning",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>qfe(d))}else{const c=Kue(this.apiClient,e);return o=wt("{model}:predictLongRunning",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>pfe(d))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function mde(n){const e={},t=v(n,["operationName"]);t!=null&&_(e,["_url","operationName"],t);const r=v(n,["config"]);return r!=null&&_(e,["config"],r),e}function gde(n){const e={},t=v(n,["operationName"]);t!=null&&_(e,["_url","operationName"],t);const r=v(n,["config"]);return r!=null&&_(e,["config"],r),e}function yde(n){const e={},t=v(n,["operationName"]);t!=null&&_(e,["operationName"],t);const r=v(n,["resourceName"]);r!=null&&_(e,["_url","resourceName"],r);const i=v(n,["config"]);return i!=null&&_(e,["config"],i),e}function vde(n){const e={},t=v(n,["video","uri"]);t!=null&&_(e,["uri"],t);const r=v(n,["video","encodedVideo"]);r!=null&&_(e,["videoBytes"],qo(r));const i=v(n,["encoding"]);return i!=null&&_(e,["mimeType"],i),e}function _de(n){const e={},t=v(n,["_self"]);return t!=null&&_(e,["video"],vde(t)),e}function bde(n){const e={},t=v(n,["generatedSamples"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(s=>_de(s))),_(e,["generatedVideos"],a)}const r=v(n,["raiMediaFilteredCount"]);r!=null&&_(e,["raiMediaFilteredCount"],r);const i=v(n,["raiMediaFilteredReasons"]);return i!=null&&_(e,["raiMediaFilteredReasons"],i),e}function wde(n){const e={},t=v(n,["name"]);t!=null&&_(e,["name"],t);const r=v(n,["metadata"]);r!=null&&_(e,["metadata"],r);const i=v(n,["done"]);i!=null&&_(e,["done"],i);const a=v(n,["error"]);a!=null&&_(e,["error"],a);const s=v(n,["response","generateVideoResponse"]);return s!=null&&_(e,["response"],bde(s)),e}function Ede(n){const e={},t=v(n,["gcsUri"]);t!=null&&_(e,["uri"],t);const r=v(n,["bytesBase64Encoded"]);r!=null&&_(e,["videoBytes"],qo(r));const i=v(n,["mimeType"]);return i!=null&&_(e,["mimeType"],i),e}function Sde(n){const e={},t=v(n,["_self"]);return t!=null&&_(e,["video"],Ede(t)),e}function Tde(n){const e={},t=v(n,["videos"]);if(t!=null){let a=t;Array.isArray(a)&&(a=a.map(s=>Sde(s))),_(e,["generatedVideos"],a)}const r=v(n,["raiMediaFilteredCount"]);r!=null&&_(e,["raiMediaFilteredCount"],r);const i=v(n,["raiMediaFilteredReasons"]);return i!=null&&_(e,["raiMediaFilteredReasons"],i),e}function f2(n){const e={},t=v(n,["name"]);t!=null&&_(e,["name"],t);const r=v(n,["metadata"]);r!=null&&_(e,["metadata"],r);const i=v(n,["done"]);i!=null&&_(e,["done"],i);const a=v(n,["error"]);a!=null&&_(e,["error"],a);const s=v(n,["response"]);return s!=null&&_(e,["response"],Tde(s)),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ade extends _d{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,r=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const i=t.name.split("/operations/")[0];let a;return r&&"httpOptions"in r&&(a=r.httpOptions),this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:i,config:{httpOptions:a}})}else return this.getVideosOperationInternal({operationName:t.name,config:r})}async getVideosOperationInternal(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=gde(e);return o=wt("{operationName}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>f2(d))}else{const c=mde(e);return o=wt("{operationName}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>wde(d))}}async fetchPredictVideosOperationInternal(e){var t,r;let i,a="",s={};if(this.apiClient.isVertexAI()){const o=yde(e);return a=wt("{resourceName}:fetchPredictOperation",o._url),s=o._query,delete o.config,delete o._url,delete o._query,i=this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),i.then(u=>f2(u))}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Cde(n){const e={},t=v(n,["voiceName"]);return t!=null&&_(e,["voiceName"],t),e}function $q(n){const e={},t=v(n,["prebuiltVoiceConfig"]);return t!=null&&_(e,["prebuiltVoiceConfig"],Cde(t)),e}function Rde(n){const e={},t=v(n,["speaker"]);t!=null&&_(e,["speaker"],t);const r=v(n,["voiceConfig"]);return r!=null&&_(e,["voiceConfig"],$q(r)),e}function Ide(n){const e={},t=v(n,["speakerVoiceConfigs"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>Rde(i))),_(e,["speakerVoiceConfigs"],r)}return e}function Pde(n){const e={},t=v(n,["voiceConfig"]);t!=null&&_(e,["voiceConfig"],$q(t));const r=v(n,["multiSpeakerVoiceConfig"]);r!=null&&_(e,["multiSpeakerVoiceConfig"],Ide(r));const i=v(n,["languageCode"]);return i!=null&&_(e,["languageCode"],i),e}function xde(n){const e={},t=v(n,["fps"]);t!=null&&_(e,["fps"],t);const r=v(n,["endOffset"]);r!=null&&_(e,["endOffset"],r);const i=v(n,["startOffset"]);return i!=null&&_(e,["startOffset"],i),e}function Ode(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["data"]);t!=null&&_(e,["data"],t);const r=v(n,["mimeType"]);return r!=null&&_(e,["mimeType"],r),e}function Nde(n){const e={};if(v(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=v(n,["fileUri"]);t!=null&&_(e,["fileUri"],t);const r=v(n,["mimeType"]);return r!=null&&_(e,["mimeType"],r),e}function kde(n){const e={},t=v(n,["videoMetadata"]);t!=null&&_(e,["videoMetadata"],xde(t));const r=v(n,["thought"]);r!=null&&_(e,["thought"],r);const i=v(n,["inlineData"]);i!=null&&_(e,["inlineData"],Ode(i));const a=v(n,["fileData"]);a!=null&&_(e,["fileData"],Nde(a));const s=v(n,["thoughtSignature"]);s!=null&&_(e,["thoughtSignature"],s);const o=v(n,["codeExecutionResult"]);o!=null&&_(e,["codeExecutionResult"],o);const u=v(n,["executableCode"]);u!=null&&_(e,["executableCode"],u);const c=v(n,["functionCall"]);c!=null&&_(e,["functionCall"],c);const d=v(n,["functionResponse"]);d!=null&&_(e,["functionResponse"],d);const p=v(n,["text"]);return p!=null&&_(e,["text"],p),e}function Mde(n){const e={},t=v(n,["parts"]);if(t!=null){let i=t;Array.isArray(i)&&(i=i.map(a=>kde(a))),_(e,["parts"],i)}const r=v(n,["role"]);return r!=null&&_(e,["role"],r),e}function Dde(n){const e={},t=v(n,["behavior"]);t!=null&&_(e,["behavior"],t);const r=v(n,["description"]);r!=null&&_(e,["description"],r);const i=v(n,["name"]);i!=null&&_(e,["name"],i);const a=v(n,["parameters"]);a!=null&&_(e,["parameters"],a);const s=v(n,["parametersJsonSchema"]);s!=null&&_(e,["parametersJsonSchema"],s);const o=v(n,["response"]);o!=null&&_(e,["response"],o);const u=v(n,["responseJsonSchema"]);return u!=null&&_(e,["responseJsonSchema"],u),e}function $de(n){const e={},t=v(n,["startTime"]);t!=null&&_(e,["startTime"],t);const r=v(n,["endTime"]);return r!=null&&_(e,["endTime"],r),e}function Lde(n){const e={},t=v(n,["timeRangeFilter"]);return t!=null&&_(e,["timeRangeFilter"],$de(t)),e}function Ude(n){const e={},t=v(n,["mode"]);t!=null&&_(e,["mode"],t);const r=v(n,["dynamicThreshold"]);return r!=null&&_(e,["dynamicThreshold"],r),e}function jde(n){const e={},t=v(n,["dynamicRetrievalConfig"]);return t!=null&&_(e,["dynamicRetrievalConfig"],Ude(t)),e}function Fde(){return{}}function Bde(n){const e={},t=v(n,["functionDeclarations"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(u=>Dde(u))),_(e,["functionDeclarations"],o)}if(v(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const r=v(n,["googleSearch"]);r!=null&&_(e,["googleSearch"],Lde(r));const i=v(n,["googleSearchRetrieval"]);if(i!=null&&_(e,["googleSearchRetrieval"],jde(i)),v(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");if(v(n,["googleMaps"])!==void 0)throw new Error("googleMaps parameter is not supported in Gemini API.");v(n,["urlContext"])!=null&&_(e,["urlContext"],Fde());const s=v(n,["codeExecution"]);return s!=null&&_(e,["codeExecution"],s),e}function qde(n){const e={},t=v(n,["handle"]);if(t!=null&&_(e,["handle"],t),v(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function d2(){return{}}function Vde(n){const e={},t=v(n,["disabled"]);t!=null&&_(e,["disabled"],t);const r=v(n,["startOfSpeechSensitivity"]);r!=null&&_(e,["startOfSpeechSensitivity"],r);const i=v(n,["endOfSpeechSensitivity"]);i!=null&&_(e,["endOfSpeechSensitivity"],i);const a=v(n,["prefixPaddingMs"]);a!=null&&_(e,["prefixPaddingMs"],a);const s=v(n,["silenceDurationMs"]);return s!=null&&_(e,["silenceDurationMs"],s),e}function zde(n){const e={},t=v(n,["automaticActivityDetection"]);t!=null&&_(e,["automaticActivityDetection"],Vde(t));const r=v(n,["activityHandling"]);r!=null&&_(e,["activityHandling"],r);const i=v(n,["turnCoverage"]);return i!=null&&_(e,["turnCoverage"],i),e}function Hde(n){const e={},t=v(n,["targetTokens"]);return t!=null&&_(e,["targetTokens"],t),e}function Gde(n){const e={},t=v(n,["triggerTokens"]);t!=null&&_(e,["triggerTokens"],t);const r=v(n,["slidingWindow"]);return r!=null&&_(e,["slidingWindow"],Hde(r)),e}function Wde(n){const e={},t=v(n,["proactiveAudio"]);return t!=null&&_(e,["proactiveAudio"],t),e}function Kde(n,e){const t={},r=v(n,["generationConfig"]);e!==void 0&&r!=null&&_(e,["setup","generationConfig"],r);const i=v(n,["responseModalities"]);e!==void 0&&i!=null&&_(e,["setup","generationConfig","responseModalities"],i);const a=v(n,["temperature"]);e!==void 0&&a!=null&&_(e,["setup","generationConfig","temperature"],a);const s=v(n,["topP"]);e!==void 0&&s!=null&&_(e,["setup","generationConfig","topP"],s);const o=v(n,["topK"]);e!==void 0&&o!=null&&_(e,["setup","generationConfig","topK"],o);const u=v(n,["maxOutputTokens"]);e!==void 0&&u!=null&&_(e,["setup","generationConfig","maxOutputTokens"],u);const c=v(n,["mediaResolution"]);e!==void 0&&c!=null&&_(e,["setup","generationConfig","mediaResolution"],c);const d=v(n,["seed"]);e!==void 0&&d!=null&&_(e,["setup","generationConfig","seed"],d);const p=v(n,["speechConfig"]);e!==void 0&&p!=null&&_(e,["setup","generationConfig","speechConfig"],Pde(uP(p)));const m=v(n,["enableAffectiveDialog"]);e!==void 0&&m!=null&&_(e,["setup","generationConfig","enableAffectiveDialog"],m);const y=v(n,["systemInstruction"]);e!==void 0&&y!=null&&_(e,["setup","systemInstruction"],Mde(ci(y)));const b=v(n,["tools"]);if(e!==void 0&&b!=null){let x=Im(b);Array.isArray(x)&&(x=x.map(L=>Bde(Rm(L)))),_(e,["setup","tools"],x)}const w=v(n,["sessionResumption"]);e!==void 0&&w!=null&&_(e,["setup","sessionResumption"],qde(w));const S=v(n,["inputAudioTranscription"]);e!==void 0&&S!=null&&_(e,["setup","inputAudioTranscription"],d2());const T=v(n,["outputAudioTranscription"]);e!==void 0&&T!=null&&_(e,["setup","outputAudioTranscription"],d2());const C=v(n,["realtimeInputConfig"]);e!==void 0&&C!=null&&_(e,["setup","realtimeInputConfig"],zde(C));const A=v(n,["contextWindowCompression"]);e!==void 0&&A!=null&&_(e,["setup","contextWindowCompression"],Gde(A));const I=v(n,["proactivity"]);return e!==void 0&&I!=null&&_(e,["setup","proactivity"],Wde(I)),t}function Jde(n,e){const t={},r=v(e,["model"]);r!=null&&_(t,["setup","model"],Rn(n,r));const i=v(e,["config"]);return i!=null&&_(t,["config"],Kde(i,t)),t}function Yde(n,e,t){const r={},i=v(e,["expireTime"]);t!==void 0&&i!=null&&_(t,["expireTime"],i);const a=v(e,["newSessionExpireTime"]);t!==void 0&&a!=null&&_(t,["newSessionExpireTime"],a);const s=v(e,["uses"]);t!==void 0&&s!=null&&_(t,["uses"],s);const o=v(e,["liveConnectConstraints"]);t!==void 0&&o!=null&&_(t,["bidiGenerateContentSetup"],Jde(n,o));const u=v(e,["lockAdditionalFields"]);return t!==void 0&&u!=null&&_(t,["fieldMask"],u),r}function Zde(n,e){const t={},r=v(e,["config"]);return r!=null&&_(t,["config"],Yde(n,r,t)),t}function Xde(n){const e={},t=v(n,["name"]);return t!=null&&_(e,["name"],t),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Qde(n){const e=[];for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const r=n[t];if(typeof r=="object"&&r!=null&&Object.keys(r).length>0){const i=Object.keys(r).map(a=>`${t}.${a}`);e.push(...i)}else e.push(t)}return e.join(",")}function ehe(n,e){let t=null;const r=n.bidiGenerateContentSetup;if(typeof r=="object"&&r!==null&&"setup"in r){const a=r.setup;typeof a=="object"&&a!==null?(n.bidiGenerateContentSetup=a,t=a):delete n.bidiGenerateContentSetup}else r!==void 0&&delete n.bidiGenerateContentSetup;const i=n.fieldMask;if(t){const a=Qde(t);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)a?n.fieldMask=a:delete n.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&i!==null&&Array.isArray(i)&&i.length>0){const s=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let o=[];i.length>0&&(o=i.map(c=>s.includes(c)?`generationConfig.${c}`:c));const u=[];a&&u.push(a),o.length>0&&u.push(...o),u.length>0?n.fieldMask=u.join(","):delete n.fieldMask}else delete n.fieldMask}else i!==null&&Array.isArray(i)&&i.length>0?n.fieldMask=i.join(","):delete n.fieldMask;return n}class the extends _d{constructor(e){super(),this.apiClient=e}async create(e){var t,r;let i,a="",s={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const o=Zde(this.apiClient,e);a=wt("auth_tokens",o._url),s=o._query,delete o.config,delete o._url,delete o._query;const u=ehe(o,e.config);return i=this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(c=>c.json()),i.then(c=>Xde(c))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function nhe(n){const e={},t=v(n,["name"]);t!=null&&_(e,["_url","name"],t);const r=v(n,["config"]);return r!=null&&_(e,["config"],r),e}function rhe(n,e){const t={},r=v(n,["pageSize"]);e!==void 0&&r!=null&&_(e,["_query","pageSize"],r);const i=v(n,["pageToken"]);e!==void 0&&i!=null&&_(e,["_query","pageToken"],i);const a=v(n,["filter"]);return e!==void 0&&a!=null&&_(e,["_query","filter"],a),t}function ihe(n){const e={},t=v(n,["config"]);return t!=null&&_(e,["config"],rhe(t,e)),e}function ahe(n){const e={},t=v(n,["textInput"]);t!=null&&_(e,["textInput"],t);const r=v(n,["output"]);return r!=null&&_(e,["output"],r),e}function she(n){const e={};if(v(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const t=v(n,["examples"]);if(t!=null){let r=t;Array.isArray(r)&&(r=r.map(i=>ahe(i))),_(e,["examples","examples"],r)}return e}function ohe(n,e){const t={};if(v(n,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const r=v(n,["tunedModelDisplayName"]);if(e!==void 0&&r!=null&&_(e,["displayName"],r),v(n,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const i=v(n,["epochCount"]);e!==void 0&&i!=null&&_(e,["tuningTask","hyperparameters","epochCount"],i);const a=v(n,["learningRateMultiplier"]);if(a!=null&&_(t,["tuningTask","hyperparameters","learningRateMultiplier"],a),v(n,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(v(n,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const s=v(n,["batchSize"]);e!==void 0&&s!=null&&_(e,["tuningTask","hyperparameters","batchSize"],s);const o=v(n,["learningRate"]);return e!==void 0&&o!=null&&_(e,["tuningTask","hyperparameters","learningRate"],o),t}function lhe(n){const e={},t=v(n,["baseModel"]);t!=null&&_(e,["baseModel"],t);const r=v(n,["trainingDataset"]);r!=null&&_(e,["tuningTask","trainingData"],she(r));const i=v(n,["config"]);return i!=null&&_(e,["config"],ohe(i,e)),e}function uhe(n){const e={},t=v(n,["name"]);t!=null&&_(e,["_url","name"],t);const r=v(n,["config"]);return r!=null&&_(e,["config"],r),e}function che(n,e){const t={},r=v(n,["pageSize"]);e!==void 0&&r!=null&&_(e,["_query","pageSize"],r);const i=v(n,["pageToken"]);e!==void 0&&i!=null&&_(e,["_query","pageToken"],i);const a=v(n,["filter"]);return e!==void 0&&a!=null&&_(e,["_query","filter"],a),t}function fhe(n){const e={},t=v(n,["config"]);return t!=null&&_(e,["config"],che(t,e)),e}function dhe(n,e){const t={},r=v(n,["gcsUri"]);if(e!==void 0&&r!=null&&_(e,["supervisedTuningSpec","trainingDatasetUri"],r),v(n,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return t}function hhe(n){const e={},t=v(n,["gcsUri"]);return t!=null&&_(e,["validationDatasetUri"],t),e}function phe(n,e){const t={},r=v(n,["validationDataset"]);e!==void 0&&r!=null&&_(e,["supervisedTuningSpec"],hhe(r));const i=v(n,["tunedModelDisplayName"]);e!==void 0&&i!=null&&_(e,["tunedModelDisplayName"],i);const a=v(n,["description"]);e!==void 0&&a!=null&&_(e,["description"],a);const s=v(n,["epochCount"]);e!==void 0&&s!=null&&_(e,["supervisedTuningSpec","hyperParameters","epochCount"],s);const o=v(n,["learningRateMultiplier"]);e!==void 0&&o!=null&&_(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],o);const u=v(n,["exportLastCheckpointOnly"]);e!==void 0&&u!=null&&_(e,["supervisedTuningSpec","exportLastCheckpointOnly"],u);const c=v(n,["adapterSize"]);if(e!==void 0&&c!=null&&_(e,["supervisedTuningSpec","hyperParameters","adapterSize"],c),v(n,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(v(n,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");return t}function mhe(n){const e={},t=v(n,["baseModel"]);t!=null&&_(e,["baseModel"],t);const r=v(n,["trainingDataset"]);r!=null&&_(e,["supervisedTuningSpec","trainingDatasetUri"],dhe(r,e));const i=v(n,["config"]);return i!=null&&_(e,["config"],phe(i,e)),e}function ghe(n){const e={},t=v(n,["name"]);t!=null&&_(e,["model"],t);const r=v(n,["name"]);return r!=null&&_(e,["endpoint"],r),e}function Lq(n){const e={},t=v(n,["name"]);t!=null&&_(e,["name"],t);const r=v(n,["state"]);r!=null&&_(e,["state"],bq(r));const i=v(n,["createTime"]);i!=null&&_(e,["createTime"],i);const a=v(n,["tuningTask","startTime"]);a!=null&&_(e,["startTime"],a);const s=v(n,["tuningTask","completeTime"]);s!=null&&_(e,["endTime"],s);const o=v(n,["updateTime"]);o!=null&&_(e,["updateTime"],o);const u=v(n,["description"]);u!=null&&_(e,["description"],u);const c=v(n,["baseModel"]);c!=null&&_(e,["baseModel"],c);const d=v(n,["_self"]);d!=null&&_(e,["tunedModel"],ghe(d));const p=v(n,["distillationSpec"]);p!=null&&_(e,["distillationSpec"],p);const m=v(n,["experiment"]);m!=null&&_(e,["experiment"],m);const y=v(n,["labels"]);y!=null&&_(e,["labels"],y);const b=v(n,["pipelineJob"]);b!=null&&_(e,["pipelineJob"],b);const w=v(n,["serviceAccount"]);w!=null&&_(e,["serviceAccount"],w);const S=v(n,["tunedModelDisplayName"]);return S!=null&&_(e,["tunedModelDisplayName"],S),e}function yhe(n){const e={},t=v(n,["nextPageToken"]);t!=null&&_(e,["nextPageToken"],t);const r=v(n,["tunedModels"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(a=>Lq(a))),_(e,["tuningJobs"],i)}return e}function vhe(n){const e={},t=v(n,["name"]);t!=null&&_(e,["name"],t);const r=v(n,["metadata"]);r!=null&&_(e,["metadata"],r);const i=v(n,["done"]);i!=null&&_(e,["done"],i);const a=v(n,["error"]);return a!=null&&_(e,["error"],a),e}function _he(n){const e={},t=v(n,["checkpointId"]);t!=null&&_(e,["checkpointId"],t);const r=v(n,["epoch"]);r!=null&&_(e,["epoch"],r);const i=v(n,["step"]);i!=null&&_(e,["step"],i);const a=v(n,["endpoint"]);return a!=null&&_(e,["endpoint"],a),e}function bhe(n){const e={},t=v(n,["model"]);t!=null&&_(e,["model"],t);const r=v(n,["endpoint"]);r!=null&&_(e,["endpoint"],r);const i=v(n,["checkpoints"]);if(i!=null){let a=i;Array.isArray(a)&&(a=a.map(s=>_he(s))),_(e,["checkpoints"],a)}return e}function sR(n){const e={},t=v(n,["name"]);t!=null&&_(e,["name"],t);const r=v(n,["state"]);r!=null&&_(e,["state"],bq(r));const i=v(n,["createTime"]);i!=null&&_(e,["createTime"],i);const a=v(n,["startTime"]);a!=null&&_(e,["startTime"],a);const s=v(n,["endTime"]);s!=null&&_(e,["endTime"],s);const o=v(n,["updateTime"]);o!=null&&_(e,["updateTime"],o);const u=v(n,["error"]);u!=null&&_(e,["error"],u);const c=v(n,["description"]);c!=null&&_(e,["description"],c);const d=v(n,["baseModel"]);d!=null&&_(e,["baseModel"],d);const p=v(n,["tunedModel"]);p!=null&&_(e,["tunedModel"],bhe(p));const m=v(n,["supervisedTuningSpec"]);m!=null&&_(e,["supervisedTuningSpec"],m);const y=v(n,["tuningDataStats"]);y!=null&&_(e,["tuningDataStats"],y);const b=v(n,["encryptionSpec"]);b!=null&&_(e,["encryptionSpec"],b);const w=v(n,["partnerModelTuningSpec"]);w!=null&&_(e,["partnerModelTuningSpec"],w);const S=v(n,["distillationSpec"]);S!=null&&_(e,["distillationSpec"],S);const T=v(n,["experiment"]);T!=null&&_(e,["experiment"],T);const C=v(n,["labels"]);C!=null&&_(e,["labels"],C);const A=v(n,["pipelineJob"]);A!=null&&_(e,["pipelineJob"],A);const I=v(n,["serviceAccount"]);I!=null&&_(e,["serviceAccount"],I);const x=v(n,["tunedModelDisplayName"]);return x!=null&&_(e,["tunedModelDisplayName"],x),e}function whe(n){const e={},t=v(n,["nextPageToken"]);t!=null&&_(e,["nextPageToken"],t);const r=v(n,["tuningJobs"]);if(r!=null){let i=r;Array.isArray(i)&&(i=i.map(a=>sR(a))),_(e,["tuningJobs"],i)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Ehe extends _d{constructor(e){super(),this.apiClient=e,this.get=async t=>await this.getInternal(t),this.list=async(t={})=>new Eb(rd.PAGED_ITEM_TUNING_JOBS,r=>this.listInternal(r),await this.listInternal(t),t),this.tune=async t=>{if(this.apiClient.isVertexAI())return await this.tuneInternal(t);{const r=await this.tuneMldevInternal(t);let i="";return r.metadata!==void 0&&r.metadata.tunedModel!==void 0?i=r.metadata.tunedModel:r.name!==void 0&&r.name.includes("/operations/")&&(i=r.name.split("/operations/")[0]),{name:i,state:X1.JOB_STATE_QUEUED}}}}async getInternal(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=uhe(e);return o=wt("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>sR(d))}else{const c=nhe(e);return o=wt("{name}",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>Lq(d))}}async listInternal(e){var t,r,i,a;let s,o="",u={};if(this.apiClient.isVertexAI()){const c=fhe(e);return o=wt("tuningJobs",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(d=>d.json()),s.then(d=>{const p=whe(d),m=new Bj;return Object.assign(m,p),m})}else{const c=ihe(e);return o=wt("tunedModels",c._url),u=c._query,delete c.config,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:u,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(i=e.config)===null||i===void 0?void 0:i.httpOptions,abortSignal:(a=e.config)===null||a===void 0?void 0:a.abortSignal}).then(d=>d.json()),s.then(d=>{const p=yhe(d),m=new Bj;return Object.assign(m,p),m})}}async tuneInternal(e){var t,r;let i,a="",s={};if(this.apiClient.isVertexAI()){const o=mhe(e);return a=wt("tuningJobs",o._url),s=o._query,delete o.config,delete o._url,delete o._query,i=this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),i.then(u=>sR(u))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,r;let i,a="",s={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const o=lhe(e);return a=wt("tunedModels",o._url),s=o._query,delete o.config,delete o._url,delete o._query,i=this.apiClient.request({path:a,queryParams:s,body:JSON.stringify(o),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(r=e.config)===null||r===void 0?void 0:r.abortSignal}).then(u=>u.json()),i.then(u=>vhe(u))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class She{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const The=1024*1024*8,Ahe=3,Che=1e3,Rhe=2,aC="x-goog-upload-status";async function Ihe(n,e,t){var r,i,a;let s=0,o=0,u=new Q1(new Response),c="upload";for(s=n.size;o<s;){const p=Math.min(The,s-o),m=n.slice(o,o+p);o+p>=s&&(c+=", finalize");let y=0,b=Che;for(;y<Ahe&&(u=await t.request({path:"",body:m,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":c,"X-Goog-Upload-Offset":String(o),"Content-Length":String(p)}}}),!(!((r=u==null?void 0:u.headers)===null||r===void 0)&&r[aC]));)y++,await xhe(b),b=b*Rhe;if(o+=p,((i=u==null?void 0:u.headers)===null||i===void 0?void 0:i[aC])!=="active")break;if(s<=o)throw new Error("All content has been uploaded, but the upload status is not finalized.")}const d=await(u==null?void 0:u.json());if(((a=u==null?void 0:u.headers)===null||a===void 0?void 0:a[aC])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return d.file}async function Phe(n){return{size:n.size,type:n.type}}function xhe(n){return new Promise(e=>setTimeout(e,n))}class Ohe{async upload(e,t,r){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Ihe(e,t,r)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Phe(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Nhe{create(e,t,r){return new khe(e,t,r)}}class khe{constructor(e,t,r){this.url=e,this.headers=t,this.callbacks=r}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const h2="x-goog-api-key";class Mhe{constructor(e){this.apiKey=e}async addAuthHeaders(e){if(e.get(h2)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(h2,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Dhe="gl-node/";class $he{constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const r=Mae(e,void 0,void 0);r&&(e.httpOptions?e.httpOptions.baseUrl=r:e.httpOptions={baseUrl:r}),this.apiVersion=e.apiVersion;const i=new Mhe(this.apiKey);this.apiClient=new Yfe({auth:i,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:Dhe+"web",uploader:new Ohe,downloader:new She}),this.models=new pde(this.apiClient),this.live=new ude(this.apiClient,i,new Nhe),this.chats=new ooe(this.models,this.apiClient),this.caches=new ioe(this.apiClient),this.files=new boe(this.apiClient),this.operations=new Ade(this.apiClient),this.authTokens=new the(this.apiClient),this.tunings=new Ehe(this.apiClient)}}const Uq=n=>{if(!n||n.trim()==="")return null;try{return new $he({apiKey:n})}catch(e){return console.error("Failed to initialize GoogleGenAI with provided key:",e),null}},hP=n=>!!n&&n.trim()!=="",Lhe=async(n,e)=>{if(!hP(e))return"Gemini API is not available. Please ensure API Key is configured in API Key Management.";const t=Uq(e);if(!t)return"Gemini API client could not be initialized. Check console for details (e.g., invalid API key format).";try{const r=[{role:"user",parts:[{text:n}]}];return(await t.models.generateContent({model:PF,contents:r})).text}catch(r){return console.error("Error generating text with Gemini:",r),r instanceof Error?r.message.includes("API key not valid")?"Error from Gemini: API key not valid. Please check your Gemini API key.":`Error from Gemini: ${r.message}`:"An unknown error occurred while contacting Gemini."}},Uhe=async(n,e,t,r,i)=>{if(!hP(e)){i("Gemini API is not available. Please ensure API Key is configured in API Key Management."),r();return}const a=Uq(e);if(!a){i("Gemini API client could not be initialized. Check console for details (e.g., invalid API key format)."),r();return}try{const s=[{role:"user",parts:[{text:n}]}],o=await a.models.generateContentStream({model:PF,contents:s});for await(const u of o)t(u.text)}catch(s){console.error("Error generating streaming text with Gemini:",s),s instanceof Error?s.message.includes("API key not valid")?i("Error from Gemini: API key not valid. Please check your Gemini API key."):i(`Error from Gemini: ${s.message}`):i("An unknown error occurred while contacting Gemini.")}finally{r()}},$y={generateText:Lhe,generateTextStream:Uhe,isAvailable:hP},pP=n=>!!n&&n.trim()!=="",jhe=async(n,e)=>pP(e)?(await new Promise(t=>setTimeout(t,1e3)),`(Stubbed OpenAI Response) You asked: "${n}". This feature is not fully implemented.`):"OpenAI API is not available. Please ensure API Key is configured.",Fhe=async(n,e,t,r,i)=>{if(!pP(e)){i("OpenAI API is not available. Please ensure API Key is configured."),r();return}t(`(Stubbed OpenAI Stream) You asked: "${n}". `),await new Promise(a=>setTimeout(a,500)),t("This feature is not fully implemented."),r()},p2={generateText:jhe,generateTextStream:Fhe,isAvailable:pP},mP=n=>!!n&&n.trim()!=="",Bhe=async(n,e)=>mP(e)?(await new Promise(t=>setTimeout(t,1e3)),`(Stubbed Claude Response) You said: "${n}". This function is a placeholder.`):"Claude API is not available. Please ensure API Key is configured.",qhe=async(n,e,t,r,i)=>{if(!mP(e)){i("Claude API is not available. Please ensure API Key is configured."),r();return}t(`(Stubbed Claude Stream) You said: "${n}". `),await new Promise(a=>setTimeout(a,500)),t("This function is a placeholder."),r()},m2={generateText:Bhe,generateTextStream:qhe,isAvailable:mP},g2="mcpLlmClientMcpServers",Vhe=({})=>{const[n,e]=_t.useState([]),[t,r]=_t.useState(!1),[i,a]=_t.useState(void 0),[s,o]=_t.useState(0),u=_t.useCallback(S=>{e(S)},[]);_t.useEffect(()=>{try{const S=localStorage.getItem(g2);if(S){const T=JSON.parse(S);Array.isArray(T)&&u(T.map(C=>({...C,status:"idle",statusMessage:"Not Connected",client:new v1({name:"MCP LLM Client",version:"1.0.0"},{capabilities:{tools:!0}}),transport:void 0})))}}catch(S){console.error("Error loading MCP servers from localStorage:",S)}finally{r(!0)}},[u]),_t.useEffect(()=>{if(t)try{const S=n.map(({client:T,transport:C,...A})=>A);localStorage.setItem(g2,JSON.stringify(S))}catch(S){console.error("Error saving MCP servers to localStorage:",S)}},[n,t]);const c=_t.useCallback((S,T,C)=>{const A=new v1({name:"MCP LLM Client",version:"1.0.0"},{capabilities:{tools:!0}}),I={id:`mcp-${Date.now()}`,name:S,url:T,bearerToken:(C==null?void 0:C.trim())||void 0,status:"idle",statusMessage:"Not Connected",client:A,transport:void 0};u(x=>[...x,I])},[u]),d=_t.useCallback(S=>{u(T=>{const C=T.find(A=>A.id===S);return C!=null&&C.transport&&C.transport.close(),T.filter(A=>A.id!==S)})},[u]),p=_t.useCallback((S,T,C)=>{u(A=>A.map(I=>I.id===S?{...I,status:T,statusMessage:C}:I))},[u]),m=_t.useCallback(async S=>{const T=n.find(C=>C.id===S);if(!(!T||!T.client)){T.transport&&(T.transport.close(),await new Promise(C=>setTimeout(C,50))),p(S,"connecting",`Connecting to ${T.name}...`);try{const C=new I1(new URL(T.url),{requestInit:{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json; text/event-stream",...T.bearerToken&&{Authorization:`Bearer ${T.bearerToken}`}}}});u(A=>A.map(I=>I.id===S?{...I,transport:C}:I)),await T.client.connect(C),p(S,"connected","Connected to MCP server.")}catch(C){console.error(`Error connecting to ${T.name} using MCP SDK:`,C),p(S,"error",`Failed to connect: ${C.message||"Unknown error"}.`)}}},[n,p,u]),y=_t.useMemo(()=>n.reduce((S,T)=>(S[T.name]={url:T.url,bearerToken:T.bearerToken},S),{}),[n]),b=_t.useMemo(()=>n.filter(S=>S.status==="connected").reduce((S,T)=>(S[T.name]={url:T.url,bearerToken:T.bearerToken},S),{}),[n]),w=_t.useRef(b);return _t.useEffect(()=>{const S=JSON.stringify(b),T=JSON.stringify(w.current);S!==T&&(o(C=>C+1),w.current=b)},[b]),_t.useEffect(()=>{t&&n.forEach(S=>{S.status==="idle"&&m(S.id)})},[t]),{mcpServers:n,serversLoadedFromStorage:t,handleAddServer:c,handleRemoveServer:d,handleConnectToServer:m,mcpCleanup:i,mcpServerConfig:y,connectedServersVersion:s,stableConnectedServerConfig:b}},zhe=()=>{};var y2={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jq=function(n){const e=[];let t=0;for(let r=0;r<n.length;r++){let i=n.charCodeAt(r);i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(i=65536+((i&1023)<<10)+(n.charCodeAt(++r)&1023),e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128)}return e},Hhe=function(n){const e=[];let t=0,r=0;for(;t<n.length;){const i=n[t++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const a=n[t++];e[r++]=String.fromCharCode((i&31)<<6|a&63)}else if(i>239&&i<365){const a=n[t++],s=n[t++],o=n[t++],u=((i&7)<<18|(a&63)<<12|(s&63)<<6|o&63)-65536;e[r++]=String.fromCharCode(55296+(u>>10)),e[r++]=String.fromCharCode(56320+(u&1023))}else{const a=n[t++],s=n[t++];e[r++]=String.fromCharCode((i&15)<<12|(a&63)<<6|s&63)}}return e.join("")},Fq={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let i=0;i<n.length;i+=3){const a=n[i],s=i+1<n.length,o=s?n[i+1]:0,u=i+2<n.length,c=u?n[i+2]:0,d=a>>2,p=(a&3)<<4|o>>4;let m=(o&15)<<2|c>>6,y=c&63;u||(y=64,s||(m=64)),r.push(t[d],t[p],t[m],t[y])}return r.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(jq(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Hhe(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let i=0;i<n.length;){const a=t[n.charAt(i++)],o=i<n.length?t[n.charAt(i)]:0;++i;const c=i<n.length?t[n.charAt(i)]:64;++i;const p=i<n.length?t[n.charAt(i)]:64;if(++i,a==null||o==null||c==null||p==null)throw new Ghe;const m=a<<2|o>>4;if(r.push(m),c!==64){const y=o<<4&240|c>>2;if(r.push(y),p!==64){const b=c<<6&192|p;r.push(b)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Ghe extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Whe=function(n){const e=jq(n);return Fq.encodeByteArray(e,!0)},Bq=function(n){return Whe(n).replace(/\./g,"")},gP=function(n){try{return Fq.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function p_(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:const t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!Khe(t)||(n[t]=p_(n[t],e[t]));return n}function Khe(n){return n!=="__proto__"}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qq(){if(typeof self<"u")return self;if(typeof window<"u"||typeof window<"u")return window;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jhe=()=>qq().__FIREBASE_DEFAULTS__,Yhe=()=>{if(typeof at>"u"||typeof y2>"u")return;const n=y2.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Zhe=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&gP(n[1]);return e&&JSON.parse(e)},yP=()=>{try{return zhe()||Jhe()||Yhe()||Zhe()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Vq=()=>{var n;return(n=yP())===null||n===void 0?void 0:n.config},Xhe=n=>{var e;return(e=yP())===null||e===void 0?void 0:e[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Qhe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,r))}}}/**
 * @license
 * Copyright 2025 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cb(n){return n.endsWith(".cloudworkstations.dev")}async function epe(n){return(await fetch(n,{credentials:"include"})).ok}const _p={};function tpe(){const n={prod:[],emulator:[]};for(const e of Object.keys(_p))_p[e]?n.emulator.push(e):n.prod.push(e);return n}function npe(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}let v2=!1;function rpe(n,e){if(typeof window>"u"||typeof document>"u"||!Cb(window.location.host)||_p[n]===e||_p[n]||v2)return;_p[n]=e;function t(m){return`__firebase__banner__${m}`}const r="__firebase__banner",a=tpe().prod.length>0;function s(){const m=document.getElementById(r);m&&m.remove()}function o(m){m.style.display="flex",m.style.background="#7faaf0",m.style.position="fixed",m.style.bottom="5px",m.style.left="5px",m.style.padding=".5em",m.style.borderRadius="5px",m.style.alignItems="center"}function u(m,y){m.setAttribute("width","24"),m.setAttribute("id",y),m.setAttribute("height","24"),m.setAttribute("viewBox","0 0 24 24"),m.setAttribute("fill","none"),m.style.marginLeft="-6px"}function c(){const m=document.createElement("span");return m.style.cursor="pointer",m.style.marginLeft="16px",m.style.fontSize="24px",m.innerHTML=" &times;",m.onclick=()=>{v2=!0,s()},m}function d(m,y){m.setAttribute("id",y),m.innerText="Learn more",m.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",m.setAttribute("target","__blank"),m.style.paddingLeft="5px",m.style.textDecoration="underline"}function p(){const m=npe(r),y=t("text"),b=document.getElementById(y)||document.createElement("span"),w=t("learnmore"),S=document.getElementById(w)||document.createElement("a"),T=t("preprendIcon"),C=document.getElementById(T)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(m.created){const A=m.element;o(A),d(S,w);const I=c();u(C,T),A.append(C,b,S,I),document.body.appendChild(A)}a?(b.innerText="Preview backend disconnected.",C.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(C.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,b.innerText="Preview backend running in this workspace."),b.setAttribute("id",y)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",p):p()}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wr(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function ipe(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(wr())}function zq(){var n;const e=(n=yP())===null||n===void 0?void 0:n.forceEnvironment;if(e==="node")return!0;if(e==="browser")return!1;try{return Object.prototype.toString.call(window.process)==="[object process]"}catch{return!1}}function ape(){return typeof window<"u"||Hq()}function Hq(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function spe(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Gq(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function vP(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Wq(){const n=wr();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function m_(){try{return typeof indexedDB=="object"}catch{return!1}}function ope(){return new Promise((n,e)=>{try{let t=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),t||self.indexedDB.deleteDatabase(r),n(!0)},i.onupgradeneeded=()=>{t=!1},i.onerror=()=>{var a;e(((a=i.error)===null||a===void 0?void 0:a.message)||"")}}catch(t){e(t)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lpe="FirebaseError";class Li extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name=lpe,Object.setPrototypeOf(this,Li.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,hc.prototype.create)}}class hc{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){const r=t[0]||{},i=`${this.service}/${e}`,a=this.errors[e],s=a?upe(a,r):"Error",o=`${this.serviceName}: ${s} (${i}).`;return new Li(i,o,r)}}function upe(n,e){return n.replace(cpe,(t,r)=>{const i=e[r];return i!=null?String(i):`<${r}?>`})}const cpe=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _2(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function fpe(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function qp(n,e){if(n===e)return!0;const t=Object.keys(n),r=Object.keys(e);for(const i of t){if(!r.includes(i))return!1;const a=n[i],s=e[i];if(b2(a)&&b2(s)){if(!qp(a,s))return!1}else if(a!==s)return!1}for(const i of r)if(!t.includes(i))return!1;return!0}function b2(n){return n!==null&&typeof n=="object"}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wd(n){const e=[];for(const[t,r]of Object.entries(n))Array.isArray(r)?r.forEach(i=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(i))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(r));return e.length?"&"+e.join("&"):""}function Nf(n){const e={};return n.replace(/^\?/,"").split("&").forEach(r=>{if(r){const[i,a]=r.split("=");e[decodeURIComponent(i)]=decodeURIComponent(a)}}),e}function ap(n){const e=n.indexOf("?");if(!e)return"";const t=n.indexOf("#",e);return n.substring(e,t>0?t:void 0)}function Kq(n,e){const t=new dpe(n,e);return t.subscribe.bind(t)}class dpe{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(r=>{this.error(r)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let i;if(e===void 0&&t===void 0&&r===void 0)throw new Error("Missing Observer.");hpe(e,["next","error","complete"])?i=e:i={next:e,error:t,complete:r},i.next===void 0&&(i.next=sC),i.error===void 0&&(i.error=sC),i.complete===void 0&&(i.complete=sC);const a=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch{}}),this.observers.push(i),a}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(r){typeof console<"u"&&console.error&&console.error(r)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function hpe(n,e){if(typeof n!="object"||n===null)return!1;for(const t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function sC(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function en(n){return n&&n._delegate?n._delegate:n}class jl{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vu="[DEFAULT]";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ppe{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const r=new Qhe;if(this.instancesDeferred.set(t,r),this.isInitialized(t)||this.shouldAutoInitialize())try{const i=this.getOrInitializeService({instanceIdentifier:t});i&&r.resolve(i)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(e==null?void 0:e.identifier),i=(t=e==null?void 0:e.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(a){if(i)return null;throw a}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(gpe(e))try{this.getOrInitializeService({instanceIdentifier:vu})}catch{}for(const[t,r]of this.instancesDeferred.entries()){const i=this.normalizeInstanceIdentifier(t);try{const a=this.getOrInitializeService({instanceIdentifier:i});r.resolve(a)}catch{}}}}clearInstance(e=vu){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=vu){return this.instances.has(e)}getOptions(e=vu){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[a,s]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(a);r===o&&s.resolve(i)}return i}onInit(e,t){var r;const i=this.normalizeInstanceIdentifier(t),a=(r=this.onInitCallbacks.get(i))!==null&&r!==void 0?r:new Set;a.add(e),this.onInitCallbacks.set(i,a);const s=this.instances.get(i);return s&&e(s,i),()=>{a.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let r=this.instances.get(e);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:mpe(e),options:t}),this.instances.set(e,r),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(r,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,r)}catch{}return r||null}normalizeInstanceIdentifier(e=vu){return this.component?this.component.multipleInstances?e:vu:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function mpe(n){return n===vu?void 0:n}function gpe(n){return n.instantiationMode==="EAGER"}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Jq{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new ppe(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _P=[];var _n;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(_n||(_n={}));const Yq={debug:_n.DEBUG,verbose:_n.VERBOSE,info:_n.INFO,warn:_n.WARN,error:_n.ERROR,silent:_n.SILENT},ype=_n.INFO,vpe={[_n.DEBUG]:"log",[_n.VERBOSE]:"log",[_n.INFO]:"info",[_n.WARN]:"warn",[_n.ERROR]:"error"},_pe=(n,e,...t)=>{if(e<n.logLevel)return;const r=new Date().toISOString(),i=vpe[e];if(i)console[i](`[${r}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class bP{constructor(e){this.name=e,this._logLevel=ype,this._logHandler=_pe,this._userLogHandler=null,_P.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in _n))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?Yq[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,_n.DEBUG,...e),this._logHandler(this,_n.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,_n.VERBOSE,...e),this._logHandler(this,_n.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,_n.INFO,...e),this._logHandler(this,_n.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,_n.WARN,...e),this._logHandler(this,_n.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,_n.ERROR,...e),this._logHandler(this,_n.ERROR,...e)}}function bpe(n){_P.forEach(e=>{e.setLogLevel(n)})}function wpe(n,e){for(const t of _P){let r=null;e&&e.level&&(r=Yq[e.level]),n===null?t.userLogHandler=null:t.userLogHandler=(i,a,...s)=>{const o=s.map(u=>{if(u==null)return null;if(typeof u=="string")return u;if(typeof u=="number"||typeof u=="boolean")return u.toString();if(u instanceof Error)return u.message;try{return JSON.stringify(u)}catch{return null}}).filter(u=>u).join(" ");a>=(r??i.logLevel)&&n({level:_n[a].toLowerCase(),message:o,args:s,type:i.name})}}}const Epe=(n,e)=>e.some(t=>n instanceof t);let w2,E2;function Spe(){return w2||(w2=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Tpe(){return E2||(E2=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Zq=new WeakMap,oR=new WeakMap,Xq=new WeakMap,oC=new WeakMap,wP=new WeakMap;function Ape(n){const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("success",a),n.removeEventListener("error",s)},a=()=>{t(kl(n.result)),i()},s=()=>{r(n.error),i()};n.addEventListener("success",a),n.addEventListener("error",s)});return e.then(t=>{t instanceof IDBCursor&&Zq.set(t,n)}).catch(()=>{}),wP.set(e,n),e}function Cpe(n){if(oR.has(n))return;const e=new Promise((t,r)=>{const i=()=>{n.removeEventListener("complete",a),n.removeEventListener("error",s),n.removeEventListener("abort",s)},a=()=>{t(),i()},s=()=>{r(n.error||new DOMException("AbortError","AbortError")),i()};n.addEventListener("complete",a),n.addEventListener("error",s),n.addEventListener("abort",s)});oR.set(n,e)}let lR={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return oR.get(n);if(e==="objectStoreNames")return n.objectStoreNames||Xq.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return kl(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function Rpe(n){lR=n(lR)}function Ipe(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(lC(this),e,...t);return Xq.set(r,e.sort?e.sort():[e]),kl(r)}:Tpe().includes(n)?function(...e){return n.apply(lC(this),e),kl(Zq.get(this))}:function(...e){return kl(n.apply(lC(this),e))}}function Ppe(n){return typeof n=="function"?Ipe(n):(n instanceof IDBTransaction&&Cpe(n),Epe(n,Spe())?new Proxy(n,lR):n)}function kl(n){if(n instanceof IDBRequest)return Ape(n);if(oC.has(n))return oC.get(n);const e=Ppe(n);return e!==n&&(oC.set(n,e),wP.set(e,n)),e}const lC=n=>wP.get(n);function xpe(n,e,{blocked:t,upgrade:r,blocking:i,terminated:a}={}){const s=indexedDB.open(n,e),o=kl(s);return r&&s.addEventListener("upgradeneeded",u=>{r(kl(s.result),u.oldVersion,u.newVersion,kl(s.transaction),u)}),t&&s.addEventListener("blocked",u=>t(u.oldVersion,u.newVersion,u)),o.then(u=>{a&&u.addEventListener("close",()=>a()),i&&u.addEventListener("versionchange",c=>i(c.oldVersion,c.newVersion,c))}).catch(()=>{}),o}const Ope=["get","getKey","getAll","getAllKeys","count"],Npe=["put","add","delete","clear"],uC=new Map;function S2(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(uC.get(e))return uC.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,i=Npe.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(i||Ope.includes(t)))return;const a=async function(s,...o){const u=this.transaction(s,i?"readwrite":"readonly");let c=u.store;return r&&(c=c.index(o.shift())),(await Promise.all([c[t](...o),i&&u.done]))[0]};return uC.set(e,a),a}Rpe(n=>({...n,get:(e,t,r)=>S2(e,t)||n.get(e,t,r),has:(e,t)=>!!S2(e,t)||n.has(e,t)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kpe{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(Mpe(t)){const r=t.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(t=>t).join(" ")}}function Mpe(n){const e=n.getComponent();return(e==null?void 0:e.type)==="VERSION"}const g_="@firebase/app",uR="0.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uo=new bP("@firebase/app"),Dpe="@firebase/app-compat",$pe="@firebase/analytics-compat",Lpe="@firebase/analytics",Upe="@firebase/app-check-compat",jpe="@firebase/app-check",Fpe="@firebase/auth",Bpe="@firebase/auth-compat",qpe="@firebase/database",Vpe="@firebase/data-connect",zpe="@firebase/database-compat",Hpe="@firebase/functions",Gpe="@firebase/functions-compat",Wpe="@firebase/installations",Kpe="@firebase/installations-compat",Jpe="@firebase/messaging",Ype="@firebase/messaging-compat",Zpe="@firebase/performance",Xpe="@firebase/performance-compat",Qpe="@firebase/remote-config",eme="@firebase/remote-config-compat",tme="@firebase/storage",nme="@firebase/storage-compat",rme="@firebase/firestore",ime="@firebase/ai",ame="@firebase/firestore-compat",sme="firebase",ome="11.9.0";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fl="[DEFAULT]",lme={[g_]:"fire-core",[Dpe]:"fire-core-compat",[Lpe]:"fire-analytics",[$pe]:"fire-analytics-compat",[jpe]:"fire-app-check",[Upe]:"fire-app-check-compat",[Fpe]:"fire-auth",[Bpe]:"fire-auth-compat",[qpe]:"fire-rtdb",[Vpe]:"fire-data-connect",[zpe]:"fire-rtdb-compat",[Hpe]:"fire-fn",[Gpe]:"fire-fn-compat",[Wpe]:"fire-iid",[Kpe]:"fire-iid-compat",[Jpe]:"fire-fcm",[Ype]:"fire-fcm-compat",[Zpe]:"fire-perf",[Xpe]:"fire-perf-compat",[Qpe]:"fire-rc",[eme]:"fire-rc-compat",[tme]:"fire-gcs",[nme]:"fire-gcs-compat",[rme]:"fire-fst",[ame]:"fire-fst-compat",[ime]:"fire-vertex","fire-js":"fire-js",[sme]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bl=new Map,id=new Map,ad=new Map;function Vp(n,e){try{n.container.addComponent(e)}catch(t){Uo.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Qq(n,e){n.container.addOrOverwriteComponent(e)}function Zu(n){const e=n.name;if(ad.has(e))return Uo.debug(`There were multiple attempts to register component ${e}.`),!1;ad.set(e,n);for(const t of Bl.values())Vp(t,n);for(const t of id.values())Vp(t,n);return!0}function e9(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function ume(n,e,t=Fl){e9(n,e).clearInstance(t)}function t9(n){return n.options!==void 0}function Un(n){return n==null?!1:n.settings!==void 0}function cme(){ad.clear()}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fme={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ka=new hc("app","Firebase",fme);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let n9=class{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new jl("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ka.create("app-deleted",{appName:this._name})}};/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T2(n,e){const t=gP(n.split(".")[1]);if(t===null){console.error(`FirebaseServerApp ${e} is invalid: second part could not be parsed.`);return}if(JSON.parse(t).exp===void 0){console.error(`FirebaseServerApp ${e} is invalid: expiration claim could not be parsed`);return}const i=JSON.parse(t).exp*1e3,a=new Date().getTime();i-a<=0&&console.error(`FirebaseServerApp ${e} is invalid: the token has expired.`)}class dme extends n9{constructor(e,t,r,i){const a=t.automaticDataCollectionEnabled!==void 0?t.automaticDataCollectionEnabled:!0,s={name:r,automaticDataCollectionEnabled:a};if(e.apiKey!==void 0)super(e,s,i);else{const o=e;super(o.options,s,i)}this._serverConfig=Object.assign({automaticDataCollectionEnabled:a},t),this._serverConfig.authIdToken&&T2(this._serverConfig.authIdToken,"authIdToken"),this._serverConfig.appCheckToken&&T2(this._serverConfig.appCheckToken,"appCheckToken"),this._finalizationRegistry=null,typeof FinalizationRegistry<"u"&&(this._finalizationRegistry=new FinalizationRegistry(()=>{this.automaticCleanup()})),this._refCount=0,this.incRefCount(this._serverConfig.releaseOnDeref),this._serverConfig.releaseOnDeref=void 0,t.releaseOnDeref=void 0,Oo(g_,uR,"serverapp")}toJSON(){}get refCount(){return this._refCount}incRefCount(e){this.isDeleted||(this._refCount++,e!==void 0&&this._finalizationRegistry!==null&&this._finalizationRegistry.register(e,this))}decRefCount(){return this.isDeleted?0:--this._refCount}automaticCleanup(){SP(this)}get settings(){return this.checkDestroyed(),this._serverConfig}checkDestroyed(){if(this.isDeleted)throw ka.create("server-app-deleted")}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const pc=ome;function EP(n,e={}){let t=n;typeof e!="object"&&(e={name:e});const r=Object.assign({name:Fl,automaticDataCollectionEnabled:!0},e),i=r.name;if(typeof i!="string"||!i)throw ka.create("bad-app-name",{appName:String(i)});if(t||(t=Vq()),!t)throw ka.create("no-options");const a=Bl.get(i);if(a){if(qp(t,a.options)&&qp(r,a.config))return a;throw ka.create("duplicate-app",{appName:i})}const s=new Jq(i);for(const u of ad.values())s.addComponent(u);const o=new n9(t,r,s);return Bl.set(i,o),o}function hme(n,e){if(ape()&&!Hq())throw ka.create("invalid-server-app-environment");e.automaticDataCollectionEnabled===void 0&&(e.automaticDataCollectionEnabled=!0);let t;t9(n)?t=n.options:t=n;const r=Object.assign(Object.assign({},e),t);r.releaseOnDeref!==void 0&&delete r.releaseOnDeref;const i=c=>[...c].reduce((d,p)=>Math.imul(31,d)+p.charCodeAt(0)|0,0);if(e.releaseOnDeref!==void 0&&typeof FinalizationRegistry>"u")throw ka.create("finalization-registry-not-supported",{});const a=""+i(JSON.stringify(r)),s=id.get(a);if(s)return s.incRefCount(e.releaseOnDeref),s;const o=new Jq(a);for(const c of ad.values())o.addComponent(c);const u=new dme(t,e,a,o);return id.set(a,u),u}function pme(n=Fl){const e=Bl.get(n);if(!e&&n===Fl&&Vq())return EP();if(!e)throw ka.create("no-app",{appName:n});return e}function mme(){return Array.from(Bl.values())}async function SP(n){let e=!1;const t=n.name;Bl.has(t)?(e=!0,Bl.delete(t)):id.has(t)&&n.decRefCount()<=0&&(id.delete(t),e=!0),e&&(await Promise.all(n.container.getProviders().map(r=>r.delete())),n.isDeleted=!0)}function Oo(n,e,t){var r;let i=(r=lme[n])!==null&&r!==void 0?r:n;t&&(i+=`-${t}`);const a=i.match(/\s|\//),s=e.match(/\s|\//);if(a||s){const o=[`Unable to register library "${i}" with version "${e}":`];a&&o.push(`library name "${i}" contains illegal characters (whitespace or "/")`),a&&s&&o.push("and"),s&&o.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Uo.warn(o.join(" "));return}Zu(new jl(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}function r9(n,e){if(n!==null&&typeof n!="function")throw ka.create("invalid-log-argument");wpe(n,e)}function i9(n){bpe(n)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const gme="firebase-heartbeat-database",yme=1,zp="firebase-heartbeat-store";let cC=null;function a9(){return cC||(cC=xpe(gme,yme,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(zp)}catch(t){console.warn(t)}}}}).catch(n=>{throw ka.create("idb-open",{originalErrorMessage:n.message})})),cC}async function vme(n){try{const t=(await a9()).transaction(zp),r=await t.objectStore(zp).get(s9(n));return await t.done,r}catch(e){if(e instanceof Li)Uo.warn(e.message);else{const t=ka.create("idb-get",{originalErrorMessage:e==null?void 0:e.message});Uo.warn(t.message)}}}async function A2(n,e){try{const r=(await a9()).transaction(zp,"readwrite");await r.objectStore(zp).put(e,s9(n)),await r.done}catch(t){if(t instanceof Li)Uo.warn(t.message);else{const r=ka.create("idb-set",{originalErrorMessage:t==null?void 0:t.message});Uo.warn(r.message)}}}function s9(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _me=1024,bme=30;class wme{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Sme(t),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){var e,t;try{const i=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),a=C2();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===a||this._heartbeatsCache.heartbeats.some(s=>s.date===a))return;if(this._heartbeatsCache.heartbeats.push({date:a,agent:i}),this._heartbeatsCache.heartbeats.length>bme){const s=Tme(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){Uo.warn(r)}}async getHeartbeatsHeader(){var e;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=C2(),{heartbeatsToSend:r,unsentEntries:i}=Eme(this._heartbeatsCache.heartbeats),a=Bq(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(t){return Uo.warn(t),""}}}function C2(){return new Date().toISOString().substring(0,10)}function Eme(n,e=_me){const t=[];let r=n.slice();for(const i of n){const a=t.find(s=>s.agent===i.agent);if(a){if(a.dates.push(i.date),R2(t)>e){a.dates.pop();break}}else if(t.push({agent:i.agent,dates:[i.date]}),R2(t)>e){t.pop();break}r=r.slice(1)}return{heartbeatsToSend:t,unsentEntries:r}}class Sme{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return m_()?ope().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const t=await vme(this.app);return t!=null&&t.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return A2(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){var t;if(await this._canUseIndexedDBPromise){const i=await this.read();return A2(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function R2(n){return Bq(JSON.stringify({version:2,heartbeats:n})).length}function Tme(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let r=1;r<n.length;r++)n[r].date<t&&(t=n[r].date,e=r);return e}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ame(n){Zu(new jl("platform-logger",e=>new kpe(e),"PRIVATE")),Zu(new jl("heartbeat",e=>new wme(e),"PRIVATE")),Oo(g_,uR,n),Oo(g_,uR,"esm2017"),Oo("fire-js","")}Ame("");const Cme=Object.freeze(Object.defineProperty({__proto__:null,FirebaseError:Li,SDK_VERSION:pc,_DEFAULT_ENTRY_NAME:Fl,_addComponent:Vp,_addOrOverwriteComponent:Qq,_apps:Bl,_clearComponents:cme,_components:ad,_getProvider:e9,_isFirebaseApp:t9,_isFirebaseServerApp:Un,_registerComponent:Zu,_removeServiceInstance:ume,_serverApps:id,deleteApp:SP,getApp:pme,getApps:mme,initializeApp:EP,initializeServerApp:hme,onLog:r9,registerVersion:Oo,setLogLevel:i9},Symbol.toStringTag,{value:"Module"}));/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rme{constructor(e,t){this._delegate=e,this.firebase=t,Vp(e,new jl("app-compat",()=>this,"PUBLIC")),this.container=e.container}get automaticDataCollectionEnabled(){return this._delegate.automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this._delegate.automaticDataCollectionEnabled=e}get name(){return this._delegate.name}get options(){return this._delegate.options}delete(){return new Promise(e=>{this._delegate.checkDestroyed(),e()}).then(()=>(this.firebase.INTERNAL.removeApp(this.name),SP(this._delegate)))}_getService(e,t=Fl){var r;this._delegate.checkDestroyed();const i=this._delegate.container.getProvider(e);return!i.isInitialized()&&((r=i.getComponent())===null||r===void 0?void 0:r.instantiationMode)==="EXPLICIT"&&i.initialize(),i.getImmediate({identifier:t})}_removeServiceInstance(e,t=Fl){this._delegate.container.getProvider(e).clearInstance(t)}_addComponent(e){Vp(this._delegate,e)}_addOrOverwriteComponent(e){Qq(this._delegate,e)}toJSON(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ime={"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance."},I2=new hc("app-compat","Firebase",Ime);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pme(n){const e={},t={__esModule:!0,initializeApp:a,app:i,registerVersion:Oo,setLogLevel:i9,onLog:r9,apps:null,SDK_VERSION:pc,INTERNAL:{registerComponent:o,removeApp:r,useAsService:u,modularAPIs:Cme}};t.default=t,Object.defineProperty(t,"apps",{get:s});function r(c){delete e[c]}function i(c){if(c=c||Fl,!_2(e,c))throw I2.create("no-app",{appName:c});return e[c]}i.App=n;function a(c,d={}){const p=EP(c,d);if(_2(e,p.name))return e[p.name];const m=new n(p,t);return e[p.name]=m,m}function s(){return Object.keys(e).map(c=>e[c])}function o(c){const d=c.name,p=d.replace("-compat","");if(Zu(c)&&c.type==="PUBLIC"){const m=(y=i())=>{if(typeof y[p]!="function")throw I2.create("invalid-app-argument",{appName:d});return y[p]()};c.serviceProps!==void 0&&p_(m,c.serviceProps),t[p]=m,n.prototype[p]=function(...y){return this._getService.bind(this,d).apply(this,c.multipleInstances?y:[])}}return c.type==="PUBLIC"?t[p]:null}function u(c,d){return d==="serverAuth"?null:d}return t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function o9(){const n=Pme(Rme);n.INTERNAL=Object.assign(Object.assign({},n.INTERNAL),{createFirebaseNamespace:o9,extendNamespace:e,createSubscribe:Kq,ErrorFactory:hc,deepExtend:p_});function e(t){p_(n,t)}return n}const xme=o9();/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const P2=new bP("@firebase/app-compat"),Ome="@firebase/app-compat",Nme="0.4.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kme(n){Oo(Ome,Nme,n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */try{const n=qq();if(n.firebase!==void 0){P2.warn(`
      Warning: Firebase is already defined in the global scope. Please make sure
      Firebase library is only loaded once.
    `);const e=n.firebase.SDK_VERSION;e&&e.indexOf("LITE")>=0&&P2.warn(`
        Warning: You are trying to load Firebase while using Firebase Performance standalone script.
        You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.
        `)}}catch{}const Xu=xme;kme();var Mme="firebase",Dme="11.9.1";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */Xu.registerVersion(Mme,Dme,"app-compat");function TP(n,e){var t={};for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&e.indexOf(r)<0&&(t[r]=n[r]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,r=Object.getOwnPropertySymbols(n);i<r.length;i++)e.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(n,r[i])&&(t[r[i]]=n[r[i]]);return t}const Lh={FACEBOOK:"facebook.com",GITHUB:"github.com",GOOGLE:"google.com",PASSWORD:"password",TWITTER:"twitter.com"},lf={EMAIL_SIGNIN:"EMAIL_SIGNIN",PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:"REVERT_SECOND_FACTOR_ADDITION",VERIFY_AND_CHANGE_EMAIL:"VERIFY_AND_CHANGE_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $me(){return{"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","emulator-config-failed":'Auth instance has already been used to make a network call. Auth can no longer be configured to use the emulator. Try calling "connectAuthEmulator()" sooner.',"expired-action-code":"The action code has expired.","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal AuthError has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registered for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal AuthError has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure to use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-emulator-scheme":"Emulator URL must start with a valid scheme (http:// or https://).","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is incorrect, malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","login-blocked":"Login blocked by user-provided method: {$originalMessage}","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal AuthError has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-password":"A non-empty password must be provided","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network AuthError (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal AuthError has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled.","already-initialized":"initializeAuth() has already been called with different options. To avoid this error, call initializeAuth() with the same options as when it was originally called, or call getAuth() to return the already initialized instance.","missing-recaptcha-token":"The reCAPTCHA token is missing when sending request to the backend.","invalid-recaptcha-token":"The reCAPTCHA token is invalid when sending request to the backend.","invalid-recaptcha-action":"The reCAPTCHA action is invalid when sending request to the backend.","recaptcha-not-enabled":"reCAPTCHA Enterprise integration is not enabled for this project.","missing-client-type":"The reCAPTCHA client type is missing when sending request to the backend.","missing-recaptcha-version":"The reCAPTCHA version is missing when sending request to the backend.","invalid-req-type":"Invalid request parameters.","invalid-recaptcha-version":"The reCAPTCHA version is invalid when sending request to the backend.","unsupported-password-policy-schema-version":"The password policy received from the backend uses a schema version that is not supported by this version of the Firebase SDK.","password-does-not-meet-requirements":"The password does not meet the requirements.","invalid-hosting-link-domain":"The provided Hosting link domain is not configured in Firebase Hosting or is not owned by the current project. This cannot be a default Hosting domain (`web.app` or `firebaseapp.com`)."}}function l9(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Lme=$me,Ume=l9,u9=new hc("auth","Firebase",l9());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const y_=new bP("@firebase/auth");function jme(n,...e){y_.logLevel<=_n.WARN&&y_.warn(`Auth (${pc}): ${n}`,...e)}function hv(n,...e){y_.logLevel<=_n.ERROR&&y_.error(`Auth (${pc}): ${n}`,...e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hr(n,...e){throw CP(n,...e)}function br(n,...e){return CP(n,...e)}function AP(n,e,t){const r=Object.assign(Object.assign({},Ume()),{[e]:t});return new hc("auth","Firebase",r).create(e,{appName:n.name})}function Pr(n){return AP(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ed(n,e,t){const r=t;if(!(e instanceof r))throw r.name!==e.constructor.name&&Hr(n,"argument-error"),AP(n,"argument-error",`Type of ${e.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function CP(n,...e){if(typeof n!="string"){const t=e[0],r=[...e.slice(1)];return r[0]&&(r[0].appName=n.name),n._errorFactory.create(t,...r)}return u9.create(n,...e)}function Ge(n,e,...t){if(!n)throw CP(e,...t)}function Bs(n){const e="INTERNAL ASSERTION FAILED: "+n;throw hv(e),new Error(e)}function gs(n,e){n||Bs(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hp(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.href)||""}function RP(){return x2()==="http:"||x2()==="https:"}function x2(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Fme(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(RP()||Gq()||"connection"in navigator)?navigator.onLine:!0}function Bme(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Pm{constructor(e,t){this.shortDelay=e,this.longDelay=t,gs(t>e,"Short delay should be less than long delay!"),this.isMobile=ipe()||vP()}get(){return Fme()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function IP(n,e){gs(n.emulator,"Emulator should always be set here");const{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class c9{static initialize(e,t,r){this.fetchImpl=e,t&&(this.headersImpl=t),r&&(this.responseImpl=r)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Bs("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Bs("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Bs("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qme={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vme=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],zme=new Pm(3e4,6e4);function Hn(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}async function Gn(n,e,t,r,i={}){return f9(n,i,async()=>{let a={},s={};r&&(e==="GET"?s=r:a={body:JSON.stringify(r)});const o=wd(Object.assign({key:n.config.apiKey},s)).slice(1),u=await n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:e,headers:u},a);return spe()||(c.referrerPolicy="no-referrer"),n.emulatorConfig&&Cb(n.emulatorConfig.host)&&(c.credentials="include"),c9.fetch()(await d9(n,n.config.apiHost,t,o),c)})}async function f9(n,e,t){n._canInitEmulator=!1;const r=Object.assign(Object.assign({},qme),e);try{const i=new Gme(n),a=await Promise.race([t(),i.promise]);i.clearNetworkTimeout();const s=await a.json();if("needConfirmation"in s)throw sp(n,"account-exists-with-different-credential",s);if(a.ok&&!("errorMessage"in s))return s;{const o=a.ok?s.errorMessage:s.error.message,[u,c]=o.split(" : ");if(u==="FEDERATED_USER_ID_ALREADY_LINKED")throw sp(n,"credential-already-in-use",s);if(u==="EMAIL_EXISTS")throw sp(n,"email-already-in-use",s);if(u==="USER_DISABLED")throw sp(n,"user-disabled",s);const d=r[u]||u.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw AP(n,d,c);Hr(n,d)}}catch(i){if(i instanceof Li)throw i;Hr(n,"network-request-failed",{message:String(i)})}}async function Vo(n,e,t,r,i={}){const a=await Gn(n,e,t,r,i);return"mfaPendingCredential"in a&&Hr(n,"multi-factor-auth-required",{_serverResponse:a}),a}async function d9(n,e,t,r){const i=`${e}${t}?${r}`,a=n,s=a.config.emulator?IP(n.config,i):`${n.config.apiScheme}://${i}`;return Vme.includes(t)&&(await a._persistenceManagerAvailable,a._getPersistenceType()==="COOKIE")?a._getPersistence()._getFinalTarget(s).toString():s}function Hme(n){switch(n){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Gme{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,r)=>{this.timer=setTimeout(()=>r(br(this.auth,"network-request-failed")),zme.get())})}}function sp(n,e,t){const r={appName:n.name};t.email&&(r.email=t.email),t.phoneNumber&&(r.phoneNumber=t.phoneNumber);const i=br(n,e,r);return i.customData._tokenResponse=t,i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O2(n){return n!==void 0&&n.getResponse!==void 0}function N2(n){return n!==void 0&&n.enterprise!==void 0}class h9{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return Hme(t.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wme(n){return(await Gn(n,"GET","/v1/recaptchaParams")).recaptchaSiteKey||""}async function p9(n,e){return Gn(n,"GET","/v2/recaptchaConfig",Hn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kme(n,e){return Gn(n,"POST","/v1/accounts:delete",e)}async function Jme(n,e){return Gn(n,"POST","/v1/accounts:update",e)}async function v_(n,e){return Gn(n,"POST","/v1/accounts:lookup",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function bp(n){if(n)try{const e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Yme(n,e=!1){const t=en(n),r=await t.getIdToken(e),i=Rb(r);Ge(i&&i.exp&&i.auth_time&&i.iat,t.auth,"internal-error");const a=typeof i.firebase=="object"?i.firebase:void 0,s=a==null?void 0:a.sign_in_provider;return{claims:i,token:r,authTime:bp(fC(i.auth_time)),issuedAtTime:bp(fC(i.iat)),expirationTime:bp(fC(i.exp)),signInProvider:s||null,signInSecondFactor:(a==null?void 0:a.sign_in_second_factor)||null}}function fC(n){return Number(n)*1e3}function Rb(n){const[e,t,r]=n.split(".");if(e===void 0||t===void 0||r===void 0)return hv("JWT malformed, contained fewer than 3 sections"),null;try{const i=gP(t);return i?JSON.parse(i):(hv("Failed to decode base64 JWT payload"),null)}catch(i){return hv("Caught error parsing JWT payload as JSON",i==null?void 0:i.toString()),null}}function k2(n){const e=Rb(n);return Ge(e,"internal-error"),Ge(typeof e.exp<"u","internal-error"),Ge(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function jo(n,e,t=!1){if(t)return e;try{return await e}catch(r){throw r instanceof Li&&Zme(r)&&n.auth.currentUser===n&&await n.auth.signOut(),r}}function Zme({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Xme{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const r=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),r}else{this.errorBackoff=3e4;const i=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){(e==null?void 0:e.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cR{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=bp(this.lastLoginAt),this.creationTime=bp(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Gp(n){var e;const t=n.auth,r=await n.getIdToken(),i=await jo(n,v_(t,{idToken:r}));Ge(i==null?void 0:i.users.length,t,"internal-error");const a=i.users[0];n._notifyReloadListener(a);const s=!((e=a.providerUserInfo)===null||e===void 0)&&e.length?m9(a.providerUserInfo):[],o=ege(n.providerData,s),u=n.isAnonymous,c=!(n.email&&a.passwordHash)&&!(o!=null&&o.length),d=u?c:!1,p={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:o,metadata:new cR(a.createdAt,a.lastLoginAt),isAnonymous:d};Object.assign(n,p)}async function Qme(n){const e=en(n);await Gp(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function ege(n,e){return[...n.filter(r=>!e.some(i=>i.providerId===r.providerId)),...e]}function m9(n){return n.map(e=>{var{providerId:t}=e,r=TP(e,["providerId"]);return{providerId:t,uid:r.rawId||"",displayName:r.displayName||null,email:r.email||null,phoneNumber:r.phoneNumber||null,photoURL:r.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function tge(n,e){const t=await f9(n,{},async()=>{const r=wd({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:i,apiKey:a}=n.config,s=await d9(n,i,"/v1/token",`key=${a}`),o=await n._getAdditionalHeaders();o["Content-Type"]="application/x-www-form-urlencoded";const u={method:"POST",headers:o,body:r};return n.emulatorConfig&&Cb(n.emulatorConfig.host)&&(u.credentials="include"),c9.fetch()(s,u)});return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}}async function nge(n,e){return Gn(n,"POST","/v2/accounts:revokeToken",Hn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hf{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ge(e.idToken,"internal-error"),Ge(typeof e.idToken<"u","internal-error"),Ge(typeof e.refreshToken<"u","internal-error");const t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):k2(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){Ge(e.length!==0,"internal-error");const t=k2(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(Ge(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:r,refreshToken:i,expiresIn:a}=await tge(e,t);this.updateTokensAndExpiration(r,i,Number(a))}updateTokensAndExpiration(e,t,r){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+r*1e3}static fromJSON(e,t){const{refreshToken:r,accessToken:i,expirationTime:a}=t,s=new Hf;return r&&(Ge(typeof r=="string","internal-error",{appName:e}),s.refreshToken=r),i&&(Ge(typeof i=="string","internal-error",{appName:e}),s.accessToken=i),a&&(Ge(typeof a=="number","internal-error",{appName:e}),s.expirationTime=a),s}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Hf,this.toJSON())}_performRefresh(){return Bs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function _l(n,e){Ge(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}class os{constructor(e){var{uid:t,auth:r,stsTokenManager:i}=e,a=TP(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Xme(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=r,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new cR(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(e){const t=await jo(this,this.stsTokenManager.getToken(this.auth,e));return Ge(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return Yme(this,e)}reload(){return Qme(this)}_assign(e){this!==e&&(Ge(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new os(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){Ge(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let r=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),r=!0),t&&await Gp(this),await this.auth._persistUserIfCurrent(this),r&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Un(this.auth.app))return Promise.reject(Pr(this.auth));const e=await this.getIdToken();return await jo(this,Kme(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var r,i,a,s,o,u,c,d;const p=(r=t.displayName)!==null&&r!==void 0?r:void 0,m=(i=t.email)!==null&&i!==void 0?i:void 0,y=(a=t.phoneNumber)!==null&&a!==void 0?a:void 0,b=(s=t.photoURL)!==null&&s!==void 0?s:void 0,w=(o=t.tenantId)!==null&&o!==void 0?o:void 0,S=(u=t._redirectEventId)!==null&&u!==void 0?u:void 0,T=(c=t.createdAt)!==null&&c!==void 0?c:void 0,C=(d=t.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:A,emailVerified:I,isAnonymous:x,providerData:L,stsTokenManager:U}=t;Ge(A&&U,e,"internal-error");const N=Hf.fromJSON(this.name,U);Ge(typeof A=="string",e,"internal-error"),_l(p,e.name),_l(m,e.name),Ge(typeof I=="boolean",e,"internal-error"),Ge(typeof x=="boolean",e,"internal-error"),_l(y,e.name),_l(b,e.name),_l(w,e.name),_l(S,e.name),_l(T,e.name),_l(C,e.name);const B=new os({uid:A,auth:e,email:m,emailVerified:I,displayName:p,isAnonymous:x,photoURL:b,phoneNumber:y,tenantId:w,stsTokenManager:N,createdAt:T,lastLoginAt:C});return L&&Array.isArray(L)&&(B.providerData=L.map(q=>Object.assign({},q))),S&&(B._redirectEventId=S),B}static async _fromIdTokenResponse(e,t,r=!1){const i=new Hf;i.updateFromServerResponse(t);const a=new os({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:r});return await Gp(a),a}static async _fromGetAccountInfoResponse(e,t,r){const i=t.users[0];Ge(i.localId!==void 0,"internal-error");const a=i.providerUserInfo!==void 0?m9(i.providerUserInfo):[],s=!(i.email&&i.passwordHash)&&!(a!=null&&a.length),o=new Hf;o.updateFromIdToken(r);const u=new os({uid:i.localId,auth:e,stsTokenManager:o,isAnonymous:s}),c={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:a,metadata:new cR(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash)&&!(a!=null&&a.length)};return Object.assign(u,c),u}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M2=new Map;function oa(n){gs(n instanceof Function,"Expected a class definition");let e=M2.get(n);return e?(gs(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,M2.set(n,e),e)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class g9{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return t===void 0?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}g9.type="NONE";const sd=g9;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nu(n,e,t){return`firebase:${n}:${e}:${t}`}class Gf{constructor(e,t,r){this.persistence=e,this.auth=t,this.userKey=r;const{config:i,name:a}=this.auth;this.fullUserKey=Nu(this.userKey,i.apiKey,a),this.fullPersistenceKey=Nu("persistence",i.apiKey,a),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const t=await v_(this.auth,{idToken:e}).catch(()=>{});return t?os._fromGetAccountInfoResponse(this.auth,t,e):null}return os._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,r="authUser"){if(!t.length)return new Gf(oa(sd),e,r);const i=(await Promise.all(t.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let a=i[0]||oa(sd);const s=Nu(r,e.config.apiKey,e.name);let o=null;for(const c of t)try{const d=await c._get(s);if(d){let p;if(typeof d=="string"){const m=await v_(e,{idToken:d}).catch(()=>{});if(!m)break;p=await os._fromGetAccountInfoResponse(e,m,d)}else p=os._fromJSON(e,d);c!==a&&(o=p),a=c;break}}catch{}const u=i.filter(c=>c._shouldAllowMigration);return!a._shouldAllowMigration||!u.length?new Gf(a,e,r):(a=u[0],o&&await a._set(s,o.toJSON()),await Promise.all(t.map(async c=>{if(c!==a)try{await c._remove(s)}catch{}})),new Gf(a,e,r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function D2(n){const e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(b9(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(y9(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(w9(e))return"Blackberry";if(E9(e))return"Webos";if(v9(e))return"Safari";if((e.includes("chrome/")||_9(e))&&!e.includes("edge/"))return"Chrome";if(xm(e))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,r=n.match(t);if((r==null?void 0:r.length)===2)return r[1]}return"Other"}function y9(n=wr()){return/firefox\//i.test(n)}function v9(n=wr()){const e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function _9(n=wr()){return/crios\//i.test(n)}function b9(n=wr()){return/iemobile/i.test(n)}function xm(n=wr()){return/android/i.test(n)}function w9(n=wr()){return/blackberry/i.test(n)}function E9(n=wr()){return/webos/i.test(n)}function Om(n=wr()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function rge(n=wr()){return/(iPad|iPhone|iPod).*OS 7_\d/i.test(n)||/(iPad|iPhone|iPod).*OS 8_\d/i.test(n)}function ige(n=wr()){var e;return Om(n)&&!!(!((e=window.navigator)===null||e===void 0)&&e.standalone)}function age(){return Wq()&&document.documentMode===10}function S9(n=wr()){return Om(n)||xm(n)||E9(n)||w9(n)||/windows phone/i.test(n)||b9(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function T9(n,e=[]){let t;switch(n){case"Browser":t=D2(wr());break;case"Worker":t=`${D2(wr())}-${n}`;break;default:t=n}const r=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${pc}/${r}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class sge{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const r=a=>new Promise((s,o)=>{try{const u=e(a);s(u)}catch(u){o(u)}});r.onAbort=t,this.queue.push(r);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const r of this.queue)await r(e),r.onAbort&&t.push(r.onAbort)}catch(r){t.reverse();for(const i of t)try{i()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:r==null?void 0:r.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oge(n,e={}){return Gn(n,"GET","/v2/passwordPolicy",Hn(n,e))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lge=6;class uge{constructor(e){var t,r,i,a;const s=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=s.minPasswordLength)!==null&&t!==void 0?t:lge,s.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=s.maxPasswordLength),s.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=s.containsLowercaseCharacter),s.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=s.containsUppercaseCharacter),s.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=s.containsNumericCharacter),s.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=s.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(i=(r=e.allowedNonAlphanumericCharacters)===null||r===void 0?void 0:r.join(""))!==null&&i!==void 0?i:"",this.forceUpgradeOnSignin=(a=e.forceUpgradeOnSignin)!==null&&a!==void 0?a:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,r,i,a,s,o;const u={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,u),this.validatePasswordCharacterOptions(e,u),u.isValid&&(u.isValid=(t=u.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),u.isValid&&(u.isValid=(r=u.meetsMaxPasswordLength)!==null&&r!==void 0?r:!0),u.isValid&&(u.isValid=(i=u.containsLowercaseLetter)!==null&&i!==void 0?i:!0),u.isValid&&(u.isValid=(a=u.containsUppercaseLetter)!==null&&a!==void 0?a:!0),u.isValid&&(u.isValid=(s=u.containsNumericCharacter)!==null&&s!==void 0?s:!0),u.isValid&&(u.isValid=(o=u.containsNonAlphanumericCharacter)!==null&&o!==void 0?o:!0),u}validatePasswordLengthOptions(e,t){const r=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;r&&(t.meetsMinPasswordLength=e.length>=r),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let r;for(let i=0;i<e.length;i++)r=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,r>="a"&&r<="z",r>="A"&&r<="Z",r>="0"&&r<="9",this.allowedNonAlphanumericCharacters.includes(r))}updatePasswordCharacterOptionsStatuses(e,t,r,i,a){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=r)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=a))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cge{constructor(e,t,r,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=r,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new $2(this),this.idTokenSubscription=new $2(this),this.beforeStateQueue=new sge(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=u9,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise(a=>this._resolvePersistenceManagerAvailable=a)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=oa(t)),this._initializationPromise=this.queue(async()=>{var r,i,a;if(!this._deleted&&(this.persistenceManager=await Gf.create(this,e),(r=this._resolvePersistenceManagerAvailable)===null||r===void 0||r.call(this),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(t),this.lastNotifiedUid=((a=this.currentUser)===null||a===void 0?void 0:a.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const t=await v_(this,{idToken:e}),r=await os._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(r)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if(Un(this.app)){const s=this.app.settings.authIdToken;return s?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(s).then(o,o))}):this.directlySetCurrentUser(null)}const r=await this.assertedPersistence.getCurrentUser();let i=r,a=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const s=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,o=i==null?void 0:i._redirectEventId,u=await this.tryRedirectSignIn(e);(!s||s===o)&&(u!=null&&u.user)&&(i=u.user,a=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(i)}catch(s){i=r,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(s))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Ge(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await Gp(e)}catch(t){if((t==null?void 0:t.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Bme()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(Un(this.app))return Promise.reject(Pr(this));const t=e?en(e):null;return t&&Ge(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&Ge(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return Un(this.app)?Promise.reject(Pr(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return Un(this.app)?Promise.reject(Pr(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(oa(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await oge(this),t=new uge(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new hc("auth","Firebase",e())}onAuthStateChanged(e,t,r){return this.registerStateListener(this.authStateSubscription,e,t,r)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,r){return this.registerStateListener(this.idTokenSubscription,e,t,r)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{const r=this.onAuthStateChanged(()=>{r(),e()},t)}})}async revokeAccessToken(e){if(this.currentUser){const t=await this.currentUser.getIdToken(),r={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(r.tenantId=this.tenantId),await nge(this,r)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}async _setRedirectUser(e,t){const r=await this.getOrInitRedirectPersistenceManager(t);return e===null?r.removeCurrentUser():r.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&oa(e)||this._popupRedirectResolver;Ge(t,this,"argument-error"),this.redirectPersistenceManager=await Gf.create(this,[oa(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,r;return this._isInitialized&&await this.queue(async()=>{}),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((r=this.redirectUser)===null||r===void 0?void 0:r._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const r=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==r&&(this.lastNotifiedUid=r,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,r,i){if(this._deleted)return()=>{};const a=typeof t=="function"?t:t.next.bind(t);let s=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ge(o,this,"internal-error"),o.then(()=>{s||a(this.currentUser)}),typeof t=="function"){const u=e.addObserver(t,r,i);return()=>{s=!0,u()}}else{const u=e.addObserver(t);return()=>{s=!0,u()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ge(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=T9(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const r=await((e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader());r&&(t["X-Firebase-Client"]=r);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;if(Un(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await((e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken());return t!=null&&t.error&&jme(`Error while retrieving App Check token: ${t.error}`),t==null?void 0:t.token}}function jn(n){return en(n)}class $2{constructor(e){this.auth=e,this.observer=null,this.addObserver=Kq(t=>this.observer=t)}get next(){return Ge(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let Nm={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function fge(n){Nm=n}function PP(n){return Nm.loadJS(n)}function dge(){return Nm.recaptchaV2Script}function hge(){return Nm.recaptchaEnterpriseScript}function pge(){return Nm.gapiScript}function A9(n){return`__${n}${Math.floor(Math.random()*1e6)}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mge=500,gge=6e4,Ly=1e12;class yge{constructor(e){this.auth=e,this.counter=Ly,this._widgets=new Map}render(e,t){const r=this.counter;return this._widgets.set(r,new bge(e,this.auth.name,t||{})),this.counter++,r}reset(e){var t;const r=e||Ly;(t=this._widgets.get(r))===null||t===void 0||t.delete(),this._widgets.delete(r)}getResponse(e){var t;const r=e||Ly;return((t=this._widgets.get(r))===null||t===void 0?void 0:t.getResponse())||""}async execute(e){var t;const r=e||Ly;return(t=this._widgets.get(r))===null||t===void 0||t.execute(),""}}class vge{constructor(){this.enterprise=new _ge}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class _ge{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class bge{constructor(e,t,r){this.params=r,this.timerId=null,this.deleted=!1,this.responseToken=null,this.clickHandler=()=>{this.execute()};const i=typeof e=="string"?document.getElementById(e):e;Ge(i,"argument-error",{appName:t}),this.container=i,this.isVisible=this.params.size!=="invisible",this.isVisible?this.execute():this.container.addEventListener("click",this.clickHandler)}getResponse(){return this.checkIfDeleted(),this.responseToken}delete(){this.checkIfDeleted(),this.deleted=!0,this.timerId&&(clearTimeout(this.timerId),this.timerId=null),this.container.removeEventListener("click",this.clickHandler)}execute(){this.checkIfDeleted(),!this.timerId&&(this.timerId=window.setTimeout(()=>{this.responseToken=wge(50);const{callback:e,"expired-callback":t}=this.params;if(e)try{e(this.responseToken)}catch{}this.timerId=window.setTimeout(()=>{if(this.timerId=null,this.responseToken=null,t)try{t()}catch{}this.isVisible&&this.execute()},gge)},mge))}checkIfDeleted(){if(this.deleted)throw new Error("reCAPTCHA mock was already deleted!")}}function wge(n){const e=[],t="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let r=0;r<n;r++)e.push(t.charAt(Math.floor(Math.random()*t.length)));return e.join("")}const Ege="recaptcha-enterprise",wp="NO_RECAPTCHA";class C9{constructor(e){this.type=Ege,this.auth=jn(e)}async verify(e="verify",t=!1){async function r(a){if(!t){if(a.tenantId==null&&a._agentRecaptchaConfig!=null)return a._agentRecaptchaConfig.siteKey;if(a.tenantId!=null&&a._tenantRecaptchaConfigs[a.tenantId]!==void 0)return a._tenantRecaptchaConfigs[a.tenantId].siteKey}return new Promise(async(s,o)=>{p9(a,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(u=>{if(u.recaptchaKey===void 0)o(new Error("recaptcha Enterprise site key undefined"));else{const c=new h9(u);return a.tenantId==null?a._agentRecaptchaConfig=c:a._tenantRecaptchaConfigs[a.tenantId]=c,s(c.siteKey)}}).catch(u=>{o(u)})})}function i(a,s,o){const u=window.grecaptcha;N2(u)?u.enterprise.ready(()=>{u.enterprise.execute(a,{action:e}).then(c=>{s(c)}).catch(()=>{s(wp)})}):o(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new vge().execute("siteKey",{action:"verify"}):new Promise((a,s)=>{r(this.auth).then(o=>{if(!t&&N2(window.grecaptcha))i(o,a,s);else{if(typeof window>"u"){s(new Error("RecaptchaVerifier is only supported in browser"));return}let u=hge();u.length!==0&&(u+=o),PP(u).then(()=>{i(o,a,s)}).catch(c=>{s(c)})}}).catch(o=>{s(o)})})}}async function Uh(n,e,t,r=!1,i=!1){const a=new C9(n);let s;if(i)s=wp;else try{s=await a.verify(t)}catch{s=await a.verify(t,!0)}const o=Object.assign({},e);if(t==="mfaSmsEnrollment"||t==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in o){const u=o.phoneEnrollmentInfo.phoneNumber,c=o.phoneEnrollmentInfo.recaptchaToken;Object.assign(o,{phoneEnrollmentInfo:{phoneNumber:u,recaptchaToken:c,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in o){const u=o.phoneSignInInfo.recaptchaToken;Object.assign(o,{phoneSignInInfo:{recaptchaToken:u,captchaResponse:s,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return o}return r?Object.assign(o,{captchaResp:s}):Object.assign(o,{captchaResponse:s}),Object.assign(o,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(o,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),o}async function Ml(n,e,t,r,i){var a,s;if(i==="EMAIL_PASSWORD_PROVIDER")if(!((a=n._getRecaptchaConfig())===null||a===void 0)&&a.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const o=await Uh(n,e,t,t==="getOobCode");return r(n,o)}else return r(n,e).catch(async o=>{if(o.code==="auth/missing-recaptcha-token"){console.log(`${t} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const u=await Uh(n,e,t,t==="getOobCode");return r(n,u)}else return Promise.reject(o)});else if(i==="PHONE_PROVIDER")if(!((s=n._getRecaptchaConfig())===null||s===void 0)&&s.isProviderEnabled("PHONE_PROVIDER")){const o=await Uh(n,e,t);return r(n,o).catch(async u=>{var c;if(((c=n._getRecaptchaConfig())===null||c===void 0?void 0:c.getProviderEnforcementState("PHONE_PROVIDER"))==="AUDIT"&&(u.code==="auth/missing-recaptcha-token"||u.code==="auth/invalid-app-credential")){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${t} flow.`);const d=await Uh(n,e,t,!1,!0);return r(n,d)}return Promise.reject(u)})}else{const o=await Uh(n,e,t,!1,!0);return r(n,o)}else return Promise.reject(i+" provider is not supported.")}async function Sge(n){const e=jn(n),t=await p9(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),r=new h9(t);e.tenantId==null?e._agentRecaptchaConfig=r:e._tenantRecaptchaConfigs[e.tenantId]=r,r.isAnyProviderEnabled()&&new C9(e).verify()}function Tge(n,e){const t=(e==null?void 0:e.persistence)||[],r=(Array.isArray(t)?t:[t]).map(oa);e!=null&&e.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(r,e==null?void 0:e.popupRedirectResolver)}function Age(n,e,t){const r=jn(n);Ge(/^https?:\/\//.test(e),r,"invalid-emulator-scheme");const i=!!(t!=null&&t.disableWarnings),a=R9(e),{host:s,port:o}=Cge(e),u=o===null?"":`:${o}`,c={url:`${a}//${s}${u}/`},d=Object.freeze({host:s,port:o,protocol:a.replace(":",""),options:Object.freeze({disableWarnings:i})});if(!r._canInitEmulator){Ge(r.config.emulator&&r.emulatorConfig,r,"emulator-config-failed"),Ge(qp(c,r.config.emulator)&&qp(d,r.emulatorConfig),r,"emulator-config-failed");return}r.config.emulator=c,r.emulatorConfig=d,r.settings.appVerificationDisabledForTesting=!0,Cb(s)?(epe(`${a}//${s}${u}`),rpe("Auth",!0)):i||Rge()}function R9(n){const e=n.indexOf(":");return e<0?"":n.substr(0,e+1)}function Cge(n){const e=R9(n),t=/(\/\/)?([^?#/]+)/.exec(n.substr(e.length));if(!t)return{host:"",port:null};const r=t[2].split("@").pop()||"",i=/^(\[[^\]]+\])(:|$)/.exec(r);if(i){const a=i[1];return{host:a,port:L2(r.substr(a.length+1))}}else{const[a,s]=r.split(":");return{host:a,port:L2(s)}}}function L2(n){if(!n)return null;const e=Number(n);return isNaN(e)?null:e}function Rge(){function n(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Sd{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return Bs("not implemented")}_getIdTokenResponse(e){return Bs("not implemented")}_linkToIdToken(e,t){return Bs("not implemented")}_getReauthenticationResolver(e){return Bs("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function I9(n,e){return Gn(n,"POST","/v1/accounts:resetPassword",Hn(n,e))}async function Ige(n,e){return Gn(n,"POST","/v1/accounts:update",e)}async function Pge(n,e){return Gn(n,"POST","/v1/accounts:signUp",e)}async function xge(n,e){return Gn(n,"POST","/v1/accounts:update",Hn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Oge(n,e){return Vo(n,"POST","/v1/accounts:signInWithPassword",Hn(n,e))}async function Ib(n,e){return Gn(n,"POST","/v1/accounts:sendOobCode",Hn(n,e))}async function Nge(n,e){return Ib(n,e)}async function kge(n,e){return Ib(n,e)}async function Mge(n,e){return Ib(n,e)}async function Dge(n,e){return Ib(n,e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function $ge(n,e){return Vo(n,"POST","/v1/accounts:signInWithEmailLink",Hn(n,e))}async function Lge(n,e){return Vo(n,"POST","/v1/accounts:signInWithEmailLink",Hn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wp extends Sd{constructor(e,t,r,i=null){super("password",r),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new Wp(e,t,"password")}static _fromEmailAndCode(e,t,r=null){return new Wp(e,t,"emailLink",r)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;if(t!=null&&t.email&&(t!=null&&t.password)){if(t.signInMethod==="password")return this._fromEmailAndPassword(t.email,t.password);if(t.signInMethod==="emailLink")return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const t={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ml(e,t,"signInWithPassword",Oge,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return $ge(e,{email:this._email,oobCode:this._password});default:Hr(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":const r={idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return Ml(e,r,"signUpPassword",Pge,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return Lge(e,{idToken:t,email:this._email,oobCode:this._password});default:Hr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function No(n,e){return Vo(n,"POST","/v1/accounts:signInWithIdp",Hn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Uge="http://localhost";class Ks extends Sd{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Ks(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):Hr("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i}=t,a=TP(t,["providerId","signInMethod"]);if(!r||!i)return null;const s=new Ks(r,i);return s.idToken=a.idToken||void 0,s.accessToken=a.accessToken||void 0,s.secret=a.secret,s.nonce=a.nonce,s.pendingToken=a.pendingToken||null,s}_getIdTokenResponse(e){const t=this.buildRequest();return No(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,No(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,No(e,t)}buildRequest(){const e={requestUri:Uge,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=wd(t)}return e}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function U2(n,e){return Gn(n,"POST","/v1/accounts:sendVerificationCode",Hn(n,e))}async function jge(n,e){return Vo(n,"POST","/v1/accounts:signInWithPhoneNumber",Hn(n,e))}async function Fge(n,e){const t=await Vo(n,"POST","/v1/accounts:signInWithPhoneNumber",Hn(n,e));if(t.temporaryProof)throw sp(n,"account-exists-with-different-credential",t);return t}const Bge={USER_NOT_FOUND:"user-not-found"};async function qge(n,e){const t=Object.assign(Object.assign({},e),{operation:"REAUTH"});return Vo(n,"POST","/v1/accounts:signInWithPhoneNumber",Hn(n,t),Bge)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ku extends Sd{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new ku({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new ku({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return jge(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return Fge(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return qge(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:r,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:r,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){typeof e=="string"&&(e=JSON.parse(e));const{verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:a}=e;return!r&&!t&&!i&&!a?null:new ku({verificationId:t,verificationCode:r,phoneNumber:i,temporaryProof:a})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Vge(n){switch(n){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function zge(n){const e=Nf(ap(n)).link,t=e?Nf(ap(e)).deep_link_id:null,r=Nf(ap(n)).deep_link_id;return(r?Nf(ap(r)).link:null)||r||t||e||n}class Pb{constructor(e){var t,r,i,a,s,o;const u=Nf(ap(e)),c=(t=u.apiKey)!==null&&t!==void 0?t:null,d=(r=u.oobCode)!==null&&r!==void 0?r:null,p=Vge((i=u.mode)!==null&&i!==void 0?i:null);Ge(c&&d&&p,"argument-error"),this.apiKey=c,this.operation=p,this.code=d,this.continueUrl=(a=u.continueUrl)!==null&&a!==void 0?a:null,this.languageCode=(s=u.lang)!==null&&s!==void 0?s:null,this.tenantId=(o=u.tenantId)!==null&&o!==void 0?o:null}static parseLink(e){const t=zge(e);try{return new Pb(t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Hl{constructor(){this.providerId=Hl.PROVIDER_ID}static credential(e,t){return Wp._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const r=Pb.parseLink(t);return Ge(r,"argument-error"),Wp._fromEmailAndCode(e,r.code,r.tenantId)}}Hl.PROVIDER_ID="password";Hl.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Hl.EMAIL_LINK_SIGN_IN_METHOD="emailLink";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zo{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Td extends zo{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Wf extends Td{static credentialFromJSON(e){const t=typeof e=="string"?JSON.parse(e):e;return Ge("providerId"in t&&"signInMethod"in t,"argument-error"),Ks._fromParams(t)}credential(e){return this._credential(Object.assign(Object.assign({},e),{nonce:e.rawNonce}))}_credential(e){return Ge(e.idToken||e.accessToken,"argument-error"),Ks._fromParams(Object.assign(Object.assign({},e),{providerId:this.providerId,signInMethod:this.providerId}))}static credentialFromResult(e){return Wf.oauthCredentialFromTaggedObject(e)}static credentialFromError(e){return Wf.oauthCredentialFromTaggedObject(e.customData||{})}static oauthCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r,oauthTokenSecret:i,pendingToken:a,nonce:s,providerId:o}=e;if(!r&&!i&&!t&&!a||!o)return null;try{return new Wf(o)._credential({idToken:t,accessToken:r,nonce:s,pendingToken:a})}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ks extends Td{constructor(){super("facebook.com")}static credential(e){return Ks._fromParams({providerId:ks.PROVIDER_ID,signInMethod:ks.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return ks.credentialFromTaggedObject(e)}static credentialFromError(e){return ks.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return ks.credential(e.oauthAccessToken)}catch{return null}}}ks.FACEBOOK_SIGN_IN_METHOD="facebook.com";ks.PROVIDER_ID="facebook.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ms extends Td{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Ks._fromParams({providerId:Ms.PROVIDER_ID,signInMethod:Ms.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ms.credentialFromTaggedObject(e)}static credentialFromError(e){return Ms.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:r}=e;if(!t&&!r)return null;try{return Ms.credential(t,r)}catch{return null}}}Ms.GOOGLE_SIGN_IN_METHOD="google.com";Ms.PROVIDER_ID="google.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ds extends Td{constructor(){super("github.com")}static credential(e){return Ks._fromParams({providerId:Ds.PROVIDER_ID,signInMethod:Ds.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ds.credentialFromTaggedObject(e)}static credentialFromError(e){return Ds.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Ds.credential(e.oauthAccessToken)}catch{return null}}}Ds.GITHUB_SIGN_IN_METHOD="github.com";Ds.PROVIDER_ID="github.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hge="http://localhost";class od extends Sd{constructor(e,t){super(e,e),this.pendingToken=t}_getIdTokenResponse(e){const t=this.buildRequest();return No(e,t)}_linkToIdToken(e,t){const r=this.buildRequest();return r.idToken=t,No(e,r)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,No(e,t)}toJSON(){return{signInMethod:this.signInMethod,providerId:this.providerId,pendingToken:this.pendingToken}}static fromJSON(e){const t=typeof e=="string"?JSON.parse(e):e,{providerId:r,signInMethod:i,pendingToken:a}=t;return!r||!i||!a||r!==i?null:new od(r,a)}static _create(e,t){return new od(e,t)}buildRequest(){return{requestUri:Hge,returnSecureToken:!0,pendingToken:this.pendingToken}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gge="saml.";class __ extends zo{constructor(e){Ge(e.startsWith(Gge),"argument-error"),super(e)}static credentialFromResult(e){return __.samlCredentialFromTaggedObject(e)}static credentialFromError(e){return __.samlCredentialFromTaggedObject(e.customData||{})}static credentialFromJSON(e){const t=od.fromJSON(e);return Ge(t,"argument-error"),t}static samlCredentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{pendingToken:t,providerId:r}=e;if(!t||!r)return null;try{return od._create(r,t)}catch{return null}}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $s extends Td{constructor(){super("twitter.com")}static credential(e,t){return Ks._fromParams({providerId:$s.PROVIDER_ID,signInMethod:$s.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return $s.credentialFromTaggedObject(e)}static credentialFromError(e){return $s.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:r}=e;if(!t||!r)return null;try{return $s.credential(t,r)}catch{return null}}}$s.TWITTER_SIGN_IN_METHOD="twitter.com";$s.PROVIDER_ID="twitter.com";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function P9(n,e){return Vo(n,"POST","/v1/accounts:signUp",Hn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class $a{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,r,i=!1){const a=await os._fromIdTokenResponse(e,r,i),s=j2(r);return new $a({user:a,providerId:s,_tokenResponse:r,operationType:t})}static async _forOperation(e,t,r){await e._updateTokensIfNecessary(r,!0);const i=j2(r);return new $a({user:e,providerId:i,_tokenResponse:r,operationType:t})}}function j2(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Wge(n){var e;if(Un(n.app))return Promise.reject(Pr(n));const t=jn(n);if(await t._initializationPromise,!((e=t.currentUser)===null||e===void 0)&&e.isAnonymous)return new $a({user:t.currentUser,providerId:null,operationType:"signIn"});const r=await P9(t,{returnSecureToken:!0}),i=await $a._fromIdTokenResponse(t,"signIn",r,!0);return await t._updateCurrentUser(i.user),i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class b_ extends Li{constructor(e,t,r,i){var a;super(t.code,t.message),this.operationType=r,this.user=i,Object.setPrototypeOf(this,b_.prototype),this.customData={appName:e.name,tenantId:(a=e.tenantId)!==null&&a!==void 0?a:void 0,_serverResponse:t.customData._serverResponse,operationType:r}}static _fromErrorAndOperation(e,t,r,i){return new b_(e,t,r,i)}}function x9(n,e,t,r){return(e==="reauthenticate"?t._getReauthenticationResolver(n):t._getIdTokenResponse(n)).catch(a=>{throw a.code==="auth/multi-factor-auth-required"?b_._fromErrorAndOperation(n,a,e,r):a})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function O9(n){return new Set(n.map(({providerId:e})=>e).filter(e=>!!e))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Kge(n,e){const t=en(n);await xb(!0,t,e);const{providerUserInfo:r}=await Jme(t.auth,{idToken:await t.getIdToken(),deleteProvider:[e]}),i=O9(r||[]);return t.providerData=t.providerData.filter(a=>i.has(a.providerId)),i.has("phone")||(t.phoneNumber=null),await t.auth._persistUserIfCurrent(t),t}async function xP(n,e,t=!1){const r=await jo(n,e._linkToIdToken(n.auth,await n.getIdToken()),t);return $a._forOperation(n,"link",r)}async function xb(n,e,t){await Gp(e);const r=O9(e.providerData),i=n===!1?"provider-already-linked":"no-such-provider";Ge(r.has(t)===n,e.auth,i)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function N9(n,e,t=!1){const{auth:r}=n;if(Un(r.app))return Promise.reject(Pr(r));const i="reauthenticate";try{const a=await jo(n,x9(r,i,e,n),t);Ge(a.idToken,r,"internal-error");const s=Rb(a.idToken);Ge(s,r,"internal-error");const{sub:o}=s;return Ge(n.uid===o,r,"user-mismatch"),$a._forOperation(n,i,a)}catch(a){throw(a==null?void 0:a.code)==="auth/user-not-found"&&Hr(r,"user-mismatch"),a}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function k9(n,e,t=!1){if(Un(n.app))return Promise.reject(Pr(n));const r="signIn",i=await x9(n,r,e),a=await $a._fromIdTokenResponse(n,r,i);return t||await n._updateCurrentUser(a.user),a}async function Ob(n,e){return k9(jn(n),e)}async function M9(n,e){const t=en(n);return await xb(!1,t,e.providerId),xP(t,e)}async function D9(n,e){return N9(en(n),e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Jge(n,e){return Vo(n,"POST","/v1/accounts:signInWithCustomToken",Hn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Yge(n,e){if(Un(n.app))return Promise.reject(Pr(n));const t=jn(n),r=await Jge(t,{token:e,returnSecureToken:!0}),i=await $a._fromIdTokenResponse(t,"signIn",r);return await t._updateCurrentUser(i.user),i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class km{constructor(e,t){this.factorId=e,this.uid=t.mfaEnrollmentId,this.enrollmentTime=new Date(t.enrolledAt).toUTCString(),this.displayName=t.displayName}static _fromServerResponse(e,t){return"phoneInfo"in t?OP._fromServerResponse(e,t):"totpInfo"in t?NP._fromServerResponse(e,t):Hr(e,"internal-error")}}class OP extends km{constructor(e){super("phone",e),this.phoneNumber=e.phoneInfo}static _fromServerResponse(e,t){return new OP(t)}}class NP extends km{constructor(e){super("totp",e)}static _fromServerResponse(e,t){return new NP(t)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Nb(n,e,t){var r;Ge(((r=t.url)===null||r===void 0?void 0:r.length)>0,n,"invalid-continue-uri"),Ge(typeof t.dynamicLinkDomain>"u"||t.dynamicLinkDomain.length>0,n,"invalid-dynamic-link-domain"),Ge(typeof t.linkDomain>"u"||t.linkDomain.length>0,n,"invalid-hosting-link-domain"),e.continueUrl=t.url,e.dynamicLinkDomain=t.dynamicLinkDomain,e.linkDomain=t.linkDomain,e.canHandleCodeInApp=t.handleCodeInApp,t.iOS&&(Ge(t.iOS.bundleId.length>0,n,"missing-ios-bundle-id"),e.iOSBundleId=t.iOS.bundleId),t.android&&(Ge(t.android.packageName.length>0,n,"missing-android-pkg-name"),e.androidInstallApp=t.android.installApp,e.androidMinimumVersionCode=t.android.minimumVersion,e.androidPackageName=t.android.packageName)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function kP(n){const e=jn(n);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}async function Zge(n,e,t){const r=jn(n),i={requestType:"PASSWORD_RESET",email:e,clientType:"CLIENT_TYPE_WEB"};t&&Nb(r,i,t),await Ml(r,i,"getOobCode",kge,"EMAIL_PASSWORD_PROVIDER")}async function Xge(n,e,t){await I9(en(n),{oobCode:e,newPassword:t}).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&kP(n),r})}async function Qge(n,e){await xge(en(n),{oobCode:e})}async function $9(n,e){const t=en(n),r=await I9(t,{oobCode:e}),i=r.requestType;switch(Ge(i,t,"internal-error"),i){case"EMAIL_SIGNIN":break;case"VERIFY_AND_CHANGE_EMAIL":Ge(r.newEmail,t,"internal-error");break;case"REVERT_SECOND_FACTOR_ADDITION":Ge(r.mfaInfo,t,"internal-error");default:Ge(r.email,t,"internal-error")}let a=null;return r.mfaInfo&&(a=km._fromServerResponse(jn(t),r.mfaInfo)),{data:{email:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.newEmail:r.email)||null,previousEmail:(r.requestType==="VERIFY_AND_CHANGE_EMAIL"?r.email:r.newEmail)||null,multiFactorInfo:a},operation:i}}async function eye(n,e){const{data:t}=await $9(en(n),e);return t.email}async function tye(n,e,t){if(Un(n.app))return Promise.reject(Pr(n));const r=jn(n),s=await Ml(r,{returnSecureToken:!0,email:e,password:t,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",P9,"EMAIL_PASSWORD_PROVIDER").catch(u=>{throw u.code==="auth/password-does-not-meet-requirements"&&kP(n),u}),o=await $a._fromIdTokenResponse(r,"signIn",s);return await r._updateCurrentUser(o.user),o}function nye(n,e,t){return Un(n.app)?Promise.reject(Pr(n)):Ob(en(n),Hl.credential(e,t)).catch(async r=>{throw r.code==="auth/password-does-not-meet-requirements"&&kP(n),r})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rye(n,e,t){const r=jn(n),i={requestType:"EMAIL_SIGNIN",email:e,clientType:"CLIENT_TYPE_WEB"};function a(s,o){Ge(o.handleCodeInApp,r,"argument-error"),o&&Nb(r,s,o)}a(i,t),await Ml(r,i,"getOobCode",Mge,"EMAIL_PASSWORD_PROVIDER")}function iye(n,e){const t=Pb.parseLink(e);return(t==null?void 0:t.operation)==="EMAIL_SIGNIN"}async function aye(n,e,t){if(Un(n.app))return Promise.reject(Pr(n));const r=en(n),i=Hl.credentialWithLink(e,t||Hp());return Ge(i._tenantId===(r.tenantId||null),r,"tenant-id-mismatch"),Ob(r,i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sye(n,e){return Gn(n,"POST","/v1/accounts:createAuthUri",Hn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function oye(n,e){const t=RP()?Hp():"http://localhost",r={identifier:e,continueUri:t},{signinMethods:i}=await sye(en(n),r);return i||[]}async function lye(n,e){const t=en(n),i={requestType:"VERIFY_EMAIL",idToken:await n.getIdToken()};e&&Nb(t.auth,i,e);const{email:a}=await Nge(t.auth,i);a!==n.email&&await n.reload()}async function uye(n,e,t){const r=en(n),a={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:await n.getIdToken(),newEmail:e};t&&Nb(r.auth,a,t);const{email:s}=await Dge(r.auth,a);s!==n.email&&await n.reload()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function cye(n,e){return Gn(n,"POST","/v1/accounts:update",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function fye(n,{displayName:e,photoURL:t}){if(e===void 0&&t===void 0)return;const r=en(n),a={idToken:await r.getIdToken(),displayName:e,photoUrl:t,returnSecureToken:!0},s=await jo(r,cye(r.auth,a));r.displayName=s.displayName||null,r.photoURL=s.photoUrl||null;const o=r.providerData.find(({providerId:u})=>u==="password");o&&(o.displayName=r.displayName,o.photoURL=r.photoURL),await r._updateTokensIfNecessary(s)}function dye(n,e){const t=en(n);return Un(t.auth.app)?Promise.reject(Pr(t.auth)):L9(t,e,null)}function hye(n,e){return L9(en(n),null,e)}async function L9(n,e,t){const{auth:r}=n,a={idToken:await n.getIdToken(),returnSecureToken:!0};e&&(a.email=e),t&&(a.password=t);const s=await jo(n,Ige(r,a));await n._updateTokensIfNecessary(s,!0)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function pye(n){var e,t;if(!n)return null;const{providerId:r}=n,i=n.rawUserInfo?JSON.parse(n.rawUserInfo):{},a=n.isNewUser||n.kind==="identitytoolkit#SignupNewUserResponse";if(!r&&(n!=null&&n.idToken)){const s=(t=(e=Rb(n.idToken))===null||e===void 0?void 0:e.firebase)===null||t===void 0?void 0:t.sign_in_provider;if(s){const o=s!=="anonymous"&&s!=="custom"?s:null;return new Kf(a,o)}}if(!r)return null;switch(r){case"facebook.com":return new mye(a,i);case"github.com":return new gye(a,i);case"google.com":return new yye(a,i);case"twitter.com":return new vye(a,i,n.screenName||null);case"custom":case"anonymous":return new Kf(a,null);default:return new Kf(a,r,i)}}class Kf{constructor(e,t,r={}){this.isNewUser=e,this.providerId=t,this.profile=r}}class U9 extends Kf{constructor(e,t,r,i){super(e,t,r),this.username=i}}class mye extends Kf{constructor(e,t){super(e,"facebook.com",t)}}class gye extends U9{constructor(e,t){super(e,"github.com",t,typeof(t==null?void 0:t.login)=="string"?t==null?void 0:t.login:null)}}class yye extends Kf{constructor(e,t){super(e,"google.com",t)}}class vye extends U9{constructor(e,t,r){super(e,"twitter.com",t,r)}}function _ye(n){const{user:e,_tokenResponse:t}=n;return e.isAnonymous&&!t?{providerId:null,isNewUser:!1,profile:null}:pye(t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Cu{constructor(e,t,r){this.type=e,this.credential=t,this.user=r}static _fromIdtoken(e,t){return new Cu("enroll",e,t)}static _fromMfaPendingCredential(e){return new Cu("signin",e)}toJSON(){return{multiFactorSession:{[this.type==="enroll"?"idToken":"pendingCredential"]:this.credential}}}static fromJSON(e){var t,r;if(e!=null&&e.multiFactorSession){if(!((t=e.multiFactorSession)===null||t===void 0)&&t.pendingCredential)return Cu._fromMfaPendingCredential(e.multiFactorSession.pendingCredential);if(!((r=e.multiFactorSession)===null||r===void 0)&&r.idToken)return Cu._fromIdtoken(e.multiFactorSession.idToken)}return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class MP{constructor(e,t,r){this.session=e,this.hints=t,this.signInResolver=r}static _fromError(e,t){const r=jn(e),i=t.customData._serverResponse,a=(i.mfaInfo||[]).map(o=>km._fromServerResponse(r,o));Ge(i.mfaPendingCredential,r,"internal-error");const s=Cu._fromMfaPendingCredential(i.mfaPendingCredential);return new MP(s,a,async o=>{const u=await o._process(r,s);delete i.mfaInfo,delete i.mfaPendingCredential;const c=Object.assign(Object.assign({},i),{idToken:u.idToken,refreshToken:u.refreshToken});switch(t.operationType){case"signIn":const d=await $a._fromIdTokenResponse(r,t.operationType,c);return await r._updateCurrentUser(d.user),d;case"reauthenticate":return Ge(t.user,r,"internal-error"),$a._forOperation(t.user,t.operationType,c);default:Hr(r,"internal-error")}})}async resolveSignIn(e){const t=e;return this.signInResolver(t)}}function bye(n,e){var t;const r=en(n),i=e;return Ge(e.customData.operationType,r,"argument-error"),Ge((t=i.customData._serverResponse)===null||t===void 0?void 0:t.mfaPendingCredential,r,"argument-error"),MP._fromError(r,i)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function F2(n,e){return Gn(n,"POST","/v2/accounts/mfaEnrollment:start",Hn(n,e))}function wye(n,e){return Gn(n,"POST","/v2/accounts/mfaEnrollment:finalize",Hn(n,e))}function Eye(n,e){return Gn(n,"POST","/v2/accounts/mfaEnrollment:withdraw",Hn(n,e))}class DP{constructor(e){this.user=e,this.enrolledFactors=[],e._onReload(t=>{t.mfaInfo&&(this.enrolledFactors=t.mfaInfo.map(r=>km._fromServerResponse(e.auth,r)))})}static _fromUser(e){return new DP(e)}async getSession(){return Cu._fromIdtoken(await this.user.getIdToken(),this.user)}async enroll(e,t){const r=e,i=await this.getSession(),a=await jo(this.user,r._process(this.user.auth,i,t));return await this.user._updateTokensIfNecessary(a),this.user.reload()}async unenroll(e){const t=typeof e=="string"?e:e.uid,r=await this.user.getIdToken();try{const i=await jo(this.user,Eye(this.user.auth,{idToken:r,mfaEnrollmentId:t}));this.enrolledFactors=this.enrolledFactors.filter(({uid:a})=>a!==t),await this.user._updateTokensIfNecessary(i),await this.user.reload()}catch(i){throw i}}}const dC=new WeakMap;function Sye(n){const e=en(n);return dC.has(e)||dC.set(e,DP._fromUser(e)),dC.get(e)}const w_="__sak";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class j9{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(w_,"1"),this.storage.removeItem(w_),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tye=1e3,Aye=10;class F9 extends j9{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=S9(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const r=this.storage.getItem(t),i=this.localCache[t];r!==i&&e(t,i,r)}}onStorageEvent(e,t=!1){if(!e.key){this.forAllChangedKeys((s,o,u)=>{this.notifyListeners(s,u)});return}const r=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const s=this.storage.getItem(r);!t&&this.localCache[r]===s||this.notifyListeners(r,s)},a=this.storage.getItem(r);age()&&a!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,Aye):i()}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t&&JSON.parse(t))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,t,r)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:r}),!0)})},Tye)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}F9.type="LOCAL";const $P=F9;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class B9 extends j9{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,t){}_removeListener(e,t){}}B9.type="SESSION";const Qu=B9;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Cye(n){return Promise.all(n.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(t){return{fulfilled:!1,reason:t}}}))}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kb{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find(i=>i.isListeningto(e));if(t)return t;const r=new kb(e);return this.receivers.push(r),r}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:r,eventType:i,data:a}=t.data,s=this.handlersMap[i];if(!(s!=null&&s.size))return;t.ports[0].postMessage({status:"ack",eventId:r,eventType:i});const o=Array.from(s).map(async c=>c(t.origin,a)),u=await Cye(o);t.ports[0].postMessage({status:"done",eventId:r,eventType:i,response:u})}_subscribe(e,t){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),(!t||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}kb.receivers=[];/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Mm(n="",e=10){let t="";for(let r=0;r<e;r++)t+=Math.floor(Math.random()*10);return n+t}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rye{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,r=50){const i=typeof MessageChannel<"u"?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let a,s;return new Promise((o,u)=>{const c=Mm("",20);i.port1.start();const d=setTimeout(()=>{u(new Error("unsupported_event"))},r);s={messageChannel:i,onMessage(p){const m=p;if(m.data.eventId===c)switch(m.data.status){case"ack":clearTimeout(d),a=setTimeout(()=>{u(new Error("timeout"))},3e3);break;case"done":clearTimeout(a),o(m.data.response);break;default:clearTimeout(d),clearTimeout(a),u(new Error("invalid_response"));break}}},this.handlers.add(s),i.port1.addEventListener("message",s.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[i.port2])}).finally(()=>{s&&this.removeMessageHandler(s)})}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tr(){return window}function Iye(n){tr().location.href=n}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function LP(){return typeof tr().WorkerGlobalScope<"u"&&typeof tr().importScripts=="function"}async function Pye(){if(!(navigator!=null&&navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function xye(){var n;return((n=navigator==null?void 0:navigator.serviceWorker)===null||n===void 0?void 0:n.controller)||null}function Oye(){return LP()?self:null}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const q9="firebaseLocalStorageDb",Nye=1,E_="firebaseLocalStorage",V9="fbase_key";class Dm{constructor(e){this.request=e}toPromise(){return new Promise((e,t)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{t(this.request.error)})})}}function Mb(n,e){return n.transaction([E_],e?"readwrite":"readonly").objectStore(E_)}function kye(){const n=indexedDB.deleteDatabase(q9);return new Dm(n).toPromise()}function fR(){const n=indexedDB.open(q9,Nye);return new Promise((e,t)=>{n.addEventListener("error",()=>{t(n.error)}),n.addEventListener("upgradeneeded",()=>{const r=n.result;try{r.createObjectStore(E_,{keyPath:V9})}catch(i){t(i)}}),n.addEventListener("success",async()=>{const r=n.result;r.objectStoreNames.contains(E_)?e(r):(r.close(),await kye(),e(await fR()))})})}async function B2(n,e,t){const r=Mb(n,!0).put({[V9]:e,value:t});return new Dm(r).toPromise()}async function Mye(n,e){const t=Mb(n,!1).get(e),r=await new Dm(t).toPromise();return r===void 0?null:r.value}function q2(n,e){const t=Mb(n,!0).delete(e);return new Dm(t).toPromise()}const Dye=800,$ye=3;class z9{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await fR(),this.db)}async _withRetries(e){let t=0;for(;;)try{const r=await this._openDb();return await e(r)}catch(r){if(t++>$ye)throw r;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return LP()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=kb._getInstance(Oye()),this.receiver._subscribe("keyChanged",async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)})),this.receiver._subscribe("ping",async(e,t)=>["keyChanged"])}async initializeSender(){var e,t;if(this.activeServiceWorker=await Pye(),!this.activeServiceWorker)return;this.sender=new Rye(this.activeServiceWorker);const r=await this.sender._send("ping",{},800);r&&!((e=r[0])===null||e===void 0)&&e.fulfilled&&!((t=r[0])===null||t===void 0)&&t.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||xye()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await fR();return await B2(e,w_,"1"),await q2(e,w_),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite(async()=>(await this._withRetries(r=>B2(r,e,t)),this.localCache[e]=t,this.notifyServiceWorker(e)))}async _get(e){const t=await this._withRetries(r=>Mye(r,e));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(t=>q2(t,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(i=>{const a=Mb(i,!1).getAll();return new Dm(a).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const t=[],r=new Set;if(e.length!==0)for(const{fbase_key:i,value:a}of e)r.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(a)&&(this.notifyListeners(i,a),t.push(i));for(const i of Object.keys(this.localCache))this.localCache[i]&&!r.has(i)&&(this.notifyListeners(i,null),t.push(i));return t}notifyListeners(e,t){this.localCache[e]=t;const r=this.listeners[e];if(r)for(const i of Array.from(r))i(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),Dye)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}z9.type="LOCAL";const Kp=z9;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function V2(n,e){return Gn(n,"POST","/v2/accounts/mfaSignIn:start",Hn(n,e))}function Lye(n,e){return Gn(n,"POST","/v2/accounts/mfaSignIn:finalize",Hn(n,e))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hC=A9("rcb"),Uye=new Pm(3e4,6e4);class jye{constructor(){var e;this.hostLanguage="",this.counter=0,this.librarySeparatelyLoaded=!!(!((e=tr().grecaptcha)===null||e===void 0)&&e.render)}load(e,t=""){return Ge(Fye(t),e,"argument-error"),this.shouldResolveImmediately(t)&&O2(tr().grecaptcha)?Promise.resolve(tr().grecaptcha):new Promise((r,i)=>{const a=tr().setTimeout(()=>{i(br(e,"network-request-failed"))},Uye.get());tr()[hC]=()=>{tr().clearTimeout(a),delete tr()[hC];const o=tr().grecaptcha;if(!o||!O2(o)){i(br(e,"internal-error"));return}const u=o.render;o.render=(c,d)=>{const p=u(c,d);return this.counter++,p},this.hostLanguage=t,r(o)};const s=`${dge()}?${wd({onload:hC,render:"explicit",hl:t})}`;PP(s).catch(()=>{clearTimeout(a),i(br(e,"internal-error"))})})}clearedOneInstance(){this.counter--}shouldResolveImmediately(e){var t;return!!(!((t=tr().grecaptcha)===null||t===void 0)&&t.render)&&(e===this.hostLanguage||this.counter>0||this.librarySeparatelyLoaded)}}function Fye(n){return n.length<=6&&/^\s*[a-zA-Z0-9\-]*\s*$/.test(n)}class Bye{async load(e){return new yge(e)}clearedOneInstance(){}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ep="recaptcha",qye={theme:"light",type:"image"};let Vye=class{constructor(e,t,r=Object.assign({},qye)){this.parameters=r,this.type=Ep,this.destroyed=!1,this.widgetId=null,this.tokenChangeListeners=new Set,this.renderPromise=null,this.recaptcha=null,this.auth=jn(e),this.isInvisible=this.parameters.size==="invisible",Ge(typeof document<"u",this.auth,"operation-not-supported-in-this-environment");const i=typeof t=="string"?document.getElementById(t):t;Ge(i,this.auth,"argument-error"),this.container=i,this.parameters.callback=this.makeTokenCallback(this.parameters.callback),this._recaptchaLoader=this.auth.settings.appVerificationDisabledForTesting?new Bye:new jye,this.validateStartingState()}async verify(){this.assertNotDestroyed();const e=await this.render(),t=this.getAssertedRecaptcha(),r=t.getResponse(e);return r||new Promise(i=>{const a=s=>{s&&(this.tokenChangeListeners.delete(a),i(s))};this.tokenChangeListeners.add(a),this.isInvisible&&t.execute(e)})}render(){try{this.assertNotDestroyed()}catch(e){return Promise.reject(e)}return this.renderPromise?this.renderPromise:(this.renderPromise=this.makeRenderPromise().catch(e=>{throw this.renderPromise=null,e}),this.renderPromise)}_reset(){this.assertNotDestroyed(),this.widgetId!==null&&this.getAssertedRecaptcha().reset(this.widgetId)}clear(){this.assertNotDestroyed(),this.destroyed=!0,this._recaptchaLoader.clearedOneInstance(),this.isInvisible||this.container.childNodes.forEach(e=>{this.container.removeChild(e)})}validateStartingState(){Ge(!this.parameters.sitekey,this.auth,"argument-error"),Ge(this.isInvisible||!this.container.hasChildNodes(),this.auth,"argument-error"),Ge(typeof document<"u",this.auth,"operation-not-supported-in-this-environment")}makeTokenCallback(e){return t=>{if(this.tokenChangeListeners.forEach(r=>r(t)),typeof e=="function")e(t);else if(typeof e=="string"){const r=tr()[e];typeof r=="function"&&r(t)}}}assertNotDestroyed(){Ge(!this.destroyed,this.auth,"internal-error")}async makeRenderPromise(){if(await this.init(),!this.widgetId){let e=this.container;if(!this.isInvisible){const t=document.createElement("div");e.appendChild(t),e=t}this.widgetId=this.getAssertedRecaptcha().render(e,this.parameters)}return this.widgetId}async init(){Ge(RP()&&!LP(),this.auth,"internal-error"),await zye(),this.recaptcha=await this._recaptchaLoader.load(this.auth,this.auth.languageCode||void 0);const e=await Wme(this.auth);Ge(e,this.auth,"internal-error"),this.parameters.sitekey=e}getAssertedRecaptcha(){return Ge(this.recaptcha,this.auth,"internal-error"),this.recaptcha}};function zye(){let n=null;return new Promise(e=>{if(document.readyState==="complete"){e();return}n=()=>e(),window.addEventListener("load",n)}).catch(e=>{throw n&&window.removeEventListener("load",n),e})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class UP{constructor(e,t){this.verificationId=e,this.onConfirmation=t}confirm(e){const t=ku._fromVerification(this.verificationId,e);return this.onConfirmation(t)}}async function Hye(n,e,t){if(Un(n.app))return Promise.reject(Pr(n));const r=jn(n),i=await Db(r,e,en(t));return new UP(i,a=>Ob(r,a))}async function Gye(n,e,t){const r=en(n);await xb(!1,r,"phone");const i=await Db(r.auth,e,en(t));return new UP(i,a=>M9(r,a))}async function Wye(n,e,t){const r=en(n);if(Un(r.auth.app))return Promise.reject(Pr(r.auth));const i=await Db(r.auth,e,en(t));return new UP(i,a=>D9(r,a))}async function Db(n,e,t){var r;if(!n._getRecaptchaConfig())try{await Sge(n)}catch{console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let i;if(typeof e=="string"?i={phoneNumber:e}:i=e,"session"in i){const a=i.session;if("phoneNumber"in i){Ge(a.type==="enroll",n,"internal-error");const s={idToken:a.credential,phoneEnrollmentInfo:{phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"}};return(await Ml(n,s,"mfaSmsEnrollment",async(d,p)=>{if(p.phoneEnrollmentInfo.captchaResponse===wp){Ge((t==null?void 0:t.type)===Ep,d,"argument-error");const m=await pC(d,p,t);return F2(d,m)}return F2(d,p)},"PHONE_PROVIDER").catch(d=>Promise.reject(d))).phoneSessionInfo.sessionInfo}else{Ge(a.type==="signin",n,"internal-error");const s=((r=i.multiFactorHint)===null||r===void 0?void 0:r.uid)||i.multiFactorUid;Ge(s,n,"missing-multi-factor-info");const o={mfaPendingCredential:a.credential,mfaEnrollmentId:s,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}};return(await Ml(n,o,"mfaSmsSignIn",async(p,m)=>{if(m.phoneSignInInfo.captchaResponse===wp){Ge((t==null?void 0:t.type)===Ep,p,"argument-error");const y=await pC(p,m,t);return V2(p,y)}return V2(p,m)},"PHONE_PROVIDER").catch(p=>Promise.reject(p))).phoneResponseInfo.sessionInfo}}else{const a={phoneNumber:i.phoneNumber,clientType:"CLIENT_TYPE_WEB"};return(await Ml(n,a,"sendVerificationCode",async(c,d)=>{if(d.captchaResponse===wp){Ge((t==null?void 0:t.type)===Ep,c,"argument-error");const p=await pC(c,d,t);return U2(c,p)}return U2(c,d)},"PHONE_PROVIDER").catch(c=>Promise.reject(c))).sessionInfo}}finally{t==null||t._reset()}}async function Kye(n,e){const t=en(n);if(Un(t.auth.app))return Promise.reject(Pr(t.auth));await xP(t,e)}async function pC(n,e,t){Ge(t.type===Ep,n,"argument-error");const r=await t.verify();Ge(typeof r=="string",n,"argument-error");const i=Object.assign({},e);if("phoneEnrollmentInfo"in i){const a=i.phoneEnrollmentInfo.phoneNumber,s=i.phoneEnrollmentInfo.captchaResponse,o=i.phoneEnrollmentInfo.clientType,u=i.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(i,{phoneEnrollmentInfo:{phoneNumber:a,recaptchaToken:r,captchaResponse:s,clientType:o,recaptchaVersion:u}}),i}else if("phoneSignInInfo"in i){const a=i.phoneSignInInfo.captchaResponse,s=i.phoneSignInInfo.clientType,o=i.phoneSignInInfo.recaptchaVersion;return Object.assign(i,{phoneSignInInfo:{recaptchaToken:r,captchaResponse:a,clientType:s,recaptchaVersion:o}}),i}else return Object.assign(i,{recaptchaToken:r}),i}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ec=class pv{constructor(e){this.providerId=pv.PROVIDER_ID,this.auth=jn(e)}verifyPhoneNumber(e,t){return Db(this.auth,e,en(t))}static credential(e,t){return ku._fromVerification(e,t)}static credentialFromResult(e){const t=e;return pv.credentialFromTaggedObject(t)}static credentialFromError(e){return pv.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:r}=e;return t&&r?ku._fromTokenResponse(t,r):null}};ec.PROVIDER_ID="phone";ec.PHONE_SIGN_IN_METHOD="phone";/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mc(n,e){return e?oa(e):(Ge(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jP extends Sd{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return No(e,this._buildIdpRequest())}_linkToIdToken(e,t){return No(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return No(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Jye(n){return k9(n.auth,new jP(n),n.bypassAuthState)}function Yye(n){const{auth:e,user:t}=n;return Ge(t,e,"internal-error"),N9(t,new jP(n),n.bypassAuthState)}async function Zye(n){const{auth:e,user:t}=n;return Ge(t,e,"internal-error"),xP(t,new jP(n),n.bypassAuthState)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class H9{constructor(e,t,r,i,a=!1){this.auth=e,this.resolver=r,this.user=i,this.bypassAuthState=a,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise(async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(r){this.reject(r)}})}async onAuthEvent(e){const{urlResponse:t,sessionId:r,postBody:i,tenantId:a,error:s,type:o}=e;if(s){this.reject(s);return}const u={auth:this.auth,requestUri:t,sessionId:r,tenantId:a||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(u))}catch(c){this.reject(c)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Jye;case"linkViaPopup":case"linkViaRedirect":return Zye;case"reauthViaPopup":case"reauthViaRedirect":return Yye;default:Hr(this.auth,"internal-error")}}resolve(e){gs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){gs(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xye=new Pm(2e3,1e4);async function Qye(n,e,t){if(Un(n.app))return Promise.reject(br(n,"operation-not-supported-in-this-environment"));const r=jn(n);Ed(n,e,zo);const i=mc(r,t);return new Co(r,"signInViaPopup",e,i).executeNotNull()}async function eve(n,e,t){const r=en(n);if(Un(r.auth.app))return Promise.reject(br(r.auth,"operation-not-supported-in-this-environment"));Ed(r.auth,e,zo);const i=mc(r.auth,t);return new Co(r.auth,"reauthViaPopup",e,i,r).executeNotNull()}async function tve(n,e,t){const r=en(n);Ed(r.auth,e,zo);const i=mc(r.auth,t);return new Co(r.auth,"linkViaPopup",e,i,r).executeNotNull()}class Co extends H9{constructor(e,t,r,i,a){super(e,t,i,a),this.provider=r,this.authWindow=null,this.pollId=null,Co.currentPopupAction&&Co.currentPopupAction.cancel(),Co.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ge(e,this.auth,"internal-error"),e}async onExecution(){gs(this.filter.length===1,"Popup operations only handle one event");const e=Mm();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(t=>{this.reject(t)}),this.resolver._isIframeWebStorageSupported(this.auth,t=>{t||this.reject(br(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){var e;return((e=this.authWindow)===null||e===void 0?void 0:e.associatedEvent)||null}cancel(){this.reject(br(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Co.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,r;if(!((r=(t=this.authWindow)===null||t===void 0?void 0:t.window)===null||r===void 0)&&r.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(br(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,Xye.get())};e()}}Co.currentPopupAction=null;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const nve="pendingRedirect",Sp=new Map;class rve extends H9{constructor(e,t,r=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,r),this.eventId=null}async execute(){let e=Sp.get(this.auth._key());if(!e){try{const r=await ive(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(r)}catch(t){e=()=>Promise.reject(t)}Sp.set(this.auth._key(),e)}return this.bypassAuthState||Sp.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function ive(n,e){const t=W9(e),r=G9(n);if(!await r._isAvailable())return!1;const i=await r._get(t)==="true";return await r._remove(t),i}async function FP(n,e){return G9(n)._set(W9(e),"true")}function ave(){Sp.clear()}function BP(n,e){Sp.set(n._key(),e)}function G9(n){return oa(n._redirectPersistence)}function W9(n){return Nu(nve,n.config.apiKey,n.name)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function sve(n,e,t){return ove(n,e,t)}async function ove(n,e,t){if(Un(n.app))return Promise.reject(Pr(n));const r=jn(n);Ed(n,e,zo),await r._initializationPromise;const i=mc(r,t);return await FP(i,r),i._openRedirect(r,e,"signInViaRedirect")}function lve(n,e,t){return uve(n,e,t)}async function uve(n,e,t){const r=en(n);if(Ed(r.auth,e,zo),Un(r.auth.app))return Promise.reject(Pr(r.auth));await r.auth._initializationPromise;const i=mc(r.auth,t);await FP(i,r.auth);const a=await K9(r);return i._openRedirect(r.auth,e,"reauthViaRedirect",a)}function cve(n,e,t){return fve(n,e,t)}async function fve(n,e,t){const r=en(n);Ed(r.auth,e,zo),await r.auth._initializationPromise;const i=mc(r.auth,t);await xb(!1,r,e.providerId),await FP(i,r.auth);const a=await K9(r);return i._openRedirect(r.auth,e,"linkViaRedirect",a)}async function dve(n,e){return await jn(n)._initializationPromise,$b(n,e,!1)}async function $b(n,e,t=!1){if(Un(n.app))return Promise.reject(Pr(n));const r=jn(n),i=mc(r,e),s=await new rve(r,i,t).execute();return s&&!t&&(delete s.user._redirectEventId,await r._persistUserIfCurrent(s.user),await r._setRedirectUser(null,e)),s}async function K9(n){const e=Mm(`${n.uid}:::`);return n._redirectEventId=e,await n.auth._setRedirectUser(n),await n.auth._persistUserIfCurrent(n),e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hve=10*60*1e3;class J9{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach(r=>{this.isEventForConsumer(e,r)&&(t=!0,this.sendToConsumer(e,r),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!pve(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var r;if(e.error&&!Y9(e)){const i=((r=e.error.code)===null||r===void 0?void 0:r.split("auth/")[1])||"internal-error";t.onError(br(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const r=t.eventId===null||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&r}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=hve&&this.cachedEventUids.clear(),this.cachedEventUids.has(z2(e))}saveEventToCache(e){this.cachedEventUids.add(z2(e)),this.lastProcessedEventTime=Date.now()}}function z2(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(e=>e).join("-")}function Y9({type:n,error:e}){return n==="unknown"&&(e==null?void 0:e.code)==="auth/no-auth-event"}function pve(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Y9(n);default:return!1}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Z9(n,e={}){return Gn(n,"GET","/v1/projects",e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mve=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,gve=/^https?/;async function yve(n){if(n.config.emulator)return;const{authorizedDomains:e}=await Z9(n);for(const t of e)try{if(vve(t))return}catch{}Hr(n,"unauthorized-domain")}function vve(n){const e=Hp(),{protocol:t,hostname:r}=new URL(e);if(n.startsWith("chrome-extension://")){const s=new URL(n);return s.hostname===""&&r===""?t==="chrome-extension:"&&n.replace("chrome-extension://","")===e.replace("chrome-extension://",""):t==="chrome-extension:"&&s.hostname===r}if(!gve.test(t))return!1;if(mve.test(n))return r===n;const i=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+i+"|"+i+")$","i").test(r)}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _ve=new Pm(3e4,6e4);function H2(){const n=tr().___jsl;if(n!=null&&n.H){for(const e of Object.keys(n.H))if(n.H[e].r=n.H[e].r||[],n.H[e].L=n.H[e].L||[],n.H[e].r=[...n.H[e].L],n.CP)for(let t=0;t<n.CP.length;t++)n.CP[t]=null}}function bve(n){return new Promise((e,t)=>{var r,i,a;function s(){H2(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{H2(),t(br(n,"network-request-failed"))},timeout:_ve.get()})}if(!((i=(r=tr().gapi)===null||r===void 0?void 0:r.iframes)===null||i===void 0)&&i.Iframe)e(gapi.iframes.getContext());else if(!((a=tr().gapi)===null||a===void 0)&&a.load)s();else{const o=A9("iframefcb");return tr()[o]=()=>{gapi.load?s():t(br(n,"network-request-failed"))},PP(`${pge()}?onload=${o}`).catch(u=>t(u))}}).catch(e=>{throw mv=null,e})}let mv=null;function wve(n){return mv=mv||bve(n),mv}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Eve=new Pm(5e3,15e3),Sve="__/auth/iframe",Tve="emulator/auth/iframe",Ave={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Cve=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Rve(n){const e=n.config;Ge(e.authDomain,n,"auth-domain-config-required");const t=e.emulator?IP(e,Tve):`https://${n.config.authDomain}/${Sve}`,r={apiKey:e.apiKey,appName:n.name,v:pc},i=Cve.get(n.config.apiHost);i&&(r.eid=i);const a=n._getFrameworks();return a.length&&(r.fw=a.join(",")),`${t}?${wd(r).slice(1)}`}async function Ive(n){const e=await wve(n),t=tr().gapi;return Ge(t,n,"internal-error"),e.open({where:document.body,url:Rve(n),messageHandlersFilter:t.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ave,dontclear:!0},r=>new Promise(async(i,a)=>{await r.restyle({setHideOnLeave:!1});const s=br(n,"network-request-failed"),o=tr().setTimeout(()=>{a(s)},Eve.get());function u(){tr().clearTimeout(o),i(r)}r.ping(u).then(u,()=>{a(s)})}))}/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Pve={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},xve=500,Ove=600,Nve="_blank",kve="http://localhost";class G2{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function Mve(n,e,t,r=xve,i=Ove){const a=Math.max((window.screen.availHeight-i)/2,0).toString(),s=Math.max((window.screen.availWidth-r)/2,0).toString();let o="";const u=Object.assign(Object.assign({},Pve),{width:r.toString(),height:i.toString(),top:a,left:s}),c=wr().toLowerCase();t&&(o=_9(c)?Nve:t),y9(c)&&(e=e||kve,u.scrollbars="yes");const d=Object.entries(u).reduce((m,[y,b])=>`${m}${y}=${b},`,"");if(ige(c)&&o!=="_self")return Dve(e||"",o),new G2(null);const p=window.open(e||"",o,d);Ge(p,n,"popup-blocked");try{p.focus()}catch{}return new G2(p)}function Dve(n,e){const t=document.createElement("a");t.href=n,t.target=e;const r=document.createEvent("MouseEvent");r.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),t.dispatchEvent(r)}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $ve="__/auth/handler",Lve="emulator/auth/handler",Uve=encodeURIComponent("fac");async function dR(n,e,t,r,i,a){Ge(n.config.authDomain,n,"auth-domain-config-required"),Ge(n.config.apiKey,n,"invalid-api-key");const s={apiKey:n.config.apiKey,appName:n.name,authType:t,redirectUrl:r,v:pc,eventId:i};if(e instanceof zo){e.setDefaultLanguage(n.languageCode),s.providerId=e.providerId||"",fpe(e.getCustomParameters())||(s.customParameters=JSON.stringify(e.getCustomParameters()));for(const[d,p]of Object.entries(a||{}))s[d]=p}if(e instanceof Td){const d=e.getScopes().filter(p=>p!=="");d.length>0&&(s.scopes=d.join(","))}n.tenantId&&(s.tid=n.tenantId);const o=s;for(const d of Object.keys(o))o[d]===void 0&&delete o[d];const u=await n._getAppCheckToken(),c=u?`#${Uve}=${encodeURIComponent(u)}`:"";return`${jve(n)}?${wd(o).slice(1)}${c}`}function jve({config:n}){return n.emulator?IP(n,Lve):`https://${n.authDomain}/${$ve}`}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const mC="webStorageSupport";class Fve{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Qu,this._completeRedirectFn=$b,this._overrideRedirectResult=BP}async _openPopup(e,t,r,i){var a;gs((a=this.eventManagers[e._key()])===null||a===void 0?void 0:a.manager,"_initialize() not called before _openPopup()");const s=await dR(e,t,r,Hp(),i);return Mve(e,s,Mm())}async _openRedirect(e,t,r,i){await this._originValidation(e);const a=await dR(e,t,r,Hp(),i);return Iye(a),new Promise(()=>{})}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:i,promise:a}=this.eventManagers[t];return i?Promise.resolve(i):(gs(a,"If manager is not set, promise should be"),a)}const r=this.initAndGetManager(e);return this.eventManagers[t]={promise:r},r.catch(()=>{delete this.eventManagers[t]}),r}async initAndGetManager(e){const t=await Ive(e),r=new J9(e);return t.register("authEvent",i=>(Ge(i==null?void 0:i.authEvent,e,"invalid-auth-event"),{status:r.onEvent(i.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:r},this.iframes[e._key()]=t,r}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(mC,{type:mC},i=>{var a;const s=(a=i==null?void 0:i[0])===null||a===void 0?void 0:a[mC];s!==void 0&&t(!!s),Hr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=yve(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return S9()||v9()||Om()}}const Bve=Fve;class qve{constructor(e){this.factorId=e}_process(e,t,r){switch(t.type){case"enroll":return this._finalizeEnroll(e,t.credential,r);case"signin":return this._finalizeSignIn(e,t.credential);default:return Bs("unexpected MultiFactorSessionType")}}}class qP extends qve{constructor(e){super("phone"),this.credential=e}static _fromCredential(e){return new qP(e)}_finalizeEnroll(e,t,r){return wye(e,{idToken:t,displayName:r,phoneVerificationInfo:this.credential._makeVerificationRequest()})}_finalizeSignIn(e,t){return Lye(e,{mfaPendingCredential:t,phoneVerificationInfo:this.credential._makeVerificationRequest()})}}class X9{constructor(){}static assertion(e){return qP._fromCredential(e)}}X9.FACTOR_ID="phone";var W2="@firebase/auth",K2="1.10.7";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Vve{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged(r=>{e((r==null?void 0:r.stsTokenManager.accessToken)||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){Ge(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zve(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Hve(n){Zu(new jl("auth",(e,{options:t})=>{const r=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),a=e.getProvider("app-check-internal"),{apiKey:s,authDomain:o}=r.options;Ge(s&&!s.includes(":"),"invalid-api-key",{appName:r.name});const u={apiKey:s,authDomain:o,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:T9(n)},c=new cge(r,i,a,u);return Tge(c,t),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,r)=>{e.getProvider("auth-internal").initialize()})),Zu(new jl("auth-internal",e=>{const t=jn(e.getProvider("auth").getImmediate());return(r=>new Vve(r))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),Oo(W2,K2,zve(n)),Oo(W2,K2,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gve=5*60;Xhe("authIdTokenMaxAge");function Wve(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}fge({loadJS(n){return new Promise((e,t)=>{const r=document.createElement("script");r.setAttribute("src",n),r.onload=e,r.onerror=i=>{const a=br("internal-error");a.customData=i,t(a)},r.type="text/javascript",r.charset="UTF-8",Wve().appendChild(r)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Hve("Browser");/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tc(){return window}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kve=2e3;async function Jve(n,e,t){var r;const{BuildInfo:i}=tc();gs(e.sessionId,"AuthEvent did not contain a session ID");const a=await e_e(e.sessionId),s={};return Om()?s.ibi=i.packageName:xm()?s.apn=i.packageName:Hr(n,"operation-not-supported-in-this-environment"),i.displayName&&(s.appDisplayName=i.displayName),s.sessionId=a,dR(n,t,e.type,void 0,(r=e.eventId)!==null&&r!==void 0?r:void 0,s)}async function Yve(n){const{BuildInfo:e}=tc(),t={};Om()?t.iosBundleId=e.packageName:xm()?t.androidPackageName=e.packageName:Hr(n,"operation-not-supported-in-this-environment"),await Z9(n,t)}function Zve(n){const{cordova:e}=tc();return new Promise(t=>{e.plugins.browsertab.isAvailable(r=>{let i=null;r?e.plugins.browsertab.openUrl(n):i=e.InAppBrowser.open(n,rge()?"_blank":"_system","location=yes"),t(i)})})}async function Xve(n,e,t){const{cordova:r}=tc();let i=()=>{};try{await new Promise((a,s)=>{let o=null;function u(){var p;a();const m=(p=r.plugins.browsertab)===null||p===void 0?void 0:p.close;typeof m=="function"&&m(),typeof(t==null?void 0:t.close)=="function"&&t.close()}function c(){o||(o=window.setTimeout(()=>{s(br(n,"redirect-cancelled-by-user"))},Kve))}function d(){(document==null?void 0:document.visibilityState)==="visible"&&c()}e.addPassiveListener(u),document.addEventListener("resume",c,!1),xm()&&document.addEventListener("visibilitychange",d,!1),i=()=>{e.removePassiveListener(u),document.removeEventListener("resume",c,!1),document.removeEventListener("visibilitychange",d,!1),o&&window.clearTimeout(o)}})}finally{i()}}function Qve(n){var e,t,r,i,a,s,o,u,c,d;const p=tc();Ge(typeof((e=p==null?void 0:p.universalLinks)===null||e===void 0?void 0:e.subscribe)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-universal-links-plugin-fix"}),Ge(typeof((t=p==null?void 0:p.BuildInfo)===null||t===void 0?void 0:t.packageName)<"u",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-buildInfo"}),Ge(typeof((a=(i=(r=p==null?void 0:p.cordova)===null||r===void 0?void 0:r.plugins)===null||i===void 0?void 0:i.browsertab)===null||a===void 0?void 0:a.openUrl)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),Ge(typeof((u=(o=(s=p==null?void 0:p.cordova)===null||s===void 0?void 0:s.plugins)===null||o===void 0?void 0:o.browsertab)===null||u===void 0?void 0:u.isAvailable)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-browsertab"}),Ge(typeof((d=(c=p==null?void 0:p.cordova)===null||c===void 0?void 0:c.InAppBrowser)===null||d===void 0?void 0:d.open)=="function",n,"invalid-cordova-configuration",{missingPlugin:"cordova-plugin-inappbrowser"})}async function e_e(n){const e=t_e(n),t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(i=>i.toString(16).padStart(2,"0")).join("")}function t_e(n){if(gs(/[0-9a-zA-Z]+/.test(n),"Can only convert alpha-numeric strings"),typeof TextEncoder<"u")return new TextEncoder().encode(n);const e=new ArrayBuffer(n.length),t=new Uint8Array(e);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const n_e=20;class r_e extends J9{constructor(){super(...arguments),this.passiveListeners=new Set,this.initPromise=new Promise(e=>{this.resolveInitialized=e})}addPassiveListener(e){this.passiveListeners.add(e)}removePassiveListener(e){this.passiveListeners.delete(e)}resetRedirect(){this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1}onEvent(e){return this.resolveInitialized(),this.passiveListeners.forEach(t=>t(e)),super.onEvent(e)}async initialized(){await this.initPromise}}function i_e(n,e,t=null){return{type:e,eventId:t,urlResponse:null,sessionId:o_e(),postBody:null,tenantId:n.tenantId,error:br(n,"no-auth-event")}}function a_e(n,e){return hR()._set(pR(n),e)}async function J2(n){const e=await hR()._get(pR(n));return e&&await hR()._remove(pR(n)),e}function s_e(n,e){var t,r;const i=u_e(e);if(i.includes("/__/auth/callback")){const a=gv(i),s=a.firebaseError?l_e(decodeURIComponent(a.firebaseError)):null,o=(r=(t=s==null?void 0:s.code)===null||t===void 0?void 0:t.split("auth/"))===null||r===void 0?void 0:r[1],u=o?br(o):null;return u?{type:n.type,eventId:n.eventId,tenantId:n.tenantId,error:u,urlResponse:null,sessionId:null,postBody:null}:{type:n.type,eventId:n.eventId,tenantId:n.tenantId,sessionId:n.sessionId,urlResponse:i,postBody:null}}return null}function o_e(){const n=[],e="1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let t=0;t<n_e;t++){const r=Math.floor(Math.random()*e.length);n.push(e.charAt(r))}return n.join("")}function hR(){return oa($P)}function pR(n){return Nu("authEvent",n.config.apiKey,n.name)}function l_e(n){try{return JSON.parse(n)}catch{return null}}function u_e(n){const e=gv(n),t=e.link?decodeURIComponent(e.link):void 0,r=gv(t).link,i=e.deep_link_id?decodeURIComponent(e.deep_link_id):void 0;return gv(i).link||i||r||t||n}function gv(n){if(!(n!=null&&n.includes("?")))return{};const[e,...t]=n.split("?");return Nf(t.join("?"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const c_e=500;class f_e{constructor(){this._redirectPersistence=Qu,this._shouldInitProactively=!0,this.eventManagers=new Map,this.originValidationPromises={},this._completeRedirectFn=$b,this._overrideRedirectResult=BP}async _initialize(e){const t=e._key();let r=this.eventManagers.get(t);return r||(r=new r_e(e),this.eventManagers.set(t,r),this.attachCallbackListeners(e,r)),r}_openPopup(e){Hr(e,"operation-not-supported-in-this-environment")}async _openRedirect(e,t,r,i){Qve(e);const a=await this._initialize(e);await a.initialized(),a.resetRedirect(),ave(),await this._originValidation(e);const s=i_e(e,r,i);await a_e(e,s);const o=await Jve(e,s,t),u=await Zve(o);return Xve(e,a,u)}_isIframeWebStorageSupported(e,t){throw new Error("Method not implemented.")}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=Yve(e)),this.originValidationPromises[t]}attachCallbackListeners(e,t){const{universalLinks:r,handleOpenURL:i,BuildInfo:a}=tc(),s=setTimeout(async()=>{await J2(e),t.onEvent(Y2())},c_e),o=async d=>{clearTimeout(s);const p=await J2(e);let m=null;p&&(d!=null&&d.url)&&(m=s_e(p,d.url)),t.onEvent(m||Y2())};typeof r<"u"&&typeof r.subscribe=="function"&&r.subscribe(null,o);const u=i,c=`${a.packageName.toLowerCase()}://`;tc().handleOpenURL=async d=>{if(d.toLowerCase().startsWith(c)&&o({url:d}),typeof u=="function")try{u(d)}catch(p){console.error(p)}}}}const d_e=f_e;function Y2(){return{type:"unknown",eventId:null,sessionId:null,urlResponse:null,postBody:null,tenantId:null,error:br("no-auth-event")}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function h_e(n,e){jn(n)._logFramework(e)}var p_e="@firebase/auth-compat",m_e="0.5.27";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const g_e=1e3;function Tp(){var n;return((n=self==null?void 0:self.location)===null||n===void 0?void 0:n.protocol)||null}function y_e(){return Tp()==="http:"||Tp()==="https:"}function Q9(n=wr()){return!!((Tp()==="file:"||Tp()==="ionic:"||Tp()==="capacitor:")&&n.toLowerCase().match(/iphone|ipad|ipod|android/))}function v_e(){return vP()||zq()}function __e(){return Wq()&&(document==null?void 0:document.documentMode)===11}function b_e(n=wr()){return/Edge\/\d+/.test(n)}function w_e(n=wr()){return __e()||b_e(n)}function e8(){try{const n=self.localStorage,e=Mm();if(n)return n.setItem(e,"1"),n.removeItem(e),w_e()?m_():!0}catch{return VP()&&m_()}return!1}function VP(){return typeof window<"u"&&"WorkerGlobalScope"in window&&"importScripts"in window}function gC(){return(y_e()||Gq()||Q9())&&!v_e()&&e8()&&!VP()}function t8(){return Q9()&&typeof document<"u"}async function E_e(){return t8()?new Promise(n=>{const e=setTimeout(()=>{n(!1)},g_e);document.addEventListener("deviceready",()=>{clearTimeout(e),n(!0)})}):!1}function S_e(){return typeof window<"u"?window:null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const aa={LOCAL:"local",NONE:"none",SESSION:"session"},jh=Ge,n8="persistence";function T_e(n,e){if(jh(Object.values(aa).includes(e),n,"invalid-persistence-type"),vP()){jh(e!==aa.SESSION,n,"unsupported-persistence-type");return}if(zq()){jh(e===aa.NONE,n,"unsupported-persistence-type");return}if(VP()){jh(e===aa.NONE||e===aa.LOCAL&&m_(),n,"unsupported-persistence-type");return}jh(e===aa.NONE||e8(),n,"unsupported-persistence-type")}async function mR(n){await n._initializationPromise;const e=r8(),t=Nu(n8,n.config.apiKey,n.name);e&&e.setItem(t,n._getPersistenceType())}function A_e(n,e){const t=r8();if(!t)return[];const r=Nu(n8,n,e);switch(t.getItem(r)){case aa.NONE:return[sd];case aa.LOCAL:return[Kp,Qu];case aa.SESSION:return[Qu];default:return[]}}function r8(){var n;try{return((n=S_e())===null||n===void 0?void 0:n.sessionStorage)||null}catch{return null}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const C_e=Ge;class Il{constructor(){this.browserResolver=oa(Bve),this.cordovaResolver=oa(d_e),this.underlyingResolver=null,this._redirectPersistence=Qu,this._completeRedirectFn=$b,this._overrideRedirectResult=BP}async _initialize(e){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._initialize(e)}async _openPopup(e,t,r,i){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openPopup(e,t,r,i)}async _openRedirect(e,t,r,i){return await this.selectUnderlyingResolver(),this.assertedUnderlyingResolver._openRedirect(e,t,r,i)}_isIframeWebStorageSupported(e,t){this.assertedUnderlyingResolver._isIframeWebStorageSupported(e,t)}_originValidation(e){return this.assertedUnderlyingResolver._originValidation(e)}get _shouldInitProactively(){return t8()||this.browserResolver._shouldInitProactively}get assertedUnderlyingResolver(){return C_e(this.underlyingResolver,"internal-error"),this.underlyingResolver}async selectUnderlyingResolver(){if(this.underlyingResolver)return;const e=await E_e();this.underlyingResolver=e?this.cordovaResolver:this.browserResolver}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function i8(n){return n.unwrap()}function R_e(n){return n.wrapped()}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function I_e(n){return a8(n)}function P_e(n,e){var t;const r=(t=e.customData)===null||t===void 0?void 0:t._tokenResponse;if((e==null?void 0:e.code)==="auth/multi-factor-auth-required"){const i=e;i.resolver=new x_e(n,bye(n,e))}else if(r){const i=a8(e),a=e;i&&(a.credential=i,a.tenantId=r.tenantId||void 0,a.email=r.email||void 0,a.phoneNumber=r.phoneNumber||void 0)}}function a8(n){const{_tokenResponse:e}=n instanceof Li?n.customData:n;if(!e)return null;if(!(n instanceof Li)&&"temporaryProof"in e&&"phoneNumber"in e)return ec.credentialFromResult(n);const t=e.providerId;if(!t||t===Lh.PASSWORD)return null;let r;switch(t){case Lh.GOOGLE:r=Ms;break;case Lh.FACEBOOK:r=ks;break;case Lh.GITHUB:r=Ds;break;case Lh.TWITTER:r=$s;break;default:const{oauthIdToken:i,oauthAccessToken:a,oauthTokenSecret:s,pendingToken:o,nonce:u}=e;return!a&&!s&&!i&&!o?null:o?t.startsWith("saml.")?od._create(t,o):Ks._fromParams({providerId:t,signInMethod:t,pendingToken:o,idToken:i,accessToken:a}):new Wf(t).credential({idToken:i,accessToken:a,rawNonce:u})}return n instanceof Li?r.credentialFromError(n):r.credentialFromResult(n)}function Ri(n,e){return e.catch(t=>{throw t instanceof Li&&P_e(n,t),t}).then(t=>{const r=t.operationType,i=t.user;return{operationType:r,credential:I_e(t),additionalUserInfo:_ye(t),user:Ro.getOrCreate(i)}})}async function gR(n,e){const t=await e;return{verificationId:t.verificationId,confirm:r=>Ri(n,t.confirm(r))}}class x_e{constructor(e,t){this.resolver=t,this.auth=R_e(e)}get session(){return this.resolver.session}get hints(){return this.resolver.hints}resolveSignIn(e){return Ri(i8(this.auth),this.resolver.resolveSignIn(e))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ro{constructor(e){this._delegate=e,this.multiFactor=Sye(e)}static getOrCreate(e){return Ro.USER_MAP.has(e)||Ro.USER_MAP.set(e,new Ro(e)),Ro.USER_MAP.get(e)}delete(){return this._delegate.delete()}reload(){return this._delegate.reload()}toJSON(){return this._delegate.toJSON()}getIdTokenResult(e){return this._delegate.getIdTokenResult(e)}getIdToken(e){return this._delegate.getIdToken(e)}linkAndRetrieveDataWithCredential(e){return this.linkWithCredential(e)}async linkWithCredential(e){return Ri(this.auth,M9(this._delegate,e))}async linkWithPhoneNumber(e,t){return gR(this.auth,Gye(this._delegate,e,t))}async linkWithPopup(e){return Ri(this.auth,tve(this._delegate,e,Il))}async linkWithRedirect(e){return await mR(jn(this.auth)),cve(this._delegate,e,Il)}reauthenticateAndRetrieveDataWithCredential(e){return this.reauthenticateWithCredential(e)}async reauthenticateWithCredential(e){return Ri(this.auth,D9(this._delegate,e))}reauthenticateWithPhoneNumber(e,t){return gR(this.auth,Wye(this._delegate,e,t))}reauthenticateWithPopup(e){return Ri(this.auth,eve(this._delegate,e,Il))}async reauthenticateWithRedirect(e){return await mR(jn(this.auth)),lve(this._delegate,e,Il)}sendEmailVerification(e){return lye(this._delegate,e)}async unlink(e){return await Kge(this._delegate,e),this}updateEmail(e){return dye(this._delegate,e)}updatePassword(e){return hye(this._delegate,e)}updatePhoneNumber(e){return Kye(this._delegate,e)}updateProfile(e){return fye(this._delegate,e)}verifyBeforeUpdateEmail(e,t){return uye(this._delegate,e,t)}get emailVerified(){return this._delegate.emailVerified}get isAnonymous(){return this._delegate.isAnonymous}get metadata(){return this._delegate.metadata}get phoneNumber(){return this._delegate.phoneNumber}get providerData(){return this._delegate.providerData}get refreshToken(){return this._delegate.refreshToken}get tenantId(){return this._delegate.tenantId}get displayName(){return this._delegate.displayName}get email(){return this._delegate.email}get photoURL(){return this._delegate.photoURL}get providerId(){return this._delegate.providerId}get uid(){return this._delegate.uid}get auth(){return this._delegate.auth}}Ro.USER_MAP=new WeakMap;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fh=Ge;class yR{constructor(e,t){if(this.app=e,t.isInitialized()){this._delegate=t.getImmediate(),this.linkUnderlyingAuth();return}const{apiKey:r}=e.options;Fh(r,"invalid-api-key",{appName:e.name}),Fh(r,"invalid-api-key",{appName:e.name});const i=typeof window<"u"?Il:void 0;this._delegate=t.initialize({options:{persistence:O_e(r,e.name),popupRedirectResolver:i}}),this._delegate._updateErrorMap(Lme),this.linkUnderlyingAuth()}get emulatorConfig(){return this._delegate.emulatorConfig}get currentUser(){return this._delegate.currentUser?Ro.getOrCreate(this._delegate.currentUser):null}get languageCode(){return this._delegate.languageCode}set languageCode(e){this._delegate.languageCode=e}get settings(){return this._delegate.settings}get tenantId(){return this._delegate.tenantId}set tenantId(e){this._delegate.tenantId=e}useDeviceLanguage(){this._delegate.useDeviceLanguage()}signOut(){return this._delegate.signOut()}useEmulator(e,t){Age(this._delegate,e,t)}applyActionCode(e){return Qge(this._delegate,e)}checkActionCode(e){return $9(this._delegate,e)}confirmPasswordReset(e,t){return Xge(this._delegate,e,t)}async createUserWithEmailAndPassword(e,t){return Ri(this._delegate,tye(this._delegate,e,t))}fetchProvidersForEmail(e){return this.fetchSignInMethodsForEmail(e)}fetchSignInMethodsForEmail(e){return oye(this._delegate,e)}isSignInWithEmailLink(e){return iye(this._delegate,e)}async getRedirectResult(){Fh(gC(),this._delegate,"operation-not-supported-in-this-environment");const e=await dve(this._delegate,Il);return e?Ri(this._delegate,Promise.resolve(e)):{credential:null,user:null}}addFrameworkForLogging(e){h_e(this._delegate,e)}onAuthStateChanged(e,t,r){const{next:i,error:a,complete:s}=Z2(e,t,r);return this._delegate.onAuthStateChanged(i,a,s)}onIdTokenChanged(e,t,r){const{next:i,error:a,complete:s}=Z2(e,t,r);return this._delegate.onIdTokenChanged(i,a,s)}sendSignInLinkToEmail(e,t){return rye(this._delegate,e,t)}sendPasswordResetEmail(e,t){return Zge(this._delegate,e,t||void 0)}async setPersistence(e){T_e(this._delegate,e);let t;switch(e){case aa.SESSION:t=Qu;break;case aa.LOCAL:t=await oa(Kp)._isAvailable()?Kp:$P;break;case aa.NONE:t=sd;break;default:return Hr("argument-error",{appName:this._delegate.name})}return this._delegate.setPersistence(t)}signInAndRetrieveDataWithCredential(e){return this.signInWithCredential(e)}signInAnonymously(){return Ri(this._delegate,Wge(this._delegate))}signInWithCredential(e){return Ri(this._delegate,Ob(this._delegate,e))}signInWithCustomToken(e){return Ri(this._delegate,Yge(this._delegate,e))}signInWithEmailAndPassword(e,t){return Ri(this._delegate,nye(this._delegate,e,t))}signInWithEmailLink(e,t){return Ri(this._delegate,aye(this._delegate,e,t))}signInWithPhoneNumber(e,t){return gR(this._delegate,Hye(this._delegate,e,t))}async signInWithPopup(e){return Fh(gC(),this._delegate,"operation-not-supported-in-this-environment"),Ri(this._delegate,Qye(this._delegate,e,Il))}async signInWithRedirect(e){return Fh(gC(),this._delegate,"operation-not-supported-in-this-environment"),await mR(this._delegate),sve(this._delegate,e,Il)}updateCurrentUser(e){return this._delegate.updateCurrentUser(e)}verifyPasswordResetCode(e){return eye(this._delegate,e)}unwrap(){return this._delegate}_delete(){return this._delegate._delete()}linkUnderlyingAuth(){this._delegate.wrapped=()=>this}}yR.Persistence=aa;function Z2(n,e,t){let r=n;typeof n!="function"&&({next:r,error:e,complete:t}=n);const i=r;return{next:s=>i(s&&Ro.getOrCreate(s)),error:e,complete:t}}function O_e(n,e){const t=A_e(n,e);if(typeof self<"u"&&!t.includes(Kp)&&t.push(Kp),typeof window<"u")for(const r of[$P,Qu])t.includes(r)||t.push(r);return t.includes(sd)||t.push(sd),t}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class zP{static credential(e,t){return ec.credential(e,t)}constructor(){this.providerId="phone",this._delegate=new ec(i8(Xu.auth()))}verifyPhoneNumber(e,t){return this._delegate.verifyPhoneNumber(e,t)}unwrap(){return this._delegate}}zP.PHONE_SIGN_IN_METHOD=ec.PHONE_SIGN_IN_METHOD;zP.PROVIDER_ID=ec.PROVIDER_ID;/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const N_e=Ge;class k_e{constructor(e,t,r=Xu.app()){var i;N_e((i=r.options)===null||i===void 0?void 0:i.apiKey,"invalid-api-key",{appName:r.name}),this._delegate=new Vye(r.auth(),e,t),this.type=this._delegate.type}clear(){this._delegate.clear()}render(){return this._delegate.render()}verify(){return this._delegate.verify()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const M_e="auth-compat";function D_e(n){n.INTERNAL.registerComponent(new jl(M_e,e=>{const t=e.getProvider("app-compat").getImmediate(),r=e.getProvider("auth");return new yR(t,r)},"PUBLIC").setServiceProps({ActionCodeInfo:{Operation:{EMAIL_SIGNIN:lf.EMAIL_SIGNIN,PASSWORD_RESET:lf.PASSWORD_RESET,RECOVER_EMAIL:lf.RECOVER_EMAIL,REVERT_SECOND_FACTOR_ADDITION:lf.REVERT_SECOND_FACTOR_ADDITION,VERIFY_AND_CHANGE_EMAIL:lf.VERIFY_AND_CHANGE_EMAIL,VERIFY_EMAIL:lf.VERIFY_EMAIL}},EmailAuthProvider:Hl,FacebookAuthProvider:ks,GithubAuthProvider:Ds,GoogleAuthProvider:Ms,OAuthProvider:Wf,SAMLAuthProvider:__,PhoneAuthProvider:zP,PhoneMultiFactorGenerator:X9,RecaptchaVerifier:k_e,TwitterAuthProvider:$s,Auth:yR,AuthCredential:Sd,Error:Li}).setInstantiationMode("LAZY").setMultipleInstances(!1)),n.registerVersion(p_e,m_e)}D_e(Xu);Xu.apps.length||Xu.initializeApp(fH);const X2=Xu.auth(),$_e=()=>{const[n,e]=_t.useState(null),[t,r]=_t.useState(!0);return _t.useEffect(()=>{const a=X2.onAuthStateChanged(s=>{e(s||null),r(!1)});return()=>a()},[]),{user:n,loadingAuth:t,signOut:async()=>{try{await X2.signOut()}catch(a){console.error("Error signing out:",a)}}}},L_e=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function U_e(n){return typeof n=="string"&&L_e.test(n)}function s8(n){if(!U_e(n))throw TypeError("Invalid UUID");var e,t=new Uint8Array(16);return t[0]=(e=parseInt(n.slice(0,8),16))>>>24,t[1]=e>>>16&255,t[2]=e>>>8&255,t[3]=e&255,t[4]=(e=parseInt(n.slice(9,13),16))>>>8,t[5]=e&255,t[6]=(e=parseInt(n.slice(14,18),16))>>>8,t[7]=e&255,t[8]=(e=parseInt(n.slice(19,23),16))>>>8,t[9]=e&255,t[10]=(e=parseInt(n.slice(24,36),16))/1099511627776&255,t[11]=e/4294967296&255,t[12]=e>>>24&255,t[13]=e>>>16&255,t[14]=e>>>8&255,t[15]=e&255,t}var Ur=[];for(var yC=0;yC<256;++yC)Ur.push((yC+256).toString(16).slice(1));function Lb(n,e=0){return(Ur[n[e+0]]+Ur[n[e+1]]+Ur[n[e+2]]+Ur[n[e+3]]+"-"+Ur[n[e+4]]+Ur[n[e+5]]+"-"+Ur[n[e+6]]+Ur[n[e+7]]+"-"+Ur[n[e+8]]+Ur[n[e+9]]+"-"+Ur[n[e+10]]+Ur[n[e+11]]+Ur[n[e+12]]+Ur[n[e+13]]+Ur[n[e+14]]+Ur[n[e+15]]).toLowerCase()}var Uy,j_e=new Uint8Array(16);function F_e(){if(!Uy&&(Uy=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Uy))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Uy(j_e)}var vC,jy,_C=0,bC=0;function B_e(n,e,t){var r=0,i=e||new Array(16);n=n||{};var a=n.node,s=n.clockseq;if(n._v6||(a||(a=vC),s==null&&(s=jy)),a==null||s==null){var o=n.random||(n.rng||F_e)();a==null&&(a=[o[0],o[1],o[2],o[3],o[4],o[5]],!vC&&!n._v6&&(a[0]|=1,vC=a)),s==null&&(s=(o[6]<<8|o[7])&16383,jy===void 0&&!n._v6&&(jy=s))}var u=n.msecs!==void 0?n.msecs:Date.now(),c=n.nsecs!==void 0?n.nsecs:bC+1,d=u-_C+(c-bC)/1e4;if(d<0&&n.clockseq===void 0&&(s=s+1&16383),(d<0||u>_C)&&n.nsecs===void 0&&(c=0),c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_C=u,bC=c,jy=s,u+=122192928e5;var p=((u&268435455)*1e4+c)%4294967296;i[r++]=p>>>24&255,i[r++]=p>>>16&255,i[r++]=p>>>8&255,i[r++]=p&255;var m=u/4294967296*1e4&268435455;i[r++]=m>>>8&255,i[r++]=m&255,i[r++]=m>>>24&15|16,i[r++]=m>>>16&255,i[r++]=s>>>8|128,i[r++]=s&255;for(var y=0;y<6;++y)i[r+y]=a[y];return e||Lb(i)}function q_e(n){var e=typeof n=="string"?s8(n):n,t=V_e(e);return typeof n=="string"?Lb(t):t}function V_e(n,e=!1){return Uint8Array.of((n[6]&15)<<4|n[7]>>4&15,(n[7]&15)<<4|(n[4]&240)>>4,(n[4]&15)<<4|(n[5]&240)>>4,(n[5]&15)<<4|(n[0]&240)>>4,(n[0]&15)<<4|(n[1]&240)>>4,(n[1]&15)<<4|(n[2]&240)>>4,96|n[2]&15,n[3],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15])}function z_e(n){n=unescape(encodeURIComponent(n));for(var e=[],t=0;t<n.length;++t)e.push(n.charCodeAt(t));return e}var H_e="6ba7b810-9dad-11d1-80b4-00c04fd430c8",G_e="6ba7b811-9dad-11d1-80b4-00c04fd430c8";function W_e(n,e,t){function r(i,a,s,o){var u;if(typeof i=="string"&&(i=z_e(i)),typeof a=="string"&&(a=s8(a)),((u=a)===null||u===void 0?void 0:u.length)!==16)throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");var c=new Uint8Array(16+i.length);if(c.set(a),c.set(i,a.length),c=t(c),c[6]=c[6]&15|e,c[8]=c[8]&63|128,s){o=o||0;for(var d=0;d<16;++d)s[o+d]=c[d];return s}return Lb(c)}try{r.name=n}catch{}return r.DNS=H_e,r.URL=G_e,r}function K_e(n,e,t,r){switch(n){case 0:return e&t^~e&r;case 1:return e^t^r;case 2:return e&t^e&r^t&r;case 3:return e^t^r}}function wC(n,e){return n<<e|n>>>32-e}function J_e(n){var e=[1518500249,1859775393,2400959708,3395469782],t=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof n=="string"){var r=unescape(encodeURIComponent(n));n=[];for(var i=0;i<r.length;++i)n.push(r.charCodeAt(i))}else Array.isArray(n)||(n=Array.prototype.slice.call(n));n.push(128);for(var a=n.length/4+2,s=Math.ceil(a/16),o=new Array(s),u=0;u<s;++u){for(var c=new Uint32Array(16),d=0;d<16;++d)c[d]=n[u*64+d*4]<<24|n[u*64+d*4+1]<<16|n[u*64+d*4+2]<<8|n[u*64+d*4+3];o[u]=c}o[s-1][14]=(n.length-1)*8/Math.pow(2,32),o[s-1][14]=Math.floor(o[s-1][14]),o[s-1][15]=(n.length-1)*8&4294967295;for(var p=0;p<s;++p){for(var m=new Uint32Array(80),y=0;y<16;++y)m[y]=o[p][y];for(var b=16;b<80;++b)m[b]=wC(m[b-3]^m[b-8]^m[b-14]^m[b-16],1);for(var w=t[0],S=t[1],T=t[2],C=t[3],A=t[4],I=0;I<80;++I){var x=Math.floor(I/20),L=wC(w,5)+K_e(x,S,T,C)+A+e[x]+m[I]>>>0;A=C,C=T,T=wC(S,30)>>>0,S=w,w=L}t[0]=t[0]+w>>>0,t[1]=t[1]+S>>>0,t[2]=t[2]+T>>>0,t[3]=t[3]+C>>>0,t[4]=t[4]+A>>>0}return[t[0]>>24&255,t[0]>>16&255,t[0]>>8&255,t[0]&255,t[1]>>24&255,t[1]>>16&255,t[1]>>8&255,t[1]&255,t[2]>>24&255,t[2]>>16&255,t[2]>>8&255,t[2]&255,t[3]>>24&255,t[3]>>16&255,t[3]>>8&255,t[3]&255,t[4]>>24&255,t[4]>>16&255,t[4]>>8&255,t[4]&255]}var Y_e=W_e("v5",80,J_e);function Q2(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,r)}return t}function eF(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Q2(Object(t),!0).forEach(function(r){Z_e(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Q2(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Z_e(n,e,t){return(e=X_e(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function X_e(n){var e=Q_e(n,"string");return typeof e=="symbol"?e:e+""}function Q_e(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function ebe(n={},e,t=0){var r=B_e(eF(eF({},n),{},{_v6:!0}),new Uint8Array(16));return r=q_e(r),Lb(r)}function o8(n){return ebe({clockseq:n})}function kf(n,e){const t=e.replace(/-/g,"").match(/.{2}/g).map(r=>parseInt(r,16));return Y_e(n,new Uint8Array(t))}const tbe="__error__",yv="__scheduled__",nbe="__interrupt__",rbe="__resume__",ibe=[],abe=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));class l8 extends la{async addMessages(e){for(const t of e)await this.addMessage(t)}}class HP extends la{addUserMessage(e){return this.addMessage(new ei(e))}addAIChatMessage(e){return this.addMessage(new bn(e))}addAIMessage(e){return this.addMessage(new bn(e))}async addMessages(e){for(const t of e)await this.addMessage(t)}clear(){throw new Error("Not implemented.")}}class sbe extends HP{constructor(e){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","stores","message","in_memory"]}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.messages=e??[]}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async clear(){this.messages=[]}}const obe=Object.freeze(Object.defineProperty({__proto__:null,BaseChatMessageHistory:l8,BaseListChatMessageHistory:HP,InMemoryChatMessageHistory:sbe},Symbol.toStringTag,{value:"Module"}));class Mu{constructor(e){Object.defineProperty(this,"pageContent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pageContent=e.pageContent!==void 0?e.pageContent.toString():"",this.metadata=e.metadata??{},this.id=e.id}}class u8 extends qt{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","documents","transformers"]})}invoke(e,t){return this.transformDocuments(e)}}class lbe extends u8{async transformDocuments(e){const t=[];for(const r of e){const i=await this._transformDocument(r);t.push(i)}return t}}const ube=Object.freeze(Object.defineProperty({__proto__:null,BaseDocumentTransformer:u8,Document:Mu,MappingDocumentTransformer:lbe},Symbol.toStringTag,{value:"Module"}));class GP extends la{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","example_selectors","base"]})}}class c8{async getPromptAsync(e,t){return this.getPrompt(e).partial((t==null?void 0:t.partialVariables)??{})}}class cbe extends c8{constructor(e,t=[]){super(),Object.defineProperty(this,"defaultPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"conditionals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.defaultPrompt=e,this.conditionals=t}getPrompt(e){for(const[t,r]of this.conditionals)if(t(e))return r;return this.defaultPrompt}}function fbe(n){return n._modelType()==="base_llm"}function dbe(n){return n._modelType()==="base_chat_model"}function tF(n){return n.split(/\n| /).length}class WP extends GP{constructor(e){super(e),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"getTextLength",{enumerable:!0,configurable:!0,writable:!0,value:tF}),Object.defineProperty(this,"maxLength",{enumerable:!0,configurable:!0,writable:!0,value:2048}),Object.defineProperty(this,"exampleTextLengths",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.examplePrompt=e.examplePrompt,this.maxLength=e.maxLength??2048,this.getTextLength=e.getTextLength??tF}async addExample(e){this.examples.push(e);const t=await this.examplePrompt.format(e);this.exampleTextLengths.push(this.getTextLength(t))}async calculateExampleTextLengths(e,t){if(e.length>0)return e;const{examples:r,examplePrompt:i}=t;return(await Promise.all(r.map(s=>i.format(s)))).map(s=>this.getTextLength(s))}async selectExamples(e){const t=Object.values(e).join(" ");let r=this.maxLength-this.getTextLength(t),i=0;const a=[];for(;r>0&&i<this.examples.length;){const s=r-this.exampleTextLengths[i];if(s<0)break;a.push(this.examples[i]),r=s,i+=1}return a}static async fromExamples(e,t){const r=new WP(t);return await Promise.all(e.map(i=>r.addExample(i))),r}}function EC(n){return Object.keys(n).sort().map(e=>n[e])}class KP extends GP{constructor(e){if(super(e),Object.defineProperty(this,"vectorStoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleKeys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKeys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.exampleKeys=e.exampleKeys,this.inputKeys=e.inputKeys,e.vectorStore!==void 0)this.vectorStoreRetriever=e.vectorStore.asRetriever({k:e.k??4,filter:e.filter});else if(e.vectorStoreRetriever)this.vectorStoreRetriever=e.vectorStoreRetriever;else throw new Error('You must specify one of "vectorStore" and "vectorStoreRetriever".')}async addExample(e){const t=this.inputKeys??Object.keys(e),r=EC(t.reduce((i,a)=>({...i,[a]:e[a]}),{})).join(" ");await this.vectorStoreRetriever.addDocuments([new Mu({pageContent:r,metadata:e})])}async selectExamples(e){const t=this.inputKeys??Object.keys(e),r=EC(t.reduce((s,o)=>({...s,[o]:e[o]}),{})).join(" "),a=(await this.vectorStoreRetriever.invoke(r)).map(s=>s.metadata);return this.exampleKeys?a.map(s=>this.exampleKeys.reduce((o,u)=>({...o,[u]:s[u]}),{})):a}static async fromExamples(e,t,r,i={}){const a=i.inputKeys??null,s=e.map(u=>EC(a?a.reduce((c,d)=>({...c,[d]:u[d]}),{}):u).join(" ")),o=await r.fromTexts(s,e,t,i);return new KP({vectorStore:o,k:i.k??4,exampleKeys:i.exampleKeys,inputKeys:i.inputKeys})}}const hbe=Object.freeze(Object.defineProperty({__proto__:null,BaseExampleSelector:GP,BasePromptSelector:c8,ConditionalPromptSelector:cbe,LengthBasedExampleSelector:WP,SemanticSimilarityExampleSelector:KP,isChatModel:dbe,isLLM:fbe},Symbol.toStringTag,{value:"Module"}));class pbe{}const f8=(n,e)=>{if(e!==void 0)return n[e];const t=Object.keys(n);if(t.length===1)return n[t[0]]},mbe=(n,e)=>{const t=f8(n,e);if(!t){const r=Object.keys(n);throw new Error(`input values have ${r.length} keys, you must specify an input key or pass only 1 key as input`)}return t},gbe=(n,e)=>{const t=f8(n,e);if(!t&&t!==""){const r=Object.keys(n);throw new Error(`output values have ${r.length} keys, you must specify an output key or pass only 1 key as output`)}return t};function ybe(n,e){const t=Object.keys(n).filter(r=>!e.includes(r)&&r!=="stop");if(t.length!==1)throw new Error(`One input key expected, but got ${t.length}`);return t[0]}const vbe=Object.freeze(Object.defineProperty({__proto__:null,BaseMemory:pbe,getInputValue:mbe,getOutputValue:gbe,getPromptInputKey:ybe},Symbol.toStringTag,{value:"Module"})),_be="modulepreload",bbe=function(n,e){return new URL(n,e).href},nF={},SC=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){let s=function(d){return Promise.all(d.map(p=>Promise.resolve(p).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};const o=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),c=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));i=s(t.map(d=>{if(d=bbe(d,r),d in nF)return;nF[d]=!0;const p=d.endsWith(".css"),m=p?'[rel="stylesheet"]':"";if(!!r)for(let w=o.length-1;w>=0;w--){const S=o[w];if(S.href===d&&(!p||S.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${d}"]${m}`))return;const b=document.createElement("link");if(b.rel=p?"stylesheet":_be,p||(b.as="script"),b.crossOrigin="",b.href=d,c&&b.setAttribute("nonce",c),document.head.appendChild(b),p)return new Promise((w,S)=>{b.addEventListener("load",w),b.addEventListener("error",()=>S(new Error(`Unable to preload CSS for ${d}`)))})}))}function a(s){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=s,window.dispatchEvent(o),!o.defaultPrevented)throw s}return i.then(s=>{for(const o of s||[])o.status==="rejected"&&a(o.reason);return e().catch(a)})};class $m extends qt{get lc_attributes(){return{partialVariables:void 0}}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const{inputVariables:t}=e;if(t.includes("stop"))throw new Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,e)}async mergePartialAndUserVariables(e){const t=this.partialVariables??{},r={};for(const[a,s]of Object.entries(t))typeof s=="string"?r[a]=s:r[a]=await s();return{...r,...e}}async invoke(e,t){const r={...this.metadata,...t==null?void 0:t.metadata},i=[...this.tags??[],...(t==null?void 0:t.tags)??[]];return this._callWithConfig(a=>this.formatPromptValue(a),e,{...t,tags:i,metadata:r,runType:"prompt"})}serialize(){throw new Error("Use .toJSON() instead")}static async deserialize(e){switch(e._type){case"prompt":{const{PromptTemplate:t}=await SC(async()=>{const{PromptTemplate:r}=await Promise.resolve().then(()=>aF);return{PromptTemplate:r}},void 0,import.meta.url);return t.deserialize(e)}case void 0:{const{PromptTemplate:t}=await SC(async()=>{const{PromptTemplate:r}=await Promise.resolve().then(()=>aF);return{PromptTemplate:r}},void 0,import.meta.url);return t.deserialize({...e,_type:"prompt"})}case"few_shot":{const{FewShotPromptTemplate:t}=await SC(async()=>{const{FewShotPromptTemplate:r}=await Promise.resolve().then(()=>Vbe);return{FewShotPromptTemplate:r}},void 0,import.meta.url);return t.deserialize(e)}default:throw new Error(`Invalid prompt type in config: ${e._type}`)}}}class Jp extends $m{async formatPromptValue(e){const t=await this.format(e);return new aI(t)}}/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var wbe=Object.prototype.toString,Ad=Array.isArray||function(e){return wbe.call(e)==="[object Array]"};function JP(n){return typeof n=="function"}function Ebe(n){return Ad(n)?"array":typeof n}function TC(n){return n.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function rF(n,e){return n!=null&&typeof n=="object"&&e in n}function Sbe(n,e){return n!=null&&typeof n!="object"&&n.hasOwnProperty&&n.hasOwnProperty(e)}var Tbe=RegExp.prototype.test;function Abe(n,e){return Tbe.call(n,e)}var Cbe=/\S/;function Rbe(n){return!Abe(Cbe,n)}var Ibe={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function Pbe(n){return String(n).replace(/[&<>"'`=\/]/g,function(t){return Ibe[t]})}var xbe=/\s*/,Obe=/\s+/,iF=/\s*=/,Nbe=/\s*\}/,kbe=/#|\^|\/|>|\{|&|=|!/;function Mbe(n,e){if(!n)return[];var t=!1,r=[],i=[],a=[],s=!1,o=!1,u="",c=0;function d(){if(s&&!o)for(;a.length;)delete i[a.pop()];else a=[];s=!1,o=!1}var p,m,y;function b(N){if(typeof N=="string"&&(N=N.split(Obe,2)),!Ad(N)||N.length!==2)throw new Error("Invalid tags: "+N);p=new RegExp(TC(N[0])+"\\s*"),m=new RegExp("\\s*"+TC(N[1])),y=new RegExp("\\s*"+TC("}"+N[1]))}b(e||ji.tags);for(var w=new Lm(n),S,T,C,A,I,x;!w.eos();){if(S=w.pos,C=w.scanUntil(p),C)for(var L=0,U=C.length;L<U;++L)A=C.charAt(L),Rbe(A)?(a.push(i.length),u+=A):(o=!0,t=!0,u+=" "),i.push(["text",A,S,S+1]),S+=1,A===`
`&&(d(),u="",c=0,t=!1);if(!w.scan(p))break;if(s=!0,T=w.scan(kbe)||"name",w.scan(xbe),T==="="?(C=w.scanUntil(iF),w.scan(iF),w.scanUntil(m)):T==="{"?(C=w.scanUntil(y),w.scan(Nbe),w.scanUntil(m),T="&"):C=w.scanUntil(m),!w.scan(m))throw new Error("Unclosed tag at "+w.pos);if(T==">"?I=[T,C,S,w.pos,u,c,t]:I=[T,C,S,w.pos],c++,i.push(I),T==="#"||T==="^")r.push(I);else if(T==="/"){if(x=r.pop(),!x)throw new Error('Unopened section "'+C+'" at '+S);if(x[1]!==C)throw new Error('Unclosed section "'+x[1]+'" at '+S)}else T==="name"||T==="{"||T==="&"?o=!0:T==="="&&b(C)}if(d(),x=r.pop(),x)throw new Error('Unclosed section "'+x[1]+'" at '+w.pos);return $be(Dbe(i))}function Dbe(n){for(var e=[],t,r,i=0,a=n.length;i<a;++i)t=n[i],t&&(t[0]==="text"&&r&&r[0]==="text"?(r[1]+=t[1],r[3]=t[3]):(e.push(t),r=t));return e}function $be(n){for(var e=[],t=e,r=[],i,a,s=0,o=n.length;s<o;++s)switch(i=n[s],i[0]){case"#":case"^":t.push(i),r.push(i),t=i[4]=[];break;case"/":a=r.pop(),a[5]=i[2],t=r.length>0?r[r.length-1][4]:e;break;default:t.push(i)}return e}function Lm(n){this.string=n,this.tail=n,this.pos=0}Lm.prototype.eos=function(){return this.tail===""};Lm.prototype.scan=function(e){var t=this.tail.match(e);if(!t||t.index!==0)return"";var r=t[0];return this.tail=this.tail.substring(r.length),this.pos+=r.length,r};Lm.prototype.scanUntil=function(e){var t=this.tail.search(e),r;switch(t){case-1:r=this.tail,this.tail="";break;case 0:r="";break;default:r=this.tail.substring(0,t),this.tail=this.tail.substring(t)}return this.pos+=r.length,r};function ld(n,e){this.view=n,this.cache={".":this.view},this.parent=e}ld.prototype.push=function(e){return new ld(e,this)};ld.prototype.lookup=function(e){var t=this.cache,r;if(t.hasOwnProperty(e))r=t[e];else{for(var i=this,a,s,o,u=!1;i;){if(e.indexOf(".")>0)for(a=i.view,s=e.split("."),o=0;a!=null&&o<s.length;)o===s.length-1&&(u=rF(a,s[o])||Sbe(a,s[o])),a=a[s[o++]];else a=i.view[e],u=rF(i.view,e);if(u){r=a;break}i=i.parent}t[e]=r}return JP(r)&&(r=r.call(this.view)),r};function gi(){this.templateCache={_cache:{},set:function(e,t){this._cache[e]=t},get:function(e){return this._cache[e]},clear:function(){this._cache={}}}}gi.prototype.clearCache=function(){typeof this.templateCache<"u"&&this.templateCache.clear()};gi.prototype.parse=function(e,t){var r=this.templateCache,i=e+":"+(t||ji.tags).join(":"),a=typeof r<"u",s=a?r.get(i):void 0;return s==null&&(s=Mbe(e,t),a&&r.set(i,s)),s};gi.prototype.render=function(e,t,r,i){var a=this.getConfigTags(i),s=this.parse(e,a),o=t instanceof ld?t:new ld(t,void 0);return this.renderTokens(s,o,r,e,i)};gi.prototype.renderTokens=function(e,t,r,i,a){for(var s="",o,u,c,d=0,p=e.length;d<p;++d)c=void 0,o=e[d],u=o[0],u==="#"?c=this.renderSection(o,t,r,i,a):u==="^"?c=this.renderInverted(o,t,r,i,a):u===">"?c=this.renderPartial(o,t,r,a):u==="&"?c=this.unescapedValue(o,t):u==="name"?c=this.escapedValue(o,t,a):u==="text"&&(c=this.rawValue(o)),c!==void 0&&(s+=c);return s};gi.prototype.renderSection=function(e,t,r,i,a){var s=this,o="",u=t.lookup(e[1]);function c(m){return s.render(m,t,r,a)}if(u){if(Ad(u))for(var d=0,p=u.length;d<p;++d)o+=this.renderTokens(e[4],t.push(u[d]),r,i,a);else if(typeof u=="object"||typeof u=="string"||typeof u=="number")o+=this.renderTokens(e[4],t.push(u),r,i,a);else if(JP(u)){if(typeof i!="string")throw new Error("Cannot use higher-order sections without the original template");u=u.call(t.view,i.slice(e[3],e[5]),c),u!=null&&(o+=u)}else o+=this.renderTokens(e[4],t,r,i,a);return o}};gi.prototype.renderInverted=function(e,t,r,i,a){var s=t.lookup(e[1]);if(!s||Ad(s)&&s.length===0)return this.renderTokens(e[4],t,r,i,a)};gi.prototype.indentPartial=function(e,t,r){for(var i=t.replace(/[^ \t]/g,""),a=e.split(`
`),s=0;s<a.length;s++)a[s].length&&(s>0||!r)&&(a[s]=i+a[s]);return a.join(`
`)};gi.prototype.renderPartial=function(e,t,r,i){if(r){var a=this.getConfigTags(i),s=JP(r)?r(e[1]):r[e[1]];if(s!=null){var o=e[6],u=e[5],c=e[4],d=s;u==0&&c&&(d=this.indentPartial(s,c,o));var p=this.parse(d,a);return this.renderTokens(p,t,r,d,i)}}};gi.prototype.unescapedValue=function(e,t){var r=t.lookup(e[1]);if(r!=null)return r};gi.prototype.escapedValue=function(e,t,r){var i=this.getConfigEscape(r)||ji.escape,a=t.lookup(e[1]);if(a!=null)return typeof a=="number"&&i===ji.escape?String(a):i(a)};gi.prototype.rawValue=function(e){return e[1]};gi.prototype.getConfigTags=function(e){return Ad(e)?e:e&&typeof e=="object"?e.tags:void 0};gi.prototype.getConfigEscape=function(e){if(e&&typeof e=="object"&&!Ad(e))return e.escape};var ji={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(n){Yp.templateCache=n},get templateCache(){return Yp.templateCache}},Yp=new gi;ji.clearCache=function(){return Yp.clearCache()};ji.parse=function(e,t){return Yp.parse(e,t)};ji.render=function(e,t,r,i){if(typeof e!="string")throw new TypeError('Invalid template! Template should be a "string" but "'+Ebe(e)+'" was given as the first argument for mustache#render(template, view, partials)');return Yp.render(e,t,r,i)};ji.escape=Pbe;ji.Scanner=Lm;ji.Context=ld;ji.Writer=gi;function d8(){ji.escape=n=>n}const Zp=n=>{const e=n.split(""),t=[],r=(a,s)=>{for(let o=s;o<e.length;o+=1)if(a.includes(e[o]))return o;return-1};let i=0;for(;i<e.length;)if(e[i]==="{"&&i+1<e.length&&e[i+1]==="{")t.push({type:"literal",text:"{"}),i+=2;else if(e[i]==="}"&&i+1<e.length&&e[i+1]==="}")t.push({type:"literal",text:"}"}),i+=2;else if(e[i]==="{"){const a=r("}",i);if(a<0)throw new Error("Unclosed '{' in template.");t.push({type:"variable",name:e.slice(i+1,a).join("")}),i=a+1}else{if(e[i]==="}")throw new Error("Single '}' in template.");{const a=r("{}",i),s=(a<0?e.slice(i):e.slice(i,a)).join("");t.push({type:"literal",text:s}),i=a<0?e.length:a}}return t},Lbe=n=>n.map(e=>e[0]==="name"?{type:"variable",name:e[1].includes(".")?e[1].split(".")[0]:e[1]}:["#","&","^",">"].includes(e[0])?{type:"variable",name:e[1]}:{type:"literal",text:e[1]}),S_=n=>{d8();const e=ji.parse(n);return Lbe(e)},h8=(n,e)=>Zp(n).reduce((t,r)=>{if(r.type==="variable"){if(r.name in e){const i=typeof e[r.name]=="string"?e[r.name]:JSON.stringify(e[r.name]);return t+i}throw new Error(`(f-string) Missing value for input ${r.name}`)}return t+r.text},""),p8=(n,e)=>(d8(),ji.render(n,e)),T_={"f-string":h8,mustache:p8},m8={"f-string":Zp,mustache:S_},ls=(n,e,t)=>{try{return T_[e](n,t)}catch(r){throw D_(r,"INVALID_PROMPT_INPUT")}},A_=(n,e)=>m8[e](n),Um=(n,e,t)=>{if(!(e in T_)){const r=Object.keys(T_);throw new Error(`Invalid template format. Got \`${e}\`;
                         should be one of ${r}`)}try{const r=t.reduce((i,a)=>(i[a]="foo",i),{});Array.isArray(n)?n.forEach(i=>{if(i.type==="text")ls(i.text,e,r);else if(i.type==="image_url")if(typeof i.image_url=="string")ls(i.image_url,e,r);else{const a=i.image_url.url;ls(a,e,r)}else throw new Error(`Invalid message template received. ${JSON.stringify(i,null,2)}`)}):ls(n,e,r)}catch(r){throw new Error(`Invalid prompt schema: ${r.message}`)}};class xi extends Jp{static lc_name(){return"PromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){if(this.templateFormat==="mustache")throw new Error("Mustache templates cannot be validated.");let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),Um(this.template,this.templateFormat,t)}}_getPromptType(){return"prompt"}async format(e){const t=await this.mergePartialAndUserVariables(e);return ls(this.template,this.templateFormat,t)}static fromExamples(e,t,r,i=`

`,a=""){const s=[a,...e,t].join(i);return new xi({inputVariables:r,template:s})}static fromTemplate(e,t){const{templateFormat:r="f-string",...i}=t??{},a=new Set;return A_(e,r).forEach(s=>{s.type==="variable"&&a.add(s.name)}),new xi({inputVariables:[...a],templateFormat:r,template:e,...i})}async partial(e){const t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},i={...this,inputVariables:t,partialVariables:r};return new xi(i)}serialize(){if(this.outputParser!==void 0)throw new Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(e){if(!e.template)throw new Error("Prompt template must have a template");return new xi({inputVariables:e.input_variables,template:e.template,templateFormat:e.template_format})}}const aF=Object.freeze(Object.defineProperty({__proto__:null,PromptTemplate:xi},Symbol.toStringTag,{value:"Module"}));class Jf extends $m{static lc_name(){return"ImagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","image"]}),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"additionalContentFields",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.template=e.template,this.templateFormat=e.templateFormat??this.templateFormat,this.validateTemplate=e.validateTemplate??this.validateTemplate,this.additionalContentFields=e.additionalContentFields,this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),Um([{type:"image_url",image_url:this.template}],this.templateFormat,t)}}_getPromptType(){return"prompt"}async partial(e){const t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},i={...this,inputVariables:t,partialVariables:r};return new Jf(i)}async format(e){const t={};for(const[s,o]of Object.entries(this.template))typeof o=="string"?t[s]=ls(o,this.templateFormat,e):t[s]=o;const r=e.url||t.url,i=e.detail||t.detail;if(!r)throw new Error("Must provide either an image URL.");if(typeof r!="string")throw new Error("url must be a string.");const a={url:r};return i&&(a.detail=i),a}async formatPromptValue(e){const t=await this.format(e);return new KB(t)}}class vR extends qt{static lc_name(){return"DictPromptTemplate"}constructor(e){const t=e.templateFormat??"f-string",r=_R(e.template,t);super({inputVariables:r,...e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","dict"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.template=e.template,this.templateFormat=t,this.inputVariables=r}async format(e){return bR(this.template,e,this.templateFormat)}async invoke(e){return await this._callWithConfig(this.format.bind(this),e,{runType:"prompt"})}}function _R(n,e){const t=[];for(const r of Object.values(n))if(typeof r=="string")A_(r,e).forEach(i=>{i.type==="variable"&&t.push(i.name)});else if(Array.isArray(r))for(const i of r)typeof i=="string"?A_(i,e).forEach(a=>{a.type==="variable"&&t.push(a.name)}):typeof i=="object"&&t.push(..._R(i,e));else typeof r=="object"&&r!==null&&t.push(..._R(r,e));return Array.from(new Set(t))}function bR(n,e,t){const r={};for(const[i,a]of Object.entries(n))if(typeof a=="string")r[i]=ls(a,t,e);else if(Array.isArray(a)){const s=[];for(const o of a)typeof o=="string"?s.push(ls(o,t,e)):typeof o=="object"&&s.push(bR(o,e,t));r[i]=s}else typeof a=="object"&&a!==null?r[i]=bR(a,e,t):r[i]=a;return r}class Ub extends qt{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(e,t){return this._callWithConfig(r=>this.formatMessages(r),e,{...t,runType:"prompt"})}}class wR extends Ub{static lc_name(){return"MessagesPlaceholder"}constructor(e){typeof e=="string"&&(e={variableName:e}),super(e),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"optional",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=e.variableName,this.optional=e.optional??!1}get inputVariables(){return[this.variableName]}async formatMessages(e){const t=e[this.variableName];if(this.optional&&!t)return[];if(!t){const i=new Error(`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: undefined`);throw i.name="InputFormatError",i}let r;try{Array.isArray(t)?r=t.map(is):r=[is(t)]}catch(i){const a=typeof t=="string"?t:JSON.stringify(t,null,2),s=new Error([`Field "${this.variableName}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages or coerceable values as input.`,`Received value: ${a}`,`Additional message: ${i.message}`].join(`

`));throw s.name="InputFormatError",s.lc_error_code=i.lc_error_code,s}return r}}class g8 extends Ub{constructor(e){"prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(e){return[await this.format(e)]}}class YP extends $m{constructor(e){super(e)}async format(e){return(await this.formatPromptValue(e)).toString()}async formatPromptValue(e){const t=await this.formatMessages(e);return new sI(t)}}class y8 extends g8{static lc_name(){return"ChatMessagePromptTemplate"}constructor(e,t){"prompt"in e||(e={prompt:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}async format(e){return new La(await this.prompt.format(e),this.role)}static fromTemplate(e,t,r){return new this(xi.fromTemplate(e,{templateFormat:r==null?void 0:r.templateFormat}),t)}}function Ube(n){return n===null||typeof n!="object"||Array.isArray(n)?!1:Object.keys(n).length===1&&"text"in n&&typeof n.text=="string"}function jbe(n){return n===null||typeof n!="object"||Array.isArray(n)?!1:"image_url"in n&&(typeof n.image_url=="string"||typeof n.image_url=="object"&&n.image_url!==null&&"url"in n.image_url&&typeof n.image_url.url=="string")}class ZP extends Ub{static _messageClass(){throw new Error("Can not invoke _messageClass from inside _StringImageMessagePromptTemplate")}constructor(e,t){if("prompt"in e||(e={prompt:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"additionalOptions",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatMessageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=e.prompt,Array.isArray(this.prompt)){let r=[];this.prompt.forEach(i=>{"inputVariables"in i&&(r=r.concat(i.inputVariables))}),this.inputVariables=r}else this.inputVariables=this.prompt.inputVariables;this.additionalOptions=t??this.additionalOptions}createMessage(e){const t=this.constructor;if(t._messageClass()){const r=t._messageClass();return new r({content:e})}else if(t.chatMessageClass){const r=t.chatMessageClass();return new r({content:e,role:this.getRoleFromMessageClass(r.lc_name())})}else throw new Error("No message class defined")}getRoleFromMessageClass(e){switch(e){case"HumanMessage":return"human";case"AIMessage":return"ai";case"SystemMessage":return"system";case"ChatMessage":return"chat";default:throw new Error("Invalid message class name")}}static fromTemplate(e,t){if(typeof e=="string")return new this(xi.fromTemplate(e,t));const r=[];for(const i of e)if(typeof i=="string")r.push(xi.fromTemplate(i,t));else if(i!==null)if(Ube(i)){let a="";typeof i.text=="string"&&(a=i.text??"");const s={...t,additionalContentFields:i};r.push(xi.fromTemplate(a,s))}else if(jbe(i)){let a=i.image_url??"",s,o=[];if(typeof a=="string"){let u;(t==null?void 0:t.templateFormat)==="mustache"?u=S_(a):u=Zp(a);const c=u.flatMap(d=>d.type==="variable"?[d.name]:[]);if(((c==null?void 0:c.length)??0)>0){if(c.length>1)throw new Error(`Only one format variable allowed per image template.
Got: ${c}
From: ${a}`);o=[c[0]]}else o=[];a={url:a},s=new Jf({template:a,inputVariables:o,templateFormat:t==null?void 0:t.templateFormat,additionalContentFields:i})}else if(typeof a=="object"){if("url"in a){let u;(t==null?void 0:t.templateFormat)==="mustache"?u=S_(a.url):u=Zp(a.url),o=u.flatMap(c=>c.type==="variable"?[c.name]:[])}else o=[];s=new Jf({template:a,inputVariables:o,templateFormat:t==null?void 0:t.templateFormat,additionalContentFields:i})}else throw new Error("Invalid image template");r.push(s)}else typeof i=="object"&&r.push(new vR({template:i,templateFormat:t==null?void 0:t.templateFormat}));return new this({prompt:r,additionalOptions:t})}async format(e){if(this.prompt instanceof Jp){const t=await this.prompt.format(e);return this.createMessage(t)}else{const t=[];for(const r of this.prompt){let i={};if(!("inputVariables"in r))throw new Error(`Prompt ${r} does not have inputVariables defined.`);for(const a of r.inputVariables)i||(i={[a]:e[a]}),i={...i,[a]:e[a]};if(r instanceof Jp){const a=await r.format(i);let s;"additionalContentFields"in r&&(s=r.additionalContentFields),t.push({...s,type:"text",text:a})}else if(r instanceof Jf){const a=await r.format(i);let s;"additionalContentFields"in r&&(s=r.additionalContentFields),t.push({...s,type:"image_url",image_url:a})}else if(r instanceof vR){const a=await r.format(i);let s;"additionalContentFields"in r&&(s=r.additionalContentFields),t.push({...s,...a})}}return this.createMessage(t)}}async formatMessages(e){return[await this.format(e)]}}class XP extends ZP{static _messageClass(){return ei}static lc_name(){return"HumanMessagePromptTemplate"}}class v8 extends ZP{static _messageClass(){return bn}static lc_name(){return"AIMessagePromptTemplate"}}class _8 extends ZP{static _messageClass(){return fs}static lc_name(){return"SystemMessagePromptTemplate"}}function Fbe(n){return typeof n.formatMessages=="function"}function Bbe(n,e){if(Fbe(n)||Ln(n))return n;if(Array.isArray(n)&&n[0]==="placeholder"){const i=n[1];if((e==null?void 0:e.templateFormat)==="mustache"&&typeof i=="string"&&i.slice(0,2)==="{{"&&i.slice(-2)==="}}"){const a=i.slice(2,-2);return new wR({variableName:a,optional:!0})}else if(typeof i=="string"&&i[0]==="{"&&i[i.length-1]==="}"){const a=i.slice(1,-1);return new wR({variableName:a,optional:!0})}throw new Error(`Invalid placeholder template for format ${(e==null?void 0:e.templateFormat)??'"f-string"'}: "${n[1]}". Expected a variable name surrounded by ${(e==null?void 0:e.templateFormat)==="mustache"?"double":"single"} curly braces.`)}const t=is(n);let r;if(typeof t.content=="string"?r=t.content:r=t.content.map(i=>"text"in i?{...i,text:i.text}:"image_url"in i?{...i,image_url:i.image_url}:i),t._getType()==="human")return XP.fromTemplate(r,e);if(t._getType()==="ai")return v8.fromTemplate(r,e);if(t._getType()==="system")return _8.fromTemplate(r,e);if(La.isInstance(t))return y8.fromTemplate(t.content,t.role,e);throw new Error(`Could not coerce message prompt template from input. Received message type: "${t._getType()}".`)}function qbe(n){return n.constructor.lc_name()==="MessagesPlaceholder"}class Du extends YP{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(e){if(super(e),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),e.templateFormat==="mustache"&&e.validateTemplate===void 0&&(this.validateTemplate=!1),Object.assign(this,e),this.validateTemplate){const t=new Set;for(const o of this.promptMessages)if(!(o instanceof Oa))for(const u of o.inputVariables)t.add(u);const r=this.inputVariables,i=new Set(this.partialVariables?r.concat(Object.keys(this.partialVariables)):r),a=new Set([...i].filter(o=>!t.has(o)));if(a.size>0)throw new Error(`Input variables \`${[...a]}\` are not used in any of the prompt messages.`);const s=new Set([...t].filter(o=>!i.has(o)));if(s.size>0)throw new Error(`Input variables \`${[...s]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(e,t){if(typeof e.content=="string")return e;const r=await Promise.all(e.content.map(async i=>{if(i.type!=="image_url")return i;let a="";typeof i.image_url=="string"?a=i.image_url:a=i.image_url.url;const o=await xi.fromTemplate(a,{templateFormat:this.templateFormat}).format(t);return typeof i.image_url!="string"&&"url"in i.image_url?i.image_url.url=o:i.image_url=o,i}));return e.content=r,e}async formatMessages(e){const t=await this.mergePartialAndUserVariables(e);let r=[];for(const i of this.promptMessages)if(i instanceof Oa)r.push(await this._parseImagePrompts(i,t));else{const a=i.inputVariables.reduce((o,u)=>{if(!(u in t)&&!(qbe(i)&&i.optional))throw D_(new Error(`Missing value for input variable \`${u.toString()}\``),"INVALID_PROMPT_INPUT");return o[u]=t[u],o},{}),s=await i.formatMessages(a);r=r.concat(s)}return r}async partial(e){const t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},i={...this,inputVariables:t,partialVariables:r};return new Du(i)}static fromTemplate(e,t){const r=xi.fromTemplate(e,t),i=new XP({prompt:r});return this.fromMessages([i])}static fromMessages(e,t){const r=e.reduce((s,o)=>s.concat(o instanceof Du?o.promptMessages:[Bbe(o,t)]),[]),i=e.reduce((s,o)=>o instanceof Du?Object.assign(s,o.partialVariables):s,Object.create(null)),a=new Set;for(const s of r)if(!(s instanceof Oa))for(const o of s.inputVariables)o in i||a.add(o);return new this({...t,inputVariables:[...a],promptMessages:r,partialVariables:i,templateFormat:t==null?void 0:t.templateFormat})}static fromPromptMessages(e){return this.fromMessages(e)}}class Xp extends Jp{constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,e),this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),Um(this.prefix+this.suffix,this.templateFormat,t)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(e){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async partial(e){const t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},i={...this,inputVariables:t,partialVariables:r};return new Xp(i)}async format(e){const t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),i=await Promise.all(r.map(s=>this.examplePrompt.format(s))),a=[this.prefix,...i,this.suffix].join(this.exampleSeparator);return ls(a,this.templateFormat,t)}serialize(){if(this.exampleSelector||!this.examples)throw new Error("Serializing an example selector is not currently supported");if(this.outputParser!==void 0)throw new Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(e){const{example_prompt:t}=e;if(!t)throw new Error("Missing example prompt");const r=await xi.deserialize(t);let i;if(Array.isArray(e.examples))i=e.examples;else throw new Error("Invalid examples format. Only list or string are supported.");return new Xp({inputVariables:e.input_variables,examplePrompt:r,examples:i,exampleSeparator:e.example_separator,prefix:e.prefix,suffix:e.suffix,templateFormat:e.template_format})}}class jb extends YP{_getPromptType(){return"few_shot_chat"}static lc_name(){return"FewShotChatMessagePromptTemplate"}constructor(e){if(super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:`

`}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.examples=e.examples,this.examplePrompt=e.examplePrompt,this.exampleSeparator=e.exampleSeparator??`

`,this.exampleSelector=e.exampleSelector,this.prefix=e.prefix??"",this.suffix=e.suffix??"",this.templateFormat=e.templateFormat??"f-string",this.validateTemplate=e.validateTemplate??!0,this.examples!==void 0&&this.exampleSelector!==void 0)throw new Error("Only one of 'examples' and 'example_selector' should be provided");if(this.examples===void 0&&this.exampleSelector===void 0)throw new Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let t=this.inputVariables;this.partialVariables&&(t=t.concat(Object.keys(this.partialVariables))),Um(this.prefix+this.suffix,this.templateFormat,t)}}async getExamples(e){if(this.examples!==void 0)return this.examples;if(this.exampleSelector!==void 0)return this.exampleSelector.selectExamples(e);throw new Error("One of 'examples' and 'example_selector' should be provided")}async formatMessages(e){const t=await this.mergePartialAndUserVariables(e);let r=await this.getExamples(t);r=r.map(a=>{const s={};return this.examplePrompt.inputVariables.forEach(o=>{s[o]=a[o]}),s});const i=[];for(const a of r){const s=await this.examplePrompt.formatMessages(a);i.push(...s)}return i}async format(e){const t=await this.mergePartialAndUserVariables(e),r=await this.getExamples(t),a=(await Promise.all(r.map(o=>this.examplePrompt.formatMessages(o)))).flat().map(o=>o.content),s=[this.prefix,...a,this.suffix].join(this.exampleSeparator);return ls(s,this.templateFormat,t)}async partial(e){const t=this.inputVariables.filter(a=>!(a in e)),r={...this.partialVariables??{},...e},i={...this,inputVariables:t,partialVariables:r};return new jb(i)}}const Vbe=Object.freeze(Object.defineProperty({__proto__:null,FewShotChatMessagePromptTemplate:jb,FewShotPromptTemplate:Xp},Symbol.toStringTag,{value:"Module"}));class Ap extends $m{static lc_name(){return"PipelinePromptTemplate"}constructor(e){super({...e,inputVariables:[]}),Object.defineProperty(this,"pipelinePrompts",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"finalPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.pipelinePrompts=e.pipelinePrompts,this.finalPrompt=e.finalPrompt,this.inputVariables=this.computeInputValues()}computeInputValues(){const e=this.pipelinePrompts.map(r=>r.name),t=this.pipelinePrompts.map(r=>r.prompt.inputVariables.filter(i=>!e.includes(i))).flat();return[...new Set(t)]}static extractRequiredInputValues(e,t){return t.reduce((r,i)=>(r[i]=e[i],r),{})}async formatPipelinePrompts(e){const t=await this.mergePartialAndUserVariables(e);for(const{name:r,prompt:i}of this.pipelinePrompts){const a=Ap.extractRequiredInputValues(t,i.inputVariables);i instanceof Du?t[r]=await i.formatMessages(a):t[r]=await i.format(a)}return Ap.extractRequiredInputValues(t,this.finalPrompt.inputVariables)}async formatPromptValue(e){return this.finalPrompt.formatPromptValue(await this.formatPipelinePrompts(e))}async format(e){return this.finalPrompt.format(await this.formatPipelinePrompts(e))}async partial(e){const t={...this};return t.inputVariables=this.inputVariables.filter(r=>!(r in e)),t.partialVariables={...this.partialVariables??{},...e},new Ap(t)}serialize(){throw new Error("Not implemented.")}_getPromptType(){return"pipeline"}}function sF(n){return typeof n=="object"&&n!=null&&"withStructuredOutput"in n&&typeof n.withStructuredOutput=="function"}function zbe(n){return typeof n=="object"&&n!=null&&"lc_id"in n&&Array.isArray(n.lc_id)&&n.lc_id.join("/")==="langchain_core/runnables/RunnableBinding"}class QP extends Du{get lc_aliases(){return{...super.lc_aliases,schema:"schema_"}}constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"method",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","structured"]}),this.schema=e.schema,this.method=e.method}pipe(e){if(sF(e))return super.pipe(e.withStructuredOutput(this.schema));if(zbe(e)&&sF(e.bound))return super.pipe(new di({bound:e.bound.withStructuredOutput(this.schema,...this.method?[{method:this.method}]:[]),kwargs:e.kwargs??{},config:e.config,configFactories:e.configFactories}));throw new Error('Structured prompts need to be piped to a language model that supports the "withStructuredOutput()" method.')}static fromMessagesAndSchema(e,t,r){return QP.fromMessages(e,{schema:t,method:r})}}const Hbe=Object.freeze(Object.defineProperty({__proto__:null,AIMessagePromptTemplate:v8,BaseChatPromptTemplate:YP,BaseMessagePromptTemplate:Ub,BaseMessageStringPromptTemplate:g8,BasePromptTemplate:$m,BaseStringPromptTemplate:Jp,ChatMessagePromptTemplate:y8,ChatPromptTemplate:Du,DEFAULT_FORMATTER_MAPPING:T_,DEFAULT_PARSER_MAPPING:m8,DictPromptTemplate:vR,FewShotChatMessagePromptTemplate:jb,FewShotPromptTemplate:Xp,HumanMessagePromptTemplate:XP,ImagePromptTemplate:Jf,MessagesPlaceholder:wR,PipelinePromptTemplate:Ap,PromptTemplate:xi,StructuredPrompt:QP,SystemMessagePromptTemplate:_8,checkValidTemplate:Um,interpolateFString:h8,interpolateMustache:p8,parseFString:Zp,parseMustache:S_,parseTemplate:A_,renderTemplate:ls},Symbol.toStringTag,{value:"Module"}));class ex extends qt{constructor(e){super(e),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.callbacks=e==null?void 0:e.callbacks,this.tags=(e==null?void 0:e.tags)??[],this.metadata=(e==null?void 0:e.metadata)??{},this.verbose=(e==null?void 0:e.verbose)??!1}_getRelevantDocuments(e,t){throw new Error("Not implemented!")}async invoke(e,t){return this.getRelevantDocuments(e,Jt(t))}async getRelevantDocuments(e,t){const r=Jt(om(t)),i=await Jn.configure(r.callbacks,this.callbacks,r.tags,this.tags,r.metadata,this.metadata,{verbose:this.verbose}),a=await(i==null?void 0:i.handleRetrieverStart(this.toJSON(),e,r.runId,void 0,void 0,void 0,r.runName));try{const s=await this._getRelevantDocuments(e,a);return await(a==null?void 0:a.handleRetrieverEnd(s)),s}catch(s){throw await(a==null?void 0:a.handleRetrieverError(s)),s}}}const Gbe=Object.freeze(Object.defineProperty({__proto__:null,BaseRetriever:ex},Symbol.toStringTag,{value:"Module"}));let b8=class extends la{};class Wbe extends b8{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","storage"]}),Object.defineProperty(this,"store",{enumerable:!0,configurable:!0,writable:!0,value:{}})}async mget(e){return e.map(t=>this.store[t])}async mset(e){for(const[t,r]of e)this.store[t]=r}async mdelete(e){for(const t of e)delete this.store[t]}async*yieldKeys(e){const t=Object.keys(this.store);for(const r of t)(e===void 0||r.startsWith(e))&&(yield r)}}const Kbe=Object.freeze(Object.defineProperty({__proto__:null,BaseStore:b8,InMemoryStore:Wbe},Symbol.toStringTag,{value:"Module"}));class w8 extends Ys{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"endpoint",{enumerable:!0,configurable:!0,writable:!0,value:Mi("LANGCHAIN_ENDPOINT")||"http://localhost:1984"}),Object.defineProperty(this,"headers",{enumerable:!0,configurable:!0,writable:!0,value:{"Content-Type":"application/json"}}),Object.defineProperty(this,"session",{enumerable:!0,configurable:!0,writable:!0,value:void 0});const e=Mi("LANGCHAIN_API_KEY");e&&(this.headers["x-api-key"]=e)}async newSession(e){const t={start_time:Date.now(),name:e},r=await this.persistSession(t);return this.session=r,r}async loadSession(e){const t=`${this.endpoint}/sessions?name=${e}`;return this._handleSessionResponse(t)}async loadDefaultSession(){const e=`${this.endpoint}/sessions?name=default`;return this._handleSessionResponse(e)}async convertV2RunToRun(e){var a;const t=this.session??await this.loadDefaultSession(),r=e.serialized;let i;if(e.run_type==="llm"){const s=e.inputs.prompts?e.inputs.prompts:e.inputs.messages.map(u=>am(u));i={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,prompts:s,response:e.outputs}}else if(e.run_type==="chain"){const s=await Promise.all(e.child_runs.map(u=>this.convertV2RunToRun(u)));i={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,inputs:e.inputs,outputs:e.outputs,child_llm_runs:s.filter(u=>u.type==="llm"),child_chain_runs:s.filter(u=>u.type==="chain"),child_tool_runs:s.filter(u=>u.type==="tool")}}else if(e.run_type==="tool"){const s=await Promise.all(e.child_runs.map(u=>this.convertV2RunToRun(u)));i={uuid:e.id,start_time:e.start_time,end_time:e.end_time,execution_order:e.execution_order,child_execution_order:e.child_execution_order,serialized:r,type:e.run_type,session_id:t.id,tool_input:e.inputs.input,output:(a=e.outputs)==null?void 0:a.output,action:JSON.stringify(r),child_llm_runs:s.filter(u=>u.type==="llm"),child_chain_runs:s.filter(u=>u.type==="chain"),child_tool_runs:s.filter(u=>u.type==="tool")}}else throw new Error(`Unknown run type: ${e.run_type}`);return i}async persistRun(e){let t,r;e.run_type!==void 0?r=await this.convertV2RunToRun(e):r=e,r.type==="llm"?t=`${this.endpoint}/llm-runs`:r.type==="chain"?t=`${this.endpoint}/chain-runs`:t=`${this.endpoint}/tool-runs`;const i=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(r)});i.ok||console.error(`Failed to persist run: ${i.status} ${i.statusText}`)}async persistSession(e){const t=`${this.endpoint}/sessions`,r=await fetch(t,{method:"POST",headers:this.headers,body:JSON.stringify(e)});return r.ok?{id:(await r.json()).id,...e}:(console.error(`Failed to persist session: ${r.status} ${r.statusText}, using default session.`),{id:1,...e})}async _handleSessionResponse(e){const t=await fetch(e,{method:"GET",headers:this.headers});let r;if(!t.ok)return console.error(`Failed to load session: ${t.status} ${t.statusText}`),r={id:1,start_time:Date.now()},this.session=r,r;const i=await t.json();return i.length===0?(r={id:1,start_time:Date.now()},this.session=r,r):([r]=i,this.session=r,r)}}const Jbe=Object.freeze(Object.defineProperty({__proto__:null,LangChainTracerV1:w8},Symbol.toStringTag,{value:"Module"}));async function Ybe(n){const e=new w8;return n?await e.loadSession(n):await e.loadDefaultSession(),e}async function Zbe(){return new Ol}const Xbe=Object.freeze(Object.defineProperty({__proto__:null,getTracingCallbackHandler:Ybe,getTracingV2CallbackHandler:Zbe},Symbol.toStringTag,{value:"Module"}));class Qbe extends Ys{constructor({exampleId:e}={}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"run_collector"}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracedRuns",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.exampleId=e,this.tracedRuns=[]}async persistRun(e){const t={...e};t.reference_example_id=this.exampleId,this.tracedRuns.push(t)}}const e0e=Object.freeze(Object.defineProperty({__proto__:null,RunCollectorCallbackHandler:Qbe},Symbol.toStringTag,{value:"Module"}));function E8(n,e){let t=0,r=0,i=0;for(let a=0;a<n.length;a++)t+=n[a]*e[a],r+=n[a]*n[a],i+=e[a]*e[a];return t/(Math.sqrt(r)*Math.sqrt(i))}function t0e(n,e){let t=0;for(let r=0;r<n.length;r++)t+=n[r]*e[r];return t}function n0e(n,e){let t=0;for(let r=0;r<n.length;r++)t+=(n[r]-e[r])*(n[r]-e[r]);return t}function r0e(n,e){return Math.sqrt(n0e(n,e))}function Fb(n,e,t){if(n.length===0||n[0].length===0||e.length===0||e[0].length===0)return[[]];if(n[0].length!==e[0].length)throw new Error(`Number of columns in X and Y must be the same. X has shape ${[n.length,n[0].length]} and Y has shape ${[e.length,e[0].length]}.`);return n.map(r=>e.map(i=>t(r,i)).map(i=>Number.isNaN(i)?0:i))}function i0e(n,e=!1){const t=l0e(n);return n.map(r=>r.map(i=>e?1-i/t:i/t))}function ER(n,e){return Fb(n,e,E8)}function a0e(n,e){return Fb(n,e,t0e)}function s0e(n,e){return Fb(n,e,r0e)}function o0e(n,e,t=.5,r=4){if(Math.min(r,e.length)<=0)return[];const i=Array.isArray(n[0])?n:[n],a=ER(i,e)[0],s=S8(a).maxIndex,o=[e[s]],u=[s];for(;u.length<Math.min(r,e.length);){let c=-1/0,d=-1;const p=ER(e,o);a.forEach((m,y)=>{if(u.includes(y))return;const b=Math.max(...p[y]),w=t*m-(1-t)*b;w>c&&(c=w,d=y)}),o.push(e[d]),u.push(d)}return u}function S8(n){if(n.length===0)return{maxIndex:-1,maxValue:NaN};let e=n[0],t=0;for(let r=1;r<n.length;r+=1)n[r]>e&&(t=r,e=n[r]);return{maxIndex:t,maxValue:e}}function l0e(n){return n.reduce((e,t)=>Math.max(e,S8(t).maxValue),0)}const u0e=Object.freeze(Object.defineProperty({__proto__:null,cosineSimilarity:ER,euclideanDistance:s0e,innerProduct:a0e,matrixFunc:Fb,maximalMarginalRelevance:o0e,normalize:i0e},Symbol.toStringTag,{value:"Module"}));class vv extends ex{static lc_name(){return"VectorStoreRetriever"}get lc_namespace(){return["langchain_core","vectorstores"]}_vectorstoreType(){return this.vectorStore._vectorstoreType()}constructor(e){super(e),Object.defineProperty(this,"vectorStore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"searchType",{enumerable:!0,configurable:!0,writable:!0,value:"similarity"}),Object.defineProperty(this,"searchKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"filter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorStore=e.vectorStore,this.k=e.k??this.k,this.searchType=e.searchType??this.searchType,this.filter=e.filter,e.searchType==="mmr"&&(this.searchKwargs=e.searchKwargs)}async _getRelevantDocuments(e,t){if(this.searchType==="mmr"){if(typeof this.vectorStore.maxMarginalRelevanceSearch!="function")throw new Error(`The vector store backing this retriever, ${this._vectorstoreType()} does not support max marginal relevance search.`);return this.vectorStore.maxMarginalRelevanceSearch(e,{k:this.k,filter:this.filter,...this.searchKwargs},t==null?void 0:t.getChild("vectorstore"))}return this.vectorStore.similaritySearch(e,this.k,this.filter,t==null?void 0:t.getChild("vectorstore"))}async addDocuments(e,t){return this.vectorStore.addDocuments(e,t)}}class tx extends la{constructor(e,t){super(t),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","vectorstores",this._vectorstoreType()]}),Object.defineProperty(this,"embeddings",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.embeddings=e}async delete(e){throw new Error("Not implemented.")}async similaritySearch(e,t=4,r=void 0,i=void 0){return(await this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)).map(s=>s[0])}async similaritySearchWithScore(e,t=4,r=void 0,i=void 0){return this.similaritySearchVectorWithScore(await this.embeddings.embedQuery(e),t,r)}static fromTexts(e,t,r,i){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}static fromDocuments(e,t,r){throw new Error("the Langchain vectorstore implementation you are using forgot to override this, please report a bug")}asRetriever(e,t,r,i,a,s){if(typeof e=="number")return new vv({vectorStore:this,k:e,filter:t,tags:[...i??[],this._vectorstoreType()],metadata:a,verbose:s,callbacks:r});{const o={vectorStore:this,k:e==null?void 0:e.k,filter:e==null?void 0:e.filter,tags:[...(e==null?void 0:e.tags)??[],this._vectorstoreType()],metadata:e==null?void 0:e.metadata,verbose:e==null?void 0:e.verbose,callbacks:e==null?void 0:e.callbacks,searchType:e==null?void 0:e.searchType};return(e==null?void 0:e.searchType)==="mmr"?new vv({...o,searchKwargs:e.searchKwargs}):new vv({...o})}}}class c0e extends tx{static load(e,t){throw new Error("Not implemented")}}const f0e=Object.freeze(Object.defineProperty({__proto__:null,SaveableVectorStore:c0e,VectorStore:tx,VectorStoreRetriever:vv},Symbol.toStringTag,{value:"Module"}));class d0e extends bm{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["tests","fake"]})}getFormatInstructions(){return""}async parse(e){return e.split(",").map(t=>t.trim())}}class h0e extends qt{constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["tests","fake"]}),Object.defineProperty(this,"returnOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.returnOptions=e.returnOptions}async invoke(e,t){return this.returnOptions?t??{}:{input:e}}}class p0e extends nP{constructor(e){super(e),Object.defineProperty(this,"response",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"thrownErrorString",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.response=e.response,this.thrownErrorString=e.thrownErrorString}_llmType(){return"fake"}async _call(e,t,r){if(this.thrownErrorString)throw new Error(this.thrownErrorString);const i=this.response??e;return await(r==null?void 0:r.handleLLMNewToken(i)),i}}class m0e extends nP{constructor(e){super(e),Object.defineProperty(this,"sleep",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"responses",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"thrownErrorString",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.sleep=e.sleep??this.sleep,this.responses=e.responses,this.thrownErrorString=e.thrownErrorString}_llmType(){return"fake"}async _call(e){var r,i;if(this.thrownErrorString)throw new Error(this.thrownErrorString);const t=(r=this.responses)==null?void 0:r[0];return this.responses=(i=this.responses)==null?void 0:i.slice(1),t??e}async*_streamResponseChunks(e,t,r){var a,s;if(this.thrownErrorString)throw new Error(this.thrownErrorString);const i=(a=this.responses)==null?void 0:a[0];this.responses=(s=this.responses)==null?void 0:s.slice(1);for(const o of i??e)await new Promise(u=>setTimeout(u,this.sleep)),yield{text:o,generationInfo:{}},await(r==null?void 0:r.handleLLMNewToken(o))}}class g0e extends ui{_combineLLMOutput(){return[]}_llmType(){return"fake"}async _generate(e,t,r){var a;if((a=t==null?void 0:t.stop)!=null&&a.length)return{generations:[{message:new bn(t.stop[0]),text:t.stop[0]}]};const i=e.map(s=>typeof s.content=="string"?s.content:JSON.stringify(s.content,null,2)).join(`
`);return await(r==null?void 0:r.handleLLMNewToken(i)),{generations:[{message:new bn(i),text:i}],llmOutput:{}}}}class nx extends ui{constructor({sleep:e=50,responses:t=[],chunks:r=[],toolStyle:i="openai",thrownErrorString:a,...s}){super(s),Object.defineProperty(this,"sleep",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"responses",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"toolStyle",{enumerable:!0,configurable:!0,writable:!0,value:"openai"}),Object.defineProperty(this,"thrownErrorString",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.sleep=e,this.responses=t,this.chunks=r,this.toolStyle=i,this.thrownErrorString=a}_llmType(){return"fake"}bindTools(e){const t=[...this.tools,...e],r=t.map(s=>{switch(this.toolStyle){case"openai":return{type:"function",function:{name:s.name,description:s.description,parameters:yr(s.schema)}};case"anthropic":return{name:s.name,description:s.description,input_schema:yr(s.schema)};case"bedrock":return{toolSpec:{name:s.name,description:s.description,inputSchema:yr(s.schema)}};case"google":return{name:s.name,description:s.description,parameters:yr(s.schema)};default:throw new Error(`Unsupported tool style: ${this.toolStyle}`)}}),i=this.toolStyle==="google"?[{functionDeclarations:r}]:r,a=new nx({sleep:this.sleep,responses:this.responses,chunks:this.chunks,toolStyle:this.toolStyle,thrownErrorString:this.thrownErrorString});return a.tools=t,a.withConfig({tools:i})}async _generate(e,t,r){var s,o,u,c;if(this.thrownErrorString)throw new Error(this.thrownErrorString);const i=((o=(s=this.responses)==null?void 0:s[0])==null?void 0:o.content)??e[0].content??"";return{generations:[{text:"",message:new bn({content:i,tool_calls:(c=(u=this.chunks)==null?void 0:u[0])==null?void 0:c.tool_calls})}]}}async*_streamResponseChunks(e,t,r){var s,o,u;if(this.thrownErrorString)throw new Error(this.thrownErrorString);if((s=this.chunks)!=null&&s.length){for(const c of this.chunks){const d=new ca({message:new Sn({content:c.content,tool_calls:c.tool_calls,additional_kwargs:c.additional_kwargs??{}}),text:((o=c.content)==null?void 0:o.toString())??""});yield d,await(r==null?void 0:r.handleLLMNewToken(c.content,void 0,void 0,void 0,void 0,{chunk:d}))}return}const i=((u=this.responses)==null?void 0:u[0])??new bn(typeof e[0].content=="string"?e[0].content:""),a=typeof i.content=="string"?i.content:"";for(const c of a){await new Promise(p=>setTimeout(p,this.sleep));const d=new ca({message:new Sn({content:c}),text:c});yield d,await(r==null?void 0:r.handleLLMNewToken(c,void 0,void 0,void 0,void 0,{chunk:d}))}}}class y0e extends ex{constructor(e){super(),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["test","fake"]}),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:[new Mu({pageContent:"foo"}),new Mu({pageContent:"bar"})]}),this.output=(e==null?void 0:e.output)??this.output}async _getRelevantDocuments(e){return this.output}}class v0e extends ui{static lc_name(){return"FakeListChatModel"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"responses",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"i",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"sleep",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"emitCustomEvent",{enumerable:!0,configurable:!0,writable:!0,value:!1});const{responses:t,sleep:r,emitCustomEvent:i}=e;this.responses=t,this.sleep=r,this.emitCustomEvent=i??this.emitCustomEvent}_combineLLMOutput(){return[]}_llmType(){return"fake-list"}async _generate(e,t,r){var i;if(await this._sleepIfRequested(),t!=null&&t.thrownErrorString)throw new Error(t.thrownErrorString);if(this.emitCustomEvent&&await(r==null?void 0:r.handleCustomEvent("some_test_event",{someval:!0})),(i=t==null?void 0:t.stop)!=null&&i.length)return{generations:[this._formatGeneration(t.stop[0])]};{const a=this._currentResponse();return this._incrementResponse(),{generations:[this._formatGeneration(a)],llmOutput:{}}}}_formatGeneration(e){return{message:new bn(e),text:e}}async*_streamResponseChunks(e,t,r){const i=this._currentResponse();this._incrementResponse(),this.emitCustomEvent&&await(r==null?void 0:r.handleCustomEvent("some_test_event",{someval:!0}));for await(const a of i){if(await this._sleepIfRequested(),t!=null&&t.thrownErrorString)throw new Error(t.thrownErrorString);yield this._createResponseChunk(a),r==null||r.handleLLMNewToken(a)}}async _sleepIfRequested(){this.sleep!==void 0&&await this._sleep()}async _sleep(){return new Promise(e=>{setTimeout(()=>e(),this.sleep)})}_createResponseChunk(e){return new ca({message:new Sn({content:e}),text:e})}_currentResponse(){return this.responses[this.i]}_incrementResponse(){this.i<this.responses.length-1?this.i+=1:this.i=0}withStructuredOutput(e,t){return _r.from(async r=>{var a,s;const i=await this.invoke(r);if((s=(a=i.tool_calls)==null?void 0:a[0])!=null&&s.args)return i.tool_calls[0].args;if(typeof i.content=="string")return JSON.parse(i.content);throw new Error("No structured output found")})}}class _0e extends l8{constructor(){super(),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","message","fake"]}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:[]})}async getMessages(){return this.messages}async addMessage(e){this.messages.push(e)}async addUserMessage(e){this.messages.push(new ei(e))}async addAIChatMessage(e){this.messages.push(new bn(e))}async clear(){this.messages=[]}}class b0e extends HP{constructor(){super(),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","message","fake"]}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:[]})}async addMessage(e){this.messages.push(e)}async getMessages(){return this.messages}}class w0e extends Ys{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"fake_tracer"}),Object.defineProperty(this,"runs",{enumerable:!0,configurable:!0,writable:!0,value:[]})}persistRun(e){return this.runs.push(e),Promise.resolve()}}class E0e extends Z_{constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.schema=e.schema}async _call(e,t){return JSON.stringify(e)}}class S0e extends rP{constructor(e){super(e??{})}embedDocuments(e){return Promise.resolve(e.map(()=>[.1,.2,.3,.4]))}embedQuery(e){return Promise.resolve([.1,.2,.3,.4])}}class T0e extends rP{constructor(e){super(e??{}),Object.defineProperty(this,"vectorSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.vectorSize=(e==null?void 0:e.vectorSize)??4}async embedDocuments(e){return Promise.all(e.map(t=>this.embedQuery(t)))}async embedQuery(e){let t=e;t=t.toLowerCase().replaceAll(/[^a-z ]/g,"");const r=t.length%this.vectorSize,i=r===0?0:this.vectorSize-r,a=t.length+i;t=t.padEnd(a," ");const s=t.length/this.vectorSize,o=[];for(let c=0;c<t.length;c+=s)o.push(t.slice(c,c+s));return o.map(c=>{let d=0;for(let m=0;m<c.length;m+=1)d+=c===" "?0:c.charCodeAt(m);return d%26/26})}}class A0e extends Ys{constructor(){super(),Object.defineProperty(this,"runPromiseResolver",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runPromise",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"single_run_extractor"}),this.runPromise=new Promise(e=>{this.runPromiseResolver=e})}async persistRun(e){this.runPromiseResolver(e)}async extract(){return this.runPromise}}class rx extends tx{_vectorstoreType(){return"memory"}constructor(e,{similarity:t,...r}={}){super(e,r),Object.defineProperty(this,"memoryVectors",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"similarity",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.similarity=t??E8}async addDocuments(e){const t=e.map(({pageContent:r})=>r);return this.addVectors(await this.embeddings.embedDocuments(t),e)}async addVectors(e,t){const r=e.map((i,a)=>({content:t[a].pageContent,embedding:i,metadata:t[a].metadata}));this.memoryVectors=this.memoryVectors.concat(r)}async similaritySearchVectorWithScore(e,t,r){const i=u=>{if(!r)return!0;const c=new Mu({metadata:u.metadata,pageContent:u.content});return r(c)},a=this.memoryVectors.filter(i);return a.map((u,c)=>({similarity:this.similarity(e,u.embedding),index:c})).sort((u,c)=>u.similarity>c.similarity?-1:0).slice(0,t).map(u=>[new Mu({metadata:a[u.index].metadata,pageContent:a[u.index].content}),u.similarity])}static async fromTexts(e,t,r,i){const a=[];for(let s=0;s<e.length;s+=1){const o=Array.isArray(t)?t[s]:t,u=new Mu({pageContent:e[s],metadata:o});a.push(u)}return rx.fromDocuments(a,r,i)}static async fromDocuments(e,t,r){const i=new this(t,r);return await i.addDocuments(e),i}static async fromExistingIndex(e,t){return new this(e,t)}}const C0e=Object.freeze(Object.defineProperty({__proto__:null,FakeChatMessageHistory:_0e,FakeChatModel:g0e,FakeEmbeddings:S0e,FakeLLM:p0e,FakeListChatMessageHistory:b0e,FakeListChatModel:v0e,FakeRetriever:y0e,FakeRunnable:h0e,FakeSplitIntoListParser:d0e,FakeStreamingChatModel:nx,FakeStreamingLLM:m0e,FakeTool:E0e,FakeTracer:w0e,FakeVectorStore:rx,SingleRunExtractor:A0e,SyntheticEmbeddings:T0e},Symbol.toStringTag,{value:"Module"})),R0e=Object.freeze(Object.defineProperty({__proto__:null,agents:abe,caches:dY,callbacks__base:hW,callbacks__manager:NW,callbacks__promises:CW,chat_history:obe,documents:ube,embeddings:jre,example_selectors:hbe,language_models__base:PY,language_models__chat_models:hne,language_models__llms:$re,load__serializable:PH,memory:vbe,messages:tY,output_parsers:xne,outputs:FW,prompt_values:hY,prompts:Hbe,retrievers:Gbe,runnables:yne,stores:Kbe,tools:MY,tracers__base:yW,tracers__console:bW,tracers__initialize:Xbe,tracers__log_stream:jW,tracers__run_collector:e0e,tracers__tracer_langchain:wW,tracers__tracer_langchain_v1:Jbe,utils__async_caller:HW,utils__chunk_array:Ure,utils__env:fW,utils__function_calling:Sre,utils__hash:lY,utils__json_patch:Ane,utils__json_schema:qJ,utils__math:u0e,utils__stream:LW,utils__testing:C0e,utils__tiktoken:AY,utils__types:wre,vectorstores:f0e},Symbol.toStringTag,{value:"Module"}));function I0e(n){const e={};for(let t=n;t&&t.prototype;t=Object.getPrototypeOf(t))Object.assign(e,Reflect.get(t.prototype,"lc_aliases"));return Object.entries(e).reduce((t,[r,i])=>(t[i]=r,t),{})}async function _v(n){const{optionalImportsMap:e={},optionalImportEntrypoints:t=[],importMap:r={},secretsMap:i={},path:a=["$"]}=this,s=a.join(".");if(typeof n=="object"&&n!==null&&!Array.isArray(n)&&"lc"in n&&"type"in n&&"id"in n&&n.lc===1&&n.type==="secret"){const o=n,[u]=o.id;if(u in i)return i[u];{const c=Mi(u);if(c)return c;throw new Error(`Missing key "${u}" for ${s} in load(secretsMap={})`)}}else if(typeof n=="object"&&n!==null&&!Array.isArray(n)&&"lc"in n&&"type"in n&&"id"in n&&n.lc===1&&n.type==="not_implemented"){const u=JSON.stringify(n);throw new Error(`Trying to load an object that doesn't implement serialization: ${s} -> ${u}`)}else if(typeof n=="object"&&n!==null&&!Array.isArray(n)&&"lc"in n&&"type"in n&&"id"in n&&"kwargs"in n&&n.lc===1){const o=n,u=JSON.stringify(o),[c,...d]=o.id.slice().reverse(),p=d.reverse(),m={langchain_core:R0e,langchain:r};let y=null;const b=[p.join("/")];p[0]==="langchain_community"&&b.push(["langchain",...p.slice(1)].join("/"));const w=b.find(C=>C in e);if(ibe.concat(t).includes(p.join("/"))||w)if(w!==void 0)y=await e[w];else throw new Error(`Missing key "${p.join("/")}" for ${s} in load(optionalImportsMap={})`);else{let C;if(p[0]==="langchain"||p[0]==="langchain_core")C=m[p[0]],p.shift();else throw new Error(`Invalid namespace: ${s} -> ${u}`);if(p.length===0)throw new Error(`Invalid namespace: ${s} -> ${u}`);let A;do{if(A=p.join("__"),A in C)break;p.pop()}while(p.length>0);A in C&&(y=C[A])}if(typeof y!="object"||y===null)throw new Error(`Invalid namespace: ${s} -> ${u}`);const S=y[c]??Object.values(y).find(C=>typeof C=="function"&&k_(C)===c);if(typeof S!="function")throw new Error(`Invalid identifer: ${s} -> ${u}`);const T=await _v.call({...this,path:[...a,"kwargs"]},o.kwargs);if(o.type==="constructor"){const C=new S(DF(T,RH,I0e(S)));return Object.defineProperty(C.constructor,"name",{value:c}),C}else throw new Error(`Invalid type: ${s} -> ${u}`)}else if(typeof n=="object"&&n!==null)return Array.isArray(n)?Promise.all(n.map((o,u)=>_v.call({...this,path:[...a,`${u}`]},o))):Object.fromEntries(await Promise.all(Object.entries(n).map(async([o,u])=>[o,await _v.call({...this,path:[...a,o]},u)])));return n}async function P0e(n,e){const t=JSON.parse(n);return _v.call({...e},t)}var oF="[...]",x0e="[Circular]",C_=[],Mf=[];function O0e(){return{depthLimit:Number.MAX_SAFE_INTEGER,edgesLimit:Number.MAX_SAFE_INTEGER}}function N0e(n,e,t,r){typeof r>"u"&&(r=O0e()),SR(n,"",0,[],void 0,0,r);var i;try{Mf.length===0?i=JSON.stringify(n,e,t):i=JSON.stringify(n,k0e(e),t)}catch{return JSON.stringify("[unable to serialize, circular reference is too complex to analyze]")}finally{for(;C_.length!==0;){var a=C_.pop();a.length===4?Object.defineProperty(a[0],a[1],a[3]):a[0][a[1]]=a[2]}}return i}function AC(n,e,t,r){var i=Object.getOwnPropertyDescriptor(r,t);i.get!==void 0?i.configurable?(Object.defineProperty(r,t,{value:n}),C_.push([r,t,e,i])):Mf.push([e,t,n]):(r[t]=n,C_.push([r,t,e]))}function SR(n,e,t,r,i,a,s){a+=1;var o;if(typeof n=="object"&&n!==null){for(o=0;o<r.length;o++)if(r[o]===n){AC(x0e,n,e,i);return}if(typeof s.depthLimit<"u"&&a>s.depthLimit){AC(oF,n,e,i);return}if(typeof s.edgesLimit<"u"&&t+1>s.edgesLimit){AC(oF,n,e,i);return}if(r.push(n),Array.isArray(n))for(o=0;o<n.length;o++)SR(n[o],o,o,r,n,a,s);else{var u=Object.keys(n);for(o=0;o<u.length;o++){var c=u[o];SR(n[c],c,o,r,n,a,s)}}r.pop()}}function k0e(n){return n=typeof n<"u"?n:function(e,t){return t},function(e,t){if(Mf.length>0)for(var r=0;r<Mf.length;r++){var i=Mf[r];if(i[1]===e&&i[0]===t){t=i[2],Mf.splice(r,1);break}}return n.call(this,e,t)}}function M0e(n){return n!==null&&n.lc===1&&n.type==="constructor"&&Array.isArray(n.id)}async function TR(n){if(n&&typeof n=="object"){if(Array.isArray(n))return await Promise.all(n.map(t=>TR(t)));{const e={};for(const[t,r]of Object.entries(n))e[t]=await TR(r);if(e.lc===2&&e.type==="undefined")return;if(e.lc===2&&e.type==="constructor"&&Array.isArray(e.id))try{const t=e.id[e.id.length-1];let r;switch(t){case"Set":r=Set;break;case"Map":r=Map;break;case"RegExp":r=RegExp;break;case"Error":r=Error;break;default:return e}return e.method?r[e.method](...e.args||[]):new r(...e.args||[])}catch{return e}else if(M0e(e))return P0e(JSON.stringify(e));return e}}return n}function CC(n,e,t,r){return{lc:2,type:"constructor",id:[n.name],method:e??null,args:t??[],kwargs:r??{}}}function D0e(n){return n===void 0?{lc:2,type:"undefined"}:n instanceof Set||n instanceof Map?CC(n.constructor,void 0,[Array.from(n)]):n instanceof RegExp?CC(RegExp,void 0,[n.source,n.flags]):n instanceof Error?CC(n.constructor,void 0,[n.message]):(n==null?void 0:n.lg_name)==="Send"?{node:n.node,args:n.args}:n}class $0e{_dumps(e){return new TextEncoder().encode(N0e(e,(r,i)=>D0e(i)))}dumpsTyped(e){return e instanceof Uint8Array?["bytes",e]:["json",this._dumps(e)]}async _loads(e){const t=JSON.parse(e);return TR(t)}async loadsTyped(e,t){if(e==="bytes")return typeof t=="string"?new TextEncoder().encode(t):t;if(e==="json")return this._loads(typeof t=="string"?t:new TextDecoder().decode(t));throw new Error(`Unknown serialization type: ${e}`)}}function ix(n){if(typeof n!="object"||n===null)return n;const e=Array.isArray(n)?[]:{};for(const t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=ix(n[t]));return e}function T8(){return{v:1,id:o8(-2),ts:new Date().toISOString(),channel_values:{},channel_versions:{},versions_seen:{},pending_sends:[]}}function R_(n){return{v:n.v,id:n.id,ts:n.ts,channel_values:{...n.channel_values},channel_versions:{...n.channel_versions},versions_seen:ix(n.versions_seen),pending_sends:[...n.pending_sends]}}function A8(n,e){return typeof n=="number"&&typeof e=="number"?Math.sign(n-e):String(n).localeCompare(String(e))}function lF(...n){return n.reduce((e,t,r)=>r===0?t:A8(e,t)>=0?e:t)}const uF={[tbe]:-1,[yv]:-2,[nbe]:-3,[rbe]:-4};class Bh extends Error{constructor(e){super(e),this.name="InvalidNamespaceError"}}function L0e(n){if(n.length===0)throw new Bh("Namespace cannot be empty.");for(const e of n){if(typeof e!="string")throw new Bh(`Invalid namespace label '${e}' found in ${n}. Namespace labels must be strings, but got ${typeof e}.`);if(e.includes("."))throw new Bh(`Invalid namespace label '${e}' found in ${n}. Namespace labels cannot contain periods ('.').`);if(e==="")throw new Bh(`Namespace labels cannot be empty strings. Got ${e} in ${n}`)}if(n[0]==="langgraph")throw new Bh(`Root label for namespace cannot be "langgraph". Got: ${n}`)}class U0e{async get(e,t){return(await this.batch([{namespace:e,key:t}]))[0]}async search(e,t={}){const{filter:r,limit:i=10,offset:a=0,query:s}=t;return(await this.batch([{namespacePrefix:e,filter:r,limit:i,offset:a,query:s}]))[0]}async put(e,t,r,i){L0e(e),await this.batch([{namespace:e,key:t,value:r,index:i}])}async delete(e,t){await this.batch([{namespace:e,key:t,value:null}])}async listNamespaces(e={}){const{prefix:t,suffix:r,maxDepth:i,limit:a=100,offset:s=0}=e,o=[];return t&&o.push({matchType:"prefix",path:t}),r&&o.push({matchType:"suffix",path:r}),(await this.batch([{matchConditions:o.length?o:void 0,maxDepth:i,limit:a,offset:s}]))[0]}start(){}stop(){}}const j0e=n=>"lg_name"in n&&n.lg_name==="AsyncBatchedStore"?n.store:n;class F0e extends U0e{constructor(e){super(),Object.defineProperty(this,"lg_name",{enumerable:!0,configurable:!0,writable:!0,value:"AsyncBatchedStore"}),Object.defineProperty(this,"store",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"nextKey",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"running",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"processingTask",{enumerable:!0,configurable:!0,writable:!0,value:null}),this.store=j0e(e)}get isRunning(){return this.running}async batch(e){throw new Error("The `batch` method is not implemented on `AsyncBatchedStore`.\n Instead, it calls the `batch` method on the wrapped store.\n If you are seeing this error, something is wrong.")}async get(e,t){return this.enqueueOperation({namespace:e,key:t})}async search(e,t){const{filter:r,limit:i=10,offset:a=0,query:s}=t||{};return this.enqueueOperation({namespacePrefix:e,filter:r,limit:i,offset:a,query:s})}async put(e,t,r){return this.enqueueOperation({namespace:e,key:t,value:r})}async delete(e,t){return this.enqueueOperation({namespace:e,key:t,value:null})}start(){this.running||(this.running=!0,this.processingTask=this.processBatchQueue())}async stop(){this.running=!1,this.processingTask&&await this.processingTask}enqueueOperation(e){return new Promise((t,r)=>{const i=this.nextKey;this.nextKey+=1,this.queue.set(i,{operation:e,resolve:t,reject:r})})}async processBatchQueue(){for(;this.running;){if(await new Promise(t=>{setTimeout(t,0)}),this.queue.size===0)continue;const e=new Map(this.queue);this.queue.clear();try{const t=Array.from(e.values()).map(({operation:i})=>i),r=await this.store.batch(t);e.forEach(({resolve:i},a)=>{const s=Array.from(e.keys()).indexOf(a);i(r[s])})}catch(t){e.forEach(({reject:r})=>{r(t)})}}}toJSON(){return{queue:this.queue,nextKey:this.nextKey,running:this.running,store:"[LangGraphStore]"}}}class B0e{constructor(e){Object.defineProperty(this,"serde",{enumerable:!0,configurable:!0,writable:!0,value:new $0e}),this.serde=e||this.serde}}class gc extends Error{constructor(e,t){let r=e??"";t!=null&&t.lc_error_code&&(r=`${r}

Troubleshooting URL: https://langchain-ai.github.io/langgraphjs/troubleshooting/errors/${t.lc_error_code}/
`),super(r),Object.defineProperty(this,"lc_error_code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_error_code=t==null?void 0:t.lc_error_code}}class C8 extends gc{get is_bubble_up(){return!0}}class q0e extends gc{constructor(e,t){super(e,t),this.name="GraphRecursionError"}static get unminifiable_name(){return"GraphRecursionError"}}class cF extends gc{constructor(e,t){super(e,t),this.name="GraphValueError"}static get unminifiable_name(){return"GraphValueError"}}class Cp extends C8{constructor(e,t){super(JSON.stringify(e,null,2),t),Object.defineProperty(this,"interrupts",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="GraphInterrupt",this.interrupts=e??[]}static get unminifiable_name(){return"GraphInterrupt"}}class R8 extends Cp{constructor(e,t){super([{value:e,when:"during"}],t),this.name="NodeInterrupt"}static get unminifiable_name(){return"NodeInterrupt"}}class I8 extends C8{constructor(e){super(),Object.defineProperty(this,"command",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name="ParentCommand",this.command=e}static get unminifiable_name(){return"ParentCommand"}}function V0e(n){return n!==void 0&&n.name===I8.unminifiable_name}function bv(n){return n!==void 0&&n.is_bubble_up===!0}function Df(n){return n!==void 0&&[Cp.unminifiable_name,R8.unminifiable_name].includes(n.name)}class fF extends gc{constructor(e,t){super(e,t),this.name="EmptyInputError"}static get unminifiable_name(){return"EmptyInputError"}}class zr extends gc{constructor(e,t){super(e,t),this.name="EmptyChannelError"}static get unminifiable_name(){return"EmptyChannelError"}}class $n extends gc{constructor(e,t){super(e,t),this.name="InvalidUpdateError"}static get unminifiable_name(){return"InvalidUpdateError"}}class z0e extends gc{constructor(e,t){super(e,t),this.name="UnreachableNodeError"}static get unminifiable_name(){return"UnreachableNodeError"}}function Bb(n){return n!=null&&n.lg_is_channel===!0}class Cd{constructor(){Object.defineProperty(this,"ValueType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"UpdateType",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lg_is_channel",{enumerable:!0,configurable:!0,writable:!0,value:!0})}consume(){return!1}finish(){return!1}isAvailable(){try{return this.get(),!0}catch(e){if(e.name===zr.unminifiable_name)return!1;throw e}}}function I_(n,e){const t=Object.fromEntries(Object.entries(n).filter(([,i])=>Bb(i))),r={};for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){const a=e.channel_values[i];r[i]=t[i].fromCheckpoint(a)}return r}function wu(n,e,t){let r;if(e===void 0)r=n.channel_values;else{r={};for(const i of Object.keys(e))try{r[i]=e[i].checkpoint()}catch(a){if(a.name!==zr.unminifiable_name)throw a}}return{v:1,id:o8(t),ts:new Date().toISOString(),channel_values:r,channel_versions:{...n.channel_versions},versions_seen:ix(n.versions_seen),pending_sends:n.pending_sends??[]}}const H0e=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;function AR(n){return typeof n=="string"&&H0e.test(n)}var jr=[];for(var RC=0;RC<256;++RC)jr.push((RC+256).toString(16).slice(1));function G0e(n,e=0){return(jr[n[e+0]]+jr[n[e+1]]+jr[n[e+2]]+jr[n[e+3]]+"-"+jr[n[e+4]]+jr[n[e+5]]+"-"+jr[n[e+6]]+jr[n[e+7]]+"-"+jr[n[e+8]]+jr[n[e+9]]+"-"+jr[n[e+10]]+jr[n[e+11]]+jr[n[e+12]]+jr[n[e+13]]+jr[n[e+14]]+jr[n[e+15]]).toLowerCase()}var Fy,W0e=new Uint8Array(16);function K0e(){if(!Fy&&(Fy=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Fy))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Fy(W0e)}var J0e=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);const dF={randomUUID:J0e};function hF(n,e,t){if(dF.randomUUID&&!n)return dF.randomUUID();n=n||{};var r=n.random||(n.rng||K0e)();return r[6]=r[6]&15|64,r[8]=r[8]&63|128,G0e(r)}const kn="__start__",kt="__end__",To="__input__",Y0e="__copy__",Oi="__error__",IC="__pregel_ns_writes",Yf="__pregel_send",ax="__pregel_call",$u="__pregel_read",mr="__pregel_checkpointer",Sl="__pregel_resuming",Rp="__pregel_task_id",P_="__pregel_stream",Z0e="__pregel_resume_value",Lu="__pregel_scratchpad",wv="__pregel_previous",X0e="checkpoint_id",CR="checkpoint_ns",Q0e="__pregel_node_finished",Ca="checkpoint_map",pF="__pregel_abort_signals",Tn="__interrupt__",Ma="__resume__",sx="__no_writes__",ud="__return__",PC="__previous__",uf="__pregel_runtime_placeholder__",rr="langsmith:hidden",ewe="langsmith:nostream",mF="__self__",cd="__pregel_tasks",Ra="__pregel_push",Ev="__pregel_pull",Ia="00000000-0000-0000-0000-000000000000",twe=[rr,To,Tn,Ma,Oi,sx,cd,Yf,$u,mr,P_,Sl,Rp,ax,Z0e,Lu,wv,Ca,CR,X0e],Ni="|",Uu=":";function RR(n){const e=n;return e!=null&&typeof e.node=="string"&&e.args!==void 0}class x_{constructor(e,t){Object.defineProperty(this,"lg_name",{enumerable:!0,configurable:!0,writable:!0,value:"Send"}),Object.defineProperty(this,"node",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"args",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.node=e,this.args=Qp(t)}toJSON(){return{lg_name:this.lg_name,node:this.node,args:this.args}}}function Fi(n){return n instanceof x_}function nwe(n){return!n||typeof n!="object"||!(Tn in n)?!1:Array.isArray(n[Tn])}class ki{constructor(e){Object.defineProperty(this,"lg_name",{enumerable:!0,configurable:!0,writable:!0,value:"Command"}),Object.defineProperty(this,"lc_direct_tool_output",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"graph",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"update",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"resume",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"goto",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.resume=e.resume,this.graph=e.graph,this.update=e.update,e.goto&&(this.goto=Array.isArray(e.goto)?Qp(e.goto):[Qp(e.goto)])}_updateAsTuples(){return this.update&&typeof this.update=="object"&&!Array.isArray(this.update)?Object.entries(this.update):Array.isArray(this.update)&&this.update.every(e=>Array.isArray(e)&&e.length===2&&typeof e[0]=="string")?this.update:[["__root__",this.update]]}toJSON(){var t;let e;return typeof this.goto=="string"?e=this.goto:Fi(this.goto)?e=this.goto.toJSON():e=(t=this.goto)==null?void 0:t.map(r=>typeof r=="string"?r:r.toJSON()),{lg_name:this.lg_name,update:this.update,resume:this.resume,goto:e}}}Object.defineProperty(ki,"PARENT",{enumerable:!0,configurable:!0,writable:!0,value:"__parent__"});function Br(n){return typeof n!="object"||n==null?!1:"lg_name"in n&&n.lg_name==="Command"}function Qp(n,e=new Map){if(n!=null&&typeof n=="object"){if(e.has(n))return e.get(n);let t;if(Array.isArray(n))t=[],e.set(n,t),n.forEach((r,i)=>{t[i]=Qp(r,e)});else if(Br(n)&&!(n instanceof ki))t=new ki(n),e.set(n,t);else if(RR(n)&&!(n instanceof x_))t=new x_(n.node,n.args),e.set(n,t);else if(Br(n)||Fi(n))t=n,e.set(n,t);else if("lc_serializable"in n&&n.lc_serializable)t=n,e.set(n,t);else{t={},e.set(n,t);for(const[r,i]of Object.entries(n))t[r]=Qp(i,e)}return t}return n}const rwe=["tags","metadata","callbacks","configurable"],iwe=["tags","metadata","callbacks","runName","maxConcurrency","recursionLimit","configurable","runId","outputKeys","streamMode","store","writer","interruptBefore","interruptAfter","signal"],awe=25;function P8(...n){const e={tags:[],metadata:{},callbacks:void 0,recursionLimit:awe,configurable:{}},t=Di.getRunnableConfig();if(t!==void 0){for(const[r,i]of Object.entries(t))if(i!==void 0)if(rwe.includes(r)){let a;Array.isArray(i)?a=[...i]:typeof i=="object"?r==="callbacks"&&"copy"in i&&typeof i.copy=="function"?a=i.copy():a={...i}:a=i,e[r]=a}else e[r]=i}for(const r of n)if(r!==void 0)for(const[i,a]of Object.entries(r))a!==void 0&&iwe.includes(i)&&(e[i]=a);for(const[r,i]of Object.entries(e.configurable))e.metadata=e.metadata??{},!r.startsWith("__")&&(typeof i=="string"||typeof i=="number"||typeof i=="boolean")&&!(r in e.metadata)&&(e.metadata[r]=i);return e}function xC(n){return n.split(Ni).filter(e=>!e.match(/^\d+$/)).map(e=>e.split(Uu)[0]).join(Ni)}function swe(n){const e=n.split(Ni);for(;e.length>1&&e[e.length-1].match(/^\d+$/);)e.pop();return e.slice(0,-1).join(Ni)}class Gl extends qt{constructor(e){super(),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langgraph"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"trace",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"recurse",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.name=e.name??e.func.name,this.func=e.func,this.config=e.tags?{tags:e.tags}:void 0,this.trace=e.trace??this.trace,this.recurse=e.recurse??this.recurse}async _tracedInvoke(e,t,r){return new Promise((i,a)=>{const s=on(t,{callbacks:r==null?void 0:r.getChild()});Di.runWithConfig(s,async()=>{try{const o=await this.func(e,s);i(o)}catch(o){a(o)}})})}async invoke(e,t){let r;const i=P8(t),a=as(this.config,i);return this.trace?r=await this._callWithConfig(this._tracedInvoke,e,a):r=await Di.runWithConfig(a,async()=>this.func(e,a)),qt.isRunnable(r)&&this.recurse?await Di.runWithConfig(a,async()=>r.invoke(e,a)):r}}function*bl(n,e){if(e===void 0)yield*n;else for(const t of n)yield[e,t]}async function Al(n){const e=[];for await(const t of await n)e.push(t);return e}function op(n){const e=[];for(const t of n)e.push(t);return e}function qh(n,e){return n?"configurable"in n?{...n,configurable:{...n.configurable,...e}}:{...n,configurable:e}:{configurable:e}}function owe(n){return typeof n=="object"&&(n==null?void 0:n[Symbol.for("LG_SKIP_WRITE")])!==void 0}const ju={[Symbol.for("LG_PASSTHROUGH")]:!0};function By(n){return typeof n=="object"&&(n==null?void 0:n[Symbol.for("LG_PASSTHROUGH")])!==void 0}const OC=Symbol("IS_WRITER");class Ir extends Gl{constructor(e,t){const r=`ChannelWrite<${e.map(i=>Fi(i)?i.node:"channel"in i?i.channel:"...").join(",")}>`;super({writes:e,name:r,tags:t,func:async(i,a)=>this._write(i,a??{})}),Object.defineProperty(this,"writes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.writes=e}async _write(e,t){const r=this.writes.map(i=>NC(i)&&By(i.value)?{mapper:i.mapper,value:e}:Sv(i)&&By(i.value)?{channel:i.channel,value:e,skipNone:i.skipNone,mapper:i.mapper}:i);return await Ir.doWrite(t,r),e}static async doWrite(e,t){var a;for(const s of t){if(Sv(s)){if(s.channel===cd)throw new $n("Cannot write to the reserved channel TASKS");if(By(s.value))throw new $n("PASSTHROUGH value must be replaced")}if(NC(s)&&By(s.value))throw new $n("PASSTHROUGH value must be replaced")}const r=[];for(const s of t)if(Fi(s))r.push([cd,s]);else if(NC(s)){const o=await s.mapper.invoke(s.value,e);o!=null&&o.length>0&&r.push(...o)}else if(Sv(s)){const o=s.mapper!==void 0?await s.mapper.invoke(s.value,e):s.value;if(owe(o)||s.skipNone&&o===void 0)continue;r.push([s.channel,o])}else throw new Error(`Invalid write entry: ${JSON.stringify(s)}`);((a=e.configurable)==null?void 0:a[Yf])(r)}static isWriter(e){return e instanceof Ir||OC in e&&!!e[OC]}static registerWriter(e){return Object.defineProperty(e,OC,{value:!0})}}function Sv(n){return n!==void 0&&typeof n.channel=="string"}function NC(n){return n!==void 0&&!Sv(n)&&qt.isRunnable(n.mapper)}class ox extends Gl{constructor(e,t,r=!1){super({func:(i,a)=>ox.doRead(a,this.channel,this.fresh,this.mapper)}),Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"ChannelRead"}),Object.defineProperty(this,"channel",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fresh",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.fresh=r,this.mapper=t,this.channel=e,this.name=Array.isArray(e)?`ChannelRead<${e.join(",")}>`:`ChannelRead<${e}>`}static doRead(e,t,r,i){var s;const a=(s=e.configurable)==null?void 0:s[$u];if(!a)throw new Error("Runnable is not configured with a read function. Make sure to call in the context of a Pregel process");return i?i(a(t,r)):a(t,r)}}const cf=new ms;class qs extends di{constructor(e){var w;const{channels:t,triggers:r,mapper:i,writers:a,bound:s,kwargs:o,metadata:u,retryPolicy:c,cachePolicy:d,tags:p,subgraphs:m,ends:y}=e,b=[...(w=e.config)!=null&&w.tags?e.config.tags:[],...p??[]];super({...e,bound:e.bound??cf,config:{...e.config?e.config:{},tags:b}}),Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"PregelNode"}),Object.defineProperty(this,"channels",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"triggers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:cf}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"retryPolicy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cachePolicy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"subgraphs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ends",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.channels=t,this.triggers=r,this.mapper=i,this.writers=a??this.writers,this.bound=s??this.bound,this.kwargs=o??this.kwargs,this.metadata=u??this.metadata,this.tags=b,this.retryPolicy=c,this.cachePolicy=d,this.subgraphs=m,this.ends=y}getWriters(){var t;const e=[...this.writers];for(;e.length>1&&e[e.length-1]instanceof Ir&&e[e.length-2]instanceof Ir;){const r=e.slice(-2),i=r[0].writes.concat(r[1].writes);e[e.length-2]=new Ir(i,(t=r[0].config)==null?void 0:t.tags),e.pop()}return e}getNode(){const e=this.getWriters();if(!(this.bound===cf&&e.length===0))return this.bound===cf&&e.length===1?e[0]:this.bound===cf?new vr({first:e[0],middle:e.slice(1,e.length-1),last:e[e.length-1],omitSequenceTags:!0}):e.length>0?new vr({first:this.bound,middle:e.slice(0,e.length-1),last:e[e.length-1],omitSequenceTags:!0}):this.bound}join(e){if(!Array.isArray(e))throw new Error("channels must be a list");if(typeof this.channels!="object")throw new Error("all channels must be named when using .join()");return new qs({channels:{...this.channels,...Object.fromEntries(e.map(t=>[t,t]))},triggers:this.triggers,mapper:this.mapper,writers:this.writers,bound:this.bound,kwargs:this.kwargs,config:this.config,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy})}pipe(e){return Ir.isWriter(e)?new qs({channels:this.channels,triggers:this.triggers,mapper:this.mapper,writers:[...this.writers,e],bound:this.bound,config:this.config,kwargs:this.kwargs,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy}):this.bound===cf?new qs({channels:this.channels,triggers:this.triggers,mapper:this.mapper,writers:this.writers,bound:Vr(e),config:this.config,kwargs:this.kwargs,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy}):new qs({channels:this.channels,triggers:this.triggers,mapper:this.mapper,writers:this.writers,bound:this.bound.pipe(e),config:this.config,kwargs:this.kwargs,retryPolicy:this.retryPolicy,cachePolicy:this.cachePolicy})}}class lwe{constructor(e,t){Object.defineProperty(this,"runtime",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_promises",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"lg_is_managed_value",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.config=e}static async initialize(e,t){throw new Error("Not implemented")}async promises(){return Promise.all(this._promises)}addPromise(e){this._promises.push(e)}}const uwe="__channel_key_placeholder__";class cwe extends Map{constructor(e){super(e?Array.from(e):void 0)}replaceRuntimeValues(e,t){if(!(this.size===0||!t)&&!Array.from(this.values()).every(r=>!r.runtime)){if(typeof t=="object"&&!Array.isArray(t))for(const[r,i]of Object.entries(t))for(const[a,s]of this.entries())s.runtime&&s.call(e)===i&&(t[r]={[uf]:a});else if(typeof t=="object"&&"constructor"in t)for(const r of Object.getOwnPropertyNames(Object.getPrototypeOf(t)))try{const i=t[r];for(const[a,s]of this.entries())s.runtime&&s.call(e)===i&&(t[r]={[uf]:a})}catch(i){if(i.name!==TypeError.name)throw i}}}replaceRuntimePlaceholders(e,t){var r;if(!(this.size===0||!t)&&!Array.from(this.values()).every(i=>!i.runtime)){if(typeof t=="object"&&!Array.isArray(t)){for(const[i,a]of Object.entries(t))if(typeof a=="object"&&a!==null&&uf in a){const s=a[uf];typeof s=="string"&&(t[i]=(r=this.get(s))==null?void 0:r.call(e))}}else if(typeof t=="object"&&"constructor"in t)for(const i of Object.getOwnPropertyNames(Object.getPrototypeOf(t)))try{const a=t[i];if(typeof a=="object"&&a!==null&&uf in a){const s=this.get(a[uf]);s&&(t[i]=s.call(e))}}catch(a){if(a.name!==TypeError.name)throw a}}}}function qb(n){return!!(typeof n=="object"&&n&&"cls"in n&&"params"in n)}class lx extends lwe{call(){}static async initialize(e,t){return Promise.resolve(new lx(e))}}function Fu(n,e,t=!0,r=!1){try{return n[e].get()}catch(i){if(i.name===zr.unminifiable_name){if(r)return i;if(t)return null}throw i}}function nc(n,e,t=!0){if(Array.isArray(e)){const r={};for(const i of e)try{r[i]=Fu(n,i,!t)}catch(a){if(a.name===zr.unminifiable_name)continue}return r}else return Fu(n,e)}function*fwe(n,e){if(n.graph===ki.PARENT)throw new $n("There is no parent graph.");if(n.goto){let t;Array.isArray(n.goto)?t=n.goto:t=[n.goto];for(const r of t)if(Fi(r))yield[Ia,cd,r];else if(typeof r=="string")yield[Ia,`branch:to:${r}`,"__start__"];else throw new Error(`In Command.send, expected Send or string, got ${typeof r}`)}if(n.resume)if(typeof n.resume=="object"&&Object.keys(n.resume).length&&Object.keys(n.resume).every(AR))for(const[t,r]of Object.entries(n.resume)){const i=e.filter(a=>a[0]===t&&a[1]===Ma).map(a=>a[2]).slice(0,1)??[];i.push(r),yield[t,Ma,i]}else yield[Ia,Ma,n.resume];if(n.update){if(typeof n.update!="object"||!n.update)throw new Error("Expected cmd.update to be a dict mapping channel names to update values");if(Array.isArray(n.update))for(const[t,r]of n.update)yield[Ia,t,r];else for(const[t,r]of Object.entries(n.update))yield[Ia,t,r]}}function*x8(n,e){if(e!=null)if(Array.isArray(n)&&typeof e=="object"&&!Array.isArray(e))for(const t in e)n.includes(t)&&(yield[t,e[t]]);else{if(Array.isArray(n))throw new Error('Input chunk must be an object when "inputChannels" is an array');yield[n,e]}}function*kC(n,e,t){Array.isArray(n)?(e===!0||e.find(([r,i])=>n.includes(r)))&&(yield nc(t,n)):(e===!0||e.some(([r,i])=>r===n))&&(yield Fu(t,n))}function*gF(n,e,t){const r=e.filter(([o,u])=>{var c;return(o.config===void 0||!((c=o.config.tags)!=null&&c.includes(rr)))&&u[0][0]!==Oi&&u[0][0]!==Tn});if(!r.length)return;let i;r.some(([o])=>o.writes.some(([u,c])=>u===ud))?i=r.flatMap(([o])=>o.writes.filter(([u,c])=>u===ud).map(([u,c])=>[o.name,c])):Array.isArray(n)?i=r.flatMap(([o])=>{const{writes:u}=o,c={};for(const[d]of u)n.includes(d)&&(c[d]=(c[d]||0)+1);return Object.values(c).some(d=>d>1)?u.filter(([d])=>n.includes(d)).map(([d,p])=>[o.name,{[d]:p}]):[[o.name,Object.fromEntries(u.filter(([d])=>n.includes(d)))]]}):i=r.flatMap(([o])=>o.writes.filter(([u,c])=>u===n).map(([u,c])=>[o.name,c]));const a={};for(const[o,u]of i)o in a||(a[o]=[]),a[o].push(u);const s={};for(const o in a)if(a[o].length===1){const[u]=a[o];s[o]=u}else s[o]=a[o];t&&(s.__metadata__={cached:t}),yield s}class dwe{constructor({func:e,name:t,input:r,retry:i,cache:a,callbacks:s}){Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"input",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"retry",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"__lg_type",{enumerable:!0,configurable:!0,writable:!0,value:"call"}),this.func=e,this.name=t,this.input=r,this.retry=i,this.cache=a,this.callbacks=s}}function hwe(n){return typeof n=="object"&&n!==null&&"__lg_type"in n&&n.__lg_type==="call"}function O8(n){const e=Object.values(n),t=e.length>0?typeof e[0]:void 0;let r;return t==="number"?r=0:t==="string"&&(r=""),r}function IR(n,e){if(Object.keys(n).length>0){const t=O8(e);return Object.fromEntries(Object.entries(e).filter(([r,i])=>i>(n[r]??t)))}else return e}function pwe(n,e){return n&&!Array.isArray(n)&&!(n instanceof Date)&&typeof n=="object"?n:{[e]:n}}function Pl(n,e){return n===null?{configurable:e}:(n==null?void 0:n.configurable)===void 0?{...n,configurable:e}:{...n,configurable:{...n.configurable,...e}}}function ff(n,e){var r,i;const t=(e==null?void 0:e.parents)??{};return Object.keys(t).length>0?Pl(n,{[Ca]:{...t,[((r=n.configurable)==null?void 0:r.checkpoint_ns)??""]:(i=n.configurable)==null?void 0:i.checkpoint_id}}):n}function $f(...n){if(n.length===1)return n[0];const e=new AbortController,t=()=>{e.abort(),n.forEach(r=>r.removeEventListener("abort",t))};return n.forEach(r=>r.addEventListener("abort",t)),n.some(r=>r.aborted)&&e.abort(),e.signal}const mwe=(n,e)=>{if(!(!n&&!e))return n?e?Array.isArray(n)&&Array.isArray(e)?[...n,...e]:Array.isArray(n)?[...n,e]:Array.isArray(e)?[n,...e]:[n,e]:n:e};function gwe(n,e){const t=new Gl({func:r=>e(...r),name:n,trace:!1,recurse:!1});return new vr({name:n,first:t,last:new Ir([{channel:ud,value:ju}],[rr])})}const ywe=n=>n!==void 0?n+1:1;function qy(n,e,t){const r=Object.values(n.channel_versions),i=r.length>0?typeof r[0]:void 0;let a;i==="number"?a=0:i==="string"&&(a="");const s=n.versions_seen[Tn]??{},o=Object.entries(n.channel_versions).some(([c,d])=>d>(s[c]??a)),u=t.some(c=>{var d,p;return e==="*"?!((p=(d=c.config)==null?void 0:d.tags)!=null&&p.includes(rr)):e.includes(c.name)});return o&&u}function Tv(n,e,t,r,i,a,s=!1){let o=[],u=new Set;if(Array.isArray(a))o=a.filter(d=>r.get(d)),a=a.filter(d=>!r.get(d)),u=new Set(a.filter(d=>i.writes.some(([p,m])=>p===d)));else{for(const[d]of i.writes)if(d===a){u=new Set([d]);break}u=u||new Set}let c;if(s&&u.size>0){const d=Object.fromEntries(Object.entries(t).filter(([y,b])=>u.has(y))),p=wu(e,d,-1),m=I_(d,p);ia(R_(p),m,[i],void 0,void 0),c=nc({...t,...m},a)}else c=nc(t,a);if(o.length>0)for(const d of o){const p=r.get(d);if(p){const m=p.call(n);c[d]=m}}return c}function MC(n,e,t,r,i){for(const[a,s]of i)if([Ra,cd].includes(a)&&s!=null){if(!Fi(s))throw new $n(`Invalid packet type, expected SendProtocol, got ${JSON.stringify(s)}`);if(!(s.node in t))throw new $n(`Invalid node name "${s.node}" in Send packet`);r.replaceRuntimeValues(n,s.args)}e(i)}const vwe=new Set([sx,Ra,Ma,Tn,ud,Oi]);function ia(n,e,t,r,i){var m,y,b;t.sort((w,S)=>{var A,I;const T=((A=w.path)==null?void 0:A.slice(0,3))||[],C=((I=S.path)==null?void 0:I.slice(0,3))||[];for(let x=0;x<Math.min(T.length,C.length);x+=1){if(T[x]<C[x])return-1;if(T[x]>C[x])return 1}return T.length-C.length});const a=t.some(w=>w.triggers.length>0),s=Object.fromEntries(Object.entries(e).filter(([w,S])=>Bb(S)));for(const w of t){(m=n.versions_seen)[y=w.name]??(m[y]={});for(const S of w.triggers)S in n.channel_versions&&(n.versions_seen[w.name][S]=n.channel_versions[S])}let o;Object.keys(n.channel_versions).length>0&&(o=lF(...Object.values(n.channel_versions)));const u=new Set(t.flatMap(w=>w.triggers).filter(w=>!twe.includes(w)));for(const w of u)w in s&&s[w].consume()&&r!==void 0&&(n.channel_versions[w]=r(o,s[w]));(b=n.pending_sends)!=null&&b.length&&a&&(n.pending_sends=[]);const c={},d={};for(const w of t)for(const[S,T]of w.writes)vwe.has(S)||(S===cd?n.pending_sends.push({node:T.node,args:T.args}):S in s?(c[S]??(c[S]=[]),c[S].push(T)):(d[S]??(d[S]=[]),d[S].push(T)));o=void 0,Object.keys(n.channel_versions).length>0&&(o=lF(...Object.values(n.channel_versions)));const p=new Set;for(const[w,S]of Object.entries(c))if(w in s){let T;try{T=s[w].update(S)}catch(C){if(C.name===$n.unminifiable_name){const A=new $n(`Invalid update for channel "${w}" with values ${JSON.stringify(S)}: ${C.message}`);throw A.lc_error_code=C.lc_error_code,A}else throw C}T&&r!==void 0&&(n.channel_versions[w]=r(o,s[w]),s[w].isAvailable()&&p.add(w))}if(a)for(const w of Object.keys(s))s[w].isAvailable()&&!p.has(w)&&s[w].update([])&&r!==void 0&&(n.channel_versions[w]=r(o,s[w]),s[w].isAvailable()&&p.add(w));if(a&&n.pending_sends.length===0&&!Object.keys(i??{}).some(w=>p.has(w)))for(const w of Object.keys(s))s[w].finish()&&r!==void 0&&(n.channel_versions[w]=r(o,s[w]),s[w].isAvailable()&&p.add(w));return d}function Ip(n,e,t,r,i,a,s,o){const u={};for(let c=0;c<n.pending_sends.length;c+=1){const d=PR([Ra,c],n,e,t,r,i,a,s,o);d!==void 0&&(u[d.id]=d)}for(const c of Object.keys(t)){const d=PR([Ev,c],n,e,t,r,i,a,s,o);d!==void 0&&(u[d.id]=d)}return u}function PR(n,e,t,r,i,a,s,o,u){const{step:c,checkpointer:d,manager:p}=u,m=s.configurable??{},y=m.checkpoint_ns??"";if(n[0]===Ra&&hwe(n[n.length-1])){const b=n[n.length-1],w=gwe(b.name,b.func),S=[Ra],T=y===""?b.name:`${y}${Ni}${b.name}`,C=kf(JSON.stringify([T,c.toString(),b.name,Ra,n[1],n[2]]),e.id),A=`${T}${Uu}${C}`,I={langgraph_step:c,langgraph_node:b.name,langgraph_triggers:S,langgraph_path:n.slice(0,3),langgraph_checkpoint_ns:A};{const x=[];return{name:b.name,input:b.input,proc:w,writes:x,config:on(as(s,{metadata:I,store:u.store??s.store}),{runName:b.name,callbacks:p==null?void 0:p.getChild(`graph:step:${c}`),configurable:{[Rp]:C,[Yf]:U=>MC(c,N=>x.push(...N),r,a,U),[$u]:(U,N=!1)=>Tv(c,e,i,a,{name:b.name,writes:x,triggers:S,path:n.slice(0,3)},U,N),[mr]:d??m[mr],[Ca]:{...m[Ca],[y]:e.id},[Lu]:DC({pendingWrites:t??[],taskId:C,currentTaskInput:b.input}),[wv]:e.channel_values[PC],checkpoint_id:void 0,checkpoint_ns:A}}),triggers:S,retry_policy:b.retry,cache_key:b.cache?{key:(b.cache.keyFunc??JSON.stringify)([b.input]),ns:[IC,b.name??"__dynamic__"],ttl:b.cache.ttl}:void 0,id:C,path:n.slice(0,3),writers:[]}}}else if(n[0]===Ra){const b=typeof n[1]=="number"?n[1]:parseInt(n[1],10);if(b>=e.pending_sends.length)return;const w=RR(e.pending_sends[b])&&!Fi(e.pending_sends[b])?new x_(e.pending_sends[b].node,e.pending_sends[b].args):e.pending_sends[b];if(!RR(w)){console.warn(`Ignoring invalid packet ${JSON.stringify(w)} in pending sends.`);return}if(!(w.node in r)){console.warn(`Ignoring unknown node name ${w.node} in pending sends.`);return}const S=[Ra],T=y===""?w.node:`${y}${Ni}${w.node}`,C=kf(JSON.stringify([T,c.toString(),w.node,Ra,b.toString()]),e.id),A=`${T}${Uu}${C}`;let I={langgraph_step:c,langgraph_node:w.node,langgraph_triggers:S,langgraph_path:n.slice(0,3),langgraph_checkpoint_ns:A};{const x=r[w.node],L=x.getNode();if(L!==void 0){a.replaceRuntimePlaceholders(c,w.args),x.metadata!==void 0&&(I={...I,...x.metadata});const U=[];return{name:w.node,input:w.args,proc:L,subgraphs:x.subgraphs,writes:U,config:on(as(s,{metadata:I,tags:x.tags,store:u.store??s.store}),{runName:w.node,callbacks:p==null?void 0:p.getChild(`graph:step:${c}`),configurable:{[Rp]:C,[Yf]:N=>MC(c,B=>U.push(...B),r,a,N),[$u]:(N,B=!1)=>Tv(c,e,i,a,{name:w.node,writes:U,triggers:S,path:n},N,B),[mr]:d??m[mr],[Ca]:{...m[Ca],[y]:e.id},[Lu]:DC({pendingWrites:t??[],taskId:C,currentTaskInput:w.args}),[wv]:e.channel_values[PC],checkpoint_id:void 0,checkpoint_ns:A}}),triggers:S,retry_policy:x.retryPolicy,cache_key:x.cachePolicy?{key:(x.cachePolicy.keyFunc??JSON.stringify)([w.args]),ns:[IC,x.name??"__dynamic__",w.node],ttl:x.cachePolicy.ttl}:void 0,id:C,path:n,writers:x.getWriters()}}}}else if(n[0]===Ev){const b=n[1].toString(),w=r[b];if(w===void 0)return;if(t!=null&&t.length){const A=y===""?b:`${y}${Ni}${b}`,I=kf(JSON.stringify([A,c.toString(),b,Ev,b]),e.id);if(t.some(L=>L[0]===I&&L[1]!==Oi))return}const S=O8(e.channel_versions);if(S===void 0)return;const T=e.versions_seen[b]??{},C=w.triggers.filter(A=>{const I=Fu(i,A,!1,!0);return!(I instanceof Error&&I.name===zr.unminifiable_name)&&(e.channel_versions[A]??S)>(T[A]??S)}).sort();if(C.length>0){const A=_we(c,w,a,i);if(A===void 0)return;const I=y===""?b:`${y}${Ni}${b}`,x=kf(JSON.stringify([I,c.toString(),b,Ev,C]),e.id),L=`${I}${Uu}${x}`;let U={langgraph_step:c,langgraph_node:b,langgraph_triggers:C,langgraph_path:n,langgraph_checkpoint_ns:L};{const N=w.getNode();if(N!==void 0){w.metadata!==void 0&&(U={...U,...w.metadata});const B=[];return{name:b,input:A,proc:N,subgraphs:w.subgraphs,writes:B,config:on(as(s,{metadata:U,tags:w.tags,store:u.store??s.store}),{runName:b,callbacks:p==null?void 0:p.getChild(`graph:step:${c}`),configurable:{[Rp]:x,[Yf]:q=>MC(c,J=>{B.push(...J)},r,a,q),[$u]:(q,J=!1)=>Tv(c,e,i,a,{name:b,writes:B,triggers:C,path:n},q,J),[mr]:d??m[mr],[Ca]:{...m[Ca],[y]:e.id},[Lu]:DC({pendingWrites:t??[],taskId:x,currentTaskInput:A}),[wv]:e.channel_values[PC],checkpoint_id:void 0,checkpoint_ns:L}}),triggers:C,retry_policy:w.retryPolicy,cache_key:w.cachePolicy?{key:(w.cachePolicy.keyFunc??JSON.stringify)([A]),ns:[IC,w.name??"__dynamic__",b],ttl:w.cachePolicy.ttl}:void 0,id:x,path:n,writers:w.getWriters()}}}}}}function _we(n,e,t,r,i){var s;let a;if(typeof e.channels=="object"&&!Array.isArray(e.channels)){a={};for(const[o,u]of Object.entries(e.channels))if(e.triggers.includes(u))try{a[o]=Fu(r,u,!1)}catch(c){if(c.name===zr.unminifiable_name)return;throw c}else if(u in r)try{a[o]=Fu(r,u,!1)}catch(c){if(c.name===zr.unminifiable_name)continue;throw c}else a[o]=(s=t.get(o))==null?void 0:s.call(n)}else if(Array.isArray(e.channels)){let o=!1;for(const u of e.channels)try{a=Fu(r,u,!1),o=!0;break}catch(c){if(c.name===zr.unminifiable_name)continue;throw c}if(!o)return}else throw new Error(`Invalid channels type, expected list or dict, got ${e.channels}`);return e.mapper!==void 0&&(a=e.mapper(a)),a}function DC({pendingWrites:n,taskId:e,currentTaskInput:t}){var a;const r=(a=n.find(([s,o])=>s===Ia&&o===Ma))==null?void 0:a[2],i={callCounter:0,interruptCounter:-1,resume:n.filter(([s,o])=>s===e&&o===Ma).flatMap(([s,o,u])=>u),nullResume:r,subgraphCounter:0,currentTaskInput:t,consumeNullResume:()=>{if(i.nullResume)return delete i.nullResume,n.splice(n.findIndex(([s,o])=>s===Ia&&o===Ma),1),r}};return i}function bwe(n){return"steps"in n&&Array.isArray(n.steps)}function ux(n){return"lg_is_pregel"in n&&n.lg_is_pregel===!0}function N8(n){const e=[n];for(const t of e){if(ux(t))return t;bwe(t)&&e.push(...t.steps)}}const em={blue:{start:"\x1B[34m",end:"\x1B[0m"},green:{start:"\x1B[32m",end:"\x1B[0m"},yellow:{start:"\x1B[33;1m",end:"\x1B[0m"}},tm=(n,e)=>`${n.start}${e}${n.end}`;function*yF(n,e){var r;const t=new Date().toISOString();for(const{id:i,name:a,input:s,config:o,triggers:u,writes:c}of e){if((r=o==null?void 0:o.tags)!=null&&r.includes(rr))continue;const d=c.filter(([p,m])=>p===i&&m===Tn).map(([,p])=>p);yield{type:"task",timestamp:t,step:n,payload:{id:i,name:a,input:s,triggers:u,interrupts:d}}}}function*wwe(n,e,t){var i;const r=new Date().toISOString();for(const[{id:a,name:s,config:o},u]of e)(i=o==null?void 0:o.tags)!=null&&i.includes(rr)||(yield{type:"task_result",timestamp:r,step:n,payload:{id:a,name:s,result:u.filter(([c])=>Array.isArray(t)?t.includes(c):c===t),interrupts:u.filter(c=>c[0]===Tn).map(c=>c[1])}})}function*Ewe(n,e,t,r,i,a,s,o,u){var y,b,w;function c(S){const T={};return S.callbacks!=null&&(T.callbacks=S.callbacks),S.configurable!=null&&(T.configurable=S.configurable),S.maxConcurrency!=null&&(T.max_concurrency=S.maxConcurrency),S.metadata!=null&&(T.metadata=S.metadata),S.recursionLimit!=null&&(T.recursion_limit=S.recursionLimit),S.runId!=null&&(T.run_id=S.runId),S.runName!=null&&(T.run_name=S.runName),S.tags!=null&&(T.tags=S.tags),T}const d=(y=e.configurable)==null?void 0:y.checkpoint_ns,p={};for(const S of a){if(!((b=S.subgraphs)!=null&&b.length?S.subgraphs:[S.proc]).find(N8))continue;let C=`${S.name}:${S.id}`;d&&(C=`${d}|${C}`),p[S.id]={configurable:{thread_id:(w=e.configurable)==null?void 0:w.thread_id,checkpoint_ns:C}}}yield{type:"checkpoint",timestamp:new Date().toISOString(),step:n,payload:{config:c(e),values:nc(t,r),metadata:i,next:a.map(S=>S.name),tasks:k8(a,s,p,u),parentConfig:o?c(o):void 0}}}function k8(n,e,t,r){return n.map(i=>{var c;const a=(c=e.find(([d,p])=>d===i.id&&p===Oi))==null?void 0:c[2],s=e.filter(([d,p])=>d===i.id&&p===Tn).map(([,,d])=>d),o=(()=>{var p;if(a||s.length||!e.length)return;const d=e.findIndex(([m,y])=>m===i.id&&y===ud);if(d>=0)return e[d][2];if(typeof r=="string")return(p=e.find(([m,y])=>m===i.id&&y===r))==null?void 0:p[2];if(Array.isArray(r)){const m=e.filter(([y,b])=>y===i.id&&r.includes(b)).map(([,y,b])=>[y,b]);return m.length?Object.fromEntries(m):void 0}})();if(a)return{id:i.id,name:i.name,path:i.path,error:a,interrupts:s,result:o};const u=t==null?void 0:t[i.id];return{id:i.id,name:i.name,path:i.path,interrupts:s,...u!==void 0?{state:u}:{},result:o}})}function Swe(n,e,t){console.log([`${tm(em.blue,`[${n}:checkpoint]`)}`,`\x1B[1m State at the end of step ${n}:\x1B[0m
`,JSON.stringify(nc(e,t),null,2)].join(""))}function M8(n,e){const t=e.length;console.log([`${tm(em.blue,`[${n}:tasks]`)}`,`\x1B[1m Starting step ${n} with ${t} task${t===1?"":"s"}:\x1B[0m
`,e.map(r=>`- ${tm(em.green,String(r.name))} -> ${JSON.stringify(r.input,null,2)}`).join(`
`)].join(""))}function Twe(n,e,t){const r={};for(const[i,a]of e)t.includes(i)&&(r[i]||(r[i]=[]),r[i].push(a));console.log([`${tm(em.blue,`[${n}:writes]`)}`,`\x1B[1m Finished step ${n} with writes to ${Object.keys(r).length} channel${Object.keys(r).length!==1?"s":""}:\x1B[0m
`,Object.entries(r).map(([i,a])=>`- ${tm(em.yellow,i)} -> ${a.map(s=>JSON.stringify(s)).join(", ")}`).join(`
`)].join(""))}class vF extends ti{constructor(e,t){const r=e.getReader(),i=t??new AbortController;super({start(a){return s();function s(){return r.read().then(({done:o,value:u})=>{if(o){a.close();return}return a.enqueue(u),s()})}}}),Object.defineProperty(this,"_abortController",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this._abortController=i,this._reader=r}async cancel(e){this._abortController.abort(e),this._reader.releaseLock()}get signal(){return this._abortController.signal}}class D8 extends ti{get closed(){return this._closed}constructor(e){let t;const r=new Promise(i=>{t=i});super({start:i=>{t(i)}}),Object.defineProperty(this,"modes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"controller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"passthroughFn",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_closed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),r.then(i=>{this.controller=i}),this.passthroughFn=e.passthroughFn,this.modes=e.modes}push(e){var t;(t=this.passthroughFn)==null||t.call(this,e),this.controller.enqueue(e)}close(){try{this.controller.close()}catch{}finally{this._closed=!0}}error(e){this.controller.error(e)}}const Vy=Symbol.for("INPUT_DONE"),$C=Symbol.for("INPUT_RESUMING"),Awe=25;function Cwe(...n){return new D8({passthroughFn:e=>{for(const t of n)t.modes.has(e[1])&&t.push(e)},modes:new Set(n.flatMap(e=>Array.from(e.modes)))})}class Rwe extends B0e{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:Promise.resolve()}),this.cache=e}async get(e){return this.enqueueOperation("get",e)}async set(e){return this.enqueueOperation("set",e)}async clear(e){return this.enqueueOperation("clear",e)}async stop(){await this.queue}enqueueOperation(e,...t){const r=this.queue.then(()=>this.cache[e](...t));return this.queue=r.then(()=>{},()=>{}),r}}class cx{get isResuming(){var o,u;const e=Object.keys(this.checkpoint.channel_versions).length!==0,r=((o=this.config.configurable)==null?void 0:o[Sl])!==void 0&&((u=this.config.configurable)==null?void 0:u[Sl]),i=this.input===null||this.input===void 0,a=Br(this.input)&&this.input.resume!=null,s=this.input===$C;return e&&(r||i||a||s)}constructor(e){Object.defineProperty(this,"input",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkpointer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkpointerGetNextVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channels",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"managed",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkpoint",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkpointConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkpointMetadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkpointNamespace",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkpointPendingWrites",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"checkpointPreviousVersions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"step",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKeys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamKeys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"skipDoneTasks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"prevCheckpointConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"status",{enumerable:!0,configurable:!0,writable:!0,value:"pending"}),Object.defineProperty(this,"tasks",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"stream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"checkpointerPromises",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"isNested",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_checkpointerChainedPromise",{enumerable:!0,configurable:!0,writable:!0,value:Promise.resolve()}),Object.defineProperty(this,"store",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"manager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"interruptAfter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"interruptBefore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"toInterrupt",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"triggerToNodes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.input=e.input,this.checkpointer=e.checkpointer,this.checkpointer!==void 0?this.checkpointerGetNextVersion=this.checkpointer.getNextVersion.bind(this.checkpointer):this.checkpointerGetNextVersion=ywe,this.checkpoint=e.checkpoint,this.checkpointMetadata=e.checkpointMetadata,this.checkpointPreviousVersions=e.checkpointPreviousVersions,this.channels=e.channels,this.managed=e.managed,this.checkpointPendingWrites=e.checkpointPendingWrites,this.step=e.step,this.stop=e.stop,this.config=e.config,this.checkpointConfig=e.checkpointConfig,this.isNested=e.isNested,this.manager=e.manager,this.outputKeys=e.outputKeys,this.streamKeys=e.streamKeys,this.nodes=e.nodes,this.skipDoneTasks=e.skipDoneTasks,this.store=e.store,this.cache=e.cache?new Rwe(e.cache):void 0,this.stream=e.stream,this.checkpointNamespace=e.checkpointNamespace,this.prevCheckpointConfig=e.prevCheckpointConfig,this.interruptAfter=e.interruptAfter,this.interruptBefore=e.interruptBefore,this.debug=e.debug,this.triggerToNodes=e.triggerToNodes}static async initialize(e){var A,I,x,L,U,N,B,q,J,V,de,ae;let{config:t,stream:r}=e;r!==void 0&&((A=t.configurable)==null?void 0:A[P_])!==void 0&&(r=Cwe(r,t.configurable[P_]));const i=t.configurable?!("checkpoint_id"in t.configurable):!0,a=(I=t.configurable)==null?void 0:I[Lu];t.configurable&&a&&(a.subgraphCounter>0&&(t=Pl(t,{[CR]:[t.configurable[CR],a.subgraphCounter.toString()].join(Ni)})),a.subgraphCounter+=1);const s=$u in(t.configurable??{});!s&&((x=t.configurable)==null?void 0:x.checkpoint_ns)!==void 0&&((L=t.configurable)==null?void 0:L.checkpoint_ns)!==""&&(t=Pl(t,{checkpoint_ns:"",checkpoint_id:void 0}));let o=t;((U=t.configurable)==null?void 0:U[Ca])!==void 0&&((q=(N=t.configurable)==null?void 0:N[Ca])!=null&&q[(B=t.configurable)==null?void 0:B.checkpoint_ns])&&(o=Pl(t,{checkpoint_id:t.configurable[Ca][(J=t.configurable)==null?void 0:J.checkpoint_ns]}));const u=((de=(V=t.configurable)==null?void 0:V.checkpoint_ns)==null?void 0:de.split(Ni))??[],c=await((ae=e.checkpointer)==null?void 0:ae.getTuple(o))??{config:t,checkpoint:T8(),metadata:{source:"input",step:-2,writes:null,parents:{}},pendingWrites:[]};o={...t,...c.config,configurable:{checkpoint_ns:"",...t.configurable,...c.config.configurable}};const d=c.parentConfig,p=R_(c.checkpoint),m={...c.metadata},y=c.pendingWrites??[],b=I_(e.channelSpecs,p),w=(m.step??0)+1,S=w+(t.recursionLimit??Awe)+1,T={...p.channel_versions},C=e.store?new F0e(e.store):void 0;return C&&C.start(),new cx({input:e.input,config:t,checkpointer:e.checkpointer,checkpoint:p,checkpointMetadata:m,checkpointConfig:o,prevCheckpointConfig:d,checkpointNamespace:u,channels:b,managed:e.managed,isNested:s,manager:e.manager,skipDoneTasks:i,step:w,stop:S,checkpointPreviousVersions:T,checkpointPendingWrites:y,outputKeys:e.outputKeys??[],streamKeys:e.streamKeys??[],nodes:e.nodes,stream:r,store:C,cache:e.cache,interruptAfter:e.interruptAfter,interruptBefore:e.interruptBefore,debug:e.debug,triggerToNodes:e.triggerToNodes})}_checkpointerPutAfterPrevious(e){this._checkpointerChainedPromise=this._checkpointerChainedPromise.then(()=>{var t;return(t=this.checkpointer)==null?void 0:t.put(e.config,e.checkpoint,e.metadata,e.newVersions)}),this.checkpointerPromises.push(this._checkpointerChainedPromise)}async updateManagedValues(e,t){const r=this.managed.get(e);r&&"update"in r&&typeof r.update=="function"&&await r.update(t)}putWrites(e,t){var s,o;let r=t;if(r.length===0)return;r.every(([u])=>u in uF)&&(r=Array.from(new Map(r.map(u=>[u[0],u])).values()));for(const[u,c]of r){const d=this.checkpointPendingWrites.findIndex(p=>p[0]===e&&p[1]===u);u in uF&&d!==-1?this.checkpointPendingWrites[d]=[e,u,c]:this.checkpointPendingWrites.push([e,u,c])}const i=(o=this.checkpointer)==null?void 0:o.putWrites({...this.checkpointConfig,configurable:{...this.checkpointConfig.configurable,checkpoint_ns:((s=this.config.configurable)==null?void 0:s.checkpoint_ns)??"",checkpoint_id:this.checkpoint.id}},r,e);if(i!==void 0&&this.checkpointerPromises.push(i),this.tasks&&this._outputWrites(e,r),!t.length||!this.cache||!this.tasks)return;const a=this.tasks[e];a==null||a.cache_key==null||t[0][0]===Oi||t[0][0]===Tn||this.cache.set([{key:[a.cache_key.ns,a.cache_key.key],value:a.writes,ttl:a.cache_key.ttl}])}_outputWrites(e,t,r=!1){const i=this.tasks[e];if(i!==void 0){if(i.config!==void 0&&(i.config.tags??[]).includes(rr))return;t.length>0&&t[0][0]!==Oi&&t[0][0]!==Tn&&this._emit(op(bl(gF(this.outputKeys,[[i,t]],r),"updates"))),r||this._emit(op(bl(wwe(this.step,[[i,t]],this.streamKeys),"debug")))}}async _matchCachedWrites(){if(!this.cache)return[];const e=[],t=([s,o])=>`ns:${s.join(",")}|key:${o}`,r=[],i={};for(const s of Object.values(this.tasks))s.cache_key!=null&&!s.writes.length&&(r.push([s.cache_key.ns,s.cache_key.key]),i[t([s.cache_key.ns,s.cache_key.key])]=s);if(r.length===0)return[];const a=await this.cache.get(r);for(const{key:s,value:o}of a){const u=i[t(s)];u!=null&&(u.writes.push(...o),e.push({task:u,result:o}))}return e}async tick(e){var a,s,o;this.store&&!this.store.isRunning&&((a=this.store)==null||a.start());const{inputKeys:t=[]}=e;if(this.status!=="pending")throw new Error(`Cannot tick when status is no longer "pending". Current status: "${this.status}"`);if(![Vy,$C].includes(this.input))await this._first(t);else{if(this.toInterrupt.length>0)throw this.status="interrupt_before",new Cp;if(Object.values(this.tasks).every(u=>u.writes.length>0)){const u=Object.values(this.tasks).flatMap(p=>p.writes),c=ia(this.checkpoint,this.channels,Object.values(this.tasks),this.checkpointerGetNextVersion,this.triggerToNodes);for(const[p,m]of Object.entries(c))await this.updateManagedValues(p,m);const d=await Al(bl(kC(this.outputKeys,u,this.channels),"values"));if(this._emit(d),this.checkpointPendingWrites=[],await this._putCheckpoint({source:"loop",writes:gF(this.outputKeys,Object.values(this.tasks).map(p=>[p,p.writes])).next().value??null}),qy(this.checkpoint,this.interruptAfter,Object.values(this.tasks)))throw this.status="interrupt_after",new Cp;((s=this.config.configurable)==null?void 0:s[Sl])!==void 0&&((o=this.config.configurable)==null||delete o[Sl])}else return!1}if(this.step>this.stop)return this.status="out_of_steps",!1;const r=Ip(this.checkpoint,this.checkpointPendingWrites,this.nodes,this.channels,this.managed,this.config,!0,{step:this.step,checkpointer:this.checkpointer,isResuming:this.isResuming,manager:this.manager,store:this.store,stream:this.stream});if(this.tasks=r,this.checkpointer&&this._emit(await Al(bl(Ewe(this.step-1,this.checkpointConfig,this.channels,this.streamKeys,this.checkpointMetadata,Object.values(this.tasks),this.checkpointPendingWrites,this.prevCheckpointConfig,this.outputKeys),"debug"))),Object.values(this.tasks).length===0)return this.status="done",!1;if(this.skipDoneTasks&&this.checkpointPendingWrites.length>0){for(const[u,c,d]of this.checkpointPendingWrites){if(c===Oi||c===Tn||c===Ma)continue;const p=Object.values(this.tasks).find(m=>m.id===u);p&&p.writes.push([c,d])}for(const u of Object.values(this.tasks))u.writes.length>0&&this._outputWrites(u.id,u.writes,!0)}if(Object.values(this.tasks).every(u=>u.writes.length>0))return this.tick({inputKeys:t});if(qy(this.checkpoint,this.interruptBefore,Object.values(this.tasks)))throw this.status="interrupt_before",new Cp;const i=await Al(bl(yF(this.step,Object.values(this.tasks)),"debug"));return this._emit(i),!0}async finishAndHandleError(e){const t=this._suppressInterrupt(e);if((t||e===void 0)&&(this.output=nc(this.channels,this.outputKeys)),t){if(this.tasks!==void 0&&this.checkpointPendingWrites.length>0&&Object.values(this.tasks).some(i=>i.writes.length>0)){const i=ia(this.checkpoint,this.channels,Object.values(this.tasks),this.checkpointerGetNextVersion,this.triggerToNodes);for(const[a,s]of Object.entries(i))await this.updateManagedValues(a,s);this._emit(op(bl(kC(this.outputKeys,Object.values(this.tasks).flatMap(a=>a.writes),this.channels),"values")))}const r={[Tn]:e.interrupts};this._emit([["updates",r],["values",r]])}return t}async acceptPush(e,t,r){var s,o;if(((s=this.interruptAfter)==null?void 0:s.length)>0&&qy(this.checkpoint,this.interruptAfter,[e])){this.toInterrupt.push(e);return}const i=PR([Ra,e.path??[],t,e.id,r],this.checkpoint,this.checkpointPendingWrites,this.nodes,this.channels,this.managed,e.config??{},!0,{step:this.step,checkpointer:this.checkpointer,manager:this.manager,store:this.store,stream:this.stream});if(!i)return;if(((o=this.interruptBefore)==null?void 0:o.length)>0&&qy(this.checkpoint,this.interruptBefore,[i])){this.toInterrupt.push(i);return}this._emit(op(bl(yF(this.step,[i]),"debug"))),this.debug&&M8(this.step,[i]),this.tasks[i.id]=i,this.skipDoneTasks&&this._matchWrites({[i.id]:i});const a=await this._matchCachedWrites();for(const{task:u}of a)this._outputWrites(u.id,u.writes,!0);return i}_suppressInterrupt(e){return Df(e)&&!this.isNested}async _first(e){const{configurable:t}=this.config,r=t==null?void 0:t[Lu];if(r&&r.nullResume!==void 0&&this.putWrites(Ia,[[Ma,r.nullResume]]),Br(this.input)){if(this.input.resume!=null&&this.checkpointer==null)throw new Error("Cannot use Command(resume=...) without checkpointer");const o={};for(const[u,c,d]of fwe(this.input,this.checkpointPendingWrites))o[u]===void 0&&(o[u]=[]),o[u].push([c,d]);if(Object.keys(o).length===0)throw new fF("Received empty Command input");for(const[u,c]of Object.entries(o))this.putWrites(u,c)}const i=(this.checkpointPendingWrites??[]).filter(s=>s[0]===Ia).map(s=>s.slice(1));i.length>0&&ia(this.checkpoint,this.channels,[{name:To,writes:i,triggers:[]}],this.checkpointerGetNextVersion,this.triggerToNodes);const a=Br(this.input)&&i.length>0;if(this.isResuming||a){for(const o of Object.keys(this.channels))if(this.checkpoint.channel_versions[o]!==void 0){const u=this.checkpoint.channel_versions[o];this.checkpoint.versions_seen[Tn]={...this.checkpoint.versions_seen[Tn],[o]:u}}const s=await Al(bl(kC(this.outputKeys,!0,this.channels),"values"));this._emit(s)}if(this.isResuming)this.input=$C;else if(a)await this._putCheckpoint({source:"input",writes:{}}),this.input=Vy;else{const s=await Al(x8(e,this.input));if(s.length>0){const o=Ip(this.checkpoint,this.checkpointPendingWrites,this.nodes,this.channels,this.managed,this.config,!0,{step:this.step});ia(this.checkpoint,this.channels,Object.values(o).concat([{name:To,writes:s,triggers:[]}]),this.checkpointerGetNextVersion,this.triggerToNodes),await this._putCheckpoint({source:"input",writes:Object.fromEntries(s)}),this.input=Vy}else if(Sl in(this.config.configurable??{}))this.input=Vy;else throw new fF(`Received no input writes for ${JSON.stringify(e,null,2)}`)}this.isNested||(this.config=Pl(this.config,{[Sl]:this.isResuming}))}_emit(e){for(const t of e)this.stream.modes.has(t[0])&&this.stream.push([this.checkpointNamespace,...t])}async _putCheckpoint(e){var r,i,a,s;const t={...e,step:this.step,parents:((r=this.config.configurable)==null?void 0:r[Ca])??{}};if(this.checkpointer!==void 0){this.prevCheckpointConfig=(a=(i=this.checkpointConfig)==null?void 0:i.configurable)!=null&&a.checkpoint_id?this.checkpointConfig:void 0,this.checkpointMetadata=t,this.checkpoint=wu(this.checkpoint,this.channels,this.step),this.checkpointConfig={...this.checkpointConfig,configurable:{...this.checkpointConfig.configurable,checkpoint_ns:((s=this.config.configurable)==null?void 0:s.checkpoint_ns)??""}};const o={...this.checkpoint.channel_versions},u=IR(this.checkpointPreviousVersions,o);this.checkpointPreviousVersions=o,this._checkpointerPutAfterPrevious({config:{...this.checkpointConfig},checkpoint:R_(this.checkpoint),metadata:{...this.checkpointMetadata},newVersions:u}),this.checkpointConfig={...this.checkpointConfig,configurable:{...this.checkpointConfig.configurable,checkpoint_id:this.checkpoint.id}}}this.step+=1}_matchWrites(e){for(const[t,r,i]of this.checkpointPendingWrites){if(r===Oi||r===Tn||r===Ma)continue;const a=Object.values(e).find(s=>s.id===t);a&&a.writes.push([r,i])}for(const t of Object.values(e))t.writes.length>0&&this._outputWrites(t.id,t.writes,!0)}}function Iwe(n){return Ln(n==null?void 0:n.message)}class Pwe extends lc{constructor(e){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"StreamMessagesHandler"}),Object.defineProperty(this,"streamFn",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadatas",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"seen",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"emittedChatModelRunIds",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"stableMessageIdMap",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"lc_prefer_streaming",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.streamFn=e}_emit(e,t,r,i=!1){var s;if(i&&t.id!==void 0&&this.seen[t.id]!==void 0)return;let a=t.id;r!=null&&(Pp(t)?a??(a=`run-${r}-tool-${t.tool_call_id}`):((a==null||a===`run-${r}`)&&(a=this.stableMessageIdMap[r]??a??`run-${r}`),(s=this.stableMessageIdMap)[r]??(s[r]=a))),a!==t.id&&(t.id=a,t.lc_kwargs.id=a),t.id!=null&&(this.seen[t.id]=t),this.streamFn([e[0],"messages",[t,e[1]]])}handleChatModelStart(e,t,r,i,a,s,o,u){o&&(!s||!s.includes(ewe)&&!s.includes("nostream"))&&(this.metadatas[r]=[o.langgraph_checkpoint_ns.split("|"),{tags:s,name:u,...o}])}handleLLMNewToken(e,t,r,i,a,s){const o=s==null?void 0:s.chunk;this.emittedChatModelRunIds[r]=!0,this.metadatas[r]!==void 0&&(Iwe(o)?this._emit(this.metadatas[r],o.message,r):this._emit(this.metadatas[r],new Sn({content:e}),r))}handleLLMEnd(e,t){var r,i;if(!this.emittedChatModelRunIds[t]){const a=(i=(r=e.generations)==null?void 0:r[0])==null?void 0:i[0];Ln(a==null?void 0:a.message)&&this._emit(this.metadatas[t],a==null?void 0:a.message,t,!0),delete this.emittedChatModelRunIds[t]}delete this.metadatas[t],delete this.stableMessageIdMap[t]}handleLLMError(e,t){delete this.metadatas[t]}handleChainStart(e,t,r,i,a,s,o,u){if(s!==void 0&&u===s.langgraph_node&&(a===void 0||!a.includes(rr))&&(this.metadatas[r]=[s.langgraph_checkpoint_ns.split("|"),{tags:a,name:u,...s}],typeof t=="object")){for(const c of Object.values(t))if((Ln(c)||Zf(c))&&c.id!==void 0)this.seen[c.id]=c;else if(Array.isArray(c))for(const d of c)(Ln(d)||Zf(d))&&d.id!==void 0&&(this.seen[d.id]=d)}}handleChainEnd(e,t){const r=this.metadatas[t];if(delete this.metadatas[t],r!==void 0){if(Ln(e))this._emit(r,e,t,!0);else if(Array.isArray(e))for(const i of e)Ln(i)&&this._emit(r,i,t,!0);else if(e!=null&&typeof e=="object"){for(const i of Object.values(e))if(Ln(i))this._emit(r,i,t,!0);else if(Array.isArray(i))for(const a of i)Ln(a)&&this._emit(r,a,t,!0)}}}handleChainError(e,t){delete this.metadatas[t]}}const xwe=500,Owe=2,Nwe=128e3,kwe=3,Mwe=[400,401,402,403,404,405,406,407,409],Dwe=n=>{var t,r;if(n.message.startsWith("Cancel")||n.message.startsWith("AbortError")||n.name==="AbortError"||(n==null?void 0:n.code)==="ECONNABORTED")return!1;const e=((t=n==null?void 0:n.response)==null?void 0:t.status)??(n==null?void 0:n.status);return!(e&&Mwe.includes(+e)||((r=n==null?void 0:n.error)==null?void 0:r.code)==="insufficient_quota")};async function $8(n,e,t,r){var d;const i=n.retry_policy??e;let a=i!==void 0?i.initialInterval??xwe:0,s=0,o,u,{config:c}=n;for(t&&(c=Pl(c,t)),c={...c,signal:r};!(r!=null&&r.aborted);){n.writes.splice(0,n.writes.length),o=void 0;try{u=await n.proc.invoke(n.input,c);break}catch(p){if(o=p,o.pregelTaskId=n.id,V0e(o)){const w=(d=c==null?void 0:c.configurable)==null?void 0:d.checkpoint_ns,S=o.command;if(S.graph===w){for(const T of n.writers)await T.invoke(S,c);o=void 0;break}else if(S.graph===ki.PARENT){const T=swe(w);o.command=new ki({...o.command,graph:T})}}if(bv(o)||i===void 0||(s+=1,s>=(i.maxAttempts??kwe))||!(i.retryOn??Dwe)(o))break;a=Math.min(i.maxInterval??Nwe,a*(i.backoffFactor??Owe));const y=i.jitter?Math.floor(a+Math.random()*1e3):a;await new Promise(w=>setTimeout(w,y));const b=o.name??o.constructor.unminifiable_name??o.constructor.name;((i==null?void 0:i.logWarning)??!0)&&console.log(`Retrying task "${String(n.name)}" after ${a.toFixed(2)}ms (attempt ${s}) after ${b}: ${o}`),c=Pl(c,{[Sl]:!0})}}return{task:n,result:u,error:o,signalAborted:r==null?void 0:r.aborted}}const xR=Symbol.for("promiseAdded");function $we(){const n={next:()=>{},wait:Promise.resolve(xR)};function e(t){n.next=()=>{n.wait=new Promise(e),t(xR)}}return n.wait=new Promise(e),n}class Lwe{constructor({loop:e,nodeFinished:t}){Object.defineProperty(this,"nodeFinished",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"loop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.loop=e,this.nodeFinished=t}async tick(e={}){const{timeout:t,retryPolicy:r,onStepWrite:i,maxConcurrency:a}=e,s=new Set;let o;const u=new AbortController,c=Object.values(this.loop.tasks).filter(m=>m.writes.length===0),d=this._initializeAbortSignals({exceptionSignalController:u,timeout:t,signal:e.signal}),p=this._executeTasksWithRetry(c,{signals:d,retryPolicy:r,maxConcurrency:a});for await(const{task:m,error:y,signalAborted:b}of p)this._commit(m,y),Df(y)||bv(y)&&!Df(o)?o=y:y&&(s.size===0||!b)&&(u.abort(),s.add(y));if(i==null||i(this.loop.step,Object.values(this.loop.tasks).map(m=>m.writes).flat()),s.size===1)throw Array.from(s)[0];if(s.size>1)throw new AggregateError(Array.from(s),`Multiple errors occurred during superstep ${this.loop.step}. See the "errors" field of this exception for more details.`);if(Df(o)||bv(o)&&this.loop.isNested)throw o}_initializeAbortSignals({exceptionSignalController:e,timeout:t,signal:r}){var p;const i=((p=this.loop.config.configurable)==null?void 0:p[pF])??{},s=r&&i.composedAbortSignal&&r!==i.composedAbortSignal?$f(i.externalAbortSignal,r):i.externalAbortSignal??r,o=i.errorAbortSignal?$f(i.errorAbortSignal,e.signal):e.signal,u=t?AbortSignal.timeout(t):void 0,c=$f(...s?[s]:[],...u?[u]:[],o),d={externalAbortSignal:s,errorAbortSignal:o,timeoutAbortSignal:u,composedAbortSignal:c};return this.loop.config=Pl(this.loop.config,{[pF]:d}),d}async*_executeTasksWithRetry(e,t){var y;const{retryPolicy:r,maxConcurrency:i,signals:a}=t??{},s=$we(),o={},u={executingTasksMap:o,barrier:s,retryPolicy:r,scheduleTask:async(b,w,S)=>this.loop.acceptPush(b,w,S)};if((y=a==null?void 0:a.composedAbortSignal)!=null&&y.aborted)throw new Error("Abort");let c=0,d;const p=a!=null&&a.externalAbortSignal||a!=null&&a.timeoutAbortSignal?$f(...a.externalAbortSignal?[a.externalAbortSignal]:[],...a.timeoutAbortSignal?[a.timeoutAbortSignal]:[]):void 0,m=p?new Promise((b,w)=>{d=()=>w(new Error("Abort")),p.addEventListener("abort",d,{once:!0})}):void 0;for(;(c===0||Object.keys(o).length>0)&&e.length;){for(;Object.values(o).length<(i??e.length)&&c<e.length;c+=1){const w=e[c];o[w.id]=$8(w,r,{[ax]:Av==null?void 0:Av.bind(u,this,w)},a==null?void 0:a.composedAbortSignal).catch(S=>{var T;return{task:w,error:S,signalAborted:(T=a==null?void 0:a.composedAbortSignal)==null?void 0:T.aborted}})}const b=await Promise.race([...Object.values(o),...m?[m]:[],s.wait]);b!==xR&&(yield b,delete o[b.task.id])}}_commit(e,t){var r;if(t!==void 0)if(Df(t)){if(t.interrupts.length){const i=t.interrupts.map(s=>[Tn,s]),a=e.writes.filter(s=>s[0]===Ma);a.length&&i.push(...a),this.loop.putWrites(e.id,i)}}else bv(t)&&e.writes.length?this.loop.putWrites(e.id,e.writes):this.loop.putWrites(e.id,[[Oi,{message:t.message,name:t.name}]]);else this.nodeFinished&&(((r=e.config)==null?void 0:r.tags)==null||!e.config.tags.includes(rr))&&this.nodeFinished(String(e.name)),e.writes.length===0&&e.writes.push([sx,null]),this.loop.putWrites(e.id,e.writes)}}async function Av(n,e,t,r,i,a={}){var p,m;const s=(m=(p=e.config)==null?void 0:p.configurable)==null?void 0:m[Lu];if(!s)throw new Error(`BUG: No scratchpad found on task ${e.name}__${e.id}`);const o=s.callCounter;s.callCounter+=1;const u=new dwe({func:t,name:r,input:i,cache:a.cache,retry:a.retry,callbacks:a.callbacks}),c=await this.scheduleTask(e,o,u);if(!c)return;const d=this.executingTasksMap[c.id];if(d!==void 0)return d;if(c.writes.length>0){const y=c.writes.filter(([w])=>w===ud),b=c.writes.filter(([w])=>w===Oi);if(y.length>0){if(y.length===1)return Promise.resolve(y[0][1]);throw new Error(`BUG: multiple returns found for task ${c.name}__${c.id}`)}if(b.length>0){if(b.length===1){const w=b[0][1],S=w instanceof Error?w:new Error(String(w));return Promise.reject(S)}throw new Error(`BUG: multiple errors found for task ${c.name}__${c.id}`)}return}else{const y=$8(c,a.retry,{[ax]:Av.bind(this,n,c)});return this.executingTasksMap[c.id]=y,this.barrier.next(),y.then(({result:b,error:w})=>w?Promise.reject(w):b)}}class vo extends Error{constructor(e){super(e),this.name="GraphValidationError"}}function Uwe({nodes:n,channels:e,inputChannels:t,outputChannels:r,streamChannels:i,interruptAfterNodes:a,interruptBeforeNodes:s}){if(!e)throw new vo("Channels not provided");const o=new Set,u=new Set;for(const[c,d]of Object.entries(n)){if(c===Tn)throw new vo(`"Node name ${Tn} is reserved"`);if(d.constructor===qs)d.triggers.forEach(p=>o.add(p));else throw new vo(`Invalid node type ${typeof d}, expected PregelNode`)}for(const c of o)if(!(c in e))throw new vo(`Subcribed channel '${String(c)}' not in channels`);if(Array.isArray(t)){if(t.every(c=>!o.has(c)))throw new vo(`None of the input channels ${t} are subscribed to by any node`)}else if(!o.has(t))throw new vo(`Input channel ${String(t)} is not subscribed to by any node`);Array.isArray(r)?r.forEach(c=>u.add(c)):u.add(r),i&&!Array.isArray(i)?u.add(i):Array.isArray(i)&&i.forEach(c=>u.add(c));for(const c of u)if(!(c in e))throw new vo(`Output channel '${String(c)}' not in channels`);if(a&&a!=="*"){for(const c of a)if(!(c in n))throw new vo(`Node ${String(c)} not in nodes`)}if(s&&s!=="*"){for(const c of s)if(!(c in n))throw new vo(`Node ${String(c)} not in nodes`)}}function _F(n,e){if(Array.isArray(n)){for(const t of n)if(!(t in e))throw new Error(`Key ${String(t)} not found in channels`)}else if(!(n in e))throw new Error(`Key ${String(n)} not found in channels`)}class jwe{static subscribeTo(e,t){const{key:r,tags:i}={key:void 0,tags:void 0,...t??{}};if(Array.isArray(e)&&r!==void 0)throw new Error("Can't specify a key when subscribing to multiple channels");let a;typeof e=="string"?r?a={[r]:e}:a=[e]:a=Object.fromEntries(e.map(o=>[o,o]));const s=Array.isArray(e)?e:[e];return new qs({channels:a,triggers:s,tags:i})}static writeTo(e,t){const r=[];for(const i of e)r.push({channel:i,value:ju,skipNone:!1});for(const[i,a]of Object.entries(t??{}))qt.isRunnable(a)||typeof a=="function"?r.push({channel:i,value:ju,skipNone:!0,mapper:Vr(a)}):r.push({channel:i,value:a,skipNone:!1});return new Ir(r)}}class Fwe extends qt{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langgraph","pregel"]})}invoke(e,t){throw new Error("Not implemented")}withConfig(e){return super.withConfig(e)}stream(e,t){return super.stream(e,t)}}class Bwe extends Fwe{static lc_name(){return"LangGraph"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langgraph","pregel"]}),Object.defineProperty(this,"lg_is_pregel",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"channels",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputChannels",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputChannels",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoValidate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"streamMode",{enumerable:!0,configurable:!0,writable:!0,value:["values"]}),Object.defineProperty(this,"streamChannels",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"interruptAfter",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"interruptBefore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stepTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"debug",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"checkpointer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"retryPolicy",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"store",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"triggerToNodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{streamMode:t}=e;t!=null&&!Array.isArray(t)&&(t=[t]),this.nodes=e.nodes,this.channels=e.channels,this.autoValidate=e.autoValidate??this.autoValidate,this.streamMode=t??this.streamMode,this.inputChannels=e.inputChannels,this.outputChannels=e.outputChannels,this.streamChannels=e.streamChannels??this.streamChannels,this.interruptAfter=e.interruptAfter,this.interruptBefore=e.interruptBefore,this.stepTimeout=e.stepTimeout??this.stepTimeout,this.debug=e.debug??this.debug,this.checkpointer=e.checkpointer,this.retryPolicy=e.retryPolicy,this.config=e.config,this.store=e.store,this.cache=e.cache,this.name=e.name,this.autoValidate&&this.validate()}withConfig(e){const t=as(this.config,e);return new this.constructor({...this,config:t})}validate(){var e;Uwe({nodes:this.nodes,channels:this.channels,outputChannels:this.outputChannels,inputChannels:this.inputChannels,streamChannels:this.streamChannels,interruptAfterNodes:this.interruptAfter,interruptBeforeNodes:this.interruptBefore});for(const[t,r]of Object.entries(this.nodes))for(const i of r.triggers)(e=this.triggerToNodes)[i]??(e[i]=[]),this.triggerToNodes[i].push(t);return this}get streamChannelsList(){return Array.isArray(this.streamChannels)?this.streamChannels:this.streamChannels?[this.streamChannels]:Object.keys(this.channels)}get streamChannelsAsIs(){return this.streamChannels?this.streamChannels:Object.keys(this.channels)}async getGraphAsync(e){return this.getGraph(e)}*getSubgraphs(e,t){var r;for(const[i,a]of Object.entries(this.nodes)){if(e!==void 0&&!e.startsWith(i))continue;const s=(r=a.subgraphs)!=null&&r.length?a.subgraphs:[a.bound];for(const o of s){const u=N8(o);if(u!==void 0){if(i===e){yield[i,u];return}if(e===void 0&&(yield[i,u]),t){let c=e;e!==void 0&&(c=e.slice(i.length+1));for(const[d,p]of u.getSubgraphs(c,t))yield[`${i}${Ni}${d}`,p]}}}}}async*getSubgraphsAsync(e,t){yield*this.getSubgraphs(e,t)}async _prepareStateSnapshot({config:e,saved:t,subgraphCheckpointer:r,applyPendingWrites:i=!1}){var y,b,w,S,T,C,A,I;if(t===void 0)return{values:{},next:[],config:e,tasks:[]};const{managed:a}=await this.prepareSpecs(e,{skipManaged:!0}),s=I_(this.channels,t.checkpoint);if((y=t.pendingWrites)!=null&&y.length){const x=t.pendingWrites.filter(([L,U])=>L===Ia).map(([L,U,N])=>[String(U),N]);x.length>0&&ia(t.checkpoint,s,[{name:To,writes:x,triggers:[]}],void 0,this.triggerToNodes)}const o=Object.values(Ip(t.checkpoint,t.pendingWrites,this.nodes,s,a,t.config,!0,{step:(((b=t.metadata)==null?void 0:b.step)??-1)+1,store:this.store})),u=await Al(this.getSubgraphsAsync()),c=((w=t.config.configurable)==null?void 0:w.checkpoint_ns)??"",d={};for(const x of o){const L=u.find(([N])=>N===x.name);if(!L)continue;let U=`${String(x.name)}${Uu}${x.id}`;if(c&&(U=`${c}${Ni}${U}`),r===void 0){const N={configurable:{thread_id:(S=t.config.configurable)==null?void 0:S.thread_id,checkpoint_ns:U}};d[x.id]=N}else{const N={configurable:{[mr]:r,thread_id:(T=t.config.configurable)==null?void 0:T.thread_id,checkpoint_ns:U}},B=L[1];d[x.id]=await B.getState(N,{subgraphs:!0})}}if(i&&((C=t.pendingWrites)!=null&&C.length)){const x=Object.fromEntries(o.map(U=>[U.id,U]));for(const[U,N,B]of t.pendingWrites)[Oi,Tn,yv].includes(N)||U in x&&x[U].writes.push([String(N),B]);const L=o.filter(U=>U.writes.length>0);L.length>0&&ia(t.checkpoint,s,L,void 0,this.triggerToNodes)}let p=t==null?void 0:t.metadata;p&&((I=(A=t==null?void 0:t.config)==null?void 0:A.configurable)!=null&&I.thread_id)&&(p={...p,thread_id:t.config.configurable.thread_id});const m=o.filter(x=>x.writes.length===0).map(x=>x.name);return{values:nc(s,this.streamChannelsAsIs),next:m,tasks:k8(o,(t==null?void 0:t.pendingWrites)??[],d,this.streamChannelsAsIs),metadata:p,config:ff(t.config,t.metadata),createdAt:t.checkpoint.ts,parentConfig:t.parentConfig}}async getState(e,t){var u,c,d,p;const r=((u=e.configurable)==null?void 0:u[mr])??this.checkpointer;if(!r)throw new cF("No checkpointer set");const i=((c=e.configurable)==null?void 0:c.checkpoint_ns)??"";if(i!==""&&((d=e.configurable)==null?void 0:d[mr])===void 0){const m=xC(i);for await(const[y,b]of this.getSubgraphsAsync(m,!0))if(y===m)return await b.getState(qh(e,{[mr]:r}),{subgraphs:t==null?void 0:t.subgraphs});throw new Error(`Subgraph with namespace "${m}" not found.`)}const a=as(this.config,e),s=await r.getTuple(e);return await this._prepareStateSnapshot({config:a,saved:s,subgraphCheckpointer:t!=null&&t.subgraphs?r:void 0,applyPendingWrites:!((p=e.configurable)!=null&&p.checkpoint_id)})}async*getStateHistory(e,t){var s,o,u;const r=((s=e.configurable)==null?void 0:s[mr])??this.checkpointer;if(!r)throw new Error("No checkpointer set");const i=((o=e.configurable)==null?void 0:o.checkpoint_ns)??"";if(i!==""&&((u=e.configurable)==null?void 0:u[mr])===void 0){const c=xC(i);for await(const[d,p]of this.getSubgraphsAsync(c,!0))if(d===c){yield*p.getStateHistory(qh(e,{[mr]:r}),t);return}throw new Error(`Subgraph with namespace "${c}" not found.`)}const a=as(this.config,e,{configurable:{checkpoint_ns:i}});for await(const c of r.list(a,t))yield this._prepareStateSnapshot({config:c.config,saved:c})}async bulkUpdateState(e,t){var o,u,c;const r=((o=e.configurable)==null?void 0:o[mr])??this.checkpointer;if(!r)throw new cF("No checkpointer set");if(t.length===0)throw new Error("No supersteps provided");if(t.some(d=>d.updates.length===0))throw new Error("No updates provided");const i=((u=e.configurable)==null?void 0:u.checkpoint_ns)??"";if(i!==""&&((c=e.configurable)==null?void 0:c[mr])===void 0){const d=xC(i);for await(const[,p]of this.getSubgraphsAsync(d,!0))return await p.bulkUpdateState(qh(e,{[mr]:r}),t);throw new Error(`Subgraph "${d}" not found`)}const a=async(d,p)=>{var V,de,ae,ue,te,oe,ge,Ee,Y,ve,Re;const m=this.config?as(this.config,d):d,y=await r.getTuple(m),b=y!==void 0?R_(y.checkpoint):T8(),w={...y==null?void 0:y.checkpoint.channel_versions},S=((V=y==null?void 0:y.metadata)==null?void 0:V.step)??-1;let T=qh(m,{checkpoint_ns:((de=m.configurable)==null?void 0:de.checkpoint_ns)??""}),C=m.metadata??{};y!=null&&y.config.configurable&&(T=qh(m,y.config.configurable),C={...y.metadata,...C});const{values:A,asNode:I}=p[0];if(A==null&&I===void 0){if(p.length>1)throw new $n("Cannot create empty checkpoint with multiple updates");const Q=await r.put(T,wu(b,void 0,S),{source:"update",step:S+1,writes:{},parents:((ae=y==null?void 0:y.metadata)==null?void 0:ae.parents)??{}},{});return ff(Q,y?y.metadata:void 0)}const x=I_(this.channels,b),{managed:L}=await this.prepareSpecs(m,{skipManaged:!0});if(A===null&&I===kt){if(p.length>1)throw new $n("Cannot apply multiple updates when clearing state");if(y){const ie=Ip(b,y.pendingWrites||[],this.nodes,x,L,y.config,!0,{step:(((ue=y.metadata)==null?void 0:ue.step)??-1)+1,checkpointer:this.checkpointer||void 0,store:this.store}),ce=(y.pendingWrites||[]).filter(P=>P[0]===Ia).map(P=>P.slice(1));ce.length>0&&ia(y.checkpoint,x,[{name:To,writes:ce,triggers:[]}],void 0,this.triggerToNodes);for(const[P,O,K]of y.pendingWrites||[])[Oi,Tn,yv].includes(O)||P in ie&&ie[P].writes.push([O,K]);ia(b,x,Object.values(ie),void 0,this.triggerToNodes)}const Q=await r.put(T,wu(b,void 0,S),{...C,source:"update",step:S+1,writes:{},parents:((te=y==null?void 0:y.metadata)==null?void 0:te.parents)??{}},{});return ff(Q,y?y.metadata:void 0)}if(A==null&&I===Y0e){if(p.length>1)throw new $n("Cannot copy checkpoint with multiple updates");const Q=await r.put((y==null?void 0:y.parentConfig)??T,wu(b,void 0,S),{source:"fork",step:S+1,writes:{},parents:((oe=y==null?void 0:y.metadata)==null?void 0:oe.parents)??{}},{});return ff(Q,y?y.metadata:void 0)}if(I===To){if(p.length>1)throw new $n("Cannot apply multiple updates when updating as input");const Q=await Al(x8(this.inputChannels,A));if(Q.length===0)throw new $n(`Received no input writes for ${JSON.stringify(this.inputChannels,null,2)}`);ia(b,x,[{name:To,writes:Q,triggers:[]}],r.getNextVersion.bind(this.checkpointer),this.triggerToNodes);const ie=((ge=y==null?void 0:y.metadata)==null?void 0:ge.step)!=null?y.metadata.step+1:-1,ce=await r.put(T,wu(b,x,ie),{source:"input",step:ie,writes:Object.fromEntries(Q),parents:((Ee=y==null?void 0:y.metadata)==null?void 0:Ee.parents)??{}},IR(w,b.channel_versions));return await r.putWrites(ce,Q,kf(To,b.id)),ff(ce,y?y.metadata:void 0)}if(((Y=m.configurable)==null?void 0:Y.checkpoint_id)===void 0&&(y==null?void 0:y.pendingWrites)!==void 0&&y.pendingWrites.length>0){const Q=Ip(b,y.pendingWrites,this.nodes,x,L,y.config,!0,{store:this.store,checkpointer:this.checkpointer,step:(((ve=y.metadata)==null?void 0:ve.step)??-1)+1}),ie=(y.pendingWrites??[]).filter(P=>P[0]===Ia).map(P=>P.slice(1));ie.length>0&&ia(y.checkpoint,x,[{name:To,writes:ie,triggers:[]}],void 0,this.triggerToNodes);for(const[P,O,K]of y.pendingWrites)[Oi,Tn,yv].includes(O)||Q[P]===void 0||Q[P].writes.push([O,K]);const ce=Object.values(Q).filter(P=>P.writes.length>0);ce.length>0&&ia(b,x,ce,void 0,this.triggerToNodes)}const U=Object.values(b.versions_seen).map(Q=>Object.values(Q)).flat().find(Q=>!!Q),N=[];if(p.length===1){let{values:Q,asNode:ie}=p[0];if(ie===void 0&&Object.keys(this.nodes).length===1)[ie]=Object.keys(this.nodes);else if(ie===void 0&&U===void 0)typeof this.inputChannels=="string"&&this.nodes[this.inputChannels]!==void 0&&(ie=this.inputChannels);else if(ie===void 0){const ce=Object.entries(b.versions_seen).map(([P,O])=>Object.values(O).map(K=>[K,P])).flat().sort(([P],[O])=>A8(P,O));ce&&(ce.length===1?ie=ce[0][1]:ce[ce.length-1][0]!==ce[ce.length-2][0]&&(ie=ce[ce.length-1][1]))}if(ie===void 0)throw new $n('Ambiguous update, specify "asNode"');N.push({values:Q,asNode:ie})}else for(const{asNode:Q,values:ie}of p){if(Q==null)throw new $n('"asNode" is required when applying multiple updates');N.push({values:ie,asNode:Q})}const B=[];for(const{asNode:Q,values:ie}of N){if(this.nodes[Q]===void 0)throw new $n(`Node "${Q.toString()}" does not exist`);const ce=this.nodes[Q].getWriters();if(!ce.length)throw new $n(`No writers found for node "${Q.toString()}"`);B.push({name:Q,input:ie,proc:ce.length>1?vr.from(ce,{omitSequenceTags:!0}):ce[0],writes:[],triggers:[Tn],id:kf(Tn,b.id),writers:[]})}for(const Q of B)await Q.proc.invoke(Q.input,on({...m,store:(m==null?void 0:m.store)??this.store},{runName:m.runName??`${this.getName()}UpdateState`,configurable:{[Yf]:ie=>Q.writes.push(...ie),[$u]:(ie,ce=!1)=>Tv(S,b,x,L,Q,ie,ce)}}));for(const Q of B){const ie=Q.writes.filter(ce=>ce[0]!==Ra);y!==void 0&&ie.length>0&&await r.putWrites(T,ie,Q.id)}ia(b,x,B,r.getNextVersion.bind(this.checkpointer),this.triggerToNodes);const q=IR(w,b.channel_versions),J=await r.put(T,wu(b,x,S+1),{source:"update",step:S+1,writes:Object.fromEntries(N.map(Q=>[Q.asNode,Q.values])),parents:((Re=y==null?void 0:y.metadata)==null?void 0:Re.parents)??{}},q);for(const Q of B){const ie=Q.writes.filter(ce=>ce[0]===Ra);ie.length>0&&await r.putWrites(J,ie,Q.id)}return ff(J,y?y.metadata:void 0)};let s=e;for(const{updates:d}of t)s=await a(s,d);return s}async updateState(e,t,r){return this.bulkUpdateState(e,[{updates:[{values:t,asNode:r}]}])}_defaults(e){var A,I;const{debug:t,streamMode:r,inputKeys:i,outputKeys:a,interruptAfter:s,interruptBefore:o,...u}=e;let c=!0;const d=t!==void 0?t:this.debug;let p=a;p===void 0?p=this.streamChannelsAsIs:_F(p,this.channels);let m=i;m===void 0?m=this.inputChannels:_F(m,this.channels);const y=o??this.interruptBefore??[],b=s??this.interruptAfter??[];let w;r!==void 0?(w=Array.isArray(r)?r:[r],c=typeof r=="string"):(w=this.streamMode,c=!0),((A=e.configurable)==null?void 0:A[Rp])!==void 0&&(w=["values"]);let S;this.checkpointer===!1?S=void 0:e!==void 0&&((I=e.configurable)==null?void 0:I[mr])!==void 0?S=e.configurable[mr]:S=this.checkpointer;const T=e.store??this.store,C=e.cache??this.cache;return[d,w,m,p,u,y,b,S,T,c,C]}async stream(e,t){var a;const r=new AbortController,i={recursionLimit:(a=this.config)==null?void 0:a.recursionLimit,...t,signal:t!=null&&t.signal?$f(t.signal,r.signal):r.signal};return new vF(await super.stream(e,i),r)}streamEvents(e,t,r){var s,o;const i=new AbortController,a={recursionLimit:(s=this.config)==null?void 0:s.recursionLimit,...t,callbacks:mwe((o=this.config)==null?void 0:o.callbacks,t==null?void 0:t.callbacks),signal:t!=null&&t.signal?$f(t.signal,i.signal):i.signal};return new vF(super.streamEvents(e,a,r),i)}async prepareSpecs(e,t){const r={...e,store:this.store},i={},a={};for(const[o,u]of Object.entries(this.channels))Bb(u)?i[o]=u:t!=null&&t.skipManaged?a[o]={cls:lx,params:{config:{}}}:a[o]=u;const s=new cwe(await Object.entries(a).reduce(async(o,[u,c])=>{const d=await o;let p;return qb(c)?("key"in c.params&&c.params.key===uwe&&(c.params.key=u),p=await c.cls.initialize(r,c.params)):p=await c.initialize(r),p!==void 0&&d.push([u,p]),d},Promise.resolve([])));return{channelSpecs:i,managed:s}}async _validateInput(e){return e}async _validateConfigurable(e){return e}async*_streamIterator(e,t){const r=t==null?void 0:t.subgraphs,i=P8(this.config,t);if(i.recursionLimit===void 0||i.recursionLimit<1)throw new Error('Passed "recursionLimit" must be at least 1.');if(this.checkpointer!==void 0&&this.checkpointer!==!1&&i.configurable===void 0)throw new Error('Checkpointer requires one or more of the following "configurable" keys: "thread_id", "checkpoint_ns", "checkpoint_id"');const a=await this._validateInput(e),{runId:s,...o}=i,[u,c,,d,p,m,y,b,w,S,T]=this._defaults(o);p.configurable=await this._validateConfigurable(p.configurable);const C=new D8({modes:new Set(c)});if(c.includes("messages")){const J=new Pwe(de=>C.push(de)),{callbacks:V}=p;if(V===void 0)p.callbacks=[J];else if(Array.isArray(V))p.callbacks=V.concat(J);else{const de=V.copy();de.addHandler(J,!0),p.callbacks=de}}c.includes("custom")&&(p.writer=J=>C.push([[],"custom",J]));const A=await $i(p),I=await(A==null?void 0:A.handleChainStart(this.toJSON(),pwe(e,"input"),s,void 0,void 0,void 0,(p==null?void 0:p.runName)??this.getName())),{channelSpecs:x,managed:L}=await this.prepareSpecs(p);let U,N;const q=(async()=>{var J,V,de;try{U=await cx.initialize({input:a,config:p,checkpointer:b,nodes:this.nodes,channelSpecs:x,managed:L,outputKeys:d,streamKeys:this.streamChannelsAsIs,store:w,cache:T,stream:C,interruptAfter:y,interruptBefore:m,manager:I,debug:this.debug,triggerToNodes:this.triggerToNodes});const ae=new Lwe({loop:U,nodeFinished:(J=p.configurable)==null?void 0:J[Q0e]});t!=null&&t.subgraphs&&(U.config.configurable={...U.config.configurable,[P_]:U.stream}),await this._runLoop({loop:U,runner:ae,debug:u,config:p})}catch(ae){N=ae}finally{try{U&&(await((V=U.store)==null?void 0:V.stop()),await((de=U.cache)==null?void 0:de.stop())),await Promise.all([...(U==null?void 0:U.checkpointerPromises)??[],...Array.from(L.values()).map(ae=>ae.promises())])}catch(ae){N=N??ae}N?C.error(N):C.close()}})();try{for await(const J of C){if(J===void 0)throw new Error("Data structure error.");const[V,de,ae]=J;c.includes(de)&&(r&&!S?yield[V,de,ae]:S?r?yield[V,ae]:yield ae:yield[de,ae])}}catch(J){throw await(I==null?void 0:I.handleChainError(N)),J}finally{await q}await(I==null?void 0:I.handleChainEnd((U==null?void 0:U.output)??{},s,void 0,void 0,void 0))}async invoke(e,t){const r=(t==null?void 0:t.streamMode)??"values",i={...t,outputKeys:(t==null?void 0:t.outputKeys)??this.outputChannels,streamMode:r},a=[],s=await this.stream(e,i),o=[];let u;for await(const c of s)r==="values"?nwe(c)?o.push(c[Tn]):u=c:a.push(c);if(r==="values"){if(o.length>0){const c=o.flat(1);if(u==null)return{[Tn]:c};if(typeof u=="object")return{...u,[Tn]:c}}return u}return a}async _runLoop(e){const{loop:t,runner:r,debug:i,config:a}=e;let s;try{for(;await t.tick({inputKeys:this.inputChannels});){for(const{task:o}of await t._matchCachedWrites())t._outputWrites(o.id,o.writes,!0);i&&Swe(t.checkpointMetadata.step,t.channels,this.streamChannelsList),i&&M8(t.step,Object.values(t.tasks)),await r.tick({timeout:this.stepTimeout,retryPolicy:this.retryPolicy,onStepWrite:(o,u)=>{i&&Twe(o,u,this.streamChannelsList)},maxConcurrency:a.maxConcurrency,signal:a.signal})}if(t.status==="out_of_steps")throw new q0e([`Recursion limit of ${a.recursionLimit} reached`,"without hitting a stop condition. You can increase the",'limit by setting the "recursionLimit" config key.'].join(" "),{lc_error_code:"GRAPH_RECURSION_LIMIT"})}catch(o){if(s=o,!await t.finishAndHandleError(s))throw o}finally{s===void 0&&await t.finishAndHandleError()}}async clearCache(){var e;await((e=this.cache)==null?void 0:e.clear([]))}}class nm extends Cd{constructor(e,t){super(),Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"BinaryOperatorAggregate"}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"operator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"initialValueFactory",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.operator=e,this.initialValueFactory=t,this.value=t==null?void 0:t()}fromCheckpoint(e){const t=new nm(this.operator,this.initialValueFactory);return typeof e<"u"&&(t.value=e),t}update(e){let t=e;if(!t.length)return!1;this.value===void 0&&([this.value]=t,t=t.slice(1));for(const r of t)this.value!==void 0&&(this.value=this.operator(this.value,r));return!0}get(){if(this.value===void 0)throw new zr;return this.value}checkpoint(){if(this.value===void 0)throw new zr;return this.value}isAvailable(){return this.value!==void 0}}class ql extends Cd{constructor(e=!0){super(),Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"EphemeralValue"}),Object.defineProperty(this,"guard",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.guard=e}fromCheckpoint(e){const t=new ql(this.guard);return typeof e<"u"&&(t.value=[e]),t}update(e){if(e.length===0){const t=this.value.length>0;return this.value=[],t}if(e.length!==1&&this.guard)throw new $n("EphemeralValue can only receive one value per step.");return this.value=[e[e.length-1]],!0}get(){if(this.value.length===0)throw new zr;return this.value[0]}checkpoint(){if(this.value.length===0)throw new zr;return this.value[0]}isAvailable(){return this.value.length!==0}}class L8{constructor(e){Object.defineProperty(this,"path",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ends",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),qt.isRunnable(e.path)?this.path=e.path:this.path=Vr(e.path).withConfig({runName:"Branch"}),this.ends=Array.isArray(e.pathMap)?e.pathMap.reduce((t,r)=>(t[r]=r,t),{}):e.pathMap}run(e,t){return Ir.registerWriter(new Gl({name:"<branch_run>",trace:!1,func:async(r,i)=>{try{return await this._route(r,i,e,t)}catch(a){throw a.name===R8.unminifiable_name&&console.warn(`[WARN]: 'NodeInterrupt' thrown in conditional edge. This is likely a bug in your graph implementation.
NodeInterrupt should only be thrown inside a node, not in edge conditions.`),a}}}))}async _route(e,t,r,i){let a=await this.path.invoke(i?i(t):e,t);Array.isArray(a)||(a=[a]);let s;if(this.ends?s=a.map(u=>Fi(u)?u:this.ends[u]):s=a,s.some(u=>!u))throw new Error("Branch condition returned unknown or null destination");if(s.filter(Fi).some(u=>u.node===kt))throw new $n("Cannot send a packet to the END node");return await r(s,t)??e}}class qwe{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"branches",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"entryPoint",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"compiled",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.nodes={},this.edges=new Set,this.branches={}}warnIfCompiled(e){this.compiled&&console.warn(e)}get allEdges(){return this.edges}addNode(...e){function t(i){return i.length>=1&&typeof i[0]!="string"}const r=t(e)?Array.isArray(e[0])?e[0]:Object.entries(e[0]):[[e[0],e[1],e[2]]];if(r.length===0)throw new Error("No nodes provided in `addNode`");for(const[i,a,s]of r){for(const u of[Ni,Uu])if(i.includes(u))throw new Error(`"${u}" is a reserved character and is not allowed in node names.`);if(this.warnIfCompiled("Adding a node to a graph that has already been compiled. This will not be reflected in the compiled graph."),i in this.nodes)throw new Error(`Node \`${i}\` already present.`);if(i===kt)throw new Error(`Node \`${i}\` is reserved.`);const o=Vr(a);this.nodes[i]={runnable:o,metadata:s==null?void 0:s.metadata,subgraphs:ux(o)?[o]:s==null?void 0:s.subgraphs,ends:s==null?void 0:s.ends}}return this}addEdge(e,t){if(this.warnIfCompiled("Adding an edge to a graph that has already been compiled. This will not be reflected in the compiled graph."),e===kt)throw new Error("END cannot be a start node");if(t===kn)throw new Error("START cannot be an end node");if(Array.from(this.edges).some(([r])=>r===e)&&!("channels"in this))throw new Error(`Already found path for ${e}. For multiple edges, use StateGraph.`);return this.edges.add([e,t]),this}addConditionalEdges(e,t,r){var s,o;const i=typeof e=="object"?e:{source:e,path:t,pathMap:r};if(this.warnIfCompiled("Adding an edge to a graph that has already been compiled. This will not be reflected in the compiled graph."),!qt.isRunnable(i.path)){const u=Array.isArray(i.pathMap)?i.pathMap.join(","):Object.keys(i.pathMap??{}).join(",");i.path=Vr(i.path).withConfig({runName:`Branch<${i.source}${u!==""?`,${u}`:""}>`.slice(0,63)})}const a=i.path.getName()==="RunnableLambda"?"condition":i.path.getName();if(this.branches[i.source]&&this.branches[i.source][a])throw new Error(`Condition \`${a}\` already present for node \`${e}\``);return(s=this.branches)[o=i.source]??(s[o]={}),this.branches[i.source][a]=new L8(i),this}setEntryPoint(e){return this.warnIfCompiled("Setting the entry point of a graph that has already been compiled. This will not be reflected in the compiled graph."),this.addEdge(kn,e)}setFinishPoint(e){return this.warnIfCompiled("Setting a finish point of a graph that has already been compiled. This will not be reflected in the compiled graph."),this.addEdge(e,kt)}compile({checkpointer:e,interruptBefore:t,interruptAfter:r,name:i}={}){this.validate([...Array.isArray(t)?t:[],...Array.isArray(r)?r:[]]);const a=new U8({builder:this,checkpointer:e,interruptAfter:r,interruptBefore:t,autoValidate:!1,nodes:{},channels:{[kn]:new ql,[kt]:new ql},inputChannels:kn,outputChannels:kt,streamChannels:[],streamMode:"values",name:i});for(const[s,o]of Object.entries(this.nodes))a.attachNode(s,o);for(const[s,o]of this.edges)a.attachEdge(s,o);for(const[s,o]of Object.entries(this.branches))for(const[u,c]of Object.entries(o))a.attachBranch(s,u,c);return a.validate()}validate(e){const t=new Set([...this.allEdges].map(([i,a])=>i));for(const[i]of Object.entries(this.branches))t.add(i);for(const i of t)if(i!==kn&&!(i in this.nodes))throw new Error(`Found edge starting at unknown node \`${i}\``);const r=new Set([...this.allEdges].map(([i,a])=>a));for(const[i,a]of Object.entries(this.branches))for(const s of Object.values(a))if(s.ends!=null)for(const o of Object.values(s.ends))r.add(o);else{r.add(kt);for(const o of Object.keys(this.nodes))o!==i&&r.add(o)}for(const i of Object.values(this.nodes))for(const a of i.ends??[])r.add(a);for(const i of Object.keys(this.nodes))if(!r.has(i))throw new z0e([`Node \`${i}\` is not reachable.`,"","If you are returning Command objects from your node,",'make sure you are passing names of potential destination nodes as an "ends" array','into ".addNode(..., { ends: ["node1", "node2"] })".'].join(`
`),{lc_error_code:"UNREACHABLE_NODE"});for(const i of r)if(i!==kt&&!(i in this.nodes))throw new Error(`Found edge ending at unknown node \`${i}\``);if(e){for(const i of e)if(!(i in this.nodes))throw new Error(`Interrupt node \`${i}\` is not present`)}this.compiled=!0}}class U8 extends Bwe{constructor({builder:e,...t}){super(t),Object.defineProperty(this,"builder",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.builder=e}attachNode(e,t){this.channels[e]=new ql,this.nodes[e]=new qs({channels:[],triggers:[],metadata:t.metadata,subgraphs:t.subgraphs,ends:t.ends}).pipe(t.runnable).pipe(new Ir([{channel:e,value:ju}],[rr])),this.streamChannels.push(e)}attachEdge(e,t){if(t===kt){if(e===kn)throw new Error("Cannot have an edge from START to END");this.nodes[e].writers.push(new Ir([{channel:kt,value:ju}],[rr]))}else this.nodes[t].triggers.push(e),this.nodes[t].channels.push(e)}attachBranch(e,t,r){e===kn&&!this.nodes[kn]&&(this.nodes[kn]=jwe.subscribeTo(kn,{tags:[rr]})),this.nodes[e].pipe(r.run(a=>{const s=a.map(o=>Fi(o)?o:{channel:o===kt?kt:`branch:${e}:${t}:${o}`,value:ju});return new Ir(s,[rr])}));const i=r.ends?Object.values(r.ends):Object.keys(this.nodes);for(const a of i)if(a!==kt){const s=`branch:${e}:${t}:${a}`;this.channels[s]=new ql,this.nodes[a].triggers.push(s),this.nodes[a].channels.push(s)}}async getGraphAsync(e){var c,d,p,m;const t=e==null?void 0:e.xray,r=new Wv,i={[kn]:r.addNode({schema:Pa()},kn)},a={};let s={};t&&(s=Object.fromEntries((await Al(this.getSubgraphsAsync())).filter(y=>bF(y[1]))));function o(y,b,w,S=!1){if(b===kt&&a[kt]===void 0&&(a[kt]=r.addNode({schema:Pa()},kt)),i[y]!==void 0){if(a[b]===void 0)throw new Error(`End node ${b} not found!`);return r.addEdge(i[y],a[b],w!==b?w:void 0,S)}}for(const[y,b]of Object.entries(this.builder.nodes)){const w=Yr(y),S=b.runnable,T=b.metadata??{};if((c=this.interruptBefore)!=null&&c.includes(y)&&((d=this.interruptAfter)!=null&&d.includes(y))?T.__interrupt="before,after":(p=this.interruptBefore)!=null&&p.includes(y)?T.__interrupt="before":(m=this.interruptAfter)!=null&&m.includes(y)&&(T.__interrupt="after"),t){const C=typeof t=="number"?t-1:t,A=s[y]!==void 0?await s[y].getGraphAsync({...e,xray:C}):S.getGraph(e);if(A.trimFirstNode(),A.trimLastNode(),Object.keys(A.nodes).length>1){let L=function(N){return N?N.lc_runnable:!1},U=function(N,B){if(N!==void 0&&!AR(N))return N;if(L(B))try{let q=B.getName();return q=q.startsWith("Runnable")?q.slice(8):q,q}catch{return B.getName()}else return B.name??"UnknownSchema"};const[I,x]=r.extend(A,w);if(I===void 0)throw new Error(`Could not extend subgraph "${y}" due to missing entrypoint.`);x!==void 0&&(i[w]={name:U(x.id,x.data),...x}),a[w]={name:U(I.id,I.data),...I}}else{const I=r.addNode(S,w,T);i[w]=I,a[w]=I}}else{const C=r.addNode(S,w,T);i[w]=C,a[w]=C}}const u=[...this.builder.allEdges].sort(([y],[b])=>y<b?-1:b>y?1:0);for(const[y,b]of u)o(Yr(y),Yr(b));for(const[y,b]of Object.entries(this.builder.branches)){const w={...Object.fromEntries(Object.keys(this.builder.nodes).filter(S=>S!==y).map(S=>[Yr(S),Yr(S)])),[kt]:kt};for(const S of Object.values(b)){let T;S.ends!==void 0?T=S.ends:T=w;for(const[C,A]of Object.entries(T))o(Yr(y),Yr(A),C,!0)}}for(const[y,b]of Object.entries(this.builder.nodes))if(b.ends!==void 0)for(const w of b.ends)o(Yr(y),Yr(w),void 0,!0);return r}getGraph(e){var c,d,p,m;const t=e==null?void 0:e.xray,r=new Wv,i={[kn]:r.addNode({schema:Pa()},kn)},a={};let s={};t&&(s=Object.fromEntries(op(this.getSubgraphs()).filter(y=>bF(y[1]))));function o(y,b,w,S=!1){return b===kt&&a[kt]===void 0&&(a[kt]=r.addNode({schema:Pa()},kt)),r.addEdge(i[y],a[b],w!==b?w:void 0,S)}for(const[y,b]of Object.entries(this.builder.nodes)){const w=Yr(y),S=b.runnable,T=b.metadata??{};if((c=this.interruptBefore)!=null&&c.includes(y)&&((d=this.interruptAfter)!=null&&d.includes(y))?T.__interrupt="before,after":(p=this.interruptBefore)!=null&&p.includes(y)?T.__interrupt="before":(m=this.interruptAfter)!=null&&m.includes(y)&&(T.__interrupt="after"),t){const C=typeof t=="number"?t-1:t,A=s[y]!==void 0?s[y].getGraph({...e,xray:C}):S.getGraph(e);if(A.trimFirstNode(),A.trimLastNode(),Object.keys(A.nodes).length>1){let L=function(N){return N?N.lc_runnable:!1},U=function(N,B){if(N!==void 0&&!AR(N))return N;if(L(B))try{let q=B.getName();return q=q.startsWith("Runnable")?q.slice(8):q,q}catch{return B.getName()}else return B.name??"UnknownSchema"};const[I,x]=r.extend(A,w);if(I===void 0)throw new Error(`Could not extend subgraph "${y}" due to missing entrypoint.`);x!==void 0&&(i[w]={name:U(x.id,x.data),...x}),a[w]={name:U(I.id,I.data),...I}}else{const I=r.addNode(S,w,T);i[w]=I,a[w]=I}}else{const C=r.addNode(S,w,T);i[w]=C,a[w]=C}}const u=[...this.builder.allEdges].sort(([y],[b])=>y<b?-1:b>y?1:0);for(const[y,b]of u)o(Yr(y),Yr(b));for(const[y,b]of Object.entries(this.builder.branches)){const w={...Object.fromEntries(Object.keys(this.builder.nodes).filter(S=>S!==y).map(S=>[Yr(S),Yr(S)])),[kt]:kt};for(const S of Object.values(b)){let T;S.ends!==void 0?T=S.ends:T=w;for(const[C,A]of Object.entries(T))o(Yr(y),Yr(A),C,!0)}}return r}}function bF(n){return typeof n.attachNode=="function"&&typeof n.attachEdge=="function"}function Yr(n){return n==="subgraph"?`"${n}"`:n}const Ru=(n,e)=>n.size===e.size&&[...n].every(t=>e.has(t));class fx extends Cd{constructor(e){super(),Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"NamedBarrierValue"}),Object.defineProperty(this,"names",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"seen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.names=e,this.seen=new Set}fromCheckpoint(e){const t=new fx(this.names);return typeof e<"u"&&(t.seen=new Set(e)),t}update(e){let t=!1;for(const r of e)if(this.names.has(r))this.seen.has(r)||(this.seen.add(r),t=!0);else throw new $n(`Value ${JSON.stringify(r)} not in names ${JSON.stringify(this.names)}`);return t}get(){if(!Ru(this.names,this.seen))throw new zr}checkpoint(){return[...this.seen]}consume(){return this.seen&&this.names&&Ru(this.seen,this.names)?(this.seen=new Set,!0):!1}isAvailable(){return!!this.names&&Ru(this.names,this.seen)}}class dx extends Cd{constructor(e){super(),Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"NamedBarrierValueAfterFinish"}),Object.defineProperty(this,"names",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"seen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"finished",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.names=e,this.seen=new Set,this.finished=!1}fromCheckpoint(e){const t=new dx(this.names);if(typeof e<"u"){const[r,i]=e;t.seen=new Set(r),t.finished=i}return t}update(e){let t=!1;for(const r of e)if(this.names.has(r)&&!this.seen.has(r))this.seen.add(r),t=!0;else if(!this.names.has(r))throw new $n(`Value ${JSON.stringify(r)} not in names ${JSON.stringify(this.names)}`);return t}get(){if(!this.finished||!Ru(this.names,this.seen))throw new zr}checkpoint(){return[[...this.seen],this.finished]}consume(){return this.finished&&this.seen&&this.names&&Ru(this.seen,this.names)?(this.seen=new Set,this.finished=!1,!0):!1}finish(){return!this.finished&&this.names&&Ru(this.names,this.seen)?(this.finished=!0,!0):!1}isAvailable(){return this.finished&&!!this.names&&Ru(this.names,this.seen)}}class jm extends Cd{constructor(){super(...arguments),Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"LastValue"}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:[]})}fromCheckpoint(e){const t=new jm;return typeof e<"u"&&(t.value=[e]),t}update(e){if(e.length===0)return!1;if(e.length!==1)throw new $n("LastValue can only receive one value per step.",{lc_error_code:"INVALID_CONCURRENT_GRAPH_UPDATE"});return this.value=[e[e.length-1]],!0}get(){if(this.value.length===0)throw new zr;return this.value[0]}checkpoint(){if(this.value.length===0)throw new zr;return this.value[0]}isAvailable(){return this.value.length!==0}}class hx extends Cd{constructor(){super(...arguments),Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"LastValueAfterFinish"}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"finished",{enumerable:!0,configurable:!0,writable:!0,value:!1})}fromCheckpoint(e){const t=new hx;if(typeof e<"u"){const[r,i]=e;t.value=[r],t.finished=i}return t}update(e){return e.length===0?!1:(this.finished=!1,this.value=[e[e.length-1]],!0)}get(){if(this.value.length===0||!this.finished)throw new zr;return this.value[0]}checkpoint(){if(this.value.length!==0)return[this.value[0],this.finished]}consume(){return this.finished?(this.finished=!1,this.value=[],!0):!1}finish(){return!this.finished&&this.value.length>0?(this.finished=!0,!0):!1}isAvailable(){return this.value.length!==0&&this.finished}}class Vwe{constructor(e){Object.defineProperty(this,"lc_graph_name",{enumerable:!0,configurable:!0,writable:!0,value:"AnnotationRoot"}),Object.defineProperty(this,"spec",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.spec=e}}const Bu=function(n){return qb(n)?n:n?OR(n):new jm};Bu.Root=n=>new Vwe(n);function OR(n){return typeof n=="object"&&n&&"reducer"in n&&n.reducer?new nm(n.reducer,n.default):typeof n=="object"&&n&&"value"in n&&n.value?new nm(n.value,n.default):new jm}const zwe="lg:";class Hwe{constructor(){Object.defineProperty(this,"_map",{enumerable:!0,configurable:!0,writable:!0,value:new WeakMap}),Object.defineProperty(this,"_extensionCache",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}get(e){return this._map.get(e)}extend(e,t){const r=this.get(e);this._map.set(e,t(r))}remove(e){return this._map.delete(e),this}has(e){return this._map.has(e)}getChannelsForSchema(e){const t={},r=c1(e);for(const[i,a]of Object.entries(r)){const s=this.get(a);s!=null&&s.reducer?t[i]=new nm(s.reducer.fn,s.default):t[i]=new jm}return t}getExtendedChannelSchemas(e,t){if(Object.keys(t).length===0)return e;const r=Object.entries(t).filter(([,s])=>s===!0).sort(([s],[o])=>s.localeCompare(o)).map(([s,o])=>`${s}:${o}`).join("|"),i=this._extensionCache.get(r)??new WeakMap;if(i.has(e))return i.get(e);let a=e;if(t.withReducerSchema||t.withJsonSchemaExtrasAsDescription){const s=Object.entries(c1(e)).map(([o,u])=>{var p;const c=this.get(u);let d=t.withReducerSchema?((p=c==null?void 0:c.reducer)==null?void 0:p.schema)??u:u;if(t.withJsonSchemaExtrasAsDescription&&(c!=null&&c.jsonSchemaExtra)){const m=td(d)??td(u),y=JSON.stringify({...c.jsonSchemaExtra,description:m});d=d.describe(`${zwe}${y}`)}return[o,d]});a=jB(e,Object.fromEntries(s)),sr(a)&&(a._def.unknownKeys="strip")}return t.asPartial&&(a=eI(a)),i.set(e,a),this._extensionCache.set(r,i),a}}const j8=new Hwe,Io="__root__",NR=Symbol.for("langgraph.state.partial");class Gwe extends qwe{constructor(e,t){var r,i;if(super(),Object.defineProperty(this,"channels",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"waitingEdges",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"_schemaDefinition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaRuntimeDefinition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_inputDefinition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_inputRuntimeDefinition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_outputDefinition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_outputRuntimeDefinition",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaDefinitions",{enumerable:!0,configurable:!0,writable:!0,value:new Map}),Object.defineProperty(this,"_metaRegistry",{enumerable:!0,configurable:!0,writable:!0,value:j8}),Object.defineProperty(this,"_configSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_configRuntimeSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Qwe(e)){const a=this._metaRegistry.getChannelsForSchema(e.state),s=e.input!=null?this._metaRegistry.getChannelsForSchema(e.input):a,o=e.output!=null?this._metaRegistry.getChannelsForSchema(e.output):a;this._schemaDefinition=a,this._schemaRuntimeDefinition=e.state,this._inputDefinition=s,this._inputRuntimeDefinition=e.input??NR,this._outputDefinition=o,this._outputRuntimeDefinition=e.output??e.state}else if(xo(e)){const a=this._metaRegistry.getChannelsForSchema(e);this._schemaDefinition=a,this._schemaRuntimeDefinition=e,this._inputDefinition=a,this._inputRuntimeDefinition=NR,this._outputDefinition=a,this._outputRuntimeDefinition=e}else if(Xwe(e))this._schemaDefinition=e.input.spec,this._inputDefinition=e.input.spec,this._outputDefinition=e.output.spec;else if(Zwe(e))this._schemaDefinition=e.stateSchema.spec,this._inputDefinition=((r=e.input)==null?void 0:r.spec)??this._schemaDefinition,this._outputDefinition=((i=e.output)==null?void 0:i.spec)??this._schemaDefinition;else if(Jwe(e)||wF(e)){const a=wF(e)?e.spec:e;this._schemaDefinition=a}else if(Ywe(e)){const a=Wwe(e.channels);this._schemaDefinition=a}else throw new Error("Invalid StateGraph input. Make sure to pass a valid Annotation.Root or Zod schema.");this._inputDefinition??(this._inputDefinition=this._schemaDefinition),this._outputDefinition??(this._outputDefinition=this._schemaDefinition),this._addSchema(this._schemaDefinition),this._addSchema(this._inputDefinition),this._addSchema(this._outputDefinition),xo(t)&&(this._configRuntimeSchema=t)}get allEdges(){return new Set([...this.edges,...Array.from(this.waitingEdges).flatMap(([e,t])=>e.map(r=>[r,t]))])}_addSchema(e){if(!this._schemaDefinitions.has(e)){this._schemaDefinitions.set(e,e);for(const[t,r]of Object.entries(e)){let i;if(typeof r=="function"?i=r():i=r,this.channels[t]!==void 0){if(this.channels[t]!==i&&!qb(i)&&i.lc_graph_name!=="LastValue")throw new Error(`Channel "${t}" already exists with a different type.`)}else this.channels[t]=i}}}addNode(...e){function t(i){return i.length>=1&&typeof i[0]!="string"}const r=t(e)?Array.isArray(e[0])?e[0]:Object.entries(e[0]).map(([i,a])=>[i,a,a[Symbol.for("langgraph.state.node")]??void 0]):[[e[0],e[1],e[2]]];if(r.length===0)throw new Error("No nodes provided in `addNode`");for(const[i,a,s]of r){if(i in this.channels)throw new Error(`${i} is already being used as a state attribute (a.k.a. a channel), cannot also be used as a node name.`);for(const p of[Ni,Uu])if(i.includes(p))throw new Error(`"${p}" is a reserved character and is not allowed in node names.`);if(this.warnIfCompiled("Adding a node to a graph that has already been compiled. This will not be reflected in the compiled graph."),i in this.nodes)throw new Error(`Node \`${i}\` already present.`);if(i===kt||i===kn)throw new Error(`Node \`${i}\` is reserved.`);let o=this._schemaDefinition;(s==null?void 0:s.input)!==void 0&&(xo(s.input)?o=this._metaRegistry.getChannelsForSchema(s.input):s.input.spec!==void 0&&(o=s.input.spec)),o!==void 0&&this._addSchema(o);let u;qt.isRunnable(a)?u=a:typeof a=="function"?u=new Gl({func:a,name:i,trace:!1}):u=Vr(a);let c=s==null?void 0:s.cachePolicy;typeof c=="boolean"&&(c=c?{}:void 0);const d={runnable:u,retryPolicy:s==null?void 0:s.retryPolicy,cachePolicy:c,metadata:s==null?void 0:s.metadata,input:o??this._schemaDefinition,subgraphs:ux(u)?[u]:s==null?void 0:s.subgraphs,ends:s==null?void 0:s.ends,defer:s==null?void 0:s.defer};this.nodes[i]=d}return this}addEdge(e,t){if(typeof e=="string")return super.addEdge(e,t);this.compiled&&console.warn("Adding an edge to a graph that has already been compiled. This will not be reflected in the compiled graph.");for(const r of e){if(r===kt)throw new Error("END cannot be a start node");if(!Object.keys(this.nodes).some(i=>i===r))throw new Error(`Need to add a node named "${r}" first`)}if(t===kt)throw new Error("END cannot be an end node");if(!Object.keys(this.nodes).some(r=>r===t))throw new Error(`Need to add a node named "${t}" first`);return this.waitingEdges.add([e,t]),this}addSequence(e){const t=Array.isArray(e)?e:Object.entries(e).map(([i,a])=>[i,a,a[Symbol.for("langgraph.state.node")]??void 0]);if(t.length===0)throw new Error("Sequence requires at least one node.");let r;for(const[i,a,s]of t){if(i in this.nodes)throw new Error(`Node names must be unique: node with the name "${i}" already exists.`);const o=i;this.addNode(o,a,s),r!=null&&this.addEdge(r,o),r=o}return this}compile({checkpointer:e,store:t,cache:r,interruptBefore:i,interruptAfter:a,name:s}={}){this.validate([...Array.isArray(i)?i:[],...Array.isArray(a)?a:[]]);const o=Object.keys(this._schemaDefinitions.get(this._outputDefinition)),u=o.length===1&&o[0]===Io?Io:o,c=Object.keys(this.channels),d=c.length===1&&c[0]===Io?Io:c,p=new Kwe({builder:this,checkpointer:e,interruptAfter:a,interruptBefore:i,autoValidate:!1,nodes:{},channels:{...this.channels,[kn]:new ql},inputChannels:kn,outputChannels:u,streamChannels:d,streamMode:"updates",store:t,cache:r,name:s});p.attachNode(kn);for(const[m,y]of Object.entries(this.nodes))p.attachNode(m,y);p.attachBranch(kn,mF,EF(),{withReader:!1});for(const[m]of Object.entries(this.nodes))p.attachBranch(m,mF,EF(),{withReader:!1});for(const[m,y]of this.edges)p.attachEdge(m,y);for(const[m,y]of this.waitingEdges)p.attachEdge(m,y);for(const[m,y]of Object.entries(this.branches))for(const[b,w]of Object.entries(y))p.attachBranch(m,b,w);return p.validate()}}function Wwe(n){const e={};for(const[t,r]of Object.entries(n))e[t]=OR(r);return e}class Kwe extends U8{constructor(){super(...arguments),Object.defineProperty(this,"_metaRegistry",{enumerable:!0,configurable:!0,writable:!0,value:j8})}attachNode(e,t){let r;e===kn?r=Object.entries(this.builder._schemaDefinitions.get(this.builder._inputDefinition)).filter(([u,c])=>!qb(c)).map(([u])=>u):r=Object.keys(this.builder.channels);function i(u){if(Br(u))return u.graph===ki.PARENT?null:u._updateAsTuples();if(Array.isArray(u)&&u.length>0&&u.some(c=>Br(c))){const c=[];for(const d of u)if(Br(d)){if(d.graph===ki.PARENT)continue;c.push(...d._updateAsTuples())}else c.push([Io,d]);return c}else if(u!=null)return[[Io,u]];return null}const a=e;function s(u){if(u){if(Br(u))return u.graph===ki.PARENT?null:u._updateAsTuples().filter(([c])=>r.includes(c));if(Array.isArray(u)&&u.length>0&&u.some(Br)){const c=[];for(const d of u)if(Br(d)){if(d.graph===ki.PARENT)continue;c.push(...d._updateAsTuples().filter(([p])=>r.includes(p)))}else{const p=s(d);p&&c.push(...p??[])}return c}else{if(typeof u=="object"&&!Array.isArray(u))return Object.entries(u).filter(([c])=>r.includes(c));{const c=Array.isArray(u)?"array":typeof u;throw new $n(`Expected node "${a.toString()}" to return an object or an array containing at least one Command object, received ${c}`,{lc_error_code:"INVALID_GRAPH_NODE_RETURN_VALUE"})}}}else return null}const o=[{value:ju,mapper:new Gl({func:r.length&&r[0]===Io?i:s,trace:!1,recurse:!1})}];if(e===kn)this.nodes[e]=new qs({tags:[rr],triggers:[kn],channels:[kn],writers:[new Ir(o,[rr])]});else{const u=(t==null?void 0:t.input)??this.builder._schemaDefinition,c=Object.fromEntries(Object.keys(this.builder._schemaDefinitions.get(u)).map(m=>[m,m])),d=Object.keys(c).length===1&&Io in c,p=`branch:to:${e}`;this.channels[p]=t!=null&&t.defer?new hx:new ql(!1),this.nodes[e]=new qs({triggers:[p],channels:d?Object.keys(c):c,writers:[new Ir(o,[rr])],mapper:d?void 0:m=>Object.fromEntries(Object.entries(m).filter(([y])=>y in c)),bound:t==null?void 0:t.runnable,metadata:t==null?void 0:t.metadata,retryPolicy:t==null?void 0:t.retryPolicy,cachePolicy:t==null?void 0:t.cachePolicy,subgraphs:t==null?void 0:t.subgraphs,ends:t==null?void 0:t.ends})}}attachEdge(e,t){if(t!==kt){if(typeof e=="string")this.nodes[e].writers.push(new Ir([{channel:`branch:to:${t}`,value:null}],[rr]));else if(Array.isArray(e)){const r=`join:${e.join("+")}:${t}`;this.channels[r]=this.builder.nodes[t].defer?new dx(new Set(e)):new fx(new Set(e)),this.nodes[t].triggers.push(r);for(const i of e)this.nodes[i].writers.push(new Ir([{channel:r,value:i}],[rr]))}}}attachBranch(e,t,r,i={withReader:!0}){const a=async(s,o)=>{const u=s.filter(d=>d!==kt);if(!u.length)return;const c=u.map(d=>Fi(d)?d:{channel:d===kt?d:`branch:to:${d}`,value:e});await Ir.doWrite({...o,tags:(o.tags??[]).concat([rr])},c)};this.nodes[e].writers.push(r.run(a,i.withReader?s=>ox.doRead(s,this.streamChannels??this.outputChannels,!0):void 0))}async _validateInput(e){if(e==null)return e;const t=(()=>{const r=this.builder._inputRuntimeDefinition,i=this.builder._schemaRuntimeDefinition,a=s=>{if(s!=null)return this._metaRegistry.getExtendedChannelSchemas(s,{withReducerSchema:!0})};if(xo(r))return a(r);if(r===NR)return eI(a(i))})();if(Br(e)){const r=e;return e.update&&t!=null&&(r.update=Jy(t,e.update)),r}return t!=null?Jy(t,e):e}async _validateConfigurable(e){const t=this.builder._configRuntimeSchema;return xo(t)&&Jy(t,e),e}}function Jwe(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&Object.keys(n).length>0&&Object.values(n).every(e=>typeof e=="function"||Bb(e))}function wF(n){return typeof n=="object"&&n!==null&&"lc_graph_name"in n&&n.lc_graph_name==="AnnotationRoot"}function Ywe(n){return typeof n=="object"&&n!==null&&n.channels!==void 0}function Zwe(n){return typeof n=="object"&&n!==null&&n.stateSchema!==void 0}function Xwe(n){return typeof n=="object"&&n!==null&&n.stateSchema===void 0&&n.input!==void 0&&n.output!==void 0}function Qwe(n){return!(typeof n!="object"||n==null||!("state"in n)||!xo(n.state)||"input"in n&&!xo(n.input)||"output"in n&&!xo(n.output))}function eEe(n){if(Fi(n))return[n];const e=[];Br(n)?e.push(n):Array.isArray(n)&&e.push(...n.filter(Br));const t=[];for(const r of e){if(r.graph===ki.PARENT)throw new I8(r);Fi(r.goto)||typeof r.goto=="string"?t.push(r.goto):Array.isArray(r.goto)&&t.push(...r.goto)}return t}function EF(){const n=new Gl({func:eEe,tags:[rr],trace:!1,recurse:!1,name:"<control_branch>"});return new L8({path:n})}const tEe="__remove_all__";function F8(n,e){const t=Array.isArray(n)?n:[n],r=Array.isArray(e)?e:[e],i=t.map(is),a=r.map(is);for(const d of i)(d.id===null||d.id===void 0)&&(d.id=hF(),d.lc_kwargs.id=d.id);let s;for(let d=0;d<a.length;d+=1){const p=a[d];(p.id===null||p.id===void 0)&&(p.id=hF(),p.lc_kwargs.id=p.id),p.getType()==="remove"&&p.id===tEe&&(s=d)}if(s!=null)return a.slice(s+1);const o=[...i],u=new Map(o.map((d,p)=>[d.id,p])),c=new Set;for(const d of a){const p=u.get(d.id);if(p!==void 0)d.getType()==="remove"?c.add(d.id):(c.delete(d.id),o[p]=d);else{if(d.getType()==="remove")throw new Error(`Attempting to delete a message with an ID that doesn't exist ('${d.id}')`);u.set(d.id,o.length),o.push(d)}}return o.filter(d=>!c.has(d.id))}class nEe extends Gl{constructor(e,t){const{name:r,tags:i,handleToolErrors:a}=t??{};super({name:r,tags:i,func:(s,o)=>this.run(s,o)}),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"handleToolErrors",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"trace",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.tools=e,this.handleToolErrors=a??this.handleToolErrors}async run(e,t){var o;const r=Array.isArray(e)?e[e.length-1]:e.messages[e.messages.length-1];if((r==null?void 0:r._getType())!=="ai")throw new Error("ToolNode only accepts AIMessages as input.");const i=await Promise.all(((o=r.tool_calls)==null?void 0:o.map(async u=>{const c=this.tools.find(d=>d.name===u.name);try{if(c===void 0)throw new Error(`Tool "${u.name}" not found.`);const d=await c.invoke({...u,type:"tool_call"},t);return Ln(d)&&d._getType()==="tool"||Br(d)?d:new ko({name:c.name,content:typeof d=="string"?d:JSON.stringify(d),tool_call_id:u.id})}catch(d){if(!this.handleToolErrors||Df(d))throw d;return new ko({content:`Error: ${d.message}
 Please fix your mistakes.`,name:u.name,tool_call_id:u.id??""})}}))??[]);if(!i.some(Br))return Array.isArray(e)?i:{messages:i};const a=[];let s=null;for(const u of i)Br(u)?u.graph===ki.PARENT&&Array.isArray(u.goto)&&u.goto.every(c=>Fi(c))?s?s.goto.push(...u.goto):s=new ki({graph:ki.PARENT,goto:u.goto}):a.push(u):a.push(Array.isArray(e)?[u]:{messages:[u]});return s&&a.push(s),a}}const LC=/<name>(.*?)<\/name>/s,UC=/<content>(.*?)<\/content>/s;function rEe(n){if(!(Ln(n)&&(ua(n)||Zf(n)&&Cv(n)))||!n.name)return n;const{name:t}=n;if(typeof n.content=="string")return new bn({...Object.keys(n.lc_kwargs??{}).length>0?n.lc_kwargs:n,content:`<name>${t}</name><content>${n.content}</content>`,name:void 0});const r=[];let i=0;for(const a of n.content)typeof a=="string"?(i+=1,r.push(`<name>${t}</name><content>${a}</content>`)):typeof a=="object"&&"type"in a&&a.type==="text"?(i+=1,r.push({...a,text:`<name>${t}</name><content>${a.text}</content>`})):r.push(a);return i||r.unshift({type:"text",text:`<name>${t}</name><content></content>`}),new bn({...n.lc_kwargs,content:r,name:void 0})}function iEe(n){if(!ua(n)||!n.content)return n;let e=[],t;if(Array.isArray(n.content))e=n.content.filter(r=>{if(r.type==="text"){const i=r.text.match(LC),a=r.text.match(UC);return i&&(!a||a[1]==="")?(t=i[1],!1):!0}return!0}).map(r=>{if(r.type==="text"){const i=r.text.match(LC),a=r.text.match(UC);return!i||!a?r:(t=i[1],{...r,text:a[1]})}return r});else{const r=n.content,i=r.match(LC),a=r.match(UC);if(!i||!a)return n;t=i[1],e=a[1]}return new bn({...Object.keys(n.lc_kwargs??{}).length>0?n.lc_kwargs:n,content:e,name:t})}function aEe(n,e){let t,r;if(e==="inline")t=rEe,r=iEe;else throw new Error(`Invalid agent name mode: ${e}. Needs to be one of: "inline"`);function i(a){return a.map(t)}return vr.from([_r.from(i),n,_r.from(r)])}function sEe(n){if(typeof n=="string"||Ln(n)&&n._getType()==="system")return n;if(typeof n=="function")return async e=>n(e.messages);if(qt.isRunnable(n))return _r.from(e=>e.messages).pipe(n);throw new Error(`Unexpected type for messageModifier: ${typeof n}`)}const zy="prompt";function oEe(n){let e;if(n==null)e=_r.from(t=>t.messages).withConfig({runName:zy});else if(typeof n=="string"){const t=new fs(n);e=_r.from(r=>[t,...r.messages??[]]).withConfig({runName:zy})}else if(Ln(n)&&n._getType()==="system")e=_r.from(t=>[n,...t.messages]).withConfig({runName:zy});else if(typeof n=="function")e=_r.from(n).withConfig({runName:zy});else if(qt.isRunnable(n))e=n;else throw new Error(`Got unexpected type for 'prompt': ${typeof n}`);return e}function kR(n){return qt.isRunnable(n)}function lEe(n,e,t){if([n,e,t].filter(a=>a!=null).length>1)throw new Error("Expected only one of prompt, stateModifier, or messageModifier, got multiple values");let i=n;return e!=null?i=e:t!=null&&(i=sEe(t)),oEe(i)}function MR(n){return"invoke"in n&&typeof n.invoke=="function"&&"_modelType"in n}function O_(n){return"_queuedMethodOperations"in n&&"_model"in n&&typeof n._model=="function"}async function uEe(n,e){let t=n;if(vr.isRunnableSequence(t)&&(t=t.steps.find(o=>di.isRunnableBinding(o)||MR(o)||O_(o))||t),O_(t)&&(t=await t._model()),!di.isRunnableBinding(t)||!t.kwargs||typeof t.kwargs!="object"||!("tools"in t.kwargs))return!0;let r=t.kwargs.tools;if(r.length===1&&"functionDeclarations"in r[0]&&(r=r[0].functionDeclarations),e.length!==r.length)throw new Error("Number of tools in the model.bindTools() and tools passed to createReactAgent must match");const i=new Set(e.flatMap(o=>kR(o)?o.name:[])),a=new Set;for(const o of r){let u;if("type"in o&&o.type==="function")u=o.function.name;else if("name"in o)u=o.name;else if("toolSpec"in o&&"name"in o.toolSpec)u=o.toolSpec.name;else continue;u&&a.add(u)}const s=[...i].filter(o=>!a.has(o));if(s.length>0)throw new Error(`Missing tools '${s}' in the model.bindTools().Tools in the model.bindTools() must match the tools passed to createReactAgent.`);return!1}async function SF(n){let e=n;if(vr.isRunnableSequence(e)&&(e=e.steps.find(t=>di.isRunnableBinding(t)||MR(t)||O_(t))||e),O_(e)&&(e=await e._model()),di.isRunnableBinding(e)&&(e=e.bound),!MR(e))throw new Error(`Expected \`llm\` to be a ChatModel or RunnableBinding (e.g. llm.bind_tools(...)) with invoke() and generate() methods, got ${e.constructor.name}`);return e}const cEe=()=>Bu.Root({messages:Bu({reducer:F8,default:()=>[]}),structuredResponse:Bu}),fEe=Bu.Root({llmInputMessages:Bu({reducer:F8,default:()=>[]})});function dEe(n){const{llm:e,tools:t,messageModifier:r,stateModifier:i,prompt:a,stateSchema:s,checkpointSaver:o,checkpointer:u,interruptBefore:c,interruptAfter:d,store:p,responseFormat:m,preModelHook:y,postModelHook:b,name:w,includeAgentName:S}=n;let T,C;Array.isArray(t)?(T=t,C=new nEe(T.filter(kR))):(T=t.tools,C=t);let A=null;const I=async ue=>{if(A)return A;let te;if(await uEe(ue,T)){if(!("bindTools"in ue)||typeof ue.bindTools!="function")throw new Error(`llm ${ue} must define bindTools method.`);te=ue.bindTools(T)}else te=ue;const oe=lEe(a,i,r),ge=S==="inline"?oe.pipe(aEe(te,S)):oe.pipe(te);return A=ge,ge},x=new Set(T.filter(kR).filter(ue=>"returnDirect"in ue&&ue.returnDirect).map(ue=>ue.name));function L(ue){const{messages:te,llmInputMessages:oe,...ge}=ue;return oe!=null&&oe.length>0?{messages:oe,...ge}:{messages:te,...ge}}const U=async(ue,te)=>{if(m==null)throw new Error("Attempted to generate structured output with no passed response schema. Please contact us for help.");const oe=[...ue.messages];let ge;if(typeof m=="object"&&"prompt"in m&&"schema"in m){const{prompt:Y,schema:ve}=m;ge=(await SF(e)).withStructuredOutput(ve),oe.unshift(new fs({content:Y}))}else ge=(await SF(e)).withStructuredOutput(m);return{structuredResponse:await ge.invoke(oe,te)}},N=async(ue,te)=>{const ge=await(await I(e)).invoke(L(ue),te);return ge.name=w,ge.lc_kwargs.name=w,{messages:[ge]}},B=s??cEe(),q=new Gwe(B).addNode("tools",C),J=q,V=ue=>Object.fromEntries(Object.entries(ue).filter(([te,oe])=>oe!=null));let de="agent",ae;return y!=null?(J.addNode("pre_model_hook",y).addEdge("pre_model_hook","agent"),de="pre_model_hook",ae=Bu.Root({...B.spec,...fEe.spec})):de="agent",J.addNode("agent",N,{input:ae}).addEdge(kn,de),b!=null&&J.addNode("post_model_hook",b).addEdge("agent","post_model_hook").addConditionalEdges("post_model_hook",ue=>{var ge;const{messages:te}=ue,oe=te[te.length-1];return ua(oe)&&((ge=oe.tool_calls)!=null&&ge.length)?"tools":Pp(oe)?de:m!=null?"generate_structured_response":kt},V({tools:"tools",[de]:de,generate_structured_response:m!=null?"generate_structured_response":null,[kt]:m!=null?null:kt})),m!==void 0&&q.addNode("generate_structured_response",U).addEdge("generate_structured_response",kt),b==null&&J.addConditionalEdges("agent",ue=>{var ge;const{messages:te}=ue,oe=te[te.length-1];return!ua(oe)||!((ge=oe.tool_calls)!=null&&ge.length)?m!=null?"generate_structured_response":kt:"tools"},V({tools:"tools",generate_structured_response:m!=null?"generate_structured_response":null,[kt]:m!=null?null:kt})),x.size>0?J.addConditionalEdges("tools",ue=>{for(let te=ue.messages.length-1;te>=0;te-=1){const oe=ue.messages[te];if(!Pp(oe))break;if(oe.name!==void 0&&x.has(oe.name))return kt}return de},V({[de]:de,[kt]:kt})):J.addEdge("tools",de),J.compile({checkpointer:u??o,interruptBefore:c,interruptAfter:d,store:p,name:w})}const TF="mcpLlmClientApiKeys",hEe=()=>{const{user:n,loadingAuth:e,signOut:t}=$_e(),[r,i]=_t.useState({openai:"",claude:"",gemini:""}),[a,s]=_t.useState("gemini"),[o,u]=_t.useState($y),[c,d]=_t.useState(!1),{mcpServers:p,serversLoadedFromStorage:m,handleAddServer:y,handleRemoveServer:b,handleConnectToServer:w,mcpCleanup:S,stableConnectedServerConfig:T}=Vhe({}),[C,A]=_t.useState(null),[I,x]=_t.useState(void 0),L=_t.useMemo(()=>JSON.stringify({provider:a,apiKeys:r,connectedServers:T}),[a,r,T]);_t.useEffect(()=>{if(!m||!c||!o){A(null),x(void 0);return}const B=JSON.parse(L);if(Object.keys(B.connectedServers).length===0){A(null),x(void 0);return}let q=!1;return(async()=>{try{let V=null;switch(B.provider){case"openai":B.apiKeys.openai&&(V=new Nre({apiKey:B.apiKeys.openai}));break;case"claude":B.apiKeys.claude&&(V=new Lie({apiKey:B.apiKeys.claude}));break;case"gemini":B.apiKeys.gemini&&(V=new xae({apiKey:B.apiKeys.gemini,model:"gemini-2.5-flash-preview-04-17"}));break}if(!V){A(null),x(void 0);return}const de=await Zee(B.connectedServers,{logLevel:"info"});if(q){de.cleanup&&de.cleanup(),x(void 0);return}const ae=de.tools;Array.isArray(ae)?console.log("Langchain tools disponibles:",ae.map(ue=>ue.name||ue)):console.log("Langchain tools disponibles:",ae),x(()=>de.cleanup),A(()=>dEe({llm:V,tools:ae}))}catch(V){console.error("Error during agent initialization:",V),A(null),x(void 0)}})(),()=>{q=!0,I&&I(),A(null),x(void 0)}},[L,m,c,o]),_t.useEffect(()=>()=>{I&&I(),S&&S()},[I,S]),_t.useEffect(()=>{try{const B=localStorage.getItem(TF);if(B){const q=JSON.parse(B);if(i(q),q&&typeof q=="object"){let J="gemini";switch(q.openai&&(J="openai"),q.claude&&(J="claude"),q.gemini&&(J="gemini"),s(J),J){case"openai":u(p2);break;case"claude":u(m2);break;case"gemini":u($y);break;default:u($y)}}}}catch(B){console.error("Error loading API keys from localStorage:",B)}finally{d(!0)}},[]),_t.useEffect(()=>{if(c)try{const B=JSON.stringify(r);localStorage.setItem(TF,B)}catch(B){console.error("Error saving API keys to localStorage:",B)}},[r,c]);const U=B=>{var q,J,V,de;i(B),(q=B[a])!=null&&q.trim()||((J=B.gemini)!=null&&J.trim()?s("gemini"):(V=B.openai)!=null&&V.trim()?s("openai"):(de=B.claude)!=null&&de.trim()&&s("claude"))},N=B=>{switch(s(B),B){case"openai":u(p2);break;case"claude":u(m2);break;case"gemini":u($y);break;default:u(null)}};return e?Ae.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-900 text-gray-300",children:[Ae.jsx(Uf,{className:"w-12 h-12 text-sky-400"}),Ae.jsx("p",{className:"ml-4 text-xl mt-4",children:"Loading Application..."})]}):Ae.jsxs("div",{className:"flex flex-col min-h-screen bg-gray-900 text-gray-100",children:[Ae.jsx(gH,{user:n,signOut:t}),Ae.jsx("main",{className:"flex-grow container mx-auto p-4 md:p-6 lg:p-8",children:Ae.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 md:gap-8",children:[Ae.jsx("div",{className:"lg:col-span-3 space-y-6 md:space-y-8",children:Ae.jsxs("div",{className:"bg-gray-800 p-6 rounded-xl shadow-xl",children:[Ae.jsx("h2",{className:"text-xl font-semibold text-sky-400 mb-2",children:"Welcome to MCP LLM Client!"}),Ae.jsx("p",{className:"text-gray-400",children:"Manage your LLM API keys, select your preferred provider, configure MCP server connections, and chat with AI."})]})}),Ae.jsxs("div",{className:"lg:col-span-1 space-y-6 md:space-y-8",children:[Ae.jsx(vH,{apiKeys:r,onApiKeysChange:U,activeLLMProvider:a,onLLMProviderChange:N,keysLoadedFromStorage:c}),Ae.jsx(_H,{servers:p,onAddServer:y,onRemoveServer:b,onConnectToServer:w,serversLoadedFromStorage:m})]}),Ae.jsx("div",{className:"lg:col-span-2 space-y-6 md:space-y-8",children:c&&m&&Ae.jsx(rY,{apiKeys:r,activeProvider:a,mcpServers:p,keysLoadedFromStorage:c,langchainAgent:C,activeLLMService:o})})]})}),Ae.jsx(yH,{})]})},B8=document.getElementById("root");if(!B8)throw new Error("Could not find root element to mount to");const pEe=cH.createRoot(B8);pEe.render(Ae.jsx(nH.StrictMode,{children:Ae.jsx(hEe,{})}));
